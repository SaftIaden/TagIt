(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const m of document.querySelectorAll('link[rel="modulepreload"]'))f(m);new MutationObserver(m=>{for(const v of m)if(v.type==="childList")for(const b of v.addedNodes)b.tagName==="LINK"&&b.rel==="modulepreload"&&f(b)}).observe(document,{childList:!0,subtree:!0});function u(m){const v={};return m.integrity&&(v.integrity=m.integrity),m.referrerpolicy&&(v.referrerPolicy=m.referrerpolicy),m.crossorigin==="use-credentials"?v.credentials="include":m.crossorigin==="anonymous"?v.credentials="omit":v.credentials="same-origin",v}function f(m){if(m.ep)return;m.ep=!0;const v=u(m);fetch(m.href,v)}})();function tv(e,s){const u=Object.create(null),f=e.split(",");for(let m=0;m<f.length;m++)u[f[m]]=!0;return s?m=>!!u[m.toLowerCase()]:m=>!!u[m]}const _M="itemscope,allowfullscreen,formnovalidate,ismap,nomodule,novalidate,readonly",yM=tv(_M);function oE(e){return!!e||e===""}function nv(e){if(Cn(e)){const s={};for(let u=0;u<e.length;u++){const f=e[u],m=er(f)?bM(f):nv(f);if(m)for(const v in m)s[v]=m[v]}return s}else{if(er(e))return e;if(Li(e))return e}}const vM=/;(?![^(]*\))/g,xM=/:(.+)/;function bM(e){const s={};return e.split(vM).forEach(u=>{if(u){const f=u.split(xM);f.length>1&&(s[f[0].trim()]=f[1].trim())}}),s}function iv(e){let s="";if(er(e))s=e;else if(Cn(e))for(let u=0;u<e.length;u++){const f=iv(e[u]);f&&(s+=f+" ")}else if(Li(e))for(const u in e)e[u]&&(s+=u+" ");return s.trim()}const Hs=e=>er(e)?e:e==null?"":Cn(e)||Li(e)&&(e.toString===cE||!Vn(e.toString))?JSON.stringify(e,sE,2):String(e),sE=(e,s)=>s&&s.__v_isRef?sE(e,s.value):yu(s)?{[`Map(${s.size})`]:[...s.entries()].reduce((u,[f,m])=>(u[`${f} =>`]=m,u),{})}:aE(s)?{[`Set(${s.size})`]:[...s.values()]}:Li(s)&&!Cn(s)&&!uE(s)?String(s):s,Ai={},_u=[],es=()=>{},wM=()=>!1,EM=/^on[^a-z]/,Mm=e=>EM.test(e),rv=e=>e.startsWith("onUpdate:"),yr=Object.assign,ov=(e,s)=>{const u=e.indexOf(s);u>-1&&e.splice(u,1)},TM=Object.prototype.hasOwnProperty,Jn=(e,s)=>TM.call(e,s),Cn=Array.isArray,yu=e=>Im(e)==="[object Map]",aE=e=>Im(e)==="[object Set]",Vn=e=>typeof e=="function",er=e=>typeof e=="string",sv=e=>typeof e=="symbol",Li=e=>e!==null&&typeof e=="object",lE=e=>Li(e)&&Vn(e.then)&&Vn(e.catch),cE=Object.prototype.toString,Im=e=>cE.call(e),SM=e=>Im(e).slice(8,-1),uE=e=>Im(e)==="[object Object]",av=e=>er(e)&&e!=="NaN"&&e[0]!=="-"&&""+parseInt(e,10)===e,Gp=tv(",key,ref,ref_for,ref_key,onVnodeBeforeMount,onVnodeMounted,onVnodeBeforeUpdate,onVnodeUpdated,onVnodeBeforeUnmount,onVnodeUnmounted"),km=e=>{const s=Object.create(null);return u=>s[u]||(s[u]=e(u))},CM=/-(\w)/g,Ts=km(e=>e.replace(CM,(s,u)=>u?u.toUpperCase():"")),AM=/\B([A-Z])/g,Ou=km(e=>e.replace(AM,"-$1").toLowerCase()),Pm=km(e=>e.charAt(0).toUpperCase()+e.slice(1)),R_=km(e=>e?`on${Pm(e)}`:""),Id=(e,s)=>!Object.is(e,s),bd=(e,s)=>{for(let u=0;u<e.length;u++)e[u](s)},sm=(e,s,u)=>{Object.defineProperty(e,s,{configurable:!0,enumerable:!1,value:u})},hE=e=>{const s=parseFloat(e);return isNaN(s)?e:s};let kb;const MM=()=>kb||(kb=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{});let ys;class dE{constructor(s=!1){this.detached=s,this.active=!0,this.effects=[],this.cleanups=[],this.parent=ys,!s&&ys&&(this.index=(ys.scopes||(ys.scopes=[])).push(this)-1)}run(s){if(this.active){const u=ys;try{return ys=this,s()}finally{ys=u}}}on(){ys=this}off(){ys=this.parent}stop(s){if(this.active){let u,f;for(u=0,f=this.effects.length;u<f;u++)this.effects[u].stop();for(u=0,f=this.cleanups.length;u<f;u++)this.cleanups[u]();if(this.scopes)for(u=0,f=this.scopes.length;u<f;u++)this.scopes[u].stop(!0);if(!this.detached&&this.parent&&!s){const m=this.parent.scopes.pop();m&&m!==this&&(this.parent.scopes[this.index]=m,m.index=this.index)}this.parent=void 0,this.active=!1}}}function fE(e){return new dE(e)}function IM(e,s=ys){s&&s.active&&s.effects.push(e)}const lv=e=>{const s=new Set(e);return s.w=0,s.n=0,s},pE=e=>(e.w&Wa)>0,mE=e=>(e.n&Wa)>0,kM=({deps:e})=>{if(e.length)for(let s=0;s<e.length;s++)e[s].w|=Wa},PM=e=>{const{deps:s}=e;if(s.length){let u=0;for(let f=0;f<s.length;f++){const m=s[f];pE(m)&&!mE(m)?m.delete(e):s[u++]=m,m.w&=~Wa,m.n&=~Wa}s.length=u}},_y=new WeakMap;let yd=0,Wa=1;const yy=30;let Ko;const Kl=Symbol(""),vy=Symbol("");class cv{constructor(s,u=null,f){this.fn=s,this.scheduler=u,this.active=!0,this.deps=[],this.parent=void 0,IM(this,f)}run(){if(!this.active)return this.fn();let s=Ko,u=ja;for(;s;){if(s===this)return;s=s.parent}try{return this.parent=Ko,Ko=this,ja=!0,Wa=1<<++yd,yd<=yy?kM(this):Pb(this),this.fn()}finally{yd<=yy&&PM(this),Wa=1<<--yd,Ko=this.parent,ja=u,this.parent=void 0,this.deferStop&&this.stop()}}stop(){Ko===this?this.deferStop=!0:this.active&&(Pb(this),this.onStop&&this.onStop(),this.active=!1)}}function Pb(e){const{deps:s}=e;if(s.length){for(let u=0;u<s.length;u++)s[u].delete(e);s.length=0}}let ja=!0;const gE=[];function Bu(){gE.push(ja),ja=!1}function Fu(){const e=gE.pop();ja=e===void 0?!0:e}function po(e,s,u){if(ja&&Ko){let f=_y.get(e);f||_y.set(e,f=new Map);let m=f.get(u);m||f.set(u,m=lv()),_E(m)}}function _E(e,s){let u=!1;yd<=yy?mE(e)||(e.n|=Wa,u=!pE(e)):u=!e.has(Ko),u&&(e.add(Ko),Ko.deps.push(e))}function Ys(e,s,u,f,m,v){const b=_y.get(e);if(!b)return;let o=[];if(s==="clear")o=[...b.values()];else if(u==="length"&&Cn(e))b.forEach((S,k)=>{(k==="length"||k>=f)&&o.push(S)});else switch(u!==void 0&&o.push(b.get(u)),s){case"add":Cn(e)?av(u)&&o.push(b.get("length")):(o.push(b.get(Kl)),yu(e)&&o.push(b.get(vy)));break;case"delete":Cn(e)||(o.push(b.get(Kl)),yu(e)&&o.push(b.get(vy)));break;case"set":yu(e)&&o.push(b.get(Kl));break}if(o.length===1)o[0]&&xy(o[0]);else{const S=[];for(const k of o)k&&S.push(...k);xy(lv(S))}}function xy(e,s){const u=Cn(e)?e:[...e];for(const f of u)f.computed&&zb(f);for(const f of u)f.computed||zb(f)}function zb(e,s){(e!==Ko||e.allowRecurse)&&(e.scheduler?e.scheduler():e.run())}const zM=tv("__proto__,__v_isRef,__isVue"),yE=new Set(Object.getOwnPropertyNames(Symbol).filter(e=>e!=="arguments"&&e!=="caller").map(e=>Symbol[e]).filter(sv)),LM=uv(),RM=uv(!1,!0),DM=uv(!0),Lb=OM();function OM(){const e={};return["includes","indexOf","lastIndexOf"].forEach(s=>{e[s]=function(...u){const f=Tn(this);for(let v=0,b=this.length;v<b;v++)po(f,"get",v+"");const m=f[s](...u);return m===-1||m===!1?f[s](...u.map(Tn)):m}}),["push","pop","shift","unshift","splice"].forEach(s=>{e[s]=function(...u){Bu();const f=Tn(this)[s].apply(this,u);return Fu(),f}}),e}function uv(e=!1,s=!1){return function(f,m,v){if(m==="__v_isReactive")return!e;if(m==="__v_isReadonly")return e;if(m==="__v_isShallow")return s;if(m==="__v_raw"&&v===(e?s?QM:EE:s?wE:bE).get(f))return f;const b=Cn(f);if(!e&&b&&Jn(Lb,m))return Reflect.get(Lb,m,v);const o=Reflect.get(f,m,v);return(sv(m)?yE.has(m):zM(m))||(e||po(f,"get",m),s)?o:Vi(o)?b&&av(m)?o:o.value:Li(o)?e?TE(o):Lo(o):o}}const BM=vE(),FM=vE(!0);function vE(e=!1){return function(u,f,m,v){let b=u[f];if(Cu(b)&&Vi(b)&&!Vi(m))return!1;if(!e&&(!am(m)&&!Cu(m)&&(b=Tn(b),m=Tn(m)),!Cn(u)&&Vi(b)&&!Vi(m)))return b.value=m,!0;const o=Cn(u)&&av(f)?Number(f)<u.length:Jn(u,f),S=Reflect.set(u,f,m,v);return u===Tn(v)&&(o?Id(m,b)&&Ys(u,"set",f,m):Ys(u,"add",f,m)),S}}function NM(e,s){const u=Jn(e,s);e[s];const f=Reflect.deleteProperty(e,s);return f&&u&&Ys(e,"delete",s,void 0),f}function VM(e,s){const u=Reflect.has(e,s);return(!sv(s)||!yE.has(s))&&po(e,"has",s),u}function UM(e){return po(e,"iterate",Cn(e)?"length":Kl),Reflect.ownKeys(e)}const xE={get:LM,set:BM,deleteProperty:NM,has:VM,ownKeys:UM},jM={get:DM,set(e,s){return!0},deleteProperty(e,s){return!0}},qM=yr({},xE,{get:RM,set:FM}),hv=e=>e,zm=e=>Reflect.getPrototypeOf(e);function Ip(e,s,u=!1,f=!1){e=e.__v_raw;const m=Tn(e),v=Tn(s);u||(s!==v&&po(m,"get",s),po(m,"get",v));const{has:b}=zm(m),o=f?hv:u?pv:kd;if(b.call(m,s))return o(e.get(s));if(b.call(m,v))return o(e.get(v));e!==m&&e.get(s)}function kp(e,s=!1){const u=this.__v_raw,f=Tn(u),m=Tn(e);return s||(e!==m&&po(f,"has",e),po(f,"has",m)),e===m?u.has(e):u.has(e)||u.has(m)}function Pp(e,s=!1){return e=e.__v_raw,!s&&po(Tn(e),"iterate",Kl),Reflect.get(e,"size",e)}function Rb(e){e=Tn(e);const s=Tn(this);return zm(s).has.call(s,e)||(s.add(e),Ys(s,"add",e,e)),this}function Db(e,s){s=Tn(s);const u=Tn(this),{has:f,get:m}=zm(u);let v=f.call(u,e);v||(e=Tn(e),v=f.call(u,e));const b=m.call(u,e);return u.set(e,s),v?Id(s,b)&&Ys(u,"set",e,s):Ys(u,"add",e,s),this}function Ob(e){const s=Tn(this),{has:u,get:f}=zm(s);let m=u.call(s,e);m||(e=Tn(e),m=u.call(s,e)),f&&f.call(s,e);const v=s.delete(e);return m&&Ys(s,"delete",e,void 0),v}function Bb(){const e=Tn(this),s=e.size!==0,u=e.clear();return s&&Ys(e,"clear",void 0,void 0),u}function zp(e,s){return function(f,m){const v=this,b=v.__v_raw,o=Tn(b),S=s?hv:e?pv:kd;return!e&&po(o,"iterate",Kl),b.forEach((k,I)=>f.call(m,S(k),S(I),v))}}function Lp(e,s,u){return function(...f){const m=this.__v_raw,v=Tn(m),b=yu(v),o=e==="entries"||e===Symbol.iterator&&b,S=e==="keys"&&b,k=m[e](...f),I=u?hv:s?pv:kd;return!s&&po(v,"iterate",S?vy:Kl),{next(){const{value:L,done:D}=k.next();return D?{value:L,done:D}:{value:o?[I(L[0]),I(L[1])]:I(L),done:D}},[Symbol.iterator](){return this}}}}function Pa(e){return function(...s){return e==="delete"?!1:this}}function $M(){const e={get(v){return Ip(this,v)},get size(){return Pp(this)},has:kp,add:Rb,set:Db,delete:Ob,clear:Bb,forEach:zp(!1,!1)},s={get(v){return Ip(this,v,!1,!0)},get size(){return Pp(this)},has:kp,add:Rb,set:Db,delete:Ob,clear:Bb,forEach:zp(!1,!0)},u={get(v){return Ip(this,v,!0)},get size(){return Pp(this,!0)},has(v){return kp.call(this,v,!0)},add:Pa("add"),set:Pa("set"),delete:Pa("delete"),clear:Pa("clear"),forEach:zp(!0,!1)},f={get(v){return Ip(this,v,!0,!0)},get size(){return Pp(this,!0)},has(v){return kp.call(this,v,!0)},add:Pa("add"),set:Pa("set"),delete:Pa("delete"),clear:Pa("clear"),forEach:zp(!0,!0)};return["keys","values","entries",Symbol.iterator].forEach(v=>{e[v]=Lp(v,!1,!1),u[v]=Lp(v,!0,!1),s[v]=Lp(v,!1,!0),f[v]=Lp(v,!0,!0)}),[e,u,s,f]}const[GM,ZM,WM,HM]=$M();function dv(e,s){const u=s?e?HM:WM:e?ZM:GM;return(f,m,v)=>m==="__v_isReactive"?!e:m==="__v_isReadonly"?e:m==="__v_raw"?f:Reflect.get(Jn(u,m)&&m in f?u:f,m,v)}const XM={get:dv(!1,!1)},KM={get:dv(!1,!0)},YM={get:dv(!0,!1)},bE=new WeakMap,wE=new WeakMap,EE=new WeakMap,QM=new WeakMap;function JM(e){switch(e){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}function eI(e){return e.__v_skip||!Object.isExtensible(e)?0:JM(SM(e))}function Lo(e){return Cu(e)?e:fv(e,!1,xE,XM,bE)}function tI(e){return fv(e,!1,qM,KM,wE)}function TE(e){return fv(e,!0,jM,YM,EE)}function fv(e,s,u,f,m){if(!Li(e)||e.__v_raw&&!(s&&e.__v_isReactive))return e;const v=m.get(e);if(v)return v;const b=eI(e);if(b===0)return e;const o=new Proxy(e,b===2?f:u);return m.set(e,o),o}function qa(e){return Cu(e)?qa(e.__v_raw):!!(e&&e.__v_isReactive)}function Cu(e){return!!(e&&e.__v_isReadonly)}function am(e){return!!(e&&e.__v_isShallow)}function SE(e){return qa(e)||Cu(e)}function Tn(e){const s=e&&e.__v_raw;return s?Tn(s):e}function Qs(e){return sm(e,"__v_skip",!0),e}const kd=e=>Li(e)?Lo(e):e,pv=e=>Li(e)?TE(e):e;function CE(e){ja&&Ko&&(e=Tn(e),_E(e.dep||(e.dep=lv())))}function AE(e,s){e=Tn(e),e.dep&&xy(e.dep)}function Vi(e){return!!(e&&e.__v_isRef===!0)}function xt(e){return ME(e,!1)}function nI(e){return ME(e,!0)}function ME(e,s){return Vi(e)?e:new iI(e,s)}class iI{constructor(s,u){this.__v_isShallow=u,this.dep=void 0,this.__v_isRef=!0,this._rawValue=u?s:Tn(s),this._value=u?s:kd(s)}get value(){return CE(this),this._value}set value(s){const u=this.__v_isShallow||am(s)||Cu(s);s=u?s:Tn(s),Id(s,this._rawValue)&&(this._rawValue=s,this._value=u?s:kd(s),AE(this))}}function Bn(e){return Vi(e)?e.value:e}const rI={get:(e,s,u)=>Bn(Reflect.get(e,s,u)),set:(e,s,u,f)=>{const m=e[s];return Vi(m)&&!Vi(u)?(m.value=u,!0):Reflect.set(e,s,u,f)}};function IE(e){return qa(e)?e:new Proxy(e,rI)}function oI(e){const s=Cn(e)?new Array(e.length):{};for(const u in e)s[u]=aI(e,u);return s}class sI{constructor(s,u,f){this._object=s,this._key=u,this._defaultValue=f,this.__v_isRef=!0}get value(){const s=this._object[this._key];return s===void 0?this._defaultValue:s}set value(s){this._object[this._key]=s}}function aI(e,s,u){const f=e[s];return Vi(f)?f:new sI(e,s,u)}var kE;class lI{constructor(s,u,f,m){this._setter=u,this.dep=void 0,this.__v_isRef=!0,this[kE]=!1,this._dirty=!0,this.effect=new cv(s,()=>{this._dirty||(this._dirty=!0,AE(this))}),this.effect.computed=this,this.effect.active=this._cacheable=!m,this.__v_isReadonly=f}get value(){const s=Tn(this);return CE(s),(s._dirty||!s._cacheable)&&(s._dirty=!1,s._value=s.effect.run()),s._value}set value(s){this._setter(s)}}kE="__v_isReadonly";function cI(e,s,u=!1){let f,m;const v=Vn(e);return v?(f=e,m=es):(f=e.get,m=e.set),new lI(f,m,v||!m,u)}function $a(e,s,u,f){let m;try{m=f?e(...f):e()}catch(v){Lm(v,s,u)}return m}function Do(e,s,u,f){if(Vn(e)){const v=$a(e,s,u,f);return v&&lE(v)&&v.catch(b=>{Lm(b,s,u)}),v}const m=[];for(let v=0;v<e.length;v++)m.push(Do(e[v],s,u,f));return m}function Lm(e,s,u,f=!0){const m=s?s.vnode:null;if(s){let v=s.parent;const b=s.proxy,o=u;for(;v;){const k=v.ec;if(k){for(let I=0;I<k.length;I++)if(k[I](e,b,o)===!1)return}v=v.parent}const S=s.appContext.config.errorHandler;if(S){$a(S,null,10,[e,b,o]);return}}uI(e,u,m,f)}function uI(e,s,u,f=!0){console.error(e)}let Pd=!1,by=!1;const Fr=[];let xs=0;const vu=[];let Zs=null,Gl=0;const PE=Promise.resolve();let mv=null;function ui(e){const s=mv||PE;return e?s.then(this?e.bind(this):e):s}function hI(e){let s=xs+1,u=Fr.length;for(;s<u;){const f=s+u>>>1;zd(Fr[f])<e?s=f+1:u=f}return s}function gv(e){(!Fr.length||!Fr.includes(e,Pd&&e.allowRecurse?xs+1:xs))&&(e.id==null?Fr.push(e):Fr.splice(hI(e.id),0,e),zE())}function zE(){!Pd&&!by&&(by=!0,mv=PE.then(RE))}function dI(e){const s=Fr.indexOf(e);s>xs&&Fr.splice(s,1)}function fI(e){Cn(e)?vu.push(...e):(!Zs||!Zs.includes(e,e.allowRecurse?Gl+1:Gl))&&vu.push(e),zE()}function Fb(e,s=Pd?xs+1:0){for(;s<Fr.length;s++){const u=Fr[s];u&&u.pre&&(Fr.splice(s,1),s--,u())}}function LE(e){if(vu.length){const s=[...new Set(vu)];if(vu.length=0,Zs){Zs.push(...s);return}for(Zs=s,Zs.sort((u,f)=>zd(u)-zd(f)),Gl=0;Gl<Zs.length;Gl++)Zs[Gl]();Zs=null,Gl=0}}const zd=e=>e.id==null?1/0:e.id,pI=(e,s)=>{const u=zd(e)-zd(s);if(u===0){if(e.pre&&!s.pre)return-1;if(s.pre&&!e.pre)return 1}return u};function RE(e){by=!1,Pd=!0,Fr.sort(pI);const s=es;try{for(xs=0;xs<Fr.length;xs++){const u=Fr[xs];u&&u.active!==!1&&$a(u,null,14)}}finally{xs=0,Fr.length=0,LE(),Pd=!1,mv=null,(Fr.length||vu.length)&&RE()}}function mI(e,s,...u){if(e.isUnmounted)return;const f=e.vnode.props||Ai;let m=u;const v=s.startsWith("update:"),b=v&&s.slice(7);if(b&&b in f){const I=`${b==="modelValue"?"model":b}Modifiers`,{number:L,trim:D}=f[I]||Ai;D&&(m=u.map(N=>N.trim())),L&&(m=u.map(hE))}let o,S=f[o=R_(s)]||f[o=R_(Ts(s))];!S&&v&&(S=f[o=R_(Ou(s))]),S&&Do(S,e,6,m);const k=f[o+"Once"];if(k){if(!e.emitted)e.emitted={};else if(e.emitted[o])return;e.emitted[o]=!0,Do(k,e,6,m)}}function DE(e,s,u=!1){const f=s.emitsCache,m=f.get(e);if(m!==void 0)return m;const v=e.emits;let b={},o=!1;if(!Vn(e)){const S=k=>{const I=DE(k,s,!0);I&&(o=!0,yr(b,I))};!u&&s.mixins.length&&s.mixins.forEach(S),e.extends&&S(e.extends),e.mixins&&e.mixins.forEach(S)}return!v&&!o?(Li(e)&&f.set(e,null),null):(Cn(v)?v.forEach(S=>b[S]=null):yr(b,v),Li(e)&&f.set(e,b),b)}function Rm(e,s){return!e||!Mm(s)?!1:(s=s.slice(2).replace(/Once$/,""),Jn(e,s[0].toLowerCase()+s.slice(1))||Jn(e,Ou(s))||Jn(e,s))}let Vr=null,OE=null;function lm(e){const s=Vr;return Vr=e,OE=e&&e.type.__scopeId||null,s}function vn(e,s=Vr,u){if(!s||e._n)return e;const f=(...m)=>{f._d&&Kb(-1);const v=lm(s);let b;try{b=e(...m)}finally{lm(v),f._d&&Kb(1)}return b};return f._n=!0,f._c=!0,f._d=!0,f}function D_(e){const{type:s,vnode:u,proxy:f,withProxy:m,props:v,propsOptions:[b],slots:o,attrs:S,emit:k,render:I,renderCache:L,data:D,setupState:N,ctx:j,inheritAttrs:Z}=e;let K,fe;const te=lm(e);try{if(u.shapeFlag&4){const Ce=m||f;K=vs(I.call(Ce,Ce,L,v,N,D,j)),fe=S}else{const Ce=s;K=vs(Ce.length>1?Ce(v,{attrs:S,slots:o,emit:k}):Ce(v,null)),fe=s.props?S:gI(S)}}catch(Ce){Ed.length=0,Lm(Ce,e,1),K=Ut(Oo)}let ve=K;if(fe&&Z!==!1){const Ce=Object.keys(fe),{shapeFlag:ce}=ve;Ce.length&&ce&7&&(b&&Ce.some(rv)&&(fe=_I(fe,b)),ve=Js(ve,fe))}return u.dirs&&(ve=Js(ve),ve.dirs=ve.dirs?ve.dirs.concat(u.dirs):u.dirs),u.transition&&(ve.transition=u.transition),K=ve,lm(te),K}const gI=e=>{let s;for(const u in e)(u==="class"||u==="style"||Mm(u))&&((s||(s={}))[u]=e[u]);return s},_I=(e,s)=>{const u={};for(const f in e)(!rv(f)||!(f.slice(9)in s))&&(u[f]=e[f]);return u};function yI(e,s,u){const{props:f,children:m,component:v}=e,{props:b,children:o,patchFlag:S}=s,k=v.emitsOptions;if(s.dirs||s.transition)return!0;if(u&&S>=0){if(S&1024)return!0;if(S&16)return f?Nb(f,b,k):!!b;if(S&8){const I=s.dynamicProps;for(let L=0;L<I.length;L++){const D=I[L];if(b[D]!==f[D]&&!Rm(k,D))return!0}}}else return(m||o)&&(!o||!o.$stable)?!0:f===b?!1:f?b?Nb(f,b,k):!0:!!b;return!1}function Nb(e,s,u){const f=Object.keys(s);if(f.length!==Object.keys(e).length)return!0;for(let m=0;m<f.length;m++){const v=f[m];if(s[v]!==e[v]&&!Rm(u,v))return!0}return!1}function vI({vnode:e,parent:s},u){for(;s&&s.subTree===e;)(e=s.vnode).el=u,s=s.parent}const BE=e=>e.__isSuspense;function xI(e,s){s&&s.pendingBranch?Cn(e)?s.effects.push(...e):s.effects.push(e):fI(e)}function Yl(e,s){if(_r){let u=_r.provides;const f=_r.parent&&_r.parent.provides;f===u&&(u=_r.provides=Object.create(f)),u[e]=s}}function Ur(e,s,u=!1){const f=_r||Vr;if(f){const m=f.parent==null?f.vnode.appContext&&f.vnode.appContext.provides:f.parent.provides;if(m&&e in m)return m[e];if(arguments.length>1)return u&&Vn(s)?s.call(f.proxy):s}}const Vb={};function Ht(e,s,u){return FE(e,s,u)}function FE(e,s,{immediate:u,deep:f,flush:m,onTrack:v,onTrigger:b}=Ai){const o=_r;let S,k=!1,I=!1;if(Vi(e)?(S=()=>e.value,k=am(e)):qa(e)?(S=()=>e,f=!0):Cn(e)?(I=!0,k=e.some(fe=>qa(fe)||am(fe)),S=()=>e.map(fe=>{if(Vi(fe))return fe.value;if(qa(fe))return Hl(fe);if(Vn(fe))return $a(fe,o,2)})):Vn(e)?s?S=()=>$a(e,o,2):S=()=>{if(!(o&&o.isUnmounted))return L&&L(),Do(e,o,3,[D])}:S=es,s&&f){const fe=S;S=()=>Hl(fe())}let L,D=fe=>{L=K.onStop=()=>{$a(fe,o,4)}};if(Fd)return D=es,s?u&&Do(s,o,3,[S(),I?[]:void 0,D]):S(),es;let N=I?[]:Vb;const j=()=>{if(!!K.active)if(s){const fe=K.run();(f||k||(I?fe.some((te,ve)=>Id(te,N[ve])):Id(fe,N)))&&(L&&L(),Do(s,o,3,[fe,N===Vb?void 0:N,D]),N=fe)}else K.run()};j.allowRecurse=!!s;let Z;m==="sync"?Z=j:m==="post"?Z=()=>Cr(j,o&&o.suspense):(j.pre=!0,o&&(j.id=o.uid),Z=()=>gv(j));const K=new cv(S,Z);return s?u?j():N=K.run():m==="post"?Cr(K.run.bind(K),o&&o.suspense):K.run(),()=>{K.stop(),o&&o.scope&&ov(o.scope.effects,K)}}function bI(e,s,u){const f=this.proxy,m=er(e)?e.includes(".")?NE(f,e):()=>f[e]:e.bind(f,f);let v;Vn(s)?v=s:(v=s.handler,u=s);const b=_r;Iu(this);const o=FE(m,v.bind(f),u);return b?Iu(b):Jl(),o}function NE(e,s){const u=s.split(".");return()=>{let f=e;for(let m=0;m<u.length&&f;m++)f=f[u[m]];return f}}function Hl(e,s){if(!Li(e)||e.__v_skip||(s=s||new Set,s.has(e)))return e;if(s.add(e),Vi(e))Hl(e.value,s);else if(Cn(e))for(let u=0;u<e.length;u++)Hl(e[u],s);else if(aE(e)||yu(e))e.forEach(u=>{Hl(u,s)});else if(uE(e))for(const u in e)Hl(e[u],s);return e}function VE(){const e={isMounted:!1,isLeaving:!1,isUnmounting:!1,leavingVNodes:new Map};return Ui(()=>{e.isMounted=!0}),Ii(()=>{e.isUnmounting=!0}),e}const Io=[Function,Array],wI={name:"BaseTransition",props:{mode:String,appear:Boolean,persisted:Boolean,onBeforeEnter:Io,onEnter:Io,onAfterEnter:Io,onEnterCancelled:Io,onBeforeLeave:Io,onLeave:Io,onAfterLeave:Io,onLeaveCancelled:Io,onBeforeAppear:Io,onAppear:Io,onAfterAppear:Io,onAppearCancelled:Io},setup(e,{slots:s}){const u=In(),f=VE();let m;return()=>{const v=s.default&&_v(s.default(),!0);if(!v||!v.length)return;let b=v[0];if(v.length>1){for(const Z of v)if(Z.type!==Oo){b=Z;break}}const o=Tn(e),{mode:S}=o;if(f.isLeaving)return O_(b);const k=Ub(b);if(!k)return O_(b);const I=Ld(k,o,f,u);Au(k,I);const L=u.subTree,D=L&&Ub(L);let N=!1;const{getTransitionKey:j}=k.type;if(j){const Z=j();m===void 0?m=Z:Z!==m&&(m=Z,N=!0)}if(D&&D.type!==Oo&&(!Zl(k,D)||N)){const Z=Ld(D,o,f,u);if(Au(D,Z),S==="out-in")return f.isLeaving=!0,Z.afterLeave=()=>{f.isLeaving=!1,u.update()},O_(b);S==="in-out"&&k.type!==Oo&&(Z.delayLeave=(K,fe,te)=>{const ve=jE(f,D);ve[String(D.key)]=D,K._leaveCb=()=>{fe(),K._leaveCb=void 0,delete I.delayedLeave},I.delayedLeave=te})}return b}}},UE=wI;function jE(e,s){const{leavingVNodes:u}=e;let f=u.get(s.type);return f||(f=Object.create(null),u.set(s.type,f)),f}function Ld(e,s,u,f){const{appear:m,mode:v,persisted:b=!1,onBeforeEnter:o,onEnter:S,onAfterEnter:k,onEnterCancelled:I,onBeforeLeave:L,onLeave:D,onAfterLeave:N,onLeaveCancelled:j,onBeforeAppear:Z,onAppear:K,onAfterAppear:fe,onAppearCancelled:te}=s,ve=String(e.key),Ce=jE(u,e),ce=(Me,Ie)=>{Me&&Do(Me,f,9,Ie)},pe=(Me,Ie)=>{const ke=Ie[1];ce(Me,Ie),Cn(Me)?Me.every(Be=>Be.length<=1)&&ke():Me.length<=1&&ke()},Te={mode:v,persisted:b,beforeEnter(Me){let Ie=o;if(!u.isMounted)if(m)Ie=Z||o;else return;Me._leaveCb&&Me._leaveCb(!0);const ke=Ce[ve];ke&&Zl(e,ke)&&ke.el._leaveCb&&ke.el._leaveCb(),ce(Ie,[Me])},enter(Me){let Ie=S,ke=k,Be=I;if(!u.isMounted)if(m)Ie=K||S,ke=fe||k,Be=te||I;else return;let Re=!1;const Ze=Me._enterCb=Ye=>{Re||(Re=!0,Ye?ce(Be,[Me]):ce(ke,[Me]),Te.delayedLeave&&Te.delayedLeave(),Me._enterCb=void 0)};Ie?pe(Ie,[Me,Ze]):Ze()},leave(Me,Ie){const ke=String(e.key);if(Me._enterCb&&Me._enterCb(!0),u.isUnmounting)return Ie();ce(L,[Me]);let Be=!1;const Re=Me._leaveCb=Ze=>{Be||(Be=!0,Ie(),Ze?ce(j,[Me]):ce(N,[Me]),Me._leaveCb=void 0,Ce[ke]===e&&delete Ce[ke])};Ce[ke]=e,D?pe(D,[Me,Re]):Re()},clone(Me){return Ld(Me,s,u,f)}};return Te}function O_(e){if(Dm(e))return e=Js(e),e.children=null,e}function Ub(e){return Dm(e)?e.children?e.children[0]:void 0:e}function Au(e,s){e.shapeFlag&6&&e.component?Au(e.component.subTree,s):e.shapeFlag&128?(e.ssContent.transition=s.clone(e.ssContent),e.ssFallback.transition=s.clone(e.ssFallback)):e.transition=s}function _v(e,s=!1,u){let f=[],m=0;for(let v=0;v<e.length;v++){let b=e[v];const o=u==null?b.key:String(u)+String(b.key!=null?b.key:v);b.type===Ki?(b.patchFlag&128&&m++,f=f.concat(_v(b.children,s,o))):(s||b.type!==Oo)&&f.push(o!=null?Js(b,{key:o}):b)}if(m>1)for(let v=0;v<f.length;v++)f[v].patchFlag=-2;return f}function yv(e){return Vn(e)?{setup:e,name:e.name}:e}const xu=e=>!!e.type.__asyncLoader,Dm=e=>e.type.__isKeepAlive,EI={name:"KeepAlive",__isKeepAlive:!0,props:{include:[String,RegExp,Array],exclude:[String,RegExp,Array],max:[String,Number]},setup(e,{slots:s}){const u=In(),f=u.ctx;if(!f.renderer)return()=>{const te=s.default&&s.default();return te&&te.length===1?te[0]:te};const m=new Map,v=new Set;let b=null;const o=u.suspense,{renderer:{p:S,m:k,um:I,o:{createElement:L}}}=f,D=L("div");f.activate=(te,ve,Ce,ce,pe)=>{const Te=te.component;k(te,ve,Ce,0,o),S(Te.vnode,te,ve,Ce,Te,o,ce,te.slotScopeIds,pe),Cr(()=>{Te.isDeactivated=!1,Te.a&&bd(Te.a);const Me=te.props&&te.props.onVnodeMounted;Me&&Po(Me,Te.parent,te)},o)},f.deactivate=te=>{const ve=te.component;k(te,D,null,1,o),Cr(()=>{ve.da&&bd(ve.da);const Ce=te.props&&te.props.onVnodeUnmounted;Ce&&Po(Ce,ve.parent,te),ve.isDeactivated=!0},o)};function N(te){B_(te),I(te,u,o,!0)}function j(te){m.forEach((ve,Ce)=>{const ce=My(ve.type);ce&&(!te||!te(ce))&&Z(Ce)})}function Z(te){const ve=m.get(te);!b||ve.type!==b.type?N(ve):b&&B_(b),m.delete(te),v.delete(te)}Ht(()=>[e.include,e.exclude],([te,ve])=>{te&&j(Ce=>vd(te,Ce)),ve&&j(Ce=>!vd(ve,Ce))},{flush:"post",deep:!0});let K=null;const fe=()=>{K!=null&&m.set(K,F_(u.subTree))};return Ui(fe),Vm(fe),Ii(()=>{m.forEach(te=>{const{subTree:ve,suspense:Ce}=u,ce=F_(ve);if(te.type===ce.type){B_(ce);const pe=ce.component.da;pe&&Cr(pe,Ce);return}N(te)})}),()=>{if(K=null,!s.default)return null;const te=s.default(),ve=te[0];if(te.length>1)return b=null,te;if(!Od(ve)||!(ve.shapeFlag&4)&&!(ve.shapeFlag&128))return b=null,ve;let Ce=F_(ve);const ce=Ce.type,pe=My(xu(Ce)?Ce.type.__asyncResolved||{}:ce),{include:Te,exclude:Me,max:Ie}=e;if(Te&&(!pe||!vd(Te,pe))||Me&&pe&&vd(Me,pe))return b=Ce,ve;const ke=Ce.key==null?ce:Ce.key,Be=m.get(ke);return Ce.el&&(Ce=Js(Ce),ve.shapeFlag&128&&(ve.ssContent=Ce)),K=ke,Be?(Ce.el=Be.el,Ce.component=Be.component,Ce.transition&&Au(Ce,Ce.transition),Ce.shapeFlag|=512,v.delete(ke),v.add(ke)):(v.add(ke),Ie&&v.size>parseInt(Ie,10)&&Z(v.values().next().value)),Ce.shapeFlag|=256,b=Ce,BE(ve.type)?ve:Ce}}},TI=EI;function vd(e,s){return Cn(e)?e.some(u=>vd(u,s)):er(e)?e.split(",").includes(s):e.test?e.test(s):!1}function Om(e,s){qE(e,"a",s)}function Nu(e,s){qE(e,"da",s)}function qE(e,s,u=_r){const f=e.__wdc||(e.__wdc=()=>{let m=u;for(;m;){if(m.isDeactivated)return;m=m.parent}return e()});if(Bm(s,f,u),u){let m=u.parent;for(;m&&m.parent;)Dm(m.parent.vnode)&&SI(f,s,u,m),m=m.parent}}function SI(e,s,u,f){const m=Bm(s,e,f,!0);ia(()=>{ov(f[s],m)},u)}function B_(e){let s=e.shapeFlag;s&256&&(s-=256),s&512&&(s-=512),e.shapeFlag=s}function F_(e){return e.shapeFlag&128?e.ssContent:e}function Bm(e,s,u=_r,f=!1){if(u){const m=u[e]||(u[e]=[]),v=s.__weh||(s.__weh=(...b)=>{if(u.isUnmounted)return;Bu(),Iu(u);const o=Do(s,u,e,b);return Jl(),Fu(),o});return f?m.unshift(v):m.push(v),v}}const na=e=>(s,u=_r)=>(!Fd||e==="sp")&&Bm(e,(...f)=>s(...f),u),Fm=na("bm"),Ui=na("m"),Nm=na("bu"),Vm=na("u"),Ii=na("bum"),ia=na("um"),CI=na("sp"),AI=na("rtg"),MI=na("rtc");function II(e,s=_r){Bm("ec",e,s)}function Ql(e,s){const u=Vr;if(u===null)return e;const f=qm(u)||u.proxy,m=e.dirs||(e.dirs=[]);for(let v=0;v<s.length;v++){let[b,o,S,k=Ai]=s[v];Vn(b)&&(b={mounted:b,updated:b}),b.deep&&Hl(o),m.push({dir:b,instance:f,value:o,oldValue:void 0,arg:S,modifiers:k})}return e}function Nl(e,s,u,f){const m=e.dirs,v=s&&s.dirs;for(let b=0;b<m.length;b++){const o=m[b];v&&(o.oldValue=v[b].value);let S=o.dir[f];S&&(Bu(),Do(S,u,8,[e.el,o,e,s]),Fu())}}const $E="components";function kI(e,s){return zI($E,e,!0,s)||e}const PI=Symbol();function zI(e,s,u=!0,f=!1){const m=Vr||_r;if(m){const v=m.type;if(e===$E){const o=My(v,!1);if(o&&(o===s||o===Ts(s)||o===Pm(Ts(s))))return v}const b=jb(m[e]||v[e],s)||jb(m.appContext[e],s);return!b&&f?v:b}}function jb(e,s){return e&&(e[s]||e[Ts(s)]||e[Pm(Ts(s))])}function Mu(e,s,u,f){let m;const v=u&&u[f];if(Cn(e)||er(e)){m=new Array(e.length);for(let b=0,o=e.length;b<o;b++)m[b]=s(e[b],b,void 0,v&&v[b])}else if(typeof e=="number"){m=new Array(e);for(let b=0;b<e;b++)m[b]=s(b+1,b,void 0,v&&v[b])}else if(Li(e))if(e[Symbol.iterator])m=Array.from(e,(b,o)=>s(b,o,void 0,v&&v[o]));else{const b=Object.keys(e);m=new Array(b.length);for(let o=0,S=b.length;o<S;o++){const k=b[o];m[o]=s(e[k],k,o,v&&v[o])}}else m=[];return u&&(u[f]=m),m}function Rd(e,s,u={},f,m){if(Vr.isCE||Vr.parent&&xu(Vr.parent)&&Vr.parent.isCE)return Ut("slot",s==="default"?null:{name:s},f&&f());let v=e[s];v&&v._c&&(v._d=!1),Yn();const b=v&&GE(v(u)),o=Yi(Ki,{key:u.key||b&&b.key||`_${s}`},b||(f?f():[]),b&&e._===1?64:-2);return!m&&o.scopeId&&(o.slotScopeIds=[o.scopeId+"-s"]),v&&v._c&&(v._d=!0),o}function GE(e){return e.some(s=>Od(s)?!(s.type===Oo||s.type===Ki&&!GE(s.children)):!0)?e:null}const wy=e=>e?tT(e)?qm(e)||e.proxy:wy(e.parent):null,cm=yr(Object.create(null),{$:e=>e,$el:e=>e.vnode.el,$data:e=>e.data,$props:e=>e.props,$attrs:e=>e.attrs,$slots:e=>e.slots,$refs:e=>e.refs,$parent:e=>wy(e.parent),$root:e=>wy(e.root),$emit:e=>e.emit,$options:e=>vv(e),$forceUpdate:e=>e.f||(e.f=()=>gv(e.update)),$nextTick:e=>e.n||(e.n=ui.bind(e.proxy)),$watch:e=>bI.bind(e)}),LI={get({_:e},s){const{ctx:u,setupState:f,data:m,props:v,accessCache:b,type:o,appContext:S}=e;let k;if(s[0]!=="$"){const N=b[s];if(N!==void 0)switch(N){case 1:return f[s];case 2:return m[s];case 4:return u[s];case 3:return v[s]}else{if(f!==Ai&&Jn(f,s))return b[s]=1,f[s];if(m!==Ai&&Jn(m,s))return b[s]=2,m[s];if((k=e.propsOptions[0])&&Jn(k,s))return b[s]=3,v[s];if(u!==Ai&&Jn(u,s))return b[s]=4,u[s];Ey&&(b[s]=0)}}const I=cm[s];let L,D;if(I)return s==="$attrs"&&po(e,"get",s),I(e);if((L=o.__cssModules)&&(L=L[s]))return L;if(u!==Ai&&Jn(u,s))return b[s]=4,u[s];if(D=S.config.globalProperties,Jn(D,s))return D[s]},set({_:e},s,u){const{data:f,setupState:m,ctx:v}=e;return m!==Ai&&Jn(m,s)?(m[s]=u,!0):f!==Ai&&Jn(f,s)?(f[s]=u,!0):Jn(e.props,s)||s[0]==="$"&&s.slice(1)in e?!1:(v[s]=u,!0)},has({_:{data:e,setupState:s,accessCache:u,ctx:f,appContext:m,propsOptions:v}},b){let o;return!!u[b]||e!==Ai&&Jn(e,b)||s!==Ai&&Jn(s,b)||(o=v[0])&&Jn(o,b)||Jn(f,b)||Jn(cm,b)||Jn(m.config.globalProperties,b)},defineProperty(e,s,u){return u.get!=null?e._.accessCache[s]=0:Jn(u,"value")&&this.set(e,s,u.value,null),Reflect.defineProperty(e,s,u)}};let Ey=!0;function RI(e){const s=vv(e),u=e.proxy,f=e.ctx;Ey=!1,s.beforeCreate&&qb(s.beforeCreate,e,"bc");const{data:m,computed:v,methods:b,watch:o,provide:S,inject:k,created:I,beforeMount:L,mounted:D,beforeUpdate:N,updated:j,activated:Z,deactivated:K,beforeDestroy:fe,beforeUnmount:te,destroyed:ve,unmounted:Ce,render:ce,renderTracked:pe,renderTriggered:Te,errorCaptured:Me,serverPrefetch:Ie,expose:ke,inheritAttrs:Be,components:Re,directives:Ze,filters:Ye}=s;if(k&&DI(k,f,null,e.appContext.config.unwrapInjectedRef),b)for(const Ge in b){const At=b[Ge];Vn(At)&&(f[Ge]=At.bind(u))}if(m){const Ge=m.call(u,u);Li(Ge)&&(e.data=Lo(Ge))}if(Ey=!0,v)for(const Ge in v){const At=v[Ge],tn=Vn(At)?At.bind(u,u):Vn(At.get)?At.get.bind(u,u):es,Ve=!Vn(At)&&Vn(At.set)?At.set.bind(u):es,mt=se({get:tn,set:Ve});Object.defineProperty(f,Ge,{enumerable:!0,configurable:!0,get:()=>mt.value,set:Bt=>mt.value=Bt})}if(o)for(const Ge in o)ZE(o[Ge],f,u,Ge);if(S){const Ge=Vn(S)?S.call(u):S;Reflect.ownKeys(Ge).forEach(At=>{Yl(At,Ge[At])})}I&&qb(I,e,"c");function Xt(Ge,At){Cn(At)?At.forEach(tn=>Ge(tn.bind(u))):At&&Ge(At.bind(u))}if(Xt(Fm,L),Xt(Ui,D),Xt(Nm,N),Xt(Vm,j),Xt(Om,Z),Xt(Nu,K),Xt(II,Me),Xt(MI,pe),Xt(AI,Te),Xt(Ii,te),Xt(ia,Ce),Xt(CI,Ie),Cn(ke))if(ke.length){const Ge=e.exposed||(e.exposed={});ke.forEach(At=>{Object.defineProperty(Ge,At,{get:()=>u[At],set:tn=>u[At]=tn})})}else e.exposed||(e.exposed={});ce&&e.render===es&&(e.render=ce),Be!=null&&(e.inheritAttrs=Be),Re&&(e.components=Re),Ze&&(e.directives=Ze)}function DI(e,s,u=es,f=!1){Cn(e)&&(e=Ty(e));for(const m in e){const v=e[m];let b;Li(v)?"default"in v?b=Ur(v.from||m,v.default,!0):b=Ur(v.from||m):b=Ur(v),Vi(b)&&f?Object.defineProperty(s,m,{enumerable:!0,configurable:!0,get:()=>b.value,set:o=>b.value=o}):s[m]=b}}function qb(e,s,u){Do(Cn(e)?e.map(f=>f.bind(s.proxy)):e.bind(s.proxy),s,u)}function ZE(e,s,u,f){const m=f.includes(".")?NE(u,f):()=>u[f];if(er(e)){const v=s[e];Vn(v)&&Ht(m,v)}else if(Vn(e))Ht(m,e.bind(u));else if(Li(e))if(Cn(e))e.forEach(v=>ZE(v,s,u,f));else{const v=Vn(e.handler)?e.handler.bind(u):s[e.handler];Vn(v)&&Ht(m,v,e)}}function vv(e){const s=e.type,{mixins:u,extends:f}=s,{mixins:m,optionsCache:v,config:{optionMergeStrategies:b}}=e.appContext,o=v.get(s);let S;return o?S=o:!m.length&&!u&&!f?S=s:(S={},m.length&&m.forEach(k=>um(S,k,b,!0)),um(S,s,b)),Li(s)&&v.set(s,S),S}function um(e,s,u,f=!1){const{mixins:m,extends:v}=s;v&&um(e,v,u,!0),m&&m.forEach(b=>um(e,b,u,!0));for(const b in s)if(!(f&&b==="expose")){const o=OI[b]||u&&u[b];e[b]=o?o(e[b],s[b]):s[b]}return e}const OI={data:$b,props:ql,emits:ql,methods:ql,computed:ql,beforeCreate:Zr,created:Zr,beforeMount:Zr,mounted:Zr,beforeUpdate:Zr,updated:Zr,beforeDestroy:Zr,beforeUnmount:Zr,destroyed:Zr,unmounted:Zr,activated:Zr,deactivated:Zr,errorCaptured:Zr,serverPrefetch:Zr,components:ql,directives:ql,watch:FI,provide:$b,inject:BI};function $b(e,s){return s?e?function(){return yr(Vn(e)?e.call(this,this):e,Vn(s)?s.call(this,this):s)}:s:e}function BI(e,s){return ql(Ty(e),Ty(s))}function Ty(e){if(Cn(e)){const s={};for(let u=0;u<e.length;u++)s[e[u]]=e[u];return s}return e}function Zr(e,s){return e?[...new Set([].concat(e,s))]:s}function ql(e,s){return e?yr(yr(Object.create(null),e),s):s}function FI(e,s){if(!e)return s;if(!s)return e;const u=yr(Object.create(null),e);for(const f in s)u[f]=Zr(e[f],s[f]);return u}function NI(e,s,u,f=!1){const m={},v={};sm(v,Um,1),e.propsDefaults=Object.create(null),WE(e,s,m,v);for(const b in e.propsOptions[0])b in m||(m[b]=void 0);u?e.props=f?m:tI(m):e.type.props?e.props=m:e.props=v,e.attrs=v}function VI(e,s,u,f){const{props:m,attrs:v,vnode:{patchFlag:b}}=e,o=Tn(m),[S]=e.propsOptions;let k=!1;if((f||b>0)&&!(b&16)){if(b&8){const I=e.vnode.dynamicProps;for(let L=0;L<I.length;L++){let D=I[L];if(Rm(e.emitsOptions,D))continue;const N=s[D];if(S)if(Jn(v,D))N!==v[D]&&(v[D]=N,k=!0);else{const j=Ts(D);m[j]=Sy(S,o,j,N,e,!1)}else N!==v[D]&&(v[D]=N,k=!0)}}}else{WE(e,s,m,v)&&(k=!0);let I;for(const L in o)(!s||!Jn(s,L)&&((I=Ou(L))===L||!Jn(s,I)))&&(S?u&&(u[L]!==void 0||u[I]!==void 0)&&(m[L]=Sy(S,o,L,void 0,e,!0)):delete m[L]);if(v!==o)for(const L in v)(!s||!Jn(s,L)&&!0)&&(delete v[L],k=!0)}k&&Ys(e,"set","$attrs")}function WE(e,s,u,f){const[m,v]=e.propsOptions;let b=!1,o;if(s)for(let S in s){if(Gp(S))continue;const k=s[S];let I;m&&Jn(m,I=Ts(S))?!v||!v.includes(I)?u[I]=k:(o||(o={}))[I]=k:Rm(e.emitsOptions,S)||(!(S in f)||k!==f[S])&&(f[S]=k,b=!0)}if(v){const S=Tn(u),k=o||Ai;for(let I=0;I<v.length;I++){const L=v[I];u[L]=Sy(m,S,L,k[L],e,!Jn(k,L))}}return b}function Sy(e,s,u,f,m,v){const b=e[u];if(b!=null){const o=Jn(b,"default");if(o&&f===void 0){const S=b.default;if(b.type!==Function&&Vn(S)){const{propsDefaults:k}=m;u in k?f=k[u]:(Iu(m),f=k[u]=S.call(null,s),Jl())}else f=S}b[0]&&(v&&!o?f=!1:b[1]&&(f===""||f===Ou(u))&&(f=!0))}return f}function HE(e,s,u=!1){const f=s.propsCache,m=f.get(e);if(m)return m;const v=e.props,b={},o=[];let S=!1;if(!Vn(e)){const I=L=>{S=!0;const[D,N]=HE(L,s,!0);yr(b,D),N&&o.push(...N)};!u&&s.mixins.length&&s.mixins.forEach(I),e.extends&&I(e.extends),e.mixins&&e.mixins.forEach(I)}if(!v&&!S)return Li(e)&&f.set(e,_u),_u;if(Cn(v))for(let I=0;I<v.length;I++){const L=Ts(v[I]);Gb(L)&&(b[L]=Ai)}else if(v)for(const I in v){const L=Ts(I);if(Gb(L)){const D=v[I],N=b[L]=Cn(D)||Vn(D)?{type:D}:D;if(N){const j=Hb(Boolean,N.type),Z=Hb(String,N.type);N[0]=j>-1,N[1]=Z<0||j<Z,(j>-1||Jn(N,"default"))&&o.push(L)}}}const k=[b,o];return Li(e)&&f.set(e,k),k}function Gb(e){return e[0]!=="$"}function Zb(e){const s=e&&e.toString().match(/^\s*function (\w+)/);return s?s[1]:e===null?"null":""}function Wb(e,s){return Zb(e)===Zb(s)}function Hb(e,s){return Cn(s)?s.findIndex(u=>Wb(u,e)):Vn(s)&&Wb(s,e)?0:-1}const XE=e=>e[0]==="_"||e==="$stable",xv=e=>Cn(e)?e.map(vs):[vs(e)],UI=(e,s,u)=>{if(s._n)return s;const f=vn((...m)=>xv(s(...m)),u);return f._c=!1,f},KE=(e,s,u)=>{const f=e._ctx;for(const m in e){if(XE(m))continue;const v=e[m];if(Vn(v))s[m]=UI(m,v,f);else if(v!=null){const b=xv(v);s[m]=()=>b}}},YE=(e,s)=>{const u=xv(s);e.slots.default=()=>u},jI=(e,s)=>{if(e.vnode.shapeFlag&32){const u=s._;u?(e.slots=Tn(s),sm(s,"_",u)):KE(s,e.slots={})}else e.slots={},s&&YE(e,s);sm(e.slots,Um,1)},qI=(e,s,u)=>{const{vnode:f,slots:m}=e;let v=!0,b=Ai;if(f.shapeFlag&32){const o=s._;o?u&&o===1?v=!1:(yr(m,s),!u&&o===1&&delete m._):(v=!s.$stable,KE(s,m)),b=s}else s&&(YE(e,s),b={default:1});if(v)for(const o in m)!XE(o)&&!(o in b)&&delete m[o]};function QE(){return{app:null,config:{isNativeTag:wM,performance:!1,globalProperties:{},optionMergeStrategies:{},errorHandler:void 0,warnHandler:void 0,compilerOptions:{}},mixins:[],components:{},directives:{},provides:Object.create(null),optionsCache:new WeakMap,propsCache:new WeakMap,emitsCache:new WeakMap}}let $I=0;function GI(e,s){return function(f,m=null){Vn(f)||(f=Object.assign({},f)),m!=null&&!Li(m)&&(m=null);const v=QE(),b=new Set;let o=!1;const S=v.app={_uid:$I++,_component:f,_props:m,_container:null,_context:v,_instance:null,version:hk,get config(){return v.config},set config(k){},use(k,...I){return b.has(k)||(k&&Vn(k.install)?(b.add(k),k.install(S,...I)):Vn(k)&&(b.add(k),k(S,...I))),S},mixin(k){return v.mixins.includes(k)||v.mixins.push(k),S},component(k,I){return I?(v.components[k]=I,S):v.components[k]},directive(k,I){return I?(v.directives[k]=I,S):v.directives[k]},mount(k,I,L){if(!o){const D=Ut(f,m);return D.appContext=v,I&&s?s(D,k):e(D,k,L),o=!0,S._container=k,k.__vue_app__=S,qm(D.component)||D.component.proxy}},unmount(){o&&(e(null,S._container),delete S._container.__vue_app__)},provide(k,I){return v.provides[k]=I,S}};return S}}function Cy(e,s,u,f,m=!1){if(Cn(e)){e.forEach((D,N)=>Cy(D,s&&(Cn(s)?s[N]:s),u,f,m));return}if(xu(f)&&!m)return;const v=f.shapeFlag&4?qm(f.component)||f.component.proxy:f.el,b=m?null:v,{i:o,r:S}=e,k=s&&s.r,I=o.refs===Ai?o.refs={}:o.refs,L=o.setupState;if(k!=null&&k!==S&&(er(k)?(I[k]=null,Jn(L,k)&&(L[k]=null)):Vi(k)&&(k.value=null)),Vn(S))$a(S,o,12,[b,I]);else{const D=er(S),N=Vi(S);if(D||N){const j=()=>{if(e.f){const Z=D?Jn(L,S)?L[S]:I[S]:S.value;m?Cn(Z)&&ov(Z,v):Cn(Z)?Z.includes(v)||Z.push(v):D?(I[S]=[v],Jn(L,S)&&(L[S]=I[S])):(S.value=[v],e.k&&(I[e.k]=S.value))}else D?(I[S]=b,Jn(L,S)&&(L[S]=b)):N&&(S.value=b,e.k&&(I[e.k]=b))};b?(j.id=-1,Cr(j,u)):j()}}}const Cr=xI;function ZI(e){return WI(e)}function WI(e,s){const u=MM();u.__VUE__=!0;const{insert:f,remove:m,patchProp:v,createElement:b,createText:o,createComment:S,setText:k,setElementText:I,parentNode:L,nextSibling:D,setScopeId:N=es,insertStaticContent:j}=e,Z=(oe,be,Fe,nt=null,yt=null,zt=null,Nt=!1,kt=null,bt=!!be.dynamicChildren)=>{if(oe===be)return;oe&&!Zl(oe,be)&&(nt=ot(oe),Bt(oe,yt,zt,!0),oe=null),be.patchFlag===-2&&(bt=!1,be.dynamicChildren=null);const{type:Mt,ref:Wt,shapeFlag:et}=be;switch(Mt){case wv:K(oe,be,Fe,nt);break;case Oo:fe(oe,be,Fe,nt);break;case N_:oe==null&&te(be,Fe,nt,Nt);break;case Ki:Re(oe,be,Fe,nt,yt,zt,Nt,kt,bt);break;default:et&1?ce(oe,be,Fe,nt,yt,zt,Nt,kt,bt):et&6?Ze(oe,be,Fe,nt,yt,zt,Nt,kt,bt):(et&64||et&128)&&Mt.process(oe,be,Fe,nt,yt,zt,Nt,kt,bt,ft)}Wt!=null&&yt&&Cy(Wt,oe&&oe.ref,zt,be||oe,!be)},K=(oe,be,Fe,nt)=>{if(oe==null)f(be.el=o(be.children),Fe,nt);else{const yt=be.el=oe.el;be.children!==oe.children&&k(yt,be.children)}},fe=(oe,be,Fe,nt)=>{oe==null?f(be.el=S(be.children||""),Fe,nt):be.el=oe.el},te=(oe,be,Fe,nt)=>{[oe.el,oe.anchor]=j(oe.children,be,Fe,nt,oe.el,oe.anchor)},ve=({el:oe,anchor:be},Fe,nt)=>{let yt;for(;oe&&oe!==be;)yt=D(oe),f(oe,Fe,nt),oe=yt;f(be,Fe,nt)},Ce=({el:oe,anchor:be})=>{let Fe;for(;oe&&oe!==be;)Fe=D(oe),m(oe),oe=Fe;m(be)},ce=(oe,be,Fe,nt,yt,zt,Nt,kt,bt)=>{Nt=Nt||be.type==="svg",oe==null?pe(be,Fe,nt,yt,zt,Nt,kt,bt):Ie(oe,be,yt,zt,Nt,kt,bt)},pe=(oe,be,Fe,nt,yt,zt,Nt,kt)=>{let bt,Mt;const{type:Wt,props:et,shapeFlag:Rt,transition:nn,dirs:bn}=oe;if(bt=oe.el=b(oe.type,zt,et&&et.is,et),Rt&8?I(bt,oe.children):Rt&16&&Me(oe.children,bt,null,nt,yt,zt&&Wt!=="foreignObject",Nt,kt),bn&&Nl(oe,null,nt,"created"),et){for(const An in et)An!=="value"&&!Gp(An)&&v(bt,An,null,et[An],zt,oe.children,nt,yt,gt);"value"in et&&v(bt,"value",null,et.value),(Mt=et.onVnodeBeforeMount)&&Po(Mt,nt,oe)}Te(bt,oe,oe.scopeId,Nt,nt),bn&&Nl(oe,null,nt,"beforeMount");const Ln=(!yt||yt&&!yt.pendingBranch)&&nn&&!nn.persisted;Ln&&nn.beforeEnter(bt),f(bt,be,Fe),((Mt=et&&et.onVnodeMounted)||Ln||bn)&&Cr(()=>{Mt&&Po(Mt,nt,oe),Ln&&nn.enter(bt),bn&&Nl(oe,null,nt,"mounted")},yt)},Te=(oe,be,Fe,nt,yt)=>{if(Fe&&N(oe,Fe),nt)for(let zt=0;zt<nt.length;zt++)N(oe,nt[zt]);if(yt){let zt=yt.subTree;if(be===zt){const Nt=yt.vnode;Te(oe,Nt,Nt.scopeId,Nt.slotScopeIds,yt.parent)}}},Me=(oe,be,Fe,nt,yt,zt,Nt,kt,bt=0)=>{for(let Mt=bt;Mt<oe.length;Mt++){const Wt=oe[Mt]=kt?Ba(oe[Mt]):vs(oe[Mt]);Z(null,Wt,be,Fe,nt,yt,zt,Nt,kt)}},Ie=(oe,be,Fe,nt,yt,zt,Nt)=>{const kt=be.el=oe.el;let{patchFlag:bt,dynamicChildren:Mt,dirs:Wt}=be;bt|=oe.patchFlag&16;const et=oe.props||Ai,Rt=be.props||Ai;let nn;Fe&&Vl(Fe,!1),(nn=Rt.onVnodeBeforeUpdate)&&Po(nn,Fe,be,oe),Wt&&Nl(be,oe,Fe,"beforeUpdate"),Fe&&Vl(Fe,!0);const bn=yt&&be.type!=="foreignObject";if(Mt?ke(oe.dynamicChildren,Mt,kt,Fe,nt,bn,zt):Nt||At(oe,be,kt,null,Fe,nt,bn,zt,!1),bt>0){if(bt&16)Be(kt,be,et,Rt,Fe,nt,yt);else if(bt&2&&et.class!==Rt.class&&v(kt,"class",null,Rt.class,yt),bt&4&&v(kt,"style",et.style,Rt.style,yt),bt&8){const Ln=be.dynamicProps;for(let An=0;An<Ln.length;An++){const qn=Ln[An],Hn=et[qn],Bi=Rt[qn];(Bi!==Hn||qn==="value")&&v(kt,qn,Hn,Bi,yt,oe.children,Fe,nt,gt)}}bt&1&&oe.children!==be.children&&I(kt,be.children)}else!Nt&&Mt==null&&Be(kt,be,et,Rt,Fe,nt,yt);((nn=Rt.onVnodeUpdated)||Wt)&&Cr(()=>{nn&&Po(nn,Fe,be,oe),Wt&&Nl(be,oe,Fe,"updated")},nt)},ke=(oe,be,Fe,nt,yt,zt,Nt)=>{for(let kt=0;kt<be.length;kt++){const bt=oe[kt],Mt=be[kt],Wt=bt.el&&(bt.type===Ki||!Zl(bt,Mt)||bt.shapeFlag&70)?L(bt.el):Fe;Z(bt,Mt,Wt,null,nt,yt,zt,Nt,!0)}},Be=(oe,be,Fe,nt,yt,zt,Nt)=>{if(Fe!==nt){if(Fe!==Ai)for(const kt in Fe)!Gp(kt)&&!(kt in nt)&&v(oe,kt,Fe[kt],null,Nt,be.children,yt,zt,gt);for(const kt in nt){if(Gp(kt))continue;const bt=nt[kt],Mt=Fe[kt];bt!==Mt&&kt!=="value"&&v(oe,kt,Mt,bt,Nt,be.children,yt,zt,gt)}"value"in nt&&v(oe,"value",Fe.value,nt.value)}},Re=(oe,be,Fe,nt,yt,zt,Nt,kt,bt)=>{const Mt=be.el=oe?oe.el:o(""),Wt=be.anchor=oe?oe.anchor:o("");let{patchFlag:et,dynamicChildren:Rt,slotScopeIds:nn}=be;nn&&(kt=kt?kt.concat(nn):nn),oe==null?(f(Mt,Fe,nt),f(Wt,Fe,nt),Me(be.children,Fe,Wt,yt,zt,Nt,kt,bt)):et>0&&et&64&&Rt&&oe.dynamicChildren?(ke(oe.dynamicChildren,Rt,Fe,yt,zt,Nt,kt),(be.key!=null||yt&&be===yt.subTree)&&bv(oe,be,!0)):At(oe,be,Fe,Wt,yt,zt,Nt,kt,bt)},Ze=(oe,be,Fe,nt,yt,zt,Nt,kt,bt)=>{be.slotScopeIds=kt,oe==null?be.shapeFlag&512?yt.ctx.activate(be,Fe,nt,Nt,bt):Ye(be,Fe,nt,yt,zt,Nt,bt):lt(oe,be,bt)},Ye=(oe,be,Fe,nt,yt,zt,Nt)=>{const kt=oe.component=rk(oe,nt,yt);if(Dm(oe)&&(kt.ctx.renderer=ft),ok(kt),kt.asyncDep){if(yt&&yt.registerDep(kt,Xt),!oe.el){const bt=kt.subTree=Ut(Oo);fe(null,bt,be,Fe)}return}Xt(kt,oe,be,Fe,yt,zt,Nt)},lt=(oe,be,Fe)=>{const nt=be.component=oe.component;if(yI(oe,be,Fe))if(nt.asyncDep&&!nt.asyncResolved){Ge(nt,be,Fe);return}else nt.next=be,dI(nt.update),nt.update();else be.el=oe.el,nt.vnode=be},Xt=(oe,be,Fe,nt,yt,zt,Nt)=>{const kt=()=>{if(oe.isMounted){let{next:Wt,bu:et,u:Rt,parent:nn,vnode:bn}=oe,Ln=Wt,An;Vl(oe,!1),Wt?(Wt.el=bn.el,Ge(oe,Wt,Nt)):Wt=bn,et&&bd(et),(An=Wt.props&&Wt.props.onVnodeBeforeUpdate)&&Po(An,nn,Wt,bn),Vl(oe,!0);const qn=D_(oe),Hn=oe.subTree;oe.subTree=qn,Z(Hn,qn,L(Hn.el),ot(Hn),oe,yt,zt),Wt.el=qn.el,Ln===null&&vI(oe,qn.el),Rt&&Cr(Rt,yt),(An=Wt.props&&Wt.props.onVnodeUpdated)&&Cr(()=>Po(An,nn,Wt,bn),yt)}else{let Wt;const{el:et,props:Rt}=be,{bm:nn,m:bn,parent:Ln}=oe,An=xu(be);if(Vl(oe,!1),nn&&bd(nn),!An&&(Wt=Rt&&Rt.onVnodeBeforeMount)&&Po(Wt,Ln,be),Vl(oe,!0),et&&un){const qn=()=>{oe.subTree=D_(oe),un(et,oe.subTree,oe,yt,null)};An?be.type.__asyncLoader().then(()=>!oe.isUnmounted&&qn()):qn()}else{const qn=oe.subTree=D_(oe);Z(null,qn,Fe,nt,oe,yt,zt),be.el=qn.el}if(bn&&Cr(bn,yt),!An&&(Wt=Rt&&Rt.onVnodeMounted)){const qn=be;Cr(()=>Po(Wt,Ln,qn),yt)}(be.shapeFlag&256||Ln&&xu(Ln.vnode)&&Ln.vnode.shapeFlag&256)&&oe.a&&Cr(oe.a,yt),oe.isMounted=!0,be=Fe=nt=null}},bt=oe.effect=new cv(kt,()=>gv(Mt),oe.scope),Mt=oe.update=()=>bt.run();Mt.id=oe.uid,Vl(oe,!0),Mt()},Ge=(oe,be,Fe)=>{be.component=oe;const nt=oe.vnode.props;oe.vnode=be,oe.next=null,VI(oe,be.props,nt,Fe),qI(oe,be.children,Fe),Bu(),Fb(),Fu()},At=(oe,be,Fe,nt,yt,zt,Nt,kt,bt=!1)=>{const Mt=oe&&oe.children,Wt=oe?oe.shapeFlag:0,et=be.children,{patchFlag:Rt,shapeFlag:nn}=be;if(Rt>0){if(Rt&128){Ve(Mt,et,Fe,nt,yt,zt,Nt,kt,bt);return}else if(Rt&256){tn(Mt,et,Fe,nt,yt,zt,Nt,kt,bt);return}}nn&8?(Wt&16&&gt(Mt,yt,zt),et!==Mt&&I(Fe,et)):Wt&16?nn&16?Ve(Mt,et,Fe,nt,yt,zt,Nt,kt,bt):gt(Mt,yt,zt,!0):(Wt&8&&I(Fe,""),nn&16&&Me(et,Fe,nt,yt,zt,Nt,kt,bt))},tn=(oe,be,Fe,nt,yt,zt,Nt,kt,bt)=>{oe=oe||_u,be=be||_u;const Mt=oe.length,Wt=be.length,et=Math.min(Mt,Wt);let Rt;for(Rt=0;Rt<et;Rt++){const nn=be[Rt]=bt?Ba(be[Rt]):vs(be[Rt]);Z(oe[Rt],nn,Fe,null,yt,zt,Nt,kt,bt)}Mt>Wt?gt(oe,yt,zt,!0,!1,et):Me(be,Fe,nt,yt,zt,Nt,kt,bt,et)},Ve=(oe,be,Fe,nt,yt,zt,Nt,kt,bt)=>{let Mt=0;const Wt=be.length;let et=oe.length-1,Rt=Wt-1;for(;Mt<=et&&Mt<=Rt;){const nn=oe[Mt],bn=be[Mt]=bt?Ba(be[Mt]):vs(be[Mt]);if(Zl(nn,bn))Z(nn,bn,Fe,null,yt,zt,Nt,kt,bt);else break;Mt++}for(;Mt<=et&&Mt<=Rt;){const nn=oe[et],bn=be[Rt]=bt?Ba(be[Rt]):vs(be[Rt]);if(Zl(nn,bn))Z(nn,bn,Fe,null,yt,zt,Nt,kt,bt);else break;et--,Rt--}if(Mt>et){if(Mt<=Rt){const nn=Rt+1,bn=nn<Wt?be[nn].el:nt;for(;Mt<=Rt;)Z(null,be[Mt]=bt?Ba(be[Mt]):vs(be[Mt]),Fe,bn,yt,zt,Nt,kt,bt),Mt++}}else if(Mt>Rt)for(;Mt<=et;)Bt(oe[Mt],yt,zt,!0),Mt++;else{const nn=Mt,bn=Mt,Ln=new Map;for(Mt=bn;Mt<=Rt;Mt++){const Ei=be[Mt]=bt?Ba(be[Mt]):vs(be[Mt]);Ei.key!=null&&Ln.set(Ei.key,Mt)}let An,qn=0;const Hn=Rt-bn+1;let Bi=!1,ji=0;const qi=new Array(Hn);for(Mt=0;Mt<Hn;Mt++)qi[Mt]=0;for(Mt=nn;Mt<=et;Mt++){const Ei=oe[Mt];if(qn>=Hn){Bt(Ei,yt,zt,!0);continue}let $i;if(Ei.key!=null)$i=Ln.get(Ei.key);else for(An=bn;An<=Rt;An++)if(qi[An-bn]===0&&Zl(Ei,be[An])){$i=An;break}$i===void 0?Bt(Ei,yt,zt,!0):(qi[$i-bn]=Mt+1,$i>=ji?ji=$i:Bi=!0,Z(Ei,be[$i],Fe,null,yt,zt,Nt,kt,bt),qn++)}const tr=Bi?HI(qi):_u;for(An=tr.length-1,Mt=Hn-1;Mt>=0;Mt--){const Ei=bn+Mt,$i=be[Ei],hr=Ei+1<Wt?be[Ei+1].el:nt;qi[Mt]===0?Z(null,$i,Fe,hr,yt,zt,Nt,kt,bt):Bi&&(An<0||Mt!==tr[An]?mt($i,Fe,hr,2):An--)}}},mt=(oe,be,Fe,nt,yt=null)=>{const{el:zt,type:Nt,transition:kt,children:bt,shapeFlag:Mt}=oe;if(Mt&6){mt(oe.component.subTree,be,Fe,nt);return}if(Mt&128){oe.suspense.move(be,Fe,nt);return}if(Mt&64){Nt.move(oe,be,Fe,ft);return}if(Nt===Ki){f(zt,be,Fe);for(let et=0;et<bt.length;et++)mt(bt[et],be,Fe,nt);f(oe.anchor,be,Fe);return}if(Nt===N_){ve(oe,be,Fe);return}if(nt!==2&&Mt&1&&kt)if(nt===0)kt.beforeEnter(zt),f(zt,be,Fe),Cr(()=>kt.enter(zt),yt);else{const{leave:et,delayLeave:Rt,afterLeave:nn}=kt,bn=()=>f(zt,be,Fe),Ln=()=>{et(zt,()=>{bn(),nn&&nn()})};Rt?Rt(zt,bn,Ln):Ln()}else f(zt,be,Fe)},Bt=(oe,be,Fe,nt=!1,yt=!1)=>{const{type:zt,props:Nt,ref:kt,children:bt,dynamicChildren:Mt,shapeFlag:Wt,patchFlag:et,dirs:Rt}=oe;if(kt!=null&&Cy(kt,null,Fe,oe,!0),Wt&256){be.ctx.deactivate(oe);return}const nn=Wt&1&&Rt,bn=!xu(oe);let Ln;if(bn&&(Ln=Nt&&Nt.onVnodeBeforeUnmount)&&Po(Ln,be,oe),Wt&6)rt(oe.component,Fe,nt);else{if(Wt&128){oe.suspense.unmount(Fe,nt);return}nn&&Nl(oe,null,be,"beforeUnmount"),Wt&64?oe.type.remove(oe,be,Fe,yt,ft,nt):Mt&&(zt!==Ki||et>0&&et&64)?gt(Mt,be,Fe,!1,!0):(zt===Ki&&et&384||!yt&&Wt&16)&&gt(bt,be,Fe),nt&&jt(oe)}(bn&&(Ln=Nt&&Nt.onVnodeUnmounted)||nn)&&Cr(()=>{Ln&&Po(Ln,be,oe),nn&&Nl(oe,null,be,"unmounted")},Fe)},jt=oe=>{const{type:be,el:Fe,anchor:nt,transition:yt}=oe;if(be===Ki){xn(Fe,nt);return}if(be===N_){Ce(oe);return}const zt=()=>{m(Fe),yt&&!yt.persisted&&yt.afterLeave&&yt.afterLeave()};if(oe.shapeFlag&1&&yt&&!yt.persisted){const{leave:Nt,delayLeave:kt}=yt,bt=()=>Nt(Fe,zt);kt?kt(oe.el,zt,bt):bt()}else zt()},xn=(oe,be)=>{let Fe;for(;oe!==be;)Fe=D(oe),m(oe),oe=Fe;m(be)},rt=(oe,be,Fe)=>{const{bum:nt,scope:yt,update:zt,subTree:Nt,um:kt}=oe;nt&&bd(nt),yt.stop(),zt&&(zt.active=!1,Bt(Nt,oe,be,Fe)),kt&&Cr(kt,be),Cr(()=>{oe.isUnmounted=!0},be),be&&be.pendingBranch&&!be.isUnmounted&&oe.asyncDep&&!oe.asyncResolved&&oe.suspenseId===be.pendingId&&(be.deps--,be.deps===0&&be.resolve())},gt=(oe,be,Fe,nt=!1,yt=!1,zt=0)=>{for(let Nt=zt;Nt<oe.length;Nt++)Bt(oe[Nt],be,Fe,nt,yt)},ot=oe=>oe.shapeFlag&6?ot(oe.component.subTree):oe.shapeFlag&128?oe.suspense.next():D(oe.anchor||oe.el),_t=(oe,be,Fe)=>{oe==null?be._vnode&&Bt(be._vnode,null,null,!0):Z(be._vnode||null,oe,be,null,null,null,Fe),Fb(),LE(),be._vnode=oe},ft={p:Z,um:Bt,m:mt,r:jt,mt:Ye,mc:Me,pc:At,pbc:ke,n:ot,o:e};let sn,un;return s&&([sn,un]=s(ft)),{render:_t,hydrate:sn,createApp:GI(_t,sn)}}function Vl({effect:e,update:s},u){e.allowRecurse=s.allowRecurse=u}function bv(e,s,u=!1){const f=e.children,m=s.children;if(Cn(f)&&Cn(m))for(let v=0;v<f.length;v++){const b=f[v];let o=m[v];o.shapeFlag&1&&!o.dynamicChildren&&((o.patchFlag<=0||o.patchFlag===32)&&(o=m[v]=Ba(m[v]),o.el=b.el),u||bv(b,o))}}function HI(e){const s=e.slice(),u=[0];let f,m,v,b,o;const S=e.length;for(f=0;f<S;f++){const k=e[f];if(k!==0){if(m=u[u.length-1],e[m]<k){s[f]=m,u.push(f);continue}for(v=0,b=u.length-1;v<b;)o=v+b>>1,e[u[o]]<k?v=o+1:b=o;k<e[u[v]]&&(v>0&&(s[f]=u[v-1]),u[v]=f)}}for(v=u.length,b=u[v-1];v-- >0;)u[v]=b,b=s[b];return u}const XI=e=>e.__isTeleport,wd=e=>e&&(e.disabled||e.disabled===""),Xb=e=>typeof SVGElement<"u"&&e instanceof SVGElement,Ay=(e,s)=>{const u=e&&e.to;return er(u)?s?s(u):null:u},KI={__isTeleport:!0,process(e,s,u,f,m,v,b,o,S,k){const{mc:I,pc:L,pbc:D,o:{insert:N,querySelector:j,createText:Z,createComment:K}}=k,fe=wd(s.props);let{shapeFlag:te,children:ve,dynamicChildren:Ce}=s;if(e==null){const ce=s.el=Z(""),pe=s.anchor=Z("");N(ce,u,f),N(pe,u,f);const Te=s.target=Ay(s.props,j),Me=s.targetAnchor=Z("");Te&&(N(Me,Te),b=b||Xb(Te));const Ie=(ke,Be)=>{te&16&&I(ve,ke,Be,m,v,b,o,S)};fe?Ie(u,pe):Te&&Ie(Te,Me)}else{s.el=e.el;const ce=s.anchor=e.anchor,pe=s.target=e.target,Te=s.targetAnchor=e.targetAnchor,Me=wd(e.props),Ie=Me?u:pe,ke=Me?ce:Te;if(b=b||Xb(pe),Ce?(D(e.dynamicChildren,Ce,Ie,m,v,b,o),bv(e,s,!0)):S||L(e,s,Ie,ke,m,v,b,o,!1),fe)Me||Rp(s,u,ce,k,1);else if((s.props&&s.props.to)!==(e.props&&e.props.to)){const Be=s.target=Ay(s.props,j);Be&&Rp(s,Be,null,k,0)}else Me&&Rp(s,pe,Te,k,1)}},remove(e,s,u,f,{um:m,o:{remove:v}},b){const{shapeFlag:o,children:S,anchor:k,targetAnchor:I,target:L,props:D}=e;if(L&&v(I),(b||!wd(D))&&(v(k),o&16))for(let N=0;N<S.length;N++){const j=S[N];m(j,s,u,!0,!!j.dynamicChildren)}},move:Rp,hydrate:YI};function Rp(e,s,u,{o:{insert:f},m},v=2){v===0&&f(e.targetAnchor,s,u);const{el:b,anchor:o,shapeFlag:S,children:k,props:I}=e,L=v===2;if(L&&f(b,s,u),(!L||wd(I))&&S&16)for(let D=0;D<k.length;D++)m(k[D],s,u,2);L&&f(o,s,u)}function YI(e,s,u,f,m,v,{o:{nextSibling:b,parentNode:o,querySelector:S}},k){const I=s.target=Ay(s.props,S);if(I){const L=I._lpa||I.firstChild;if(s.shapeFlag&16)if(wd(s.props))s.anchor=k(b(e),s,o(e),u,f,m,v),s.targetAnchor=L;else{s.anchor=b(e);let D=L;for(;D;)if(D=b(D),D&&D.nodeType===8&&D.data==="teleport anchor"){s.targetAnchor=D,I._lpa=s.targetAnchor&&b(s.targetAnchor);break}k(L,s,I,u,f,m,v)}}return s.anchor&&b(s.anchor)}const QI=KI,Ki=Symbol(void 0),wv=Symbol(void 0),Oo=Symbol(void 0),N_=Symbol(void 0),Ed=[];let Yo=null;function Yn(e=!1){Ed.push(Yo=e?null:[])}function JI(){Ed.pop(),Yo=Ed[Ed.length-1]||null}let Dd=1;function Kb(e){Dd+=e}function JE(e){return e.dynamicChildren=Dd>0?Yo||_u:null,JI(),Dd>0&&Yo&&Yo.push(e),e}function no(e,s,u,f,m,v){return JE(Ar(e,s,u,f,m,v,!0))}function Yi(e,s,u,f,m){return JE(Ut(e,s,u,f,m,!0))}function Od(e){return e?e.__v_isVNode===!0:!1}function Zl(e,s){return e.type===s.type&&e.key===s.key}const Um="__vInternal",eT=({key:e})=>e!=null?e:null,Zp=({ref:e,ref_key:s,ref_for:u})=>e!=null?er(e)||Vi(e)||Vn(e)?{i:Vr,r:e,k:s,f:!!u}:e:null;function Ar(e,s=null,u=null,f=0,m=null,v=e===Ki?0:1,b=!1,o=!1){const S={__v_isVNode:!0,__v_skip:!0,type:e,props:s,key:s&&eT(s),ref:s&&Zp(s),scopeId:OE,slotScopeIds:null,children:u,component:null,suspense:null,ssContent:null,ssFallback:null,dirs:null,transition:null,el:null,anchor:null,target:null,targetAnchor:null,staticCount:0,shapeFlag:v,patchFlag:f,dynamicProps:m,dynamicChildren:null,appContext:null};return o?(Ev(S,u),v&128&&e.normalize(S)):u&&(S.shapeFlag|=er(u)?8:16),Dd>0&&!b&&Yo&&(S.patchFlag>0||v&6)&&S.patchFlag!==32&&Yo.push(S),S}const Ut=ek;function ek(e,s=null,u=null,f=0,m=null,v=!1){if((!e||e===PI)&&(e=Oo),Od(e)){const o=Js(e,s,!0);return u&&Ev(o,u),Dd>0&&!v&&Yo&&(o.shapeFlag&6?Yo[Yo.indexOf(e)]=o:Yo.push(o)),o.patchFlag|=-2,o}if(lk(e)&&(e=e.__vccOpts),s){s=tk(s);let{class:o,style:S}=s;o&&!er(o)&&(s.class=iv(o)),Li(S)&&(SE(S)&&!Cn(S)&&(S=yr({},S)),s.style=nv(S))}const b=er(e)?1:BE(e)?128:XI(e)?64:Li(e)?4:Vn(e)?2:0;return Ar(e,s,u,f,m,b,v,!0)}function tk(e){return e?SE(e)||Um in e?yr({},e):e:null}function Js(e,s,u=!1){const{props:f,ref:m,patchFlag:v,children:b}=e,o=s?jm(f||{},s):f;return{__v_isVNode:!0,__v_skip:!0,type:e.type,props:o,key:o&&eT(o),ref:s&&s.ref?u&&m?Cn(m)?m.concat(Zp(s)):[m,Zp(s)]:Zp(s):m,scopeId:e.scopeId,slotScopeIds:e.slotScopeIds,children:b,target:e.target,targetAnchor:e.targetAnchor,staticCount:e.staticCount,shapeFlag:e.shapeFlag,patchFlag:s&&e.type!==Ki?v===-1?16:v|16:v,dynamicProps:e.dynamicProps,dynamicChildren:e.dynamicChildren,appContext:e.appContext,dirs:e.dirs,transition:e.transition,component:e.component,suspense:e.suspense,ssContent:e.ssContent&&Js(e.ssContent),ssFallback:e.ssFallback&&Js(e.ssFallback),el:e.el,anchor:e.anchor}}function Bd(e=" ",s=0){return Ut(wv,null,e,s)}function Es(e="",s=!1){return s?(Yn(),Yi(Oo,null,e)):Ut(Oo,null,e)}function vs(e){return e==null||typeof e=="boolean"?Ut(Oo):Cn(e)?Ut(Ki,null,e.slice()):typeof e=="object"?Ba(e):Ut(wv,null,String(e))}function Ba(e){return e.el===null&&e.patchFlag!==-1||e.memo?e:Js(e)}function Ev(e,s){let u=0;const{shapeFlag:f}=e;if(s==null)s=null;else if(Cn(s))u=16;else if(typeof s=="object")if(f&65){const m=s.default;m&&(m._c&&(m._d=!1),Ev(e,m()),m._c&&(m._d=!0));return}else{u=32;const m=s._;!m&&!(Um in s)?s._ctx=Vr:m===3&&Vr&&(Vr.slots._===1?s._=1:(s._=2,e.patchFlag|=1024))}else Vn(s)?(s={default:s,_ctx:Vr},u=32):(s=String(s),f&64?(u=16,s=[Bd(s)]):u=8);e.children=s,e.shapeFlag|=u}function jm(...e){const s={};for(let u=0;u<e.length;u++){const f=e[u];for(const m in f)if(m==="class")s.class!==f.class&&(s.class=iv([s.class,f.class]));else if(m==="style")s.style=nv([s.style,f.style]);else if(Mm(m)){const v=s[m],b=f[m];b&&v!==b&&!(Cn(v)&&v.includes(b))&&(s[m]=v?[].concat(v,b):b)}else m!==""&&(s[m]=f[m])}return s}function Po(e,s,u,f=null){Do(e,s,7,[u,f])}const nk=QE();let ik=0;function rk(e,s,u){const f=e.type,m=(s?s.appContext:e.appContext)||nk,v={uid:ik++,vnode:e,type:f,parent:s,appContext:m,root:null,next:null,subTree:null,effect:null,update:null,scope:new dE(!0),render:null,proxy:null,exposed:null,exposeProxy:null,withProxy:null,provides:s?s.provides:Object.create(m.provides),accessCache:null,renderCache:[],components:null,directives:null,propsOptions:HE(f,m),emitsOptions:DE(f,m),emit:null,emitted:null,propsDefaults:Ai,inheritAttrs:f.inheritAttrs,ctx:Ai,data:Ai,props:Ai,attrs:Ai,slots:Ai,refs:Ai,setupState:Ai,setupContext:null,suspense:u,suspenseId:u?u.pendingId:0,asyncDep:null,asyncResolved:!1,isMounted:!1,isUnmounted:!1,isDeactivated:!1,bc:null,c:null,bm:null,m:null,bu:null,u:null,um:null,bum:null,da:null,a:null,rtg:null,rtc:null,ec:null,sp:null};return v.ctx={_:v},v.root=s?s.root:v,v.emit=mI.bind(null,v),e.ce&&e.ce(v),v}let _r=null;const In=()=>_r||Vr,Iu=e=>{_r=e,e.scope.on()},Jl=()=>{_r&&_r.scope.off(),_r=null};function tT(e){return e.vnode.shapeFlag&4}let Fd=!1;function ok(e,s=!1){Fd=s;const{props:u,children:f}=e.vnode,m=tT(e);NI(e,u,m,s),jI(e,f);const v=m?sk(e,s):void 0;return Fd=!1,v}function sk(e,s){const u=e.type;e.accessCache=Object.create(null),e.proxy=Qs(new Proxy(e.ctx,LI));const{setup:f}=u;if(f){const m=e.setupContext=f.length>1?iT(e):null;Iu(e),Bu();const v=$a(f,e,0,[e.props,m]);if(Fu(),Jl(),lE(v)){if(v.then(Jl,Jl),s)return v.then(b=>{Yb(e,b,s)}).catch(b=>{Lm(b,e,0)});e.asyncDep=v}else Yb(e,v,s)}else nT(e,s)}function Yb(e,s,u){Vn(s)?e.type.__ssrInlineRender?e.ssrRender=s:e.render=s:Li(s)&&(e.setupState=IE(s)),nT(e,u)}let Qb;function nT(e,s,u){const f=e.type;if(!e.render){if(!s&&Qb&&!f.render){const m=f.template||vv(e).template;if(m){const{isCustomElement:v,compilerOptions:b}=e.appContext.config,{delimiters:o,compilerOptions:S}=f,k=yr(yr({isCustomElement:v,delimiters:o},b),S);f.render=Qb(m,k)}}e.render=f.render||es}Iu(e),Bu(),RI(e),Fu(),Jl()}function ak(e){return new Proxy(e.attrs,{get(s,u){return po(e,"get","$attrs"),s[u]}})}function iT(e){const s=f=>{e.exposed=f||{}};let u;return{get attrs(){return u||(u=ak(e))},slots:e.slots,emit:e.emit,expose:s}}function qm(e){if(e.exposed)return e.exposeProxy||(e.exposeProxy=new Proxy(IE(Qs(e.exposed)),{get(s,u){if(u in s)return s[u];if(u in cm)return cm[u](e)}}))}function My(e,s=!0){return Vn(e)?e.displayName||e.name:e.name||s&&e.__name}function lk(e){return Vn(e)&&"__vccOpts"in e}const se=(e,s)=>cI(e,s,Fd);function ck(){return rT().slots}function uk(){return rT().attrs}function rT(){const e=In();return e.setupContext||(e.setupContext=iT(e))}function me(e,s,u){const f=arguments.length;return f===2?Li(s)&&!Cn(s)?Od(s)?Ut(e,null,[s]):Ut(e,s):Ut(e,null,s):(f>3?u=Array.prototype.slice.call(arguments,2):f===3&&Od(u)&&(u=[u]),Ut(e,s,u))}const hk="3.2.41",dk="http://www.w3.org/2000/svg",Wl=typeof document<"u"?document:null,Jb=Wl&&Wl.createElement("template"),fk={insert:(e,s,u)=>{s.insertBefore(e,u||null)},remove:e=>{const s=e.parentNode;s&&s.removeChild(e)},createElement:(e,s,u,f)=>{const m=s?Wl.createElementNS(dk,e):Wl.createElement(e,u?{is:u}:void 0);return e==="select"&&f&&f.multiple!=null&&m.setAttribute("multiple",f.multiple),m},createText:e=>Wl.createTextNode(e),createComment:e=>Wl.createComment(e),setText:(e,s)=>{e.nodeValue=s},setElementText:(e,s)=>{e.textContent=s},parentNode:e=>e.parentNode,nextSibling:e=>e.nextSibling,querySelector:e=>Wl.querySelector(e),setScopeId(e,s){e.setAttribute(s,"")},insertStaticContent(e,s,u,f,m,v){const b=u?u.previousSibling:s.lastChild;if(m&&(m===v||m.nextSibling))for(;s.insertBefore(m.cloneNode(!0),u),!(m===v||!(m=m.nextSibling)););else{Jb.innerHTML=f?`<svg>${e}</svg>`:e;const o=Jb.content;if(f){const S=o.firstChild;for(;S.firstChild;)o.appendChild(S.firstChild);o.removeChild(S)}s.insertBefore(o,u)}return[b?b.nextSibling:s.firstChild,u?u.previousSibling:s.lastChild]}};function pk(e,s,u){const f=e._vtc;f&&(s=(s?[s,...f]:[...f]).join(" ")),s==null?e.removeAttribute("class"):u?e.setAttribute("class",s):e.className=s}function mk(e,s,u){const f=e.style,m=er(u);if(u&&!m){for(const v in u)Iy(f,v,u[v]);if(s&&!er(s))for(const v in s)u[v]==null&&Iy(f,v,"")}else{const v=f.display;m?s!==u&&(f.cssText=u):s&&e.removeAttribute("style"),"_vod"in e&&(f.display=v)}}const e1=/\s*!important$/;function Iy(e,s,u){if(Cn(u))u.forEach(f=>Iy(e,s,f));else if(u==null&&(u=""),s.startsWith("--"))e.setProperty(s,u);else{const f=gk(e,s);e1.test(u)?e.setProperty(Ou(f),u.replace(e1,""),"important"):e[f]=u}}const t1=["Webkit","Moz","ms"],V_={};function gk(e,s){const u=V_[s];if(u)return u;let f=Ts(s);if(f!=="filter"&&f in e)return V_[s]=f;f=Pm(f);for(let m=0;m<t1.length;m++){const v=t1[m]+f;if(v in e)return V_[s]=v}return s}const n1="http://www.w3.org/1999/xlink";function _k(e,s,u,f,m){if(f&&s.startsWith("xlink:"))u==null?e.removeAttributeNS(n1,s.slice(6,s.length)):e.setAttributeNS(n1,s,u);else{const v=yM(s);u==null||v&&!oE(u)?e.removeAttribute(s):e.setAttribute(s,v?"":u)}}function yk(e,s,u,f,m,v,b){if(s==="innerHTML"||s==="textContent"){f&&b(f,m,v),e[s]=u==null?"":u;return}if(s==="value"&&e.tagName!=="PROGRESS"&&!e.tagName.includes("-")){e._value=u;const S=u==null?"":u;(e.value!==S||e.tagName==="OPTION")&&(e.value=S),u==null&&e.removeAttribute(s);return}let o=!1;if(u===""||u==null){const S=typeof e[s];S==="boolean"?u=oE(u):u==null&&S==="string"?(u="",o=!0):S==="number"&&(u=0,o=!0)}try{e[s]=u}catch{}o&&e.removeAttribute(s)}function vk(e,s,u,f){e.addEventListener(s,u,f)}function xk(e,s,u,f){e.removeEventListener(s,u,f)}function bk(e,s,u,f,m=null){const v=e._vei||(e._vei={}),b=v[s];if(f&&b)b.value=f;else{const[o,S]=wk(s);if(f){const k=v[s]=Sk(f,m);vk(e,o,k,S)}else b&&(xk(e,o,b,S),v[s]=void 0)}}const i1=/(?:Once|Passive|Capture)$/;function wk(e){let s;if(i1.test(e)){s={};let f;for(;f=e.match(i1);)e=e.slice(0,e.length-f[0].length),s[f[0].toLowerCase()]=!0}return[e[2]===":"?e.slice(3):Ou(e.slice(2)),s]}let U_=0;const Ek=Promise.resolve(),Tk=()=>U_||(Ek.then(()=>U_=0),U_=Date.now());function Sk(e,s){const u=f=>{if(!f._vts)f._vts=Date.now();else if(f._vts<=u.attached)return;Do(Ck(f,u.value),s,5,[f])};return u.value=e,u.attached=Tk(),u}function Ck(e,s){if(Cn(s)){const u=e.stopImmediatePropagation;return e.stopImmediatePropagation=()=>{u.call(e),e._stopped=!0},s.map(f=>m=>!m._stopped&&f&&f(m))}else return s}const r1=/^on[a-z]/,Ak=(e,s,u,f,m=!1,v,b,o,S)=>{s==="class"?pk(e,f,m):s==="style"?mk(e,u,f):Mm(s)?rv(s)||bk(e,s,u,f,b):(s[0]==="."?(s=s.slice(1),!0):s[0]==="^"?(s=s.slice(1),!1):Mk(e,s,f,m))?yk(e,s,f,v,b,o,S):(s==="true-value"?e._trueValue=f:s==="false-value"&&(e._falseValue=f),_k(e,s,f,m))};function Mk(e,s,u,f){return f?!!(s==="innerHTML"||s==="textContent"||s in e&&r1.test(s)&&Vn(u)):s==="spellcheck"||s==="draggable"||s==="translate"||s==="form"||s==="list"&&e.tagName==="INPUT"||s==="type"&&e.tagName==="TEXTAREA"||r1.test(s)&&er(u)?!1:s in e}const za="transition",hd="animation",ea=(e,{slots:s})=>me(UE,sT(e),s);ea.displayName="Transition";const oT={name:String,type:String,css:{type:Boolean,default:!0},duration:[String,Number,Object],enterFromClass:String,enterActiveClass:String,enterToClass:String,appearFromClass:String,appearActiveClass:String,appearToClass:String,leaveFromClass:String,leaveActiveClass:String,leaveToClass:String},Ik=ea.props=yr({},UE.props,oT),Ul=(e,s=[])=>{Cn(e)?e.forEach(u=>u(...s)):e&&e(...s)},o1=e=>e?Cn(e)?e.some(s=>s.length>1):e.length>1:!1;function sT(e){const s={};for(const Re in e)Re in oT||(s[Re]=e[Re]);if(e.css===!1)return s;const{name:u="v",type:f,duration:m,enterFromClass:v=`${u}-enter-from`,enterActiveClass:b=`${u}-enter-active`,enterToClass:o=`${u}-enter-to`,appearFromClass:S=v,appearActiveClass:k=b,appearToClass:I=o,leaveFromClass:L=`${u}-leave-from`,leaveActiveClass:D=`${u}-leave-active`,leaveToClass:N=`${u}-leave-to`}=e,j=kk(m),Z=j&&j[0],K=j&&j[1],{onBeforeEnter:fe,onEnter:te,onEnterCancelled:ve,onLeave:Ce,onLeaveCancelled:ce,onBeforeAppear:pe=fe,onAppear:Te=te,onAppearCancelled:Me=ve}=s,Ie=(Re,Ze,Ye)=>{Oa(Re,Ze?I:o),Oa(Re,Ze?k:b),Ye&&Ye()},ke=(Re,Ze)=>{Re._isLeaving=!1,Oa(Re,L),Oa(Re,N),Oa(Re,D),Ze&&Ze()},Be=Re=>(Ze,Ye)=>{const lt=Re?Te:te,Xt=()=>Ie(Ze,Re,Ye);Ul(lt,[Ze,Xt]),s1(()=>{Oa(Ze,Re?S:v),Gs(Ze,Re?I:o),o1(lt)||a1(Ze,f,Z,Xt)})};return yr(s,{onBeforeEnter(Re){Ul(fe,[Re]),Gs(Re,v),Gs(Re,b)},onBeforeAppear(Re){Ul(pe,[Re]),Gs(Re,S),Gs(Re,k)},onEnter:Be(!1),onAppear:Be(!0),onLeave(Re,Ze){Re._isLeaving=!0;const Ye=()=>ke(Re,Ze);Gs(Re,L),lT(),Gs(Re,D),s1(()=>{!Re._isLeaving||(Oa(Re,L),Gs(Re,N),o1(Ce)||a1(Re,f,K,Ye))}),Ul(Ce,[Re,Ye])},onEnterCancelled(Re){Ie(Re,!1),Ul(ve,[Re])},onAppearCancelled(Re){Ie(Re,!0),Ul(Me,[Re])},onLeaveCancelled(Re){ke(Re),Ul(ce,[Re])}})}function kk(e){if(e==null)return null;if(Li(e))return[j_(e.enter),j_(e.leave)];{const s=j_(e);return[s,s]}}function j_(e){return hE(e)}function Gs(e,s){s.split(/\s+/).forEach(u=>u&&e.classList.add(u)),(e._vtc||(e._vtc=new Set)).add(s)}function Oa(e,s){s.split(/\s+/).forEach(f=>f&&e.classList.remove(f));const{_vtc:u}=e;u&&(u.delete(s),u.size||(e._vtc=void 0))}function s1(e){requestAnimationFrame(()=>{requestAnimationFrame(e)})}let Pk=0;function a1(e,s,u,f){const m=e._endId=++Pk,v=()=>{m===e._endId&&f()};if(u)return setTimeout(v,u);const{type:b,timeout:o,propCount:S}=aT(e,s);if(!b)return f();const k=b+"end";let I=0;const L=()=>{e.removeEventListener(k,D),v()},D=N=>{N.target===e&&++I>=S&&L()};setTimeout(()=>{I<S&&L()},o+1),e.addEventListener(k,D)}function aT(e,s){const u=window.getComputedStyle(e),f=j=>(u[j]||"").split(", "),m=f(za+"Delay"),v=f(za+"Duration"),b=l1(m,v),o=f(hd+"Delay"),S=f(hd+"Duration"),k=l1(o,S);let I=null,L=0,D=0;s===za?b>0&&(I=za,L=b,D=v.length):s===hd?k>0&&(I=hd,L=k,D=S.length):(L=Math.max(b,k),I=L>0?b>k?za:hd:null,D=I?I===za?v.length:S.length:0);const N=I===za&&/\b(transform|all)(,|$)/.test(u[za+"Property"]);return{type:I,timeout:L,propCount:D,hasTransform:N}}function l1(e,s){for(;e.length<s.length;)e=e.concat(e);return Math.max(...s.map((u,f)=>c1(u)+c1(e[f])))}function c1(e){return Number(e.slice(0,-1).replace(",","."))*1e3}function lT(){return document.body.offsetHeight}const cT=new WeakMap,uT=new WeakMap,zk={name:"TransitionGroup",props:yr({},Ik,{tag:String,moveClass:String}),setup(e,{slots:s}){const u=In(),f=VE();let m,v;return Vm(()=>{if(!m.length)return;const b=e.moveClass||`${e.name||"v"}-move`;if(!Bk(m[0].el,u.vnode.el,b))return;m.forEach(Rk),m.forEach(Dk);const o=m.filter(Ok);lT(),o.forEach(S=>{const k=S.el,I=k.style;Gs(k,b),I.transform=I.webkitTransform=I.transitionDuration="";const L=k._moveCb=D=>{D&&D.target!==k||(!D||/transform$/.test(D.propertyName))&&(k.removeEventListener("transitionend",L),k._moveCb=null,Oa(k,b))};k.addEventListener("transitionend",L)})}),()=>{const b=Tn(e),o=sT(b);let S=b.tag||Ki;m=v,v=s.default?_v(s.default()):[];for(let k=0;k<v.length;k++){const I=v[k];I.key!=null&&Au(I,Ld(I,o,f,u))}if(m)for(let k=0;k<m.length;k++){const I=m[k];Au(I,Ld(I,o,f,u)),cT.set(I,I.el.getBoundingClientRect())}return Ut(S,null,v)}}},Lk=zk;function Rk(e){const s=e.el;s._moveCb&&s._moveCb(),s._enterCb&&s._enterCb()}function Dk(e){uT.set(e,e.el.getBoundingClientRect())}function Ok(e){const s=cT.get(e),u=uT.get(e),f=s.left-u.left,m=s.top-u.top;if(f||m){const v=e.el.style;return v.transform=v.webkitTransform=`translate(${f}px,${m}px)`,v.transitionDuration="0s",e}}function Bk(e,s,u){const f=e.cloneNode();e._vtc&&e._vtc.forEach(b=>{b.split(/\s+/).forEach(o=>o&&f.classList.remove(o))}),u.split(/\s+/).forEach(b=>b&&f.classList.add(b)),f.style.display="none";const m=s.nodeType===1?s:s.parentNode;m.appendChild(f);const{hasTransform:v}=aT(f);return m.removeChild(f),v}const Fk=yr({patchProp:Ak},fk);let u1;function Nk(){return u1||(u1=ZI(Fk))}const hT=(...e)=>{const s=Nk().createApp(...e),{mount:u}=s;return s.mount=f=>{const m=Vk(f);if(!m)return;const v=s._component;!Vn(v)&&!v.render&&!v.template&&(v.template=m.innerHTML),m.innerHTML="";const b=u(m,!1,m instanceof SVGElement);return m instanceof Element&&(m.removeAttribute("v-cloak"),m.setAttribute("data-v-app","")),b},s};function Vk(e){return er(e)?document.querySelector(e):e}function bs(e,s,u,f){return Object.defineProperty(e,s,{get:u,set:f,enumerable:!0}),e}function Uk(e,s){for(const u in s)bs(e,u,s[u]);return e}const Ss=xt(!1);let $m;function jk(e,s){const u=/(edg|edge|edga|edgios)\/([\w.]+)/.exec(e)||/(opr)[\/]([\w.]+)/.exec(e)||/(vivaldi)[\/]([\w.]+)/.exec(e)||/(chrome|crios)[\/]([\w.]+)/.exec(e)||/(version)(applewebkit)[\/]([\w.]+).*(safari)[\/]([\w.]+)/.exec(e)||/(webkit)[\/]([\w.]+).*(version)[\/]([\w.]+).*(safari)[\/]([\w.]+)/.exec(e)||/(firefox|fxios)[\/]([\w.]+)/.exec(e)||/(webkit)[\/]([\w.]+)/.exec(e)||/(opera)(?:.*version|)[\/]([\w.]+)/.exec(e)||[];return{browser:u[5]||u[3]||u[1]||"",version:u[2]||u[4]||"0",versionNumber:u[4]||u[2]||"0",platform:s[0]||""}}function qk(e){return/(ipad)/.exec(e)||/(ipod)/.exec(e)||/(windows phone)/.exec(e)||/(iphone)/.exec(e)||/(kindle)/.exec(e)||/(silk)/.exec(e)||/(android)/.exec(e)||/(win)/.exec(e)||/(mac)/.exec(e)||/(linux)/.exec(e)||/(cros)/.exec(e)||/(playbook)/.exec(e)||/(bb)/.exec(e)||/(blackberry)/.exec(e)||[]}const dT="ontouchstart"in window||window.navigator.maxTouchPoints>0;function $k(e){$m={is:{...e}},delete e.mac,delete e.desktop;const s=Math.min(window.innerHeight,window.innerWidth)>414?"ipad":"iphone";Object.assign(e,{mobile:!0,ios:!0,platform:s,[s]:!0})}function Gk(e){const s=e.toLowerCase(),u=qk(s),f=jk(s,u),m={};f.browser&&(m[f.browser]=!0,m.version=f.version,m.versionNumber=parseInt(f.versionNumber,10)),f.platform&&(m[f.platform]=!0);const v=m.android||m.ios||m.bb||m.blackberry||m.ipad||m.iphone||m.ipod||m.kindle||m.playbook||m.silk||m["windows phone"];return v===!0||s.indexOf("mobile")>-1?(m.mobile=!0,m.edga||m.edgios?(m.edge=!0,f.browser="edge"):m.crios?(m.chrome=!0,f.browser="chrome"):m.fxios&&(m.firefox=!0,f.browser="firefox")):m.desktop=!0,(m.ipod||m.ipad||m.iphone)&&(m.ios=!0),m["windows phone"]&&(m.winphone=!0,delete m["windows phone"]),(m.chrome||m.opr||m.safari||m.vivaldi||m.mobile===!0&&m.ios!==!0&&v!==!0)&&(m.webkit=!0),m.edg&&(f.browser="edgechromium",m.edgeChromium=!0),(m.safari&&m.blackberry||m.bb)&&(f.browser="blackberry",m.blackberry=!0),m.safari&&m.playbook&&(f.browser="playbook",m.playbook=!0),m.opr&&(f.browser="opera",m.opera=!0),m.safari&&m.android&&(f.browser="android",m.android=!0),m.safari&&m.kindle&&(f.browser="kindle",m.kindle=!0),m.safari&&m.silk&&(f.browser="silk",m.silk=!0),m.vivaldi&&(f.browser="vivaldi",m.vivaldi=!0),m.name=f.browser,m.platform=f.platform,s.indexOf("electron")>-1?m.electron=!0:document.location.href.indexOf("-extension://")>-1?m.bex=!0:(window.Capacitor!==void 0?(m.capacitor=!0,m.nativeMobile=!0,m.nativeMobileWrapper="capacitor"):(window._cordovaNative!==void 0||window.cordova!==void 0)&&(m.cordova=!0,m.nativeMobile=!0,m.nativeMobileWrapper="cordova"),dT===!0&&m.mac===!0&&(m.desktop===!0&&m.safari===!0||m.nativeMobile===!0&&m.android!==!0&&m.ios!==!0&&m.ipad!==!0)&&$k(m)),m}const h1=navigator.userAgent||navigator.vendor||window.opera,Zk={has:{touch:!1,webStorage:!1},within:{iframe:!1}},hi={userAgent:h1,is:Gk(h1),has:{touch:dT},within:{iframe:window.self!==window.top}},hm={install(e){const{$q:s}=e;Ss.value===!0?(e.onSSRHydrated.push(()=>{Ss.value=!1,Object.assign(s.platform,hi),$m=void 0}),s.platform=Lo(this)):s.platform=this}};{let e;bs(hi.has,"webStorage",()=>{if(e!==void 0)return e;try{if(window.localStorage)return e=!0,!0}catch{}return e=!1,!1}),hi.is.ios===!0&&window.navigator.vendor.toLowerCase().indexOf("apple"),Ss.value===!0?Object.assign(hm,hi,$m,Zk):Object.assign(hm,hi)}const Gm=(e,s)=>{const u=Lo(e);for(const f in e)bs(s,f,()=>u[f],m=>{u[f]=m});return s},Xi={hasPassive:!1,passiveCapture:!0,notPassiveCapture:!0};try{const e=Object.defineProperty({},"passive",{get(){Object.assign(Xi,{hasPassive:!0,passive:{passive:!0},notPassive:{passive:!1},passiveCapture:{passive:!0,capture:!0},notPassiveCapture:{passive:!1,capture:!0}})}});window.addEventListener("qtest",null,e),window.removeEventListener("qtest",null,e)}catch{}function Cs(){}function fT(e){return e.button===0}function ic(e){return e.touches&&e.touches[0]?e=e.touches[0]:e.changedTouches&&e.changedTouches[0]?e=e.changedTouches[0]:e.targetTouches&&e.targetTouches[0]&&(e=e.targetTouches[0]),{top:e.clientY,left:e.clientX}}function Wk(e){if(e.path)return e.path;if(e.composedPath)return e.composedPath();const s=[];let u=e.target;for(;u;){if(s.push(u),u.tagName==="HTML")return s.push(document),s.push(window),s;u=u.parentElement}}function to(e){e.stopPropagation()}function Nr(e){e.cancelable!==!1&&e.preventDefault()}function zi(e){e.cancelable!==!1&&e.preventDefault(),e.stopPropagation()}function bu(e,s){if(e===void 0||s===!0&&e.__dragPrevented===!0)return;const u=s===!0?f=>{f.__dragPrevented=!0,f.addEventListener("dragstart",Nr,Xi.notPassiveCapture)}:f=>{delete f.__dragPrevented,f.removeEventListener("dragstart",Nr,Xi.notPassiveCapture)};e.querySelectorAll("a, img").forEach(u)}function Qo(e,s,u){const f=`__q_${s}_evt`;e[f]=e[f]!==void 0?e[f].concat(u):u,u.forEach(m=>{m[0].addEventListener(m[1],e[m[2]],Xi[m[3]])})}function Ga(e,s){const u=`__q_${s}_evt`;e[u]!==void 0&&(e[u].forEach(f=>{f[0].removeEventListener(f[1],e[f[2]],Xi[f[3]])}),e[u]=void 0)}function Tv(e,s=250,u){let f;function m(){const v=arguments,b=()=>{f=void 0,u!==!0&&e.apply(this,v)};clearTimeout(f),u===!0&&f===void 0&&e.apply(this,v),f=setTimeout(b,s)}return m.cancel=()=>{clearTimeout(f)},m}const q_=["sm","md","lg","xl"],{passive:d1}=Xi,Hk=Gm({width:0,height:0,name:"xs",sizes:{sm:600,md:1024,lg:1440,xl:1920},lt:{sm:!0,md:!0,lg:!0,xl:!0},gt:{xs:!1,sm:!1,md:!1,lg:!1},xs:!0,sm:!1,md:!1,lg:!1,xl:!1},{setSizes:Cs,setDebounce:Cs,install({$q:e,onSSRHydrated:s}){if(e.screen=this,this.__installed===!0){e.config.screen!==void 0&&(e.config.screen.bodyClasses===!1?document.body.classList.remove(`screen--${this.name}`):this.__update(!0));return}const{visualViewport:u}=window,f=u||window,m=document.scrollingElement||document.documentElement,v=u===void 0||hi.is.mobile===!0?()=>[Math.max(window.innerWidth,m.clientWidth),Math.max(window.innerHeight,m.clientHeight)]:()=>[u.width*u.scale+window.innerWidth-m.clientWidth,u.height*u.scale+window.innerHeight-m.clientHeight],b=e.config.screen!==void 0&&e.config.screen.bodyClasses===!0;this.__update=L=>{const[D,N]=v();if(N!==this.height&&(this.height=N),D!==this.width)this.width=D;else if(L!==!0)return;let j=this.sizes;this.gt.xs=D>=j.sm,this.gt.sm=D>=j.md,this.gt.md=D>=j.lg,this.gt.lg=D>=j.xl,this.lt.sm=D<j.sm,this.lt.md=D<j.md,this.lt.lg=D<j.lg,this.lt.xl=D<j.xl,this.xs=this.lt.sm,this.sm=this.gt.xs===!0&&this.lt.md===!0,this.md=this.gt.sm===!0&&this.lt.lg===!0,this.lg=this.gt.md===!0&&this.lt.xl===!0,this.xl=this.gt.lg,j=this.xs===!0&&"xs"||this.sm===!0&&"sm"||this.md===!0&&"md"||this.lg===!0&&"lg"||"xl",j!==this.name&&(b===!0&&(document.body.classList.remove(`screen--${this.name}`),document.body.classList.add(`screen--${j}`)),this.name=j)};let o,S={},k=16;this.setSizes=L=>{q_.forEach(D=>{L[D]!==void 0&&(S[D]=L[D])})},this.setDebounce=L=>{k=L};const I=()=>{const L=getComputedStyle(document.body);L.getPropertyValue("--q-size-sm")&&q_.forEach(D=>{this.sizes[D]=parseInt(L.getPropertyValue(`--q-size-${D}`),10)}),this.setSizes=D=>{q_.forEach(N=>{D[N]&&(this.sizes[N]=D[N])}),this.__update(!0)},this.setDebounce=D=>{o!==void 0&&f.removeEventListener("resize",o,d1),o=D>0?Tv(this.__update,D):this.__update,f.addEventListener("resize",o,d1)},this.setDebounce(k),Object.keys(S).length>0?(this.setSizes(S),S=void 0):this.__update(),b===!0&&this.name==="xs"&&document.body.classList.add("screen--xs")};Ss.value===!0?s.push(I):I()}}),Br=Gm({isActive:!1,mode:!1},{__media:void 0,set(e){Br.mode=e,e==="auto"?(Br.__media===void 0&&(Br.__media=window.matchMedia("(prefers-color-scheme: dark)"),Br.__updateMedia=()=>{Br.set("auto")},Br.__media.addListener(Br.__updateMedia)),e=Br.__media.matches):Br.__media!==void 0&&(Br.__media.removeListener(Br.__updateMedia),Br.__media=void 0),Br.isActive=e===!0,document.body.classList.remove(`body--${e===!0?"light":"dark"}`),document.body.classList.add(`body--${e===!0?"dark":"light"}`)},toggle(){Br.set(Br.isActive===!1)},install({$q:e,onSSRHydrated:s,ssrContext:u}){const{dark:f}=e.config;if(e.dark=this,this.__installed===!0&&f===void 0)return;this.isActive=f===!0;const m=f!==void 0?f:!1;if(Ss.value===!0){const v=o=>{this.__fromSSR=o},b=this.set;this.set=v,v(m),s.push(()=>{this.set=b,this.set(this.__fromSSR)})}else this.set(m)}}),pT=()=>!0;function Xk(e){return typeof e=="string"&&e!==""&&e!=="/"&&e!=="#/"}function Kk(e){return e.startsWith("#")===!0&&(e=e.substring(1)),e.startsWith("/")===!1&&(e="/"+e),e.endsWith("/")===!0&&(e=e.substring(0,e.length-1)),"#"+e}function Yk(e){if(e.backButtonExit===!1)return()=>!1;if(e.backButtonExit==="*")return pT;const s=["#/"];return Array.isArray(e.backButtonExit)===!0&&s.push(...e.backButtonExit.filter(Xk).map(Kk)),()=>s.includes(window.location.hash)}const Nd={__history:[],add:Cs,remove:Cs,install({$q:e}){if(this.__installed===!0)return;const{cordova:s,capacitor:u}=hi.is;if(s!==!0&&u!==!0)return;const f=e.config[s===!0?"cordova":"capacitor"];if(f!==void 0&&f.backButton===!1||u===!0&&(window.Capacitor===void 0||window.Capacitor.Plugins.App===void 0))return;this.add=b=>{b.condition===void 0&&(b.condition=pT),this.__history.push(b)},this.remove=b=>{const o=this.__history.indexOf(b);o>=0&&this.__history.splice(o,1)};const m=Yk(Object.assign({backButtonExit:!0},f)),v=()=>{if(this.__history.length){const b=this.__history[this.__history.length-1];b.condition()===!0&&(this.__history.pop(),b.handler())}else m()===!0?navigator.app.exitApp():window.history.back()};s===!0?document.addEventListener("deviceready",()=>{document.addEventListener("backbutton",v,!1)}):window.Capacitor.Plugins.App.addListener("backButton",v)}},f1={isoName:"en-US",nativeName:"English (US)",label:{clear:"Clear",ok:"OK",cancel:"Cancel",close:"Close",set:"Set",select:"Select",reset:"Reset",remove:"Remove",update:"Update",create:"Create",search:"Search",filter:"Filter",refresh:"Refresh",expand:e=>e?`Expand "${e}"`:"Expand",collapse:e=>e?`Collapse "${e}"`:"Collapse"},date:{days:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),daysShort:"Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),monthsShort:"Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_"),firstDayOfWeek:0,format24h:!1,pluralDay:"days"},table:{noData:"No data available",noResults:"No matching records found",loading:"Loading...",selectedRecords:e=>e===1?"1 record selected.":(e===0?"No":e)+" records selected.",recordsPerPage:"Records per page:",allRows:"All",pagination:(e,s,u)=>e+"-"+s+" of "+u,columns:"Columns"},editor:{url:"URL",bold:"Bold",italic:"Italic",strikethrough:"Strikethrough",underline:"Underline",unorderedList:"Unordered List",orderedList:"Ordered List",subscript:"Subscript",superscript:"Superscript",hyperlink:"Hyperlink",toggleFullscreen:"Toggle Fullscreen",quote:"Quote",left:"Left align",center:"Center align",right:"Right align",justify:"Justify align",print:"Print",outdent:"Decrease indentation",indent:"Increase indentation",removeFormat:"Remove formatting",formatting:"Formatting",fontSize:"Font Size",align:"Align",hr:"Insert Horizontal Rule",undo:"Undo",redo:"Redo",heading1:"Heading 1",heading2:"Heading 2",heading3:"Heading 3",heading4:"Heading 4",heading5:"Heading 5",heading6:"Heading 6",paragraph:"Paragraph",code:"Code",size1:"Very small",size2:"A bit small",size3:"Normal",size4:"Medium-large",size5:"Big",size6:"Very big",size7:"Maximum",defaultFont:"Default Font",viewSource:"View Source"},tree:{noNodes:"No nodes available",noResults:"No matching nodes found"}};function p1(){const e=Array.isArray(navigator.languages)===!0&&navigator.languages.length>0?navigator.languages[0]:navigator.language;if(typeof e=="string")return e.split(/[-_]/).map((s,u)=>u===0?s.toLowerCase():u>1||s.length<4?s.toUpperCase():s[0].toUpperCase()+s.slice(1).toLowerCase()).join("-")}const Fa=Gm({__langPack:{}},{getLocale:p1,set(e=f1,s){const u={...e,rtl:e.rtl===!0,getLocale:p1};{const f=document.documentElement;f.setAttribute("dir",u.rtl===!0?"rtl":"ltr"),f.setAttribute("lang",u.isoName),u.set=Fa.set,Object.assign(Fa.__langPack,u),Fa.props=u,Fa.isoName=u.isoName,Fa.nativeName=u.nativeName}},install({$q:e,lang:s,ssrContext:u}){e.lang=Fa.__langPack,this.__installed===!0?s!==void 0&&this.set(s):this.set(s||f1)}});function Qk(e,s,u=document.body){if(typeof e!="string")throw new TypeError("Expected a string as propName");if(typeof s!="string")throw new TypeError("Expected a string as value");if(!(u instanceof Element))throw new TypeError("Expected a DOM element");u.style.setProperty(`--q-${e}`,s)}let mT=!1;function Jk(e){mT=e.isComposing===!0}function Sv(e){return mT===!0||e!==Object(e)||e.isComposing===!0||e.qKeyEvent===!0}function Ha(e,s){return Sv(e)===!0?!1:[].concat(s).includes(e.keyCode)}function eP(e){if(e.ios===!0)return"ios";if(e.android===!0)return"android"}function tP({is:e,has:s,within:u},f){const m=[e.desktop===!0?"desktop":"mobile",`${s.touch===!1?"no-":""}touch`];if(e.mobile===!0){const v=eP(e);v!==void 0&&m.push("platform-"+v)}if(e.nativeMobile===!0){const v=e.nativeMobileWrapper;m.push(v),m.push("native-mobile"),e.ios===!0&&(f[v]===void 0||f[v].iosStatusBarPadding!==!1)&&m.push("q-ios-padding")}else e.electron===!0?m.push("electron"):e.bex===!0&&m.push("bex");return u.iframe===!0&&m.push("within-iframe"),m}function nP(){const e=document.body.className;let s=e;$m!==void 0&&(s=s.replace("desktop","platform-ios mobile")),hi.has.touch===!0&&(s=s.replace("no-touch","touch")),hi.within.iframe===!0&&(s+=" within-iframe"),e!==s&&(document.body.className=s)}function iP(e){for(const s in e)Qk(s,e[s])}const rP={install(e){if(this.__installed!==!0){if(Ss.value===!0)nP();else{const{$q:s}=e;s.config.brand!==void 0&&iP(s.config.brand);const u=tP(hi,s.config);document.body.classList.add.apply(document.body.classList,u)}hi.is.ios===!0&&document.body.addEventListener("touchstart",Cs),window.addEventListener("keydown",Jk,!0)}}},gT={name:"material-icons",type:{positive:"check_circle",negative:"warning",info:"info",warning:"priority_high"},arrow:{up:"arrow_upward",right:"arrow_forward",down:"arrow_downward",left:"arrow_back",dropdown:"arrow_drop_down"},chevron:{left:"chevron_left",right:"chevron_right"},colorPicker:{spectrum:"gradient",tune:"tune",palette:"style"},pullToRefresh:{icon:"refresh"},carousel:{left:"chevron_left",right:"chevron_right",up:"keyboard_arrow_up",down:"keyboard_arrow_down",navigationIcon:"lens"},chip:{remove:"cancel",selected:"check"},datetime:{arrowLeft:"chevron_left",arrowRight:"chevron_right",now:"access_time",today:"today"},editor:{bold:"format_bold",italic:"format_italic",strikethrough:"strikethrough_s",underline:"format_underlined",unorderedList:"format_list_bulleted",orderedList:"format_list_numbered",subscript:"vertical_align_bottom",superscript:"vertical_align_top",hyperlink:"link",toggleFullscreen:"fullscreen",quote:"format_quote",left:"format_align_left",center:"format_align_center",right:"format_align_right",justify:"format_align_justify",print:"print",outdent:"format_indent_decrease",indent:"format_indent_increase",removeFormat:"format_clear",formatting:"text_format",fontSize:"format_size",align:"format_align_left",hr:"remove",undo:"undo",redo:"redo",heading:"format_size",code:"code",size:"format_size",font:"font_download",viewSource:"code"},expansionItem:{icon:"keyboard_arrow_down",denseIcon:"arrow_drop_down"},fab:{icon:"add",activeIcon:"close"},field:{clear:"cancel",error:"error"},pagination:{first:"first_page",prev:"keyboard_arrow_left",next:"keyboard_arrow_right",last:"last_page"},rating:{icon:"grade"},stepper:{done:"check",active:"edit",error:"warning"},tabs:{left:"chevron_left",right:"chevron_right",up:"keyboard_arrow_up",down:"keyboard_arrow_down"},table:{arrowUp:"arrow_upward",warning:"warning",firstPage:"first_page",prevPage:"chevron_left",nextPage:"chevron_right",lastPage:"last_page"},tree:{icon:"play_arrow"},uploader:{done:"done",clear:"clear",add:"add_box",upload:"cloud_upload",removeQueue:"clear_all",removeUploaded:"done_all"}},dm=Gm({iconMapFn:null,__icons:{}},{set(e,s){const u={...e,rtl:e.rtl===!0};u.set=dm.set,Object.assign(dm.__icons,u)},install({$q:e,iconSet:s,ssrContext:u}){e.config.iconMapFn!==void 0&&(this.iconMapFn=e.config.iconMapFn),e.iconSet=this.__icons,bs(e,"iconMapFn",()=>this.iconMapFn,f=>{this.iconMapFn=f}),this.__installed===!0?s!==void 0&&this.set(s):this.set(s||gT)}}),_T="_q_",Zm="_q_l_",oP="_q_pc_",sP="_q_fo_",VF="_q_tabs_",Xs=()=>{},fm={};let yT=!1;function aP(){yT=!0}function Ua(e,s){if(e===s)return!0;if(e!==null&&s!==null&&typeof e=="object"&&typeof s=="object"){if(e.constructor!==s.constructor)return!1;let u,f;if(e.constructor===Array){if(u=e.length,u!==s.length)return!1;for(f=u;f--!==0;)if(Ua(e[f],s[f])!==!0)return!1;return!0}if(e.constructor===Map){if(e.size!==s.size)return!1;for(f=e.entries().next();f.done!==!0;){if(s.has(f.value[0])!==!0)return!1;f=f.next()}for(f=e.entries().next();f.done!==!0;){if(Ua(f.value[1],s.get(f.value[0]))!==!0)return!1;f=f.next()}return!0}if(e.constructor===Set){if(e.size!==s.size)return!1;for(f=e.entries().next();f.done!==!0;){if(s.has(f.value[0])!==!0)return!1;f=f.next()}return!0}if(e.buffer!=null&&e.buffer.constructor===ArrayBuffer){if(u=e.length,u!==s.length)return!1;for(f=u;f--!==0;)if(e[f]!==s[f])return!1;return!0}if(e.constructor===RegExp)return e.source===s.source&&e.flags===s.flags;if(e.valueOf!==Object.prototype.valueOf)return e.valueOf()===s.valueOf();if(e.toString!==Object.prototype.toString)return e.toString()===s.toString();const m=Object.keys(e).filter(v=>e[v]!==void 0);if(u=m.length,u!==Object.keys(s).filter(v=>s[v]!==void 0).length)return!1;for(f=u;f--!==0;){const v=m[f];if(Ua(e[v],s[v])!==!0)return!1}return!0}return e!==e&&s!==s}function ku(e){return e!==null&&typeof e=="object"&&Array.isArray(e)!==!0}function m1(e){return Object.prototype.toString.call(e)==="[object Date]"}function pm(e){return typeof e=="number"&&isFinite(e)}const g1=[hm,rP,Br,Hk,Nd,Fa,dm];function lP(e,s){const u=hT(e);u.config.globalProperties=s.config.globalProperties;const{reload:f,...m}=s._context;return Object.assign(u._context,m),u}function _1(e,s){s.forEach(u=>{u.install(e),u.__installed=!0})}function cP(e,s,u){e.config.globalProperties.$q=u.$q,e.provide(_T,u.$q),_1(u,g1),s.components!==void 0&&Object.values(s.components).forEach(f=>{ku(f)===!0&&f.name!==void 0&&e.component(f.name,f)}),s.directives!==void 0&&Object.values(s.directives).forEach(f=>{ku(f)===!0&&f.name!==void 0&&e.directive(f.name,f)}),s.plugins!==void 0&&_1(u,Object.values(s.plugins).filter(f=>typeof f.install=="function"&&g1.includes(f)===!1)),Ss.value===!0&&(u.$q.onSSRHydrated=()=>{u.onSSRHydrated.forEach(f=>{f()}),u.$q.onSSRHydrated=()=>{}})}const uP=function(e,s={}){const u={version:"2.10.0"};yT===!1?(s.config!==void 0&&Object.assign(fm,s.config),u.config={...fm},aP()):u.config=s.config||{},cP(e,s,{parentApp:e,$q:u,lang:s.lang,iconSet:s.iconSet,onSSRHydrated:[]})},hP={version:"2.10.0",install:uP,lang:Fa,iconSet:dm};var dP=!1;/*!
  * pinia v2.0.23
  * (c) 2022 Eduardo San Martin Morote
  * @license MIT
  */let vT;const Wm=e=>vT=e,xT=Symbol();function ky(e){return e&&typeof e=="object"&&Object.prototype.toString.call(e)==="[object Object]"&&typeof e.toJSON!="function"}var Td;(function(e){e.direct="direct",e.patchObject="patch object",e.patchFunction="patch function"})(Td||(Td={}));function fP(){const e=fE(!0),s=e.run(()=>xt({}));let u=[],f=[];const m=Qs({install(v){Wm(m),m._a=v,v.provide(xT,m),v.config.globalProperties.$pinia=m,f.forEach(b=>u.push(b)),f=[]},use(v){return!this._a&&!dP?f.push(v):u.push(v),this},_p:u,_a:null,_e:e,_s:new Map,state:s});return m}const bT=()=>{};function y1(e,s,u,f=bT){e.push(s);const m=()=>{const v=e.indexOf(s);v>-1&&(e.splice(v,1),f())};return!u&&In()&&ia(m),m}function au(e,...s){e.slice().forEach(u=>{u(...s)})}function Py(e,s){e instanceof Map&&s instanceof Map&&s.forEach((u,f)=>e.set(f,u)),e instanceof Set&&s instanceof Set&&s.forEach(e.add,e);for(const u in s){if(!s.hasOwnProperty(u))continue;const f=s[u],m=e[u];ky(m)&&ky(f)&&e.hasOwnProperty(u)&&!Vi(f)&&!qa(f)?e[u]=Py(m,f):e[u]=f}return e}const pP=Symbol();function mP(e){return!ky(e)||!e.hasOwnProperty(pP)}const{assign:Na}=Object;function gP(e){return!!(Vi(e)&&e.effect)}function _P(e,s,u,f){const{state:m,actions:v,getters:b}=s,o=u.state.value[e];let S;function k(){o||(u.state.value[e]=m?m():{});const I=oI(u.state.value[e]);return Na(I,v,Object.keys(b||{}).reduce((L,D)=>(L[D]=Qs(se(()=>{Wm(u);const N=u._s.get(e);return b[D].call(N,N)})),L),{}))}return S=wT(e,k,s,u,f,!0),S.$reset=function(){const L=m?m():{};this.$patch(D=>{Na(D,L)})},S}function wT(e,s,u={},f,m,v){let b;const o=Na({actions:{}},u),S={deep:!0};let k,I,L=Qs([]),D=Qs([]),N;const j=f.state.value[e];!v&&!j&&(f.state.value[e]={}),xt({});let Z;function K(Te){let Me;k=I=!1,typeof Te=="function"?(Te(f.state.value[e]),Me={type:Td.patchFunction,storeId:e,events:N}):(Py(f.state.value[e],Te),Me={type:Td.patchObject,payload:Te,storeId:e,events:N});const Ie=Z=Symbol();ui().then(()=>{Z===Ie&&(k=!0)}),I=!0,au(L,Me,f.state.value[e])}const fe=bT;function te(){b.stop(),L=[],D=[],f._s.delete(e)}function ve(Te,Me){return function(){Wm(f);const Ie=Array.from(arguments),ke=[],Be=[];function Re(lt){ke.push(lt)}function Ze(lt){Be.push(lt)}au(D,{args:Ie,name:Te,store:ce,after:Re,onError:Ze});let Ye;try{Ye=Me.apply(this&&this.$id===e?this:ce,Ie)}catch(lt){throw au(Be,lt),lt}return Ye instanceof Promise?Ye.then(lt=>(au(ke,lt),lt)).catch(lt=>(au(Be,lt),Promise.reject(lt))):(au(ke,Ye),Ye)}}const Ce={_p:f,$id:e,$onAction:y1.bind(null,D),$patch:K,$reset:fe,$subscribe(Te,Me={}){const Ie=y1(L,Te,Me.detached,()=>ke()),ke=b.run(()=>Ht(()=>f.state.value[e],Be=>{(Me.flush==="sync"?I:k)&&Te({storeId:e,type:Td.direct,events:N},Be)},Na({},S,Me)));return Ie},$dispose:te},ce=Lo(Ce);f._s.set(e,ce);const pe=f._e.run(()=>(b=fE(),b.run(()=>s())));for(const Te in pe){const Me=pe[Te];if(Vi(Me)&&!gP(Me)||qa(Me))v||(j&&mP(Me)&&(Vi(Me)?Me.value=j[Te]:Py(Me,j[Te])),f.state.value[e][Te]=Me);else if(typeof Me=="function"){const Ie=ve(Te,Me);pe[Te]=Ie,o.actions[Te]=Me}}return Na(ce,pe),Na(Tn(ce),pe),Object.defineProperty(ce,"$state",{get:()=>f.state.value[e],set:Te=>{K(Me=>{Na(Me,Te)})}}),f._p.forEach(Te=>{Na(ce,b.run(()=>Te({store:ce,app:f._a,pinia:f,options:o})))}),j&&v&&u.hydrate&&u.hydrate(ce.$state,j),k=!0,I=!0,ce}function Cv(e,s,u){let f,m;const v=typeof s=="function";typeof e=="string"?(f=e,m=v?u:s):(m=e,f=e.id);function b(o,S){const k=In();return o=o||k&&Ur(xT),o&&Wm(o),o=vT,o._s.has(f)||(v?wT(f,s,m,o):_P(f,m,o)),o._s.get(f)}return b.$id=f,b}const zy={xs:18,sm:24,md:32,lg:38,xl:46},Vu={size:String};function Uu(e,s=zy){return se(()=>e.size!==void 0?{fontSize:e.size in s?`${s[e.size]}px`:e.size}:null)}const Un=e=>Qs(yv(e)),Hm=e=>Qs(e);function bi(e,s){return e!==void 0&&e()||s}function Av(e,s){if(e!==void 0){const u=e();if(u!=null)return u.slice()}return s}function Ro(e,s){return e!==void 0?s.concat(e()):s}function ET(e,s){return e===void 0?s:s!==void 0?s.concat(e()):e()}function mm(e,s,u,f,m,v){s.key=f+m;const b=me(e,s,u);return m===!0?Ql(b,v()):b}const v1="0 0 24 24",x1=e=>e,$_=e=>`ionicons ${e}`,TT={"mdi-":e=>`mdi ${e}`,"icon-":x1,"bt-":e=>`bt ${e}`,"eva-":e=>`eva ${e}`,"ion-md":$_,"ion-ios":$_,"ion-logo":$_,"iconfont ":x1,"ti-":e=>`themify-icon ${e}`,"bi-":e=>`bootstrap-icons ${e}`},ST={o_:"-outlined",r_:"-round",s_:"-sharp"},CT={sym_o_:"-outlined",sym_r_:"-rounded",sym_s_:"-sharp"},yP=new RegExp("^("+Object.keys(TT).join("|")+")"),vP=new RegExp("^("+Object.keys(ST).join("|")+")"),b1=new RegExp("^("+Object.keys(CT).join("|")+")"),xP=/^[Mm]\s?[-+]?\.?\d/,bP=/^img:/,wP=/^svguse:/,EP=/^ion-/,TP=/^(fa-(solid|regular|light|brands|duotone|thin)|[lf]a[srlbdk]?) /,Wr=Un({name:"QIcon",props:{...Vu,tag:{type:String,default:"i"},name:String,color:String,left:Boolean,right:Boolean},setup(e,{slots:s}){const{proxy:{$q:u}}=In(),f=Uu(e),m=se(()=>"q-icon"+(e.left===!0?" on-left":"")+(e.right===!0?" on-right":"")+(e.color!==void 0?` text-${e.color}`:"")),v=se(()=>{let b,o=e.name;if(o==="none"||!o)return{none:!0};if(u.iconMapFn!==null){const I=u.iconMapFn(o);if(I!==void 0)if(I.icon!==void 0){if(o=I.icon,o==="none"||!o)return{none:!0}}else return{cls:I.cls,content:I.content!==void 0?I.content:" "}}if(xP.test(o)===!0){const[I,L=v1]=o.split("|");return{svg:!0,viewBox:L,nodes:I.split("&&").map(D=>{const[N,j,Z]=D.split("@@");return me("path",{style:j,d:N,transform:Z})})}}if(bP.test(o)===!0)return{img:!0,src:o.substring(4)};if(wP.test(o)===!0){const[I,L=v1]=o.split("|");return{svguse:!0,src:I.substring(7),viewBox:L}}let S=" ";const k=o.match(yP);if(k!==null)b=TT[k[1]](o);else if(TP.test(o)===!0)b=o;else if(EP.test(o)===!0)b=`ionicons ion-${u.platform.is.ios===!0?"ios":"md"}${o.substring(3)}`;else if(b1.test(o)===!0){b="notranslate material-symbols";const I=o.match(b1);I!==null&&(o=o.substring(6),b+=CT[I[1]]),S=o}else{b="notranslate material-icons";const I=o.match(vP);I!==null&&(o=o.substring(2),b+=ST[I[1]]),S=o}return{cls:b,content:S}});return()=>{const b={class:m.value,style:f.value,"aria-hidden":"true",role:"presentation"};return v.value.none===!0?me(e.tag,b,bi(s.default)):v.value.img===!0?me("span",b,Ro(s.default,[me("img",{src:v.value.src})])):v.value.svg===!0?me("span",b,Ro(s.default,[me("svg",{viewBox:v.value.viewBox||"0 0 24 24"},v.value.nodes)])):v.value.svguse===!0?me("span",b,Ro(s.default,[me("svg",{viewBox:v.value.viewBox},[me("use",{"xlink:href":v.value.src})])])):(v.value.cls!==void 0&&(b.class+=" "+v.value.cls),me(e.tag,b,Ro(s.default,[v.value.content])))}}}),Sd=Un({name:"QAvatar",props:{...Vu,fontSize:String,color:String,textColor:String,icon:String,square:Boolean,rounded:Boolean},setup(e,{slots:s}){const u=Uu(e),f=se(()=>"q-avatar"+(e.color?` bg-${e.color}`:"")+(e.textColor?` text-${e.textColor} q-chip--colored`:"")+(e.square===!0?" q-avatar--square":e.rounded===!0?" rounded-borders":"")),m=se(()=>e.fontSize?{fontSize:e.fontSize}:null);return()=>{const v=e.icon!==void 0?[me(Wr,{name:e.icon})]:void 0;return me("div",{class:f.value,style:u.value},[me("div",{class:"q-avatar__content row flex-center overflow-hidden",style:m.value},ET(s.default,v))])}}}),SP={size:{type:[Number,String],default:"1em"},color:String};function CP(e){return{cSize:se(()=>e.size in zy?`${zy[e.size]}px`:e.size),classes:se(()=>"q-spinner"+(e.color?` text-${e.color}`:""))}}const Xm=Un({name:"QSpinner",props:{...SP,thickness:{type:Number,default:5}},setup(e){const{cSize:s,classes:u}=CP(e);return()=>me("svg",{class:u.value+" q-spinner-mat",width:s.value,height:s.value,viewBox:"25 25 50 50"},[me("circle",{class:"path",cx:"50",cy:"50",r:"20",fill:"none",stroke:"currentColor","stroke-width":e.thickness,"stroke-miterlimit":"10"})])}});function Ly(e,s){const u=e.style;for(const f in s)u[f]=s[f]}function AP(e){if(e==null)return;if(typeof e=="string")try{return document.querySelector(e)||void 0}catch{return}const s=Bn(e);if(s)return s.$el||s}function AT(e,s){if(e==null||e.contains(s)===!0)return!0;for(let u=e.nextElementSibling;u!==null;u=u.nextElementSibling)if(u.contains(s))return!0;return!1}function MP(e,s=250){let u=!1,f;return function(){return u===!1&&(u=!0,setTimeout(()=>{u=!1},s),f=e.apply(this,arguments)),f}}function w1(e,s,u,f){u.modifiers.stop===!0&&to(e);const m=u.modifiers.color;let v=u.modifiers.center;v=v===!0||f===!0;const b=document.createElement("span"),o=document.createElement("span"),S=ic(e),{left:k,top:I,width:L,height:D}=s.getBoundingClientRect(),N=Math.sqrt(L*L+D*D),j=N/2,Z=`${(L-N)/2}px`,K=v?Z:`${S.left-k-j}px`,fe=`${(D-N)/2}px`,te=v?fe:`${S.top-I-j}px`;o.className="q-ripple__inner",Ly(o,{height:`${N}px`,width:`${N}px`,transform:`translate3d(${K},${te},0) scale3d(.2,.2,1)`,opacity:0}),b.className=`q-ripple${m?" text-"+m:""}`,b.setAttribute("dir","ltr"),b.appendChild(o),s.appendChild(b);const ve=()=>{b.remove(),clearTimeout(Ce)};u.abort.push(ve);let Ce=setTimeout(()=>{o.classList.add("q-ripple__inner--enter"),o.style.transform=`translate3d(${Z},${fe},0) scale3d(1,1,1)`,o.style.opacity=.2,Ce=setTimeout(()=>{o.classList.remove("q-ripple__inner--enter"),o.classList.add("q-ripple__inner--leave"),o.style.opacity=0,Ce=setTimeout(()=>{b.remove(),u.abort.splice(u.abort.indexOf(ve),1)},275)},250)},50)}function E1(e,{modifiers:s,value:u,arg:f}){const m=Object.assign({},e.cfg.ripple,s,u);e.modifiers={early:m.early===!0,stop:m.stop===!0,center:m.center===!0,color:m.color||f,keyCodes:[].concat(m.keyCodes||13)}}const MT=Hm({name:"ripple",beforeMount(e,s){const u=s.instance.$.appContext.config.globalProperties.$q.config||{};if(u.ripple===!1)return;const f={cfg:u,enabled:s.value!==!1,modifiers:{},abort:[],start(m){f.enabled===!0&&m.qSkipRipple!==!0&&m.type===(f.modifiers.early===!0?"pointerdown":"click")&&w1(m,e,f,m.qKeyEvent===!0)},keystart:MP(m=>{f.enabled===!0&&m.qSkipRipple!==!0&&Ha(m,f.modifiers.keyCodes)===!0&&m.type===`key${f.modifiers.early===!0?"down":"up"}`&&w1(m,e,f,!0)},300)};E1(f,s),e.__qripple=f,Qo(f,"main",[[e,"pointerdown","start","passive"],[e,"click","start","passive"],[e,"keydown","keystart","passive"],[e,"keyup","keystart","passive"]])},updated(e,s){if(s.oldValue!==s.value){const u=e.__qripple;u!==void 0&&(u.enabled=s.value!==!1,u.enabled===!0&&Object(s.value)===s.value&&E1(u,s))}},beforeUnmount(e){const s=e.__qripple;s!==void 0&&(s.abort.forEach(u=>{u()}),Ga(s,"main"),delete e._qripple)}}),IT={left:"start",center:"center",right:"end",between:"between",around:"around",evenly:"evenly",stretch:"stretch"},IP=Object.keys(IT),kT={align:{type:String,validator:e=>IP.includes(e)}};function PT(e){return se(()=>{const s=e.align===void 0?e.vertical===!0?"stretch":"left":e.align;return`${e.vertical===!0?"items":"justify"}-${IT[s]}`})}function Wp(e){if(Object(e.$parent)===e.$parent)return e.$parent;let{parent:s}=e.$;for(;Object(s)===s;){if(Object(s.proxy)===s.proxy)return s.proxy;s=s.parent}}function zT(e,s){typeof s.type=="symbol"?Array.isArray(s.children)===!0&&s.children.forEach(u=>{zT(e,u)}):e.add(s)}function kP(e){const s=new Set;return e.forEach(u=>{zT(s,u)}),Array.from(s)}function Mv(e){return e.appContext.config.globalProperties.$router!==void 0}function LT(e){return e.isUnmounted===!0||e.isDeactivated===!0}function T1(e){return e?e.aliasOf?e.aliasOf.path:e.path:""}function S1(e,s){return(e.aliasOf||e)===(s.aliasOf||s)}function PP(e,s){for(const u in s){const f=s[u],m=e[u];if(typeof f=="string"){if(f!==m)return!1}else if(Array.isArray(m)===!1||m.length!==f.length||f.some((v,b)=>v!==m[b]))return!1}return!0}function C1(e,s){return Array.isArray(s)===!0?e.length===s.length&&e.every((u,f)=>u===s[f]):e.length===1&&e[0]===s}function zP(e,s){return Array.isArray(e)===!0?C1(e,s):Array.isArray(s)===!0?C1(s,e):e===s}function LP(e,s){if(Object.keys(e).length!==Object.keys(s).length)return!1;for(const u in e)if(zP(e[u],s[u])===!1)return!1;return!0}const RT={to:[String,Object],replace:Boolean,exact:Boolean,activeClass:{type:String,default:"q-router-link--active"},exactActiveClass:{type:String,default:"q-router-link--exact-active"},href:String,target:String,disable:Boolean};function DT({fallbackTag:e,useDisableForRouterLinkProps:s=!0}={}){const u=In(),{props:f,proxy:m,emit:v}=u,b=Mv(u),o=se(()=>f.disable!==!0&&f.href!==void 0),S=se(s===!0?()=>b===!0&&f.disable!==!0&&o.value!==!0&&f.to!==void 0&&f.to!==null&&f.to!=="":()=>b===!0&&o.value!==!0&&f.to!==void 0&&f.to!==null&&f.to!==""),k=se(()=>S.value===!0?te(f.to):null),I=se(()=>k.value!==null),L=se(()=>o.value===!0||I.value===!0),D=se(()=>f.type==="a"||L.value===!0?"a":f.tag||e||"div"),N=se(()=>o.value===!0?{href:f.href,target:f.target}:I.value===!0?{href:k.value.href,target:f.target}:{}),j=se(()=>{if(I.value===!1)return-1;const{matched:ce}=k.value,{length:pe}=ce,Te=ce[pe-1];if(Te===void 0)return-1;const Me=m.$route.matched;if(Me.length===0)return-1;const Ie=Me.findIndex(S1.bind(null,Te));if(Ie>-1)return Ie;const ke=T1(ce[pe-2]);return pe>1&&T1(Te)===ke&&Me[Me.length-1].path!==ke?Me.findIndex(S1.bind(null,ce[pe-2])):Ie}),Z=se(()=>I.value===!0&&j.value!==-1&&PP(m.$route.params,k.value.params)),K=se(()=>Z.value===!0&&j.value===m.$route.matched.length-1&&LP(m.$route.params,k.value.params)),fe=se(()=>I.value===!0?K.value===!0?` ${f.exactActiveClass} ${f.activeClass}`:f.exact===!0?"":Z.value===!0?` ${f.activeClass}`:"":"");function te(ce){try{return m.$router.resolve(ce)}catch{}return null}function ve(ce,{returnRouterError:pe,to:Te=f.to,replace:Me=f.replace}={}){if(f.disable===!0)return ce.preventDefault(),Promise.resolve(!1);if(ce.metaKey||ce.altKey||ce.ctrlKey||ce.shiftKey||ce.button!==void 0&&ce.button!==0||f.target==="_blank")return Promise.resolve(!1);ce.preventDefault();const Ie=m.$router[Me===!0?"replace":"push"](Te);return pe===!0?Ie:Ie.then(()=>{}).catch(()=>{})}function Ce(ce){if(I.value===!0){const pe=Te=>ve(ce,Te);v("click",ce,pe),ce.defaultPrevented!==!0&&pe()}else v("click",ce)}return{hasRouterLink:I,hasHrefLink:o,hasLink:L,linkTag:D,resolvedLink:k,linkIsActive:Z,linkIsExactActive:K,linkClass:fe,linkAttrs:N,getLink:te,navigateToRouterLink:ve,navigateOnClick:Ce}}const A1={none:0,xs:4,sm:8,md:16,lg:24,xl:32},RP={xs:8,sm:10,md:14,lg:20,xl:24},DP=["button","submit","reset"],OP=/[^\s]\/[^\s]/,BP=["flat","outline","push","unelevated"],FP=(e,s)=>e.flat===!0?"flat":e.outline===!0?"outline":e.push===!0?"push":e.unelevated===!0?"unelevated":s,NP={...Vu,...RT,type:{type:String,default:"button"},label:[Number,String],icon:String,iconRight:String,...BP.reduce((e,s)=>(e[s]=Boolean)&&e,{}),square:Boolean,round:Boolean,rounded:Boolean,glossy:Boolean,size:String,fab:Boolean,fabMini:Boolean,padding:String,color:String,textColor:String,noCaps:Boolean,noWrap:Boolean,dense:Boolean,tabindex:[Number,String],ripple:{type:[Boolean,Object],default:!0},align:{...kT.align,default:"center"},stack:Boolean,stretch:Boolean,loading:{type:Boolean,default:null},disable:Boolean};function VP(e){const s=Uu(e,RP),u=PT(e),{hasRouterLink:f,hasLink:m,linkTag:v,linkAttrs:b,navigateOnClick:o}=DT({fallbackTag:"button"}),S=se(()=>{const K=e.fab===!1&&e.fabMini===!1?s.value:{};return e.padding!==void 0?Object.assign({},K,{padding:e.padding.split(/\s+/).map(fe=>fe in A1?A1[fe]+"px":fe).join(" "),minWidth:"0",minHeight:"0"}):K}),k=se(()=>e.rounded===!0||e.fab===!0||e.fabMini===!0),I=se(()=>e.disable!==!0&&e.loading!==!0),L=se(()=>I.value===!0?e.tabindex||0:-1),D=se(()=>FP(e,"standard")),N=se(()=>{const K={tabindex:L.value};return m.value===!0?Object.assign(K,b.value):DP.includes(e.type)===!0&&(K.type=e.type),v.value==="a"?(e.disable===!0?K["aria-disabled"]="true":K.href===void 0&&(K.role="button"),f.value!==!0&&OP.test(e.type)===!0&&(K.type=e.type)):e.disable===!0&&(K.disabled="",K["aria-disabled"]="true"),e.loading===!0&&e.percentage!==void 0&&Object.assign(K,{role:"progressbar","aria-valuemin":0,"aria-valuemax":100,"aria-valuenow":e.percentage}),K}),j=se(()=>{let K;e.color!==void 0?e.flat===!0||e.outline===!0?K=`text-${e.textColor||e.color}`:K=`bg-${e.color} text-${e.textColor||"white"}`:e.textColor&&(K=`text-${e.textColor}`);const fe=e.round===!0?"round":`rectangle${k.value===!0?" q-btn--rounded":e.square===!0?" q-btn--square":""}`;return`q-btn--${D.value} q-btn--${fe}`+(K!==void 0?" "+K:"")+(I.value===!0?" q-btn--actionable q-focusable q-hoverable":e.disable===!0?" disabled":"")+(e.fab===!0?" q-btn--fab":e.fabMini===!0?" q-btn--fab-mini":"")+(e.noCaps===!0?" q-btn--no-uppercase":"")+(e.dense===!0?" q-btn--dense":"")+(e.stretch===!0?" no-border-radius self-stretch":"")+(e.glossy===!0?" glossy":"")+(e.square?" q-btn--square":"")}),Z=se(()=>u.value+(e.stack===!0?" column":" row")+(e.noWrap===!0?" no-wrap text-no-wrap":"")+(e.loading===!0?" q-btn__content--hidden":""));return{classes:j,style:S,innerClasses:Z,attributes:N,hasLink:m,linkTag:v,navigateOnClick:o,isActionable:I}}const{passiveCapture:ko}=Xi;let lu=null,cu=null,uu=null;const Ci=Un({name:"QBtn",props:{...NP,percentage:Number,darkPercentage:Boolean,onTouchstart:[Function,Array]},emits:["click","keydown","mousedown","keyup"],setup(e,{slots:s,emit:u}){const{proxy:f}=In(),{classes:m,style:v,innerClasses:b,attributes:o,hasLink:S,linkTag:k,navigateOnClick:I,isActionable:L}=VP(e),D=xt(null),N=xt(null);let j=null,Z,K;const fe=se(()=>e.label!==void 0&&e.label!==null&&e.label!==""),te=se(()=>e.disable===!0||e.ripple===!1?!1:{keyCodes:S.value===!0?[13,32]:[13],...e.ripple===!0?{}:e.ripple}),ve=se(()=>({center:e.round})),Ce=se(()=>{const Ye=Math.max(0,Math.min(100,e.percentage));return Ye>0?{transition:"transform 0.6s",transform:`translateX(${Ye-100}%)`}:{}}),ce=se(()=>{if(e.loading===!0)return{onMousedown:Ze,onTouchstart:Ze,onClick:Ze,onKeydown:Ze,onKeyup:Ze};if(L.value===!0){const Ye={onClick:Te,onKeydown:Me,onMousedown:ke};if(f.$q.platform.has.touch===!0){const lt=e.onTouchstart!==void 0?"":"Passive";Ye[`onTouchstart${lt}`]=Ie}return Ye}return{onClick:zi}}),pe=se(()=>({ref:D,class:"q-btn q-btn-item non-selectable no-outline "+m.value,style:v.value,...o.value,...ce.value}));function Te(Ye){if(D.value!==null){if(Ye!==void 0){if(Ye.defaultPrevented===!0)return;const lt=document.activeElement;if(e.type==="submit"&&lt!==document.body&&D.value.contains(lt)===!1&&lt.contains(D.value)===!1){D.value.focus();const Xt=()=>{document.removeEventListener("keydown",zi,!0),document.removeEventListener("keyup",Xt,ko),D.value!==null&&D.value.removeEventListener("blur",Xt,ko)};document.addEventListener("keydown",zi,!0),document.addEventListener("keyup",Xt,ko),D.value.addEventListener("blur",Xt,ko)}}I(Ye)}}function Me(Ye){D.value!==null&&(u("keydown",Ye),Ha(Ye,[13,32])===!0&&cu!==D.value&&(cu!==null&&Re(),Ye.defaultPrevented!==!0&&(D.value.focus(),cu=D.value,D.value.classList.add("q-btn--active"),document.addEventListener("keyup",Be,!0),D.value.addEventListener("blur",Be,ko)),zi(Ye)))}function Ie(Ye){D.value!==null&&(u("touchstart",Ye),Ye.defaultPrevented!==!0&&(lu!==D.value&&(lu!==null&&Re(),lu=D.value,j=Ye.target,j.addEventListener("touchcancel",Be,ko),j.addEventListener("touchend",Be,ko)),Z=!0,clearTimeout(K),K=setTimeout(()=>{Z=!1},200)))}function ke(Ye){D.value!==null&&(Ye.qSkipRipple=Z===!0,u("mousedown",Ye),Ye.defaultPrevented!==!0&&uu!==D.value&&(uu!==null&&Re(),uu=D.value,D.value.classList.add("q-btn--active"),document.addEventListener("mouseup",Be,ko)))}function Be(Ye){if(D.value!==null&&!(Ye!==void 0&&Ye.type==="blur"&&document.activeElement===D.value)){if(Ye!==void 0&&Ye.type==="keyup"){if(cu===D.value&&Ha(Ye,[13,32])===!0){const lt=new MouseEvent("click",Ye);lt.qKeyEvent=!0,Ye.defaultPrevented===!0&&Nr(lt),Ye.cancelBubble===!0&&to(lt),D.value.dispatchEvent(lt),zi(Ye),Ye.qKeyEvent=!0}u("keyup",Ye)}Re()}}function Re(Ye){const lt=N.value;Ye!==!0&&(lu===D.value||uu===D.value)&&lt!==null&&lt!==document.activeElement&&(lt.setAttribute("tabindex",-1),lt.focus()),lu===D.value&&(j!==null&&(j.removeEventListener("touchcancel",Be,ko),j.removeEventListener("touchend",Be,ko)),lu=j=null),uu===D.value&&(document.removeEventListener("mouseup",Be,ko),uu=null),cu===D.value&&(document.removeEventListener("keyup",Be,!0),D.value!==null&&D.value.removeEventListener("blur",Be,ko),cu=null),D.value!==null&&D.value.classList.remove("q-btn--active")}function Ze(Ye){zi(Ye),Ye.qSkipRipple=!0}return Ii(()=>{Re(!0)}),Object.assign(f,{click:Te}),()=>{let Ye=[];e.icon!==void 0&&Ye.push(me(Wr,{name:e.icon,left:e.stack===!1&&fe.value===!0,role:"img","aria-hidden":"true"})),fe.value===!0&&Ye.push(me("span",{class:"block"},[e.label])),Ye=Ro(s.default,Ye),e.iconRight!==void 0&&e.round===!1&&Ye.push(me(Wr,{name:e.iconRight,right:e.stack===!1&&fe.value===!0,role:"img","aria-hidden":"true"}));const lt=[me("span",{class:"q-focus-helper",ref:N})];return e.loading===!0&&e.percentage!==void 0&&lt.push(me("span",{class:"q-btn__progress absolute-full overflow-hidden"+(e.darkPercentage===!0?" q-btn__progress--dark":"")},[me("span",{class:"q-btn__progress-indicator fit block",style:Ce.value})])),lt.push(me("span",{class:"q-btn__content text-center col items-center q-anchor--skip "+b.value},Ye)),e.loading!==null&&lt.push(me(ea,{name:"q-transition--fade"},()=>e.loading===!0?[me("span",{key:"loading",class:"absolute-full flex flex-center"},s.loading!==void 0?s.loading():[me(Xm)])]:null)),Ql(me(k.value,pe.value,lt),[[MT,te.value,void 0,ve.value]])}}});let UP=document.body;function OT(e){const s=document.createElement("div");if(e!==void 0&&(s.id=e),fm.globalNodes!==void 0){const u=fm.globalNodes.class;u!==void 0&&(s.className=u)}return UP.appendChild(s),s}function jP(e){e.remove()}let qP=0;const Hp={},Xp={},Ho={},BT={},$P=/^\s*$/,FT=[],Iv=["top-left","top-right","bottom-left","bottom-right","top","bottom","left","right","center"],GP=["top-left","top-right","bottom-left","bottom-right"],mu={positive:{icon:e=>e.iconSet.type.positive,color:"positive"},negative:{icon:e=>e.iconSet.type.negative,color:"negative"},warning:{icon:e=>e.iconSet.type.warning,color:"warning",textColor:"dark"},info:{icon:e=>e.iconSet.type.info,color:"info"},ongoing:{group:!1,timeout:0,spinner:!0,color:"grey-8"}};function NT(e,s,u){if(!e)return dd("parameter required");let f;const m={textColor:"white"};if(e.ignoreDefaults!==!0&&Object.assign(m,Hp),ku(e)===!1&&(m.type&&Object.assign(m,mu[m.type]),e={message:e}),Object.assign(m,mu[e.type||m.type],e),typeof m.icon=="function"&&(m.icon=m.icon(s)),m.spinner?(m.spinner===!0&&(m.spinner=Xm),m.spinner=Qs(m.spinner)):m.spinner=!1,m.meta={hasMedia:Boolean(m.spinner!==!1||m.icon||m.avatar),hasText:M1(m.message)||M1(m.caption)},m.position){if(Iv.includes(m.position)===!1)return dd("wrong position",e)}else m.position="bottom";if(m.timeout===void 0)m.timeout=5e3;else{const S=parseInt(m.timeout,10);if(isNaN(S)||S<0)return dd("wrong timeout",e);m.timeout=S}m.timeout===0?m.progress=!1:m.progress===!0&&(m.meta.progressClass="q-notification__progress"+(m.progressClass?` ${m.progressClass}`:""),m.meta.progressStyle={animationDuration:`${m.timeout+1e3}ms`});const v=(Array.isArray(e.actions)===!0?e.actions:[]).concat(e.ignoreDefaults!==!0&&Array.isArray(Hp.actions)===!0?Hp.actions:[]).concat(mu[e.type]!==void 0&&Array.isArray(mu[e.type].actions)===!0?mu[e.type].actions:[]),{closeBtn:b}=m;if(b&&v.push({label:typeof b=="string"?b:s.lang.label.close}),m.actions=v.map(({handler:S,noDismiss:k,...I})=>({flat:!0,...I,onClick:typeof S=="function"?()=>{S(),k!==!0&&o()}:()=>{o()}})),m.multiLine===void 0&&(m.multiLine=m.actions.length>1),Object.assign(m.meta,{class:`q-notification row items-stretch q-notification--${m.multiLine===!0?"multi-line":"standard"}`+(m.color!==void 0?` bg-${m.color}`:"")+(m.textColor!==void 0?` text-${m.textColor}`:"")+(m.classes!==void 0?` ${m.classes}`:""),wrapperClass:"q-notification__wrapper col relative-position border-radius-inherit "+(m.multiLine===!0?"column no-wrap justify-center":"row items-center"),contentClass:"q-notification__content row items-center"+(m.multiLine===!0?"":" col"),leftClass:m.meta.hasText===!0?"additional":"single",attrs:{role:"alert",...m.attrs}}),m.group===!1?(m.group=void 0,m.meta.group=void 0):((m.group===void 0||m.group===!0)&&(m.group=[m.message,m.caption,m.multiline].concat(m.actions.map(S=>`${S.label}*${S.icon}`)).join("|")),m.meta.group=m.group+"|"+m.position),m.actions.length===0?m.actions=void 0:m.meta.actionsClass="q-notification__actions row items-center "+(m.multiLine===!0?"justify-end":"col-auto")+(m.meta.hasMedia===!0?" q-notification__actions--with-media":""),u!==void 0){clearTimeout(u.notif.meta.timer),m.meta.uid=u.notif.meta.uid;const S=Ho[m.position].value.indexOf(u.notif);Ho[m.position].value[S]=m}else{const S=Xp[m.meta.group];if(S===void 0){if(m.meta.uid=qP++,m.meta.badge=1,["left","right","center"].indexOf(m.position)!==-1)Ho[m.position].value.splice(Math.floor(Ho[m.position].value.length/2),0,m);else{const k=m.position.indexOf("top")>-1?"unshift":"push";Ho[m.position].value[k](m)}m.group!==void 0&&(Xp[m.meta.group]=m)}else{if(clearTimeout(S.meta.timer),m.badgePosition!==void 0){if(GP.includes(m.badgePosition)===!1)return dd("wrong badgePosition",e)}else m.badgePosition=`top-${m.position.indexOf("left")>-1?"right":"left"}`;m.meta.uid=S.meta.uid,m.meta.badge=S.meta.badge+1,m.meta.badgeClass=`q-notification__badge q-notification__badge--${m.badgePosition}`+(m.badgeColor!==void 0?` bg-${m.badgeColor}`:"")+(m.badgeTextColor!==void 0?` text-${m.badgeTextColor}`:"")+(m.badgeClass?` ${m.badgeClass}`:"");const k=Ho[m.position].value.indexOf(S);Ho[m.position].value[k]=Xp[m.meta.group]=m}}const o=()=>{ZP(m),f=void 0};if(m.timeout>0&&(m.meta.timer=setTimeout(()=>{o()},m.timeout+1e3)),m.group!==void 0)return S=>{S!==void 0?dd("trying to update a grouped one which is forbidden",e):o()};if(f={dismiss:o,config:e,notif:m},u!==void 0){Object.assign(u,f);return}return S=>{if(f!==void 0)if(S===void 0)f.dismiss();else{const k=Object.assign({},f.config,S,{group:!1,position:m.position});NT(k,s,f)}}}function ZP(e){clearTimeout(e.meta.timer);const s=Ho[e.position].value.indexOf(e);if(s!==-1){e.group!==void 0&&delete Xp[e.meta.group];const u=FT[""+e.meta.uid];if(u){const{width:f,height:m}=getComputedStyle(u);u.style.left=`${u.offsetLeft}px`,u.style.width=f,u.style.height=m}Ho[e.position].value.splice(s,1),typeof e.onDismiss=="function"&&e.onDismiss()}}function M1(e){return e!=null&&$P.test(e)!==!0}function dd(e,s){return console.error(`Notify: ${e}`,s),!1}function WP(){return Un({name:"QNotifications",devtools:{hide:!0},setup(){return()=>me("div",{class:"q-notifications"},Iv.map(e=>me(Lk,{key:e,class:BT[e],tag:"div",name:`q-notification--${e}`},()=>Ho[e].value.map(s=>{const u=s.meta,f=[];if(u.hasMedia===!0&&(s.spinner!==!1?f.push(me(s.spinner,{class:"q-notification__spinner q-notification__spinner--"+u.leftClass,color:s.spinnerColor,size:s.spinnerSize})):s.icon?f.push(me(Wr,{class:"q-notification__icon q-notification__icon--"+u.leftClass,name:s.icon,color:s.iconColor,size:s.iconSize,role:"img"})):s.avatar&&f.push(me(Sd,{class:"q-notification__avatar q-notification__avatar--"+u.leftClass},()=>me("img",{src:s.avatar,"aria-hidden":"true"})))),u.hasText===!0){let v;const b={class:"q-notification__message col"};if(s.html===!0)b.innerHTML=s.caption?`<div>${s.message}</div><div class="q-notification__caption">${s.caption}</div>`:s.message;else{const o=[s.message];v=s.caption?[me("div",o),me("div",{class:"q-notification__caption"},[s.caption])]:o}f.push(me("div",b,v))}const m=[me("div",{class:u.contentClass},f)];return s.progress===!0&&m.push(me("div",{key:`${u.uid}|p|${u.badge}`,class:u.progressClass,style:u.progressStyle})),s.actions!==void 0&&m.push(me("div",{class:u.actionsClass},s.actions.map(v=>me(Ci,v)))),u.badge>1&&m.push(me("div",{key:`${u.uid}|${u.badge}`,class:s.meta.badgeClass,style:s.badgeStyle},[u.badge])),me("div",{ref:v=>{FT[""+u.uid]=v},key:u.uid,class:u.class,...u.attrs},[me("div",{class:u.wrapperClass},m)])}))))}})}const HP={setDefaults(e){ku(e)===!0&&Object.assign(Hp,e)},registerType(e,s){ku(s)===!0&&(mu[e]=s)},install({$q:e,parentApp:s}){if(e.notify=this.create=u=>NT(u,e),e.notify.setDefaults=this.setDefaults,e.notify.registerType=this.registerType,e.config.notify!==void 0&&this.setDefaults(e.config.notify),this.__installed!==!0){Iv.forEach(f=>{Ho[f]=xt([]);const m=["left","center","right"].includes(f)===!0?"center":f.indexOf("top")>-1?"top":"bottom",v=f.indexOf("left")>-1?"start":f.indexOf("right")>-1?"end":"center",b=["left","right"].includes(f)?`items-${f==="left"?"start":"end"} justify-center`:f==="center"?"flex-center":`items-${v}`;BT[f]=`q-notifications__list q-notifications__list--${m} fixed column no-wrap ${b}`});const u=OT("q-notify");lP(WP(),s).mount(u)}}};function XP(e){return typeof e=="object"&&e!==null}function I1(e,s){return e=XP(e)?e:Object.create(null),new Proxy(e,{get(u,f,m){return f==="key"?Reflect.get(u,f,m):Reflect.get(u,f,m)||Reflect.get(s,f,m)}})}function KP(e,s){return s.reduce((u,f)=>u==null?void 0:u[f],e)}function YP(e,s,u){return s.slice(0,-1).reduce((f,m)=>/^(__proto__)$/.test(m)?{}:f[m]=f[m]||{},e)[s[s.length-1]]=u,e}function QP(e,s){return s.reduce((u,f)=>{const m=f.split(".");return YP(u,m,KP(e,m))},{})}function k1(e,{storage:s,serializer:u,key:f,debug:m}){try{const v=s==null?void 0:s.getItem(f);v&&e.$patch(u==null?void 0:u.deserialize(v))}catch(v){m&&console.error(v)}}function P1(e,{storage:s,serializer:u,key:f,paths:m,debug:v}){try{const b=Array.isArray(m)?QP(e,m):e;s.setItem(f,u.serialize(b))}catch(b){v&&console.error(b)}}function JP(e={}){return s=>{const{auto:u=!1}=e,{options:{persist:f=u},store:m}=s;if(!f)return;const v=(Array.isArray(f)?f.map(b=>I1(b,e)):[I1(f,e)]).map(({storage:b=localStorage,beforeRestore:o=null,afterRestore:S=null,serializer:k={serialize:JSON.stringify,deserialize:JSON.parse},key:I=m.$id,paths:L=null,debug:D=!1})=>{var N;return{storage:b,beforeRestore:o,afterRestore:S,serializer:k,key:((N=e.key)!=null?N:j=>j)(I),paths:L,debug:D}});m.$persist=()=>{v.forEach(b=>{P1(m.$state,b)})},m.$hydrate=({runHooks:b=!0}={})=>{v.forEach(o=>{const{beforeRestore:S,afterRestore:k}=o;b&&(S==null||S(s)),k1(m,o),b&&(k==null||k(s))})},v.forEach(b=>{const{beforeRestore:o,afterRestore:S}=b;o==null||o(s),k1(m,b),S==null||S(s),m.$subscribe((k,I)=>{P1(I,b)},{detached:!0})})}}var ez=JP();const tz=Un({name:"QToolbarTitle",props:{shrink:Boolean},setup(e,{slots:s}){const u=se(()=>"q-toolbar__title ellipsis"+(e.shrink===!0?" col-shrink":""));return()=>me("div",{class:u.value},bi(s.default))}}),io={dark:{type:Boolean,default:null}};function ro(e,s){return se(()=>e.dark===null?s.dark.isActive:e.dark)}const VT=Un({name:"QList",props:{...io,bordered:Boolean,dense:Boolean,separator:Boolean,padding:Boolean},setup(e,{slots:s}){const u=In(),f=ro(e,u.proxy.$q),m=se(()=>"q-list"+(e.bordered===!0?" q-list--bordered":"")+(e.dense===!0?" q-list--dense":"")+(e.separator===!0?" q-list--separator":"")+(f.value===!0?" q-list--dark":"")+(e.padding===!0?" q-list--padding":""));return()=>me("div",{class:m.value,role:"list"},bi(s.default))}});function kv(){if(window.getSelection!==void 0){const e=window.getSelection();e.empty!==void 0?e.empty():e.removeAllRanges!==void 0&&(e.removeAllRanges(),hm.is.mobile!==!0&&e.addRange(document.createRange()))}else document.selection!==void 0&&document.selection.empty()}const nz={target:{default:!0},noParentEvent:Boolean,contextMenu:Boolean};function iz({showing:e,avoidEmit:s,configureAnchorEl:u}){const{props:f,proxy:m,emit:v}=In(),b=xt(null);let o;function S(N){return b.value===null?!1:N===void 0||N.touches===void 0||N.touches.length<=1}const k={};u===void 0&&(Object.assign(k,{hide(N){m.hide(N)},toggle(N){m.toggle(N),N.qAnchorHandled=!0},toggleKey(N){Ha(N,13)===!0&&k.toggle(N)},contextClick(N){m.hide(N),Nr(N),ui(()=>{m.show(N),N.qAnchorHandled=!0})},prevent:Nr,mobileTouch(N){if(k.mobileCleanup(N),S(N)!==!0)return;m.hide(N),b.value.classList.add("non-selectable");const j=N.target;Qo(k,"anchor",[[j,"touchmove","mobileCleanup","passive"],[j,"touchend","mobileCleanup","passive"],[j,"touchcancel","mobileCleanup","passive"],[b.value,"contextmenu","prevent","notPassive"]]),o=setTimeout(()=>{m.show(N),N.qAnchorHandled=!0},300)},mobileCleanup(N){b.value.classList.remove("non-selectable"),clearTimeout(o),e.value===!0&&N!==void 0&&kv()}}),u=function(N=f.contextMenu){if(f.noParentEvent===!0||b.value===null)return;let j;N===!0?m.$q.platform.is.mobile===!0?j=[[b.value,"touchstart","mobileTouch","passive"]]:j=[[b.value,"mousedown","hide","passive"],[b.value,"contextmenu","contextClick","notPassive"]]:j=[[b.value,"click","toggle","passive"],[b.value,"keyup","toggleKey","passive"]],Qo(k,"anchor",j)});function I(){Ga(k,"anchor")}function L(N){for(b.value=N;b.value.classList.contains("q-anchor--skip");)b.value=b.value.parentNode;u()}function D(){if(f.target===!1||f.target===""||m.$el.parentNode===null)b.value=null;else if(f.target===!0)L(m.$el.parentNode);else{let N=f.target;if(typeof f.target=="string")try{N=document.querySelector(f.target)}catch{N=void 0}N!=null?(b.value=N.$el||N,u()):(b.value=null,console.error(`Anchor: target "${f.target}" not found`))}}return Ht(()=>f.contextMenu,N=>{b.value!==null&&(I(),u(N))}),Ht(()=>f.target,()=>{b.value!==null&&I(),D()}),Ht(()=>f.noParentEvent,N=>{b.value!==null&&(N===!0?I():u())}),Ui(()=>{D(),s!==!0&&f.modelValue===!0&&b.value===null&&v("update:modelValue",!1)}),Ii(()=>{clearTimeout(o),I()}),{anchorEl:b,canShow:S,anchorEvents:k}}function rz(e,s){const u=xt(null);let f;function m(o,S){const k=`${S!==void 0?"add":"remove"}EventListener`,I=S!==void 0?S:f;o!==window&&o[k]("scroll",I,Xi.passive),window[k]("scroll",I,Xi.passive),f=S}function v(){u.value!==null&&(m(u.value),u.value=null)}const b=Ht(()=>e.noParentEvent,()=>{u.value!==null&&(v(),s())});return Ii(b),{localScrollTarget:u,unconfigureScrollTarget:v,changeScrollEvent:m}}const Pv={modelValue:{type:Boolean,default:null},"onUpdate:modelValue":[Function,Array]},zv=["before-show","show","before-hide","hide"];function Lv({showing:e,canShow:s,hideOnRouteChange:u,handleShow:f,handleHide:m,processOnMount:v}){const b=In(),{props:o,emit:S,proxy:k}=b;let I;function L(te){e.value===!0?j(te):D(te)}function D(te){if(o.disable===!0||te!==void 0&&te.qAnchorHandled===!0||s!==void 0&&s(te)!==!0)return;const ve=o["onUpdate:modelValue"]!==void 0;ve===!0&&(S("update:modelValue",!0),I=te,ui(()=>{I===te&&(I=void 0)})),(o.modelValue===null||ve===!1)&&N(te)}function N(te){e.value!==!0&&(e.value=!0,S("before-show",te),f!==void 0?f(te):S("show",te))}function j(te){if(o.disable===!0)return;const ve=o["onUpdate:modelValue"]!==void 0;ve===!0&&(S("update:modelValue",!1),I=te,ui(()=>{I===te&&(I=void 0)})),(o.modelValue===null||ve===!1)&&Z(te)}function Z(te){e.value!==!1&&(e.value=!1,S("before-hide",te),m!==void 0?m(te):S("hide",te))}function K(te){o.disable===!0&&te===!0?o["onUpdate:modelValue"]!==void 0&&S("update:modelValue",!1):te===!0!==e.value&&(te===!0?N:Z)(I)}Ht(()=>o.modelValue,K),u!==void 0&&Mv(b)===!0&&Ht(()=>k.$route.fullPath,()=>{u.value===!0&&e.value===!0&&j()}),v===!0&&Ui(()=>{K(o.modelValue)});const fe={show:D,hide:j,toggle:L};return Object.assign(k,fe),fe}let Xl=[],Vd=[];function UT(e){Vd=Vd.filter(s=>s!==e)}function oz(e){UT(e),Vd.push(e)}function z1(e){UT(e),Vd.length===0&&Xl.length>0&&(Xl[Xl.length-1](),Xl=[])}function Km(e){Vd.length===0?e():Xl.push(e)}function sz(e){Xl=Xl.filter(s=>s!==e)}const wu=[];function az(e){return wu.find(s=>s.__qPortalInnerRef.value!==null&&s.__qPortalInnerRef.value.contains(e))}function jT(e,s){do{if(e.$options.name==="QMenu"){if(e.hide(s),e.$props.separateClosePopup===!0)return Wp(e)}else if(e.__qPortalInnerRef!==void 0){const u=Wp(e);return u!==void 0&&u.$options.name==="QPopupProxy"?(e.hide(s),u):e}e=Wp(e)}while(e!=null)}function lz(e,s,u){for(;u!==0&&e!==void 0&&e!==null;){if(e.__qPortalInnerRef!==void 0){if(u--,e.$options.name==="QMenu"){e=jT(e,s);continue}e.hide(s)}e=Wp(e)}}function cz(e){for(e=e.parent;e!=null;){if(e.type.name==="QGlobalDialog")return!0;if(e.type.name==="QDialog"||e.type.name==="QMenu")return!1;e=e.parent}return!1}function qT(e,s,u,f){const m=xt(!1),v=xt(!1);let b=null;const o={},S=f===!0&&cz(e);function k(L){if(L===!0){z1(o),v.value=!0;return}v.value=!1,m.value===!1&&(S===!1&&b===null&&(b=OT()),m.value=!0,wu.push(e.proxy),oz(o))}function I(L){if(v.value=!1,L!==!0)return;z1(o),m.value=!1;const D=wu.indexOf(e.proxy);D!==-1&&wu.splice(D,1),b!==null&&(jP(b),b=null)}return ia(()=>{I(!0)}),e.proxy.__qPortalInnerRef=s,{showPortal:k,hidePortal:I,portalIsActive:m,portalIsAccessible:v,renderPortal:()=>S===!0?u():m.value===!0?[me(QI,{to:b},u())]:void 0}}const $T={transitionShow:{type:String,default:"fade"},transitionHide:{type:String,default:"fade"},transitionDuration:{type:[String,Number],default:300}};function uz(e,s){const u=xt(s.value);return Ht(s,f=>{ui(()=>{u.value=f})}),{transition:se(()=>"q-transition--"+(u.value===!0?e.transitionHide:e.transitionShow)),transitionStyle:se(()=>`--q-transition-duration: ${e.transitionDuration}ms`)}}function GT(){let e;const s=In();function u(){e=void 0}return Nu(u),Ii(u),{removeTick:u,registerTick(f){e=f,ui(()=>{e===f&&(LT(s)===!1&&e(),e=void 0)})}}}function Rv(){let e;const s=In();function u(){clearTimeout(e)}return Nu(u),Ii(u),{removeTimeout:u,registerTimeout(f,m){clearTimeout(e),LT(s)===!1&&(e=setTimeout(f,m))}}}const hz=[null,document,document.body,document.scrollingElement,document.documentElement];function Dv(e,s){let u=AP(s);if(u===void 0){if(e==null)return window;u=e.closest(".scroll,.scroll-y,.overflow-auto")}return hz.includes(u)?window:u}function ZT(e){return e===window?window.pageYOffset||window.scrollY||document.body.scrollTop||0:e.scrollTop}function WT(e){return e===window?window.pageXOffset||window.scrollX||document.body.scrollLeft||0:e.scrollLeft}let Dp;function Kp(){if(Dp!==void 0)return Dp;const e=document.createElement("p"),s=document.createElement("div");Ly(e,{width:"100%",height:"200px"}),Ly(s,{position:"absolute",top:"0px",left:"0px",visibility:"hidden",width:"200px",height:"150px",overflow:"hidden"}),s.appendChild(e),document.body.appendChild(s);const u=e.offsetWidth;s.style.overflow="scroll";let f=e.offsetWidth;return u===f&&(f=s.clientWidth),s.remove(),Dp=u-f,Dp}function dz(e,s=!0){return!e||e.nodeType!==Node.ELEMENT_NODE?!1:s?e.scrollHeight>e.clientHeight&&(e.classList.contains("scroll")||e.classList.contains("overflow-auto")||["auto","scroll"].includes(window.getComputedStyle(e)["overflow-y"])):e.scrollWidth>e.clientWidth&&(e.classList.contains("scroll")||e.classList.contains("overflow-auto")||["auto","scroll"].includes(window.getComputedStyle(e)["overflow-x"]))}const ec=[];let Pu;function fz(e){Pu=e.keyCode===27}function pz(){Pu===!0&&(Pu=!1)}function mz(e){Pu===!0&&(Pu=!1,Ha(e,27)===!0&&ec[ec.length-1](e))}function HT(e){window[e]("keydown",fz),window[e]("blur",pz),window[e]("keyup",mz),Pu=!1}function XT(e){hi.is.desktop===!0&&(ec.push(e),ec.length===1&&HT("addEventListener"))}function gm(e){const s=ec.indexOf(e);s>-1&&(ec.splice(s,1),ec.length===0&&HT("removeEventListener"))}const tc=[];function KT(e){tc[tc.length-1](e)}function YT(e){hi.is.desktop===!0&&(tc.push(e),tc.length===1&&document.body.addEventListener("focusin",KT))}function Ry(e){const s=tc.indexOf(e);s>-1&&(tc.splice(s,1),tc.length===0&&document.body.removeEventListener("focusin",KT))}let QT;const{notPassiveCapture:_m}=Xi,nc=[];function ym(e){clearTimeout(QT);const s=e.target;if(s===void 0||s.nodeType===8||s.classList.contains("no-pointer-events")===!0)return;let u=wu.length-1;for(;u>=0;){const f=wu[u].$;if(f.type.name!=="QDialog")break;if(f.props.seamless!==!0)return;u--}for(let f=nc.length-1;f>=0;f--){const m=nc[f];if((m.anchorEl.value===null||m.anchorEl.value.contains(s)===!1)&&(s===document.body||m.innerRef.value!==null&&m.innerRef.value.contains(s)===!1))e.qClickOutside=!0,m.onClickOutside(e);else return}}function gz(e){nc.push(e),nc.length===1&&(document.addEventListener("mousedown",ym,_m),document.addEventListener("touchstart",ym,_m))}function L1(e){const s=nc.findIndex(u=>u===e);s>-1&&(nc.splice(s,1),nc.length===0&&(clearTimeout(QT),document.removeEventListener("mousedown",ym,_m),document.removeEventListener("touchstart",ym,_m)))}let R1,D1;function O1(e){const s=e.split(" ");return s.length!==2?!1:["top","center","bottom"].includes(s[0])!==!0?(console.error("Anchor/Self position must start with one of top/center/bottom"),!1):["left","middle","right","start","end"].includes(s[1])!==!0?(console.error("Anchor/Self position must end with one of left/middle/right/start/end"),!1):!0}function _z(e){return e?!(e.length!==2||typeof e[0]!="number"||typeof e[1]!="number"):!0}const Dy={"start#ltr":"left","start#rtl":"right","end#ltr":"right","end#rtl":"left"};["left","middle","right"].forEach(e=>{Dy[`${e}#ltr`]=e,Dy[`${e}#rtl`]=e});function B1(e,s){const u=e.split(" ");return{vertical:u[0],horizontal:Dy[`${u[1]}#${s===!0?"rtl":"ltr"}`]}}function yz(e,s){let{top:u,left:f,right:m,bottom:v,width:b,height:o}=e.getBoundingClientRect();return s!==void 0&&(u-=s[1],f-=s[0],v+=s[1],m+=s[0],b+=s[0],o+=s[1]),{top:u,left:f,right:m,bottom:v,width:b,height:o,middle:f+(m-f)/2,center:u+(v-u)/2}}function vz(e){return{top:0,center:e.offsetHeight/2,bottom:e.offsetHeight,left:0,middle:e.offsetWidth/2,right:e.offsetWidth}}function xz(e){if(hi.is.ios===!0&&window.visualViewport!==void 0){const o=document.body.style,{offsetLeft:S,offsetTop:k}=window.visualViewport;S!==R1&&(o.setProperty("--q-pe-left",S+"px"),R1=S),k!==D1&&(o.setProperty("--q-pe-top",k+"px"),D1=k)}let s;const{scrollLeft:u,scrollTop:f}=e.el;if(e.absoluteOffset===void 0)s=yz(e.anchorEl,e.cover===!0?[0,0]:e.offset);else{const{top:o,left:S}=e.anchorEl.getBoundingClientRect(),k=o+e.absoluteOffset.top,I=S+e.absoluteOffset.left;s={top:k,left:I,width:1,height:1,right:I+1,center:k,middle:I,bottom:k+1}}let m={maxHeight:e.maxHeight,maxWidth:e.maxWidth,visibility:"visible"};(e.fit===!0||e.cover===!0)&&(m.minWidth=s.width+"px",e.cover===!0&&(m.minHeight=s.height+"px")),Object.assign(e.el.style,m);const v=vz(e.el),b={top:s[e.anchorOrigin.vertical]-v[e.selfOrigin.vertical],left:s[e.anchorOrigin.horizontal]-v[e.selfOrigin.horizontal]};bz(b,s,v,e.anchorOrigin,e.selfOrigin),m={top:b.top+"px",left:b.left+"px"},b.maxHeight!==void 0&&(m.maxHeight=b.maxHeight+"px",s.height>b.maxHeight&&(m.minHeight=m.maxHeight)),b.maxWidth!==void 0&&(m.maxWidth=b.maxWidth+"px",s.width>b.maxWidth&&(m.minWidth=m.maxWidth)),Object.assign(e.el.style,m),e.el.scrollTop!==f&&(e.el.scrollTop=f),e.el.scrollLeft!==u&&(e.el.scrollLeft=u)}function bz(e,s,u,f,m){const v=u.bottom,b=u.right,o=Kp(),S=window.innerHeight-o,k=document.body.clientWidth;if(e.top<0||e.top+v>S)if(m.vertical==="center")e.top=s[f.vertical]>S/2?Math.max(0,S-v):0,e.maxHeight=Math.min(v,S);else if(s[f.vertical]>S/2){const I=Math.min(S,f.vertical==="center"?s.center:f.vertical===m.vertical?s.bottom:s.top);e.maxHeight=Math.min(v,I),e.top=Math.max(0,I-v)}else e.top=Math.max(0,f.vertical==="center"?s.center:f.vertical===m.vertical?s.top:s.bottom),e.maxHeight=Math.min(v,S-e.top);if(e.left<0||e.left+b>k)if(e.maxWidth=Math.min(b,k),m.horizontal==="middle")e.left=s[f.horizontal]>k/2?Math.max(0,k-b):0;else if(s[f.horizontal]>k/2){const I=Math.min(k,f.horizontal==="middle"?s.middle:f.horizontal===m.horizontal?s.right:s.left);e.maxWidth=Math.min(b,I),e.left=Math.max(0,I-e.maxWidth)}else e.left=Math.max(0,f.horizontal==="middle"?s.middle:f.horizontal===m.horizontal?s.left:s.right),e.maxWidth=Math.min(b,k-e.left)}const JT=Un({name:"QMenu",inheritAttrs:!1,props:{...nz,...Pv,...io,...$T,persistent:Boolean,autoClose:Boolean,separateClosePopup:Boolean,noRouteDismiss:Boolean,noRefocus:Boolean,noFocus:Boolean,fit:Boolean,cover:Boolean,square:Boolean,anchor:{type:String,validator:O1},self:{type:String,validator:O1},offset:{type:Array,validator:_z},scrollTarget:{default:void 0},touchPosition:Boolean,maxHeight:{type:String,default:null},maxWidth:{type:String,default:null}},emits:[...zv,"click","escape-key"],setup(e,{slots:s,emit:u,attrs:f}){let m=null,v,b,o;const S=In(),{proxy:k}=S,{$q:I}=k,L=xt(null),D=xt(!1),N=se(()=>e.persistent!==!0&&e.noRouteDismiss!==!0),j=ro(e,I),{registerTick:Z,removeTick:K}=GT(),{registerTimeout:fe}=Rv(),{transition:te,transitionStyle:ve}=uz(e,D),{localScrollTarget:Ce,changeScrollEvent:ce,unconfigureScrollTarget:pe}=rz(e,jt),{anchorEl:Te,canShow:Me}=iz({showing:D}),{hide:Ie}=Lv({showing:D,canShow:Me,handleShow:Ve,handleHide:mt,hideOnRouteChange:N,processOnMount:!0}),{showPortal:ke,hidePortal:Be,renderPortal:Re}=qT(S,L,_t),Ze={anchorEl:Te,innerRef:L,onClickOutside(ft){if(e.persistent!==!0&&D.value===!0)return Ie(ft),(ft.type==="touchstart"||ft.target.classList.contains("q-dialog__backdrop"))&&zi(ft),!0}},Ye=se(()=>B1(e.anchor||(e.cover===!0?"center middle":"bottom start"),I.lang.rtl)),lt=se(()=>e.cover===!0?Ye.value:B1(e.self||"top start",I.lang.rtl)),Xt=se(()=>(e.square===!0?" q-menu--square":"")+(j.value===!0?" q-menu--dark q-dark":"")),Ge=se(()=>e.autoClose===!0?{onClick:xn}:{}),At=se(()=>D.value===!0&&e.persistent!==!0);Ht(At,ft=>{ft===!0?(XT(gt),gz(Ze)):(gm(gt),L1(Ze))});function tn(){Km(()=>{let ft=L.value;ft&&ft.contains(document.activeElement)!==!0&&(ft=ft.querySelector("[autofocus], [data-autofocus]")||ft,ft.focus({preventScroll:!0}))})}function Ve(ft){if(m=e.noRefocus===!1?document.activeElement:null,YT(rt),ke(),jt(),v=void 0,ft!==void 0&&(e.touchPosition||e.contextMenu)){const sn=ic(ft);if(sn.left!==void 0){const{top:un,left:oe}=Te.value.getBoundingClientRect();v={left:sn.left-oe,top:sn.top-un}}}b===void 0&&(b=Ht(()=>I.screen.width+"|"+I.screen.height+"|"+e.self+"|"+e.anchor+"|"+I.lang.rtl,ot)),e.noFocus!==!0&&document.activeElement.blur(),Z(()=>{ot(),e.noFocus!==!0&&tn()}),fe(()=>{I.platform.is.ios===!0&&(o=e.autoClose,L.value.click()),ot(),ke(!0),u("show",ft)},e.transitionDuration)}function mt(ft){K(),Be(),Bt(!0),m!==null&&(ft===void 0||ft.qClickOutside!==!0)&&(m.focus(),m=null),fe(()=>{Be(!0),u("hide",ft)},e.transitionDuration)}function Bt(ft){v=void 0,b!==void 0&&(b(),b=void 0),(ft===!0||D.value===!0)&&(Ry(rt),pe(),L1(Ze),gm(gt)),ft!==!0&&(m=null)}function jt(){(Te.value!==null||e.scrollTarget!==void 0)&&(Ce.value=Dv(Te.value,e.scrollTarget),ce(Ce.value,ot))}function xn(ft){o!==!0?(jT(k,ft),u("click",ft)):o=!1}function rt(ft){At.value===!0&&e.noFocus!==!0&&AT(L.value,ft.target)!==!0&&tn()}function gt(ft){u("escape-key"),Ie(ft)}function ot(){const ft=L.value;ft===null||Te.value===null||xz({el:ft,offset:e.offset,anchorEl:Te.value,anchorOrigin:Ye.value,selfOrigin:lt.value,absoluteOffset:v,fit:e.fit,cover:e.cover,maxHeight:e.maxHeight,maxWidth:e.maxWidth})}function _t(){return me(ea,{name:te.value,appear:!0},()=>D.value===!0?me("div",{role:"menu",...f,ref:L,tabindex:-1,class:["q-menu q-position-engine scroll"+Xt.value,f.class],style:[f.style,ve.value],...Ge.value},bi(s.default)):null)}return Ii(Bt),Object.assign(k,{focus:tn,updatePosition:ot}),Re}}),wz=["top","middle","bottom"],F1=Un({name:"QBadge",props:{color:String,textColor:String,floating:Boolean,transparent:Boolean,multiLine:Boolean,outline:Boolean,rounded:Boolean,label:[Number,String],align:{type:String,validator:e=>wz.includes(e)}},setup(e,{slots:s}){const u=se(()=>e.align!==void 0?{verticalAlign:e.align}:null),f=se(()=>{const m=e.outline===!0&&e.color||e.textColor;return`q-badge flex inline items-center no-wrap q-badge--${e.multiLine===!0?"multi":"single"}-line`+(e.outline===!0?" q-badge--outline":e.color!==void 0?` bg-${e.color}`:"")+(m!==void 0?` text-${m}`:"")+(e.floating===!0?" q-badge--floating":"")+(e.rounded===!0?" q-badge--rounded":"")+(e.transparent===!0?" q-badge--transparent":"")});return()=>me("div",{class:f.value,style:u.value,role:"status","aria-label":e.label},Ro(s.default,e.label!==void 0?[e.label]:[]))}}),eS=Un({name:"QToolbar",props:{inset:Boolean},setup(e,{slots:s}){const u=se(()=>"q-toolbar row no-wrap items-center"+(e.inset===!0?" q-toolbar--inset":""));return()=>me("div",{class:u.value,role:"toolbar"},bi(s.default))}});function Ez(){const e=xt(!Ss.value);return e.value===!1&&Ui(()=>{e.value=!0}),e}const tS=typeof ResizeObserver<"u",N1=tS===!0?{}:{style:"display:block;position:absolute;top:0;left:0;right:0;bottom:0;height:100%;width:100%;overflow:hidden;pointer-events:none;z-index:-1;",url:"about:blank"},Oy=Un({name:"QResizeObserver",props:{debounce:{type:[String,Number],default:100}},emits:["resize"],setup(e,{emit:s}){let u=null,f,m={width:-1,height:-1};function v(S){S===!0||e.debounce===0||e.debounce==="0"?b():u===null&&(u=setTimeout(b,e.debounce))}function b(){if(clearTimeout(u),u=null,f){const{offsetWidth:S,offsetHeight:k}=f;(S!==m.width||k!==m.height)&&(m={width:S,height:k},s("resize",m))}}const{proxy:o}=In();if(tS===!0){let S;const k=I=>{f=o.$el.parentNode,f?(S=new ResizeObserver(v),S.observe(f),b()):I!==!0&&ui(()=>{k(!0)})};return Ui(()=>{k()}),Ii(()=>{clearTimeout(u),S!==void 0&&(S.disconnect!==void 0?S.disconnect():f&&S.unobserve(f))}),Cs}else{let I=function(){clearTimeout(u),k!==void 0&&(k.removeEventListener!==void 0&&k.removeEventListener("resize",v,Xi.passive),k=void 0)},L=function(){I(),f&&f.contentDocument&&(k=f.contentDocument.defaultView,k.addEventListener("resize",v,Xi.passive),b())};const S=Ez();let k;return Ui(()=>{ui(()=>{f=o.$el,f&&L()})}),Ii(I),o.trigger=v,()=>{if(S.value===!0)return me("object",{style:N1.style,tabindex:-1,type:"text/html",data:N1.url,"aria-hidden":"true",onLoad:L})}}}}),Tz=Un({name:"QHeader",props:{modelValue:{type:Boolean,default:!0},reveal:Boolean,revealOffset:{type:Number,default:250},bordered:Boolean,elevated:Boolean,heightHint:{type:[String,Number],default:50}},emits:["reveal","focusin"],setup(e,{slots:s,emit:u}){const{proxy:{$q:f}}=In(),m=Ur(Zm,Xs);if(m===Xs)return console.error("QHeader needs to be child of QLayout"),Xs;const v=xt(parseInt(e.heightHint,10)),b=xt(!0),o=se(()=>e.reveal===!0||m.view.value.indexOf("H")>-1||f.platform.is.ios&&m.isContainer.value===!0),S=se(()=>{if(e.modelValue!==!0)return 0;if(o.value===!0)return b.value===!0?v.value:0;const te=v.value-m.scroll.value.position;return te>0?te:0}),k=se(()=>e.modelValue!==!0||o.value===!0&&b.value!==!0),I=se(()=>e.modelValue===!0&&k.value===!0&&e.reveal===!0),L=se(()=>"q-header q-layout__section--marginal "+(o.value===!0?"fixed":"absolute")+"-top"+(e.bordered===!0?" q-header--bordered":"")+(k.value===!0?" q-header--hidden":"")+(e.modelValue!==!0?" q-layout--prevent-focus":"")),D=se(()=>{const te=m.rows.value.top,ve={};return te[0]==="l"&&m.left.space===!0&&(ve[f.lang.rtl===!0?"right":"left"]=`${m.left.size}px`),te[2]==="r"&&m.right.space===!0&&(ve[f.lang.rtl===!0?"left":"right"]=`${m.right.size}px`),ve});function N(te,ve){m.update("header",te,ve)}function j(te,ve){te.value!==ve&&(te.value=ve)}function Z({height:te}){j(v,te),N("size",te)}function K(te){I.value===!0&&j(b,!0),u("focusin",te)}Ht(()=>e.modelValue,te=>{N("space",te),j(b,!0),m.animate()}),Ht(S,te=>{N("offset",te)}),Ht(()=>e.reveal,te=>{te===!1&&j(b,e.modelValue)}),Ht(b,te=>{m.animate(),u("reveal",te)}),Ht(m.scroll,te=>{e.reveal===!0&&j(b,te.direction==="up"||te.position<=e.revealOffset||te.position-te.inflectionPoint<100)});const fe={};return m.instances.header=fe,e.modelValue===!0&&N("size",v.value),N("space",e.modelValue),N("offset",S.value),Ii(()=>{m.instances.header===fe&&(m.instances.header=void 0,N("size",0),N("offset",0),N("space",!1))}),()=>{const te=Av(s.default,[]);return e.elevated===!0&&te.push(me("div",{class:"q-layout__shadow absolute-full overflow-hidden no-pointer-events"})),te.push(me(Oy,{debounce:0,onResize:Z})),me("header",{class:L.value,style:D.value,onFocusin:K},te)}}});function nS(e,s,u){let f;function m(){f!==void 0&&(Nd.remove(f),f=void 0)}return Ii(()=>{e.value===!0&&m()}),{removeFromHistory:m,addToHistory(){f={condition:()=>u.value===!0,handler:s},Nd.add(f)}}}let fd=0,G_,Z_,xd,W_=!1,V1,U1,hu;function Sz(e){Cz(e)&&zi(e)}function Cz(e){if(e.target===document.body||e.target.classList.contains("q-layout__backdrop"))return!0;const s=Wk(e),u=e.shiftKey&&!e.deltaX,f=!u&&Math.abs(e.deltaX)<=Math.abs(e.deltaY),m=u||f?e.deltaY:e.deltaX;for(let v=0;v<s.length;v++){const b=s[v];if(dz(b,f))return f?m<0&&b.scrollTop===0?!0:m>0&&b.scrollTop+b.clientHeight===b.scrollHeight:m<0&&b.scrollLeft===0?!0:m>0&&b.scrollLeft+b.clientWidth===b.scrollWidth}return!0}function j1(e){e.target===document&&(document.scrollingElement.scrollTop=document.scrollingElement.scrollTop)}function Op(e){W_!==!0&&(W_=!0,requestAnimationFrame(()=>{W_=!1;const{height:s}=e.target,{clientHeight:u,scrollTop:f}=document.scrollingElement;(xd===void 0||s!==window.innerHeight)&&(xd=u-s,document.scrollingElement.scrollTop=f),f>xd&&(document.scrollingElement.scrollTop-=Math.ceil((f-xd)/8))}))}function q1(e){const s=document.body,u=window.visualViewport!==void 0;if(e==="add"){const{overflowY:f,overflowX:m}=window.getComputedStyle(s);G_=WT(window),Z_=ZT(window),V1=s.style.left,U1=s.style.top,s.style.left=`-${G_}px`,s.style.top=`-${Z_}px`,m!=="hidden"&&(m==="scroll"||s.scrollWidth>window.innerWidth)&&s.classList.add("q-body--force-scrollbar-x"),f!=="hidden"&&(f==="scroll"||s.scrollHeight>window.innerHeight)&&s.classList.add("q-body--force-scrollbar-y"),s.classList.add("q-body--prevent-scroll"),document.qScrollPrevented=!0,hi.is.ios===!0&&(u===!0?(window.scrollTo(0,0),window.visualViewport.addEventListener("resize",Op,Xi.passiveCapture),window.visualViewport.addEventListener("scroll",Op,Xi.passiveCapture),window.scrollTo(0,0)):window.addEventListener("scroll",j1,Xi.passiveCapture))}hi.is.desktop===!0&&hi.is.mac===!0&&window[`${e}EventListener`]("wheel",Sz,Xi.notPassive),e==="remove"&&(hi.is.ios===!0&&(u===!0?(window.visualViewport.removeEventListener("resize",Op,Xi.passiveCapture),window.visualViewport.removeEventListener("scroll",Op,Xi.passiveCapture)):window.removeEventListener("scroll",j1,Xi.passiveCapture)),s.classList.remove("q-body--prevent-scroll"),s.classList.remove("q-body--force-scrollbar-x"),s.classList.remove("q-body--force-scrollbar-y"),document.qScrollPrevented=!1,s.style.left=V1,s.style.top=U1,window.scrollTo(G_,Z_),xd=void 0)}function Az(e){let s="add";if(e===!0){if(fd++,hu!==void 0){clearTimeout(hu),hu=void 0;return}if(fd>1)return}else{if(fd===0||(fd--,fd>0))return;if(s="remove",hi.is.ios===!0&&hi.is.nativeMobile===!0){clearTimeout(hu),hu=setTimeout(()=>{q1(s),hu=void 0},100);return}}q1(s)}function iS(){let e;return{preventBodyScroll(s){s!==e&&(e!==void 0||s===!0)&&(e=s,Az(s))}}}const Ov={left:!0,right:!0,up:!0,down:!0,horizontal:!0,vertical:!0},Mz=Object.keys(Ov);Ov.all=!0;function vm(e){const s={};for(const u of Mz)e[u]===!0&&(s[u]=!0);return Object.keys(s).length===0?Ov:(s.horizontal===!0?s.left=s.right=!0:s.left===!0&&s.right===!0&&(s.horizontal=!0),s.vertical===!0?s.up=s.down=!0:s.up===!0&&s.down===!0&&(s.vertical=!0),s.horizontal===!0&&s.vertical===!0&&(s.all=!0),s)}function xm(e,s){return s.event===void 0&&e.target!==void 0&&e.target.draggable!==!0&&typeof s.handler=="function"&&e.target.nodeName.toUpperCase()!=="INPUT"&&(e.qClonedBy===void 0||e.qClonedBy.indexOf(s.uid)===-1)}function H_(e,s,u){const f=ic(e);let m,v=f.left-s.event.x,b=f.top-s.event.y,o=Math.abs(v),S=Math.abs(b);const k=s.direction;k.horizontal===!0&&k.vertical!==!0?m=v<0?"left":"right":k.horizontal!==!0&&k.vertical===!0?m=b<0?"up":"down":k.up===!0&&b<0?(m="up",o>S&&(k.left===!0&&v<0?m="left":k.right===!0&&v>0&&(m="right"))):k.down===!0&&b>0?(m="down",o>S&&(k.left===!0&&v<0?m="left":k.right===!0&&v>0&&(m="right"))):k.left===!0&&v<0?(m="left",o<S&&(k.up===!0&&b<0?m="up":k.down===!0&&b>0&&(m="down"))):k.right===!0&&v>0&&(m="right",o<S&&(k.up===!0&&b<0?m="up":k.down===!0&&b>0&&(m="down")));let I=!1;if(m===void 0&&u===!1){if(s.event.isFirst===!0||s.event.lastDir===void 0)return{};m=s.event.lastDir,I=!0,m==="left"||m==="right"?(f.left-=v,o=0,v=0):(f.top-=b,S=0,b=0)}return{synthetic:I,payload:{evt:e,touch:s.event.mouse!==!0,mouse:s.event.mouse===!0,position:f,direction:m,isFirst:s.event.isFirst,isFinal:u===!0,duration:Date.now()-s.event.time,distance:{x:o,y:S},offset:{x:v,y:b},delta:{x:f.left-s.event.lastX,y:f.top-s.event.lastY}}}}let Iz=0;const X_=Hm({name:"touch-pan",beforeMount(e,{value:s,modifiers:u}){if(u.mouse!==!0&&hi.has.touch!==!0)return;function f(v,b){u.mouse===!0&&b===!0?zi(v):(u.stop===!0&&to(v),u.prevent===!0&&Nr(v))}const m={uid:"qvtp_"+Iz++,handler:s,modifiers:u,direction:vm(u),noop:Cs,mouseStart(v){xm(v,m)&&fT(v)&&(Qo(m,"temp",[[document,"mousemove","move","notPassiveCapture"],[document,"mouseup","end","passiveCapture"]]),m.start(v,!0))},touchStart(v){if(xm(v,m)){const b=v.target;Qo(m,"temp",[[b,"touchmove","move","notPassiveCapture"],[b,"touchcancel","end","passiveCapture"],[b,"touchend","end","passiveCapture"]]),m.start(v)}},start(v,b){if(hi.is.firefox===!0&&bu(e,!0),m.lastEvt=v,b===!0||u.stop===!0){if(m.direction.all!==!0&&(b!==!0||m.modifiers.mouseAllDir!==!0&&m.modifiers.mousealldir!==!0)){const k=v.type.indexOf("mouse")>-1?new MouseEvent(v.type,v):new TouchEvent(v.type,v);v.defaultPrevented===!0&&Nr(k),v.cancelBubble===!0&&to(k),Object.assign(k,{qKeyEvent:v.qKeyEvent,qClickOutside:v.qClickOutside,qAnchorHandled:v.qAnchorHandled,qClonedBy:v.qClonedBy===void 0?[m.uid]:v.qClonedBy.concat(m.uid)}),m.initialEvent={target:v.target,event:k}}to(v)}const{left:o,top:S}=ic(v);m.event={x:o,y:S,time:Date.now(),mouse:b===!0,detected:!1,isFirst:!0,isFinal:!1,lastX:o,lastY:S}},move(v){if(m.event===void 0)return;const b=ic(v),o=b.left-m.event.x,S=b.top-m.event.y;if(o===0&&S===0)return;m.lastEvt=v;const k=m.event.mouse===!0,I=()=>{f(v,k);let N;u.preserveCursor!==!0&&u.preservecursor!==!0&&(N=document.documentElement.style.cursor||"",document.documentElement.style.cursor="grabbing"),k===!0&&document.body.classList.add("no-pointer-events--children"),document.body.classList.add("non-selectable"),kv(),m.styleCleanup=j=>{if(m.styleCleanup=void 0,N!==void 0&&(document.documentElement.style.cursor=N),document.body.classList.remove("non-selectable"),k===!0){const Z=()=>{document.body.classList.remove("no-pointer-events--children")};j!==void 0?setTimeout(()=>{Z(),j()},50):Z()}else j!==void 0&&j()}};if(m.event.detected===!0){m.event.isFirst!==!0&&f(v,m.event.mouse);const{payload:N,synthetic:j}=H_(v,m,!1);N!==void 0&&(m.handler(N)===!1?m.end(v):(m.styleCleanup===void 0&&m.event.isFirst===!0&&I(),m.event.lastX=N.position.left,m.event.lastY=N.position.top,m.event.lastDir=j===!0?void 0:N.direction,m.event.isFirst=!1));return}if(m.direction.all===!0||k===!0&&(m.modifiers.mouseAllDir===!0||m.modifiers.mousealldir===!0)){I(),m.event.detected=!0,m.move(v);return}const L=Math.abs(o),D=Math.abs(S);L!==D&&(m.direction.horizontal===!0&&L>D||m.direction.vertical===!0&&L<D||m.direction.up===!0&&L<D&&S<0||m.direction.down===!0&&L<D&&S>0||m.direction.left===!0&&L>D&&o<0||m.direction.right===!0&&L>D&&o>0?(m.event.detected=!0,m.move(v)):m.end(v,!0))},end(v,b){if(m.event!==void 0){if(Ga(m,"temp"),hi.is.firefox===!0&&bu(e,!1),b===!0)m.styleCleanup!==void 0&&m.styleCleanup(),m.event.detected!==!0&&m.initialEvent!==void 0&&m.initialEvent.target.dispatchEvent(m.initialEvent.event);else if(m.event.detected===!0){m.event.isFirst===!0&&m.handler(H_(v===void 0?m.lastEvt:v,m).payload);const{payload:o}=H_(v===void 0?m.lastEvt:v,m,!0),S=()=>{m.handler(o)};m.styleCleanup!==void 0?m.styleCleanup(S):S()}m.event=void 0,m.initialEvent=void 0,m.lastEvt=void 0}}};if(e.__qtouchpan=m,u.mouse===!0){const v=u.mouseCapture===!0||u.mousecapture===!0?"Capture":"";Qo(m,"main",[[e,"mousedown","mouseStart",`passive${v}`]])}hi.has.touch===!0&&Qo(m,"main",[[e,"touchstart","touchStart",`passive${u.capture===!0?"Capture":""}`],[e,"touchmove","noop","notPassiveCapture"]])},updated(e,s){const u=e.__qtouchpan;u!==void 0&&(s.oldValue!==s.value&&(typeof value!="function"&&u.end(),u.handler=s.value),u.direction=vm(s.modifiers))},beforeUnmount(e){const s=e.__qtouchpan;s!==void 0&&(s.event!==void 0&&s.end(),Ga(s,"main"),Ga(s,"temp"),hi.is.firefox===!0&&bu(e,!1),s.styleCleanup!==void 0&&s.styleCleanup(),delete e.__qtouchpan)}}),$1=["B","KB","MB","GB","TB","PB"];function kz(e){let s=0;for(;parseInt(e,10)>=1024&&s<$1.length-1;)e/=1024,++s;return`${e.toFixed(1)}${$1[s]}`}function Bp(e,s,u){return u<=s?s:Math.min(u,Math.max(s,e))}function G1(e,s,u){if(u<=s)return s;const f=u-s+1;let m=s+(e-s)%f;return m<s&&(m=f+m),m===0?0:m}const Z1=150,Pz=Un({name:"QDrawer",inheritAttrs:!1,props:{...Pv,...io,side:{type:String,default:"left",validator:e=>["left","right"].includes(e)},width:{type:Number,default:300},mini:Boolean,miniToOverlay:Boolean,miniWidth:{type:Number,default:57},breakpoint:{type:Number,default:1023},showIfAbove:Boolean,behavior:{type:String,validator:e=>["default","desktop","mobile"].includes(e),default:"default"},bordered:Boolean,elevated:Boolean,overlay:Boolean,persistent:Boolean,noSwipeOpen:Boolean,noSwipeClose:Boolean,noSwipeBackdrop:Boolean},emits:[...zv,"on-layout","mini-state"],setup(e,{slots:s,emit:u,attrs:f}){const m=In(),{proxy:{$q:v}}=m,b=ro(e,v),{preventBodyScroll:o}=iS(),{registerTimeout:S,removeTimeout:k}=Rv(),I=Ur(Zm,Xs);if(I===Xs)return console.error("QDrawer needs to be child of QLayout"),Xs;let L,D,N;const j=xt(e.behavior==="mobile"||e.behavior!=="desktop"&&I.totalWidth.value<=e.breakpoint),Z=se(()=>e.mini===!0&&j.value!==!0),K=se(()=>Z.value===!0?e.miniWidth:e.width),fe=xt(e.showIfAbove===!0&&j.value===!1?!0:e.modelValue===!0),te=se(()=>e.persistent!==!0&&(j.value===!0||Ve.value===!0));function ve(et,Rt){if(Te(),et!==!1&&I.animate(),be(0),j.value===!0){const nn=I.instances[Xt.value];nn!==void 0&&nn.belowBreakpoint===!0&&nn.hide(!1),Fe(1),I.isContainer.value!==!0&&o(!0)}else Fe(0),et!==!1&&nt(!1);S(()=>{et!==!1&&nt(!0),Rt!==!0&&u("show",et)},Z1)}function Ce(et,Rt){Me(),et!==!1&&I.animate(),Fe(0),be(Be.value*K.value),kt(),Rt!==!0?S(()=>{u("hide",et)},Z1):k()}const{show:ce,hide:pe}=Lv({showing:fe,hideOnRouteChange:te,handleShow:ve,handleHide:Ce}),{addToHistory:Te,removeFromHistory:Me}=nS(fe,pe,te),Ie={belowBreakpoint:j,hide:pe},ke=se(()=>e.side==="right"),Be=se(()=>(v.lang.rtl===!0?-1:1)*(ke.value===!0?1:-1)),Re=xt(0),Ze=xt(!1),Ye=xt(!1),lt=xt(K.value*Be.value),Xt=se(()=>ke.value===!0?"left":"right"),Ge=se(()=>fe.value===!0&&j.value===!1&&e.overlay===!1?e.miniToOverlay===!0?e.miniWidth:K.value:0),At=se(()=>e.overlay===!0||e.miniToOverlay===!0||I.view.value.indexOf(ke.value?"R":"L")>-1||v.platform.is.ios===!0&&I.isContainer.value===!0),tn=se(()=>e.overlay===!1&&fe.value===!0&&j.value===!1),Ve=se(()=>e.overlay===!0&&fe.value===!0&&j.value===!1),mt=se(()=>"fullscreen q-drawer__backdrop"+(fe.value===!1&&Ze.value===!1?" hidden":"")),Bt=se(()=>({backgroundColor:`rgba(0,0,0,${Re.value*.4})`})),jt=se(()=>ke.value===!0?I.rows.value.top[2]==="r":I.rows.value.top[0]==="l"),xn=se(()=>ke.value===!0?I.rows.value.bottom[2]==="r":I.rows.value.bottom[0]==="l"),rt=se(()=>{const et={};return I.header.space===!0&&jt.value===!1&&(At.value===!0?et.top=`${I.header.offset}px`:I.header.space===!0&&(et.top=`${I.header.size}px`)),I.footer.space===!0&&xn.value===!1&&(At.value===!0?et.bottom=`${I.footer.offset}px`:I.footer.space===!0&&(et.bottom=`${I.footer.size}px`)),et}),gt=se(()=>{const et={width:`${K.value}px`,transform:`translateX(${lt.value}px)`};return j.value===!0?et:Object.assign(et,rt.value)}),ot=se(()=>"q-drawer__content fit "+(I.isContainer.value!==!0?"scroll":"overflow-auto")),_t=se(()=>`q-drawer q-drawer--${e.side}`+(Ye.value===!0?" q-drawer--mini-animate":"")+(e.bordered===!0?" q-drawer--bordered":"")+(b.value===!0?" q-drawer--dark q-dark":"")+(Ze.value===!0?" no-transition":fe.value===!0?"":" q-layout--prevent-focus")+(j.value===!0?" fixed q-drawer--on-top q-drawer--mobile q-drawer--top-padding":` q-drawer--${Z.value===!0?"mini":"standard"}`+(At.value===!0||tn.value!==!0?" fixed":"")+(e.overlay===!0||e.miniToOverlay===!0?" q-drawer--on-top":"")+(jt.value===!0?" q-drawer--top-padding":""))),ft=se(()=>{const et=v.lang.rtl===!0?e.side:Xt.value;return[[X_,zt,void 0,{[et]:!0,mouse:!0}]]}),sn=se(()=>{const et=v.lang.rtl===!0?Xt.value:e.side;return[[X_,Nt,void 0,{[et]:!0,mouse:!0}]]}),un=se(()=>{const et=v.lang.rtl===!0?Xt.value:e.side;return[[X_,Nt,void 0,{[et]:!0,mouse:!0,mouseAllDir:!0}]]});function oe(){Mt(j,e.behavior==="mobile"||e.behavior!=="desktop"&&I.totalWidth.value<=e.breakpoint)}Ht(j,et=>{et===!0?(L=fe.value,fe.value===!0&&pe(!1)):e.overlay===!1&&e.behavior!=="mobile"&&L!==!1&&(fe.value===!0?(be(0),Fe(0),kt()):ce(!1))}),Ht(()=>e.side,(et,Rt)=>{I.instances[Rt]===Ie&&(I.instances[Rt]=void 0,I[Rt].space=!1,I[Rt].offset=0),I.instances[et]=Ie,I[et].size=K.value,I[et].space=tn.value,I[et].offset=Ge.value}),Ht(I.totalWidth,()=>{(I.isContainer.value===!0||document.qScrollPrevented!==!0)&&oe()}),Ht(()=>e.behavior+e.breakpoint,oe),Ht(I.isContainer,et=>{fe.value===!0&&o(et!==!0),et===!0&&oe()}),Ht(I.scrollbarWidth,()=>{be(fe.value===!0?0:void 0)}),Ht(Ge,et=>{bt("offset",et)}),Ht(tn,et=>{u("on-layout",et),bt("space",et)}),Ht(ke,()=>{be()}),Ht(K,et=>{be(),Wt(e.miniToOverlay,et)}),Ht(()=>e.miniToOverlay,et=>{Wt(et,K.value)}),Ht(()=>v.lang.rtl,()=>{be()}),Ht(()=>e.mini,()=>{e.modelValue===!0&&(yt(),I.animate())}),Ht(Z,et=>{u("mini-state",et)});function be(et){et===void 0?ui(()=>{et=fe.value===!0?0:K.value,be(Be.value*et)}):(I.isContainer.value===!0&&ke.value===!0&&(j.value===!0||Math.abs(et)===K.value)&&(et+=Be.value*I.scrollbarWidth.value),lt.value=et)}function Fe(et){Re.value=et}function nt(et){const Rt=et===!0?"remove":I.isContainer.value!==!0?"add":"";Rt!==""&&document.body.classList[Rt]("q-body--drawer-toggle")}function yt(){clearTimeout(D),m.proxy&&m.proxy.$el&&m.proxy.$el.classList.add("q-drawer--mini-animate"),Ye.value=!0,D=setTimeout(()=>{Ye.value=!1,m&&m.proxy&&m.proxy.$el&&m.proxy.$el.classList.remove("q-drawer--mini-animate")},150)}function zt(et){if(fe.value!==!1)return;const Rt=K.value,nn=Bp(et.distance.x,0,Rt);if(et.isFinal===!0){nn>=Math.min(75,Rt)===!0?ce():(I.animate(),Fe(0),be(Be.value*Rt)),Ze.value=!1;return}be((v.lang.rtl===!0?ke.value!==!0:ke.value)?Math.max(Rt-nn,0):Math.min(0,nn-Rt)),Fe(Bp(nn/Rt,0,1)),et.isFirst===!0&&(Ze.value=!0)}function Nt(et){if(fe.value!==!0)return;const Rt=K.value,nn=et.direction===e.side,bn=(v.lang.rtl===!0?nn!==!0:nn)?Bp(et.distance.x,0,Rt):0;if(et.isFinal===!0){Math.abs(bn)<Math.min(75,Rt)===!0?(I.animate(),Fe(1),be(0)):pe(),Ze.value=!1;return}be(Be.value*bn),Fe(Bp(1-bn/Rt,0,1)),et.isFirst===!0&&(Ze.value=!0)}function kt(){o(!1),nt(!0)}function bt(et,Rt){I.update(e.side,et,Rt)}function Mt(et,Rt){et.value!==Rt&&(et.value=Rt)}function Wt(et,Rt){bt("size",et===!0?e.miniWidth:Rt)}return I.instances[e.side]=Ie,Wt(e.miniToOverlay,K.value),bt("space",tn.value),bt("offset",Ge.value),e.showIfAbove===!0&&e.modelValue!==!0&&fe.value===!0&&e["onUpdate:modelValue"]!==void 0&&u("update:modelValue",!0),Ui(()=>{u("on-layout",tn.value),u("mini-state",Z.value),L=e.showIfAbove===!0;const et=()=>{(fe.value===!0?ve:Ce)(!1,!0)};if(I.totalWidth.value!==0){ui(et);return}N=Ht(I.totalWidth,()=>{N(),N=void 0,fe.value===!1&&e.showIfAbove===!0&&j.value===!1?ce(!1):et()})}),Ii(()=>{N!==void 0&&N(),clearTimeout(D),fe.value===!0&&kt(),I.instances[e.side]===Ie&&(I.instances[e.side]=void 0,bt("size",0),bt("offset",0),bt("space",!1))}),()=>{const et=[];j.value===!0&&(e.noSwipeOpen===!1&&et.push(Ql(me("div",{key:"open",class:`q-drawer__opener fixed-${e.side}`,"aria-hidden":"true"}),ft.value)),et.push(mm("div",{ref:"backdrop",class:mt.value,style:Bt.value,"aria-hidden":"true",onClick:pe},void 0,"backdrop",e.noSwipeBackdrop!==!0&&fe.value===!0,()=>un.value)));const Rt=Z.value===!0&&s.mini!==void 0,nn=[me("div",{...f,key:""+Rt,class:[ot.value,f.class]},Rt===!0?s.mini():bi(s.default))];return e.elevated===!0&&fe.value===!0&&nn.push(me("div",{class:"q-layout__shadow absolute-full overflow-hidden no-pointer-events"})),et.push(mm("aside",{ref:"content",class:_t.value,style:gt.value},nn,"contentclose",e.noSwipeClose!==!0&&j.value===!0,()=>sn.value)),me("div",{class:"q-drawer-container"},et)}}}),zz=Un({name:"QPageContainer",setup(e,{slots:s}){const{proxy:{$q:u}}=In(),f=Ur(Zm,Xs);if(f===Xs)return console.error("QPageContainer needs to be child of QLayout"),Xs;Yl(oP,!0);const m=se(()=>{const v={};return f.header.space===!0&&(v.paddingTop=`${f.header.size}px`),f.right.space===!0&&(v[`padding${u.lang.rtl===!0?"Left":"Right"}`]=`${f.right.size}px`),f.footer.space===!0&&(v.paddingBottom=`${f.footer.size}px`),f.left.space===!0&&(v[`padding${u.lang.rtl===!0?"Right":"Left"}`]=`${f.left.size}px`),v});return()=>me("div",{class:"q-page-container",style:m.value},bi(s.default))}}),{passive:W1}=Xi,Lz=["both","horizontal","vertical"],Rz=Un({name:"QScrollObserver",props:{axis:{type:String,validator:e=>Lz.includes(e),default:"vertical"},debounce:[String,Number],scrollTarget:{default:void 0}},emits:["scroll"],setup(e,{emit:s}){const u={position:{top:0,left:0},direction:"down",directionChanged:!1,delta:{top:0,left:0},inflectionPoint:{top:0,left:0}};let f=null,m,v;Ht(()=>e.scrollTarget,()=>{S(),o()});function b(){f!==null&&f();const L=Math.max(0,ZT(m)),D=WT(m),N={top:L-u.position.top,left:D-u.position.left};if(e.axis==="vertical"&&N.top===0||e.axis==="horizontal"&&N.left===0)return;const j=Math.abs(N.top)>=Math.abs(N.left)?N.top<0?"up":"down":N.left<0?"left":"right";u.position={top:L,left:D},u.directionChanged=u.direction!==j,u.delta=N,u.directionChanged===!0&&(u.direction=j,u.inflectionPoint=u.position),s("scroll",{...u})}function o(){m=Dv(v,e.scrollTarget),m.addEventListener("scroll",k,W1),k(!0)}function S(){m!==void 0&&(m.removeEventListener("scroll",k,W1),m=void 0)}function k(L){if(L===!0||e.debounce===0||e.debounce==="0")b();else if(f===null){const[D,N]=e.debounce?[setTimeout(b,e.debounce),clearTimeout]:[requestAnimationFrame(b),cancelAnimationFrame];f=()=>{N(D),f=null}}}const{proxy:I}=In();return Ui(()=>{v=I.$el.parentNode,o()}),Ii(()=>{f!==null&&f(),S()}),Object.assign(I,{trigger:k,getPosition:()=>u}),Cs}}),Dz=Un({name:"QLayout",props:{container:Boolean,view:{type:String,default:"hhh lpr fff",validator:e=>/^(h|l)h(h|r) lpr (f|l)f(f|r)$/.test(e.toLowerCase())},onScroll:Function,onScrollHeight:Function,onResize:Function},setup(e,{slots:s,emit:u}){const{proxy:{$q:f}}=In(),m=xt(null),v=xt(f.screen.height),b=xt(e.container===!0?0:f.screen.width),o=xt({position:0,direction:"down",inflectionPoint:0}),S=xt(0),k=xt(Ss.value===!0?0:Kp()),I=se(()=>"q-layout q-layout--"+(e.container===!0?"containerized":"standard")),L=se(()=>e.container===!1?{minHeight:f.screen.height+"px"}:null),D=se(()=>k.value!==0?{[f.lang.rtl===!0?"left":"right"]:`${k.value}px`}:null),N=se(()=>k.value!==0?{[f.lang.rtl===!0?"right":"left"]:0,[f.lang.rtl===!0?"left":"right"]:`-${k.value}px`,width:`calc(100% + ${k.value}px)`}:null);function j(Ce){if(e.container===!0||document.qScrollPrevented!==!0){const ce={position:Ce.position.top,direction:Ce.direction,directionChanged:Ce.directionChanged,inflectionPoint:Ce.inflectionPoint.top,delta:Ce.delta.top};o.value=ce,e.onScroll!==void 0&&u("scroll",ce)}}function Z(Ce){const{height:ce,width:pe}=Ce;let Te=!1;v.value!==ce&&(Te=!0,v.value=ce,e.onScrollHeight!==void 0&&u("scroll-height",ce),fe()),b.value!==pe&&(Te=!0,b.value=pe),Te===!0&&e.onResize!==void 0&&u("resize",Ce)}function K({height:Ce}){S.value!==Ce&&(S.value=Ce,fe())}function fe(){if(e.container===!0){const Ce=v.value>S.value?Kp():0;k.value!==Ce&&(k.value=Ce)}}let te;const ve={instances:{},view:se(()=>e.view),isContainer:se(()=>e.container),rootRef:m,height:v,containerHeight:S,scrollbarWidth:k,totalWidth:se(()=>b.value+k.value),rows:se(()=>{const Ce=e.view.toLowerCase().split(" ");return{top:Ce[0].split(""),middle:Ce[1].split(""),bottom:Ce[2].split("")}}),header:Lo({size:0,offset:0,space:!1}),right:Lo({size:300,offset:0,space:!1}),footer:Lo({size:0,offset:0,space:!1}),left:Lo({size:300,offset:0,space:!1}),scroll:o,animate(){te!==void 0?clearTimeout(te):document.body.classList.add("q-body--layout-animate"),te=setTimeout(()=>{document.body.classList.remove("q-body--layout-animate"),te=void 0},155)},update(Ce,ce,pe){ve[Ce][ce]=pe}};if(Yl(Zm,ve),Kp()>0){let pe=function(){Ce=null,ce.classList.remove("hide-scrollbar")},Te=function(){if(Ce===null){if(ce.scrollHeight>f.screen.height)return;ce.classList.add("hide-scrollbar")}else clearTimeout(Ce);Ce=setTimeout(pe,300)},Me=function(Ie){Ce!==null&&Ie==="remove"&&(clearTimeout(Ce),pe()),window[`${Ie}EventListener`]("resize",Te)},Ce=null;const ce=document.body;Ht(()=>e.container!==!0?"add":"remove",Me),e.container!==!0&&Me("add"),ia(()=>{Me("remove")})}return()=>{const Ce=Ro(s.default,[me(Rz,{onScroll:j}),me(Oy,{onResize:Z})]),ce=me("div",{class:I.value,style:L.value,ref:e.container===!0?void 0:m,tabindex:-1},Ce);return e.container===!0?me("div",{class:"q-layout-container overflow-hidden",ref:m},[me(Oy,{onResize:K}),me("div",{class:"absolute-full",style:D.value},[me("div",{class:"scroll",style:N.value},[ce])])]):ce}}}),Yp=Un({name:"QItemSection",props:{avatar:Boolean,thumbnail:Boolean,side:Boolean,top:Boolean,noWrap:Boolean},setup(e,{slots:s}){const u=se(()=>`q-item__section column q-item__section--${e.avatar===!0||e.side===!0||e.thumbnail===!0?"side":"main"}`+(e.top===!0?" q-item__section--top justify-start":" justify-center")+(e.avatar===!0?" q-item__section--avatar":"")+(e.thumbnail===!0?" q-item__section--thumbnail":"")+(e.noWrap===!0?" q-item__section--nowrap":""));return()=>me("div",{class:u.value},bi(s.default))}}),rS=Un({name:"QItemLabel",props:{overline:Boolean,caption:Boolean,header:Boolean,lines:[Number,String]},setup(e,{slots:s}){const u=se(()=>parseInt(e.lines,10)),f=se(()=>"q-item__label"+(e.overline===!0?" q-item__label--overline text-overline":"")+(e.caption===!0?" q-item__label--caption text-caption":"")+(e.header===!0?" q-item__label--header":"")+(u.value===1?" ellipsis":"")),m=se(()=>e.lines!==void 0&&u.value>1?{overflow:"hidden",display:"-webkit-box","-webkit-box-orient":"vertical","-webkit-line-clamp":u.value}:null);return()=>me("div",{style:m.value,class:f.value},bi(s.default))}}),oS=Un({name:"QItem",props:{...io,...RT,tag:{type:String,default:"div"},active:{type:Boolean,default:null},clickable:Boolean,dense:Boolean,insetLevel:Number,tabindex:[String,Number],focused:Boolean,manualFocus:Boolean},emits:["click","keyup"],setup(e,{slots:s,emit:u}){const{proxy:{$q:f}}=In(),m=ro(e,f),{hasLink:v,linkAttrs:b,linkClass:o,linkTag:S,navigateOnClick:k}=DT(),I=xt(null),L=xt(null),D=se(()=>e.clickable===!0||v.value===!0||e.tag==="label"),N=se(()=>e.disable!==!0&&D.value===!0),j=se(()=>"q-item q-item-type row no-wrap"+(e.dense===!0?" q-item--dense":"")+(m.value===!0?" q-item--dark":"")+(v.value===!0&&e.active===null?o.value:e.active===!0?` q-item--active${e.activeClass!==void 0?` ${e.activeClass}`:""}`:"")+(e.disable===!0?" disabled":"")+(N.value===!0?" q-item--clickable q-link cursor-pointer "+(e.manualFocus===!0?"q-manual-focusable":"q-focusable q-hoverable")+(e.focused===!0?" q-manual-focusable--focused":""):"")),Z=se(()=>e.insetLevel===void 0?null:{["padding"+(f.lang.rtl===!0?"Right":"Left")]:16+e.insetLevel*56+"px"});function K(ve){N.value===!0&&(L.value!==null&&(ve.qKeyEvent!==!0&&document.activeElement===I.value?L.value.focus():document.activeElement===L.value&&I.value.focus()),k(ve))}function fe(ve){if(N.value===!0&&Ha(ve,13)===!0){zi(ve),ve.qKeyEvent=!0;const Ce=new MouseEvent("click",ve);Ce.qKeyEvent=!0,I.value.dispatchEvent(Ce)}u("keyup",ve)}function te(){const ve=Av(s.default,[]);return N.value===!0&&ve.unshift(me("div",{class:"q-focus-helper",tabindex:-1,ref:L})),ve}return()=>{const ve={ref:I,class:j.value,style:Z.value,role:"listitem",onClick:K,onKeyup:fe};return N.value===!0?(ve.tabindex=e.tabindex||"0",Object.assign(ve,b.value)):D.value===!0&&(ve["aria-disabled"]="true"),me(S.value,ve,te())}}}),Oz="modulepreload",Bz=function(e){return"/"+e},H1={},du=function(s,u,f){return!u||u.length===0?s():Promise.all(u.map(m=>{if(m=Bz(m),m in H1)return;H1[m]=!0;const v=m.endsWith(".css"),b=v?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${m}"]${b}`))return;const o=document.createElement("link");if(o.rel=v?"stylesheet":Oz,v||(o.as="script",o.crossOrigin=""),o.href=m,document.head.appendChild(o),v)return new Promise((S,k)=>{o.addEventListener("load",S),o.addEventListener("error",()=>k(new Error(`Unable to preload CSS for ${m}`)))})})).then(()=>s())};/*!
  * vue-router v4.1.5
  * (c) 2022 Eduardo San Martin Morote
  * @license MIT
  */const gu=typeof window<"u";function Fz(e){return e.__esModule||e[Symbol.toStringTag]==="Module"}const xi=Object.assign;function K_(e,s){const u={};for(const f in s){const m=s[f];u[f]=ts(m)?m.map(e):e(m)}return u}const Cd=()=>{},ts=Array.isArray,Nz=/\/$/,Vz=e=>e.replace(Nz,"");function Y_(e,s,u="/"){let f,m={},v="",b="";const o=s.indexOf("#");let S=s.indexOf("?");return o<S&&o>=0&&(S=-1),S>-1&&(f=s.slice(0,S),v=s.slice(S+1,o>-1?o:s.length),m=e(v)),o>-1&&(f=f||s.slice(0,o),b=s.slice(o,s.length)),f=$z(f!=null?f:s,u),{fullPath:f+(v&&"?")+v+b,path:f,query:m,hash:b}}function Uz(e,s){const u=s.query?e(s.query):"";return s.path+(u&&"?")+u+(s.hash||"")}function X1(e,s){return!s||!e.toLowerCase().startsWith(s.toLowerCase())?e:e.slice(s.length)||"/"}function jz(e,s,u){const f=s.matched.length-1,m=u.matched.length-1;return f>-1&&f===m&&zu(s.matched[f],u.matched[m])&&sS(s.params,u.params)&&e(s.query)===e(u.query)&&s.hash===u.hash}function zu(e,s){return(e.aliasOf||e)===(s.aliasOf||s)}function sS(e,s){if(Object.keys(e).length!==Object.keys(s).length)return!1;for(const u in e)if(!qz(e[u],s[u]))return!1;return!0}function qz(e,s){return ts(e)?K1(e,s):ts(s)?K1(s,e):e===s}function K1(e,s){return ts(s)?e.length===s.length&&e.every((u,f)=>u===s[f]):e.length===1&&e[0]===s}function $z(e,s){if(e.startsWith("/"))return e;if(!e)return s;const u=s.split("/"),f=e.split("/");let m=u.length-1,v,b;for(v=0;v<f.length;v++)if(b=f[v],b!==".")if(b==="..")m>1&&m--;else break;return u.slice(0,m).join("/")+"/"+f.slice(v-(v===f.length?1:0)).join("/")}var Ud;(function(e){e.pop="pop",e.push="push"})(Ud||(Ud={}));var Ad;(function(e){e.back="back",e.forward="forward",e.unknown=""})(Ad||(Ad={}));function Gz(e){if(!e)if(gu){const s=document.querySelector("base");e=s&&s.getAttribute("href")||"/",e=e.replace(/^\w+:\/\/[^\/]+/,"")}else e="/";return e[0]!=="/"&&e[0]!=="#"&&(e="/"+e),Vz(e)}const Zz=/^[^#]+#/;function Wz(e,s){return e.replace(Zz,"#")+s}function Hz(e,s){const u=document.documentElement.getBoundingClientRect(),f=e.getBoundingClientRect();return{behavior:s.behavior,left:f.left-u.left-(s.left||0),top:f.top-u.top-(s.top||0)}}const Ym=()=>({left:window.pageXOffset,top:window.pageYOffset});function Xz(e){let s;if("el"in e){const u=e.el,f=typeof u=="string"&&u.startsWith("#"),m=typeof u=="string"?f?document.getElementById(u.slice(1)):document.querySelector(u):u;if(!m)return;s=Hz(m,e)}else s=e;"scrollBehavior"in document.documentElement.style?window.scrollTo(s):window.scrollTo(s.left!=null?s.left:window.pageXOffset,s.top!=null?s.top:window.pageYOffset)}function Y1(e,s){return(history.state?history.state.position-s:-1)+e}const By=new Map;function Kz(e,s){By.set(e,s)}function Yz(e){const s=By.get(e);return By.delete(e),s}let Qz=()=>location.protocol+"//"+location.host;function aS(e,s){const{pathname:u,search:f,hash:m}=s,v=e.indexOf("#");if(v>-1){let o=m.includes(e.slice(v))?e.slice(v).length:1,S=m.slice(o);return S[0]!=="/"&&(S="/"+S),X1(S,"")}return X1(u,e)+f+m}function Jz(e,s,u,f){let m=[],v=[],b=null;const o=({state:D})=>{const N=aS(e,location),j=u.value,Z=s.value;let K=0;if(D){if(u.value=N,s.value=D,b&&b===j){b=null;return}K=Z?D.position-Z.position:0}else f(N);m.forEach(fe=>{fe(u.value,j,{delta:K,type:Ud.pop,direction:K?K>0?Ad.forward:Ad.back:Ad.unknown})})};function S(){b=u.value}function k(D){m.push(D);const N=()=>{const j=m.indexOf(D);j>-1&&m.splice(j,1)};return v.push(N),N}function I(){const{history:D}=window;!D.state||D.replaceState(xi({},D.state,{scroll:Ym()}),"")}function L(){for(const D of v)D();v=[],window.removeEventListener("popstate",o),window.removeEventListener("beforeunload",I)}return window.addEventListener("popstate",o),window.addEventListener("beforeunload",I),{pauseListeners:S,listen:k,destroy:L}}function Q1(e,s,u,f=!1,m=!1){return{back:e,current:s,forward:u,replaced:f,position:window.history.length,scroll:m?Ym():null}}function eL(e){const{history:s,location:u}=window,f={value:aS(e,u)},m={value:s.state};m.value||v(f.value,{back:null,current:f.value,forward:null,position:s.length-1,replaced:!0,scroll:null},!0);function v(S,k,I){const L=e.indexOf("#"),D=L>-1?(u.host&&document.querySelector("base")?e:e.slice(L))+S:Qz()+e+S;try{s[I?"replaceState":"pushState"](k,"",D),m.value=k}catch(N){console.error(N),u[I?"replace":"assign"](D)}}function b(S,k){const I=xi({},s.state,Q1(m.value.back,S,m.value.forward,!0),k,{position:m.value.position});v(S,I,!0),f.value=S}function o(S,k){const I=xi({},m.value,s.state,{forward:S,scroll:Ym()});v(I.current,I,!0);const L=xi({},Q1(f.value,S,null),{position:I.position+1},k);v(S,L,!1),f.value=S}return{location:f,state:m,push:o,replace:b}}function tL(e){e=Gz(e);const s=eL(e),u=Jz(e,s.state,s.location,s.replace);function f(v,b=!0){b||u.pauseListeners(),history.go(v)}const m=xi({location:"",base:e,go:f,createHref:Wz.bind(null,e)},s,u);return Object.defineProperty(m,"location",{enumerable:!0,get:()=>s.location.value}),Object.defineProperty(m,"state",{enumerable:!0,get:()=>s.state.value}),m}function nL(e){return typeof e=="string"||e&&typeof e=="object"}function lS(e){return typeof e=="string"||typeof e=="symbol"}const La={path:"/",name:void 0,params:{},query:{},hash:"",fullPath:"/",matched:[],meta:{},redirectedFrom:void 0},cS=Symbol("");var J1;(function(e){e[e.aborted=4]="aborted",e[e.cancelled=8]="cancelled",e[e.duplicated=16]="duplicated"})(J1||(J1={}));function Lu(e,s){return xi(new Error,{type:e,[cS]:!0},s)}function $s(e,s){return e instanceof Error&&cS in e&&(s==null||!!(e.type&s))}const ew="[^/]+?",iL={sensitive:!1,strict:!1,start:!0,end:!0},rL=/[.+*?^${}()[\]/\\]/g;function oL(e,s){const u=xi({},iL,s),f=[];let m=u.start?"^":"";const v=[];for(const k of e){const I=k.length?[]:[90];u.strict&&!k.length&&(m+="/");for(let L=0;L<k.length;L++){const D=k[L];let N=40+(u.sensitive?.25:0);if(D.type===0)L||(m+="/"),m+=D.value.replace(rL,"\\$&"),N+=40;else if(D.type===1){const{value:j,repeatable:Z,optional:K,regexp:fe}=D;v.push({name:j,repeatable:Z,optional:K});const te=fe||ew;if(te!==ew){N+=10;try{new RegExp(`(${te})`)}catch(Ce){throw new Error(`Invalid custom RegExp for param "${j}" (${te}): `+Ce.message)}}let ve=Z?`((?:${te})(?:/(?:${te}))*)`:`(${te})`;L||(ve=K&&k.length<2?`(?:/${ve})`:"/"+ve),K&&(ve+="?"),m+=ve,N+=20,K&&(N+=-8),Z&&(N+=-20),te===".*"&&(N+=-50)}I.push(N)}f.push(I)}if(u.strict&&u.end){const k=f.length-1;f[k][f[k].length-1]+=.7000000000000001}u.strict||(m+="/?"),u.end?m+="$":u.strict&&(m+="(?:/|$)");const b=new RegExp(m,u.sensitive?"":"i");function o(k){const I=k.match(b),L={};if(!I)return null;for(let D=1;D<I.length;D++){const N=I[D]||"",j=v[D-1];L[j.name]=N&&j.repeatable?N.split("/"):N}return L}function S(k){let I="",L=!1;for(const D of e){(!L||!I.endsWith("/"))&&(I+="/"),L=!1;for(const N of D)if(N.type===0)I+=N.value;else if(N.type===1){const{value:j,repeatable:Z,optional:K}=N,fe=j in k?k[j]:"";if(ts(fe)&&!Z)throw new Error(`Provided param "${j}" is an array but it is not repeatable (* or + modifiers)`);const te=ts(fe)?fe.join("/"):fe;if(!te)if(K)D.length<2&&(I.endsWith("/")?I=I.slice(0,-1):L=!0);else throw new Error(`Missing required param "${j}"`);I+=te}}return I||"/"}return{re:b,score:f,keys:v,parse:o,stringify:S}}function sL(e,s){let u=0;for(;u<e.length&&u<s.length;){const f=s[u]-e[u];if(f)return f;u++}return e.length<s.length?e.length===1&&e[0]===40+40?-1:1:e.length>s.length?s.length===1&&s[0]===40+40?1:-1:0}function aL(e,s){let u=0;const f=e.score,m=s.score;for(;u<f.length&&u<m.length;){const v=sL(f[u],m[u]);if(v)return v;u++}if(Math.abs(m.length-f.length)===1){if(tw(f))return 1;if(tw(m))return-1}return m.length-f.length}function tw(e){const s=e[e.length-1];return e.length>0&&s[s.length-1]<0}const lL={type:0,value:""},cL=/[a-zA-Z0-9_]/;function uL(e){if(!e)return[[]];if(e==="/")return[[lL]];if(!e.startsWith("/"))throw new Error(`Invalid path "${e}"`);function s(N){throw new Error(`ERR (${u})/"${k}": ${N}`)}let u=0,f=u;const m=[];let v;function b(){v&&m.push(v),v=[]}let o=0,S,k="",I="";function L(){!k||(u===0?v.push({type:0,value:k}):u===1||u===2||u===3?(v.length>1&&(S==="*"||S==="+")&&s(`A repeatable param (${k}) must be alone in its segment. eg: '/:ids+.`),v.push({type:1,value:k,regexp:I,repeatable:S==="*"||S==="+",optional:S==="*"||S==="?"})):s("Invalid state to consume buffer"),k="")}function D(){k+=S}for(;o<e.length;){if(S=e[o++],S==="\\"&&u!==2){f=u,u=4;continue}switch(u){case 0:S==="/"?(k&&L(),b()):S===":"?(L(),u=1):D();break;case 4:D(),u=f;break;case 1:S==="("?u=2:cL.test(S)?D():(L(),u=0,S!=="*"&&S!=="?"&&S!=="+"&&o--);break;case 2:S===")"?I[I.length-1]=="\\"?I=I.slice(0,-1)+S:u=3:I+=S;break;case 3:L(),u=0,S!=="*"&&S!=="?"&&S!=="+"&&o--,I="";break;default:s("Unknown state");break}}return u===2&&s(`Unfinished custom RegExp for param "${k}"`),L(),b(),m}function hL(e,s,u){const f=oL(uL(e.path),u),m=xi(f,{record:e,parent:s,children:[],alias:[]});return s&&!m.record.aliasOf==!s.record.aliasOf&&s.children.push(m),m}function dL(e,s){const u=[],f=new Map;s=rw({strict:!1,end:!0,sensitive:!1},s);function m(I){return f.get(I)}function v(I,L,D){const N=!D,j=fL(I);j.aliasOf=D&&D.record;const Z=rw(s,I),K=[j];if("alias"in I){const ve=typeof I.alias=="string"?[I.alias]:I.alias;for(const Ce of ve)K.push(xi({},j,{components:D?D.record.components:j.components,path:Ce,aliasOf:D?D.record:j}))}let fe,te;for(const ve of K){const{path:Ce}=ve;if(L&&Ce[0]!=="/"){const ce=L.record.path,pe=ce[ce.length-1]==="/"?"":"/";ve.path=L.record.path+(Ce&&pe+Ce)}if(fe=hL(ve,L,Z),D?D.alias.push(fe):(te=te||fe,te!==fe&&te.alias.push(fe),N&&I.name&&!iw(fe)&&b(I.name)),j.children){const ce=j.children;for(let pe=0;pe<ce.length;pe++)v(ce[pe],fe,D&&D.children[pe])}D=D||fe,S(fe)}return te?()=>{b(te)}:Cd}function b(I){if(lS(I)){const L=f.get(I);L&&(f.delete(I),u.splice(u.indexOf(L),1),L.children.forEach(b),L.alias.forEach(b))}else{const L=u.indexOf(I);L>-1&&(u.splice(L,1),I.record.name&&f.delete(I.record.name),I.children.forEach(b),I.alias.forEach(b))}}function o(){return u}function S(I){let L=0;for(;L<u.length&&aL(I,u[L])>=0&&(I.record.path!==u[L].record.path||!uS(I,u[L]));)L++;u.splice(L,0,I),I.record.name&&!iw(I)&&f.set(I.record.name,I)}function k(I,L){let D,N={},j,Z;if("name"in I&&I.name){if(D=f.get(I.name),!D)throw Lu(1,{location:I});Z=D.record.name,N=xi(nw(L.params,D.keys.filter(te=>!te.optional).map(te=>te.name)),I.params&&nw(I.params,D.keys.map(te=>te.name))),j=D.stringify(N)}else if("path"in I)j=I.path,D=u.find(te=>te.re.test(j)),D&&(N=D.parse(j),Z=D.record.name);else{if(D=L.name?f.get(L.name):u.find(te=>te.re.test(L.path)),!D)throw Lu(1,{location:I,currentLocation:L});Z=D.record.name,N=xi({},L.params,I.params),j=D.stringify(N)}const K=[];let fe=D;for(;fe;)K.unshift(fe.record),fe=fe.parent;return{name:Z,path:j,params:N,matched:K,meta:mL(K)}}return e.forEach(I=>v(I)),{addRoute:v,resolve:k,removeRoute:b,getRoutes:o,getRecordMatcher:m}}function nw(e,s){const u={};for(const f of s)f in e&&(u[f]=e[f]);return u}function fL(e){return{path:e.path,redirect:e.redirect,name:e.name,meta:e.meta||{},aliasOf:void 0,beforeEnter:e.beforeEnter,props:pL(e),children:e.children||[],instances:{},leaveGuards:new Set,updateGuards:new Set,enterCallbacks:{},components:"components"in e?e.components||null:e.component&&{default:e.component}}}function pL(e){const s={},u=e.props||!1;if("component"in e)s.default=u;else for(const f in e.components)s[f]=typeof u=="boolean"?u:u[f];return s}function iw(e){for(;e;){if(e.record.aliasOf)return!0;e=e.parent}return!1}function mL(e){return e.reduce((s,u)=>xi(s,u.meta),{})}function rw(e,s){const u={};for(const f in e)u[f]=f in s?s[f]:e[f];return u}function uS(e,s){return s.children.some(u=>u===e||uS(e,u))}const hS=/#/g,gL=/&/g,_L=/\//g,yL=/=/g,vL=/\?/g,dS=/\+/g,xL=/%5B/g,bL=/%5D/g,fS=/%5E/g,wL=/%60/g,pS=/%7B/g,EL=/%7C/g,mS=/%7D/g,TL=/%20/g;function Bv(e){return encodeURI(""+e).replace(EL,"|").replace(xL,"[").replace(bL,"]")}function SL(e){return Bv(e).replace(pS,"{").replace(mS,"}").replace(fS,"^")}function Fy(e){return Bv(e).replace(dS,"%2B").replace(TL,"+").replace(hS,"%23").replace(gL,"%26").replace(wL,"`").replace(pS,"{").replace(mS,"}").replace(fS,"^")}function CL(e){return Fy(e).replace(yL,"%3D")}function AL(e){return Bv(e).replace(hS,"%23").replace(vL,"%3F")}function ML(e){return e==null?"":AL(e).replace(_L,"%2F")}function bm(e){try{return decodeURIComponent(""+e)}catch{}return""+e}function IL(e){const s={};if(e===""||e==="?")return s;const f=(e[0]==="?"?e.slice(1):e).split("&");for(let m=0;m<f.length;++m){const v=f[m].replace(dS," "),b=v.indexOf("="),o=bm(b<0?v:v.slice(0,b)),S=b<0?null:bm(v.slice(b+1));if(o in s){let k=s[o];ts(k)||(k=s[o]=[k]),k.push(S)}else s[o]=S}return s}function ow(e){let s="";for(let u in e){const f=e[u];if(u=CL(u),f==null){f!==void 0&&(s+=(s.length?"&":"")+u);continue}(ts(f)?f.map(v=>v&&Fy(v)):[f&&Fy(f)]).forEach(v=>{v!==void 0&&(s+=(s.length?"&":"")+u,v!=null&&(s+="="+v))})}return s}function kL(e){const s={};for(const u in e){const f=e[u];f!==void 0&&(s[u]=ts(f)?f.map(m=>m==null?null:""+m):f==null?f:""+f)}return s}const PL=Symbol(""),sw=Symbol(""),Qm=Symbol(""),gS=Symbol(""),Ny=Symbol("");function pd(){let e=[];function s(f){return e.push(f),()=>{const m=e.indexOf(f);m>-1&&e.splice(m,1)}}function u(){e=[]}return{add:s,list:()=>e,reset:u}}function Va(e,s,u,f,m){const v=f&&(f.enterCallbacks[m]=f.enterCallbacks[m]||[]);return()=>new Promise((b,o)=>{const S=L=>{L===!1?o(Lu(4,{from:u,to:s})):L instanceof Error?o(L):nL(L)?o(Lu(2,{from:s,to:L})):(v&&f.enterCallbacks[m]===v&&typeof L=="function"&&v.push(L),b())},k=e.call(f&&f.instances[m],s,u,S);let I=Promise.resolve(k);e.length<3&&(I=I.then(S)),I.catch(L=>o(L))})}function Q_(e,s,u,f){const m=[];for(const v of e)for(const b in v.components){let o=v.components[b];if(!(s!=="beforeRouteEnter"&&!v.instances[b]))if(zL(o)){const k=(o.__vccOpts||o)[s];k&&m.push(Va(k,u,f,v,b))}else{let S=o();m.push(()=>S.then(k=>{if(!k)return Promise.reject(new Error(`Couldn't resolve component "${b}" at "${v.path}"`));const I=Fz(k)?k.default:k;v.components[b]=I;const D=(I.__vccOpts||I)[s];return D&&Va(D,u,f,v,b)()}))}}return m}function zL(e){return typeof e=="object"||"displayName"in e||"props"in e||"__vccOpts"in e}function aw(e){const s=Ur(Qm),u=Ur(gS),f=se(()=>s.resolve(Bn(e.to))),m=se(()=>{const{matched:S}=f.value,{length:k}=S,I=S[k-1],L=u.matched;if(!I||!L.length)return-1;const D=L.findIndex(zu.bind(null,I));if(D>-1)return D;const N=lw(S[k-2]);return k>1&&lw(I)===N&&L[L.length-1].path!==N?L.findIndex(zu.bind(null,S[k-2])):D}),v=se(()=>m.value>-1&&OL(u.params,f.value.params)),b=se(()=>m.value>-1&&m.value===u.matched.length-1&&sS(u.params,f.value.params));function o(S={}){return DL(S)?s[Bn(e.replace)?"replace":"push"](Bn(e.to)).catch(Cd):Promise.resolve()}return{route:f,href:se(()=>f.value.href),isActive:v,isExactActive:b,navigate:o}}const LL=yv({name:"RouterLink",compatConfig:{MODE:3},props:{to:{type:[String,Object],required:!0},replace:Boolean,activeClass:String,exactActiveClass:String,custom:Boolean,ariaCurrentValue:{type:String,default:"page"}},useLink:aw,setup(e,{slots:s}){const u=Lo(aw(e)),{options:f}=Ur(Qm),m=se(()=>({[cw(e.activeClass,f.linkActiveClass,"router-link-active")]:u.isActive,[cw(e.exactActiveClass,f.linkExactActiveClass,"router-link-exact-active")]:u.isExactActive}));return()=>{const v=s.default&&s.default(u);return e.custom?v:me("a",{"aria-current":u.isExactActive?e.ariaCurrentValue:null,href:u.href,onClick:u.navigate,class:m.value},v)}}}),RL=LL;function DL(e){if(!(e.metaKey||e.altKey||e.ctrlKey||e.shiftKey)&&!e.defaultPrevented&&!(e.button!==void 0&&e.button!==0)){if(e.currentTarget&&e.currentTarget.getAttribute){const s=e.currentTarget.getAttribute("target");if(/\b_blank\b/i.test(s))return}return e.preventDefault&&e.preventDefault(),!0}}function OL(e,s){for(const u in s){const f=s[u],m=e[u];if(typeof f=="string"){if(f!==m)return!1}else if(!ts(m)||m.length!==f.length||f.some((v,b)=>v!==m[b]))return!1}return!0}function lw(e){return e?e.aliasOf?e.aliasOf.path:e.path:""}const cw=(e,s,u)=>e!=null?e:s!=null?s:u,BL=yv({name:"RouterView",inheritAttrs:!1,props:{name:{type:String,default:"default"},route:Object},compatConfig:{MODE:3},setup(e,{attrs:s,slots:u}){const f=Ur(Ny),m=se(()=>e.route||f.value),v=Ur(sw,0),b=se(()=>{let k=Bn(v);const{matched:I}=m.value;let L;for(;(L=I[k])&&!L.components;)k++;return k}),o=se(()=>m.value.matched[b.value]);Yl(sw,se(()=>b.value+1)),Yl(PL,o),Yl(Ny,m);const S=xt();return Ht(()=>[S.value,o.value,e.name],([k,I,L],[D,N,j])=>{I&&(I.instances[L]=k,N&&N!==I&&k&&k===D&&(I.leaveGuards.size||(I.leaveGuards=N.leaveGuards),I.updateGuards.size||(I.updateGuards=N.updateGuards))),k&&I&&(!N||!zu(I,N)||!D)&&(I.enterCallbacks[L]||[]).forEach(Z=>Z(k))},{flush:"post"}),()=>{const k=m.value,I=e.name,L=o.value,D=L&&L.components[I];if(!D)return uw(u.default,{Component:D,route:k});const N=L.props[I],j=N?N===!0?k.params:typeof N=="function"?N(k):N:null,K=me(D,xi({},j,s,{onVnodeUnmounted:fe=>{fe.component.isUnmounted&&(L.instances[I]=null)},ref:S}));return uw(u.default,{Component:K,route:k})||K}}});function uw(e,s){if(!e)return null;const u=e(s);return u.length===1?u[0]:u}const FL=BL;function NL(e){const s=dL(e.routes,e),u=e.parseQuery||IL,f=e.stringifyQuery||ow,m=e.history,v=pd(),b=pd(),o=pd(),S=nI(La);let k=La;gu&&e.scrollBehavior&&"scrollRestoration"in history&&(history.scrollRestoration="manual");const I=K_.bind(null,rt=>""+rt),L=K_.bind(null,ML),D=K_.bind(null,bm);function N(rt,gt){let ot,_t;return lS(rt)?(ot=s.getRecordMatcher(rt),_t=gt):_t=rt,s.addRoute(_t,ot)}function j(rt){const gt=s.getRecordMatcher(rt);gt&&s.removeRoute(gt)}function Z(){return s.getRoutes().map(rt=>rt.record)}function K(rt){return!!s.getRecordMatcher(rt)}function fe(rt,gt){if(gt=xi({},gt||S.value),typeof rt=="string"){const oe=Y_(u,rt,gt.path),be=s.resolve({path:oe.path},gt),Fe=m.createHref(oe.fullPath);return xi(oe,be,{params:D(be.params),hash:bm(oe.hash),redirectedFrom:void 0,href:Fe})}let ot;if("path"in rt)ot=xi({},rt,{path:Y_(u,rt.path,gt.path).path});else{const oe=xi({},rt.params);for(const be in oe)oe[be]==null&&delete oe[be];ot=xi({},rt,{params:L(rt.params)}),gt.params=L(gt.params)}const _t=s.resolve(ot,gt),ft=rt.hash||"";_t.params=I(D(_t.params));const sn=Uz(f,xi({},rt,{hash:SL(ft),path:_t.path})),un=m.createHref(sn);return xi({fullPath:sn,hash:ft,query:f===ow?kL(rt.query):rt.query||{}},_t,{redirectedFrom:void 0,href:un})}function te(rt){return typeof rt=="string"?Y_(u,rt,S.value.path):xi({},rt)}function ve(rt,gt){if(k!==rt)return Lu(8,{from:gt,to:rt})}function Ce(rt){return Te(rt)}function ce(rt){return Ce(xi(te(rt),{replace:!0}))}function pe(rt){const gt=rt.matched[rt.matched.length-1];if(gt&&gt.redirect){const{redirect:ot}=gt;let _t=typeof ot=="function"?ot(rt):ot;return typeof _t=="string"&&(_t=_t.includes("?")||_t.includes("#")?_t=te(_t):{path:_t},_t.params={}),xi({query:rt.query,hash:rt.hash,params:"path"in _t?{}:rt.params},_t)}}function Te(rt,gt){const ot=k=fe(rt),_t=S.value,ft=rt.state,sn=rt.force,un=rt.replace===!0,oe=pe(ot);if(oe)return Te(xi(te(oe),{state:typeof oe=="object"?xi({},ft,oe.state):ft,force:sn,replace:un}),gt||ot);const be=ot;be.redirectedFrom=gt;let Fe;return!sn&&jz(f,_t,ot)&&(Fe=Lu(16,{to:be,from:_t}),Ve(_t,_t,!0,!1)),(Fe?Promise.resolve(Fe):Ie(be,_t)).catch(nt=>$s(nt)?$s(nt,2)?nt:tn(nt):Ge(nt,be,_t)).then(nt=>{if(nt){if($s(nt,2))return Te(xi({replace:un},te(nt.to),{state:typeof nt.to=="object"?xi({},ft,nt.to.state):ft,force:sn}),gt||be)}else nt=Be(be,_t,!0,un,ft);return ke(be,_t,nt),nt})}function Me(rt,gt){const ot=ve(rt,gt);return ot?Promise.reject(ot):Promise.resolve()}function Ie(rt,gt){let ot;const[_t,ft,sn]=VL(rt,gt);ot=Q_(_t.reverse(),"beforeRouteLeave",rt,gt);for(const oe of _t)oe.leaveGuards.forEach(be=>{ot.push(Va(be,rt,gt))});const un=Me.bind(null,rt,gt);return ot.push(un),fu(ot).then(()=>{ot=[];for(const oe of v.list())ot.push(Va(oe,rt,gt));return ot.push(un),fu(ot)}).then(()=>{ot=Q_(ft,"beforeRouteUpdate",rt,gt);for(const oe of ft)oe.updateGuards.forEach(be=>{ot.push(Va(be,rt,gt))});return ot.push(un),fu(ot)}).then(()=>{ot=[];for(const oe of rt.matched)if(oe.beforeEnter&&!gt.matched.includes(oe))if(ts(oe.beforeEnter))for(const be of oe.beforeEnter)ot.push(Va(be,rt,gt));else ot.push(Va(oe.beforeEnter,rt,gt));return ot.push(un),fu(ot)}).then(()=>(rt.matched.forEach(oe=>oe.enterCallbacks={}),ot=Q_(sn,"beforeRouteEnter",rt,gt),ot.push(un),fu(ot))).then(()=>{ot=[];for(const oe of b.list())ot.push(Va(oe,rt,gt));return ot.push(un),fu(ot)}).catch(oe=>$s(oe,8)?oe:Promise.reject(oe))}function ke(rt,gt,ot){for(const _t of o.list())_t(rt,gt,ot)}function Be(rt,gt,ot,_t,ft){const sn=ve(rt,gt);if(sn)return sn;const un=gt===La,oe=gu?history.state:{};ot&&(_t||un?m.replace(rt.fullPath,xi({scroll:un&&oe&&oe.scroll},ft)):m.push(rt.fullPath,ft)),S.value=rt,Ve(rt,gt,ot,un),tn()}let Re;function Ze(){Re||(Re=m.listen((rt,gt,ot)=>{if(!xn.listening)return;const _t=fe(rt),ft=pe(_t);if(ft){Te(xi(ft,{replace:!0}),_t).catch(Cd);return}k=_t;const sn=S.value;gu&&Kz(Y1(sn.fullPath,ot.delta),Ym()),Ie(_t,sn).catch(un=>$s(un,12)?un:$s(un,2)?(Te(un.to,_t).then(oe=>{$s(oe,20)&&!ot.delta&&ot.type===Ud.pop&&m.go(-1,!1)}).catch(Cd),Promise.reject()):(ot.delta&&m.go(-ot.delta,!1),Ge(un,_t,sn))).then(un=>{un=un||Be(_t,sn,!1),un&&(ot.delta&&!$s(un,8)?m.go(-ot.delta,!1):ot.type===Ud.pop&&$s(un,20)&&m.go(-1,!1)),ke(_t,sn,un)}).catch(Cd)}))}let Ye=pd(),lt=pd(),Xt;function Ge(rt,gt,ot){tn(rt);const _t=lt.list();return _t.length?_t.forEach(ft=>ft(rt,gt,ot)):console.error(rt),Promise.reject(rt)}function At(){return Xt&&S.value!==La?Promise.resolve():new Promise((rt,gt)=>{Ye.add([rt,gt])})}function tn(rt){return Xt||(Xt=!rt,Ze(),Ye.list().forEach(([gt,ot])=>rt?ot(rt):gt()),Ye.reset()),rt}function Ve(rt,gt,ot,_t){const{scrollBehavior:ft}=e;if(!gu||!ft)return Promise.resolve();const sn=!ot&&Yz(Y1(rt.fullPath,0))||(_t||!ot)&&history.state&&history.state.scroll||null;return ui().then(()=>ft(rt,gt,sn)).then(un=>un&&Xz(un)).catch(un=>Ge(un,rt,gt))}const mt=rt=>m.go(rt);let Bt;const jt=new Set,xn={currentRoute:S,listening:!0,addRoute:N,removeRoute:j,hasRoute:K,getRoutes:Z,resolve:fe,options:e,push:Ce,replace:ce,go:mt,back:()=>mt(-1),forward:()=>mt(1),beforeEach:v.add,beforeResolve:b.add,afterEach:o.add,onError:lt.add,isReady:At,install(rt){const gt=this;rt.component("RouterLink",RL),rt.component("RouterView",FL),rt.config.globalProperties.$router=gt,Object.defineProperty(rt.config.globalProperties,"$route",{enumerable:!0,get:()=>Bn(S)}),gu&&!Bt&&S.value===La&&(Bt=!0,Ce(m.location).catch(ft=>{}));const ot={};for(const ft in La)ot[ft]=se(()=>S.value[ft]);rt.provide(Qm,gt),rt.provide(gS,Lo(ot)),rt.provide(Ny,S);const _t=rt.unmount;jt.add(rt),rt.unmount=function(){jt.delete(rt),jt.size<1&&(k=La,Re&&Re(),Re=null,S.value=La,Bt=!1,Xt=!1),_t()}}};return xn}function fu(e){return e.reduce((s,u)=>s.then(()=>u()),Promise.resolve())}function VL(e,s){const u=[],f=[],m=[],v=Math.max(s.matched.length,e.matched.length);for(let b=0;b<v;b++){const o=s.matched[b];o&&(e.matched.find(k=>zu(k,o))?f.push(o):u.push(o));const S=e.matched[b];S&&(s.matched.find(k=>zu(k,S))||m.push(S))}return[u,f,m]}function UL(){return Ur(Qm)}function _S(e,s){return function(){return e.apply(s,arguments)}}const{toString:yS}=Object.prototype,{getPrototypeOf:Fv}=Object,Nv=(e=>s=>{const u=yS.call(s);return e[u]||(e[u]=u.slice(8,-1).toLowerCase())})(Object.create(null)),ra=e=>(e=e.toLowerCase(),s=>Nv(s)===e),Jm=e=>s=>typeof s===e,{isArray:ju}=Array,jd=Jm("undefined");function jL(e){return e!==null&&!jd(e)&&e.constructor!==null&&!jd(e.constructor)&&rc(e.constructor.isBuffer)&&e.constructor.isBuffer(e)}const vS=ra("ArrayBuffer");function qL(e){let s;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?s=ArrayBuffer.isView(e):s=e&&e.buffer&&vS(e.buffer),s}const $L=Jm("string"),rc=Jm("function"),xS=Jm("number"),Vv=e=>e!==null&&typeof e=="object",GL=e=>e===!0||e===!1,Qp=e=>{if(Nv(e)!=="object")return!1;const s=Fv(e);return(s===null||s===Object.prototype||Object.getPrototypeOf(s)===null)&&!(Symbol.toStringTag in e)&&!(Symbol.iterator in e)},ZL=ra("Date"),WL=ra("File"),HL=ra("Blob"),XL=ra("FileList"),KL=e=>Vv(e)&&rc(e.pipe),YL=e=>{const s="[object FormData]";return e&&(typeof FormData=="function"&&e instanceof FormData||yS.call(e)===s||rc(e.toString)&&e.toString()===s)},QL=ra("URLSearchParams"),JL=e=>e.trim?e.trim():e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function qd(e,s,{allOwnKeys:u=!1}={}){if(e===null||typeof e>"u")return;let f,m;if(typeof e!="object"&&(e=[e]),ju(e))for(f=0,m=e.length;f<m;f++)s.call(null,e[f],f,e);else{const v=u?Object.getOwnPropertyNames(e):Object.keys(e),b=v.length;let o;for(f=0;f<b;f++)o=v[f],s.call(null,e[o],o,e)}}function bS(e,s){s=s.toLowerCase();const u=Object.keys(e);let f=u.length,m;for(;f-- >0;)if(m=u[f],s===m.toLowerCase())return m;return null}const wS=(()=>typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global)(),ES=e=>!jd(e)&&e!==wS;function Vy(){const{caseless:e}=ES(this)&&this||{},s={},u=(f,m)=>{const v=e&&bS(s,m)||m;Qp(s[v])&&Qp(f)?s[v]=Vy(s[v],f):Qp(f)?s[v]=Vy({},f):ju(f)?s[v]=f.slice():s[v]=f};for(let f=0,m=arguments.length;f<m;f++)arguments[f]&&qd(arguments[f],u);return s}const eR=(e,s,u,{allOwnKeys:f}={})=>(qd(s,(m,v)=>{u&&rc(m)?e[v]=_S(m,u):e[v]=m},{allOwnKeys:f}),e),tR=e=>(e.charCodeAt(0)===65279&&(e=e.slice(1)),e),nR=(e,s,u,f)=>{e.prototype=Object.create(s.prototype,f),e.prototype.constructor=e,Object.defineProperty(e,"super",{value:s.prototype}),u&&Object.assign(e.prototype,u)},iR=(e,s,u,f)=>{let m,v,b;const o={};if(s=s||{},e==null)return s;do{for(m=Object.getOwnPropertyNames(e),v=m.length;v-- >0;)b=m[v],(!f||f(b,e,s))&&!o[b]&&(s[b]=e[b],o[b]=!0);e=u!==!1&&Fv(e)}while(e&&(!u||u(e,s))&&e!==Object.prototype);return s},rR=(e,s,u)=>{e=String(e),(u===void 0||u>e.length)&&(u=e.length),u-=s.length;const f=e.indexOf(s,u);return f!==-1&&f===u},oR=e=>{if(!e)return null;if(ju(e))return e;let s=e.length;if(!xS(s))return null;const u=new Array(s);for(;s-- >0;)u[s]=e[s];return u},sR=(e=>s=>e&&s instanceof e)(typeof Uint8Array<"u"&&Fv(Uint8Array)),aR=(e,s)=>{const f=(e&&e[Symbol.iterator]).call(e);let m;for(;(m=f.next())&&!m.done;){const v=m.value;s.call(e,v[0],v[1])}},lR=(e,s)=>{let u;const f=[];for(;(u=e.exec(s))!==null;)f.push(u);return f},cR=ra("HTMLFormElement"),uR=e=>e.toLowerCase().replace(/[_-\s]([a-z\d])(\w*)/g,function(u,f,m){return f.toUpperCase()+m}),hw=(({hasOwnProperty:e})=>(s,u)=>e.call(s,u))(Object.prototype),hR=ra("RegExp"),TS=(e,s)=>{const u=Object.getOwnPropertyDescriptors(e),f={};qd(u,(m,v)=>{s(m,v,e)!==!1&&(f[v]=m)}),Object.defineProperties(e,f)},dR=e=>{TS(e,(s,u)=>{if(rc(e)&&["arguments","caller","callee"].indexOf(u)!==-1)return!1;const f=e[u];if(!!rc(f)){if(s.enumerable=!1,"writable"in s){s.writable=!1;return}s.set||(s.set=()=>{throw Error("Can not rewrite read-only method '"+u+"'")})}})},fR=(e,s)=>{const u={},f=m=>{m.forEach(v=>{u[v]=!0})};return ju(e)?f(e):f(String(e).split(s)),u},pR=()=>{},mR=(e,s)=>(e=+e,Number.isFinite(e)?e:s),gR=e=>{const s=new Array(10),u=(f,m)=>{if(Vv(f)){if(s.indexOf(f)>=0)return;if(!("toJSON"in f)){s[m]=f;const v=ju(f)?[]:{};return qd(f,(b,o)=>{const S=u(b,m+1);!jd(S)&&(v[o]=S)}),s[m]=void 0,v}}return f};return u(e,0)},Tt={isArray:ju,isArrayBuffer:vS,isBuffer:jL,isFormData:YL,isArrayBufferView:qL,isString:$L,isNumber:xS,isBoolean:GL,isObject:Vv,isPlainObject:Qp,isUndefined:jd,isDate:ZL,isFile:WL,isBlob:HL,isRegExp:hR,isFunction:rc,isStream:KL,isURLSearchParams:QL,isTypedArray:sR,isFileList:XL,forEach:qd,merge:Vy,extend:eR,trim:JL,stripBOM:tR,inherits:nR,toFlatObject:iR,kindOf:Nv,kindOfTest:ra,endsWith:rR,toArray:oR,forEachEntry:aR,matchAll:lR,isHTMLForm:cR,hasOwnProperty:hw,hasOwnProp:hw,reduceDescriptors:TS,freezeMethods:dR,toObjectSet:fR,toCamelCase:uR,noop:pR,toFiniteNumber:mR,findKey:bS,global:wS,isContextDefined:ES,toJSONObject:gR};function si(e,s,u,f,m){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=e,this.name="AxiosError",s&&(this.code=s),u&&(this.config=u),f&&(this.request=f),m&&(this.response=m)}Tt.inherits(si,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:Tt.toJSONObject(this.config),code:this.code,status:this.response&&this.response.status?this.response.status:null}}});const SS=si.prototype,CS={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(e=>{CS[e]={value:e}});Object.defineProperties(si,CS);Object.defineProperty(SS,"isAxiosError",{value:!0});si.from=(e,s,u,f,m,v)=>{const b=Object.create(SS);return Tt.toFlatObject(e,b,function(S){return S!==Error.prototype},o=>o!=="isAxiosError"),si.call(b,e.message,s,u,f,m),b.cause=e,b.name=e.name,v&&Object.assign(b,v),b};var Jo=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function _R(e){var s=e.default;if(typeof s=="function"){var u=function(){return s.apply(this,arguments)};u.prototype=s.prototype}else u={};return Object.defineProperty(u,"__esModule",{value:!0}),Object.keys(e).forEach(function(f){var m=Object.getOwnPropertyDescriptor(e,f);Object.defineProperty(u,f,m.get?m:{enumerable:!0,get:function(){return e[f]}})}),u}var yR=typeof self=="object"?self.FormData:window.FormData;const vR=yR;function Uy(e){return Tt.isPlainObject(e)||Tt.isArray(e)}function AS(e){return Tt.endsWith(e,"[]")?e.slice(0,-2):e}function dw(e,s,u){return e?e.concat(s).map(function(m,v){return m=AS(m),!u&&v?"["+m+"]":m}).join(u?".":""):s}function xR(e){return Tt.isArray(e)&&!e.some(Uy)}const bR=Tt.toFlatObject(Tt,{},null,function(s){return/^is[A-Z]/.test(s)});function wR(e){return e&&Tt.isFunction(e.append)&&e[Symbol.toStringTag]==="FormData"&&e[Symbol.iterator]}function eg(e,s,u){if(!Tt.isObject(e))throw new TypeError("target must be an object");s=s||new(vR||FormData),u=Tt.toFlatObject(u,{metaTokens:!0,dots:!1,indexes:!1},!1,function(Z,K){return!Tt.isUndefined(K[Z])});const f=u.metaTokens,m=u.visitor||I,v=u.dots,b=u.indexes,S=(u.Blob||typeof Blob<"u"&&Blob)&&wR(s);if(!Tt.isFunction(m))throw new TypeError("visitor must be a function");function k(j){if(j===null)return"";if(Tt.isDate(j))return j.toISOString();if(!S&&Tt.isBlob(j))throw new si("Blob is not supported. Use a Buffer instead.");return Tt.isArrayBuffer(j)||Tt.isTypedArray(j)?S&&typeof Blob=="function"?new Blob([j]):Buffer.from(j):j}function I(j,Z,K){let fe=j;if(j&&!K&&typeof j=="object"){if(Tt.endsWith(Z,"{}"))Z=f?Z:Z.slice(0,-2),j=JSON.stringify(j);else if(Tt.isArray(j)&&xR(j)||Tt.isFileList(j)||Tt.endsWith(Z,"[]")&&(fe=Tt.toArray(j)))return Z=AS(Z),fe.forEach(function(ve,Ce){!(Tt.isUndefined(ve)||ve===null)&&s.append(b===!0?dw([Z],Ce,v):b===null?Z:Z+"[]",k(ve))}),!1}return Uy(j)?!0:(s.append(dw(K,Z,v),k(j)),!1)}const L=[],D=Object.assign(bR,{defaultVisitor:I,convertValue:k,isVisitable:Uy});function N(j,Z){if(!Tt.isUndefined(j)){if(L.indexOf(j)!==-1)throw Error("Circular reference detected in "+Z.join("."));L.push(j),Tt.forEach(j,function(fe,te){(!(Tt.isUndefined(fe)||fe===null)&&m.call(s,fe,Tt.isString(te)?te.trim():te,Z,D))===!0&&N(fe,Z?Z.concat(te):[te])}),L.pop()}}if(!Tt.isObject(e))throw new TypeError("data must be an object");return N(e),s}function fw(e){const s={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(e).replace(/[!'()~]|%20|%00/g,function(f){return s[f]})}function Uv(e,s){this._pairs=[],e&&eg(e,this,s)}const MS=Uv.prototype;MS.append=function(s,u){this._pairs.push([s,u])};MS.toString=function(s){const u=s?function(f){return s.call(this,f,fw)}:fw;return this._pairs.map(function(m){return u(m[0])+"="+u(m[1])},"").join("&")};function ER(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function IS(e,s,u){if(!s)return e;const f=u&&u.encode||ER,m=u&&u.serialize;let v;if(m?v=m(s,u):v=Tt.isURLSearchParams(s)?s.toString():new Uv(s,u).toString(f),v){const b=e.indexOf("#");b!==-1&&(e=e.slice(0,b)),e+=(e.indexOf("?")===-1?"?":"&")+v}return e}class TR{constructor(){this.handlers=[]}use(s,u,f){return this.handlers.push({fulfilled:s,rejected:u,synchronous:f?f.synchronous:!1,runWhen:f?f.runWhen:null}),this.handlers.length-1}eject(s){this.handlers[s]&&(this.handlers[s]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(s){Tt.forEach(this.handlers,function(f){f!==null&&s(f)})}}const pw=TR,kS={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},SR=typeof URLSearchParams<"u"?URLSearchParams:Uv,CR=FormData,AR=(()=>{let e;return typeof navigator<"u"&&((e=navigator.product)==="ReactNative"||e==="NativeScript"||e==="NS")?!1:typeof window<"u"&&typeof document<"u"})(),MR=(()=>typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function")(),ws={isBrowser:!0,classes:{URLSearchParams:SR,FormData:CR,Blob},isStandardBrowserEnv:AR,isStandardBrowserWebWorkerEnv:MR,protocols:["http","https","file","blob","url","data"]};function IR(e,s){return eg(e,new ws.classes.URLSearchParams,Object.assign({visitor:function(u,f,m,v){return ws.isNode&&Tt.isBuffer(u)?(this.append(f,u.toString("base64")),!1):v.defaultVisitor.apply(this,arguments)}},s))}function kR(e){return Tt.matchAll(/\w+|\[(\w*)]/g,e).map(s=>s[0]==="[]"?"":s[1]||s[0])}function PR(e){const s={},u=Object.keys(e);let f;const m=u.length;let v;for(f=0;f<m;f++)v=u[f],s[v]=e[v];return s}function PS(e){function s(u,f,m,v){let b=u[v++];const o=Number.isFinite(+b),S=v>=u.length;return b=!b&&Tt.isArray(m)?m.length:b,S?(Tt.hasOwnProp(m,b)?m[b]=[m[b],f]:m[b]=f,!o):((!m[b]||!Tt.isObject(m[b]))&&(m[b]=[]),s(u,f,m[b],v)&&Tt.isArray(m[b])&&(m[b]=PR(m[b])),!o)}if(Tt.isFormData(e)&&Tt.isFunction(e.entries)){const u={};return Tt.forEachEntry(e,(f,m)=>{s(kR(f),m,u,0)}),u}return null}const zR={"Content-Type":void 0};function LR(e,s,u){if(Tt.isString(e))try{return(s||JSON.parse)(e),Tt.trim(e)}catch(f){if(f.name!=="SyntaxError")throw f}return(u||JSON.stringify)(e)}const tg={transitional:kS,adapter:["xhr","http"],transformRequest:[function(s,u){const f=u.getContentType()||"",m=f.indexOf("application/json")>-1,v=Tt.isObject(s);if(v&&Tt.isHTMLForm(s)&&(s=new FormData(s)),Tt.isFormData(s))return m&&m?JSON.stringify(PS(s)):s;if(Tt.isArrayBuffer(s)||Tt.isBuffer(s)||Tt.isStream(s)||Tt.isFile(s)||Tt.isBlob(s))return s;if(Tt.isArrayBufferView(s))return s.buffer;if(Tt.isURLSearchParams(s))return u.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),s.toString();let o;if(v){if(f.indexOf("application/x-www-form-urlencoded")>-1)return IR(s,this.formSerializer).toString();if((o=Tt.isFileList(s))||f.indexOf("multipart/form-data")>-1){const S=this.env&&this.env.FormData;return eg(o?{"files[]":s}:s,S&&new S,this.formSerializer)}}return v||m?(u.setContentType("application/json",!1),LR(s)):s}],transformResponse:[function(s){const u=this.transitional||tg.transitional,f=u&&u.forcedJSONParsing,m=this.responseType==="json";if(s&&Tt.isString(s)&&(f&&!this.responseType||m)){const b=!(u&&u.silentJSONParsing)&&m;try{return JSON.parse(s)}catch(o){if(b)throw o.name==="SyntaxError"?si.from(o,si.ERR_BAD_RESPONSE,this,null,this.response):o}}return s}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:ws.classes.FormData,Blob:ws.classes.Blob},validateStatus:function(s){return s>=200&&s<300},headers:{common:{Accept:"application/json, text/plain, */*"}}};Tt.forEach(["delete","get","head"],function(s){tg.headers[s]={}});Tt.forEach(["post","put","patch"],function(s){tg.headers[s]=Tt.merge(zR)});const jv=tg,RR=Tt.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),DR=e=>{const s={};let u,f,m;return e&&e.split(`
`).forEach(function(b){m=b.indexOf(":"),u=b.substring(0,m).trim().toLowerCase(),f=b.substring(m+1).trim(),!(!u||s[u]&&RR[u])&&(u==="set-cookie"?s[u]?s[u].push(f):s[u]=[f]:s[u]=s[u]?s[u]+", "+f:f)}),s},mw=Symbol("internals");function md(e){return e&&String(e).trim().toLowerCase()}function Jp(e){return e===!1||e==null?e:Tt.isArray(e)?e.map(Jp):String(e)}function OR(e){const s=Object.create(null),u=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let f;for(;f=u.exec(e);)s[f[1]]=f[2];return s}function BR(e){return/^[-_a-zA-Z]+$/.test(e.trim())}function gw(e,s,u,f){if(Tt.isFunction(f))return f.call(this,s,u);if(!!Tt.isString(s)){if(Tt.isString(f))return s.indexOf(f)!==-1;if(Tt.isRegExp(f))return f.test(s)}}function FR(e){return e.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(s,u,f)=>u.toUpperCase()+f)}function NR(e,s){const u=Tt.toCamelCase(" "+s);["get","set","has"].forEach(f=>{Object.defineProperty(e,f+u,{value:function(m,v,b){return this[f].call(this,s,m,v,b)},configurable:!0})})}class ng{constructor(s){s&&this.set(s)}set(s,u,f){const m=this;function v(o,S,k){const I=md(S);if(!I)throw new Error("header name must be a non-empty string");const L=Tt.findKey(m,I);(!L||m[L]===void 0||k===!0||k===void 0&&m[L]!==!1)&&(m[L||S]=Jp(o))}const b=(o,S)=>Tt.forEach(o,(k,I)=>v(k,I,S));return Tt.isPlainObject(s)||s instanceof this.constructor?b(s,u):Tt.isString(s)&&(s=s.trim())&&!BR(s)?b(DR(s),u):s!=null&&v(u,s,f),this}get(s,u){if(s=md(s),s){const f=Tt.findKey(this,s);if(f){const m=this[f];if(!u)return m;if(u===!0)return OR(m);if(Tt.isFunction(u))return u.call(this,m,f);if(Tt.isRegExp(u))return u.exec(m);throw new TypeError("parser must be boolean|regexp|function")}}}has(s,u){if(s=md(s),s){const f=Tt.findKey(this,s);return!!(f&&(!u||gw(this,this[f],f,u)))}return!1}delete(s,u){const f=this;let m=!1;function v(b){if(b=md(b),b){const o=Tt.findKey(f,b);o&&(!u||gw(f,f[o],o,u))&&(delete f[o],m=!0)}}return Tt.isArray(s)?s.forEach(v):v(s),m}clear(){return Object.keys(this).forEach(this.delete.bind(this))}normalize(s){const u=this,f={};return Tt.forEach(this,(m,v)=>{const b=Tt.findKey(f,v);if(b){u[b]=Jp(m),delete u[v];return}const o=s?FR(v):String(v).trim();o!==v&&delete u[v],u[o]=Jp(m),f[o]=!0}),this}concat(...s){return this.constructor.concat(this,...s)}toJSON(s){const u=Object.create(null);return Tt.forEach(this,(f,m)=>{f!=null&&f!==!1&&(u[m]=s&&Tt.isArray(f)?f.join(", "):f)}),u}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([s,u])=>s+": "+u).join(`
`)}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(s){return s instanceof this?s:new this(s)}static concat(s,...u){const f=new this(s);return u.forEach(m=>f.set(m)),f}static accessor(s){const f=(this[mw]=this[mw]={accessors:{}}).accessors,m=this.prototype;function v(b){const o=md(b);f[o]||(NR(m,b),f[o]=!0)}return Tt.isArray(s)?s.forEach(v):v(s),this}}ng.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent"]);Tt.freezeMethods(ng.prototype);Tt.freezeMethods(ng);const Ks=ng;function J_(e,s){const u=this||jv,f=s||u,m=Ks.from(f.headers);let v=f.data;return Tt.forEach(e,function(o){v=o.call(u,v,m.normalize(),s?s.status:void 0)}),m.normalize(),v}function zS(e){return!!(e&&e.__CANCEL__)}function $d(e,s,u){si.call(this,e==null?"canceled":e,si.ERR_CANCELED,s,u),this.name="CanceledError"}Tt.inherits($d,si,{__CANCEL__:!0});const VR=null;function UR(e,s,u){const f=u.config.validateStatus;!u.status||!f||f(u.status)?e(u):s(new si("Request failed with status code "+u.status,[si.ERR_BAD_REQUEST,si.ERR_BAD_RESPONSE][Math.floor(u.status/100)-4],u.config,u.request,u))}const jR=ws.isStandardBrowserEnv?function(){return{write:function(u,f,m,v,b,o){const S=[];S.push(u+"="+encodeURIComponent(f)),Tt.isNumber(m)&&S.push("expires="+new Date(m).toGMTString()),Tt.isString(v)&&S.push("path="+v),Tt.isString(b)&&S.push("domain="+b),o===!0&&S.push("secure"),document.cookie=S.join("; ")},read:function(u){const f=document.cookie.match(new RegExp("(^|;\\s*)("+u+")=([^;]*)"));return f?decodeURIComponent(f[3]):null},remove:function(u){this.write(u,"",Date.now()-864e5)}}}():function(){return{write:function(){},read:function(){return null},remove:function(){}}}();function qR(e){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(e)}function $R(e,s){return s?e.replace(/\/+$/,"")+"/"+s.replace(/^\/+/,""):e}function LS(e,s){return e&&!qR(s)?$R(e,s):s}const GR=ws.isStandardBrowserEnv?function(){const s=/(msie|trident)/i.test(navigator.userAgent),u=document.createElement("a");let f;function m(v){let b=v;return s&&(u.setAttribute("href",b),b=u.href),u.setAttribute("href",b),{href:u.href,protocol:u.protocol?u.protocol.replace(/:$/,""):"",host:u.host,search:u.search?u.search.replace(/^\?/,""):"",hash:u.hash?u.hash.replace(/^#/,""):"",hostname:u.hostname,port:u.port,pathname:u.pathname.charAt(0)==="/"?u.pathname:"/"+u.pathname}}return f=m(window.location.href),function(b){const o=Tt.isString(b)?m(b):b;return o.protocol===f.protocol&&o.host===f.host}}():function(){return function(){return!0}}();function ZR(e){const s=/^([-+\w]{1,25})(:?\/\/|:)/.exec(e);return s&&s[1]||""}function WR(e,s){e=e||10;const u=new Array(e),f=new Array(e);let m=0,v=0,b;return s=s!==void 0?s:1e3,function(S){const k=Date.now(),I=f[v];b||(b=k),u[m]=S,f[m]=k;let L=v,D=0;for(;L!==m;)D+=u[L++],L=L%e;if(m=(m+1)%e,m===v&&(v=(v+1)%e),k-b<s)return;const N=I&&k-I;return N?Math.round(D*1e3/N):void 0}}function _w(e,s){let u=0;const f=WR(50,250);return m=>{const v=m.loaded,b=m.lengthComputable?m.total:void 0,o=v-u,S=f(o),k=v<=b;u=v;const I={loaded:v,total:b,progress:b?v/b:void 0,bytes:o,rate:S||void 0,estimated:S&&b&&k?(b-v)/S:void 0,event:m};I[s?"download":"upload"]=!0,e(I)}}const HR=typeof XMLHttpRequest<"u",XR=HR&&function(e){return new Promise(function(u,f){let m=e.data;const v=Ks.from(e.headers).normalize(),b=e.responseType;let o;function S(){e.cancelToken&&e.cancelToken.unsubscribe(o),e.signal&&e.signal.removeEventListener("abort",o)}Tt.isFormData(m)&&(ws.isStandardBrowserEnv||ws.isStandardBrowserWebWorkerEnv)&&v.setContentType(!1);let k=new XMLHttpRequest;if(e.auth){const N=e.auth.username||"",j=e.auth.password?unescape(encodeURIComponent(e.auth.password)):"";v.set("Authorization","Basic "+btoa(N+":"+j))}const I=LS(e.baseURL,e.url);k.open(e.method.toUpperCase(),IS(I,e.params,e.paramsSerializer),!0),k.timeout=e.timeout;function L(){if(!k)return;const N=Ks.from("getAllResponseHeaders"in k&&k.getAllResponseHeaders()),Z={data:!b||b==="text"||b==="json"?k.responseText:k.response,status:k.status,statusText:k.statusText,headers:N,config:e,request:k};UR(function(fe){u(fe),S()},function(fe){f(fe),S()},Z),k=null}if("onloadend"in k?k.onloadend=L:k.onreadystatechange=function(){!k||k.readyState!==4||k.status===0&&!(k.responseURL&&k.responseURL.indexOf("file:")===0)||setTimeout(L)},k.onabort=function(){!k||(f(new si("Request aborted",si.ECONNABORTED,e,k)),k=null)},k.onerror=function(){f(new si("Network Error",si.ERR_NETWORK,e,k)),k=null},k.ontimeout=function(){let j=e.timeout?"timeout of "+e.timeout+"ms exceeded":"timeout exceeded";const Z=e.transitional||kS;e.timeoutErrorMessage&&(j=e.timeoutErrorMessage),f(new si(j,Z.clarifyTimeoutError?si.ETIMEDOUT:si.ECONNABORTED,e,k)),k=null},ws.isStandardBrowserEnv){const N=(e.withCredentials||GR(I))&&e.xsrfCookieName&&jR.read(e.xsrfCookieName);N&&v.set(e.xsrfHeaderName,N)}m===void 0&&v.setContentType(null),"setRequestHeader"in k&&Tt.forEach(v.toJSON(),function(j,Z){k.setRequestHeader(Z,j)}),Tt.isUndefined(e.withCredentials)||(k.withCredentials=!!e.withCredentials),b&&b!=="json"&&(k.responseType=e.responseType),typeof e.onDownloadProgress=="function"&&k.addEventListener("progress",_w(e.onDownloadProgress,!0)),typeof e.onUploadProgress=="function"&&k.upload&&k.upload.addEventListener("progress",_w(e.onUploadProgress)),(e.cancelToken||e.signal)&&(o=N=>{!k||(f(!N||N.type?new $d(null,e,k):N),k.abort(),k=null)},e.cancelToken&&e.cancelToken.subscribe(o),e.signal&&(e.signal.aborted?o():e.signal.addEventListener("abort",o)));const D=ZR(I);if(D&&ws.protocols.indexOf(D)===-1){f(new si("Unsupported protocol "+D+":",si.ERR_BAD_REQUEST,e));return}k.send(m||null)})},em={http:VR,xhr:XR};Tt.forEach(em,(e,s)=>{if(e){try{Object.defineProperty(e,"name",{value:s})}catch{}Object.defineProperty(e,"adapterName",{value:s})}});const KR={getAdapter:e=>{e=Tt.isArray(e)?e:[e];const{length:s}=e;let u,f;for(let m=0;m<s&&(u=e[m],!(f=Tt.isString(u)?em[u.toLowerCase()]:u));m++);if(!f)throw f===!1?new si(`Adapter ${u} is not supported by the environment`,"ERR_NOT_SUPPORT"):new Error(Tt.hasOwnProp(em,u)?`Adapter '${u}' is not available in the build`:`Unknown adapter '${u}'`);if(!Tt.isFunction(f))throw new TypeError("adapter is not a function");return f},adapters:em};function ey(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new $d(null,e)}function yw(e){return ey(e),e.headers=Ks.from(e.headers),e.data=J_.call(e,e.transformRequest),["post","put","patch"].indexOf(e.method)!==-1&&e.headers.setContentType("application/x-www-form-urlencoded",!1),KR.getAdapter(e.adapter||jv.adapter)(e).then(function(f){return ey(e),f.data=J_.call(e,e.transformResponse,f),f.headers=Ks.from(f.headers),f},function(f){return zS(f)||(ey(e),f&&f.response&&(f.response.data=J_.call(e,e.transformResponse,f.response),f.response.headers=Ks.from(f.response.headers))),Promise.reject(f)})}const vw=e=>e instanceof Ks?e.toJSON():e;function Ru(e,s){s=s||{};const u={};function f(k,I,L){return Tt.isPlainObject(k)&&Tt.isPlainObject(I)?Tt.merge.call({caseless:L},k,I):Tt.isPlainObject(I)?Tt.merge({},I):Tt.isArray(I)?I.slice():I}function m(k,I,L){if(Tt.isUndefined(I)){if(!Tt.isUndefined(k))return f(void 0,k,L)}else return f(k,I,L)}function v(k,I){if(!Tt.isUndefined(I))return f(void 0,I)}function b(k,I){if(Tt.isUndefined(I)){if(!Tt.isUndefined(k))return f(void 0,k)}else return f(void 0,I)}function o(k,I,L){if(L in s)return f(k,I);if(L in e)return f(void 0,k)}const S={url:v,method:v,data:v,baseURL:b,transformRequest:b,transformResponse:b,paramsSerializer:b,timeout:b,timeoutMessage:b,withCredentials:b,adapter:b,responseType:b,xsrfCookieName:b,xsrfHeaderName:b,onUploadProgress:b,onDownloadProgress:b,decompress:b,maxContentLength:b,maxBodyLength:b,beforeRedirect:b,transport:b,httpAgent:b,httpsAgent:b,cancelToken:b,socketPath:b,responseEncoding:b,validateStatus:o,headers:(k,I)=>m(vw(k),vw(I),!0)};return Tt.forEach(Object.keys(e).concat(Object.keys(s)),function(I){const L=S[I]||m,D=L(e[I],s[I],I);Tt.isUndefined(D)&&L!==o||(u[I]=D)}),u}const RS="1.2.2",qv={};["object","boolean","number","function","string","symbol"].forEach((e,s)=>{qv[e]=function(f){return typeof f===e||"a"+(s<1?"n ":" ")+e}});const xw={};qv.transitional=function(s,u,f){function m(v,b){return"[Axios v"+RS+"] Transitional option '"+v+"'"+b+(f?". "+f:"")}return(v,b,o)=>{if(s===!1)throw new si(m(b," has been removed"+(u?" in "+u:"")),si.ERR_DEPRECATED);return u&&!xw[b]&&(xw[b]=!0,console.warn(m(b," has been deprecated since v"+u+" and will be removed in the near future"))),s?s(v,b,o):!0}};function YR(e,s,u){if(typeof e!="object")throw new si("options must be an object",si.ERR_BAD_OPTION_VALUE);const f=Object.keys(e);let m=f.length;for(;m-- >0;){const v=f[m],b=s[v];if(b){const o=e[v],S=o===void 0||b(o,v,e);if(S!==!0)throw new si("option "+v+" must be "+S,si.ERR_BAD_OPTION_VALUE);continue}if(u!==!0)throw new si("Unknown option "+v,si.ERR_BAD_OPTION)}}const jy={assertOptions:YR,validators:qv},Ra=jy.validators;class wm{constructor(s){this.defaults=s,this.interceptors={request:new pw,response:new pw}}request(s,u){typeof s=="string"?(u=u||{},u.url=s):u=s||{},u=Ru(this.defaults,u);const{transitional:f,paramsSerializer:m,headers:v}=u;f!==void 0&&jy.assertOptions(f,{silentJSONParsing:Ra.transitional(Ra.boolean),forcedJSONParsing:Ra.transitional(Ra.boolean),clarifyTimeoutError:Ra.transitional(Ra.boolean)},!1),m!==void 0&&jy.assertOptions(m,{encode:Ra.function,serialize:Ra.function},!0),u.method=(u.method||this.defaults.method||"get").toLowerCase();let b;b=v&&Tt.merge(v.common,v[u.method]),b&&Tt.forEach(["delete","get","head","post","put","patch","common"],j=>{delete v[j]}),u.headers=Ks.concat(b,v);const o=[];let S=!0;this.interceptors.request.forEach(function(Z){typeof Z.runWhen=="function"&&Z.runWhen(u)===!1||(S=S&&Z.synchronous,o.unshift(Z.fulfilled,Z.rejected))});const k=[];this.interceptors.response.forEach(function(Z){k.push(Z.fulfilled,Z.rejected)});let I,L=0,D;if(!S){const j=[yw.bind(this),void 0];for(j.unshift.apply(j,o),j.push.apply(j,k),D=j.length,I=Promise.resolve(u);L<D;)I=I.then(j[L++],j[L++]);return I}D=o.length;let N=u;for(L=0;L<D;){const j=o[L++],Z=o[L++];try{N=j(N)}catch(K){Z.call(this,K);break}}try{I=yw.call(this,N)}catch(j){return Promise.reject(j)}for(L=0,D=k.length;L<D;)I=I.then(k[L++],k[L++]);return I}getUri(s){s=Ru(this.defaults,s);const u=LS(s.baseURL,s.url);return IS(u,s.params,s.paramsSerializer)}}Tt.forEach(["delete","get","head","options"],function(s){wm.prototype[s]=function(u,f){return this.request(Ru(f||{},{method:s,url:u,data:(f||{}).data}))}});Tt.forEach(["post","put","patch"],function(s){function u(f){return function(v,b,o){return this.request(Ru(o||{},{method:s,headers:f?{"Content-Type":"multipart/form-data"}:{},url:v,data:b}))}}wm.prototype[s]=u(),wm.prototype[s+"Form"]=u(!0)});const tm=wm;class $v{constructor(s){if(typeof s!="function")throw new TypeError("executor must be a function.");let u;this.promise=new Promise(function(v){u=v});const f=this;this.promise.then(m=>{if(!f._listeners)return;let v=f._listeners.length;for(;v-- >0;)f._listeners[v](m);f._listeners=null}),this.promise.then=m=>{let v;const b=new Promise(o=>{f.subscribe(o),v=o}).then(m);return b.cancel=function(){f.unsubscribe(v)},b},s(function(v,b,o){f.reason||(f.reason=new $d(v,b,o),u(f.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(s){if(this.reason){s(this.reason);return}this._listeners?this._listeners.push(s):this._listeners=[s]}unsubscribe(s){if(!this._listeners)return;const u=this._listeners.indexOf(s);u!==-1&&this._listeners.splice(u,1)}static source(){let s;return{token:new $v(function(m){s=m}),cancel:s}}}const QR=$v;function JR(e){return function(u){return e.apply(null,u)}}function eD(e){return Tt.isObject(e)&&e.isAxiosError===!0}const qy={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(qy).forEach(([e,s])=>{qy[s]=e});const tD=qy;function DS(e){const s=new tm(e),u=_S(tm.prototype.request,s);return Tt.extend(u,tm.prototype,s,{allOwnKeys:!0}),Tt.extend(u,s,null,{allOwnKeys:!0}),u.create=function(m){return DS(Ru(e,m))},u}const ur=DS(jv);ur.Axios=tm;ur.CanceledError=$d;ur.CancelToken=QR;ur.isCancel=zS;ur.VERSION=RS;ur.toFormData=eg;ur.AxiosError=si;ur.Cancel=ur.CanceledError;ur.all=function(s){return Promise.all(s)};ur.spread=JR;ur.isAxiosError=eD;ur.mergeConfig=Ru;ur.AxiosHeaders=Ks;ur.formToJSON=e=>PS(Tt.isHTMLForm(e)?new FormData(e):e);ur.HttpStatusCode=tD;ur.default=ur;const zo=ur,nm=Cv("UserStore",()=>{const e=xt({uid:"",email:"",profilePic:""}),s=se(()=>e.value.uid!=="");function u(m,v,b){e.value.uid=m,e.value.email=v,e.value.profilePic=b}async function f(){await zo.get("/api/logout"),e.value.uid="",e.value.email="",e.value.profilePic=""}return{user:e,isAuthenticated:s,saveUserData:u,logout:f}},{persist:!0});var OS={exports:{}};(function(e,s){(function(u,f){e.exports=f()})(Jo,function(){var u,f,m;function v(o,S){if(!u)u=S;else if(!f)f=S;else{var k="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+u+")(sharedChunk); ("+f+")(sharedChunk); self.onerror = null;",I={};u(I),m=S(I),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(m.workerUrl=window.URL.createObjectURL(new Blob([k],{type:"text/javascript"})))}}v(["exports"],function(o){var S=typeof self<"u"?self:{},k="2.12.1";let I;const L={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(I==null){const n=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{I=process.env.API_URL_REGEX!=null?new RegExp(process.env.API_URL_REGEX):n}catch{I=n}}return I},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){return this.API_URL?this.API_URL.indexOf("https://api.mapbox.cn")===0?"https://events.mapbox.cn/events/v2":this.API_URL.indexOf("https://api.mapbox.com")===0?"https://events.mapbox.com/events/v2":null:null},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},D={supported:!1,testSupport:function(n){!Z&&j&&(K?fe(n):N=n)}};let N,j,Z=!1,K=!1;function fe(n){const t=n.createTexture();n.bindTexture(n.TEXTURE_2D,t);try{if(n.texImage2D(n.TEXTURE_2D,0,n.RGBA,n.RGBA,n.UNSIGNED_BYTE,j),n.isContextLost())return;D.supported=!0}catch{}n.deleteTexture(t),Z=!0}S.document&&(j=S.document.createElement("img"),j.onload=function(){N&&fe(N),N=null,K=!0},j.onerror=function(){Z=!0,N=null},j.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const te="01";var ve=Ce;function Ce(n,t,i,a){this.cx=3*n,this.bx=3*(i-n)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(a-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=n,this.p1y=t,this.p2x=i,this.p2y=a}Ce.prototype={sampleCurveX:function(n){return((this.ax*n+this.bx)*n+this.cx)*n},sampleCurveY:function(n){return((this.ay*n+this.by)*n+this.cy)*n},sampleCurveDerivativeX:function(n){return(3*this.ax*n+2*this.bx)*n+this.cx},solveCurveX:function(n,t){if(t===void 0&&(t=1e-6),n<0)return 0;if(n>1)return 1;for(var i=n,a=0;a<8;a++){var c=this.sampleCurveX(i)-n;if(Math.abs(c)<t)return i;var d=this.sampleCurveDerivativeX(i);if(Math.abs(d)<1e-6)break;i-=c/d}var g=0,y=1;for(i=n,a=0;a<20&&(c=this.sampleCurveX(i),!(Math.abs(c-n)<t));a++)n>c?g=i:y=i,i=.5*(y-g)+g;return i},solve:function(n,t){return this.sampleCurveY(this.solveCurveX(n,t))}};var ce=pe;function pe(n,t){this.x=n,this.y=t}pe.prototype={clone:function(){return new pe(this.x,this.y)},add:function(n){return this.clone()._add(n)},sub:function(n){return this.clone()._sub(n)},multByPoint:function(n){return this.clone()._multByPoint(n)},divByPoint:function(n){return this.clone()._divByPoint(n)},mult:function(n){return this.clone()._mult(n)},div:function(n){return this.clone()._div(n)},rotate:function(n){return this.clone()._rotate(n)},rotateAround:function(n,t){return this.clone()._rotateAround(n,t)},matMult:function(n){return this.clone()._matMult(n)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(n){return this.x===n.x&&this.y===n.y},dist:function(n){return Math.sqrt(this.distSqr(n))},distSqr:function(n){var t=n.x-this.x,i=n.y-this.y;return t*t+i*i},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(n){return Math.atan2(this.y-n.y,this.x-n.x)},angleWith:function(n){return this.angleWithSep(n.x,n.y)},angleWithSep:function(n,t){return Math.atan2(this.x*t-this.y*n,this.x*n+this.y*t)},_matMult:function(n){var t=n[2]*this.x+n[3]*this.y;return this.x=n[0]*this.x+n[1]*this.y,this.y=t,this},_add:function(n){return this.x+=n.x,this.y+=n.y,this},_sub:function(n){return this.x-=n.x,this.y-=n.y,this},_mult:function(n){return this.x*=n,this.y*=n,this},_div:function(n){return this.x/=n,this.y/=n,this},_multByPoint:function(n){return this.x*=n.x,this.y*=n.y,this},_divByPoint:function(n){return this.x/=n.x,this.y/=n.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var n=this.y;return this.y=this.x,this.x=-n,this},_rotate:function(n){var t=Math.cos(n),i=Math.sin(n),a=i*this.x+t*this.y;return this.x=t*this.x-i*this.y,this.y=a,this},_rotateAround:function(n,t){var i=Math.cos(n),a=Math.sin(n),c=t.y+a*(this.x-t.x)+i*(this.y-t.y);return this.x=t.x+i*(this.x-t.x)-a*(this.y-t.y),this.y=c,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},pe.convert=function(n){return n instanceof pe?n:Array.isArray(n)?new pe(n[0],n[1]):n};const Te=Math.PI/180,Me=180/Math.PI;function Ie(n){return n*Te}function ke(n){return n*Me}const Be=[[0,0],[1,0],[1,1],[0,1]];function Re(n){if(n<=0)return 0;if(n>=1)return 1;const t=n*n,i=t*n;return 4*(n<.5?i:3*(n-t)+i-.75)}function Ze(n,t,i,a){const c=new ve(n,t,i,a);return function(d){return c.solve(d)}}const Ye=Ze(.25,.1,.25,1);function lt(n,t,i){return Math.min(i,Math.max(t,n))}function Xt(n,t,i){return(i=lt((i-n)/(t-n),0,1))*i*(3-2*i)}function Ge(n,t,i){const a=i-t,c=((n-t)%a+a)%a+t;return c===t?i:c}function At(n,t,i){if(!n.length)return i(null,[]);let a=n.length;const c=new Array(n.length);let d=null;n.forEach((g,y)=>{t(g,(w,E)=>{w&&(d=w),c[y]=E,--a==0&&i(d,c)})})}function tn(n){const t=[];for(const i in n)t.push(n[i]);return t}function Ve(n,...t){for(const i of t)for(const a in i)n[a]=i[a];return n}let mt=1;function Bt(){return mt++}function jt(){return function n(t){return t?(t^Math.random()*(16>>t/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,n)}()}function xn(n){return n<=1?1:Math.pow(2,Math.ceil(Math.log(n)/Math.LN2))}function rt(n){return!!n&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(n)}function gt(n,t){n.forEach(i=>{t[i]&&(t[i]=t[i].bind(t))})}function ot(n,t){return n.indexOf(t,n.length-t.length)!==-1}function _t(n,t,i){const a={};for(const c in n)a[c]=t.call(i||this,n[c],c,n);return a}function ft(n,t,i){const a={};for(const c in n)t.call(i||this,n[c],c,n)&&(a[c]=n[c]);return a}function sn(n){return Array.isArray(n)?n.map(sn):typeof n=="object"&&n?_t(n,sn):n}const un={};function oe(n){un[n]||(typeof console<"u"&&console.warn(n),un[n]=!0)}function be(n,t,i){return(i.y-n.y)*(t.x-n.x)>(t.y-n.y)*(i.x-n.x)}function Fe(n){let t=0;for(let i,a,c=0,d=n.length,g=d-1;c<d;g=c++)i=n[c],a=n[g],t+=(a.x-i.x)*(i.y+a.y);return t}function nt(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function yt(n){const t={};if(n.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(i,a,c,d)=>{const g=c||d;return t[a]=!g||g.toLowerCase(),""}),t["max-age"]){const i=parseInt(t["max-age"],10);isNaN(i)?delete t["max-age"]:t["max-age"]=i}return t}let zt=null;function Nt(n){if(zt==null){const t=n.navigator?n.navigator.userAgent:null;zt=!!n.safari||!(!t||!(/\b(iPad|iPhone|iPod)\b/.test(t)||t.match("Safari")&&!t.match("Chrome")))}return zt}function kt(n){try{const t=S[n];return t.setItem("_mapbox_test_",1),t.removeItem("_mapbox_test_"),!0}catch{return!1}}function bt(n,t){return[n[4*t],n[4*t+1],n[4*t+2],n[4*t+3]]}const Mt="mapbox-tiles";let Wt,et,Rt=500,nn=50;function bn(){try{return S.caches}catch{}}function Ln(){bn()&&!Wt&&(Wt=S.caches.open(Mt))}function An(n){const t=n.indexOf("?");if(t<0)return n;const i=function(c){const d=c.indexOf("?");return d>0?c.slice(d+1).split("&"):[]}(n),a=i.filter(c=>{const d=c.split("=");return d[0]==="language"||d[0]==="worldview"});return a.length?`${n.slice(0,t)}?${a.join("&")}`:n.slice(0,t)}let qn=1/0;const Hn={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};typeof Object.freeze=="function"&&Object.freeze(Hn);class Bi extends Error{constructor(t,i,a){i===401&&so(a)&&(t+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(t),this.status=i,this.url=a}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const ji=nt()?()=>self.worker&&self.worker.referrer:()=>(S.location.protocol==="blob:"?S.parent:S).location.href,qi=function(n,t){if(!(/^file:/.test(i=n.url)||/^file:/.test(ji())&&!/^\w+:/.test(i))){if(S.fetch&&S.Request&&S.AbortController&&S.Request.prototype.hasOwnProperty("signal"))return function(a,c){const d=new S.AbortController,g=new S.Request(a.url,{method:a.method||"GET",body:a.body,credentials:a.credentials,headers:a.headers,referrer:ji(),signal:d.signal});let y=!1,w=!1;const E=(A=g.url).indexOf("sku=")>0&&so(A);var A;a.type==="json"&&g.headers.set("Accept","application/json");const P=(B,F,q)=>{if(w)return;if(B&&B.message!=="SecurityError"&&oe(B),F&&q)return z(F);const W=Date.now();S.fetch(g).then(le=>{if(le.ok){const _e=E?le.clone():null;return z(le,_e,W)}return c(new Bi(le.statusText,le.status,a.url))}).catch(le=>{le.code!==20&&c(new Error(le.message))})},z=(B,F,q)=>{(a.type==="arrayBuffer"?B.arrayBuffer():a.type==="json"?B.json():B.text()).then(W=>{w||(F&&q&&function(le,_e,ae){if(Ln(),!Wt)return;const de={status:_e.status,statusText:_e.statusText,headers:new S.Headers};_e.headers.forEach(($e,qe)=>de.headers.set(qe,$e));const we=yt(_e.headers.get("Cache-Control")||"");if(we["no-store"])return;we["max-age"]&&de.headers.set("Expires",new Date(ae+1e3*we["max-age"]).toUTCString());const ye=de.headers.get("Expires");ye&&(new Date(ye).getTime()-ae<42e4||function($e,qe){if(et===void 0)try{new Response(new ReadableStream),et=!0}catch{et=!1}et?qe($e.body):$e.blob().then(qe)}(_e,$e=>{const qe=new S.Response($e,de);Ln(),Wt&&Wt.then(it=>it.put(An(le.url),qe)).catch(it=>oe(it.message))}))}(g,F,q),y=!0,c(null,W,B.headers.get("Cache-Control"),B.headers.get("Expires")))}).catch(W=>{w||c(new Error(W.message))})};return E?function(B,F){if(Ln(),!Wt)return F(null);const q=An(B.url);Wt.then(W=>{W.match(q).then(le=>{const _e=function(ae){if(!ae)return!1;const de=new Date(ae.headers.get("Expires")||0),we=yt(ae.headers.get("Cache-Control")||"");return de>Date.now()&&!we["no-cache"]}(le);W.delete(q),_e&&W.put(q,le.clone()),F(null,le,_e)}).catch(F)}).catch(F)}(g,P):P(null,null),{cancel:()=>{w=!0,y||d.abort()}}}(n,t);if(nt()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",n,t,void 0,!0)}var i;return function(a,c){const d=new S.XMLHttpRequest;d.open(a.method||"GET",a.url,!0),a.type==="arrayBuffer"&&(d.responseType="arraybuffer");for(const g in a.headers)d.setRequestHeader(g,a.headers[g]);return a.type==="json"&&(d.responseType="text",d.setRequestHeader("Accept","application/json")),d.withCredentials=a.credentials==="include",d.onerror=()=>{c(new Error(d.statusText))},d.onload=()=>{if((d.status>=200&&d.status<300||d.status===0)&&d.response!==null){let g=d.response;if(a.type==="json")try{g=JSON.parse(d.response)}catch(y){return c(y)}c(null,g,d.getResponseHeader("Cache-Control"),d.getResponseHeader("Expires"))}else c(new Bi(d.statusText,d.status,a.url))},d.send(a.body),{cancel:()=>d.abort()}}(n,t)},tr=function(n,t){return qi(Ve(n,{type:"arrayBuffer"}),t)};function Ei(n){const t=S.document.createElement("a");return t.href=n,t.protocol===S.document.location.protocol&&t.host===S.document.location.host}const $i="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let hr,Mr;hr=[],Mr=0;const Ir=function(n,t){if(D.supported&&(n.headers||(n.headers={}),n.headers.accept="image/webp,*/*"),Mr>=L.MAX_PARALLEL_IMAGE_REQUESTS){const d={requestParameters:n,callback:t,cancelled:!1,cancel(){this.cancelled=!0}};return hr.push(d),d}Mr++;let i=!1;const a=()=>{if(!i)for(i=!0,Mr--;hr.length&&Mr<L.MAX_PARALLEL_IMAGE_REQUESTS;){const d=hr.shift(),{requestParameters:g,callback:y,cancelled:w}=d;w||(d.cancel=Ir(g,y).cancel)}},c=tr(n,(d,g,y,w)=>{a(),d?t(d):g&&(S.createImageBitmap?function(E,A){const P=new S.Blob([new Uint8Array(E)],{type:"image/png"});S.createImageBitmap(P).then(z=>{A(null,z)}).catch(z=>{A(new Error(`Could not load image because of ${z.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(g,(E,A)=>t(E,A,y,w)):function(E,A){const P=new S.Image,z=S.URL;P.onload=()=>{A(null,P),z.revokeObjectURL(P.src),P.onload=null,S.requestAnimationFrame(()=>{P.src=$i})},P.onerror=()=>A(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const B=new S.Blob([new Uint8Array(E)],{type:"image/png"});P.src=E.byteLength?z.createObjectURL(B):$i}(g,(E,A)=>t(E,A,y,w)))});return{cancel:()=>{c.cancel(),a()}}},mo="NO_ACCESS_TOKEN";function vr(n){return n.indexOf("mapbox:")===0}function so(n){return L.API_URL_REGEX.test(n)}function ns(n){return L.API_CDN_URL_REGEX.test(n)}function ao(n){return L.API_STYLE_REGEX.test(n)&&!ct(n)}function ct(n){return L.API_SPRITE_REGEX.test(n)}const Kt=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function hn(n){const t=n.match(Kt);if(!t)throw new Error("Unable to parse URL object");return{protocol:t[1],authority:t[2],path:t[3]||"/",params:t[4]?t[4].split("&"):[]}}function En(n){const t=n.params.length?`?${n.params.join("&")}`:"";return`${n.protocol}://${n.authority}${n.path}${t}`}function kn(n){if(!n)return null;const t=n.split(".");if(!t||t.length!==3)return null;try{return JSON.parse(decodeURIComponent(S.atob(t[1]).split("").map(i=>"%"+("00"+i.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch{return null}}class Y{constructor(t){this.type=t,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(t){const i=kn(L.ACCESS_TOKEN);let a="";return a=i&&i.u?S.btoa(encodeURIComponent(i.u).replace(/%([0-9A-F]{2})/g,(c,d)=>String.fromCharCode(Number("0x"+d)))):L.ACCESS_TOKEN||"",t?`mapbox.eventData.${t}:${a}`:`mapbox.eventData:${a}`}fetchEventData(){const t=kt("localStorage"),i=this.getStorageKey(),a=this.getStorageKey("uuid");if(t)try{const c=S.localStorage.getItem(i);c&&(this.eventData=JSON.parse(c));const d=S.localStorage.getItem(a);d&&(this.anonId=d)}catch{oe("Unable to read from LocalStorage")}}saveEventData(){const t=kt("localStorage"),i=this.getStorageKey(),a=this.getStorageKey("uuid");if(t)try{S.localStorage.setItem(a,this.anonId),Object.keys(this.eventData).length>=1&&S.localStorage.setItem(i,JSON.stringify(this.eventData))}catch{oe("Unable to write to LocalStorage")}}processRequests(t){}postEvent(t,i,a,c){if(!L.EVENTS_URL)return;const d=hn(L.EVENTS_URL);d.params.push(`access_token=${c||L.ACCESS_TOKEN||""}`);const g={event:this.type,created:new Date(t).toISOString()},y=i?Ve(g,i):g,w={url:En(d),headers:{"Content-Type":"text/plain"},body:JSON.stringify([y])};this.pendingRequest=function(E,A){return qi(Ve(E,{method:"POST"}),A)}(w,E=>{this.pendingRequest=null,a(E),this.saveEventData(),this.processRequests(c)})}queueRequest(t,i){this.queue.push(t),this.processRequests(i)}}const V=new class extends Y{constructor(n){super("appUserTurnstile"),this._customAccessToken=n}postTurnstileEvent(n,t){L.EVENTS_URL&&L.ACCESS_TOKEN&&Array.isArray(n)&&n.some(i=>vr(i)||so(i))&&this.queueRequest(Date.now(),t)}processRequests(n){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const t=kn(L.ACCESS_TOKEN),i=t?t.u:L.ACCESS_TOKEN;let a=i!==this.eventData.tokenU;rt(this.anonId)||(this.anonId=jt(),a=!0);const c=this.queue.shift();if(this.eventData.lastSuccess){const d=new Date(this.eventData.lastSuccess),g=new Date(c),y=(c-this.eventData.lastSuccess)/864e5;a=a||y>=1||y<-1||d.getDate()!==g.getDate()}else a=!0;a?this.postEvent(c,{sdkIdentifier:"mapbox-gl-js",sdkVersion:k,skuId:te,"enabled.telemetry":!1,userId:this.anonId},d=>{d||(this.eventData.lastSuccess=c,this.eventData.tokenU=i)},n):this.processRequests()}},$=V.postTurnstileEvent.bind(V),J=new class extends Y{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(n,t,i,a){this.skuToken=t,this.errorCb=a,L.EVENTS_URL&&(i||L.ACCESS_TOKEN?this.queueRequest({id:n,timestamp:Date.now()},i):this.errorCb(new Error(mo)))}processRequests(n){if(this.pendingRequest||this.queue.length===0)return;const{id:t,timestamp:i}=this.queue.shift();t&&this.success[t]||(this.anonId||this.fetchEventData(),rt(this.anonId)||(this.anonId=jt()),this.postEvent(i,{sdkIdentifier:"mapbox-gl-js",sdkVersion:k,skuId:te,skuToken:this.skuToken,userId:this.anonId},a=>{a?this.errorCb(a):t&&(this.success[t]=!0)},n))}},ue=J.postMapLoadEvent.bind(J),Se=new class extends Y{constructor(){super("gljs.performance")}postPerformanceEvent(n,t){L.EVENTS_URL&&(n||L.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:t},n)}processRequests(n){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:t,performanceData:i}=this.queue.shift(),a=function(c){const d=S.performance.getEntriesByType("resource"),g=S.performance.getEntriesByType("mark"),y=function(z){const B={};if(z){for(const F in z)if(F!=="other")for(const q of z[F]){const W=`${F}ResolveRangeMin`,le=`${F}ResolveRangeMax`,_e=`${F}RequestCount`,ae=`${F}RequestCachedCount`;B[W]=Math.min(B[W]||1/0,q.startTime),B[le]=Math.max(B[le]||-1/0,q.responseEnd);const de=we=>{B[we]===void 0&&(B[we]=0),++B[we]};q.transferSize!==void 0&&q.transferSize===0&&de(ae),de(_e)}}return B}(function(z,B){const F={};if(z)for(const q of z){const W=B(q);F[W]===void 0&&(F[W]=[]),F[W].push(q)}return F}(d,wt)),w=S.devicePixelRatio,E=S.navigator.connection||S.navigator.mozConnection||S.navigator.webkitConnection,A={counters:[],metadata:[],attributes:[]},P=(z,B,F)=>{F!=null&&z.push({name:B,value:F.toString()})};for(const z in y)P(A.counters,z,y[z]);if(c.interactionRange[0]!==1/0&&c.interactionRange[1]!==-1/0&&(P(A.counters,"interactionRangeMin",c.interactionRange[0]),P(A.counters,"interactionRangeMax",c.interactionRange[1])),g)for(const z of Object.keys(ht)){const B=ht[z],F=g.find(q=>q.name===B);F&&P(A.counters,B,F.startTime)}return P(A.counters,"visibilityHidden",c.visibilityHidden),P(A.attributes,"style",function(z){if(z)for(const B of z){const F=B.name.split("?")[0];if(ao(F)){const q=F.split("/").slice(-2);if(q.length===2)return`mapbox://styles/${q[0]}/${q[1]}`}}}(d)),P(A.attributes,"terrainEnabled",c.terrainEnabled?"true":"false"),P(A.attributes,"fogEnabled",c.fogEnabled?"true":"false"),P(A.attributes,"projection",c.projection),P(A.attributes,"zoom",c.zoom),P(A.metadata,"devicePixelRatio",w),P(A.metadata,"connectionEffectiveType",E?E.effectiveType:void 0),P(A.metadata,"navigatorUserAgent",S.navigator.userAgent),P(A.metadata,"screenWidth",S.screen.width),P(A.metadata,"screenHeight",S.screen.height),P(A.metadata,"windowWidth",S.innerWidth),P(A.metadata,"windowHeight",S.innerHeight),P(A.metadata,"mapWidth",c.width/w),P(A.metadata,"mapHeight",c.height/w),P(A.metadata,"webglRenderer",c.renderer),P(A.metadata,"webglVendor",c.vendor),P(A.metadata,"sdkVersion",k),P(A.metadata,"sdkIdentifier","mapbox-gl-js"),A}(i);for(const c of a.metadata);for(const c of a.counters);for(const c of a.attributes);this.postEvent(t,a,()=>{},n)}},Oe=Se.postPerformanceEvent.bind(Se),ze=new class extends Y{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(n,t,i,a){if(!L.API_URL||!L.SESSION_PATH)return;const c=hn(L.API_URL+L.SESSION_PATH);c.params.push(`sku=${t||""}`),c.params.push(`access_token=${a||L.ACCESS_TOKEN||""}`);const d={url:En(c),headers:{"Content-Type":"text/plain"}};this.pendingRequest=function(g,y){return qi(Ve(g,{method:"GET"}),y)}(d,g=>{this.pendingRequest=null,i(g),this.saveEventData(),this.processRequests(a)})}getSessionAPI(n,t,i,a){this.skuToken=t,this.errorCb=a,L.SESSION_PATH&&L.API_URL&&(i||L.ACCESS_TOKEN?this.queueRequest({id:n,timestamp:Date.now()},i):this.errorCb(new Error(mo)))}processRequests(n){if(this.pendingRequest||this.queue.length===0)return;const{id:t,timestamp:i}=this.queue.shift();t&&this.success[t]||this.getSession(i,this.skuToken,a=>{a?this.errorCb(a):t&&(this.success[t]=!0)},n)}},Ae=ze.getSessionAPI.bind(ze),Ne=new Set,ht={create:"create",load:"load",fullLoad:"fullLoad"},Ft={mark(n){S.performance.mark(n)},measure(n,t,i){S.performance.measure(n,t,i)}};function wt(n){const t=n.name.split("?")[0];return ns(t)&&t.includes("mapbox-gl.js")?"javascript":ns(t)&&t.includes("mapbox-gl.css")?"css":function(i){return L.API_FONTS_REGEX.test(i)}(t)?"fontRange":ct(t)?"sprite":ao(t)?"style":function(i){return L.API_TILEJSON_REGEX.test(i)}(t)?"tilejson":"other"}const an=S.performance;function on(n){const t=n?n.url.toString():void 0;return an.getEntriesByName(t)}let rn,fn,ge,Lt;const at={now:()=>ge!==void 0?ge:S.performance.now(),setNow(n){ge=n},restoreNow(){ge=void 0},frame(n){const t=S.requestAnimationFrame(n);return{cancel:()=>S.cancelAnimationFrame(t)}},getImageData(n,t=0){const{width:i,height:a}=n;Lt||(Lt=S.document.createElement("canvas"));const c=Lt.getContext("2d",{willReadFrequently:!0});if(!c)throw new Error("failed to create canvas 2d context");return(i>Lt.width||a>Lt.height)&&(Lt.width=i,Lt.height=a),c.clearRect(-t,-t,i+2*t,a+2*t),c.drawImage(n,0,0,i,a),c.getImageData(-t,-t,i+2*t,a+2*t)},resolveURL:n=>(rn||(rn=S.document.createElement("a")),rn.href=n,rn.href),get devicePixelRatio(){return S.devicePixelRatio},get prefersReducedMotion(){return!!S.matchMedia&&(fn==null&&(fn=S.matchMedia("(prefers-reduced-motion: reduce)")),fn.matches)}};function Yt(n,t,i){i[n]&&i[n].indexOf(t)!==-1||(i[n]=i[n]||[],i[n].push(t))}function yn(n,t,i){if(i&&i[n]){const a=i[n].indexOf(t);a!==-1&&i[n].splice(a,1)}}class Fn{constructor(t,i={}){Ve(this,i),this.type=t}}class ai extends Fn{constructor(t,i={}){super("error",Ve({error:t},i))}}class mi{on(t,i){return this._listeners=this._listeners||{},Yt(t,i,this._listeners),this}off(t,i){return yn(t,i,this._listeners),yn(t,i,this._oneTimeListeners),this}once(t,i){return i?(this._oneTimeListeners=this._oneTimeListeners||{},Yt(t,i,this._oneTimeListeners),this):new Promise(a=>this.once(t,a))}fire(t,i){typeof t=="string"&&(t=new Fn(t,i||{}));const a=t.type;if(this.listens(a)){t.target=this;const c=this._listeners&&this._listeners[a]?this._listeners[a].slice():[];for(const y of c)y.call(this,t);const d=this._oneTimeListeners&&this._oneTimeListeners[a]?this._oneTimeListeners[a].slice():[];for(const y of d)yn(a,y,this._oneTimeListeners),y.call(this,t);const g=this._eventedParent;g&&(Ve(t,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),g.fire(t))}else t instanceof ai&&console.error(t.error);return this}listens(t){return!!(this._listeners&&this._listeners[t]&&this._listeners[t].length>0||this._oneTimeListeners&&this._oneTimeListeners[t]&&this._oneTimeListeners[t].length>0||this._eventedParent&&this._eventedParent.listens(t))}setEventedParent(t,i){return this._eventedParent=t,this._eventedParentData=i,this}}var tt=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360,"units":"degrees"},"pitch":{"type":"number","default":0,"units":"degrees"},"light":{"type":"light"},"terrain":{"type":"terrain"},"fog":{"type":"fog"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":{},"mapbox":{}},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":{}}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":{}}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":{}}},"url":{"required":true,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"hillshade":{},"background":{},"sky":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky"],"layout_background":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","private":true,"default":0,"minimum":0,"maximum":1,"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":{},"round":{},"square":{}},"default":"butt","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":{},"round":{},"miter":{}},"default":"miter","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"requires":[{"line-join":"miter"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"requires":[{"line-join":"round"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":{},"line":{},"line-center":{}},"default":"point","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"units":"pixels","requires":[{"symbol-placement":"line"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":{},"viewport-y":{},"source":{}},"default":"auto","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"units":"factor of the original icon size","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":{},"width":{},"height":{},"both":{}},"default":"none","requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"units":"pixels","requires":["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"requires":["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"units":"ems","requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":{},"left":{},"center":{},"right":{}},"default":"center","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","units":"ems","default":0,"requires":["text-field"],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["text-field",{"!":"text-variable-anchor"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"units":"degrees","requires":["text-field",{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":{},"vertical":{}},"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"requires":["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":{},"uppercase":{},"lowercase":{}},"default":"none","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","units":"ems","length":2,"default":[0,0],"requires":["text-field",{"!":"text-radial-offset"}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"requires":["text-field","icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},"in":{},"!in":{},"all":{},"any":{},"none":{},"has":{},"!has":{},"within":{}}},"geometry_type":{"type":"enum","values":{"Point":{},"LineString":{},"Polygon":{}}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":{},"exponential":{},"interval":{},"categorical":{}},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":{},"lab":{},"hcl":{}},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":{},"viewport":{}},"property-type":"data-constant","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":{},"equalEarth":{},"equirectangular":{},"lambertConformalConic":{},"mercator":{},"naturalEarth":{},"winkelTripel":{},"globe":{}},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["source"]}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"requires":[{"!":"fill-pattern"},{"fill-antialias":true}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-extrusion-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-extrusion-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"requires":["fill-extrusion-height"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","private":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["fill-extrusion-edge-radius"]}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"line-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["line-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"transition":false,"units":"line widths","requires":[{"!":"line-pattern"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{"type":"color","transition":false,"requires":[{"!":"line-pattern"},{"source":"geojson","has":{"lineMetrics":true}}],"expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"transition":false,"requires":[{"source":"geojson","has":{"lineMetrics":true}}],"property-type":"constant"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["circle-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"transition":false,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"transition":false,"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["icon-image","icon-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["text-field","text-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"units":"degrees","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":{},"nearest":{}},"default":"linear","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"transition":false,"units":"milliseconds","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"transition":false,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"background-pattern"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":{},"atmosphere":{}},"default":"atmosphere","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"requires":[{"sky-type":"atmosphere"}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","requires":[{"sky-type":"atmosphere"}],"default":10,"minimum":0,"maximum":100,"transition":false,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","requires":[{"sky-type":"gradient"}],"value":"number","default":[0,0],"length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","requires":[{"sky-type":"gradient"}],"default":90,"minimum":0,"maximum":180,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"transition":false,"requires":[{"sky-type":"gradient"}],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0,"units":"milliseconds"},"delay":{"type":"number","default":0,"minimum":0,"units":"milliseconds"}},"property-type":{"data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function Bo(n,...t){for(const i of t)for(const a in i)n[a]=i[a];return n}function Gi(n){return n instanceof Number||n instanceof String||n instanceof Boolean?n.valueOf():n}function Fo(n){if(Array.isArray(n))return n.map(Fo);if(n instanceof Object&&!(n instanceof Number||n instanceof String||n instanceof Boolean)){const t={};for(const i in n)t[i]=Fo(n[i]);return t}return Gi(n)}class pg extends Error{constructor(t,i){super(i),this.message=i,this.key=t}}var qr=pg;class sc{constructor(t,i=[]){this.parent=t,this.bindings={};for(const[a,c]of i)this.bindings[a]=c}concat(t){return new sc(this,t)}get(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error(`${t} not found in scope.`)}has(t){return!!this.bindings[t]||!!this.parent&&this.parent.has(t)}}var Wd=sc;const xr={kind:"null"},qt={kind:"number"},Nn={kind:"string"},Rn={kind:"boolean"},lo={kind:"color"},As={kind:"object"},Pn={kind:"value"},Ya={kind:"collator"},oa={kind:"formatted"},is={kind:"resolvedImage"};function nr(n,t){return{kind:"array",itemType:n,N:t}}function Ti(n){if(n.kind==="array"){const t=Ti(n.itemType);return typeof n.N=="number"?`array<${t}, ${n.N}>`:n.itemType.kind==="value"?"array":`array<${t}>`}return n.kind}const go=[xr,qt,Nn,Rn,lo,oa,As,nr(Pn),is];function Qa(n,t){if(t.kind==="error")return null;if(n.kind==="array"){if(t.kind==="array"&&(t.N===0&&t.itemType.kind==="value"||!Qa(n.itemType,t.itemType))&&(typeof n.N!="number"||n.N===t.N))return null}else{if(n.kind===t.kind)return null;if(n.kind==="value"){for(const i of go)if(!Qa(i,t))return null}}return`Expected ${Ti(n)} but found ${Ti(t)} instead.`}function Ja(n,t){return t.some(i=>i.kind===n.kind)}function el(n,t){return t.some(i=>i==="null"?n===null:i==="array"?Array.isArray(n):i==="object"?n&&!Array.isArray(n)&&typeof n=="object":i===typeof n)}var tl,$u={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function rs(n){return(n=Math.round(n))<0?0:n>255?255:n}function nl(n){return rs(n[n.length-1]==="%"?parseFloat(n)/100*255:parseInt(n))}function ac(n){return(t=n[n.length-1]==="%"?parseFloat(n)/100:parseFloat(n))<0?0:t>1?1:t;var t}function Gu(n,t,i){return i<0?i+=1:i>1&&(i-=1),6*i<1?n+(t-n)*i*6:2*i<1?t:3*i<2?n+(t-n)*(2/3-i)*6:n}try{tl={}.parseCSSColor=function(n){var t,i=n.replace(/ /g,"").toLowerCase();if(i in $u)return $u[i].slice();if(i[0]==="#")return i.length===4?(t=parseInt(i.substr(1),16))>=0&&t<=4095?[(3840&t)>>4|(3840&t)>>8,240&t|(240&t)>>4,15&t|(15&t)<<4,1]:null:i.length===7&&(t=parseInt(i.substr(1),16))>=0&&t<=16777215?[(16711680&t)>>16,(65280&t)>>8,255&t,1]:null;var a=i.indexOf("("),c=i.indexOf(")");if(a!==-1&&c+1===i.length){var d=i.substr(0,a),g=i.substr(a+1,c-(a+1)).split(","),y=1;switch(d){case"rgba":if(g.length!==4)return null;y=ac(g.pop());case"rgb":return g.length!==3?null:[nl(g[0]),nl(g[1]),nl(g[2]),y];case"hsla":if(g.length!==4)return null;y=ac(g.pop());case"hsl":if(g.length!==3)return null;var w=(parseFloat(g[0])%360+360)%360/360,E=ac(g[1]),A=ac(g[2]),P=A<=.5?A*(E+1):A+E-A*E,z=2*A-P;return[rs(255*Gu(z,P,w+1/3)),rs(255*Gu(z,P,w)),rs(255*Gu(z,P,w-1/3)),y];default:return null}}return null}}catch{}class kr{constructor(t,i,a,c=1){this.r=t,this.g=i,this.b=a,this.a=c}static parse(t){if(!t)return;if(t instanceof kr)return t;if(typeof t!="string")return;const i=tl(t);return i?new kr(i[0]/255*i[3],i[1]/255*i[3],i[2]/255*i[3],i[3]):void 0}toString(){const[t,i,a,c]=this.toArray();return`rgba(${Math.round(t)},${Math.round(i)},${Math.round(a)},${c})`}toArray(){const{r:t,g:i,b:a,a:c}=this;return c===0?[0,0,0,0]:[255*t/c,255*i/c,255*a/c,c]}toArray01(){const{r:t,g:i,b:a,a:c}=this;return c===0?[0,0,0,0]:[t/c,i/c,a/c,c]}toArray01PremultipliedAlpha(){const{r:t,g:i,b:a,a:c}=this;return[t,i,a,c]}}kr.black=new kr(0,0,0,1),kr.white=new kr(1,1,1,1),kr.transparent=new kr(0,0,0,0),kr.red=new kr(1,0,0,1),kr.blue=new kr(0,0,1,1);var ki=kr;class il{constructor(t,i,a){this.sensitivity=t?i?"variant":"case":i?"accent":"base",this.locale=a,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(t,i){return this.collator.compare(t,i)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Zu{constructor(t,i,a,c,d){this.text=t.normalize?t.normalize():t,this.image=i,this.scale=a,this.fontStack=c,this.textColor=d}}class ir{constructor(t){this.sections=t}static fromString(t){return new ir([new Zu(t,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(t=>t.text.length!==0||t.image&&t.image.name.length!==0)}static factory(t){return t instanceof ir?t:ir.fromString(t)}toString(){return this.sections.length===0?"":this.sections.map(t=>t.text).join("")}serialize(){const t=["format"];for(const i of this.sections){if(i.image){t.push(["image",i.image.name]);continue}t.push(i.text);const a={};i.fontStack&&(a["text-font"]=["literal",i.fontStack.split(",")]),i.scale&&(a["font-scale"]=i.scale),i.textColor&&(a["text-color"]=["rgba"].concat(i.textColor.toArray())),t.push(a)}return t}}class Hr{constructor(t){this.name=t.name,this.available=t.available}toString(){return this.name}static fromString(t){return t?new Hr({name:t,available:!1}):null}serialize(){return["image",this.name]}}function Hd(n,t,i,a){return typeof n=="number"&&n>=0&&n<=255&&typeof t=="number"&&t>=0&&t<=255&&typeof i=="number"&&i>=0&&i<=255?a===void 0||typeof a=="number"&&a>=0&&a<=1?null:`Invalid rgba value [${[n,t,i,a].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof a=="number"?[n,t,i,a]:[n,t,i]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function lc(n){if(n===null||typeof n=="string"||typeof n=="boolean"||typeof n=="number"||n instanceof ki||n instanceof il||n instanceof ir||n instanceof Hr)return!0;if(Array.isArray(n)){for(const t of n)if(!lc(t))return!1;return!0}if(typeof n=="object"){for(const t in n)if(!lc(n[t]))return!1;return!0}return!1}function Zi(n){if(n===null)return xr;if(typeof n=="string")return Nn;if(typeof n=="boolean")return Rn;if(typeof n=="number")return qt;if(n instanceof ki)return lo;if(n instanceof il)return Ya;if(n instanceof ir)return oa;if(n instanceof Hr)return is;if(Array.isArray(n)){const t=n.length;let i;for(const a of n){const c=Zi(a);if(i){if(i===c)continue;i=Pn;break}i=c}return nr(i||Pn,t)}return As}function rl(n){const t=typeof n;return n===null?"":t==="string"||t==="number"||t==="boolean"?String(n):n instanceof ki||n instanceof ir||n instanceof Hr?n.toString():JSON.stringify(n)}class Wu{constructor(t,i){this.type=t,this.value=i}static parse(t,i){if(t.length!==2)return i.error(`'literal' expression requires exactly one argument, but found ${t.length-1} instead.`);if(!lc(t[1]))return i.error("invalid value");const a=t[1];let c=Zi(a);const d=i.expectedType;return c.kind!=="array"||c.N!==0||!d||d.kind!=="array"||typeof d.N=="number"&&d.N!==0||(c=d),new Wu(c,a)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof ki?["rgba"].concat(this.value.toArray()):this.value instanceof ir?this.value.serialize():this.value}}var ol=Wu,Ji=class{constructor(n){this.name="ExpressionEvaluationError",this.message=n}toJSON(){return this.message}};const sa={string:Nn,number:qt,boolean:Rn,object:As};class Hu{constructor(t,i){this.type=t,this.args=i}static parse(t,i){if(t.length<2)return i.error("Expected at least one argument.");let a,c=1;const d=t[0];if(d==="array"){let y,w;if(t.length>2){const E=t[1];if(typeof E!="string"||!(E in sa)||E==="object")return i.error('The item type argument of "array" must be one of string, number, boolean',1);y=sa[E],c++}else y=Pn;if(t.length>3){if(t[2]!==null&&(typeof t[2]!="number"||t[2]<0||t[2]!==Math.floor(t[2])))return i.error('The length argument to "array" must be a positive integer literal',2);w=t[2],c++}a=nr(y,w)}else a=sa[d];const g=[];for(;c<t.length;c++){const y=i.parse(t[c],c,Pn);if(!y)return null;g.push(y)}return new Hu(a,g)}evaluate(t){for(let i=0;i<this.args.length;i++){const a=this.args[i].evaluate(t);if(!Qa(this.type,Zi(a)))return a;if(i===this.args.length-1)throw new Ji(`Expected value to be of type ${Ti(this.type)}, but found ${Ti(Zi(a))} instead.`)}return null}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}serialize(){const t=this.type,i=[t.kind];if(t.kind==="array"){const a=t.itemType;if(a.kind==="string"||a.kind==="number"||a.kind==="boolean"){i.push(a.kind);const c=t.N;(typeof c=="number"||this.args.length>1)&&i.push(c)}}return i.concat(this.args.map(a=>a.serialize()))}}var No=Hu;class sl{constructor(t){this.type=oa,this.sections=t}static parse(t,i){if(t.length<2)return i.error("Expected at least one argument.");const a=t[1];if(!Array.isArray(a)&&typeof a=="object")return i.error("First argument must be an image or text section.");const c=[];let d=!1;for(let g=1;g<=t.length-1;++g){const y=t[g];if(d&&typeof y=="object"&&!Array.isArray(y)){d=!1;let w=null;if(y["font-scale"]&&(w=i.parse(y["font-scale"],1,qt),!w))return null;let E=null;if(y["text-font"]&&(E=i.parse(y["text-font"],1,nr(Nn)),!E))return null;let A=null;if(y["text-color"]&&(A=i.parse(y["text-color"],1,lo),!A))return null;const P=c[c.length-1];P.scale=w,P.font=E,P.textColor=A}else{const w=i.parse(t[g],1,Pn);if(!w)return null;const E=w.type.kind;if(E!=="string"&&E!=="value"&&E!=="null"&&E!=="resolvedImage")return i.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");d=!0,c.push({content:w,scale:null,font:null,textColor:null})}}return new sl(c)}evaluate(t){return new ir(this.sections.map(i=>{const a=i.content.evaluate(t);return Zi(a)===is?new Zu("",a,null,null,null):new Zu(rl(a),null,i.scale?i.scale.evaluate(t):null,i.font?i.font.evaluate(t).join(","):null,i.textColor?i.textColor.evaluate(t):null)}))}eachChild(t){for(const i of this.sections)t(i.content),i.scale&&t(i.scale),i.font&&t(i.font),i.textColor&&t(i.textColor)}outputDefined(){return!1}serialize(){const t=["format"];for(const i of this.sections){t.push(i.content.serialize());const a={};i.scale&&(a["font-scale"]=i.scale.serialize()),i.font&&(a["text-font"]=i.font.serialize()),i.textColor&&(a["text-color"]=i.textColor.serialize()),t.push(a)}return t}}class cc{constructor(t){this.type=is,this.input=t}static parse(t,i){if(t.length!==2)return i.error("Expected two arguments.");const a=i.parse(t[1],1,Nn);return a?new cc(a):i.error("No image name provided.")}evaluate(t){const i=this.input.evaluate(t),a=Hr.fromString(i);return a&&t.availableImages&&(a.available=t.availableImages.indexOf(i)>-1),a}eachChild(t){t(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}const mg={"to-boolean":Rn,"to-color":lo,"to-number":qt,"to-string":Nn};class Xu{constructor(t,i){this.type=t,this.args=i}static parse(t,i){if(t.length<2)return i.error("Expected at least one argument.");const a=t[0];if((a==="to-boolean"||a==="to-string")&&t.length!==2)return i.error("Expected one argument.");const c=mg[a],d=[];for(let g=1;g<t.length;g++){const y=i.parse(t[g],g,Pn);if(!y)return null;d.push(y)}return new Xu(c,d)}evaluate(t){if(this.type.kind==="boolean")return Boolean(this.args[0].evaluate(t));if(this.type.kind==="color"){let i,a;for(const c of this.args){if(i=c.evaluate(t),a=null,i instanceof ki)return i;if(typeof i=="string"){const d=t.parseColor(i);if(d)return d}else if(Array.isArray(i)&&(a=i.length<3||i.length>4?`Invalid rbga value ${JSON.stringify(i)}: expected an array containing either three or four numeric values.`:Hd(i[0],i[1],i[2],i[3]),!a))return new ki(i[0]/255,i[1]/255,i[2]/255,i[3])}throw new Ji(a||`Could not parse color from value '${typeof i=="string"?i:String(JSON.stringify(i))}'`)}if(this.type.kind==="number"){let i=null;for(const a of this.args){if(i=a.evaluate(t),i===null)return 0;const c=Number(i);if(!isNaN(c))return c}throw new Ji(`Could not convert ${JSON.stringify(i)} to number.`)}return this.type.kind==="formatted"?ir.fromString(rl(this.args[0].evaluate(t))):this.type.kind==="resolvedImage"?Hr.fromString(rl(this.args[0].evaluate(t))):rl(this.args[0].evaluate(t))}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}serialize(){if(this.type.kind==="formatted")return new sl([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new cc(this.args[0]).serialize();const t=[`to-${this.type.kind}`];return this.eachChild(i=>{t.push(i.serialize())}),t}}var Ms=Xu;const uc=["Unknown","Point","LineString","Polygon"];var Xd=class{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?uc[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const n=this.featureDistanceData.center,t=this.featureDistanceData.scale,{x:i,y:a}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(i*t-n[0])+this.featureDistanceData.bearing[1]*(a*t-n[1])}return 0}parseColor(n){let t=this._parseColorCache[n];return t||(t=this._parseColorCache[n]=ki.parse(n)),t}};class aa{constructor(t,i,a,c){this.name=t,this.type=i,this._evaluate=a,this.args=c}evaluate(t){return this._evaluate(t,this.args)}eachChild(t){this.args.forEach(t)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(t=>t.serialize()))}static parse(t,i){const a=t[0],c=aa.definitions[a];if(!c)return i.error(`Unknown expression "${a}". If you wanted a literal array, use ["literal", [...]].`,0);const d=Array.isArray(c)?c[0]:c.type,g=Array.isArray(c)?[[c[1],c[2]]]:c.overloads,y=g.filter(([E])=>!Array.isArray(E)||E.length===t.length-1);let w=null;for(const[E,A]of y){w=new ks(i.registry,i.path,null,i.scope);const P=[];let z=!1;for(let B=1;B<t.length;B++){const F=t[B],q=Array.isArray(E)?E[B-1]:E.type,W=w.parse(F,1+P.length,q);if(!W){z=!0;break}P.push(W)}if(!z)if(Array.isArray(E)&&E.length!==P.length)w.error(`Expected ${E.length} arguments, but found ${P.length} instead.`);else{for(let B=0;B<P.length;B++){const F=Array.isArray(E)?E[B]:E.type,q=P[B];w.concat(B+1).checkSubtype(F,q.type)}if(w.errors.length===0)return new aa(a,d,A,P)}}if(y.length===1)i.errors.push(...w.errors);else{const E=(y.length?y:g).map(([P])=>{return z=P,Array.isArray(z)?`(${z.map(Ti).join(", ")})`:`(${Ti(z.type)}...)`;var z}).join(" | "),A=[];for(let P=1;P<t.length;P++){const z=i.parse(t[P],1+A.length);if(!z)return null;A.push(Ti(z.type))}i.error(`Expected arguments of type ${E}, but found (${A.join(", ")}) instead.`)}return null}static register(t,i){aa.definitions=i;for(const a in i)t[a]=aa}}var os=aa;class hc{constructor(t,i,a){this.type=Ya,this.locale=a,this.caseSensitive=t,this.diacriticSensitive=i}static parse(t,i){if(t.length!==2)return i.error("Expected one argument.");const a=t[1];if(typeof a!="object"||Array.isArray(a))return i.error("Collator options argument must be an object.");const c=i.parse(a["case-sensitive"]!==void 0&&a["case-sensitive"],1,Rn);if(!c)return null;const d=i.parse(a["diacritic-sensitive"]!==void 0&&a["diacritic-sensitive"],1,Rn);if(!d)return null;let g=null;return a.locale&&(g=i.parse(a.locale,1,Nn),!g)?null:new hc(c,d,g)}evaluate(t){return new il(this.caseSensitive.evaluate(t),this.diacriticSensitive.evaluate(t),this.locale?this.locale.evaluate(t):null)}eachChild(t){t(this.caseSensitive),t(this.diacriticSensitive),this.locale&&t(this.locale)}outputDefined(){return!1}serialize(){const t={};return t["case-sensitive"]=this.caseSensitive.serialize(),t["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(t.locale=this.locale.serialize()),["collator",t]}}const rr=8192;function dc(n,t){n[0]=Math.min(n[0],t[0]),n[1]=Math.min(n[1],t[1]),n[2]=Math.max(n[2],t[0]),n[3]=Math.max(n[3],t[1])}function al(n,t){return!(n[0]<=t[0]||n[2]>=t[2]||n[1]<=t[1]||n[3]>=t[3])}function Kd(n,t){const i=(180+n[0])/360,a=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+n[1]*Math.PI/360)))/360,c=Math.pow(2,t.z);return[Math.round(i*c*rr),Math.round(a*c*rr)]}function Yd(n,t,i){const a=n[0]-t[0],c=n[1]-t[1],d=n[0]-i[0],g=n[1]-i[1];return a*g-d*c==0&&a*d<=0&&c*g<=0}function fc(n,t){let i=!1;for(let g=0,y=t.length;g<y;g++){const w=t[g];for(let E=0,A=w.length;E<A-1;E++){if(Yd(n,w[E],w[E+1]))return!1;(c=w[E])[1]>(a=n)[1]!=(d=w[E+1])[1]>a[1]&&a[0]<(d[0]-c[0])*(a[1]-c[1])/(d[1]-c[1])+c[0]&&(i=!i)}}var a,c,d;return i}function Qd(n,t){for(let i=0;i<t.length;i++)if(fc(n,t[i]))return!0;return!1}function pc(n,t,i,a){const c=a[0]-i[0],d=a[1]-i[1],g=(n[0]-i[0])*d-c*(n[1]-i[1]),y=(t[0]-i[0])*d-c*(t[1]-i[1]);return g>0&&y<0||g<0&&y>0}function ll(n,t,i){for(const E of i)for(let A=0;A<E.length-1;++A)if((y=[(g=E[A+1])[0]-(d=E[A])[0],g[1]-d[1]])[0]*(w=[(c=t)[0]-(a=n)[0],c[1]-a[1]])[1]-y[1]*w[0]!=0&&pc(a,c,d,g)&&pc(d,g,a,c))return!0;var a,c,d,g,y,w;return!1}function Ku(n,t){for(let i=0;i<n.length;++i)if(!fc(n[i],t))return!1;for(let i=0;i<n.length-1;++i)if(ll(n[i],n[i+1],t))return!1;return!0}function Jd(n,t){for(let i=0;i<t.length;i++)if(Ku(n,t[i]))return!0;return!1}function cl(n,t,i){const a=[];for(let c=0;c<n.length;c++){const d=[];for(let g=0;g<n[c].length;g++){const y=Kd(n[c][g],i);dc(t,y),d.push(y)}a.push(d)}return a}function Yu(n,t,i){const a=[];for(let c=0;c<n.length;c++){const d=cl(n[c],t,i);a.push(d)}return a}function Is(n,t,i,a){if(n[0]<i[0]||n[0]>i[2]){const c=.5*a;let d=n[0]-i[0]>c?-a:i[0]-n[0]>c?a:0;d===0&&(d=n[0]-i[2]>c?-a:i[2]-n[0]>c?a:0),n[0]+=d}dc(t,n)}function Xn(n,t,i,a){const c=Math.pow(2,a.z)*rr,d=[a.x*rr,a.y*rr],g=[];if(!n)return g;for(const y of n)for(const w of y){const E=[w.x+d[0],w.y+d[1]];Is(E,t,i,c),g.push(E)}return g}function ef(n,t,i,a){const c=Math.pow(2,a.z)*rr,d=[a.x*rr,a.y*rr],g=[];if(!n)return g;for(const w of n){const E=[];for(const A of w){const P=[A.x+d[0],A.y+d[1]];dc(t,P),E.push(P)}g.push(E)}if(t[2]-t[0]<=c/2){(y=t)[0]=y[1]=1/0,y[2]=y[3]=-1/0;for(const w of g)for(const E of w)Is(E,t,i,c)}var y;return g}class ul{constructor(t,i){this.type=Rn,this.geojson=t,this.geometries=i}static parse(t,i){if(t.length!==2)return i.error(`'within' expression requires exactly one argument, but found ${t.length-1} instead.`);if(lc(t[1])){const a=t[1];if(a.type==="FeatureCollection")for(let c=0;c<a.features.length;++c){const d=a.features[c].geometry.type;if(d==="Polygon"||d==="MultiPolygon")return new ul(a,a.features[c].geometry)}else if(a.type==="Feature"){const c=a.geometry.type;if(c==="Polygon"||c==="MultiPolygon")return new ul(a,a.geometry)}else if(a.type==="Polygon"||a.type==="MultiPolygon")return new ul(a,a)}return i.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return function(i,a){const c=[1/0,1/0,-1/0,-1/0],d=[1/0,1/0,-1/0,-1/0],g=i.canonicalID();if(!g)return!1;if(a.type==="Polygon"){const y=cl(a.coordinates,d,g),w=Xn(i.geometry(),c,d,g);if(!al(c,d))return!1;for(const E of w)if(!fc(E,y))return!1}if(a.type==="MultiPolygon"){const y=Yu(a.coordinates,d,g),w=Xn(i.geometry(),c,d,g);if(!al(c,d))return!1;for(const E of w)if(!Qd(E,y))return!1}return!0}(t,this.geometries);if(t.geometryType()==="LineString")return function(i,a){const c=[1/0,1/0,-1/0,-1/0],d=[1/0,1/0,-1/0,-1/0],g=i.canonicalID();if(!g)return!1;if(a.type==="Polygon"){const y=cl(a.coordinates,d,g),w=ef(i.geometry(),c,d,g);if(!al(c,d))return!1;for(const E of w)if(!Ku(E,y))return!1}if(a.type==="MultiPolygon"){const y=Yu(a.coordinates,d,g),w=ef(i.geometry(),c,d,g);if(!al(c,d))return!1;for(const E of w)if(!Jd(E,y))return!1}return!0}(t,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}var Qu=ul;function la(n){if(n instanceof os&&(n.name==="get"&&n.args.length===1||n.name==="feature-state"||n.name==="has"&&n.args.length===1||n.name==="properties"||n.name==="geometry-type"||n.name==="id"||/^filter-/.test(n.name))||n instanceof Qu)return!1;let t=!0;return n.eachChild(i=>{t&&!la(i)&&(t=!1)}),t}function mc(n){if(n instanceof os&&n.name==="feature-state")return!1;let t=!0;return n.eachChild(i=>{t&&!mc(i)&&(t=!1)}),t}function hl(n,t){if(n instanceof os&&t.indexOf(n.name)>=0)return!1;let i=!0;return n.eachChild(a=>{i&&!hl(a,t)&&(i=!1)}),i}class gc{constructor(t,i){this.type=i.type,this.name=t,this.boundExpression=i}static parse(t,i){if(t.length!==2||typeof t[1]!="string")return i.error("'var' expression requires exactly one string literal argument.");const a=t[1];return i.scope.has(a)?new gc(a,i.scope.get(a)):i.error(`Unknown variable "${a}". Make sure "${a}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(t){return this.boundExpression.evaluate(t)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}var Ju=gc;class _c{constructor(t,i=[],a,c=new Wd,d=[]){this.registry=t,this.path=i,this.key=i.map(g=>`[${g}]`).join(""),this.scope=c,this.errors=d,this.expectedType=a}parse(t,i,a,c,d={}){return i?this.concat(i,a,c)._parse(t,d):this._parse(t,d)}_parse(t,i){function a(c,d,g){return g==="assert"?new No(d,[c]):g==="coerce"?new Ms(d,[c]):c}if(t!==null&&typeof t!="string"&&typeof t!="boolean"&&typeof t!="number"||(t=["literal",t]),Array.isArray(t)){if(t.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const c=t[0];if(typeof c!="string")return this.error(`Expression name must be a string, but found ${typeof c} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const d=this.registry[c];if(d){let g=d.parse(t,this);if(!g)return null;if(this.expectedType){const y=this.expectedType,w=g.type;if(y.kind!=="string"&&y.kind!=="number"&&y.kind!=="boolean"&&y.kind!=="object"&&y.kind!=="array"||w.kind!=="value")if(y.kind!=="color"&&y.kind!=="formatted"&&y.kind!=="resolvedImage"||w.kind!=="value"&&w.kind!=="string"){if(this.checkSubtype(y,w))return null}else g=a(g,y,i.typeAnnotation||"coerce");else g=a(g,y,i.typeAnnotation||"assert")}if(!(g instanceof ol)&&g.type.kind!=="resolvedImage"&&ca(g)){const y=new Xd;try{g=new ol(g.type,g.evaluate(y))}catch(w){return this.error(w.message),null}}return g}return this.error(`Unknown expression "${c}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(t===void 0?"'undefined' value invalid. Use null instead.":typeof t=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof t} instead.`)}concat(t,i,a){const c=typeof t=="number"?this.path.concat(t):this.path,d=a?this.scope.concat(a):this.scope;return new _c(this.registry,c,i||null,d,this.errors)}error(t,...i){const a=`${this.key}${i.map(c=>`[${c}]`).join("")}`;this.errors.push(new qr(a,t))}checkSubtype(t,i){const a=Qa(t,i);return a&&this.error(a),a}}var ks=_c;function ca(n){if(n instanceof Ju)return ca(n.boundExpression);if(n instanceof os&&n.name==="error"||n instanceof hc||n instanceof Qu)return!1;const t=n instanceof Ms||n instanceof No;let i=!0;return n.eachChild(a=>{i=t?i&&ca(a):i&&a instanceof ol}),!!i&&la(n)&&hl(n,["zoom","heatmap-density","line-progress","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center"])}function yc(n,t){const i=n.length-1;let a,c,d=0,g=i,y=0;for(;d<=g;)if(y=Math.floor((d+g)/2),a=n[y],c=n[y+1],a<=t){if(y===i||t<c)return y;d=y+1}else{if(!(a>t))throw new Ji("Input is not a number.");g=y-1}return 0}class dl{constructor(t,i,a){this.type=t,this.input=i,this.labels=[],this.outputs=[];for(const[c,d]of a)this.labels.push(c),this.outputs.push(d)}static parse(t,i){if(t.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return i.error("Expected an even number of arguments.");const a=i.parse(t[1],1,qt);if(!a)return null;const c=[];let d=null;i.expectedType&&i.expectedType.kind!=="value"&&(d=i.expectedType);for(let g=1;g<t.length;g+=2){const y=g===1?-1/0:t[g],w=t[g+1],E=g,A=g+1;if(typeof y!="number")return i.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',E);if(c.length&&c[c.length-1][0]>=y)return i.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',E);const P=i.parse(w,A,d);if(!P)return null;d=d||P.type,c.push([y,P])}return new dl(d,a,c)}evaluate(t){const i=this.labels,a=this.outputs;if(i.length===1)return a[0].evaluate(t);const c=this.input.evaluate(t);if(c<=i[0])return a[0].evaluate(t);const d=i.length;return c>=i[d-1]?a[d-1].evaluate(t):a[yc(i,c)].evaluate(t)}eachChild(t){t(this.input);for(const i of this.outputs)t(i)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}serialize(){const t=["step",this.input.serialize()];for(let i=0;i<this.labels.length;i++)i>0&&t.push(this.labels[i]),t.push(this.outputs[i].serialize());return t}}var vc=dl;function $n(n,t,i){return n*(1-i)+t*i}var xc=Object.freeze({__proto__:null,number:$n,color:function(n,t,i){return new ki($n(n.r,t.r,i),$n(n.g,t.g,i),$n(n.b,t.b,i),$n(n.a,t.a,i))},array:function(n,t,i){return n.map((a,c)=>$n(a,t[c],i))}});const eh=.95047,tf=1.08883,th=4/29,bc=6/29,nf=3*bc*bc,rf=Math.PI/180,gg=180/Math.PI;function wc(n){return n>.008856451679035631?Math.pow(n,1/3):n/nf+th}function Ec(n){return n>bc?n*n*n:nf*(n-th)}function nh(n){return 255*(n<=.0031308?12.92*n:1.055*Math.pow(n,1/2.4)-.055)}function ih(n){return(n/=255)<=.04045?n/12.92:Math.pow((n+.055)/1.055,2.4)}function of(n){const t=ih(n.r),i=ih(n.g),a=ih(n.b),c=wc((.4124564*t+.3575761*i+.1804375*a)/eh),d=wc((.2126729*t+.7151522*i+.072175*a)/1);return{l:116*d-16,a:500*(c-d),b:200*(d-wc((.0193339*t+.119192*i+.9503041*a)/tf)),alpha:n.a}}function sf(n){let t=(n.l+16)/116,i=isNaN(n.a)?t:t+n.a/500,a=isNaN(n.b)?t:t-n.b/200;return t=1*Ec(t),i=eh*Ec(i),a=tf*Ec(a),new ki(nh(3.2404542*i-1.5371385*t-.4985314*a),nh(-.969266*i+1.8760108*t+.041556*a),nh(.0556434*i-.2040259*t+1.0572252*a),n.alpha)}function _g(n,t,i){const a=t-n;return n+i*(a>180||a<-180?a-360*Math.round(a/360):a)}const fl={forward:of,reverse:sf,interpolate:function(n,t,i){return{l:$n(n.l,t.l,i),a:$n(n.a,t.a,i),b:$n(n.b,t.b,i),alpha:$n(n.alpha,t.alpha,i)}}},ua={forward:function(n){const{l:t,a:i,b:a}=of(n),c=Math.atan2(a,i)*gg;return{h:c<0?c+360:c,c:Math.sqrt(i*i+a*a),l:t,alpha:n.a}},reverse:function(n){const t=n.h*rf,i=n.c;return sf({l:n.l,a:Math.cos(t)*i,b:Math.sin(t)*i,alpha:n.alpha})},interpolate:function(n,t,i){return{h:_g(n.h,t.h,i),c:$n(n.c,t.c,i),l:$n(n.l,t.l,i),alpha:$n(n.alpha,t.alpha,i)}}};var af=Object.freeze({__proto__:null,lab:fl,hcl:ua});class Tc{constructor(t,i,a,c,d){this.type=t,this.operator=i,this.interpolation=a,this.input=c,this.labels=[],this.outputs=[];for(const[g,y]of d)this.labels.push(g),this.outputs.push(y)}static interpolationFactor(t,i,a,c){let d=0;if(t.name==="exponential")d=rh(i,t.base,a,c);else if(t.name==="linear")d=rh(i,1,a,c);else if(t.name==="cubic-bezier"){const g=t.controlPoints;d=new ve(g[0],g[1],g[2],g[3]).solve(rh(i,1,a,c))}return d}static parse(t,i){let[a,c,d,...g]=t;if(!Array.isArray(c)||c.length===0)return i.error("Expected an interpolation type expression.",1);if(c[0]==="linear")c={name:"linear"};else if(c[0]==="exponential"){const E=c[1];if(typeof E!="number")return i.error("Exponential interpolation requires a numeric base.",1,1);c={name:"exponential",base:E}}else{if(c[0]!=="cubic-bezier")return i.error(`Unknown interpolation type ${String(c[0])}`,1,0);{const E=c.slice(1);if(E.length!==4||E.some(A=>typeof A!="number"||A<0||A>1))return i.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);c={name:"cubic-bezier",controlPoints:E}}}if(t.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return i.error("Expected an even number of arguments.");if(d=i.parse(d,2,qt),!d)return null;const y=[];let w=null;a==="interpolate-hcl"||a==="interpolate-lab"?w=lo:i.expectedType&&i.expectedType.kind!=="value"&&(w=i.expectedType);for(let E=0;E<g.length;E+=2){const A=g[E],P=g[E+1],z=E+3,B=E+4;if(typeof A!="number")return i.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',z);if(y.length&&y[y.length-1][0]>=A)return i.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',z);const F=i.parse(P,B,w);if(!F)return null;w=w||F.type,y.push([A,F])}return w.kind==="number"||w.kind==="color"||w.kind==="array"&&w.itemType.kind==="number"&&typeof w.N=="number"?new Tc(w,a,c,d,y):i.error(`Type ${Ti(w)} is not interpolatable.`)}evaluate(t){const i=this.labels,a=this.outputs;if(i.length===1)return a[0].evaluate(t);const c=this.input.evaluate(t);if(c<=i[0])return a[0].evaluate(t);const d=i.length;if(c>=i[d-1])return a[d-1].evaluate(t);const g=yc(i,c),y=Tc.interpolationFactor(this.interpolation,c,i[g],i[g+1]),w=a[g].evaluate(t),E=a[g+1].evaluate(t);return this.operator==="interpolate"?xc[this.type.kind.toLowerCase()](w,E,y):this.operator==="interpolate-hcl"?ua.reverse(ua.interpolate(ua.forward(w),ua.forward(E),y)):fl.reverse(fl.interpolate(fl.forward(w),fl.forward(E),y))}eachChild(t){t(this.input);for(const i of this.outputs)t(i)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}serialize(){let t;t=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const i=[this.operator,t,this.input.serialize()];for(let a=0;a<this.labels.length;a++)i.push(this.labels[a],this.outputs[a].serialize());return i}}function rh(n,t,i,a){const c=a-i,d=n-i;return c===0?0:t===1?d/c:(Math.pow(t,d)-1)/(Math.pow(t,c)-1)}var _o=Tc;class Sc{constructor(t,i){this.type=t,this.args=i}static parse(t,i){if(t.length<2)return i.error("Expectected at least one argument.");let a=null;const c=i.expectedType;c&&c.kind!=="value"&&(a=c);const d=[];for(const y of t.slice(1)){const w=i.parse(y,1+d.length,a,void 0,{typeAnnotation:"omit"});if(!w)return null;a=a||w.type,d.push(w)}const g=c&&d.some(y=>Qa(c,y.type));return new Sc(g?Pn:a,d)}evaluate(t){let i,a=null,c=0;for(const d of this.args){if(c++,a=d.evaluate(t),a&&a instanceof Hr&&!a.available&&(i||(i=a),a=null,c===this.args.length))return i;if(a!==null)break}return a}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}serialize(){const t=["coalesce"];return this.eachChild(i=>{t.push(i.serialize())}),t}}var oh=Sc;class Cc{constructor(t,i){this.type=i.type,this.bindings=[].concat(t),this.result=i}evaluate(t){return this.result.evaluate(t)}eachChild(t){for(const i of this.bindings)t(i[1]);t(this.result)}static parse(t,i){if(t.length<4)return i.error(`Expected at least 3 arguments, but found ${t.length-1} instead.`);const a=[];for(let d=1;d<t.length-1;d+=2){const g=t[d];if(typeof g!="string")return i.error(`Expected string, but found ${typeof g} instead.`,d);if(/[^a-zA-Z0-9_]/.test(g))return i.error("Variable names must contain only alphanumeric characters or '_'.",d);const y=i.parse(t[d+1],d+1);if(!y)return null;a.push([g,y])}const c=i.parse(t[t.length-1],t.length-1,i.expectedType,a);return c?new Cc(a,c):null}outputDefined(){return this.result.outputDefined()}serialize(){const t=["let"];for(const[i,a]of this.bindings)t.push(i,a.serialize());return t.push(this.result.serialize()),t}}var lf=Cc;class sh{constructor(t,i,a){this.type=t,this.index=i,this.input=a}static parse(t,i){if(t.length!==3)return i.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const a=i.parse(t[1],1,qt),c=i.parse(t[2],2,nr(i.expectedType||Pn));return a&&c?new sh(c.type.itemType,a,c):null}evaluate(t){const i=this.index.evaluate(t),a=this.input.evaluate(t);if(i<0)throw new Ji(`Array index out of bounds: ${i} < 0.`);if(i>=a.length)throw new Ji(`Array index out of bounds: ${i} > ${a.length-1}.`);if(i!==Math.floor(i))throw new Ji(`Array index must be an integer, but found ${i} instead.`);return a[i]}eachChild(t){t(this.index),t(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}var cf=sh;class Ac{constructor(t,i){this.type=Rn,this.needle=t,this.haystack=i}static parse(t,i){if(t.length!==3)return i.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const a=i.parse(t[1],1,Pn),c=i.parse(t[2],2,Pn);return a&&c?Ja(a.type,[Rn,Nn,qt,xr,Pn])?new Ac(a,c):i.error(`Expected first argument to be of type boolean, string, number or null, but found ${Ti(a.type)} instead`):null}evaluate(t){const i=this.needle.evaluate(t),a=this.haystack.evaluate(t);if(a==null)return!1;if(!el(i,["boolean","string","number","null"]))throw new Ji(`Expected first argument to be of type boolean, string, number or null, but found ${Ti(Zi(i))} instead.`);if(!el(a,["string","array"]))throw new Ji(`Expected second argument to be of type array or string, but found ${Ti(Zi(a))} instead.`);return a.indexOf(i)>=0}eachChild(t){t(this.needle),t(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}var uf=Ac;class Mc{constructor(t,i,a){this.type=qt,this.needle=t,this.haystack=i,this.fromIndex=a}static parse(t,i){if(t.length<=2||t.length>=5)return i.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const a=i.parse(t[1],1,Pn),c=i.parse(t[2],2,Pn);if(!a||!c)return null;if(!Ja(a.type,[Rn,Nn,qt,xr,Pn]))return i.error(`Expected first argument to be of type boolean, string, number or null, but found ${Ti(a.type)} instead`);if(t.length===4){const d=i.parse(t[3],3,qt);return d?new Mc(a,c,d):null}return new Mc(a,c)}evaluate(t){const i=this.needle.evaluate(t),a=this.haystack.evaluate(t);if(!el(i,["boolean","string","number","null"]))throw new Ji(`Expected first argument to be of type boolean, string, number or null, but found ${Ti(Zi(i))} instead.`);if(!el(a,["string","array"]))throw new Ji(`Expected second argument to be of type array or string, but found ${Ti(Zi(a))} instead.`);if(this.fromIndex){const c=this.fromIndex.evaluate(t);return a.indexOf(i,c)}return a.indexOf(i)}eachChild(t){t(this.needle),t(this.haystack),this.fromIndex&&t(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const t=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),t]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}var yg=Mc;class ah{constructor(t,i,a,c,d,g){this.inputType=t,this.type=i,this.input=a,this.cases=c,this.outputs=d,this.otherwise=g}static parse(t,i){if(t.length<5)return i.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if(t.length%2!=1)return i.error("Expected an even number of arguments.");let a,c;i.expectedType&&i.expectedType.kind!=="value"&&(c=i.expectedType);const d={},g=[];for(let E=2;E<t.length-1;E+=2){let A=t[E];const P=t[E+1];Array.isArray(A)||(A=[A]);const z=i.concat(E);if(A.length===0)return z.error("Expected at least one branch label.");for(const F of A){if(typeof F!="number"&&typeof F!="string")return z.error("Branch labels must be numbers or strings.");if(typeof F=="number"&&Math.abs(F)>Number.MAX_SAFE_INTEGER)return z.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof F=="number"&&Math.floor(F)!==F)return z.error("Numeric branch labels must be integer values.");if(a){if(z.checkSubtype(a,Zi(F)))return null}else a=Zi(F);if(d[String(F)]!==void 0)return z.error("Branch labels must be unique.");d[String(F)]=g.length}const B=i.parse(P,E,c);if(!B)return null;c=c||B.type,g.push(B)}const y=i.parse(t[1],1,Pn);if(!y)return null;const w=i.parse(t[t.length-1],t.length-1,c);return w?y.type.kind!=="value"&&i.concat(1).checkSubtype(a,y.type)?null:new ah(a,c,y,d,g,w):null}evaluate(t){const i=this.input.evaluate(t);return(Zi(i)===this.inputType&&this.outputs[this.cases[i]]||this.otherwise).evaluate(t)}eachChild(t){t(this.input),this.outputs.forEach(t),t(this.otherwise)}outputDefined(){return this.outputs.every(t=>t.outputDefined())&&this.otherwise.outputDefined()}serialize(){const t=["match",this.input.serialize()],i=Object.keys(this.cases).sort(),a=[],c={};for(const g of i){const y=c[this.cases[g]];y===void 0?(c[this.cases[g]]=a.length,a.push([this.cases[g],[g]])):a[y][1].push(g)}const d=g=>this.inputType.kind==="number"?Number(g):g;for(const[g,y]of a)t.push(y.length===1?d(y[0]):y.map(d)),t.push(this.outputs[g].serialize());return t.push(this.otherwise.serialize()),t}}var vg=ah;class ha{constructor(t,i,a){this.type=t,this.branches=i,this.otherwise=a}static parse(t,i){if(t.length<4)return i.error(`Expected at least 3 arguments, but found only ${t.length-1}.`);if(t.length%2!=0)return i.error("Expected an odd number of arguments.");let a;i.expectedType&&i.expectedType.kind!=="value"&&(a=i.expectedType);const c=[];for(let g=1;g<t.length-1;g+=2){const y=i.parse(t[g],g,Rn);if(!y)return null;const w=i.parse(t[g+1],g+1,a);if(!w)return null;c.push([y,w]),a=a||w.type}const d=i.parse(t[t.length-1],t.length-1,a);return d?new ha(a,c,d):null}evaluate(t){for(const[i,a]of this.branches)if(i.evaluate(t))return a.evaluate(t);return this.otherwise.evaluate(t)}eachChild(t){for(const[i,a]of this.branches)t(i),t(a);t(this.otherwise)}outputDefined(){return this.branches.every(([t,i])=>i.outputDefined())&&this.otherwise.outputDefined()}serialize(){const t=["case"];return this.eachChild(i=>{t.push(i.serialize())}),t}}var hf=ha;class pl{constructor(t,i,a,c){this.type=t,this.input=i,this.beginIndex=a,this.endIndex=c}static parse(t,i){if(t.length<=2||t.length>=5)return i.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const a=i.parse(t[1],1,Pn),c=i.parse(t[2],2,qt);if(!a||!c)return null;if(!Ja(a.type,[nr(Pn),Nn,Pn]))return i.error(`Expected first argument to be of type array or string, but found ${Ti(a.type)} instead`);if(t.length===4){const d=i.parse(t[3],3,qt);return d?new pl(a.type,a,c,d):null}return new pl(a.type,a,c)}evaluate(t){const i=this.input.evaluate(t),a=this.beginIndex.evaluate(t);if(!el(i,["string","array"]))throw new Ji(`Expected first argument to be of type array or string, but found ${Ti(Zi(i))} instead.`);if(this.endIndex){const c=this.endIndex.evaluate(t);return i.slice(a,c)}return i.slice(a)}eachChild(t){t(this.input),t(this.beginIndex),this.endIndex&&t(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const t=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),t]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}var xg=pl;function df(n,t){return n==="=="||n==="!="?t.kind==="boolean"||t.kind==="string"||t.kind==="number"||t.kind==="null"||t.kind==="value":t.kind==="string"||t.kind==="number"||t.kind==="value"}function ff(n,t,i,a){return a.compare(t,i)===0}function Ps(n,t,i){const a=n!=="=="&&n!=="!=";return class BS{constructor(d,g,y){this.type=Rn,this.lhs=d,this.rhs=g,this.collator=y,this.hasUntypedArgument=d.type.kind==="value"||g.type.kind==="value"}static parse(d,g){if(d.length!==3&&d.length!==4)return g.error("Expected two or three arguments.");const y=d[0];let w=g.parse(d[1],1,Pn);if(!w)return null;if(!df(y,w.type))return g.concat(1).error(`"${y}" comparisons are not supported for type '${Ti(w.type)}'.`);let E=g.parse(d[2],2,Pn);if(!E)return null;if(!df(y,E.type))return g.concat(2).error(`"${y}" comparisons are not supported for type '${Ti(E.type)}'.`);if(w.type.kind!==E.type.kind&&w.type.kind!=="value"&&E.type.kind!=="value")return g.error(`Cannot compare types '${Ti(w.type)}' and '${Ti(E.type)}'.`);a&&(w.type.kind==="value"&&E.type.kind!=="value"?w=new No(E.type,[w]):w.type.kind!=="value"&&E.type.kind==="value"&&(E=new No(w.type,[E])));let A=null;if(d.length===4){if(w.type.kind!=="string"&&E.type.kind!=="string"&&w.type.kind!=="value"&&E.type.kind!=="value")return g.error("Cannot use collator to compare non-string types.");if(A=g.parse(d[3],3,Ya),!A)return null}return new BS(w,E,A)}evaluate(d){const g=this.lhs.evaluate(d),y=this.rhs.evaluate(d);if(a&&this.hasUntypedArgument){const w=Zi(g),E=Zi(y);if(w.kind!==E.kind||w.kind!=="string"&&w.kind!=="number")throw new Ji(`Expected arguments for "${n}" to be (string, string) or (number, number), but found (${w.kind}, ${E.kind}) instead.`)}if(this.collator&&!a&&this.hasUntypedArgument){const w=Zi(g),E=Zi(y);if(w.kind!=="string"||E.kind!=="string")return t(d,g,y)}return this.collator?i(d,g,y,this.collator.evaluate(d)):t(d,g,y)}eachChild(d){d(this.lhs),d(this.rhs),this.collator&&d(this.collator)}outputDefined(){return!0}serialize(){const d=[n];return this.eachChild(g=>{d.push(g.serialize())}),d}}}const pf=Ps("==",function(n,t,i){return t===i},ff),mf=Ps("!=",function(n,t,i){return t!==i},function(n,t,i,a){return!ff(0,t,i,a)}),lh=Ps("<",function(n,t,i){return t<i},function(n,t,i,a){return a.compare(t,i)<0}),bg=Ps(">",function(n,t,i){return t>i},function(n,t,i,a){return a.compare(t,i)>0}),wg=Ps("<=",function(n,t,i){return t<=i},function(n,t,i,a){return a.compare(t,i)<=0}),Eg=Ps(">=",function(n,t,i){return t>=i},function(n,t,i,a){return a.compare(t,i)>=0});class ch{constructor(t,i,a,c,d,g){this.type=Nn,this.number=t,this.locale=i,this.currency=a,this.unit=c,this.minFractionDigits=d,this.maxFractionDigits=g}static parse(t,i){if(t.length!==3)return i.error("Expected two arguments.");const a=i.parse(t[1],1,qt);if(!a)return null;const c=t[2];if(typeof c!="object"||Array.isArray(c))return i.error("NumberFormat options argument must be an object.");let d=null;if(c.locale&&(d=i.parse(c.locale,1,Nn),!d))return null;let g=null;if(c.currency&&(g=i.parse(c.currency,1,Nn),!g))return null;let y=null;if(c.unit&&(y=i.parse(c.unit,1,Nn),!y))return null;let w=null;if(c["min-fraction-digits"]&&(w=i.parse(c["min-fraction-digits"],1,qt),!w))return null;let E=null;return c["max-fraction-digits"]&&(E=i.parse(c["max-fraction-digits"],1,qt),!E)?null:new ch(a,d,g,y,w,E)}evaluate(t){return new Intl.NumberFormat(this.locale?this.locale.evaluate(t):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(t):void 0,unit:this.unit?this.unit.evaluate(t):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(t):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(t):void 0}).format(this.number.evaluate(t))}eachChild(t){t(this.number),this.locale&&t(this.locale),this.currency&&t(this.currency),this.unit&&t(this.unit),this.minFractionDigits&&t(this.minFractionDigits),this.maxFractionDigits&&t(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const t={};return this.locale&&(t.locale=this.locale.serialize()),this.currency&&(t.currency=this.currency.serialize()),this.unit&&(t.unit=this.unit.serialize()),this.minFractionDigits&&(t["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(t["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),t]}}class uh{constructor(t){this.type=qt,this.input=t}static parse(t,i){if(t.length!==2)return i.error(`Expected 1 argument, but found ${t.length-1} instead.`);const a=i.parse(t[1],1);return a?a.type.kind!=="array"&&a.type.kind!=="string"&&a.type.kind!=="value"?i.error(`Expected argument of type string or array, but found ${Ti(a.type)} instead.`):new uh(a):null}evaluate(t){const i=this.input.evaluate(t);if(typeof i=="string"||Array.isArray(i))return i.length;throw new Ji(`Expected value to be of type string or array, but found ${Ti(Zi(i))} instead.`)}eachChild(t){t(this.input)}outputDefined(){return!1}serialize(){const t=["length"];return this.eachChild(i=>{t.push(i.serialize())}),t}}const gf={"==":pf,"!=":mf,">":bg,"<":lh,">=":Eg,"<=":wg,array:No,at:cf,boolean:No,case:hf,coalesce:oh,collator:hc,format:sl,image:cc,in:uf,"index-of":yg,interpolate:_o,"interpolate-hcl":_o,"interpolate-lab":_o,length:uh,let:lf,literal:ol,match:vg,number:No,"number-format":ch,object:No,slice:xg,step:vc,string:No,"to-boolean":Ms,"to-color":Ms,"to-number":Ms,"to-string":Ms,var:Ju,within:Qu};function _f(n,[t,i,a,c]){t=t.evaluate(n),i=i.evaluate(n),a=a.evaluate(n);const d=c?c.evaluate(n):1,g=Hd(t,i,a,d);if(g)throw new Ji(g);return new ki(t/255*d,i/255*d,a/255*d,d)}function hh(n,t){return n in t}function Ic(n,t){const i=t[n];return i===void 0?null:i}function yo(n){return{type:n}}os.register(gf,{error:[{kind:"error"},[Nn],(n,[t])=>{throw new Ji(t.evaluate(n))}],typeof:[Nn,[Pn],(n,[t])=>Ti(Zi(t.evaluate(n)))],"to-rgba":[nr(qt,4),[lo],(n,[t])=>t.evaluate(n).toArray()],rgb:[lo,[qt,qt,qt],_f],rgba:[lo,[qt,qt,qt,qt],_f],has:{type:Rn,overloads:[[[Nn],(n,[t])=>hh(t.evaluate(n),n.properties())],[[Nn,As],(n,[t,i])=>hh(t.evaluate(n),i.evaluate(n))]]},get:{type:Pn,overloads:[[[Nn],(n,[t])=>Ic(t.evaluate(n),n.properties())],[[Nn,As],(n,[t,i])=>Ic(t.evaluate(n),i.evaluate(n))]]},"feature-state":[Pn,[Nn],(n,[t])=>Ic(t.evaluate(n),n.featureState||{})],properties:[As,[],n=>n.properties()],"geometry-type":[Nn,[],n=>n.geometryType()],id:[Pn,[],n=>n.id()],zoom:[qt,[],n=>n.globals.zoom],pitch:[qt,[],n=>n.globals.pitch||0],"distance-from-center":[qt,[],n=>n.distanceFromCenter()],"heatmap-density":[qt,[],n=>n.globals.heatmapDensity||0],"line-progress":[qt,[],n=>n.globals.lineProgress||0],"sky-radial-progress":[qt,[],n=>n.globals.skyRadialProgress||0],accumulated:[Pn,[],n=>n.globals.accumulated===void 0?null:n.globals.accumulated],"+":[qt,yo(qt),(n,t)=>{let i=0;for(const a of t)i+=a.evaluate(n);return i}],"*":[qt,yo(qt),(n,t)=>{let i=1;for(const a of t)i*=a.evaluate(n);return i}],"-":{type:qt,overloads:[[[qt,qt],(n,[t,i])=>t.evaluate(n)-i.evaluate(n)],[[qt],(n,[t])=>-t.evaluate(n)]]},"/":[qt,[qt,qt],(n,[t,i])=>t.evaluate(n)/i.evaluate(n)],"%":[qt,[qt,qt],(n,[t,i])=>t.evaluate(n)%i.evaluate(n)],ln2:[qt,[],()=>Math.LN2],pi:[qt,[],()=>Math.PI],e:[qt,[],()=>Math.E],"^":[qt,[qt,qt],(n,[t,i])=>Math.pow(t.evaluate(n),i.evaluate(n))],sqrt:[qt,[qt],(n,[t])=>Math.sqrt(t.evaluate(n))],log10:[qt,[qt],(n,[t])=>Math.log(t.evaluate(n))/Math.LN10],ln:[qt,[qt],(n,[t])=>Math.log(t.evaluate(n))],log2:[qt,[qt],(n,[t])=>Math.log(t.evaluate(n))/Math.LN2],sin:[qt,[qt],(n,[t])=>Math.sin(t.evaluate(n))],cos:[qt,[qt],(n,[t])=>Math.cos(t.evaluate(n))],tan:[qt,[qt],(n,[t])=>Math.tan(t.evaluate(n))],asin:[qt,[qt],(n,[t])=>Math.asin(t.evaluate(n))],acos:[qt,[qt],(n,[t])=>Math.acos(t.evaluate(n))],atan:[qt,[qt],(n,[t])=>Math.atan(t.evaluate(n))],min:[qt,yo(qt),(n,t)=>Math.min(...t.map(i=>i.evaluate(n)))],max:[qt,yo(qt),(n,t)=>Math.max(...t.map(i=>i.evaluate(n)))],abs:[qt,[qt],(n,[t])=>Math.abs(t.evaluate(n))],round:[qt,[qt],(n,[t])=>{const i=t.evaluate(n);return i<0?-Math.round(-i):Math.round(i)}],floor:[qt,[qt],(n,[t])=>Math.floor(t.evaluate(n))],ceil:[qt,[qt],(n,[t])=>Math.ceil(t.evaluate(n))],"filter-==":[Rn,[Nn,Pn],(n,[t,i])=>n.properties()[t.value]===i.value],"filter-id-==":[Rn,[Pn],(n,[t])=>n.id()===t.value],"filter-type-==":[Rn,[Nn],(n,[t])=>n.geometryType()===t.value],"filter-<":[Rn,[Nn,Pn],(n,[t,i])=>{const a=n.properties()[t.value],c=i.value;return typeof a==typeof c&&a<c}],"filter-id-<":[Rn,[Pn],(n,[t])=>{const i=n.id(),a=t.value;return typeof i==typeof a&&i<a}],"filter->":[Rn,[Nn,Pn],(n,[t,i])=>{const a=n.properties()[t.value],c=i.value;return typeof a==typeof c&&a>c}],"filter-id->":[Rn,[Pn],(n,[t])=>{const i=n.id(),a=t.value;return typeof i==typeof a&&i>a}],"filter-<=":[Rn,[Nn,Pn],(n,[t,i])=>{const a=n.properties()[t.value],c=i.value;return typeof a==typeof c&&a<=c}],"filter-id-<=":[Rn,[Pn],(n,[t])=>{const i=n.id(),a=t.value;return typeof i==typeof a&&i<=a}],"filter->=":[Rn,[Nn,Pn],(n,[t,i])=>{const a=n.properties()[t.value],c=i.value;return typeof a==typeof c&&a>=c}],"filter-id->=":[Rn,[Pn],(n,[t])=>{const i=n.id(),a=t.value;return typeof i==typeof a&&i>=a}],"filter-has":[Rn,[Pn],(n,[t])=>t.value in n.properties()],"filter-has-id":[Rn,[],n=>n.id()!==null&&n.id()!==void 0],"filter-type-in":[Rn,[nr(Nn)],(n,[t])=>t.value.indexOf(n.geometryType())>=0],"filter-id-in":[Rn,[nr(Pn)],(n,[t])=>t.value.indexOf(n.id())>=0],"filter-in-small":[Rn,[Nn,nr(Pn)],(n,[t,i])=>i.value.indexOf(n.properties()[t.value])>=0],"filter-in-large":[Rn,[Nn,nr(Pn)],(n,[t,i])=>function(a,c,d,g){for(;d<=g;){const y=d+g>>1;if(c[y]===a)return!0;c[y]>a?g=y-1:d=y+1}return!1}(n.properties()[t.value],i.value,0,i.value.length-1)],all:{type:Rn,overloads:[[[Rn,Rn],(n,[t,i])=>t.evaluate(n)&&i.evaluate(n)],[yo(Rn),(n,t)=>{for(const i of t)if(!i.evaluate(n))return!1;return!0}]]},any:{type:Rn,overloads:[[[Rn,Rn],(n,[t,i])=>t.evaluate(n)||i.evaluate(n)],[yo(Rn),(n,t)=>{for(const i of t)if(i.evaluate(n))return!0;return!1}]]},"!":[Rn,[Rn],(n,[t])=>!t.evaluate(n)],"is-supported-script":[Rn,[Nn],(n,[t])=>{const i=n.globals&&n.globals.isSupportedScript;return!i||i(t.evaluate(n))}],upcase:[Nn,[Nn],(n,[t])=>t.evaluate(n).toUpperCase()],downcase:[Nn,[Nn],(n,[t])=>t.evaluate(n).toLowerCase()],concat:[Nn,yo(Pn),(n,t)=>t.map(i=>rl(i.evaluate(n))).join("")],"resolved-locale":[Nn,[Ya],(n,[t])=>t.evaluate(n).resolvedLocale()]});var ml=gf;function yf(n){return{result:"success",value:n}}function $r(n){return{result:"error",value:n}}function zs(n){return n["property-type"]==="data-driven"}function Ls(n){return!!n.expression&&n.expression.parameters.indexOf("zoom")>-1}function dh(n){return!!n.expression&&n.expression.interpolated}function Kn(n){return n instanceof Number?"number":n instanceof String?"string":n instanceof Boolean?"boolean":Array.isArray(n)?"array":n===null?"null":typeof n}function gl(n){return typeof n=="object"&&n!==null&&!Array.isArray(n)}function Tg(n){return n}function kc(n,t){const i=t.type==="color",a=n.stops&&typeof n.stops[0][0]=="object",c=a||!(a||n.property!==void 0),d=n.type||(dh(t)?"exponential":"interval");if(i&&((n=Bo({},n)).stops&&(n.stops=n.stops.map(E=>[E[0],ki.parse(E[1])])),n.default=ki.parse(n.default?n.default:t.default)),n.colorSpace&&n.colorSpace!=="rgb"&&!af[n.colorSpace])throw new Error(`Unknown color space: ${n.colorSpace}`);let g,y,w;if(d==="exponential")g=ph;else if(d==="interval")g=vf;else if(d==="categorical"){g=fh,y=Object.create(null);for(const E of n.stops)y[E[0]]=E[1];w=typeof n.stops[0][0]}else{if(d!=="identity")throw new Error(`Unknown function type "${d}"`);g=mh}if(a){const E={},A=[];for(let B=0;B<n.stops.length;B++){const F=n.stops[B],q=F[0].zoom;E[q]===void 0&&(E[q]={zoom:q,type:n.type,property:n.property,default:n.default,stops:[]},A.push(q)),E[q].stops.push([F[0].value,F[1]])}const P=[];for(const B of A)P.push([E[B].zoom,kc(E[B],t)]);const z={name:"linear"};return{kind:"composite",interpolationType:z,interpolationFactor:_o.interpolationFactor.bind(void 0,z),zoomStops:P.map(B=>B[0]),evaluate:({zoom:B},F)=>ph({stops:P,base:n.base},t,B).evaluate(B,F)}}if(c){const E=d==="exponential"?{name:"exponential",base:n.base!==void 0?n.base:1}:null;return{kind:"camera",interpolationType:E,interpolationFactor:_o.interpolationFactor.bind(void 0,E),zoomStops:n.stops.map(A=>A[0]),evaluate:({zoom:A})=>g(n,t,A,y,w)}}return{kind:"source",evaluate(E,A){const P=A&&A.properties?A.properties[n.property]:void 0;return P===void 0?da(n.default,t.default):g(n,t,P,y,w)}}}function da(n,t,i){return n!==void 0?n:t!==void 0?t:i!==void 0?i:void 0}function fh(n,t,i,a,c){return da(typeof i===c?a[i]:void 0,n.default,t.default)}function vf(n,t,i){if(Kn(i)!=="number")return da(n.default,t.default);const a=n.stops.length;if(a===1||i<=n.stops[0][0])return n.stops[0][1];if(i>=n.stops[a-1][0])return n.stops[a-1][1];const c=yc(n.stops.map(d=>d[0]),i);return n.stops[c][1]}function ph(n,t,i){const a=n.base!==void 0?n.base:1;if(Kn(i)!=="number")return da(n.default,t.default);const c=n.stops.length;if(c===1||i<=n.stops[0][0])return n.stops[0][1];if(i>=n.stops[c-1][0])return n.stops[c-1][1];const d=yc(n.stops.map(A=>A[0]),i),g=function(A,P,z,B){const F=B-z,q=A-z;return F===0?0:P===1?q/F:(Math.pow(P,q)-1)/(Math.pow(P,F)-1)}(i,a,n.stops[d][0],n.stops[d+1][0]),y=n.stops[d][1],w=n.stops[d+1][1];let E=xc[t.type]||Tg;if(n.colorSpace&&n.colorSpace!=="rgb"){const A=af[n.colorSpace];E=(P,z)=>A.reverse(A.interpolate(A.forward(P),A.forward(z),g))}return typeof y.evaluate=="function"?{evaluate(...A){const P=y.evaluate.apply(void 0,A),z=w.evaluate.apply(void 0,A);if(P!==void 0&&z!==void 0)return E(P,z,g)}}:E(y,w,g)}function mh(n,t,i){return t.type==="color"?i=ki.parse(i):t.type==="formatted"?i=ir.fromString(i.toString()):t.type==="resolvedImage"?i=Hr.fromString(i.toString()):Kn(i)===t.type||t.type==="enum"&&t.values[i]||(i=void 0),da(i,n.default,t.default)}class Pc{constructor(t,i){this.expression=t,this._warningHistory={},this._evaluator=new Xd,this._defaultValue=i?function(a){return a.type==="color"&&(gl(a.default)||Array.isArray(a.default))?new ki(0,0,0,0):a.type==="color"?ki.parse(a.default)||null:a.default===void 0?null:a.default}(i):null,this._enumValues=i&&i.type==="enum"?i.values:null}evaluateWithoutErrorHandling(t,i,a,c,d,g,y,w){return this._evaluator.globals=t,this._evaluator.feature=i,this._evaluator.featureState=a,this._evaluator.canonical=c||null,this._evaluator.availableImages=d||null,this._evaluator.formattedSection=g,this._evaluator.featureTileCoord=y||null,this._evaluator.featureDistanceData=w||null,this.expression.evaluate(this._evaluator)}evaluate(t,i,a,c,d,g,y,w){this._evaluator.globals=t,this._evaluator.feature=i||null,this._evaluator.featureState=a||null,this._evaluator.canonical=c||null,this._evaluator.availableImages=d||null,this._evaluator.formattedSection=g||null,this._evaluator.featureTileCoord=y||null,this._evaluator.featureDistanceData=w||null;try{const E=this.expression.evaluate(this._evaluator);if(E==null||typeof E=="number"&&E!=E)return this._defaultValue;if(this._enumValues&&!(E in this._enumValues))throw new Ji(`Expected value to be one of ${Object.keys(this._enumValues).map(A=>JSON.stringify(A)).join(", ")}, but found ${JSON.stringify(E)} instead.`);return E}catch(E){return this._warningHistory[E.message]||(this._warningHistory[E.message]=!0,typeof console<"u"&&console.warn(E.message)),this._defaultValue}}}function _l(n){return Array.isArray(n)&&n.length>0&&typeof n[0]=="string"&&n[0]in ml}function ss(n,t){const i=new ks(ml,[],t?function(c){const d={color:lo,string:Nn,number:qt,enum:Nn,boolean:Rn,formatted:oa,resolvedImage:is};return c.type==="array"?nr(d[c.value]||Pn,c.length):d[c.type]}(t):void 0),a=i.parse(n,void 0,void 0,void 0,t&&t.type==="string"?{typeAnnotation:"coerce"}:void 0);return a?yf(new Pc(a,t)):$r(i.errors)}class as{constructor(t,i){this.kind=t,this._styleExpression=i,this.isStateDependent=t!=="constant"&&!mc(i.expression)}evaluateWithoutErrorHandling(t,i,a,c,d,g){return this._styleExpression.evaluateWithoutErrorHandling(t,i,a,c,d,g)}evaluate(t,i,a,c,d,g){return this._styleExpression.evaluate(t,i,a,c,d,g)}}class zc{constructor(t,i,a,c){this.kind=t,this.zoomStops=a,this._styleExpression=i,this.isStateDependent=t!=="camera"&&!mc(i.expression),this.interpolationType=c}evaluateWithoutErrorHandling(t,i,a,c,d,g){return this._styleExpression.evaluateWithoutErrorHandling(t,i,a,c,d,g)}evaluate(t,i,a,c,d,g){return this._styleExpression.evaluate(t,i,a,c,d,g)}interpolationFactor(t,i,a){return this.interpolationType?_o.interpolationFactor(this.interpolationType,t,i,a):0}}function gh(n,t){if((n=ss(n,t)).result==="error")return n;const i=n.value.expression,a=la(i);if(!a&&!zs(t))return $r([new qr("","data expressions not supported")]);const c=hl(i,["zoom","pitch","distance-from-center"]);if(!c&&!Ls(t))return $r([new qr("","zoom expressions not supported")]);const d=yl(i);return d||c?d instanceof qr?$r([d]):d instanceof _o&&!dh(t)?$r([new qr("",'"interpolate" expressions cannot be used with this property')]):yf(d?new zc(a?"camera":"composite",n.value,d.labels,d instanceof _o?d.interpolation:void 0):new as(a?"constant":"source",n.value)):$r([new qr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class fa{constructor(t,i){this._parameters=t,this._specification=i,Bo(this,kc(this._parameters,this._specification))}static deserialize(t){return new fa(t._parameters,t._specification)}static serialize(t){return{_parameters:t._parameters,_specification:t._specification}}}function yl(n){let t=null;if(n instanceof lf)t=yl(n.result);else if(n instanceof oh){for(const i of n.args)if(t=yl(i),t)break}else(n instanceof vc||n instanceof _o)&&n.input instanceof os&&n.input.name==="zoom"&&(t=n);return t instanceof qr||n.eachChild(i=>{const a=yl(i);a instanceof qr?t=a:!t&&a?t=new qr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):t&&a&&t!==a&&(t=new qr("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),t}class $t{constructor(t,i,a,c){this.message=(t?`${t}: `:"")+a,c&&(this.identifier=c),i!=null&&i.__line__&&(this.line=i.__line__)}}function Xr(n){const t=n.key,i=n.value,a=n.valueSpec||{},c=n.objectElementValidators||{},d=n.style,g=n.styleSpec;let y=[];const w=Kn(i);if(w!=="object")return[new $t(t,i,`object expected, ${w} found`)];for(const E in i){const A=E.split(".")[0],P=a[A]||a["*"];let z;c[A]?z=c[A]:a[A]?z=dr:c["*"]?z=c["*"]:a["*"]&&(z=dr),z?y=y.concat(z({key:(t&&`${t}.`)+E,value:i[E],valueSpec:P,style:d,styleSpec:g,object:i,objectKey:E},i)):y.push(new $t(t,i[E],`unknown property "${E}"`))}for(const E in a)c[E]||a[E].required&&a[E].default===void 0&&i[E]===void 0&&y.push(new $t(t,i,`missing required property "${E}"`));return y}function vl(n){const t=n.value,i=n.valueSpec,a=n.style,c=n.styleSpec,d=n.key,g=n.arrayElementValidator||dr;if(Kn(t)!=="array")return[new $t(d,t,`array expected, ${Kn(t)} found`)];if(i.length&&t.length!==i.length)return[new $t(d,t,`array length ${i.length} expected, length ${t.length} found`)];if(i["min-length"]&&t.length<i["min-length"])return[new $t(d,t,`array length at least ${i["min-length"]} expected, length ${t.length} found`)];let y={type:i.value,values:i.values,minimum:i.minimum,maximum:i.maximum,function:void 0};c.$version<7&&(y.function=i.function),Kn(i.value)==="object"&&(y=i.value);let w=[];for(let E=0;E<t.length;E++)w=w.concat(g({array:t,arrayIndex:E,value:t[E],valueSpec:y,style:a,styleSpec:c,key:`${d}[${E}]`}));return w}function xf(n){const t=n.key,i=n.value,a=n.valueSpec;let c=Kn(i);if(c==="number"&&i!=i&&(c="NaN"),c!=="number")return[new $t(t,i,`number expected, ${c} found`)];if("minimum"in a){let d=a.minimum;if(Kn(a.minimum)==="array"&&(d=a.minimum[n.arrayIndex]),i<d)return[new $t(t,i,`${i} is less than the minimum value ${d}`)]}if("maximum"in a){let d=a.maximum;if(Kn(a.maximum)==="array"&&(d=a.maximum[n.arrayIndex]),i>d)return[new $t(t,i,`${i} is greater than the maximum value ${d}`)]}return[]}function bf(n){const t=n.valueSpec,i=Gi(n.value.type);let a,c,d,g={};const y=i!=="categorical"&&n.value.property===void 0,w=!y,E=Kn(n.value.stops)==="array"&&Kn(n.value.stops[0])==="array"&&Kn(n.value.stops[0][0])==="object",A=Xr({key:n.key,value:n.value,valueSpec:n.styleSpec.function,style:n.style,styleSpec:n.styleSpec,objectElementValidators:{stops:function(B){if(i==="identity")return[new $t(B.key,B.value,'identity function may not have a "stops" property')];let F=[];const q=B.value;return F=F.concat(vl({key:B.key,value:q,valueSpec:B.valueSpec,style:B.style,styleSpec:B.styleSpec,arrayElementValidator:P})),Kn(q)==="array"&&q.length===0&&F.push(new $t(B.key,q,"array must have at least one stop")),F},default:function(B){return dr({key:B.key,value:B.value,valueSpec:t,style:B.style,styleSpec:B.styleSpec})}}});return i==="identity"&&y&&A.push(new $t(n.key,n.value,'missing required property "property"')),i==="identity"||n.value.stops||A.push(new $t(n.key,n.value,'missing required property "stops"')),i==="exponential"&&n.valueSpec.expression&&!dh(n.valueSpec)&&A.push(new $t(n.key,n.value,"exponential functions not supported")),n.styleSpec.$version>=8&&(w&&!zs(n.valueSpec)?A.push(new $t(n.key,n.value,"property functions not supported")):y&&!Ls(n.valueSpec)&&A.push(new $t(n.key,n.value,"zoom functions not supported"))),i!=="categorical"&&!E||n.value.property!==void 0||A.push(new $t(n.key,n.value,'"property" property is required')),A;function P(B){let F=[];const q=B.value,W=B.key;if(Kn(q)!=="array")return[new $t(W,q,`array expected, ${Kn(q)} found`)];if(q.length!==2)return[new $t(W,q,`array length 2 expected, length ${q.length} found`)];if(E){if(Kn(q[0])!=="object")return[new $t(W,q,`object expected, ${Kn(q[0])} found`)];if(q[0].zoom===void 0)return[new $t(W,q,"object stop key must have zoom")];if(q[0].value===void 0)return[new $t(W,q,"object stop key must have value")];const le=Gi(q[0].zoom);if(typeof le!="number")return[new $t(W,q[0].zoom,"stop zoom values must be numbers")];if(d&&d>le)return[new $t(W,q[0].zoom,"stop zoom values must appear in ascending order")];le!==d&&(d=le,c=void 0,g={}),F=F.concat(Xr({key:`${W}[0]`,value:q[0],valueSpec:{zoom:{}},style:B.style,styleSpec:B.styleSpec,objectElementValidators:{zoom:xf,value:z}}))}else F=F.concat(z({key:`${W}[0]`,value:q[0],valueSpec:{},style:B.style,styleSpec:B.styleSpec},q));return _l(Fo(q[1]))?F.concat([new $t(`${W}[1]`,q[1],"expressions are not allowed in function stops.")]):F.concat(dr({key:`${W}[1]`,value:q[1],valueSpec:t,style:B.style,styleSpec:B.styleSpec}))}function z(B,F){const q=Kn(B.value),W=Gi(B.value),le=B.value!==null?B.value:F;if(a){if(q!==a)return[new $t(B.key,le,`${q} stop domain type must match previous stop domain type ${a}`)]}else a=q;if(q!=="number"&&q!=="string"&&q!=="boolean"&&typeof W!="number"&&typeof W!="string"&&typeof W!="boolean")return[new $t(B.key,le,"stop domain value must be a number, string, or boolean")];if(q!=="number"&&i!=="categorical"){let _e=`number expected, ${q} found`;return zs(t)&&i===void 0&&(_e+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new $t(B.key,le,_e)]}return i!=="categorical"||q!=="number"||typeof W=="number"&&isFinite(W)&&Math.floor(W)===W?i!=="categorical"&&q==="number"&&typeof W=="number"&&typeof c=="number"&&c!==void 0&&W<c?[new $t(B.key,le,"stop domain values must appear in ascending order")]:(c=W,i==="categorical"&&W in g?[new $t(B.key,le,"stop domain values must be unique")]:(g[W]=!0,[])):[new $t(B.key,le,`integer expected, found ${String(W)}`)]}}function pa(n){const t=(n.expressionContext==="property"?gh:ss)(Fo(n.value),n.valueSpec);if(t.result==="error")return t.value.map(a=>new $t(`${n.key}${a.key}`,n.value,a.message));const i=t.value.expression||t.value._styleExpression.expression;if(n.expressionContext==="property"&&n.propertyKey==="text-font"&&!i.outputDefined())return[new $t(n.key,n.value,`Invalid data expression for "${n.propertyKey}". Output values must be contained as literals within the expression.`)];if(n.expressionContext==="property"&&n.propertyType==="layout"&&!mc(i))return[new $t(n.key,n.value,'"feature-state" data expressions are not supported with layout properties.')];if(n.expressionContext==="filter")return wf(i,n);if(n.expressionContext&&n.expressionContext.indexOf("cluster")===0){if(!hl(i,["zoom","feature-state"]))return[new $t(n.key,n.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(n.expressionContext==="cluster-initial"&&!la(i))return[new $t(n.key,n.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function wf(n,t){const i=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(t.valueSpec&&t.valueSpec.expression)for(const c of t.valueSpec.expression.parameters)i.delete(c);if(i.size===0)return[];const a=[];return n instanceof os&&i.has(n.name)?[new $t(t.key,t.value,`["${n.name}"] expression is not supported in a filter for a ${t.object.type} layer with id: ${t.object.id}`)]:(n.eachChild(c=>{a.push(...wf(c,t))}),a)}function Lc(n){const t=n.key,i=n.value,a=n.valueSpec,c=[];return Array.isArray(a.values)?a.values.indexOf(Gi(i))===-1&&c.push(new $t(t,i,`expected one of [${a.values.join(", ")}], ${JSON.stringify(i)} found`)):Object.keys(a.values).indexOf(Gi(i))===-1&&c.push(new $t(t,i,`expected one of [${Object.keys(a.values).join(", ")}], ${JSON.stringify(i)} found`)),c}function ma(n){if(n===!0||n===!1)return!0;if(!Array.isArray(n)||n.length===0)return!1;switch(n[0]){case"has":return n.length>=2&&n[1]!=="$id"&&n[1]!=="$type";case"in":return n.length>=3&&(typeof n[1]!="string"||Array.isArray(n[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return n.length!==3||Array.isArray(n[1])||Array.isArray(n[2]);case"any":case"all":for(const t of n.slice(1))if(!ma(t)&&typeof t!="boolean")return!1;return!0;default:return!0}}function Rs(n,t="fill"){if(n==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};ma(n)||(n=_a(n));const i=n;let a=!0;try{a=function(E){if(!ga(E))return E;let A=Fo(E);return xl(A),A=Pr(A),A}(i)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(i,null,2)}
        `)}const c=tt[`filter_${t}`],d=ss(a,c);let g=null;if(d.result==="error")throw new Error(d.value.map(E=>`${E.key}: ${E.message}`).join(", "));g=(E,A,P)=>d.value.evaluate(E,A,{},P);let y=null,w=null;if(a!==i){const E=ss(i,c);if(E.result==="error")throw new Error(E.value.map(A=>`${A.key}: ${A.message}`).join(", "));y=(A,P,z,B,F)=>E.value.evaluate(A,P,{},z,void 0,void 0,B,F),w=!la(E.value.expression)}return{filter:g,dynamicFilter:y||void 0,needGeometry:Ef(a),needFeature:!!w}}function Pr(n){if(!Array.isArray(n))return n;const t=function(i){if(Sg.has(i[0])){for(let a=1;a<i.length;a++)if(ga(i[a]))return!0}return i}(n);return t===!0?t:t.map(i=>Pr(i))}function xl(n){let t=!1;const i=[];if(n[0]==="case"){for(let a=1;a<n.length-1;a+=2)t=t||ga(n[a]),i.push(n[a+1]);i.push(n[n.length-1])}else if(n[0]==="match"){t=t||ga(n[1]);for(let a=2;a<n.length-1;a+=2)i.push(n[a+1]);i.push(n[n.length-1])}else if(n[0]==="step"){t=t||ga(n[1]);for(let a=1;a<n.length-1;a+=2)i.push(n[a+1])}t&&(n.length=0,n.push("any",...i));for(let a=1;a<n.length;a++)xl(n[a])}function ga(n){if(!Array.isArray(n))return!1;if((t=n[0])==="pitch"||t==="distance-from-center")return!0;var t;for(let i=1;i<n.length;i++)if(ga(n[i]))return!0;return!1}const Sg=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function Cg(n,t){return n<t?-1:n>t?1:0}function Ef(n){if(!Array.isArray(n))return!1;if(n[0]==="within")return!0;for(let t=1;t<n.length;t++)if(Ef(n[t]))return!0;return!1}function _a(n){if(!n)return!0;const t=n[0];return n.length<=1?t!=="any":t==="=="?_h(n[1],n[2],"=="):t==="!="?Dc(_h(n[1],n[2],"==")):t==="<"||t===">"||t==="<="||t===">="?_h(n[1],n[2],t):t==="any"?(i=n.slice(1),["any"].concat(i.map(_a))):t==="all"?["all"].concat(n.slice(1).map(_a)):t==="none"?["all"].concat(n.slice(1).map(_a).map(Dc)):t==="in"?Rc(n[1],n.slice(2)):t==="!in"?Dc(Rc(n[1],n.slice(2))):t==="has"?Tf(n[1]):t==="!has"?Dc(Tf(n[1])):t!=="within"||n;var i}function _h(n,t,i){switch(n){case"$type":return[`filter-type-${i}`,t];case"$id":return[`filter-id-${i}`,t];default:return[`filter-${i}`,n,t]}}function Rc(n,t){if(t.length===0)return!1;switch(n){case"$type":return["filter-type-in",["literal",t]];case"$id":return["filter-id-in",["literal",t]];default:return t.length>200&&!t.some(i=>typeof i!=typeof t[0])?["filter-in-large",n,["literal",t.sort(Cg)]]:["filter-in-small",n,["literal",t]]}}function Tf(n){switch(n){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",n]}}function Dc(n){return["!",n]}function bl(n){return ma(Fo(n.value))?pa(Bo({},n,{expressionContext:"filter",valueSpec:n.styleSpec[`filter_${n.layerType||"fill"}`]})):Sf(n)}function Sf(n){const t=n.value,i=n.key;if(Kn(t)!=="array")return[new $t(i,t,`array expected, ${Kn(t)} found`)];const a=n.styleSpec;let c,d=[];if(t.length<1)return[new $t(i,t,"filter array must have at least 1 element")];switch(d=d.concat(Lc({key:`${i}[0]`,value:t[0],valueSpec:a.filter_operator,style:n.style,styleSpec:n.styleSpec})),Gi(t[0])){case"<":case"<=":case">":case">=":t.length>=2&&Gi(t[1])==="$type"&&d.push(new $t(i,t,`"$type" cannot be use with operator "${t[0]}"`));case"==":case"!=":t.length!==3&&d.push(new $t(i,t,`filter array for operator "${t[0]}" must have 3 elements`));case"in":case"!in":t.length>=2&&(c=Kn(t[1]),c!=="string"&&d.push(new $t(`${i}[1]`,t[1],`string expected, ${c} found`)));for(let g=2;g<t.length;g++)c=Kn(t[g]),Gi(t[1])==="$type"?d=d.concat(Lc({key:`${i}[${g}]`,value:t[g],valueSpec:a.geometry_type,style:n.style,styleSpec:n.styleSpec})):c!=="string"&&c!=="number"&&c!=="boolean"&&d.push(new $t(`${i}[${g}]`,t[g],`string, number, or boolean expected, ${c} found`));break;case"any":case"all":case"none":for(let g=1;g<t.length;g++)d=d.concat(Sf({key:`${i}[${g}]`,value:t[g],style:n.style,styleSpec:n.styleSpec}));break;case"has":case"!has":c=Kn(t[1]),t.length!==2?d.push(new $t(i,t,`filter array for "${t[0]}" operator must have 2 elements`)):c!=="string"&&d.push(new $t(`${i}[1]`,t[1],`string expected, ${c} found`));break;case"within":c=Kn(t[1]),t.length!==2?d.push(new $t(i,t,`filter array for "${t[0]}" operator must have 2 elements`)):c!=="object"&&d.push(new $t(`${i}[1]`,t[1],`object expected, ${c} found`))}return d}function yh(n,t){const i=n.key,a=n.style,c=n.styleSpec,d=n.value,g=n.objectKey,y=c[`${t}_${n.layerType}`];if(!y)return[];const w=g.match(/^(.*)-transition$/);if(t==="paint"&&w&&y[w[1]]&&y[w[1]].transition)return dr({key:i,value:d,valueSpec:c.transition,style:a,styleSpec:c});const E=n.valueSpec||y[g];if(!E)return[new $t(i,d,`unknown property "${g}"`)];let A;if(Kn(d)==="string"&&zs(E)&&!E.tokens&&(A=/^{([^}]+)}$/.exec(d)))return[new $t(i,d,`"${g}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(A[1])} }\`.`)];const P=[];return n.layerType==="symbol"&&(g==="text-field"&&a&&!a.glyphs&&P.push(new $t(i,d,'use of "text-field" requires a style "glyphs" property')),g==="text-font"&&gl(Fo(d))&&Gi(d.type)==="identity"&&P.push(new $t(i,d,'"text-font" does not support identity functions'))),P.concat(dr({key:n.key,value:d,valueSpec:E,style:a,styleSpec:c,expressionContext:"property",propertyType:t,propertyKey:g}))}function vh(n){return yh(n,"paint")}function Cf(n){return yh(n,"layout")}function Oc(n){let t=[];const i=n.value,a=n.key,c=n.style,d=n.styleSpec;i.type||i.ref||t.push(new $t(a,i,'either "type" or "ref" is required'));let g=Gi(i.type);const y=Gi(i.ref);if(i.id){const w=Gi(i.id);for(let E=0;E<n.arrayIndex;E++){const A=c.layers[E];Gi(A.id)===w&&t.push(new $t(a,i.id,`duplicate layer id "${i.id}", previously used at line ${A.id.__line__}`))}}if("ref"in i){let w;["type","source","source-layer","filter","layout"].forEach(E=>{E in i&&t.push(new $t(a,i[E],`"${E}" is prohibited for ref layers`))}),c.layers.forEach(E=>{Gi(E.id)===y&&(w=E)}),w?w.ref?t.push(new $t(a,i.ref,"ref cannot reference another ref layer")):g=Gi(w.type):typeof y=="string"&&t.push(new $t(a,i.ref,`ref layer "${y}" not found`))}else if(g!=="background"&&g!=="sky")if(i.source){const w=c.sources&&c.sources[i.source],E=w&&Gi(w.type);w?E==="vector"&&g==="raster"?t.push(new $t(a,i.source,`layer "${i.id}" requires a raster source`)):E==="raster"&&g!=="raster"?t.push(new $t(a,i.source,`layer "${i.id}" requires a vector source`)):E!=="vector"||i["source-layer"]?E==="raster-dem"&&g!=="hillshade"?t.push(new $t(a,i.source,"raster-dem source can only be used with layer type 'hillshade'.")):g!=="line"||!i.paint||!i.paint["line-gradient"]&&!i.paint["line-trim-offset"]||E==="geojson"&&w.lineMetrics||t.push(new $t(a,i,`layer "${i.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):t.push(new $t(a,i,`layer "${i.id}" must specify a "source-layer"`)):t.push(new $t(a,i.source,`source "${i.source}" not found`))}else t.push(new $t(a,i,'missing required property "source"'));return t=t.concat(Xr({key:a,value:i,valueSpec:d.layer,style:n.style,styleSpec:n.styleSpec,objectElementValidators:{"*":()=>[],type:()=>dr({key:`${a}.type`,value:i.type,valueSpec:d.layer.type,style:n.style,styleSpec:n.styleSpec,object:i,objectKey:"type"}),filter:w=>bl(Bo({layerType:g},w)),layout:w=>Xr({layer:i,key:w.key,value:w.value,valueSpec:{},style:w.style,styleSpec:w.styleSpec,objectElementValidators:{"*":E=>Cf(Bo({layerType:g},E))}}),paint:w=>Xr({layer:i,key:w.key,value:w.value,valueSpec:{},style:w.style,styleSpec:w.styleSpec,objectElementValidators:{"*":E=>vh(Bo({layerType:g},E))}})}})),t}function Vo(n){const t=n.value,i=n.key,a=Kn(t);return a!=="string"?[new $t(i,t,`string expected, ${a} found`)]:[]}const xh={promoteId:function({key:n,value:t}){if(Kn(t)==="string")return Vo({key:n,value:t});{const i=[];for(const a in t)i.push(...Vo({key:`${n}.${a}`,value:t[a]}));return i}}};function Af(n){const t=n.value,i=n.key,a=n.styleSpec,c=n.style;if(!t.type)return[new $t(i,t,'"type" is required')];const d=Gi(t.type);let g;switch(d){case"vector":case"raster":case"raster-dem":return g=Xr({key:i,value:t,valueSpec:a[`source_${d.replace("-","_")}`],style:n.style,styleSpec:a,objectElementValidators:xh}),g;case"geojson":if(g=Xr({key:i,value:t,valueSpec:a.source_geojson,style:c,styleSpec:a,objectElementValidators:xh}),t.cluster)for(const y in t.clusterProperties){const[w,E]=t.clusterProperties[y],A=typeof w=="string"?[w,["accumulated"],["get",y]]:w;g.push(...pa({key:`${i}.${y}.map`,value:E,expressionContext:"cluster-map"})),g.push(...pa({key:`${i}.${y}.reduce`,value:A,expressionContext:"cluster-reduce"}))}return g;case"video":return Xr({key:i,value:t,valueSpec:a.source_video,style:c,styleSpec:a});case"image":return Xr({key:i,value:t,valueSpec:a.source_image,style:c,styleSpec:a});case"canvas":return[new $t(i,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Lc({key:`${i}.type`,value:t.type,valueSpec:{values:Mf(a)},style:c,styleSpec:a})}}function Mf(n){return n.source.reduce((t,i)=>{const a=n[i];return a.type.type==="enum"&&(t=t.concat(Object.keys(a.type.values))),t},[])}function If(n){const t=n.value,i=n.styleSpec,a=i.light,c=n.style;let d=[];const g=Kn(t);if(t===void 0)return d;if(g!=="object")return d=d.concat([new $t("light",t,`object expected, ${g} found`)]),d;for(const y in t){const w=y.match(/^(.*)-transition$/);d=d.concat(w&&a[w[1]]&&a[w[1]].transition?dr({key:y,value:t[y],valueSpec:i.transition,style:c,styleSpec:i}):a[y]?dr({key:y,value:t[y],valueSpec:a[y],style:c,styleSpec:i}):[new $t(y,t[y],`unknown property "${y}"`)])}return d}function Bc(n){const t=n.value,i=n.key,a=n.style,c=n.styleSpec,d=c.terrain;let g=[];const y=Kn(t);if(t===void 0)return g;if(y!=="object")return g=g.concat([new $t("terrain",t,`object expected, ${y} found`)]),g;for(const w in t){const E=w.match(/^(.*)-transition$/);g=g.concat(E&&d[E[1]]&&d[E[1]].transition?dr({key:w,value:t[w],valueSpec:c.transition,style:a,styleSpec:c}):d[w]?dr({key:w,value:t[w],valueSpec:d[w],style:a,styleSpec:c}):[new $t(w,t[w],`unknown property "${w}"`)])}if(t.source){const w=a.sources&&a.sources[t.source],E=w&&Gi(w.type);w?E!=="raster-dem"&&g.push(new $t(i,t.source,`terrain cannot be used with a source of type ${String(E)}, it only be used with a "raster-dem" source type`)):g.push(new $t(i,t.source,`source "${t.source}" not found`))}else g.push(new $t(i,t,'terrain is missing required property "source"'));return g}function kf(n){const t=n.value,i=n.style,a=n.styleSpec,c=a.fog;let d=[];const g=Kn(t);if(t===void 0)return d;if(g!=="object")return d=d.concat([new $t("fog",t,`object expected, ${g} found`)]),d;for(const y in t){const w=y.match(/^(.*)-transition$/);d=d.concat(w&&c[w[1]]&&c[w[1]].transition?dr({key:y,value:t[y],valueSpec:a.transition,style:i,styleSpec:a}):c[y]?dr({key:y,value:t[y],valueSpec:c[y],style:i,styleSpec:a}):[new $t(y,t[y],`unknown property "${y}"`)])}return d}const Pf={"*":()=>[],array:vl,boolean:function(n){const t=n.value,i=n.key,a=Kn(t);return a!=="boolean"?[new $t(i,t,`boolean expected, ${a} found`)]:[]},number:xf,color:function(n){const t=n.key,i=n.value,a=Kn(i);return a!=="string"?[new $t(t,i,`color expected, ${a} found`)]:tl(i)===null?[new $t(t,i,`color expected, "${i}" found`)]:[]},enum:Lc,filter:bl,function:bf,layer:Oc,object:Xr,source:Af,light:If,terrain:Bc,fog:kf,string:Vo,formatted:function(n){return Vo(n).length===0?[]:pa(n)},resolvedImage:function(n){return Vo(n).length===0?[]:pa(n)},projection:function(n){const t=n.value,i=n.styleSpec,a=i.projection,c=n.style;let d=[];const g=Kn(t);if(g==="object")for(const y in t)d=d.concat(dr({key:y,value:t[y],valueSpec:a[y],style:c,styleSpec:i}));else g!=="string"&&(d=d.concat([new $t("projection",t,`object or string expected, ${g} found`)]));return d}};function dr(n){const t=n.value,i=n.valueSpec,a=n.styleSpec;return i.expression&&gl(Gi(t))?bf(n):i.expression&&_l(Fo(t))?pa(n):i.type&&Pf[i.type]?Pf[i.type](n):Xr(Bo({},n,{valueSpec:i.type?a[i.type]:i}))}function Ag(n){const t=n.value,i=n.key,a=Vo(n);return a.length||(t.indexOf("{fontstack}")===-1&&a.push(new $t(i,t,'"glyphs" url must include a "{fontstack}" token')),t.indexOf("{range}")===-1&&a.push(new $t(i,t,'"glyphs" url must include a "{range}" token'))),a}function bh(n,t=tt){return Uo(dr({key:"",value:n,valueSpec:t.$root,styleSpec:t,style:n,objectElementValidators:{glyphs:Ag,"*":()=>[]}}))}const Mg=n=>Uo(vh(n)),Ig=n=>Uo(Cf(n));function Uo(n){return n.slice().sort((t,i)=>t.line&&i.line?t.line-i.line:0)}function zf(n,t){let i=!1;if(t&&t.length)for(const a of t)n.fire(new ai(new Error(a.message))),i=!0;return i}var ya=vo;function vo(n,t,i){var a=this.cells=[];if(n instanceof ArrayBuffer){this.arrayBuffer=n;var c=new Int32Array(this.arrayBuffer);n=c[0],this.d=(t=c[1])+2*(i=c[2]);for(var d=0;d<this.d*this.d;d++){var g=c[3+d],y=c[3+d+1];a.push(g===y?null:c.subarray(g,y))}var w=c[3+a.length+1];this.keys=c.subarray(c[3+a.length],w),this.bboxes=c.subarray(w),this.insert=this._insertReadonly}else{this.d=t+2*i;for(var E=0;E<this.d*this.d;E++)a.push([]);this.keys=[],this.bboxes=[]}this.n=t,this.extent=n,this.padding=i,this.scale=t/n,this.uid=0;var A=i/t*n;this.min=-A,this.max=n+A}vo.prototype.insert=function(n,t,i,a,c){this._forEachCell(t,i,a,c,this._insertCell,this.uid++),this.keys.push(n),this.bboxes.push(t),this.bboxes.push(i),this.bboxes.push(a),this.bboxes.push(c)},vo.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},vo.prototype._insertCell=function(n,t,i,a,c,d){this.cells[c].push(d)},vo.prototype.query=function(n,t,i,a,c){var d=this.min,g=this.max;if(n<=d&&t<=d&&g<=i&&g<=a&&!c)return Array.prototype.slice.call(this.keys);var y=[];return this._forEachCell(n,t,i,a,this._queryCell,y,{},c),y},vo.prototype._queryCell=function(n,t,i,a,c,d,g,y){var w=this.cells[c];if(w!==null)for(var E=this.keys,A=this.bboxes,P=0;P<w.length;P++){var z=w[P];if(g[z]===void 0){var B=4*z;(y?y(A[B+0],A[B+1],A[B+2],A[B+3]):n<=A[B+2]&&t<=A[B+3]&&i>=A[B+0]&&a>=A[B+1])?(g[z]=!0,d.push(E[z])):g[z]=!1}}},vo.prototype._forEachCell=function(n,t,i,a,c,d,g,y){for(var w=this._convertToCellCoord(n),E=this._convertToCellCoord(t),A=this._convertToCellCoord(i),P=this._convertToCellCoord(a),z=w;z<=A;z++)for(var B=E;B<=P;B++){var F=this.d*B+z;if((!y||y(this._convertFromCellCoord(z),this._convertFromCellCoord(B),this._convertFromCellCoord(z+1),this._convertFromCellCoord(B+1)))&&c.call(this,n,t,i,a,F,d,g,y))return}},vo.prototype._convertFromCellCoord=function(n){return(n-this.padding)/this.scale},vo.prototype._convertToCellCoord=function(n){return Math.max(0,Math.min(this.d-1,Math.floor(n*this.scale)+this.padding))},vo.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var n=this.cells,t=3+this.cells.length+1+1,i=0,a=0;a<this.cells.length;a++)i+=this.cells[a].length;var c=new Int32Array(t+i+this.keys.length+this.bboxes.length);c[0]=this.extent,c[1]=this.n,c[2]=this.padding;for(var d=t,g=0;g<n.length;g++){var y=n[g];c[3+g]=d,c.set(y,d),d+=y.length}return c[3+n.length]=d,c.set(this.keys,d),c[3+n.length+1]=d+=this.keys.length,c.set(this.bboxes,d),d+=this.bboxes.length,c.buffer};const Fc={};function Zt(n,t,i={}){Object.defineProperty(n,"_classRegistryKey",{value:t,writeable:!1}),Fc[t]={klass:n,omit:i.omit||[]}}Zt(Object,"Object"),ya.serialize=function(n,t){const i=n.toArrayBuffer();return t&&t.push(i),{buffer:i}},ya.deserialize=function(n){return new ya(n.buffer)},Object.defineProperty(ya,"name",{value:"Grid"}),Zt(ya,"Grid"),Zt(ki,"Color"),Zt(Error,"Error"),Zt(Bi,"AJAXError"),Zt(Hr,"ResolvedImage"),Zt(fa,"StylePropertyFunction"),Zt(Pc,"StyleExpression",{omit:["_evaluator"]}),Zt(zc,"ZoomDependentExpression"),Zt(as,"ZoomConstantExpression"),Zt(os,"CompoundExpression",{omit:["_evaluate"]});for(const n in ml)Fc[ml[n]._classRegistryKey]||Zt(ml[n],`Expression${n}`);function Lf(n){return n&&typeof ArrayBuffer<"u"&&(n instanceof ArrayBuffer||n.constructor&&n.constructor.name==="ArrayBuffer")}function Rf(n){return S.ImageBitmap&&n instanceof S.ImageBitmap}function ls(n,t){if(n==null||typeof n=="boolean"||typeof n=="number"||typeof n=="string"||n instanceof Boolean||n instanceof Number||n instanceof String||n instanceof Date||n instanceof RegExp)return n;if(Lf(n)||Rf(n))return t&&t.push(n),n;if(ArrayBuffer.isView(n)){const i=n;return t&&t.push(i.buffer),i}if(n instanceof S.ImageData)return t&&t.push(n.data.buffer),n;if(Array.isArray(n)){const i=[];for(const a of n)i.push(ls(a,t));return i}if(typeof n=="object"){const i=n.constructor,a=i._classRegistryKey;if(!a)throw new Error(`can't serialize object of unregistered class ${a}`);const c=i.serialize?i.serialize(n,t):{};if(!i.serialize){for(const d in n)n.hasOwnProperty(d)&&(Fc[a].omit.indexOf(d)>=0||(c[d]=ls(n[d],t)));n instanceof Error&&(c.message=n.message)}if(c.$name)throw new Error("$name property is reserved for worker serialization logic.");return a!=="Object"&&(c.$name=a),c}throw new Error("can't serialize object of type "+typeof n)}function wl(n){if(n==null||typeof n=="boolean"||typeof n=="number"||typeof n=="string"||n instanceof Boolean||n instanceof Number||n instanceof String||n instanceof Date||n instanceof RegExp||Lf(n)||Rf(n)||ArrayBuffer.isView(n)||n instanceof S.ImageData)return n;if(Array.isArray(n))return n.map(wl);if(typeof n=="object"){const t=n.$name||"Object",{klass:i}=Fc[t];if(!i)throw new Error(`can't deserialize unregistered class ${t}`);if(i.deserialize)return i.deserialize(n);const a=Object.create(i.prototype);for(const c of Object.keys(n))c!=="$name"&&(a[c]=wl(n[c]));return a}throw new Error("can't deserialize object of type "+typeof n)}const wh=n=>n>=1536&&n<=1791,Df=n=>n>=1872&&n<=1919,Eh=n=>n>=2208&&n<=2303,Th=n=>n>=11904&&n<=12031,Sh=n=>n>=12032&&n<=12255,Ch=n=>n>=12272&&n<=12287,va=n=>n>=12288&&n<=12351,El=n=>n>=12352&&n<=12447,Nc=n=>n>=12448&&n<=12543,Of=n=>n>=12544&&n<=12591,Ah=n=>n>=12704&&n<=12735,Bf=n=>n>=12736&&n<=12783,Ff=n=>n>=12784&&n<=12799,Nf=n=>n>=12800&&n<=13055,Vf=n=>n>=13056&&n<=13311,Uf=n=>n>=13312&&n<=19903,Mh=n=>n>=19968&&n<=40959,jf=n=>n>=40960&&n<=42127,qf=n=>n>=42128&&n<=42191,Ih=n=>n>=44032&&n<=55215,Tl=n=>n>=63744&&n<=64255,h=n=>n>=64336&&n<=65023,r=n=>n>=65040&&n<=65055,l=n=>n>=65072&&n<=65103,p=n=>n>=65104&&n<=65135,_=n=>n>=65136&&n<=65279,x=n=>n>=65280&&n<=65519;function T(n){for(const t of n)if(O(t.charCodeAt(0)))return!0;return!1}function C(n){for(const t of n)if(!M(t.charCodeAt(0)))return!1;return!0}function M(n){return!(wh(n)||Df(n)||Eh(n)||h(n)||_(n))}function O(n){return!(n!==746&&n!==747&&(n<4352||!(Ah(n)||Of(n)||l(n)&&!(n>=65097&&n<=65103)||Tl(n)||Vf(n)||Th(n)||Bf(n)||!(!va(n)||n>=12296&&n<=12305||n>=12308&&n<=12319||n===12336)||Uf(n)||Mh(n)||Nf(n)||(t=>t>=12592&&t<=12687)(n)||(t=>t>=43360&&t<=43391)(n)||(t=>t>=55216&&t<=55295)(n)||(t=>t>=4352&&t<=4607)(n)||Ih(n)||El(n)||Ch(n)||(t=>t>=12688&&t<=12703)(n)||Sh(n)||Ff(n)||Nc(n)&&n!==12540||!(!x(n)||n===65288||n===65289||n===65293||n>=65306&&n<=65310||n===65339||n===65341||n===65343||n>=65371&&n<=65503||n===65507||n>=65512&&n<=65519)||!(!p(n)||n>=65112&&n<=65118||n>=65123&&n<=65126)||(t=>t>=5120&&t<=5759)(n)||(t=>t>=6320&&t<=6399)(n)||r(n)||(t=>t>=19904&&t<=19967)(n)||jf(n)||qf(n))))}function R(n){return!(O(n)||function(t){return!!((i=>i>=128&&i<=255)(t)&&(t===167||t===169||t===174||t===177||t===188||t===189||t===190||t===215||t===247)||(i=>i>=8192&&i<=8303)(t)&&(t===8214||t===8224||t===8225||t===8240||t===8241||t===8251||t===8252||t===8258||t===8263||t===8264||t===8265||t===8273)||(i=>i>=8448&&i<=8527)(t)||(i=>i>=8528&&i<=8591)(t)||(i=>i>=8960&&i<=9215)(t)&&(t>=8960&&t<=8967||t>=8972&&t<=8991||t>=8996&&t<=9e3||t===9003||t>=9085&&t<=9114||t>=9150&&t<=9165||t===9167||t>=9169&&t<=9179||t>=9186&&t<=9215)||(i=>i>=9216&&i<=9279)(t)&&t!==9251||(i=>i>=9280&&i<=9311)(t)||(i=>i>=9312&&i<=9471)(t)||(i=>i>=9632&&i<=9727)(t)||(i=>i>=9728&&i<=9983)(t)&&!(t>=9754&&t<=9759)||(i=>i>=11008&&i<=11263)(t)&&(t>=11026&&t<=11055||t>=11088&&t<=11097||t>=11192&&t<=11243)||va(t)||Nc(t)||(i=>i>=57344&&i<=63743)(t)||l(t)||p(t)||x(t)||t===8734||t===8756||t===8757||t>=9984&&t<=10087||t>=10102&&t<=10131||t===65532||t===65533)}(n))}function U(n){return n>=1424&&n<=2303||h(n)||_(n)}function G(n,t){return!(!t&&U(n)||n>=2304&&n<=3583||n>=3840&&n<=4255||(i=>i>=6016&&i<=6143)(n))}function ee(n){for(const t of n)if(U(t.charCodeAt(0)))return!0;return!1}const Q="deferred",ne="loading",H="loaded";let X=null,re="unavailable",ie=null;const he=function(n){n&&typeof n=="string"&&n.indexOf("NetworkError")>-1&&(re="error"),X&&X(n)};function Ee(){xe.fire(new Fn("pluginStateChange",{pluginStatus:re,pluginURL:ie}))}const xe=new mi,Pe=function(){return re},We=function(){if(re!==Q||!ie)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");re=ne,Ee(),ie&&tr({url:ie},n=>{n?he(n):(re=H,Ee())})},je={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>re===H||je.applyArabicShaping!=null,isLoading:()=>re===ne,setState(n){re=n.pluginStatus,ie=n.pluginURL},isParsed:()=>je.applyArabicShaping!=null&&je.processBidirectionalText!=null&&je.processStyledBidirectionalText!=null,getPluginURL:()=>ie};class Le{constructor(t,i){this.zoom=t,i?(this.now=i.now,this.fadeDuration=i.fadeDuration,this.transition=i.transition,this.pitch=i.pitch):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0)}isSupportedScript(t){return function(i,a){for(const c of i)if(!G(c.charCodeAt(0),a))return!1;return!0}(t,je.isLoaded())}}class It{constructor(t,i){this.property=t,this.value=i,this.expression=function(a,c){if(gl(a))return new fa(a,c);if(_l(a)){const d=gh(a,c);if(d.result==="error")throw new Error(d.value.map(g=>`${g.key}: ${g.message}`).join(", "));return d.value}{let d=a;return typeof a=="string"&&c.type==="color"&&(d=ki.parse(a)),{kind:"constant",evaluate:()=>d}}}(i===void 0?t.specification.default:i,t.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(t,i,a){return this.property.possiblyEvaluate(this,t,i,a)}}class Ue{constructor(t){this.property=t,this.value=new It(t,void 0)}transitioned(t,i){return new Xe(this.property,this.value,i,Ve({},t.transition,this.transition),t.now)}untransitioned(){return new Xe(this.property,this.value,null,{},0)}}class st{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitionablePropertyValues)}getValue(t){return sn(this._values[t].value.value)}setValue(t,i){this._values.hasOwnProperty(t)||(this._values[t]=new Ue(this._values[t].property)),this._values[t].value=new It(this._values[t].property,i===null?void 0:sn(i))}getTransition(t){return sn(this._values[t].transition)}setTransition(t,i){this._values.hasOwnProperty(t)||(this._values[t]=new Ue(this._values[t].property)),this._values[t].transition=sn(i)||void 0}serialize(){const t={};for(const i of Object.keys(this._values)){const a=this.getValue(i);a!==void 0&&(t[i]=a);const c=this.getTransition(i);c!==void 0&&(t[`${i}-transition`]=c)}return t}transitioned(t,i){const a=new Et(this._properties);for(const c of Object.keys(this._values))a._values[c]=this._values[c].transitioned(t,i._values[c]);return a}untransitioned(){const t=new Et(this._properties);for(const i of Object.keys(this._values))t._values[i]=this._values[i].untransitioned();return t}}class Xe{constructor(t,i,a,c,d){const g=c.delay||0,y=c.duration||0;d=d||0,this.property=t,this.value=i,this.begin=d+g,this.end=this.begin+y,t.specification.transition&&(c.delay||c.duration)&&(this.prior=a)}possiblyEvaluate(t,i,a){const c=t.now||0,d=this.value.possiblyEvaluate(t,i,a),g=this.prior;if(g){if(c>this.end)return this.prior=null,d;if(this.value.isDataDriven())return this.prior=null,d;if(c<this.begin)return g.possiblyEvaluate(t,i,a);{const y=(c-this.begin)/(this.end-this.begin);return this.property.interpolate(g.possiblyEvaluate(t,i,a),d,Re(y))}}return d}}class Et{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitioningPropertyValues)}possiblyEvaluate(t,i,a){const c=new Pt(this._properties);for(const d of Object.keys(this._values))c._values[d]=this._values[d].possiblyEvaluate(t,i,a);return c}hasTransition(){for(const t of Object.keys(this._values))if(this._values[t].prior)return!0;return!1}}class Je{constructor(t){this._properties=t,this._values=Object.create(t.defaultPropertyValues)}getValue(t){return sn(this._values[t].value)}setValue(t,i){this._values[t]=new It(this._values[t].property,i===null?void 0:sn(i))}serialize(){const t={};for(const i of Object.keys(this._values)){const a=this.getValue(i);a!==void 0&&(t[i]=a)}return t}possiblyEvaluate(t,i,a){const c=new Pt(this._properties);for(const d of Object.keys(this._values))c._values[d]=this._values[d].possiblyEvaluate(t,i,a);return c}}class pt{constructor(t,i,a){this.property=t,this.value=i,this.parameters=a}isConstant(){return this.value.kind==="constant"}constantOr(t){return this.value.kind==="constant"?this.value.value:t}evaluate(t,i,a,c){return this.property.evaluate(this.value,this.parameters,t,i,a,c)}}class Pt{constructor(t){this._properties=t,this._values=Object.create(t.defaultPossiblyEvaluatedValues)}get(t){return this._values[t]}}class De{constructor(t){this.specification=t}possiblyEvaluate(t,i){return t.expression.evaluate(i)}interpolate(t,i,a){const c=xc[this.specification.type];return c?c(t,i,a):t}}class He{constructor(t,i){this.specification=t,this.overrides=i}possiblyEvaluate(t,i,a,c){return new pt(this,t.expression.kind==="constant"||t.expression.kind==="camera"?{kind:"constant",value:t.expression.evaluate(i,null,{},a,c)}:t.expression,i)}interpolate(t,i,a){if(t.value.kind!=="constant"||i.value.kind!=="constant")return t;if(t.value.value===void 0||i.value.value===void 0)return new pt(this,{kind:"constant",value:void 0},t.parameters);const c=xc[this.specification.type];return c?new pt(this,{kind:"constant",value:c(t.value.value,i.value.value,a)},t.parameters):t}evaluate(t,i,a,c,d,g){return t.kind==="constant"?t.value:t.evaluate(i,a,c,d,g)}}class Qt{constructor(t){this.specification=t}possiblyEvaluate(t,i,a,c){return!!t.expression.evaluate(i,null,{},a,c)}interpolate(){return!1}}class ln{constructor(t){this.properties=t,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const i=new Le(0,{});for(const a in t){const c=t[a];c.specification.overridable&&this.overridableProperties.push(a);const d=this.defaultPropertyValues[a]=new It(c,void 0),g=this.defaultTransitionablePropertyValues[a]=new Ue(c);this.defaultTransitioningPropertyValues[a]=g.untransitioned(),this.defaultPossiblyEvaluatedValues[a]=d.possiblyEvaluate(i)}}}function Jt(n,t){return 256*(n=lt(Math.floor(n),0,255))+lt(Math.floor(t),0,255)}Zt(He,"DataDrivenProperty"),Zt(De,"DataConstantProperty"),Zt(Qt,"ColorRampProperty");const mn={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Sn{constructor(t,i){this._structArray=t,this._pos1=i*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class cn{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(t,i){return t._trim(),i&&(t.isTransferred=!0,i.push(t.arrayBuffer)),{length:t.length,arrayBuffer:t.arrayBuffer}}static deserialize(t){const i=Object.create(this.prototype);return i.arrayBuffer=t.arrayBuffer,i.length=t.length,i.capacity=t.arrayBuffer.byteLength/i.bytesPerElement,i._refreshViews(),i}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(t){this.reserve(t),this.length=t}reserve(t){if(t>this.capacity){this.capacity=Math.max(t,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const i=this.uint8;this._refreshViews(),i&&this.uint8.set(i)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function Gt(n,t=1){let i=0,a=0;return{members:n.map(c=>{const d=mn[c.type].BYTES_PER_ELEMENT,g=i=ei(i,Math.max(t,d)),y=c.components||1;return a=Math.max(a,d),i+=d*y,{name:c.name,type:c.type,components:y,offset:g}}),size:ei(i,Math.max(a,t)),alignment:t}}function ei(n,t){return Math.ceil(n/t)*t}class Wn extends cn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,i){const a=this.length;return this.resize(a+1),this.emplace(a,t,i)}emplace(t,i,a){const c=2*t;return this.int16[c+0]=i,this.int16[c+1]=a,t}}Wn.prototype.bytesPerElement=4,Zt(Wn,"StructArrayLayout2i4");class li extends cn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,i,a){const c=this.length;return this.resize(c+1),this.emplace(c,t,i,a)}emplace(t,i,a,c){const d=3*t;return this.int16[d+0]=i,this.int16[d+1]=a,this.int16[d+2]=c,t}}li.prototype.bytesPerElement=6,Zt(li,"StructArrayLayout3i6");class ii extends cn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,i,a,c){const d=this.length;return this.resize(d+1),this.emplace(d,t,i,a,c)}emplace(t,i,a,c,d){const g=4*t;return this.int16[g+0]=i,this.int16[g+1]=a,this.int16[g+2]=c,this.int16[g+3]=d,t}}ii.prototype.bytesPerElement=8,Zt(ii,"StructArrayLayout4i8");class zr extends cn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,i,a,c,d,g,y){const w=this.length;return this.resize(w+1),this.emplace(w,t,i,a,c,d,g,y)}emplace(t,i,a,c,d,g,y,w){const E=6*t,A=12*t,P=3*t;return this.int16[E+0]=i,this.int16[E+1]=a,this.uint8[A+4]=c,this.uint8[A+5]=d,this.uint8[A+6]=g,this.uint8[A+7]=y,this.float32[P+2]=w,t}}zr.prototype.bytesPerElement=12,Zt(zr,"StructArrayLayout2i4ub1f12");class Gr extends cn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,i,a,c){const d=this.length;return this.resize(d+1),this.emplace(d,t,i,a,c)}emplace(t,i,a,c,d){const g=4*t;return this.float32[g+0]=i,this.float32[g+1]=a,this.float32[g+2]=c,this.float32[g+3]=d,t}}Gr.prototype.bytesPerElement=16,Zt(Gr,"StructArrayLayout4f16");class br extends cn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,i,a,c,d){const g=this.length;return this.resize(g+1),this.emplace(g,t,i,a,c,d)}emplace(t,i,a,c,d,g){const y=6*t,w=3*t;return this.uint16[y+0]=i,this.uint16[y+1]=a,this.uint16[y+2]=c,this.uint16[y+3]=d,this.float32[w+2]=g,t}}br.prototype.bytesPerElement=12,Zt(br,"StructArrayLayout4ui1f12");class xo extends cn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,i,a,c){const d=this.length;return this.resize(d+1),this.emplace(d,t,i,a,c)}emplace(t,i,a,c,d){const g=4*t;return this.uint16[g+0]=i,this.uint16[g+1]=a,this.uint16[g+2]=c,this.uint16[g+3]=d,t}}xo.prototype.bytesPerElement=8,Zt(xo,"StructArrayLayout4ui8");class gi extends cn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,i,a,c,d,g){const y=this.length;return this.resize(y+1),this.emplace(y,t,i,a,c,d,g)}emplace(t,i,a,c,d,g,y){const w=6*t;return this.int16[w+0]=i,this.int16[w+1]=a,this.int16[w+2]=c,this.int16[w+3]=d,this.int16[w+4]=g,this.int16[w+5]=y,t}}gi.prototype.bytesPerElement=12,Zt(gi,"StructArrayLayout6i12");class ci extends cn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,i,a,c,d,g,y,w,E,A,P,z){const B=this.length;return this.resize(B+1),this.emplace(B,t,i,a,c,d,g,y,w,E,A,P,z)}emplace(t,i,a,c,d,g,y,w,E,A,P,z,B){const F=12*t;return this.int16[F+0]=i,this.int16[F+1]=a,this.int16[F+2]=c,this.int16[F+3]=d,this.uint16[F+4]=g,this.uint16[F+5]=y,this.uint16[F+6]=w,this.uint16[F+7]=E,this.int16[F+8]=A,this.int16[F+9]=P,this.int16[F+10]=z,this.int16[F+11]=B,t}}ci.prototype.bytesPerElement=24,Zt(ci,"StructArrayLayout4i4ui4i24");class Gn extends cn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,i,a,c,d,g){const y=this.length;return this.resize(y+1),this.emplace(y,t,i,a,c,d,g)}emplace(t,i,a,c,d,g,y){const w=10*t,E=5*t;return this.int16[w+0]=i,this.int16[w+1]=a,this.int16[w+2]=c,this.float32[E+2]=d,this.float32[E+3]=g,this.float32[E+4]=y,t}}Gn.prototype.bytesPerElement=20,Zt(Gn,"StructArrayLayout3i3f20");class Ri extends cn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t){const i=this.length;return this.resize(i+1),this.emplace(i,t)}emplace(t,i){return this.uint32[1*t+0]=i,t}}Ri.prototype.bytesPerElement=4,Zt(Ri,"StructArrayLayout1ul4");class fr extends cn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,i,a,c,d,g,y,w,E,A,P,z,B){const F=this.length;return this.resize(F+1),this.emplace(F,t,i,a,c,d,g,y,w,E,A,P,z,B)}emplace(t,i,a,c,d,g,y,w,E,A,P,z,B,F){const q=20*t,W=10*t;return this.int16[q+0]=i,this.int16[q+1]=a,this.int16[q+2]=c,this.int16[q+3]=d,this.int16[q+4]=g,this.float32[W+3]=y,this.float32[W+4]=w,this.float32[W+5]=E,this.float32[W+6]=A,this.int16[q+14]=P,this.uint32[W+8]=z,this.uint16[q+18]=B,this.uint16[q+19]=F,t}}fr.prototype.bytesPerElement=40,Zt(fr,"StructArrayLayout5i4f1i1ul2ui40");class di extends cn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,i,a,c,d,g,y){const w=this.length;return this.resize(w+1),this.emplace(w,t,i,a,c,d,g,y)}emplace(t,i,a,c,d,g,y,w){const E=8*t;return this.int16[E+0]=i,this.int16[E+1]=a,this.int16[E+2]=c,this.int16[E+4]=d,this.int16[E+5]=g,this.int16[E+6]=y,this.int16[E+7]=w,t}}di.prototype.bytesPerElement=16,Zt(di,"StructArrayLayout3i2i2i16");class wr extends cn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,i,a,c,d){const g=this.length;return this.resize(g+1),this.emplace(g,t,i,a,c,d)}emplace(t,i,a,c,d,g){const y=4*t,w=8*t;return this.float32[y+0]=i,this.float32[y+1]=a,this.float32[y+2]=c,this.int16[w+6]=d,this.int16[w+7]=g,t}}wr.prototype.bytesPerElement=16,Zt(wr,"StructArrayLayout2f1f2i16");class Sl extends cn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,i,a,c){const d=this.length;return this.resize(d+1),this.emplace(d,t,i,a,c)}emplace(t,i,a,c,d){const g=12*t,y=3*t;return this.uint8[g+0]=i,this.uint8[g+1]=a,this.float32[y+1]=c,this.float32[y+2]=d,t}}Sl.prototype.bytesPerElement=12,Zt(Sl,"StructArrayLayout2ub2f12");class jo extends cn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,i,a){const c=this.length;return this.resize(c+1),this.emplace(c,t,i,a)}emplace(t,i,a,c){const d=3*t;return this.float32[d+0]=i,this.float32[d+1]=a,this.float32[d+2]=c,t}}jo.prototype.bytesPerElement=12,Zt(jo,"StructArrayLayout3f12");class pr extends cn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,i,a){const c=this.length;return this.resize(c+1),this.emplace(c,t,i,a)}emplace(t,i,a,c){const d=3*t;return this.uint16[d+0]=i,this.uint16[d+1]=a,this.uint16[d+2]=c,t}}pr.prototype.bytesPerElement=6,Zt(pr,"StructArrayLayout3ui6");class Kr extends cn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t,i,a,c,d,g,y,w,E,A,P,z,B,F,q,W,le,_e,ae,de,we){const ye=this.length;return this.resize(ye+1),this.emplace(ye,t,i,a,c,d,g,y,w,E,A,P,z,B,F,q,W,le,_e,ae,de,we)}emplace(t,i,a,c,d,g,y,w,E,A,P,z,B,F,q,W,le,_e,ae,de,we,ye){const $e=30*t,qe=15*t,it=60*t;return this.int16[$e+0]=i,this.int16[$e+1]=a,this.int16[$e+2]=c,this.float32[qe+2]=d,this.float32[qe+3]=g,this.uint16[$e+8]=y,this.uint16[$e+9]=w,this.uint32[qe+5]=E,this.uint32[qe+6]=A,this.uint32[qe+7]=P,this.uint16[$e+16]=z,this.uint16[$e+17]=B,this.uint16[$e+18]=F,this.float32[qe+10]=q,this.float32[qe+11]=W,this.uint8[it+48]=le,this.uint8[it+49]=_e,this.uint8[it+50]=ae,this.uint32[qe+13]=de,this.int16[$e+28]=we,this.uint8[it+58]=ye,t}}Kr.prototype.bytesPerElement=60,Zt(Kr,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class bo extends cn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t,i,a,c,d,g,y,w,E,A,P,z,B,F,q,W,le,_e,ae,de,we,ye,$e,qe,it,St,Ke,ut,dt,vt){const Ct=this.length;return this.resize(Ct+1),this.emplace(Ct,t,i,a,c,d,g,y,w,E,A,P,z,B,F,q,W,le,_e,ae,de,we,ye,$e,qe,it,St,Ke,ut,dt,vt)}emplace(t,i,a,c,d,g,y,w,E,A,P,z,B,F,q,W,le,_e,ae,de,we,ye,$e,qe,it,St,Ke,ut,dt,vt,Ct){const Qe=38*t,Dt=19*t;return this.int16[Qe+0]=i,this.int16[Qe+1]=a,this.int16[Qe+2]=c,this.float32[Dt+2]=d,this.float32[Dt+3]=g,this.int16[Qe+8]=y,this.int16[Qe+9]=w,this.int16[Qe+10]=E,this.int16[Qe+11]=A,this.int16[Qe+12]=P,this.int16[Qe+13]=z,this.uint16[Qe+14]=B,this.uint16[Qe+15]=F,this.uint16[Qe+16]=q,this.uint16[Qe+17]=W,this.uint16[Qe+18]=le,this.uint16[Qe+19]=_e,this.uint16[Qe+20]=ae,this.uint16[Qe+21]=de,this.uint16[Qe+22]=we,this.uint16[Qe+23]=ye,this.uint16[Qe+24]=$e,this.uint16[Qe+25]=qe,this.uint16[Qe+26]=it,this.uint16[Qe+27]=St,this.uint16[Qe+28]=Ke,this.uint32[Dt+15]=ut,this.float32[Dt+16]=dt,this.float32[Dt+17]=vt,this.float32[Dt+18]=Ct,t}}bo.prototype.bytesPerElement=76,Zt(bo,"StructArrayLayout3i2f6i15ui1ul3f76");class wo extends cn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t){const i=this.length;return this.resize(i+1),this.emplace(i,t)}emplace(t,i){return this.float32[1*t+0]=i,t}}wo.prototype.bytesPerElement=4,Zt(wo,"StructArrayLayout1f4");class Cl extends cn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,i,a,c,d){const g=this.length;return this.resize(g+1),this.emplace(g,t,i,a,c,d)}emplace(t,i,a,c,d,g){const y=5*t;return this.float32[y+0]=i,this.float32[y+1]=a,this.float32[y+2]=c,this.float32[y+3]=d,this.float32[y+4]=g,t}}Cl.prototype.bytesPerElement=20,Zt(Cl,"StructArrayLayout5f20");class xa extends cn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,i,a,c){const d=this.length;return this.resize(d+1),this.emplace(d,t,i,a,c)}emplace(t,i,a,c,d){const g=6*t;return this.uint32[3*t+0]=i,this.uint16[g+2]=a,this.uint16[g+3]=c,this.uint16[g+4]=d,t}}xa.prototype.bytesPerElement=12,Zt(xa,"StructArrayLayout1ul3ui12");class Eo extends cn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,i){const a=this.length;return this.resize(a+1),this.emplace(a,t,i)}emplace(t,i,a){const c=2*t;return this.uint16[c+0]=i,this.uint16[c+1]=a,t}}Eo.prototype.bytesPerElement=4,Zt(Eo,"StructArrayLayout2ui4");class kh extends cn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t){const i=this.length;return this.resize(i+1),this.emplace(i,t)}emplace(t,i){return this.uint16[1*t+0]=i,t}}kh.prototype.bytesPerElement=2,Zt(kh,"StructArrayLayout1ui2");class $f extends cn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,i){const a=this.length;return this.resize(a+1),this.emplace(a,t,i)}emplace(t,i,a){const c=2*t;return this.float32[c+0]=i,this.float32[c+1]=a,t}}$f.prototype.bytesPerElement=8,Zt($f,"StructArrayLayout2f8");class Jv extends Sn{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}Jv.prototype.size=40;class kg extends fr{get(t){return new Jv(this,t)}}Zt(kg,"CollisionBoxArray");class e0 extends Sn{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(t){this._structArray.uint8[this._pos1+49]=t}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(t){this._structArray.uint8[this._pos1+50]=t}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(t){this._structArray.uint32[this._pos4+13]=t}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(t){this._structArray.uint8[this._pos1+58]=t}}e0.prototype.size=60;class t0 extends Kr{get(t){return new e0(this,t)}}Zt(t0,"PlacedSymbolArray");class n0 extends Sn{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+11]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+13]}get key(){return this._structArray.uint16[this._pos2+14]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+17]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+19]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+21]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+22]}get featureIndex(){return this._structArray.uint16[this._pos2+23]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+25]}get numIconVertices(){return this._structArray.uint16[this._pos2+26]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+27]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+28]}get crossTileID(){return this._structArray.uint32[this._pos4+15]}set crossTileID(t){this._structArray.uint32[this._pos4+15]=t}get textOffset0(){return this._structArray.float32[this._pos4+16]}get textOffset1(){return this._structArray.float32[this._pos4+17]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+18]}}n0.prototype.size=76;class i0 extends bo{get(t){return new n0(this,t)}}Zt(i0,"SymbolInstanceArray");class r0 extends wo{getoffsetX(t){return this.float32[1*t+0]}}Zt(r0,"GlyphOffsetArray");class o0 extends Wn{getx(t){return this.int16[2*t+0]}gety(t){return this.int16[2*t+1]}}Zt(o0,"SymbolLineVertexArray");class s0 extends Sn{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}s0.prototype.size=12;class a0 extends xa{get(t){return new s0(this,t)}}Zt(a0,"FeatureIndexArray");class l0 extends Eo{geta_centroid_pos0(t){return this.uint16[2*t+0]}geta_centroid_pos1(t){return this.uint16[2*t+1]}}Zt(l0,"FillExtrusionCentroidArray");const $2=Gt([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),G2=Gt([{name:"a_dash",components:4,type:"Uint16"}]);var Vc={exports:{}},c0={exports:{}};c0.exports=function(n,t){var i,a,c,d,g,y,w,E;for(a=n.length-(i=3&n.length),c=t,g=3432918353,y=461845907,E=0;E<a;)w=255&n.charCodeAt(E)|(255&n.charCodeAt(++E))<<8|(255&n.charCodeAt(++E))<<16|(255&n.charCodeAt(++E))<<24,++E,c=27492+(65535&(d=5*(65535&(c=(c^=w=(65535&(w=(w=(65535&w)*g+(((w>>>16)*g&65535)<<16)&4294967295)<<15|w>>>17))*y+(((w>>>16)*y&65535)<<16)&4294967295)<<13|c>>>19))+((5*(c>>>16)&65535)<<16)&4294967295))+((58964+(d>>>16)&65535)<<16);switch(w=0,i){case 3:w^=(255&n.charCodeAt(E+2))<<16;case 2:w^=(255&n.charCodeAt(E+1))<<8;case 1:c^=w=(65535&(w=(w=(65535&(w^=255&n.charCodeAt(E)))*g+(((w>>>16)*g&65535)<<16)&4294967295)<<15|w>>>17))*y+(((w>>>16)*y&65535)<<16)&4294967295}return c^=n.length,c=2246822507*(65535&(c^=c>>>16))+((2246822507*(c>>>16)&65535)<<16)&4294967295,c=3266489909*(65535&(c^=c>>>13))+((3266489909*(c>>>16)&65535)<<16)&4294967295,(c^=c>>>16)>>>0};var u0={exports:{}};u0.exports=function(n,t){for(var i,a=n.length,c=t^a,d=0;a>=4;)i=1540483477*(65535&(i=255&n.charCodeAt(d)|(255&n.charCodeAt(++d))<<8|(255&n.charCodeAt(++d))<<16|(255&n.charCodeAt(++d))<<24))+((1540483477*(i>>>16)&65535)<<16),c=1540483477*(65535&c)+((1540483477*(c>>>16)&65535)<<16)^(i=1540483477*(65535&(i^=i>>>24))+((1540483477*(i>>>16)&65535)<<16)),a-=4,++d;switch(a){case 3:c^=(255&n.charCodeAt(d+2))<<16;case 2:c^=(255&n.charCodeAt(d+1))<<8;case 1:c=1540483477*(65535&(c^=255&n.charCodeAt(d)))+((1540483477*(c>>>16)&65535)<<16)}return c=1540483477*(65535&(c^=c>>>13))+((1540483477*(c>>>16)&65535)<<16),(c^=c>>>15)>>>0};var h0=c0.exports,Z2=u0.exports;Vc.exports=h0,Vc.exports.murmur3=h0,Vc.exports.murmur2=Z2;class Gf{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(t,i,a,c){this.ids.push(d0(t)),this.positions.push(i,a,c)}getPositions(t){const i=d0(t);let a=0,c=this.ids.length-1;for(;a<c;){const g=a+c>>1;this.ids[g]>=i?c=g:a=g+1}const d=[];for(;this.ids[a]===i;)d.push({index:this.positions[3*a],start:this.positions[3*a+1],end:this.positions[3*a+2]}),a++;return d}static serialize(t,i){const a=new Float64Array(t.ids),c=new Uint32Array(t.positions);return Pg(a,c,0,a.length-1),i&&i.push(a.buffer,c.buffer),{ids:a,positions:c}}static deserialize(t){const i=new Gf;return i.ids=t.ids,i.positions=t.positions,i.indexed=!0,i}}function d0(n){const t=+n;return!isNaN(t)&&Number.MIN_SAFE_INTEGER<=t&&t<=Number.MAX_SAFE_INTEGER?t:Vc.exports(String(n))}function Pg(n,t,i,a){for(;i<a;){const c=n[i+a>>1];let d=i-1,g=a+1;for(;;){do d++;while(n[d]<c);do g--;while(n[g]>c);if(d>=g)break;Zf(n,d,g),Zf(t,3*d,3*g),Zf(t,3*d+1,3*g+1),Zf(t,3*d+2,3*g+2)}g-i<a-g?(Pg(n,t,i,g),i=g+1):(Pg(n,t,g+1,a),a=g)}}function Zf(n,t,i){const a=n[t];n[t]=n[i],n[i]=a}Zt(Gf,"FeaturePositionMap");class Ds{constructor(t){this.gl=t.gl,this.initialized=!1}fetchUniformLocation(t,i){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(t,i),this.initialized=!0),!!this.location}}class Wf extends Ds{constructor(t){super(t),this.current=0}set(t,i,a){this.fetchUniformLocation(t,i)&&this.current!==a&&(this.current=a,this.gl.uniform1f(this.location,a))}}class f0 extends Ds{constructor(t){super(t),this.current=[0,0,0,0]}set(t,i,a){this.fetchUniformLocation(t,i)&&(a[0]===this.current[0]&&a[1]===this.current[1]&&a[2]===this.current[2]&&a[3]===this.current[3]||(this.current=a,this.gl.uniform4f(this.location,a[0],a[1],a[2],a[3])))}}class p0 extends Ds{constructor(t){super(t),this.current=ki.transparent}set(t,i,a){this.fetchUniformLocation(t,i)&&(a.r===this.current.r&&a.g===this.current.g&&a.b===this.current.b&&a.a===this.current.a||(this.current=a,this.gl.uniform4f(this.location,a.r,a.g,a.b,a.a)))}}const W2=new Float32Array(16),H2=new Float32Array(9),X2=new Float32Array(4);function zg(n){return[Jt(255*n.r,255*n.g),Jt(255*n.b,255*n.a)]}class Ph{constructor(t,i,a){this.value=t,this.uniformNames=i.map(c=>`u_${c}`),this.type=a}setUniform(t,i,a,c,d){i.set(t,d,c.constantOr(this.value))}getBinding(t,i){return this.type==="color"?new p0(t):new Wf(t)}}class Uc{constructor(t,i){this.uniformNames=i.map(a=>`u_${a}`),this.pattern=null,this.pixelRatio=1}setConstantPatternPositions(t){this.pixelRatio=t.pixelRatio||1,this.pattern=t.tl.concat(t.br)}setUniform(t,i,a,c,d){const g=d==="u_pattern"||d==="u_dash"?this.pattern:d==="u_pixel_ratio"?this.pixelRatio:null;g&&i.set(t,d,g)}getBinding(t,i){return i==="u_pattern"||i==="u_dash"?new f0(t):new Wf(t)}}class Os{constructor(t,i,a,c){this.expression=t,this.type=a,this.maxValue=0,this.paintVertexAttributes=i.map(d=>({name:`a_${d}`,type:"Float32",components:a==="color"?2:1,offset:0})),this.paintVertexArray=new c}populatePaintArray(t,i,a,c,d,g){const y=this.paintVertexArray.length,w=this.expression.evaluate(new Le(0),i,{},d,c,g);this.paintVertexArray.resize(t),this._setPaintValue(y,t,w)}updatePaintArray(t,i,a,c,d){const g=this.expression.evaluate({zoom:0},a,c,void 0,d);this._setPaintValue(t,i,g)}_setPaintValue(t,i,a){if(this.type==="color"){const c=zg(a);for(let d=t;d<i;d++)this.paintVertexArray.emplace(d,c[0],c[1])}else{for(let c=t;c<i;c++)this.paintVertexArray.emplace(c,a);this.maxValue=Math.max(this.maxValue,Math.abs(a))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class qo{constructor(t,i,a,c,d,g){this.expression=t,this.uniformNames=i.map(y=>`u_${y}_t`),this.type=a,this.useIntegerZoom=c,this.zoom=d,this.maxValue=0,this.paintVertexAttributes=i.map(y=>({name:`a_${y}`,type:"Float32",components:a==="color"?4:2,offset:0})),this.paintVertexArray=new g}populatePaintArray(t,i,a,c,d,g){const y=this.expression.evaluate(new Le(this.zoom),i,{},d,c,g),w=this.expression.evaluate(new Le(this.zoom+1),i,{},d,c,g),E=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValue(E,t,y,w)}updatePaintArray(t,i,a,c,d){const g=this.expression.evaluate({zoom:this.zoom},a,c,void 0,d),y=this.expression.evaluate({zoom:this.zoom+1},a,c,void 0,d);this._setPaintValue(t,i,g,y)}_setPaintValue(t,i,a,c){if(this.type==="color"){const d=zg(a),g=zg(c);for(let y=t;y<i;y++)this.paintVertexArray.emplace(y,d[0],d[1],g[0],g[1])}else{for(let d=t;d<i;d++)this.paintVertexArray.emplace(d,a,c);this.maxValue=Math.max(this.maxValue,Math.abs(a),Math.abs(c))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(t,i,a,c,d){const g=this.useIntegerZoom?Math.floor(a.zoom):a.zoom,y=lt(this.expression.interpolationFactor(g,this.zoom,this.zoom+1),0,1);i.set(t,d,y)}getBinding(t,i){return new Wf(t)}}class ba{constructor(t,i,a,c,d){this.expression=t,this.layerId=d,this.paintVertexAttributes=(a==="array"?G2:$2).members;for(let g=0;g<i.length;++g);this.paintVertexArray=new c}populatePaintArray(t,i,a){const c=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValues(c,t,i.patterns&&i.patterns[this.layerId],a)}updatePaintArray(t,i,a,c,d,g){this._setPaintValues(t,i,a.patterns&&a.patterns[this.layerId],g)}_setPaintValues(t,i,a,c){if(!c||!a)return;const d=c[a];if(!d)return;const{tl:g,br:y,pixelRatio:w}=d;for(let E=t;E<i;E++)this.paintVertexArray.emplace(E,g[0],g[1],y[0],y[1],w)}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class wa{constructor(t,i,a=()=>!0){this.binders={},this._buffers=[];const c=[];for(const d in t.paint._values){if(!a(d))continue;const g=t.paint.get(d);if(!(g instanceof pt&&zs(g.property.specification)))continue;const y=Y2(d,t.type),w=g.value,E=g.property.specification.type,A=g.property.useIntegerZoom,P=d==="line-dasharray"||d.endsWith("pattern"),z=d==="line-dasharray"&&t.layout.get("line-cap").value.kind!=="constant";if(w.kind!=="constant"||z)if(w.kind==="source"||z||P){const B=m0(d,E,"source");this.binders[d]=P?new ba(w,y,E,B,t.id):new Os(w,y,E,B),c.push(`/a_${d}`)}else{const B=m0(d,E,"composite");this.binders[d]=new qo(w,y,E,A,i,B),c.push(`/z_${d}`)}else this.binders[d]=P?new Uc(w.value,y):new Ph(w.value,y,E),c.push(`/u_${d}`)}this.cacheKey=c.sort().join("")}getMaxValue(t){const i=this.binders[t];return i instanceof Os||i instanceof qo?i.maxValue:0}populatePaintArrays(t,i,a,c,d,g){for(const y in this.binders){const w=this.binders[y];(w instanceof Os||w instanceof qo||w instanceof ba)&&w.populatePaintArray(t,i,a,c,d,g)}}setConstantPatternPositions(t){for(const i in this.binders){const a=this.binders[i];a instanceof Uc&&a.setConstantPatternPositions(t)}}updatePaintArrays(t,i,a,c,d,g){let y=!1;for(const w in t){const E=i.getPositions(w);for(const A of E){const P=a.feature(A.index);for(const z in this.binders){const B=this.binders[z];if((B instanceof Os||B instanceof qo||B instanceof ba)&&B.expression.isStateDependent===!0){const F=c.paint.get(z);B.expression=F.value,B.updatePaintArray(A.start,A.end,P,t[w],d,g),y=!0}}}}return y}defines(){const t=[];for(const i in this.binders){const a=this.binders[i];(a instanceof Ph||a instanceof Uc)&&t.push(...a.uniformNames.map(c=>`#define HAS_UNIFORM_${c}`))}return t}getBinderAttributes(){const t=[];for(const i in this.binders){const a=this.binders[i];if(a instanceof Os||a instanceof qo||a instanceof ba)for(let c=0;c<a.paintVertexAttributes.length;c++)t.push(a.paintVertexAttributes[c].name)}return t}getBinderUniforms(){const t=[];for(const i in this.binders){const a=this.binders[i];if(a instanceof Ph||a instanceof Uc||a instanceof qo)for(const c of a.uniformNames)t.push(c)}return t}getPaintVertexBuffers(){return this._buffers}getUniforms(t){const i=[];for(const a in this.binders){const c=this.binders[a];if(c instanceof Ph||c instanceof Uc||c instanceof qo)for(const d of c.uniformNames)i.push({name:d,property:a,binding:c.getBinding(t,d)})}return i}setUniforms(t,i,a,c,d){for(const{name:g,property:y,binding:w}of a)this.binders[y].setUniform(t,w,d,c.get(y),g)}updatePaintBuffers(){this._buffers=[];for(const t in this.binders){const i=this.binders[t];(i instanceof Os||i instanceof qo||i instanceof ba)&&i.paintVertexBuffer&&this._buffers.push(i.paintVertexBuffer)}}upload(t){for(const i in this.binders){const a=this.binders[i];(a instanceof Os||a instanceof qo||a instanceof ba)&&a.upload(t)}this.updatePaintBuffers()}destroy(){for(const t in this.binders){const i=this.binders[t];(i instanceof Os||i instanceof qo||i instanceof ba)&&i.destroy()}}}class Al{constructor(t,i,a=()=>!0){this.programConfigurations={};for(const c of t)this.programConfigurations[c.id]=new wa(c,i,a);this.needsUpload=!1,this._featureMap=new Gf,this._bufferOffset=0}populatePaintArrays(t,i,a,c,d,g,y){for(const w in this.programConfigurations)this.programConfigurations[w].populatePaintArrays(t,i,c,d,g,y);i.id!==void 0&&this._featureMap.add(i.id,a,this._bufferOffset,t),this._bufferOffset=t,this.needsUpload=!0}updatePaintArrays(t,i,a,c,d){for(const g of a)this.needsUpload=this.programConfigurations[g.id].updatePaintArrays(t,this._featureMap,i,g,c,d)||this.needsUpload}get(t){return this.programConfigurations[t]}upload(t){if(this.needsUpload){for(const i in this.programConfigurations)this.programConfigurations[i].upload(t);this.needsUpload=!1}}destroy(){for(const t in this.programConfigurations)this.programConfigurations[t].destroy()}}const K2={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]};function Y2(n,t){return K2[n]||[n.replace(`${t}-`,"").replace(/-/g,"_")]}const Q2={"line-pattern":{source:br,composite:br},"fill-pattern":{source:br,composite:br},"fill-extrusion-pattern":{source:br,composite:br},"line-dasharray":{source:xo,composite:xo}},J2={color:{source:$f,composite:Gr},number:{source:wo,composite:$f}};function m0(n,t,i){const a=Q2[n];return a&&a[i]||J2[t][i]}Zt(Ph,"ConstantBinder"),Zt(Uc,"PatternConstantBinder"),Zt(Os,"SourceExpressionBinder"),Zt(ba,"PatternCompositeBinder"),Zt(qo,"CompositeExpressionBinder"),Zt(wa,"ProgramConfiguration",{omit:["_buffers"]}),Zt(Al,"ProgramConfigurationSet");const Hf="-transition";class $o extends mi{constructor(t,i){if(super(),this.id=t.id,this.type=t.type,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,t.type!=="custom"&&(this.metadata=t.metadata,this.minzoom=t.minzoom,this.maxzoom=t.maxzoom,t.type!=="background"&&t.type!=="sky"&&(this.source=t.source,this.sourceLayer=t["source-layer"],this.filter=t.filter),i.layout&&(this._unevaluatedLayout=new Je(i.layout)),i.paint)){this._transitionablePaint=new st(i.paint);for(const a in t.paint)this.setPaintProperty(a,t.paint[a],{validate:!1});for(const a in t.layout)this.setLayoutProperty(a,t.layout[a],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Pt(i.paint)}}getLayoutProperty(t){return t==="visibility"?this.visibility:this._unevaluatedLayout.getValue(t)}setLayoutProperty(t,i,a={}){i!=null&&this._validate(Ig,`layers.${this.id}.layout.${t}`,t,i,a)||(t!=="visibility"?this._unevaluatedLayout.setValue(t,i):this.visibility=i)}getPaintProperty(t){return ot(t,Hf)?this._transitionablePaint.getTransition(t.slice(0,-Hf.length)):this._transitionablePaint.getValue(t)}setPaintProperty(t,i,a={}){if(i!=null&&this._validate(Mg,`layers.${this.id}.paint.${t}`,t,i,a))return!1;if(ot(t,Hf))return this._transitionablePaint.setTransition(t.slice(0,-Hf.length),i||void 0),!1;{const c=this._transitionablePaint._values[t],d=c.value.isDataDriven(),g=c.value;this._transitionablePaint.setValue(t,i),this._handleSpecialPaintPropertyUpdate(t);const y=this._transitionablePaint._values[t].value,w=y.isDataDriven(),E=ot(t,"pattern")||t==="line-dasharray";return w||d||E||this._handleOverridablePaintPropertyUpdate(t,g,y)}}_handleSpecialPaintPropertyUpdate(t){}getProgramIds(){return null}getProgramConfiguration(t){return null}_handleOverridablePaintPropertyUpdate(t,i,a){return!1}isHidden(t){return!!(this.minzoom&&t<this.minzoom)||!!(this.maxzoom&&t>=this.maxzoom)||this.visibility==="none"}updateTransitions(t){this._transitioningPaint=this._transitionablePaint.transitioned(t,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(t,i){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(t,void 0,i)),this.paint=this._transitioningPaint.possiblyEvaluate(t,void 0,i)}serialize(){const t={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(t.layout=t.layout||{},t.layout.visibility=this.visibility),ft(t,(i,a)=>!(i===void 0||a==="layout"&&!Object.keys(i).length||a==="paint"&&!Object.keys(i).length))}_validate(t,i,a,c,d={}){return(!d||d.validate!==!1)&&zf(this,t.call(bh,{key:i,layerType:this.type,objectKey:a,value:c,styleSpec:tt,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const t in this.paint._values){const i=this.paint.get(t);if(i instanceof pt&&zs(i.property.specification)&&(i.value.kind==="source"||i.value.kind==="composite")&&i.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=Rs(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}}const eC=Gt([{name:"a_pos",components:2,type:"Int16"}],4),tC=Gt([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class Wi{constructor(t=[]){this.segments=t}prepareSegment(t,i,a,c){let d=this.segments[this.segments.length-1];return t>Wi.MAX_VERTEX_ARRAY_LENGTH&&oe(`Max vertices per segment is ${Wi.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${t}`),(!d||d.vertexLength+t>Wi.MAX_VERTEX_ARRAY_LENGTH||d.sortKey!==c)&&(d={vertexOffset:i.length,primitiveOffset:a.length,vertexLength:0,primitiveLength:0},c!==void 0&&(d.sortKey=c),this.segments.push(d)),d}get(){return this.segments}destroy(){for(const t of this.segments)for(const i in t.vaos)t.vaos[i].destroy()}static simpleSegment(t,i,a,c){return new Wi([{vertexOffset:t,primitiveOffset:i,vertexLength:a,primitiveLength:c,vaos:{},sortKey:0}])}}Wi.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Zt(Wi,"SegmentVector");var _n=8192;class Ea{constructor(t,i){t&&(i?this.setSouthWest(t).setNorthEast(i):t.length===4?this.setSouthWest([t[0],t[1]]).setNorthEast([t[2],t[3]]):this.setSouthWest(t[0]).setNorthEast(t[1]))}setNorthEast(t){return this._ne=t instanceof jn?new jn(t.lng,t.lat):jn.convert(t),this}setSouthWest(t){return this._sw=t instanceof jn?new jn(t.lng,t.lat):jn.convert(t),this}extend(t){const i=this._sw,a=this._ne;let c,d;if(t instanceof jn)c=t,d=t;else{if(!(t instanceof Ea))return Array.isArray(t)?t.length===4||t.every(Array.isArray)?this.extend(Ea.convert(t)):this.extend(jn.convert(t)):typeof t=="object"&&t!==null&&t.hasOwnProperty("lat")&&t.hasOwnProperty("lon")?this.extend(jn.convert(t)):this;if(c=t._sw,d=t._ne,!c||!d)return this}return i||a?(i.lng=Math.min(c.lng,i.lng),i.lat=Math.min(c.lat,i.lat),a.lng=Math.max(d.lng,a.lng),a.lat=Math.max(d.lat,a.lat)):(this._sw=new jn(c.lng,c.lat),this._ne=new jn(d.lng,d.lat)),this}getCenter(){return new jn((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new jn(this.getWest(),this.getNorth())}getSouthEast(){return new jn(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(t){const{lng:i,lat:a}=jn.convert(t);let c=this._sw.lng<=i&&i<=this._ne.lng;return this._sw.lng>this._ne.lng&&(c=this._sw.lng>=i&&i>=this._ne.lng),this._sw.lat<=a&&a<=this._ne.lat&&c}static convert(t){return!t||t instanceof Ea?t:new Ea(t)}}const Xf=63710088e-1;class jn{constructor(t,i){if(isNaN(t)||isNaN(i))throw new Error(`Invalid LngLat object: (${t}, ${i})`);if(this.lng=+t,this.lat=+i,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new jn(Ge(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(t){const i=Math.PI/180,a=this.lat*i,c=t.lat*i,d=Math.sin(a)*Math.sin(c)+Math.cos(a)*Math.cos(c)*Math.cos((t.lng-this.lng)*i);return Xf*Math.acos(Math.min(d,1))}toBounds(t=0){const i=360*t/40075017,a=i/Math.cos(Math.PI/180*this.lat);return new Ea(new jn(this.lng-a,this.lat-i),new jn(this.lng+a,this.lat+i))}static convert(t){if(t instanceof jn)return t;if(Array.isArray(t)&&(t.length===2||t.length===3))return new jn(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&typeof t=="object"&&t!==null)return new jn(Number("lng"in t?t.lng:t.lon),Number(t.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const g0=2*Math.PI*Xf;function Lg(n){return g0*Math.cos(n*Math.PI/180)}function cs(n){return(180+n)/360}function us(n){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+n*Math.PI/360)))/360}function To(n,t){return n/Lg(t)}function co(n){return 360*n-180}function mr(n){return 360/Math.PI*Math.atan(Math.exp((180-360*n)*Math.PI/180))-90}function _0(n,t){return n*Lg(mr(t))}const hs=85.051129;function y0(n){return 1/Math.cos(n*Math.PI/180)}class jc{constructor(t,i,a=0){this.x=+t,this.y=+i,this.z=+a}static fromLngLat(t,i=0){const a=jn.convert(t);return new jc(cs(a.lng),us(a.lat),To(i,a.lat))}toLngLat(){return new jn(co(this.x),mr(this.y))}toAltitude(){return _0(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/g0*y0(mr(this.y))}}function Rg(n,t,i,a,c,d,g,y,w){const E=(t+a)/2,A=(i+c)/2,P=new ce(E,A);y(P),function(z,B,F,q,W,le){const _e=F-W,ae=q-le;return Math.abs((q-B)*_e-(F-z)*ae)/Math.hypot(_e,ae)}(P.x,P.y,d.x,d.y,g.x,g.y)>=w?(Rg(n,t,i,E,A,d,P,y,w),Rg(n,E,A,a,c,P,g,y,w)):n.push(g)}function v0(n,t,i){let a=n[0],c=a.x,d=a.y;t(a);const g=[a];for(let y=1;y<n.length;y++){const w=n[y],{x:E,y:A}=w;t(w),Rg(g,c,d,E,A,a,w,t,i),c=E,d=A,a=w}return g}function Dg(n,t,i,a){if(a(t,i)){const c=t.add(i)._mult(.5);Dg(n,t,c,a),Dg(n,c,i,a)}else n.push(i)}function nC(n,t){let i=n[0];const a=[i];for(let c=1;c<n.length;c++){const d=n[c];Dg(a,i,d,t),i=d}return a}const Og=Math.pow(2,14)-1,x0=-Og-1;function iC(n,t){const i=Math.round(n.x*t),a=Math.round(n.y*t);return n.x=lt(i,x0,Og),n.y=lt(a,x0,Og),(i<n.x||i>n.x+1||a<n.y||a>n.y+1)&&oe("Geometry exceeds allowed extent, reduce your vector tile buffer size"),n}function Bs(n,t,i){const a=n.loadGeometry(),c=n.extent,d=_n/c;if(t&&i&&i.projection.isReprojectedInTileSpace){const g=1<<t.z,{scale:y,x:w,y:E,projection:A}=i,P=z=>{const B=co((t.x+z.x/c)/g),F=mr((t.y+z.y/c)/g),q=A.project(B,F);z.x=(q.x*y-w)*c,z.y=(q.y*y-E)*c};for(let z=0;z<a.length;z++)if(n.type!==1)a[z]=v0(a[z],P,1);else{const B=[];for(const F of a[z])F.x<0||F.x>=c||F.y<0||F.y>=c||(P(F),B.push(F));a[z]=B}}for(const g of a)for(const y of g)iC(y,d);return a}function Ml(n,t){return{type:n.type,id:n.id,properties:n.properties,geometry:t?Bs(n):[]}}function Kf(n,t,i,a,c){n.emplaceBack(2*t+(a+1)/2,2*i+(c+1)/2)}function Yf(n,t,i){n.emplaceBack(t.x,t.y,t.z,i[0]*16384,i[1]*16384,i[2]*16384)}class Bg{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(i=>i.id),this.index=t.index,this.hasPattern=!1,this.projection=t.projection,this.layoutVertexArray=new Wn,this.indexArray=new pr,this.segments=new Wi,this.programConfigurations=new Al(t.layers,t.zoom),this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id)}populate(t,i,a,c){const d=this.layers[0],g=[];let y=null;d.type==="circle"&&(y=d.layout.get("circle-sort-key"));for(const{feature:E,id:A,index:P,sourceLayerIndex:z}of t){const B=this.layers[0]._featureFilter.needGeometry,F=Ml(E,B);if(!this.layers[0]._featureFilter.filter(new Le(this.zoom),F,a))continue;const q=y?y.evaluate(F,{},a):void 0,W={id:A,properties:E.properties,type:E.type,sourceLayerIndex:z,index:P,geometry:B?F.geometry:Bs(E,a,c),patterns:{},sortKey:q};g.push(W)}y&&g.sort((E,A)=>E.sortKey-A.sortKey);let w=null;c.projection.name==="globe"&&(this.globeExtVertexArray=new gi,w=c.projection);for(const E of g){const{geometry:A,index:P,sourceLayerIndex:z}=E,B=t[P].feature;this.addFeature(E,A,P,i.availableImages,a,w),i.featureIndex.insert(B,A,P,z,this.index)}}update(t,i,a,c){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,i,this.stateDependentLayers,a,c)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,eC.members),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=t.createVertexBuffer(this.globeExtVertexArray,tC.members))),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(t,i,a,c,d,g){for(const y of i)for(const w of y){const E=w.x,A=w.y;if(E<0||E>=_n||A<0||A>=_n)continue;if(g){const B=g.projectTilePoint(E,A,d),F=g.upVector(d,E,A),q=this.globeExtVertexArray;Yf(q,B,F),Yf(q,B,F),Yf(q,B,F),Yf(q,B,F)}const P=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,t.sortKey),z=P.vertexLength;Kf(this.layoutVertexArray,E,A,-1,-1),Kf(this.layoutVertexArray,E,A,1,-1),Kf(this.layoutVertexArray,E,A,1,1),Kf(this.layoutVertexArray,E,A,-1,1),this.indexArray.emplaceBack(z,z+1,z+2),this.indexArray.emplaceBack(z,z+2,z+3),P.vertexLength+=4,P.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,a,{},c,d)}}function b0(n,t){for(let i=0;i<n.length;i++)if(Il(t,n[i]))return!0;for(let i=0;i<t.length;i++)if(Il(n,t[i]))return!0;return!!Fg(n,t)}function rC(n,t,i){return!!Il(n,t)||!!Ng(t,n,i)}function w0(n,t){if(n.length===1)return T0(t,n[0]);for(let i=0;i<t.length;i++){const a=t[i];for(let c=0;c<a.length;c++)if(Il(n,a[c]))return!0}for(let i=0;i<n.length;i++)if(T0(t,n[i]))return!0;for(let i=0;i<t.length;i++)if(Fg(n,t[i]))return!0;return!1}function oC(n,t,i){if(n.length>1){if(Fg(n,t))return!0;for(let a=0;a<t.length;a++)if(Ng(t[a],n,i))return!0}for(let a=0;a<n.length;a++)if(Ng(n[a],t,i))return!0;return!1}function Fg(n,t){if(n.length===0||t.length===0)return!1;for(let i=0;i<n.length-1;i++){const a=n[i],c=n[i+1];for(let d=0;d<t.length-1;d++)if(sC(a,c,t[d],t[d+1]))return!0}return!1}function sC(n,t,i,a){return be(n,i,a)!==be(t,i,a)&&be(n,t,i)!==be(n,t,a)}function Ng(n,t,i){const a=i*i;if(t.length===1)return n.distSqr(t[0])<a;for(let c=1;c<t.length;c++)if(E0(n,t[c-1],t[c])<a)return!0;return!1}function E0(n,t,i){const a=t.distSqr(i);if(a===0)return n.distSqr(t);const c=((n.x-t.x)*(i.x-t.x)+(n.y-t.y)*(i.y-t.y))/a;return n.distSqr(c<0?t:c>1?i:i.sub(t)._mult(c)._add(t))}function T0(n,t){let i,a,c,d=!1;for(let g=0;g<n.length;g++){i=n[g];for(let y=0,w=i.length-1;y<i.length;w=y++)a=i[y],c=i[w],a.y>t.y!=c.y>t.y&&t.x<(c.x-a.x)*(t.y-a.y)/(c.y-a.y)+a.x&&(d=!d)}return d}function Il(n,t){let i=!1;for(let a=0,c=n.length-1;a<n.length;c=a++){const d=n[a],g=n[c];d.y>t.y!=g.y>t.y&&t.x<(g.x-d.x)*(t.y-d.y)/(g.y-d.y)+d.x&&(i=!i)}return i}function S0(n,t,i,a,c){for(const g of n)if(t<=g.x&&i<=g.y&&a>=g.x&&c>=g.y)return!0;const d=[new ce(t,i),new ce(t,c),new ce(a,c),new ce(a,i)];if(n.length>2){for(const g of d)if(Il(n,g))return!0}for(let g=0;g<n.length-1;g++)if(aC(n[g],n[g+1],d))return!0;return!1}function aC(n,t,i){const a=i[0],c=i[2];if(n.x<a.x&&t.x<a.x||n.x>c.x&&t.x>c.x||n.y<a.y&&t.y<a.y||n.y>c.y&&t.y>c.y)return!1;const d=be(n,t,i[0]);return d!==be(n,t,i[1])||d!==be(n,t,i[2])||d!==be(n,t,i[3])}function qc(n,t,i){const a=t.paint.get(n).value;return a.kind==="constant"?a.value:i.programConfigurations.get(t.id).getMaxValue(n)}function Qf(n){return Math.sqrt(n[0]*n[0]+n[1]*n[1])}function C0(n,t,i,a,c){if(!t[0]&&!t[1])return n;const d=ce.convert(t)._mult(c);i==="viewport"&&d._rotate(-a);const g=[];for(let y=0;y<n.length;y++)g.push(n[y].sub(d));return g}function A0(n,t,i,a){const c=ce.convert(n)._mult(a);return t==="viewport"&&c._rotate(-i),c}Zt(Bg,"CircleBucket",{omit:["layers"]});const lC=new ln({"circle-sort-key":new He(tt.layout_circle["circle-sort-key"])});var cC={paint:new ln({"circle-radius":new He(tt.paint_circle["circle-radius"]),"circle-color":new He(tt.paint_circle["circle-color"]),"circle-blur":new He(tt.paint_circle["circle-blur"]),"circle-opacity":new He(tt.paint_circle["circle-opacity"]),"circle-translate":new De(tt.paint_circle["circle-translate"]),"circle-translate-anchor":new De(tt.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new De(tt.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new De(tt.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new He(tt.paint_circle["circle-stroke-width"]),"circle-stroke-color":new He(tt.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new He(tt.paint_circle["circle-stroke-opacity"])}),layout:lC},Jf=1e-6,Yr=typeof Float32Array<"u"?Float32Array:Array;function M0(){var n=new Yr(9);return Yr!=Float32Array&&(n[1]=0,n[2]=0,n[3]=0,n[5]=0,n[6]=0,n[7]=0),n[0]=1,n[4]=1,n[8]=1,n}function I0(n,t,i){var a=t[0],c=t[1],d=t[2],g=t[3],y=t[4],w=t[5],E=t[6],A=t[7],P=t[8],z=i[0],B=i[1],F=i[2],q=i[3],W=i[4],le=i[5],_e=i[6],ae=i[7],de=i[8];return n[0]=z*a+B*g+F*E,n[1]=z*c+B*y+F*A,n[2]=z*d+B*w+F*P,n[3]=q*a+W*g+le*E,n[4]=q*c+W*y+le*A,n[5]=q*d+W*w+le*P,n[6]=_e*a+ae*g+de*E,n[7]=_e*c+ae*y+de*A,n[8]=_e*d+ae*w+de*P,n}function Go(n){return n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function Vg(n,t){var i=t[0],a=t[1],c=t[2],d=t[3],g=t[4],y=t[5],w=t[6],E=t[7],A=t[8],P=t[9],z=t[10],B=t[11],F=t[12],q=t[13],W=t[14],le=t[15],_e=i*y-a*g,ae=i*w-c*g,de=i*E-d*g,we=a*w-c*y,ye=a*E-d*y,$e=c*E-d*w,qe=A*q-P*F,it=A*W-z*F,St=A*le-B*F,Ke=P*W-z*q,ut=P*le-B*q,dt=z*le-B*W,vt=_e*dt-ae*ut+de*Ke+we*St-ye*it+$e*qe;return vt?(n[0]=(y*dt-w*ut+E*Ke)*(vt=1/vt),n[1]=(c*ut-a*dt-d*Ke)*vt,n[2]=(q*$e-W*ye+le*we)*vt,n[3]=(z*ye-P*$e-B*we)*vt,n[4]=(w*St-g*dt-E*it)*vt,n[5]=(i*dt-c*St+d*it)*vt,n[6]=(W*de-F*$e-le*ae)*vt,n[7]=(A*$e-z*de+B*ae)*vt,n[8]=(g*ut-y*St+E*qe)*vt,n[9]=(a*St-i*ut-d*qe)*vt,n[10]=(F*ye-q*de+le*_e)*vt,n[11]=(P*de-A*ye-B*_e)*vt,n[12]=(y*it-g*Ke-w*qe)*vt,n[13]=(i*Ke-a*it+c*qe)*vt,n[14]=(q*ae-F*we-W*_e)*vt,n[15]=(A*we-P*ae+z*_e)*vt,n):null}function kl(n,t,i){var a=t[0],c=t[1],d=t[2],g=t[3],y=t[4],w=t[5],E=t[6],A=t[7],P=t[8],z=t[9],B=t[10],F=t[11],q=t[12],W=t[13],le=t[14],_e=t[15],ae=i[0],de=i[1],we=i[2],ye=i[3];return n[0]=ae*a+de*y+we*P+ye*q,n[1]=ae*c+de*w+we*z+ye*W,n[2]=ae*d+de*E+we*B+ye*le,n[3]=ae*g+de*A+we*F+ye*_e,n[4]=(ae=i[4])*a+(de=i[5])*y+(we=i[6])*P+(ye=i[7])*q,n[5]=ae*c+de*w+we*z+ye*W,n[6]=ae*d+de*E+we*B+ye*le,n[7]=ae*g+de*A+we*F+ye*_e,n[8]=(ae=i[8])*a+(de=i[9])*y+(we=i[10])*P+(ye=i[11])*q,n[9]=ae*c+de*w+we*z+ye*W,n[10]=ae*d+de*E+we*B+ye*le,n[11]=ae*g+de*A+we*F+ye*_e,n[12]=(ae=i[12])*a+(de=i[13])*y+(we=i[14])*P+(ye=i[15])*q,n[13]=ae*c+de*w+we*z+ye*W,n[14]=ae*d+de*E+we*B+ye*le,n[15]=ae*g+de*A+we*F+ye*_e,n}function zh(n,t,i){var a,c,d,g,y,w,E,A,P,z,B,F,q=i[0],W=i[1],le=i[2];return t===n?(n[12]=t[0]*q+t[4]*W+t[8]*le+t[12],n[13]=t[1]*q+t[5]*W+t[9]*le+t[13],n[14]=t[2]*q+t[6]*W+t[10]*le+t[14],n[15]=t[3]*q+t[7]*W+t[11]*le+t[15]):(c=t[1],d=t[2],g=t[3],y=t[4],w=t[5],E=t[6],A=t[7],P=t[8],z=t[9],B=t[10],F=t[11],n[0]=a=t[0],n[1]=c,n[2]=d,n[3]=g,n[4]=y,n[5]=w,n[6]=E,n[7]=A,n[8]=P,n[9]=z,n[10]=B,n[11]=F,n[12]=a*q+y*W+P*le+t[12],n[13]=c*q+w*W+z*le+t[13],n[14]=d*q+E*W+B*le+t[14],n[15]=g*q+A*W+F*le+t[15]),n}function Pl(n,t,i){var a=i[0],c=i[1],d=i[2];return n[0]=t[0]*a,n[1]=t[1]*a,n[2]=t[2]*a,n[3]=t[3]*a,n[4]=t[4]*c,n[5]=t[5]*c,n[6]=t[6]*c,n[7]=t[7]*c,n[8]=t[8]*d,n[9]=t[9]*d,n[10]=t[10]*d,n[11]=t[11]*d,n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15],n}function Ug(n,t,i){var a=Math.sin(i),c=Math.cos(i),d=t[4],g=t[5],y=t[6],w=t[7],E=t[8],A=t[9],P=t[10],z=t[11];return t!==n&&(n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15]),n[4]=d*c+E*a,n[5]=g*c+A*a,n[6]=y*c+P*a,n[7]=w*c+z*a,n[8]=E*c-d*a,n[9]=A*c-g*a,n[10]=P*c-y*a,n[11]=z*c-w*a,n}function ep(n,t,i){var a=Math.sin(i),c=Math.cos(i),d=t[0],g=t[1],y=t[2],w=t[3],E=t[8],A=t[9],P=t[10],z=t[11];return t!==n&&(n[4]=t[4],n[5]=t[5],n[6]=t[6],n[7]=t[7],n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15]),n[0]=d*c-E*a,n[1]=g*c-A*a,n[2]=y*c-P*a,n[3]=w*c-z*a,n[8]=d*a+E*c,n[9]=g*a+A*c,n[10]=y*a+P*c,n[11]=w*a+z*c,n}function k0(n,t){return n[0]=t[0],n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=t[1],n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=t[2],n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function P0(n,t,i){var a,c,d,g=i[0],y=i[1],w=i[2],E=Math.hypot(g,y,w);return E<Jf?null:(g*=E=1/E,y*=E,w*=E,a=Math.sin(t),c=Math.cos(t),n[0]=g*g*(d=1-c)+c,n[1]=y*g*d+w*a,n[2]=w*g*d-y*a,n[3]=0,n[4]=g*y*d-w*a,n[5]=y*y*d+c,n[6]=w*y*d+g*a,n[7]=0,n[8]=g*w*d+y*a,n[9]=y*w*d-g*a,n[10]=w*w*d+c,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n)}Math.hypot||(Math.hypot=function(){for(var n=0,t=arguments.length;t--;)n+=arguments[t]*arguments[t];return Math.sqrt(n)});var uC=kl;function jg(){var n=new Yr(3);return Yr!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0),n}function z0(n){var t=new Yr(3);return t[0]=n[0],t[1]=n[1],t[2]=n[2],t}function Lh(n){return Math.hypot(n[0],n[1],n[2])}function $c(n,t,i){var a=new Yr(3);return a[0]=n,a[1]=t,a[2]=i,a}function Fs(n,t,i){return n[0]=t[0]+i[0],n[1]=t[1]+i[1],n[2]=t[2]+i[2],n}function qg(n,t,i){return n[0]=t[0]-i[0],n[1]=t[1]-i[1],n[2]=t[2]-i[2],n}function L0(n,t,i){return n[0]=t[0]*i[0],n[1]=t[1]*i[1],n[2]=t[2]*i[2],n}function Rh(n,t,i){return n[0]=Math.min(t[0],i[0]),n[1]=Math.min(t[1],i[1]),n[2]=Math.min(t[2],i[2]),n}function Dh(n,t,i){return n[0]=Math.max(t[0],i[0]),n[1]=Math.max(t[1],i[1]),n[2]=Math.max(t[2],i[2]),n}function uo(n,t,i){return n[0]=t[0]*i,n[1]=t[1]*i,n[2]=t[2]*i,n}function Oh(n,t,i,a){return n[0]=t[0]+i[0]*a,n[1]=t[1]+i[1]*a,n[2]=t[2]+i[2]*a,n}function Lr(n,t){var i=t[0],a=t[1],c=t[2],d=i*i+a*a+c*c;return d>0&&(d=1/Math.sqrt(d)),n[0]=t[0]*d,n[1]=t[1]*d,n[2]=t[2]*d,n}function So(n,t){return n[0]*t[0]+n[1]*t[1]+n[2]*t[2]}function $g(n,t,i){var a=t[0],c=t[1],d=t[2],g=i[0],y=i[1],w=i[2];return n[0]=c*w-d*y,n[1]=d*g-a*w,n[2]=a*y-c*g,n}function Di(n,t,i){var a=t[0],c=t[1],d=t[2],g=i[3]*a+i[7]*c+i[11]*d+i[15];return n[0]=(i[0]*a+i[4]*c+i[8]*d+i[12])/(g=g||1),n[1]=(i[1]*a+i[5]*c+i[9]*d+i[13])/g,n[2]=(i[2]*a+i[6]*c+i[10]*d+i[14])/g,n}function R0(n,t,i){var a=i[0],c=i[1],d=i[2],g=t[0],y=t[1],w=t[2],E=c*w-d*y,A=d*g-a*w,P=a*y-c*g,z=c*P-d*A,B=d*E-a*P,F=a*A-c*E,q=2*i[3];return A*=q,P*=q,B*=2,F*=2,n[0]=g+(E*=q)+(z*=2),n[1]=y+A+B,n[2]=w+P+F,n}var Bh,Zo=qg,hC=L0,dC=Lh;function D0(n,t,i){return n[0]=t[0]*i,n[1]=t[1]*i,n[2]=t[2]*i,n[3]=t[3]*i,n}function O0(n,t){var i=t[0],a=t[1],c=t[2],d=t[3],g=i*i+a*a+c*c+d*d;return g>0&&(g=1/Math.sqrt(g)),n[0]=i*g,n[1]=a*g,n[2]=c*g,n[3]=d*g,n}function zl(n,t,i){var a=t[0],c=t[1],d=t[2],g=t[3];return n[0]=i[0]*a+i[4]*c+i[8]*d+i[12]*g,n[1]=i[1]*a+i[5]*c+i[9]*d+i[13]*g,n[2]=i[2]*a+i[6]*c+i[10]*d+i[14]*g,n[3]=i[3]*a+i[7]*c+i[11]*d+i[15]*g,n}function B0(){var n=new Yr(4);return Yr!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0),n[3]=1,n}function F0(n){return n[0]=0,n[1]=0,n[2]=0,n[3]=1,n}function N0(n,t,i){i*=.5;var a=t[0],c=t[1],d=t[2],g=t[3],y=Math.sin(i),w=Math.cos(i);return n[0]=a*w+g*y,n[1]=c*w+d*y,n[2]=d*w-c*y,n[3]=g*w-a*y,n}function V0(n,t,i){i*=.5;var a=t[0],c=t[1],d=t[2],g=t[3],y=Math.sin(i),w=Math.cos(i);return n[0]=a*w-d*y,n[1]=c*w+g*y,n[2]=d*w+a*y,n[3]=g*w-c*y,n}jg(),Bh=new Yr(4),Yr!=Float32Array&&(Bh[0]=0,Bh[1]=0,Bh[2]=0,Bh[3]=0);var fC=O0;jg(),$c(1,0,0),$c(0,1,0),B0(),B0(),M0();class Gg{constructor(t,i){this.pos=t,this.dir=i}intersectsPlane(t,i,a){const c=So(i,this.dir);if(Math.abs(c)<1e-6)return!1;const d=((t[0]-this.pos[0])*i[0]+(t[1]-this.pos[1])*i[1]+(t[2]-this.pos[2])*i[2])/c;return a[0]=this.pos[0]+this.dir[0]*d,a[1]=this.pos[1]+this.dir[1]*d,a[2]=this.pos[2]+this.dir[2]*d,!0}closestPointOnSphere(t,i,a){if(function(B,F){var q=B[0],W=B[1],le=B[2],_e=F[0],ae=F[1],de=F[2];return Math.abs(q-_e)<=Jf*Math.max(1,Math.abs(q),Math.abs(_e))&&Math.abs(W-ae)<=Jf*Math.max(1,Math.abs(W),Math.abs(ae))&&Math.abs(le-de)<=Jf*Math.max(1,Math.abs(le),Math.abs(de))}(this.pos,t)||i===0)return a[0]=a[1]=a[2]=0,!1;const[c,d,g]=this.dir,y=this.pos[0]-t[0],w=this.pos[1]-t[1],E=this.pos[2]-t[2],A=c*c+d*d+g*g,P=2*(y*c+w*d+E*g),z=P*P-4*A*(y*y+w*w+E*E-i*i);if(z<0){const B=Math.max(-P/2,0),F=y+c*B,q=w+d*B,W=E+g*B,le=Math.hypot(F,q,W);return a[0]=F*i/le,a[1]=q*i/le,a[2]=W*i/le,!1}{const B=(-P-Math.sqrt(z))/(2*A);if(B<0){const F=Math.hypot(y,w,E);return a[0]=y*i/F,a[1]=w*i/F,a[2]=E*i/F,!1}return a[0]=y+c*B,a[1]=w+d*B,a[2]=E+g*B,!0}}}class Zg{constructor(t,i,a,c,d){this.TL=t,this.TR=i,this.BR=a,this.BL=c,this.horizon=d}static fromInvProjectionMatrix(t,i,a){const c=[-1,1,1],d=[1,1,1],g=[1,-1,1],y=[-1,-1,1],w=Di(c,c,t),E=Di(d,d,t),A=Di(g,g,t),P=Di(y,y,t);return new Zg(w,E,A,P,i/a)}}class Wg{constructor(t,i){this.points=t,this.planes=i}static fromInvProjectionMatrix(t,i,a,c){const d=Math.pow(2,a),g=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(w=>{const E=zl([],w,t),A=1/E[3]/i*d;return function(P,z,B){return P[0]=z[0]*B[0],P[1]=z[1]*B[1],P[2]=z[2]*B[2],P[3]=z[3]*B[3],P}(E,E,[A,A,c?1/E[3]:A,A])}),y=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(w=>{const E=Lr([],$g([],Zo([],g[w[0]],g[w[1]]),Zo([],g[w[2]],g[w[1]]))),A=-So(E,g[w[1]]);return E.concat(A)});return new Wg(g,y)}}class Rr{static fromPoints(t){const i=[1/0,1/0,1/0],a=[-1/0,-1/0,-1/0];for(const c of t)Rh(i,i,c),Dh(a,a,c);return new Rr(i,a)}static applyTransform(t,i){const a=t.getCorners();for(let c=0;c<a.length;++c)Di(a[c],a[c],i);return Rr.fromPoints(a)}constructor(t,i){this.min=t,this.max=i,this.center=uo([],Fs([],this.min,this.max),.5)}quadrant(t){const i=[t%2==0,t<2],a=z0(this.min),c=z0(this.max);for(let d=0;d<i.length;d++)a[d]=i[d]?this.min[d]:this.center[d],c[d]=i[d]?this.center[d]:this.max[d];return c[2]=this.max[2],new Rr(a,c)}distanceX(t){return Math.max(Math.min(this.max[0],t[0]),this.min[0])-t[0]}distanceY(t){return Math.max(Math.min(this.max[1],t[1]),this.min[1])-t[1]}distanceZ(t){return Math.max(Math.min(this.max[2],t[2]),this.min[2])-t[2]}getCorners(){const t=this.min,i=this.max;return[[t[0],t[1],t[2]],[i[0],t[1],t[2]],[i[0],i[1],t[2]],[t[0],i[1],t[2]],[t[0],t[1],i[2]],[i[0],t[1],i[2]],[i[0],i[1],i[2]],[t[0],i[1],i[2]]]}intersects(t){const i=this.getCorners();let a=!0;for(let c=0;c<t.planes.length;c++){const d=t.planes[c];let g=0;for(let y=0;y<i.length;y++)g+=So(d,i[y])+d[3]>=0;if(g===0)return 0;g!==i.length&&(a=!1)}if(a)return 2;for(let c=0;c<3;c++){let d=Number.MAX_VALUE,g=-Number.MAX_VALUE;for(let y=0;y<t.points.length;y++){const w=t.points[y][c]-this.min[c];d=Math.min(d,w),g=Math.max(g,w)}if(g<0||d>this.max[c]-this.min[c])return 0}return 1}}function U0(n,t,i,a,c,d,g,y,w){if(d&&n.queryGeometry.isAboveHorizon)return!1;d&&(w*=n.pixelToTileUnitsFactor);const E=n.tileID.canonical,A=i.projection.upVectorScale(E,i.center.lat,i.worldSize).metersToTile;for(const P of t)for(const z of P){const B=z.add(y),F=c&&i.elevation?i.elevation.exaggeration()*c.getElevationAt(B.x,B.y,!0):0,q=i.projection.projectTilePoint(B.x,B.y,E);if(F>0){const ae=i.projection.upVector(E,B.x,B.y);q.x+=ae[0]*A*F,q.y+=ae[1]*A*F,q.z+=ae[2]*A*F}const W=d?B:pC(q.x,q.y,q.z,a),le=d?n.tilespaceRays.map(ae=>gC(ae,F)):n.queryGeometry.screenGeometry,_e=zl([],[q.x,q.y,q.z,1],a);if(!g&&d?w*=_e[3]/i.cameraToCenterDistance:g&&!d&&(w*=i.cameraToCenterDistance/_e[3]),d){const ae=mr((z.y/_n+E.y)/(1<<E.z));w/=i.projection.pixelsPerMeter(ae,1)/To(1,ae)}if(rC(le,W,w))return!0}return!1}function pC(n,t,i,a){const c=zl([],[n,t,i,1],a);return new ce(c[0]/c[3],c[1]/c[3])}const j0=$c(0,0,0),mC=$c(0,0,1);function gC(n,t){const i=jg();return j0[2]=t,n.intersectsPlane(j0,mC,i),new ce(i[0],i[1])}class q0 extends Bg{}function $0(n,{width:t,height:i},a,c){if(c){if(c instanceof Uint8ClampedArray)c=new Uint8Array(c.buffer);else if(c.length!==t*i*a)throw new RangeError("mismatched image size")}else c=new Uint8Array(t*i*a);return n.width=t,n.height=i,n.data=c,n}function G0(n,t,i){const{width:a,height:c}=t;a===n.width&&c===n.height||(Hg(n,t,{x:0,y:0},{x:0,y:0},{width:Math.min(n.width,a),height:Math.min(n.height,c)},i),n.width=a,n.height=c,n.data=t.data)}function Hg(n,t,i,a,c,d){if(c.width===0||c.height===0)return t;if(c.width>n.width||c.height>n.height||i.x>n.width-c.width||i.y>n.height-c.height)throw new RangeError("out of range source coordinates for image copy");if(c.width>t.width||c.height>t.height||a.x>t.width-c.width||a.y>t.height-c.height)throw new RangeError("out of range destination coordinates for image copy");const g=n.data,y=t.data;for(let w=0;w<c.height;w++){const E=((i.y+w)*n.width+i.x)*d,A=((a.y+w)*t.width+a.x)*d;for(let P=0;P<c.width*d;P++)y[A+P]=g[E+P]}return t}Zt(q0,"HeatmapBucket",{omit:["layers"]});class Ns{constructor(t,i){$0(this,t,1,i)}resize(t){G0(this,new Ns(t),1)}clone(){return new Ns({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,i,a,c,d){Hg(t,i,a,c,d,1)}}class Qr{constructor(t,i){$0(this,t,4,i)}resize(t){G0(this,new Qr(t),4)}replace(t,i){i?this.data.set(t):this.data=t instanceof Uint8ClampedArray?new Uint8Array(t.buffer):t}clone(){return new Qr({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,i,a,c,d){Hg(t,i,a,c,d,4)}}Zt(Ns,"AlphaImage"),Zt(Qr,"RGBAImage");var _C={paint:new ln({"heatmap-radius":new He(tt.paint_heatmap["heatmap-radius"]),"heatmap-weight":new He(tt.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new De(tt.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Qt(tt.paint_heatmap["heatmap-color"]),"heatmap-opacity":new De(tt.paint_heatmap["heatmap-opacity"])})};function Xg(n){const t={},i=n.resolution||256,a=n.clips?n.clips.length:1,c=n.image||new Qr({width:i,height:a}),d=(g,y,w)=>{t[n.evaluationKey]=w;const E=n.expression.evaluate(t);c.data[g+y+0]=Math.floor(255*E.r/E.a),c.data[g+y+1]=Math.floor(255*E.g/E.a),c.data[g+y+2]=Math.floor(255*E.b/E.a),c.data[g+y+3]=Math.floor(255*E.a)};if(n.clips)for(let g=0,y=0;g<a;++g,y+=4*i)for(let w=0,E=0;w<i;w++,E+=4){const A=w/(i-1),{start:P,end:z}=n.clips[g];d(y,E,P*(1-A)+z*A)}else for(let g=0,y=0;g<i;g++,y+=4)d(0,y,g/(i-1));return c}var yC={paint:new ln({"hillshade-illumination-direction":new De(tt.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new De(tt.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new De(tt.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new De(tt.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new De(tt.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new De(tt.paint_hillshade["hillshade-accent-color"])})};const vC=Gt([{name:"a_pos",components:2,type:"Int16"}],4),{members:xC}=vC;var Fh={exports:{}};function tp(n,t,i){i=i||2;var a,c,d,g,y,w,E,A=t&&t.length,P=A?t[0]*i:n.length,z=Z0(n,0,P,i,!0),B=[];if(!z||z.next===z.prev)return B;if(A&&(z=function(q,W,le,_e){var ae,de,we,ye=[];for(ae=0,de=W.length;ae<de;ae++)(we=Z0(q,W[ae]*_e,ae<de-1?W[ae+1]*_e:q.length,_e,!1))===we.next&&(we.steiner=!0),ye.push(MC(we));for(ye.sort(SC),ae=0;ae<ye.length;ae++)le=CC(ye[ae],le);return le}(n,t,z,i)),n.length>80*i){a=d=n[0],c=g=n[1];for(var F=i;F<P;F+=i)(y=n[F])<a&&(a=y),(w=n[F+1])<c&&(c=w),y>d&&(d=y),w>g&&(g=w);E=(E=Math.max(d-a,g-c))!==0?32767/E:0}return Nh(z,B,i,a,c,E,0),B}function Z0(n,t,i,a,c){var d,g;if(c===Qg(n,t,i,a)>0)for(d=t;d<i;d+=a)g=X0(d,n[d],n[d+1],g);else for(d=i-a;d>=t;d-=a)g=X0(d,n[d],n[d+1],g);return g&&np(g,g.next)&&(Uh(g),g=g.next),g}function Ll(n,t){if(!n)return n;t||(t=n);var i,a=n;do if(i=!1,a.steiner||!np(a,a.next)&&Fi(a.prev,a,a.next)!==0)a=a.next;else{if(Uh(a),(a=t=a.prev)===a.next)break;i=!0}while(i||a!==t);return t}function Nh(n,t,i,a,c,d,g){if(n){!g&&d&&function(A,P,z,B){var F=A;do F.z===0&&(F.z=Kg(F.x,F.y,P,z,B)),F.prevZ=F.prev,F.nextZ=F.next,F=F.next;while(F!==A);F.prevZ.nextZ=null,F.prevZ=null,function(q){var W,le,_e,ae,de,we,ye,$e,qe=1;do{for(le=q,q=null,de=null,we=0;le;){for(we++,_e=le,ye=0,W=0;W<qe&&(ye++,_e=_e.nextZ);W++);for($e=qe;ye>0||$e>0&&_e;)ye!==0&&($e===0||!_e||le.z<=_e.z)?(ae=le,le=le.nextZ,ye--):(ae=_e,_e=_e.nextZ,$e--),de?de.nextZ=ae:q=ae,ae.prevZ=de,de=ae;le=_e}de.nextZ=null,qe*=2}while(we>1)}(F)}(n,a,c,d);for(var y,w,E=n;n.prev!==n.next;)if(y=n.prev,w=n.next,d?wC(n,a,c,d):bC(n))t.push(y.i/i|0),t.push(n.i/i|0),t.push(w.i/i|0),Uh(n),n=w.next,E=w.next;else if((n=w)===E){g?g===1?Nh(n=EC(Ll(n),t,i),t,i,a,c,d,2):g===2&&TC(n,t,i,a,c,d):Nh(Ll(n),t,i,a,c,d,1);break}}}function bC(n){var t=n.prev,i=n,a=n.next;if(Fi(t,i,a)>=0)return!1;for(var c=t.x,d=i.x,g=a.x,y=t.y,w=i.y,E=a.y,A=c<d?c<g?c:g:d<g?d:g,P=y<w?y<E?y:E:w<E?w:E,z=c>d?c>g?c:g:d>g?d:g,B=y>w?y>E?y:E:w>E?w:E,F=a.next;F!==t;){if(F.x>=A&&F.x<=z&&F.y>=P&&F.y<=B&&Gc(c,y,d,w,g,E,F.x,F.y)&&Fi(F.prev,F,F.next)>=0)return!1;F=F.next}return!0}function wC(n,t,i,a){var c=n.prev,d=n,g=n.next;if(Fi(c,d,g)>=0)return!1;for(var y=c.x,w=d.x,E=g.x,A=c.y,P=d.y,z=g.y,B=y<w?y<E?y:E:w<E?w:E,F=A<P?A<z?A:z:P<z?P:z,q=y>w?y>E?y:E:w>E?w:E,W=A>P?A>z?A:z:P>z?P:z,le=Kg(B,F,t,i,a),_e=Kg(q,W,t,i,a),ae=n.prevZ,de=n.nextZ;ae&&ae.z>=le&&de&&de.z<=_e;){if(ae.x>=B&&ae.x<=q&&ae.y>=F&&ae.y<=W&&ae!==c&&ae!==g&&Gc(y,A,w,P,E,z,ae.x,ae.y)&&Fi(ae.prev,ae,ae.next)>=0||(ae=ae.prevZ,de.x>=B&&de.x<=q&&de.y>=F&&de.y<=W&&de!==c&&de!==g&&Gc(y,A,w,P,E,z,de.x,de.y)&&Fi(de.prev,de,de.next)>=0))return!1;de=de.nextZ}for(;ae&&ae.z>=le;){if(ae.x>=B&&ae.x<=q&&ae.y>=F&&ae.y<=W&&ae!==c&&ae!==g&&Gc(y,A,w,P,E,z,ae.x,ae.y)&&Fi(ae.prev,ae,ae.next)>=0)return!1;ae=ae.prevZ}for(;de&&de.z<=_e;){if(de.x>=B&&de.x<=q&&de.y>=F&&de.y<=W&&de!==c&&de!==g&&Gc(y,A,w,P,E,z,de.x,de.y)&&Fi(de.prev,de,de.next)>=0)return!1;de=de.nextZ}return!0}function EC(n,t,i){var a=n;do{var c=a.prev,d=a.next.next;!np(c,d)&&W0(c,a,a.next,d)&&Vh(c,d)&&Vh(d,c)&&(t.push(c.i/i|0),t.push(a.i/i|0),t.push(d.i/i|0),Uh(a),Uh(a.next),a=n=d),a=a.next}while(a!==n);return Ll(a)}function TC(n,t,i,a,c,d){var g=n;do{for(var y=g.next.next;y!==g.prev;){if(g.i!==y.i&&IC(g,y)){var w=H0(g,y);return g=Ll(g,g.next),w=Ll(w,w.next),Nh(g,t,i,a,c,d,0),void Nh(w,t,i,a,c,d,0)}y=y.next}g=g.next}while(g!==n)}function SC(n,t){return n.x-t.x}function CC(n,t){var i=function(c,d){var g,y=d,w=c.x,E=c.y,A=-1/0;do{if(E<=y.y&&E>=y.next.y&&y.next.y!==y.y){var P=y.x+(E-y.y)*(y.next.x-y.x)/(y.next.y-y.y);if(P<=w&&P>A&&(A=P,g=y.x<y.next.x?y:y.next,P===w))return g}y=y.next}while(y!==d);if(!g)return null;var z,B=g,F=g.x,q=g.y,W=1/0;y=g;do w>=y.x&&y.x>=F&&w!==y.x&&Gc(E<q?w:A,E,F,q,E<q?A:w,E,y.x,y.y)&&(z=Math.abs(E-y.y)/(w-y.x),Vh(y,c)&&(z<W||z===W&&(y.x>g.x||y.x===g.x&&AC(g,y)))&&(g=y,W=z)),y=y.next;while(y!==B);return g}(n,t);if(!i)return t;var a=H0(i,n);return Ll(a,a.next),Ll(i,i.next)}function AC(n,t){return Fi(n.prev,n,t.prev)<0&&Fi(t.next,n,n.next)<0}function Kg(n,t,i,a,c){return(n=1431655765&((n=858993459&((n=252645135&((n=16711935&((n=(n-i)*c|0)|n<<8))|n<<4))|n<<2))|n<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-a)*c|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function MC(n){var t=n,i=n;do(t.x<i.x||t.x===i.x&&t.y<i.y)&&(i=t),t=t.next;while(t!==n);return i}function Gc(n,t,i,a,c,d,g,y){return(c-g)*(t-y)>=(n-g)*(d-y)&&(n-g)*(a-y)>=(i-g)*(t-y)&&(i-g)*(d-y)>=(c-g)*(a-y)}function IC(n,t){return n.next.i!==t.i&&n.prev.i!==t.i&&!function(i,a){var c=i;do{if(c.i!==i.i&&c.next.i!==i.i&&c.i!==a.i&&c.next.i!==a.i&&W0(c,c.next,i,a))return!0;c=c.next}while(c!==i);return!1}(n,t)&&(Vh(n,t)&&Vh(t,n)&&function(i,a){var c=i,d=!1,g=(i.x+a.x)/2,y=(i.y+a.y)/2;do c.y>y!=c.next.y>y&&c.next.y!==c.y&&g<(c.next.x-c.x)*(y-c.y)/(c.next.y-c.y)+c.x&&(d=!d),c=c.next;while(c!==i);return d}(n,t)&&(Fi(n.prev,n,t.prev)||Fi(n,t.prev,t))||np(n,t)&&Fi(n.prev,n,n.next)>0&&Fi(t.prev,t,t.next)>0)}function Fi(n,t,i){return(t.y-n.y)*(i.x-t.x)-(t.x-n.x)*(i.y-t.y)}function np(n,t){return n.x===t.x&&n.y===t.y}function W0(n,t,i,a){var c=rp(Fi(n,t,i)),d=rp(Fi(n,t,a)),g=rp(Fi(i,a,n)),y=rp(Fi(i,a,t));return c!==d&&g!==y||!(c!==0||!ip(n,i,t))||!(d!==0||!ip(n,a,t))||!(g!==0||!ip(i,n,a))||!(y!==0||!ip(i,t,a))}function ip(n,t,i){return t.x<=Math.max(n.x,i.x)&&t.x>=Math.min(n.x,i.x)&&t.y<=Math.max(n.y,i.y)&&t.y>=Math.min(n.y,i.y)}function rp(n){return n>0?1:n<0?-1:0}function Vh(n,t){return Fi(n.prev,n,n.next)<0?Fi(n,t,n.next)>=0&&Fi(n,n.prev,t)>=0:Fi(n,t,n.prev)<0||Fi(n,n.next,t)<0}function H0(n,t){var i=new Yg(n.i,n.x,n.y),a=new Yg(t.i,t.x,t.y),c=n.next,d=t.prev;return n.next=t,t.prev=n,i.next=c,c.prev=i,a.next=i,i.prev=a,d.next=a,a.prev=d,a}function X0(n,t,i,a){var c=new Yg(n,t,i);return a?(c.next=a.next,c.prev=a,a.next.prev=c,a.next=c):(c.prev=c,c.next=c),c}function Uh(n){n.next.prev=n.prev,n.prev.next=n.next,n.prevZ&&(n.prevZ.nextZ=n.nextZ),n.nextZ&&(n.nextZ.prevZ=n.prevZ)}function Yg(n,t,i){this.i=n,this.x=t,this.y=i,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Qg(n,t,i,a){for(var c=0,d=t,g=i-a;d<i;d+=a)c+=(n[g]-n[d])*(n[d+1]+n[g+1]),g=d;return c}function kC(n,t,i,a,c){K0(n,t,i||0,a||n.length-1,c||PC)}function K0(n,t,i,a,c){for(;a>i;){if(a-i>600){var d=a-i+1,g=t-i+1,y=Math.log(d),w=.5*Math.exp(2*y/3),E=.5*Math.sqrt(y*w*(d-w)/d)*(g-d/2<0?-1:1);K0(n,t,Math.max(i,Math.floor(t-g*w/d+E)),Math.min(a,Math.floor(t+(d-g)*w/d+E)),c)}var A=n[t],P=i,z=a;for(jh(n,i,t),c(n[a],A)>0&&jh(n,i,a);P<z;){for(jh(n,P,z),P++,z--;c(n[P],A)<0;)P++;for(;c(n[z],A)>0;)z--}c(n[i],A)===0?jh(n,i,z):jh(n,++z,a),z<=t&&(i=z+1),t<=z&&(a=z-1)}}function jh(n,t,i){var a=n[t];n[t]=n[i],n[i]=a}function PC(n,t){return n<t?-1:n>t?1:0}function Jg(n,t){const i=n.length;if(i<=1)return[n];const a=[];let c,d;for(let g=0;g<i;g++){const y=Fe(n[g]);y!==0&&(n[g].area=Math.abs(y),d===void 0&&(d=y<0),d===y<0?(c&&a.push(c),c=[n[g]]):c.push(n[g]))}if(c&&a.push(c),t>1)for(let g=0;g<a.length;g++)a[g].length<=t||(kC(a[g],t,1,a[g].length-1,zC),a[g]=a[g].slice(0,t));return a}function zC(n,t){return t.area-n.area}function e_(n,t,i){const a=i.patternDependencies;let c=!1;for(const d of t){const g=d.paint.get(`${n}-pattern`);g.isConstant()||(c=!0);const y=g.constantOr(null);y&&(c=!0,a[y]=!0)}return c}function t_(n,t,i,a,c){const d=c.patternDependencies;for(const g of t){const y=g.paint.get(`${n}-pattern`).value;if(y.kind!=="constant"){let w=y.evaluate({zoom:a},i,{},c.availableImages);w=w&&w.name?w.name:w,d[w]=!0,i.patterns[g.id]=w}}return i}Fh.exports=tp,Fh.exports.default=tp,tp.deviation=function(n,t,i,a){var c=t&&t.length,d=Math.abs(Qg(n,0,c?t[0]*i:n.length,i));if(c)for(var g=0,y=t.length;g<y;g++)d-=Math.abs(Qg(n,t[g]*i,g<y-1?t[g+1]*i:n.length,i));var w=0;for(g=0;g<a.length;g+=3){var E=a[g]*i,A=a[g+1]*i,P=a[g+2]*i;w+=Math.abs((n[E]-n[P])*(n[A+1]-n[E+1])-(n[E]-n[A])*(n[P+1]-n[E+1]))}return d===0&&w===0?0:Math.abs((w-d)/d)},tp.flatten=function(n){for(var t=n[0][0].length,i={vertices:[],holes:[],dimensions:t},a=0,c=0;c<n.length;c++){for(var d=0;d<n[c].length;d++)for(var g=0;g<t;g++)i.vertices.push(n[c][d][g]);c>0&&i.holes.push(a+=n[c-1].length)}return i};class op{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(i=>i.id),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Wn,this.indexArray=new pr,this.indexArray2=new Eo,this.programConfigurations=new Al(t.layers,t.zoom),this.segments=new Wi,this.segments2=new Wi,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.projection=t.projection}populate(t,i,a,c){this.hasPattern=e_("fill",this.layers,i);const d=this.layers[0].layout.get("fill-sort-key"),g=[];for(const{feature:y,id:w,index:E,sourceLayerIndex:A}of t){const P=this.layers[0]._featureFilter.needGeometry,z=Ml(y,P);if(!this.layers[0]._featureFilter.filter(new Le(this.zoom),z,a))continue;const B=d?d.evaluate(z,{},a,i.availableImages):void 0,F={id:w,properties:y.properties,type:y.type,sourceLayerIndex:A,index:E,geometry:P?z.geometry:Bs(y,a,c),patterns:{},sortKey:B};g.push(F)}d&&g.sort((y,w)=>y.sortKey-w.sortKey);for(const y of g){const{geometry:w,index:E,sourceLayerIndex:A}=y;if(this.hasPattern){const P=t_("fill",this.layers,y,this.zoom,i);this.patternFeatures.push(P)}else this.addFeature(y,w,E,a,{},i.availableImages);i.featureIndex.insert(t[E].feature,w,E,A,this.index)}}update(t,i,a,c){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,i,this.stateDependentLayers,a,c)}addFeatures(t,i,a,c,d){for(const g of this.patternFeatures)this.addFeature(g,g.geometry,g.index,i,a,c)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,xC),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.indexBuffer2=t.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(t,i,a,c,d,g=[]){for(const y of Jg(i,500)){let w=0;for(const F of y)w+=F.length;const E=this.segments.prepareSegment(w,this.layoutVertexArray,this.indexArray),A=E.vertexLength,P=[],z=[];for(const F of y){if(F.length===0)continue;F!==y[0]&&z.push(P.length/2);const q=this.segments2.prepareSegment(F.length,this.layoutVertexArray,this.indexArray2),W=q.vertexLength;this.layoutVertexArray.emplaceBack(F[0].x,F[0].y),this.indexArray2.emplaceBack(W+F.length-1,W),P.push(F[0].x),P.push(F[0].y);for(let le=1;le<F.length;le++)this.layoutVertexArray.emplaceBack(F[le].x,F[le].y),this.indexArray2.emplaceBack(W+le-1,W+le),P.push(F[le].x),P.push(F[le].y);q.vertexLength+=F.length,q.primitiveLength+=F.length}const B=Fh.exports(P,z);for(let F=0;F<B.length;F+=3)this.indexArray.emplaceBack(A+B[F],A+B[F+1],A+B[F+2]);E.vertexLength+=w,E.primitiveLength+=B.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,a,d,g,c)}}Zt(op,"FillBucket",{omit:["layers","patternFeatures"]});const LC=new ln({"fill-sort-key":new He(tt.layout_fill["fill-sort-key"])});var RC={paint:new ln({"fill-antialias":new De(tt.paint_fill["fill-antialias"]),"fill-opacity":new He(tt.paint_fill["fill-opacity"]),"fill-color":new He(tt.paint_fill["fill-color"]),"fill-outline-color":new He(tt.paint_fill["fill-outline-color"]),"fill-translate":new De(tt.paint_fill["fill-translate"]),"fill-translate-anchor":new De(tt.paint_fill["fill-translate-anchor"]),"fill-pattern":new He(tt.paint_fill["fill-pattern"])}),layout:LC};const DC=Gt([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),OC=Gt([{name:"a_centroid_pos",components:2,type:"Uint16"}]),BC=Gt([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:FC}=DC;var sp={},NC=ce,Y0=Zc;function Zc(n,t,i,a,c){this.properties={},this.extent=i,this.type=0,this._pbf=n,this._geometry=-1,this._keys=a,this._values=c,n.readFields(VC,this,t)}function VC(n,t,i){n==1?t.id=i.readVarint():n==2?function(a,c){for(var d=a.readVarint()+a.pos;a.pos<d;){var g=c._keys[a.readVarint()],y=c._values[a.readVarint()];c.properties[g]=y}}(i,t):n==3?t.type=i.readVarint():n==4&&(t._geometry=i.pos)}function UC(n){for(var t,i,a=0,c=0,d=n.length,g=d-1;c<d;g=c++)a+=((i=n[g]).x-(t=n[c]).x)*(t.y+i.y);return a}Zc.types=["Unknown","Point","LineString","Polygon"],Zc.prototype.loadGeometry=function(){var n=this._pbf;n.pos=this._geometry;for(var t,i=n.readVarint()+n.pos,a=1,c=0,d=0,g=0,y=[];n.pos<i;){if(c<=0){var w=n.readVarint();a=7&w,c=w>>3}if(c--,a===1||a===2)d+=n.readSVarint(),g+=n.readSVarint(),a===1&&(t&&y.push(t),t=[]),t.push(new NC(d,g));else{if(a!==7)throw new Error("unknown command "+a);t&&t.push(t[0].clone())}}return t&&y.push(t),y},Zc.prototype.bbox=function(){var n=this._pbf;n.pos=this._geometry;for(var t=n.readVarint()+n.pos,i=1,a=0,c=0,d=0,g=1/0,y=-1/0,w=1/0,E=-1/0;n.pos<t;){if(a<=0){var A=n.readVarint();i=7&A,a=A>>3}if(a--,i===1||i===2)(c+=n.readSVarint())<g&&(g=c),c>y&&(y=c),(d+=n.readSVarint())<w&&(w=d),d>E&&(E=d);else if(i!==7)throw new Error("unknown command "+i)}return[g,w,y,E]},Zc.prototype.toGeoJSON=function(n,t,i){var a,c,d=this.extent*Math.pow(2,i),g=this.extent*n,y=this.extent*t,w=this.loadGeometry(),E=Zc.types[this.type];function A(B){for(var F=0;F<B.length;F++){var q=B[F];B[F]=[360*(q.x+g)/d-180,360/Math.PI*Math.atan(Math.exp((180-360*(q.y+y)/d)*Math.PI/180))-90]}}switch(this.type){case 1:var P=[];for(a=0;a<w.length;a++)P[a]=w[a][0];A(w=P);break;case 2:for(a=0;a<w.length;a++)A(w[a]);break;case 3:for(w=function(B){var F=B.length;if(F<=1)return[B];for(var q,W,le=[],_e=0;_e<F;_e++){var ae=UC(B[_e]);ae!==0&&(W===void 0&&(W=ae<0),W===ae<0?(q&&le.push(q),q=[B[_e]]):q.push(B[_e]))}return q&&le.push(q),le}(w),a=0;a<w.length;a++)for(c=0;c<w[a].length;c++)A(w[a][c])}w.length===1?w=w[0]:E="Multi"+E;var z={type:"Feature",geometry:{type:E,coordinates:w},properties:this.properties};return"id"in this&&(z.id=this.id),z};var jC=Y0,Q0=J0;function J0(n,t){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=n,this._keys=[],this._values=[],this._features=[],n.readFields(qC,this,t),this.length=this._features.length}function qC(n,t,i){n===15?t.version=i.readVarint():n===1?t.name=i.readString():n===5?t.extent=i.readVarint():n===2?t._features.push(i.pos):n===3?t._keys.push(i.readString()):n===4&&t._values.push(function(a){for(var c=null,d=a.readVarint()+a.pos;a.pos<d;){var g=a.readVarint()>>3;c=g===1?a.readString():g===2?a.readFloat():g===3?a.readDouble():g===4?a.readVarint64():g===5?a.readVarint():g===6?a.readSVarint():g===7?a.readBoolean():null}return c}(i))}J0.prototype.feature=function(n){if(n<0||n>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[n];var t=this._pbf.readVarint()+this._pbf.pos;return new jC(this._pbf,t,this.extent,this._keys,this._values)};var $C=Q0;function GC(n,t,i){if(n===3){var a=new $C(i,i.readVarint()+i.pos);a.length&&(t[a.name]=a)}}var n_=sp.VectorTile=function(n,t){this.layers=n.readFields(GC,{},t)},ap=sp.VectorTileFeature=Y0;function lp(n,t,i,a){const c=[],d=a===0?(g,y,w,E,A,P)=>{g.push(new ce(P,w+(P-y)/(E-y)*(A-w)))}:(g,y,w,E,A,P)=>{g.push(new ce(y+(P-w)/(A-w)*(E-y),P))};for(const g of n){const y=[];for(const w of g){if(w.length<=2)continue;const E=[];for(let z=0;z<w.length-1;z++){const B=w[z].x,F=w[z].y,q=w[z+1].x,W=w[z+1].y,le=a===0?B:F,_e=a===0?q:W;le<t?_e>t&&d(E,B,F,q,W,t):le>i?_e<i&&d(E,B,F,q,W,i):E.push(w[z]),_e<t&&le>=t&&d(E,B,F,q,W,t),_e>i&&le<=i&&d(E,B,F,q,W,i)}let A=w[w.length-1];const P=a===0?A.x:A.y;P>=t&&P<=i&&E.push(A),E.length&&(A=E[E.length-1],E[0].x===A.x&&E[0].y===A.y||E.push(E[0]),y.push(E))}y.length&&c.push(y)}return c}sp.VectorTileLayer=Q0;const ZC=ap.types,WC=Math.pow(2,13);function qh(n,t,i,a,c,d,g,y){n.emplaceBack((t<<1)+g,(i<<1)+d,(Math.floor(a*WC)<<1)+c,Math.round(y))}function $h(n,t,i){n.emplaceBack(t.x,t.y,t.z,i[0]*16384,i[1]*16384,i[2]*16384)}class ex{constructor(){this.acc=new ce(0,0),this.polyCount=[]}startRing(t){this.currentPolyCount={edges:0,top:0},this.polyCount.push(this.currentPolyCount),this.min||(this.min=new ce(t.x,t.y),this.max=new ce(t.x,t.y))}append(t,i){this.currentPolyCount.edges++,this.acc._add(t);const a=this.min,c=this.max;t.x<a.x?a.x=t.x:t.x>c.x&&(c.x=t.x),t.y<a.y?a.y=t.y:t.y>c.y&&(c.y=t.y),((t.x===0||t.x===_n)&&t.x===i.x)!=((t.y===0||t.y===_n)&&t.y===i.y)&&this.processBorderOverlap(t,i),i.x<0!=t.x<0&&this.addBorderIntersection(0,$n(i.y,t.y,(0-i.x)/(t.x-i.x))),i.x>_n!=t.x>_n&&this.addBorderIntersection(1,$n(i.y,t.y,(_n-i.x)/(t.x-i.x))),i.y<0!=t.y<0&&this.addBorderIntersection(2,$n(i.x,t.x,(0-i.y)/(t.y-i.y))),i.y>_n!=t.y>_n&&this.addBorderIntersection(3,$n(i.x,t.x,(_n-i.y)/(t.y-i.y)))}addBorderIntersection(t,i){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const a=this.borders[t];i<a[0]&&(a[0]=i),i>a[1]&&(a[1]=i)}processBorderOverlap(t,i){if(t.x===i.x){if(t.y===i.y)return;const a=t.x===0?0:1;this.addBorderIntersection(a,i.y),this.addBorderIntersection(a,t.y)}else{const a=t.y===0?2:3;this.addBorderIntersection(a,i.x),this.addBorderIntersection(a,t.x)}}centroid(){const t=this.polyCount.reduce((i,a)=>i+a.edges,0);return t!==0?this.acc.div(t)._round():new ce(0,0)}span(){return new ce(this.max.x-this.min.x,this.max.y-this.min.y)}intersectsCount(){return this.borders.reduce((t,i)=>t+ +(i[0]!==Number.MAX_VALUE),0)}}class Gh{constructor(t){this.zoom=t.zoom,this.canonical=t.canonical,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(i=>i.id),this.index=t.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=t.projection,this.layoutVertexArray=new ii,this.centroidVertexArray=new l0,this.indexArray=new pr,this.programConfigurations=new Al(t.layers,t.zoom),this.segments=new Wi,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.enableTerrain=t.enableTerrain}populate(t,i,a,c){this.features=[],this.hasPattern=e_("fill-extrusion",this.layers,i),this.featuresOnBorder=[],this.borders=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=function(d){const g=Math.exp(Math.PI*(1-d.y/(1<<d.z)*2));return 80150034*g/(g*g+1)/_n/(1<<d.z)}(a),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter;for(const{feature:d,id:g,index:y,sourceLayerIndex:w}of t){const E=this.layers[0]._featureFilter.needGeometry,A=Ml(d,E);if(!this.layers[0]._featureFilter.filter(new Le(this.zoom),A,a))continue;const P={id:g,sourceLayerIndex:w,index:y,geometry:E?A.geometry:Bs(d,a,c),properties:d.properties,type:d.type,patterns:{}},z=this.layoutVertexArray.length;this.hasPattern?this.features.push(t_("fill-extrusion",this.layers,P,this.zoom,i)):this.addFeature(P,P.geometry,y,a,{},i.availableImages,c),i.featureIndex.insert(d,P.geometry,y,w,this.index,z)}this.sortBorders()}addFeatures(t,i,a,c,d){for(const g of this.features){const{geometry:y}=g;this.addFeature(g,y,g.index,i,a,c,d)}this.sortBorders()}update(t,i,a,c){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,i,this.stateDependentLayers,a,c)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,FC),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=t.createVertexBuffer(this.layoutVertexExtArray,BC.members,!0))),this.programConfigurations.upload(t),this.uploaded=!0}uploadCentroid(t){this.centroidVertexArray.length!==0&&(this.centroidVertexBuffer?this.needsCentroidUpdate&&this.centroidVertexBuffer.updateData(this.centroidVertexArray):this.centroidVertexBuffer=t.createVertexBuffer(this.centroidVertexArray,OC.members,!0),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(t,i,a,c,d,g,y){const w=[new ce(0,0),new ce(_n,_n)],E=y.projection,A=E.name==="globe",P=this.enableTerrain&&!A?new ex:null,z=ZC[t.type]==="Polygon";A&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new gi);const B=Jg(i,500);for(let le=B.length-1;le>=0;le--){const _e=B[le];(_e.length===0||(F=_e[0]).every(ae=>ae.x<=0)||F.every(ae=>ae.x>=_n)||F.every(ae=>ae.y<=0)||F.every(ae=>ae.y>=_n))&&B.splice(le,1)}var F;let q;if(A)q=ax(B,w,c);else{q=[];for(const le of B)q.push({polygon:le,bounds:w})}const W=z?this.edgeRadius:0;for(const{polygon:le,bounds:_e}of q){let ae=0,de=0;for(const ye of le)z&&!ye[0].equals(ye[ye.length-1])&&ye.push(ye[0]),de+=z?ye.length-1:ye.length;const we=this.segments.prepareSegment((z?5:4)*de,this.layoutVertexArray,this.indexArray);if(z){const ye=[],$e=[];ae=we.vertexLength;for(const it of le){let St,Ke;it.length&&it!==le[0]&&$e.push(ye.length/2),St=it[1].sub(it[0])._perp()._unit();for(let ut=1;ut<it.length;ut++){const dt=it[ut],vt=it[ut===it.length-1?1:ut+1];let{x:Ct,y:Qe}=dt;if(W){Ke=vt.sub(dt)._perp()._unit();const Dt=St.add(Ke)._unit(),dn=W*Math.min(4,1/(St.x*Dt.x+St.y*Dt.y));Ct+=dn*Dt.x,Qe+=dn*Dt.y,St=Ke}qh(this.layoutVertexArray,Ct,Qe,0,0,1,1,0),we.vertexLength++,ye.push(dt.x,dt.y),A&&$h(this.layoutVertexExtArray,E.projectTilePoint(Ct,Qe,c),E.upVector(c,Ct,Qe))}}const qe=Fh.exports(ye,$e);for(let it=0;it<qe.length;it+=3)this.indexArray.emplaceBack(ae+qe[it],ae+qe[it+2],ae+qe[it+1]),we.primitiveLength++}for(const ye of le){P&&ye.length&&P.startRing(ye[0]);let $e,qe,it,St=ye.length>4&&rx(ye[ye.length-2],ye[0],ye[1]),Ke=W?HC(ye[ye.length-2],ye[0],ye[1],W):0;qe=ye[1].sub(ye[0])._perp()._unit();let ut=!0;for(let dt=1,vt=0;dt<ye.length;dt++){let Ct=ye[dt-1],Qe=ye[dt];const Dt=ye[dt===ye.length-1?1:dt+1];if(P&&z&&P.currentPolyCount.top++,ix(Qe,Ct,_e)){W&&(qe=Dt.sub(Qe)._perp()._unit(),ut=!ut);continue}P&&P.append(Qe,Ct);const dn=Qe.sub(Ct)._perp(),Vt=dn.x/(Math.abs(dn.x)+Math.abs(dn.y)),en=dn.y>0?1:0,Ot=Ct.dist(Qe);if(vt+Ot>32768&&(vt=0),W){it=Dt.sub(Qe)._perp()._unit();let Mn=nx(Ct,Qe,Dt,tx(qe,it),W);isNaN(Mn)&&(Mn=0);const gn=Qe.sub(Ct)._unit();Ct=Ct.add(gn.mult(Ke))._round(),Qe=Qe.add(gn.mult(-Mn))._round(),Ke=Mn,qe=it}const pn=we.vertexLength,Dn=ye.length>4&&rx(Ct,Qe,Dt);let zn=ox(vt,St,ut);if(qh(this.layoutVertexArray,Ct.x,Ct.y,Vt,en,0,0,zn),qh(this.layoutVertexArray,Ct.x,Ct.y,Vt,en,0,1,zn),vt+=Ot,zn=ox(vt,Dn,!ut),St=Dn,qh(this.layoutVertexArray,Qe.x,Qe.y,Vt,en,0,0,zn),qh(this.layoutVertexArray,Qe.x,Qe.y,Vt,en,0,1,zn),we.vertexLength+=4,this.indexArray.emplaceBack(pn+0,pn+1,pn+2),this.indexArray.emplaceBack(pn+1,pn+3,pn+2),we.primitiveLength+=2,W){const Mn=ae+(dt===1?ye.length-2:dt-2),gn=dt===1?ae:Mn+1;if(this.indexArray.emplaceBack(pn+1,Mn,pn+3),this.indexArray.emplaceBack(Mn,gn,pn+3),we.primitiveLength+=2,$e===void 0&&($e=pn),!ix(Dt,ye[dt],_e)){const ti=dt===ye.length-1?$e:we.vertexLength;this.indexArray.emplaceBack(pn+2,pn+3,ti),this.indexArray.emplaceBack(pn+3,ti+1,ti),this.indexArray.emplaceBack(pn+3,gn,ti+1),we.primitiveLength+=3}ut=!ut}if(A){const Mn=this.layoutVertexExtArray,gn=E.projectTilePoint(Ct.x,Ct.y,c),ti=E.projectTilePoint(Qe.x,Qe.y,c),wn=E.upVector(c,Ct.x,Ct.y),On=E.upVector(c,Qe.x,Qe.y);$h(Mn,gn,wn),$h(Mn,gn,wn),$h(Mn,ti,On),$h(Mn,ti,On)}}z&&(ae+=ye.length-1)}}if(P&&P.polyCount.length>0){if(P.borders){P.vertexArrayOffset=this.centroidVertexArray.length;const le=P.borders,_e=this.featuresOnBorder.push(P)-1;for(let ae=0;ae<4;ae++)le[ae][0]!==Number.MAX_VALUE&&this.borders[ae].push(_e)}this.encodeCentroid(P.borders?void 0:P.centroid(),P)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,a,d,g,c)}sortBorders(){for(let t=0;t<4;t++)this.borders[t].sort((i,a)=>this.featuresOnBorder[i].borders[t][0]-this.featuresOnBorder[a].borders[t][0])}encodeCentroid(t,i,a=!0){let c,d;if(t)if(t.y!==0){const y=i.span()._mult(this.tileToMeter);c=(Math.max(t.x,1)<<3)+Math.min(7,Math.round(y.x/10)),d=(Math.max(t.y,1)<<3)+Math.min(7,Math.round(y.y/10))}else c=Math.ceil(7*(t.x+450)),d=0;else c=0,d=+a;let g=a?this.centroidVertexArray.length:i.vertexArrayOffset;for(const y of i.polyCount){a&&this.centroidVertexArray.resize(this.centroidVertexArray.length+4*y.edges+y.top);for(let w=0;w<y.top;w++)this.centroidVertexArray.emplace(g++,c,d);for(let w=0;w<2*y.edges;w++)this.centroidVertexArray.emplace(g++,0,d),this.centroidVertexArray.emplace(g++,c,d)}}}function tx(n,t){const i=n.add(t)._unit();return n.x*i.x+n.y*i.y}function HC(n,t,i,a){const c=t.sub(n)._perp()._unit(),d=i.sub(t)._perp()._unit();return nx(n,t,i,tx(c,d),a)}function nx(n,t,i,a,c){const d=Math.sqrt(1-a*a);return Math.min(n.dist(t)/3,t.dist(i)/3,c*d/a)}function ix(n,t,i){return n.x<i[0].x&&t.x<i[0].x||n.x>i[1].x&&t.x>i[1].x||n.y<i[0].y&&t.y<i[0].y||n.y>i[1].y&&t.y>i[1].y}function rx(n,t,i){if(n.x<0||n.x>=_n||t.x<0||t.x>=_n||i.x<0||i.x>=_n)return!1;const a=i.sub(t),c=a.perp(),d=n.sub(t);return(a.x*d.x+a.y*d.y)/Math.sqrt((a.x*a.x+a.y*a.y)*(d.x*d.x+d.y*d.y))>-.866&&c.x*d.x+c.y*d.y<0}function ox(n,t,i){const a=t?2|n:-3&n;return i?1|a:-2&a}function sx(){const n=Math.PI/32,t=Math.tan(n),i=Xf;return i*Math.sqrt(1+2*t*t)-i}function ax(n,t,i){const a=1<<i.z,c=co(i.x/a),d=co((i.x+1)/a),g=mr(i.y/a),y=mr((i.y+1)/a);return function(w,E,A,P,z=0,B){const F=[];if(!w.length||!A||!P)return F;const q=(ye,$e)=>{for(const qe of ye)F.push({polygon:qe,bounds:$e})},W=Math.ceil(Math.log2(A)),le=Math.ceil(Math.log2(P)),_e=W-le,ae=[];for(let ye=0;ye<Math.abs(_e);ye++)ae.push(_e>0?0:1);for(let ye=0;ye<Math.min(W,le);ye++)ae.push(0),ae.push(1);let de=w;if(de=lp(de,E[0].y-z,E[1].y+z,1),de=lp(de,E[0].x-z,E[1].x+z,0),!de.length)return F;const we=[];for(ae.length?we.push({polygons:de,bounds:E,depth:0}):q(de,E);we.length;){const ye=we.pop(),$e=ye.depth,qe=ae[$e],it=ye.bounds[0],St=ye.bounds[1],Ke=qe===0?it.x:it.y,ut=qe===0?St.x:St.y,dt=B?B(qe,Ke,ut):.5*(Ke+ut),vt=lp(ye.polygons,Ke-z,dt+z,qe),Ct=lp(ye.polygons,dt-z,ut+z,qe);if(vt.length){const Qe=[it,new ce(qe===0?dt:St.x,qe===1?dt:St.y)];ae.length>$e+1?we.push({polygons:vt,bounds:Qe,depth:$e+1}):q(vt,Qe)}if(Ct.length){const Qe=[new ce(qe===0?dt:it.x,qe===1?dt:it.y),St];ae.length>$e+1?we.push({polygons:Ct,bounds:Qe,depth:$e+1}):q(Ct,Qe)}}return F}(n,t,Math.ceil((d-c)/11.25),Math.ceil((g-y)/11.25),1,(w,E,A)=>{if(w===0)return .5*(E+A);{const P=mr((i.y+E/_n)/a);return(us(.5*(mr((i.y+A/_n)/a)+P))*a-i.y)*_n}})}Zt(Gh,"FillExtrusionBucket",{omit:["layers","features"]}),Zt(ex,"PartMetadata");const XC=new ln({"fill-extrusion-edge-radius":new De(tt["layout_fill-extrusion"]["fill-extrusion-edge-radius"])});var KC={paint:new ln({"fill-extrusion-opacity":new De(tt["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new He(tt["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new De(tt["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new De(tt["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new He(tt["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new He(tt["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new He(tt["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new De(tt["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new De(tt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new De(tt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"])}),layout:XC};function lx(n,t,i){var a=2*Math.PI*6378137/256/Math.pow(2,i);return[n*a-2*Math.PI*6378137/2,t*a-2*Math.PI*6378137/2]}class cp{constructor(t,i,a){this.z=t,this.x=i,this.y=a,this.key=Zh(0,t,t,i,a)}equals(t){return this.z===t.z&&this.x===t.x&&this.y===t.y}url(t,i){const a=function(d,g,y){var w=lx(256*d,256*(g=Math.pow(2,y)-g-1),y),E=lx(256*(d+1),256*(g+1),y);return w[0]+","+w[1]+","+E[0]+","+E[1]}(this.x,this.y,this.z),c=function(d,g,y){let w,E="";for(let A=d;A>0;A--)w=1<<A-1,E+=(g&w?1:0)+(y&w?2:0);return E}(this.z,this.x,this.y);return t[(this.x+this.y)%t.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(i==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",c).replace("{bbox-epsg-3857}",a)}toString(){return`${this.z}/${this.x}/${this.y}`}}class cx{constructor(t,i){this.wrap=t,this.canonical=i,this.key=Zh(t,i.z,i.z,i.x,i.y)}}class Dr{constructor(t,i,a,c,d){this.overscaledZ=t,this.wrap=i,this.canonical=new cp(a,+c,+d),this.key=i===0&&t===a?this.canonical.key:Zh(i,t,a,c,d)}equals(t){return this.overscaledZ===t.overscaledZ&&this.wrap===t.wrap&&this.canonical.equals(t.canonical)}scaledTo(t){const i=this.canonical.z-t;return t>this.canonical.z?new Dr(t,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Dr(t,this.wrap,t,this.canonical.x>>i,this.canonical.y>>i)}calculateScaledKey(t,i=!0){if(this.overscaledZ===t&&i)return this.key;if(t>this.canonical.z)return Zh(this.wrap*+i,t,this.canonical.z,this.canonical.x,this.canonical.y);{const a=this.canonical.z-t;return Zh(this.wrap*+i,t,t,this.canonical.x>>a,this.canonical.y>>a)}}isChildOf(t){if(t.wrap!==this.wrap)return!1;const i=this.canonical.z-t.canonical.z;return t.overscaledZ===0||t.overscaledZ<this.overscaledZ&&t.canonical.x===this.canonical.x>>i&&t.canonical.y===this.canonical.y>>i}children(t){if(this.overscaledZ>=t)return[new Dr(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const i=this.canonical.z+1,a=2*this.canonical.x,c=2*this.canonical.y;return[new Dr(i,this.wrap,i,a,c),new Dr(i,this.wrap,i,a+1,c),new Dr(i,this.wrap,i,a,c+1),new Dr(i,this.wrap,i,a+1,c+1)]}isLessThan(t){return this.wrap<t.wrap||!(this.wrap>t.wrap)&&(this.overscaledZ<t.overscaledZ||!(this.overscaledZ>t.overscaledZ)&&(this.canonical.x<t.canonical.x||!(this.canonical.x>t.canonical.x)&&this.canonical.y<t.canonical.y))}wrapped(){return new Dr(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(t){return new Dr(this.overscaledZ,t,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new cx(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function Zh(n,t,i,a,c){const d=1<<Math.min(i,22);let g=d*(c%d)+a%d;return n&&i<22&&(g+=d*d*((n<0?-2*n-1:2*n)%(1<<2*(22-i)))),16*(32*g+i)+(t-i)}Zt(cp,"CanonicalTileID"),Zt(Dr,"OverscaledTileID",{omit:["projMatrix"]});class Wc extends ce{constructor(t,i,a){super(t,i),this.z=a}}function Wh(n,t){return n.x*t.x+n.y*t.y}function ux(n,t){if(n.length===1){let i=0;const a=t[i++];let c;for(;!c||a.equals(c);)if(c=t[i++],!c)return 1/0;for(;i<t.length;i++){const d=t[i],g=n[0],y=c.sub(a),w=d.sub(a),E=g.sub(a),A=Wh(y,y),P=Wh(y,w),z=Wh(w,w),B=Wh(E,y),F=Wh(E,w),q=A*z-P*P,W=(z*B-P*F)/q,le=(A*F-P*B)/q,_e=a.z*(1-W-le)+c.z*W+d.z*le;if(isFinite(_e))return _e}return 1/0}{let i=1/0;for(const a of t)i=Math.min(i,a.z);return i}}function hx(n,t,i,a,c,d,g,y){const w=g*c.getElevationAt(n,t,!0,!0),E=d[0]!==0,A=E?d[1]===0?g*(d[0]/7-450):g*function(P,z,B){const F=Math.floor(z[0]/8),q=Math.floor(z[1]/8),W=10*(z[0]-8*F),le=10*(z[1]-8*q),_e=P.getElevationAt(F,q,!0,!0),ae=P.getMeterToDEM(B),de=Math.floor(.5*(W*ae-1)),we=Math.floor(.5*(le*ae-1)),ye=P.tileCoordToPixel(F,q),$e=2*de+1,qe=2*we+1,it=function(Ct,Qe,Dt,dn,Vt){return[Ct.getElevationAtPixel(Qe,Dt,!0),Ct.getElevationAtPixel(Qe+Vt,Dt,!0),Ct.getElevationAtPixel(Qe,Dt+Vt,!0),Ct.getElevationAtPixel(Qe+dn,Dt+Vt,!0)]}(P,ye.x-de,ye.y-we,$e,qe),St=Math.abs(it[0]-it[1]),Ke=Math.abs(it[2]-it[3]),ut=Math.abs(it[0]-it[2])+Math.abs(it[1]-it[3]),dt=Math.min(.25,.5*ae*(St+Ke)/$e),vt=Math.min(.25,.5*ae*ut/qe);return _e+Math.max(dt*W,vt*le)}(c,d,y):w;return{base:w+(i===0)?-1:i,top:E?Math.max(A+a,w+i+2):w+a}}const YC=Gt([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:QC}=YC,JC=Gt([{name:"a_packed",components:4,type:"Float32"}]),{members:eA}=JC,tA=ap.types,nA=Math.cos(Math.PI/180*37.5);class up{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(i=>i.id),this.index=t.index,this.projection=t.projection,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(i=>{this.gradients[i.id]={}}),this.layoutVertexArray=new zr,this.layoutVertexArray2=new Gr,this.indexArray=new pr,this.programConfigurations=new Al(t.layers,t.zoom),this.segments=new Wi,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id)}populate(t,i,a,c){this.hasPattern=e_("line",this.layers,i);const d=this.layers[0].layout.get("line-sort-key"),g=[];for(const{feature:A,id:P,index:z,sourceLayerIndex:B}of t){const F=this.layers[0]._featureFilter.needGeometry,q=Ml(A,F);if(!this.layers[0]._featureFilter.filter(new Le(this.zoom),q,a))continue;const W=d?d.evaluate(q,{},a):void 0,le={id:P,properties:A.properties,type:A.type,sourceLayerIndex:B,index:z,geometry:F?q.geometry:Bs(A,a,c),patterns:{},sortKey:W};g.push(le)}d&&g.sort((A,P)=>A.sortKey-P.sortKey);const{lineAtlas:y,featureIndex:w}=i,E=this.addConstantDashes(y);for(const A of g){const{geometry:P,index:z,sourceLayerIndex:B}=A;if(E&&this.addFeatureDashes(A,y),this.hasPattern){const F=t_("line",this.layers,A,this.zoom,i);this.patternFeatures.push(F)}else this.addFeature(A,P,z,a,y.positions,i.availableImages);w.insert(t[z].feature,P,z,B,this.index)}}addConstantDashes(t){let i=!1;for(const a of this.layers){const c=a.paint.get("line-dasharray").value,d=a.layout.get("line-cap").value;if(c.kind!=="constant"||d.kind!=="constant")i=!0;else{const g=d.value,y=c.value;if(!y)continue;t.addDash(y,g)}}return i}addFeatureDashes(t,i){const a=this.zoom;for(const c of this.layers){const d=c.paint.get("line-dasharray").value,g=c.layout.get("line-cap").value;if(d.kind==="constant"&&g.kind==="constant")continue;let y,w;if(d.kind==="constant"){if(y=d.value,!y)continue}else y=d.evaluate({zoom:a},t);w=g.kind==="constant"?g.value:g.evaluate({zoom:a},t),i.addDash(y,w),t.patterns[c.id]=i.getKey(y,w)}}update(t,i,a,c){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,i,this.stateDependentLayers,a,c)}addFeatures(t,i,a,c,d){for(const g of this.patternFeatures)this.addFeature(g,g.geometry,g.index,i,a,c)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=t.createVertexBuffer(this.layoutVertexArray2,eA)),this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,QC),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(t){if(t.properties&&t.properties.hasOwnProperty("mapbox_clip_start")&&t.properties.hasOwnProperty("mapbox_clip_end"))return{start:+t.properties.mapbox_clip_start,end:+t.properties.mapbox_clip_end}}addFeature(t,i,a,c,d,g){const y=this.layers[0].layout,w=y.get("line-join").evaluate(t,{}),E=y.get("line-cap").evaluate(t,{}),A=y.get("line-miter-limit"),P=y.get("line-round-limit");this.lineClips=this.lineFeatureClips(t);for(const z of i)this.addLine(z,t,w,E,A,P);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,a,d,g,c)}addLine(t,i,a,c,d,g){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let le=0;le<t.length-1;le++)this.totalDistance+=t[le].dist(t[le+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const y=tA[i.type]==="Polygon";let w=t.length;for(;w>=2&&t[w-1].equals(t[w-2]);)w--;let E=0;for(;E<w-1&&t[E].equals(t[E+1]);)E++;if(w<(y?3:2))return;a==="bevel"&&(d=1.05);const A=this.overscaling<=16?122880/(512*this.overscaling):0,P=this.segments.prepareSegment(10*w,this.layoutVertexArray,this.indexArray);let z,B,F,q,W;this.e1=this.e2=-1,y&&(z=t[w-2],W=t[E].sub(z)._unit()._perp());for(let le=E;le<w;le++){if(F=le===w-1?y?t[E+1]:void 0:t[le+1],F&&t[le].equals(F))continue;W&&(q=W),z&&(B=z),z=t[le],W=F?F.sub(z)._unit()._perp():q,q=q||W;let _e=q.add(W);_e.x===0&&_e.y===0||_e._unit();const ae=q.x*W.x+q.y*W.y,de=_e.x*W.x+_e.y*W.y,we=de!==0?1/de:1/0,ye=2*Math.sqrt(2-2*de),$e=de<nA&&B&&F,qe=q.x*W.y-q.y*W.x>0;if($e&&le>E){const Ke=z.dist(B);if(Ke>2*A){const ut=z.sub(z.sub(B)._mult(A/Ke)._round());this.updateDistance(B,ut),this.addCurrentVertex(ut,q,0,0,P),B=ut}}const it=B&&F;let St=it?a:y?"butt":c;if(it&&St==="round"&&(we<g?St="miter":we<=2&&(St="fakeround")),St==="miter"&&we>d&&(St="bevel"),St==="bevel"&&(we>2&&(St="flipbevel"),we<d&&(St="miter")),B&&this.updateDistance(B,z),St==="miter")_e._mult(we),this.addCurrentVertex(z,_e,0,0,P);else if(St==="flipbevel"){if(we>100)_e=W.mult(-1);else{const Ke=we*q.add(W).mag()/q.sub(W).mag();_e._perp()._mult(Ke*(qe?-1:1))}this.addCurrentVertex(z,_e,0,0,P),this.addCurrentVertex(z,_e.mult(-1),0,0,P)}else if(St==="bevel"||St==="fakeround"){const Ke=-Math.sqrt(we*we-1),ut=qe?Ke:0,dt=qe?0:Ke;if(B&&this.addCurrentVertex(z,q,ut,dt,P),St==="fakeround"){const vt=Math.round(180*ye/Math.PI/20);for(let Ct=1;Ct<vt;Ct++){let Qe=Ct/vt;if(Qe!==.5){const dn=Qe-.5;Qe+=Qe*dn*(Qe-1)*((1.0904+ae*(ae*(3.55645-1.43519*ae)-3.2452))*dn*dn+(.848013+ae*(.215638*ae-1.06021)))}const Dt=W.sub(q)._mult(Qe)._add(q)._unit()._mult(qe?-1:1);this.addHalfVertex(z,Dt.x,Dt.y,!1,qe,0,P)}}F&&this.addCurrentVertex(z,W,-ut,-dt,P)}else if(St==="butt")this.addCurrentVertex(z,_e,0,0,P);else if(St==="square"){const Ke=B?1:-1;B||this.addCurrentVertex(z,_e,Ke,Ke,P),this.addCurrentVertex(z,_e,0,0,P),B&&this.addCurrentVertex(z,_e,Ke,Ke,P)}else St==="round"&&(B&&(this.addCurrentVertex(z,q,0,0,P),this.addCurrentVertex(z,q,1,1,P,!0)),F&&(this.addCurrentVertex(z,W,-1,-1,P,!0),this.addCurrentVertex(z,W,0,0,P)));if($e&&le<w-1){const Ke=z.dist(F);if(Ke>2*A){const ut=z.add(F.sub(z)._mult(A/Ke)._round());this.updateDistance(z,ut),this.addCurrentVertex(ut,W,0,0,P),z=ut}}}}addCurrentVertex(t,i,a,c,d,g=!1){const y=i.y*c-i.x,w=-i.y-i.x*c;this.addHalfVertex(t,i.x+i.y*a,i.y-i.x*a,g,!1,a,d),this.addHalfVertex(t,y,w,g,!0,-c,d)}addHalfVertex({x:t,y:i},a,c,d,g,y,w){this.layoutVertexArray.emplaceBack((t<<1)+(d?1:0),(i<<1)+(g?1:0),Math.round(63*a)+128,Math.round(63*c)+128,1+(y===0?0:y<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);const E=w.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,E),w.primitiveLength++),g?this.e2=E:this.e1=E}updateScaledDistance(){if(this.lineClips){const t=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=t*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(t,i){this.distance+=t.dist(i),this.updateScaledDistance()}}Zt(up,"LineBucket",{omit:["layers","patternFeatures"]});const iA=new ln({"line-cap":new He(tt.layout_line["line-cap"]),"line-join":new He(tt.layout_line["line-join"]),"line-miter-limit":new De(tt.layout_line["line-miter-limit"]),"line-round-limit":new De(tt.layout_line["line-round-limit"]),"line-sort-key":new He(tt.layout_line["line-sort-key"])});var dx={paint:new ln({"line-opacity":new He(tt.paint_line["line-opacity"]),"line-color":new He(tt.paint_line["line-color"]),"line-translate":new De(tt.paint_line["line-translate"]),"line-translate-anchor":new De(tt.paint_line["line-translate-anchor"]),"line-width":new He(tt.paint_line["line-width"]),"line-gap-width":new He(tt.paint_line["line-gap-width"]),"line-offset":new He(tt.paint_line["line-offset"]),"line-blur":new He(tt.paint_line["line-blur"]),"line-dasharray":new He(tt.paint_line["line-dasharray"]),"line-pattern":new He(tt.paint_line["line-pattern"]),"line-gradient":new Qt(tt.paint_line["line-gradient"]),"line-trim-offset":new De(tt.paint_line["line-trim-offset"])}),layout:iA};const fx=new class extends He{possiblyEvaluate(n,t){return t=new Le(Math.floor(t.zoom),{now:t.now,fadeDuration:t.fadeDuration,transition:t.transition}),super.possiblyEvaluate(n,t)}evaluate(n,t,i,a){return t=Ve({},t,{zoom:Math.floor(t.zoom)}),super.evaluate(n,t,i,a)}}(dx.paint.properties["line-width"].specification);function px(n,t){return t>0?t+2*n:n}fx.useIntegerZoom=!0;const rA=Gt([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),oA=Gt([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),sA=Gt([{name:"a_projected_pos",components:4,type:"Float32"}],4);Gt([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const aA=Gt([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),lA=Gt([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"}]);Gt([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const mx=Gt([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),cA=Gt([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);Gt([{name:"triangle",components:3,type:"Uint16"}]),Gt([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),Gt([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),Gt([{type:"Float32",name:"offsetX"}]),Gt([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var gr=24;const ds=128;function i_(n,t){const{expression:i}=t;if(i.kind==="constant")return{kind:"constant",layoutSize:i.evaluate(new Le(n+1))};if(i.kind==="source")return{kind:"source"};{const{zoomStops:a,interpolationType:c}=i;let d=0;for(;d<a.length&&a[d]<=n;)d++;d=Math.max(0,d-1);let g=d;for(;g<a.length&&a[g]<n+1;)g++;g=Math.min(a.length-1,g);const y=a[d],w=a[g];return i.kind==="composite"?{kind:"composite",minZoom:y,maxZoom:w,interpolationType:c}:{kind:"camera",minZoom:y,maxZoom:w,minSize:i.evaluate(new Le(y)),maxSize:i.evaluate(new Le(w)),interpolationType:c}}}function hp(n,{uSize:t,uSizeT:i},{lowerSize:a,upperSize:c}){return n.kind==="source"?a/ds:n.kind==="composite"?$n(a/ds,c/ds,i):t}function Hc(n,t){let i=0,a=0;if(n.kind==="constant")a=n.layoutSize;else if(n.kind!=="source"){const{interpolationType:c,minZoom:d,maxZoom:g}=n,y=c?lt(_o.interpolationFactor(c,t,d,g),0,1):0;n.kind==="camera"?a=$n(n.minSize,n.maxSize,y):i=y}return{uSizeT:i,uSize:a}}var uA=Object.freeze({__proto__:null,getSizeData:i_,evaluateSizeForFeature:hp,evaluateSizeForZoom:Hc,SIZE_PACK_FACTOR:ds});function hA(n,t,i){return n.sections.forEach(a=>{a.text=function(c,d,g){const y=d.layout.get("text-transform").evaluate(g,{});return y==="uppercase"?c=c.toLocaleUpperCase():y==="lowercase"&&(c=c.toLocaleLowerCase()),je.applyArabicShaping&&(c=je.applyArabicShaping(c)),c}(a.text,t,i)}),n}const Hh={"!":"\uFE15","#":"\uFF03",$:"\uFF04","%":"\uFF05","&":"\uFF06","(":"\uFE35",")":"\uFE36","*":"\uFF0A","+":"\uFF0B",",":"\uFE10","-":"\uFE32",".":"\u30FB","/":"\uFF0F",":":"\uFE13",";":"\uFE14","<":"\uFE3F","=":"\uFF1D",">":"\uFE40","?":"\uFE16","@":"\uFF20","[":"\uFE47","\\":"\uFF3C","]":"\uFE48","^":"\uFF3E",_:"\uFE33","`":"\uFF40","{":"\uFE37","|":"\u2015","}":"\uFE38","~":"\uFF5E","\xA2":"\uFFE0","\xA3":"\uFFE1","\xA5":"\uFFE5","\xA6":"\uFFE4","\xAC":"\uFFE2","\xAF":"\uFFE3","\u2013":"\uFE32","\u2014":"\uFE31","\u2018":"\uFE43","\u2019":"\uFE44","\u201C":"\uFE41","\u201D":"\uFE42","\u2026":"\uFE19","\u2027":"\u30FB","\u20A9":"\uFFE6","\u3001":"\uFE11","\u3002":"\uFE12","\u3008":"\uFE3F","\u3009":"\uFE40","\u300A":"\uFE3D","\u300B":"\uFE3E","\u300C":"\uFE41","\u300D":"\uFE42","\u300E":"\uFE43","\u300F":"\uFE44","\u3010":"\uFE3B","\u3011":"\uFE3C","\u3014":"\uFE39","\u3015":"\uFE3A","\u3016":"\uFE17","\u3017":"\uFE18","\uFF01":"\uFE15","\uFF08":"\uFE35","\uFF09":"\uFE36","\uFF0C":"\uFE10","\uFF0D":"\uFE32","\uFF0E":"\u30FB","\uFF1A":"\uFE13","\uFF1B":"\uFE14","\uFF1C":"\uFE3F","\uFF1E":"\uFE40","\uFF1F":"\uFE16","\uFF3B":"\uFE47","\uFF3D":"\uFE48","\uFF3F":"\uFE33","\uFF5B":"\uFE37","\uFF5C":"\u2015","\uFF5D":"\uFE38","\uFF5F":"\uFE35","\uFF60":"\uFE36","\uFF61":"\uFE12","\uFF62":"\uFE41","\uFF63":"\uFE42"};function dA(n){return n==="\uFE36"||n==="\uFE48"||n==="\uFE38"||n==="\uFE44"||n==="\uFE42"||n==="\uFE3E"||n==="\uFE3C"||n==="\uFE3A"||n==="\uFE18"||n==="\uFE40"||n==="\uFE10"||n==="\uFE13"||n==="\uFE14"||n==="\uFF40"||n==="\uFFE3"||n==="\uFE11"||n==="\uFE12"}function fA(n){return n==="\uFE35"||n==="\uFE47"||n==="\uFE37"||n==="\uFE43"||n==="\uFE41"||n==="\uFE3D"||n==="\uFE3B"||n==="\uFE39"||n==="\uFE17"||n==="\uFE3F"}var Xh=fi,gx=function(n,t,i,a,c){var d,g,y=8*c-a-1,w=(1<<y)-1,E=w>>1,A=-7,P=i?c-1:0,z=i?-1:1,B=n[t+P];for(P+=z,d=B&(1<<-A)-1,B>>=-A,A+=y;A>0;d=256*d+n[t+P],P+=z,A-=8);for(g=d&(1<<-A)-1,d>>=-A,A+=a;A>0;g=256*g+n[t+P],P+=z,A-=8);if(d===0)d=1-E;else{if(d===w)return g?NaN:1/0*(B?-1:1);g+=Math.pow(2,a),d-=E}return(B?-1:1)*g*Math.pow(2,d-a)},_x=function(n,t,i,a,c,d){var g,y,w,E=8*d-c-1,A=(1<<E)-1,P=A>>1,z=c===23?Math.pow(2,-24)-Math.pow(2,-77):0,B=a?0:d-1,F=a?1:-1,q=t<0||t===0&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(y=isNaN(t)?1:0,g=A):(g=Math.floor(Math.log(t)/Math.LN2),t*(w=Math.pow(2,-g))<1&&(g--,w*=2),(t+=g+P>=1?z/w:z*Math.pow(2,1-P))*w>=2&&(g++,w/=2),g+P>=A?(y=0,g=A):g+P>=1?(y=(t*w-1)*Math.pow(2,c),g+=P):(y=t*Math.pow(2,P-1)*Math.pow(2,c),g=0));c>=8;n[i+B]=255&y,B+=F,y/=256,c-=8);for(g=g<<c|y,E+=c;E>0;n[i+B]=255&g,B+=F,g/=256,E-=8);n[i+B-F]|=128*q};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */function fi(n){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(n)?n:new Uint8Array(n||0),this.pos=0,this.type=0,this.length=this.buf.length}fi.Varint=0,fi.Fixed64=1,fi.Bytes=2,fi.Fixed32=5;var r_=4294967296,yx=1/r_,vx=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function Vs(n){return n.type===fi.Bytes?n.readVarint()+n.pos:n.pos+1}function Xc(n,t,i){return i?4294967296*t+(n>>>0):4294967296*(t>>>0)+(n>>>0)}function xx(n,t,i){var a=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.floor(Math.log(t)/(7*Math.LN2));i.realloc(a);for(var c=i.pos-1;c>=n;c--)i.buf[c+a]=i.buf[c]}function pA(n,t){for(var i=0;i<n.length;i++)t.writeVarint(n[i])}function mA(n,t){for(var i=0;i<n.length;i++)t.writeSVarint(n[i])}function gA(n,t){for(var i=0;i<n.length;i++)t.writeFloat(n[i])}function _A(n,t){for(var i=0;i<n.length;i++)t.writeDouble(n[i])}function yA(n,t){for(var i=0;i<n.length;i++)t.writeBoolean(n[i])}function vA(n,t){for(var i=0;i<n.length;i++)t.writeFixed32(n[i])}function xA(n,t){for(var i=0;i<n.length;i++)t.writeSFixed32(n[i])}function bA(n,t){for(var i=0;i<n.length;i++)t.writeFixed64(n[i])}function wA(n,t){for(var i=0;i<n.length;i++)t.writeSFixed64(n[i])}function dp(n,t){return(n[t]|n[t+1]<<8|n[t+2]<<16)+16777216*n[t+3]}function Kc(n,t,i){n[i]=t,n[i+1]=t>>>8,n[i+2]=t>>>16,n[i+3]=t>>>24}function bx(n,t){return(n[t]|n[t+1]<<8|n[t+2]<<16)+(n[t+3]<<24)}function EA(n,t,i){t.glyphs=[],n===1&&i.readMessage(TA,t)}function TA(n,t,i){if(n===3){const{id:a,bitmap:c,width:d,height:g,left:y,top:w,advance:E}=i.readMessage(SA,{});t.glyphs.push({id:a,bitmap:new Ns({width:d+6,height:g+6},c),metrics:{width:d,height:g,left:y,top:w,advance:E}})}else n===4?t.ascender=i.readSVarint():n===5&&(t.descender=i.readSVarint())}function SA(n,t,i){n===1?t.id=i.readVarint():n===2?t.bitmap=i.readBytes():n===3?t.width=i.readVarint():n===4?t.height=i.readVarint():n===5?t.left=i.readSVarint():n===6?t.top=i.readSVarint():n===7&&(t.advance=i.readVarint())}function o_(n){let t=0,i=0;for(const g of n)t+=g.w*g.h,i=Math.max(i,g.w);n.sort((g,y)=>y.h-g.h);const a=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(t/.95)),i),h:1/0}];let c=0,d=0;for(const g of n)for(let y=a.length-1;y>=0;y--){const w=a[y];if(!(g.w>w.w||g.h>w.h)){if(g.x=w.x,g.y=w.y,d=Math.max(d,g.y+g.h),c=Math.max(c,g.x+g.w),g.w===w.w&&g.h===w.h){const E=a.pop();y<a.length&&(a[y]=E)}else g.h===w.h?(w.x+=g.w,w.w-=g.w):g.w===w.w?(w.y+=g.h,w.h-=g.h):(a.push({x:w.x+g.w,y:w.y,w:w.w-g.w,h:g.h}),w.y+=g.h,w.h-=g.h);break}}return{w:c,h:d,fill:t/(c*d)||0}}fi.prototype={destroy:function(){this.buf=null},readFields:function(n,t,i){for(i=i||this.length;this.pos<i;){var a=this.readVarint(),c=a>>3,d=this.pos;this.type=7&a,n(c,t,this),this.pos===d&&this.skip(a)}return t},readMessage:function(n,t){return this.readFields(n,t,this.readVarint()+this.pos)},readFixed32:function(){var n=dp(this.buf,this.pos);return this.pos+=4,n},readSFixed32:function(){var n=bx(this.buf,this.pos);return this.pos+=4,n},readFixed64:function(){var n=dp(this.buf,this.pos)+dp(this.buf,this.pos+4)*r_;return this.pos+=8,n},readSFixed64:function(){var n=dp(this.buf,this.pos)+bx(this.buf,this.pos+4)*r_;return this.pos+=8,n},readFloat:function(){var n=gx(this.buf,this.pos,!0,23,4);return this.pos+=4,n},readDouble:function(){var n=gx(this.buf,this.pos,!0,52,8);return this.pos+=8,n},readVarint:function(n){var t,i,a=this.buf;return t=127&(i=a[this.pos++]),i<128?t:(t|=(127&(i=a[this.pos++]))<<7,i<128?t:(t|=(127&(i=a[this.pos++]))<<14,i<128?t:(t|=(127&(i=a[this.pos++]))<<21,i<128?t:function(c,d,g){var y,w,E=g.buf;if(y=(112&(w=E[g.pos++]))>>4,w<128||(y|=(127&(w=E[g.pos++]))<<3,w<128)||(y|=(127&(w=E[g.pos++]))<<10,w<128)||(y|=(127&(w=E[g.pos++]))<<17,w<128)||(y|=(127&(w=E[g.pos++]))<<24,w<128)||(y|=(1&(w=E[g.pos++]))<<31,w<128))return Xc(c,y,d);throw new Error("Expected varint not more than 10 bytes")}(t|=(15&(i=a[this.pos]))<<28,n,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var n=this.readVarint();return n%2==1?(n+1)/-2:n/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var n=this.readVarint()+this.pos,t=this.pos;return this.pos=n,n-t>=12&&vx?function(i,a,c){return vx.decode(i.subarray(a,c))}(this.buf,t,n):function(i,a,c){for(var d="",g=a;g<c;){var y,w,E,A=i[g],P=null,z=A>239?4:A>223?3:A>191?2:1;if(g+z>c)break;z===1?A<128&&(P=A):z===2?(192&(y=i[g+1]))==128&&(P=(31&A)<<6|63&y)<=127&&(P=null):z===3?(w=i[g+2],(192&(y=i[g+1]))==128&&(192&w)==128&&((P=(15&A)<<12|(63&y)<<6|63&w)<=2047||P>=55296&&P<=57343)&&(P=null)):z===4&&(w=i[g+2],E=i[g+3],(192&(y=i[g+1]))==128&&(192&w)==128&&(192&E)==128&&((P=(15&A)<<18|(63&y)<<12|(63&w)<<6|63&E)<=65535||P>=1114112)&&(P=null)),P===null?(P=65533,z=1):P>65535&&(P-=65536,d+=String.fromCharCode(P>>>10&1023|55296),P=56320|1023&P),d+=String.fromCharCode(P),g+=z}return d}(this.buf,t,n)},readBytes:function(){var n=this.readVarint()+this.pos,t=this.buf.subarray(this.pos,n);return this.pos=n,t},readPackedVarint:function(n,t){if(this.type!==fi.Bytes)return n.push(this.readVarint(t));var i=Vs(this);for(n=n||[];this.pos<i;)n.push(this.readVarint(t));return n},readPackedSVarint:function(n){if(this.type!==fi.Bytes)return n.push(this.readSVarint());var t=Vs(this);for(n=n||[];this.pos<t;)n.push(this.readSVarint());return n},readPackedBoolean:function(n){if(this.type!==fi.Bytes)return n.push(this.readBoolean());var t=Vs(this);for(n=n||[];this.pos<t;)n.push(this.readBoolean());return n},readPackedFloat:function(n){if(this.type!==fi.Bytes)return n.push(this.readFloat());var t=Vs(this);for(n=n||[];this.pos<t;)n.push(this.readFloat());return n},readPackedDouble:function(n){if(this.type!==fi.Bytes)return n.push(this.readDouble());var t=Vs(this);for(n=n||[];this.pos<t;)n.push(this.readDouble());return n},readPackedFixed32:function(n){if(this.type!==fi.Bytes)return n.push(this.readFixed32());var t=Vs(this);for(n=n||[];this.pos<t;)n.push(this.readFixed32());return n},readPackedSFixed32:function(n){if(this.type!==fi.Bytes)return n.push(this.readSFixed32());var t=Vs(this);for(n=n||[];this.pos<t;)n.push(this.readSFixed32());return n},readPackedFixed64:function(n){if(this.type!==fi.Bytes)return n.push(this.readFixed64());var t=Vs(this);for(n=n||[];this.pos<t;)n.push(this.readFixed64());return n},readPackedSFixed64:function(n){if(this.type!==fi.Bytes)return n.push(this.readSFixed64());var t=Vs(this);for(n=n||[];this.pos<t;)n.push(this.readSFixed64());return n},skip:function(n){var t=7&n;if(t===fi.Varint)for(;this.buf[this.pos++]>127;);else if(t===fi.Bytes)this.pos=this.readVarint()+this.pos;else if(t===fi.Fixed32)this.pos+=4;else{if(t!==fi.Fixed64)throw new Error("Unimplemented type: "+t);this.pos+=8}},writeTag:function(n,t){this.writeVarint(n<<3|t)},realloc:function(n){for(var t=this.length||16;t<this.pos+n;)t*=2;if(t!==this.length){var i=new Uint8Array(t);i.set(this.buf),this.buf=i,this.length=t}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(n){this.realloc(4),Kc(this.buf,n,this.pos),this.pos+=4},writeSFixed32:function(n){this.realloc(4),Kc(this.buf,n,this.pos),this.pos+=4},writeFixed64:function(n){this.realloc(8),Kc(this.buf,-1&n,this.pos),Kc(this.buf,Math.floor(n*yx),this.pos+4),this.pos+=8},writeSFixed64:function(n){this.realloc(8),Kc(this.buf,-1&n,this.pos),Kc(this.buf,Math.floor(n*yx),this.pos+4),this.pos+=8},writeVarint:function(n){(n=+n||0)>268435455||n<0?function(t,i){var a,c;if(t>=0?(a=t%4294967296|0,c=t/4294967296|0):(c=~(-t/4294967296),4294967295^(a=~(-t%4294967296))?a=a+1|0:(a=0,c=c+1|0)),t>=18446744073709552e3||t<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");i.realloc(10),function(d,g,y){y.buf[y.pos++]=127&d|128,d>>>=7,y.buf[y.pos++]=127&d|128,d>>>=7,y.buf[y.pos++]=127&d|128,d>>>=7,y.buf[y.pos++]=127&d|128,y.buf[y.pos]=127&(d>>>=7)}(a,0,i),function(d,g){var y=(7&d)<<4;g.buf[g.pos++]|=y|((d>>>=3)?128:0),d&&(g.buf[g.pos++]=127&d|((d>>>=7)?128:0),d&&(g.buf[g.pos++]=127&d|((d>>>=7)?128:0),d&&(g.buf[g.pos++]=127&d|((d>>>=7)?128:0),d&&(g.buf[g.pos++]=127&d|((d>>>=7)?128:0),d&&(g.buf[g.pos++]=127&d)))))}(c,i)}(n,this):(this.realloc(4),this.buf[this.pos++]=127&n|(n>127?128:0),n<=127||(this.buf[this.pos++]=127&(n>>>=7)|(n>127?128:0),n<=127||(this.buf[this.pos++]=127&(n>>>=7)|(n>127?128:0),n<=127||(this.buf[this.pos++]=n>>>7&127))))},writeSVarint:function(n){this.writeVarint(n<0?2*-n-1:2*n)},writeBoolean:function(n){this.writeVarint(Boolean(n))},writeString:function(n){n=String(n),this.realloc(4*n.length),this.pos++;var t=this.pos;this.pos=function(a,c,d){for(var g,y,w=0;w<c.length;w++){if((g=c.charCodeAt(w))>55295&&g<57344){if(!y){g>56319||w+1===c.length?(a[d++]=239,a[d++]=191,a[d++]=189):y=g;continue}if(g<56320){a[d++]=239,a[d++]=191,a[d++]=189,y=g;continue}g=y-55296<<10|g-56320|65536,y=null}else y&&(a[d++]=239,a[d++]=191,a[d++]=189,y=null);g<128?a[d++]=g:(g<2048?a[d++]=g>>6|192:(g<65536?a[d++]=g>>12|224:(a[d++]=g>>18|240,a[d++]=g>>12&63|128),a[d++]=g>>6&63|128),a[d++]=63&g|128)}return d}(this.buf,n,this.pos);var i=this.pos-t;i>=128&&xx(t,i,this),this.pos=t-1,this.writeVarint(i),this.pos+=i},writeFloat:function(n){this.realloc(4),_x(this.buf,n,this.pos,!0,23,4),this.pos+=4},writeDouble:function(n){this.realloc(8),_x(this.buf,n,this.pos,!0,52,8),this.pos+=8},writeBytes:function(n){var t=n.length;this.writeVarint(t),this.realloc(t);for(var i=0;i<t;i++)this.buf[this.pos++]=n[i]},writeRawMessage:function(n,t){this.pos++;var i=this.pos;n(t,this);var a=this.pos-i;a>=128&&xx(i,a,this),this.pos=i-1,this.writeVarint(a),this.pos+=a},writeMessage:function(n,t,i){this.writeTag(n,fi.Bytes),this.writeRawMessage(t,i)},writePackedVarint:function(n,t){t.length&&this.writeMessage(n,pA,t)},writePackedSVarint:function(n,t){t.length&&this.writeMessage(n,mA,t)},writePackedBoolean:function(n,t){t.length&&this.writeMessage(n,yA,t)},writePackedFloat:function(n,t){t.length&&this.writeMessage(n,gA,t)},writePackedDouble:function(n,t){t.length&&this.writeMessage(n,_A,t)},writePackedFixed32:function(n,t){t.length&&this.writeMessage(n,vA,t)},writePackedSFixed32:function(n,t){t.length&&this.writeMessage(n,xA,t)},writePackedFixed64:function(n,t){t.length&&this.writeMessage(n,bA,t)},writePackedSFixed64:function(n,t){t.length&&this.writeMessage(n,wA,t)},writeBytesField:function(n,t){this.writeTag(n,fi.Bytes),this.writeBytes(t)},writeFixed32Field:function(n,t){this.writeTag(n,fi.Fixed32),this.writeFixed32(t)},writeSFixed32Field:function(n,t){this.writeTag(n,fi.Fixed32),this.writeSFixed32(t)},writeFixed64Field:function(n,t){this.writeTag(n,fi.Fixed64),this.writeFixed64(t)},writeSFixed64Field:function(n,t){this.writeTag(n,fi.Fixed64),this.writeSFixed64(t)},writeVarintField:function(n,t){this.writeTag(n,fi.Varint),this.writeVarint(t)},writeSVarintField:function(n,t){this.writeTag(n,fi.Varint),this.writeSVarint(t)},writeStringField:function(n,t){this.writeTag(n,fi.Bytes),this.writeString(t)},writeFloatField:function(n,t){this.writeTag(n,fi.Fixed32),this.writeFloat(t)},writeDoubleField:function(n,t){this.writeTag(n,fi.Fixed64),this.writeDouble(t)},writeBooleanField:function(n,t){this.writeVarintField(n,Boolean(t))}};class s_{constructor(t,{pixelRatio:i,version:a,stretchX:c,stretchY:d,content:g}){this.paddedRect=t,this.pixelRatio=i,this.stretchX=c,this.stretchY=d,this.content=g,this.version=a}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class wx{constructor(t,i){const a={},c={};this.haveRenderCallbacks=[];const d=[];this.addImages(t,a,d),this.addImages(i,c,d);const{w:g,h:y}=o_(d),w=new Qr({width:g||1,height:y||1});for(const E in t){const A=t[E],P=a[E].paddedRect;Qr.copy(A.data,w,{x:0,y:0},{x:P.x+1,y:P.y+1},A.data)}for(const E in i){const A=i[E],P=c[E].paddedRect,z=P.x+1,B=P.y+1,F=A.data.width,q=A.data.height;Qr.copy(A.data,w,{x:0,y:0},{x:z,y:B},A.data),Qr.copy(A.data,w,{x:0,y:q-1},{x:z,y:B-1},{width:F,height:1}),Qr.copy(A.data,w,{x:0,y:0},{x:z,y:B+q},{width:F,height:1}),Qr.copy(A.data,w,{x:F-1,y:0},{x:z-1,y:B},{width:1,height:q}),Qr.copy(A.data,w,{x:0,y:0},{x:z+F,y:B},{width:1,height:q})}this.image=w,this.iconPositions=a,this.patternPositions=c}addImages(t,i,a){for(const c in t){const d=t[c],g={x:0,y:0,w:d.data.width+2,h:d.data.height+2};a.push(g),i[c]=new s_(g,d),d.hasRenderCallback&&this.haveRenderCallbacks.push(c)}}patchUpdatedImages(t,i){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(a=>t.hasImage(a)),t.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const a in t.updatedImages)this.patchUpdatedImage(this.iconPositions[a],t.getImage(a),i),this.patchUpdatedImage(this.patternPositions[a],t.getImage(a),i)}patchUpdatedImage(t,i,a){if(!t||!i||t.version===i.version)return;t.version=i.version;const[c,d]=t.tl;a.update(i.data,void 0,{x:c,y:d})}}Zt(s_,"ImagePosition"),Zt(wx,"ImageAtlas");const ho={horizontal:1,vertical:2,horizontalOnly:3};class Kh{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(t,i){const a=new Kh;return a.scale=t||1,a.fontStack=i,a}static forImage(t){const i=new Kh;return i.imageName=t,i}}class Yc{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(t,i){const a=new Yc;for(let c=0;c<t.sections.length;c++){const d=t.sections[c];d.image?a.addImageSection(d):a.addTextSection(d,i)}return a}length(){return this.text.length}getSection(t){return this.sections[this.sectionIndex[t]]}getSections(){return this.sections}getSectionIndex(t){return this.sectionIndex[t]}getCharCode(t){return this.text.charCodeAt(t)}verticalizePunctuation(t){this.text=function(i,a){let c="";for(let d=0;d<i.length;d++){const g=i.charCodeAt(d+1)||null,y=i.charCodeAt(d-1)||null;c+=!a&&(g&&R(g)&&!Hh[i[d+1]]||y&&R(y)&&!Hh[i[d-1]])||!Hh[i[d]]?i[d]:Hh[i[d]]}return c}(this.text,t)}trim(){let t=0;for(let a=0;a<this.text.length&&fp[this.text.charCodeAt(a)];a++)t++;let i=this.text.length;for(let a=this.text.length-1;a>=0&&a>=t&&fp[this.text.charCodeAt(a)];a--)i--;this.text=this.text.substring(t,i),this.sectionIndex=this.sectionIndex.slice(t,i)}substring(t,i){const a=new Yc;return a.text=this.text.substring(t,i),a.sectionIndex=this.sectionIndex.slice(t,i),a.sections=this.sections,a}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((t,i)=>Math.max(t,this.sections[i].scale),0)}addTextSection(t,i){this.text+=t.text,this.sections.push(Kh.forText(t.scale,t.fontStack||i));const a=this.sections.length-1;for(let c=0;c<t.text.length;++c)this.sectionIndex.push(a)}addImageSection(t){const i=t.image?t.image.name:"";if(i.length===0)return void oe("Can't add FormattedSection with an empty image.");const a=this.getNextImageSectionCharCode();a?(this.text+=String.fromCharCode(a),this.sections.push(Kh.forImage(i)),this.sectionIndex.push(this.sections.length-1)):oe("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function a_(n,t,i,a,c,d,g,y,w,E,A,P,z,B,F){const q=Yc.fromFeature(n,c);P===ho.vertical&&q.verticalizePunctuation(z);let W=[];const le=function(ye,$e,qe,it,St,Ke){if(!ye)return[];const ut=[],dt=function(Dt,dn,Vt,en,Ot,pn){let Dn=0;for(let zn=0;zn<Dt.length();zn++){const Mn=Dt.getSection(zn);Dn+=Ex(Dt.getCharCode(zn),Mn,en,Ot,dn,pn)}return Dn/Math.max(1,Math.ceil(Dn/Vt))}(ye,$e,qe,it,St,Ke),vt=ye.text.indexOf("\u200B")>=0;let Ct=0;for(let Dt=0;Dt<ye.length();Dt++){const dn=ye.getSection(Dt),Vt=ye.getCharCode(Dt);if(fp[Vt]||(Ct+=Ex(Vt,dn,it,St,$e,Ke)),Dt<ye.length()-1){const en=!((Qe=Vt)<11904||!(Ah(Qe)||Of(Qe)||l(Qe)||Tl(Qe)||Vf(Qe)||Th(Qe)||Bf(Qe)||va(Qe)||Uf(Qe)||Mh(Qe)||Nf(Qe)||x(Qe)||El(Qe)||Ch(Qe)||Sh(Qe)||Ff(Qe)||Nc(Qe)||r(Qe)||qf(Qe)||jf(Qe)));(CA[Vt]||en||dn.imageName)&&ut.push(Sx(Dt+1,Ct,dt,ut,AA(Vt,ye.getCharCode(Dt+1),en&&vt),!1))}}var Qe;return Cx(Sx(ye.length(),Ct,dt,ut,0,!0))}(q,E,d,t,a,B),{processBidirectionalText:_e,processStyledBidirectionalText:ae}=je;if(_e&&q.sections.length===1){const ye=_e(q.toString(),le);for(const $e of ye){const qe=new Yc;qe.text=$e,qe.sections=q.sections;for(let it=0;it<$e.length;it++)qe.sectionIndex.push(0);W.push(qe)}}else if(ae){const ye=ae(q.text,q.sectionIndex,le);for(const $e of ye){const qe=new Yc;qe.text=$e[0],qe.sectionIndex=$e[1],qe.sections=q.sections,W.push(qe)}}else W=function(ye,$e){const qe=[],it=ye.text;let St=0;for(const Ke of $e)qe.push(ye.substring(St,Ke)),St=Ke;return St<it.length&&qe.push(ye.substring(St,it.length)),qe}(q,le);const de=[],we={positionedLines:de,text:q.toString(),top:A[1],bottom:A[1],left:A[0],right:A[0],writingMode:P,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(ye,$e,qe,it,St,Ke,ut,dt,vt,Ct,Qe,Dt){let dn=0,Vt=0,en=0;const Ot=dt==="right"?1:dt==="left"?0:.5;let pn=!1;for(const wn of St){const On=wn.getSections();for(const ri of On){if(ri.imageName)continue;const _i=$e[ri.fontStack];if(_i&&(pn=_i.ascender!==void 0&&_i.descender!==void 0,!pn))break}if(!pn)break}let Dn=0;for(const wn of St){wn.trim();const On=wn.getMaxScale(),ri=(On-1)*gr,_i={positionedGlyphs:[],lineOffset:0};ye.positionedLines[Dn]=_i;const pi=_i.positionedGlyphs;let yi=0;if(!wn.length()){Vt+=Ke,++Dn;continue}let vi=0,Pi=0;for(let ni=0;ni<wn.length();ni++){const Hi=wn.getSection(ni),Ni=wn.getSectionIndex(ni),Zn=wn.getCharCode(ni);let Si=Hi.scale,Qi=null,oi=null,Oi=null,Er=gr,sr=0;const ar=!(vt===ho.horizontal||!Qe&&!O(Zn)||Qe&&(fp[Zn]||(zn=Zn,wh(zn)||Df(zn)||Eh(zn)||h(zn)||_(zn))));if(Hi.imageName){const Or=it[Hi.imageName];if(!Or)continue;Oi=Hi.imageName,ye.iconsInText=ye.iconsInText||!0,oi=Or.paddedRect;const lr=Or.displaySize;Si=Si*gr/Dt,Qi={width:lr[0],height:lr[1],left:1,top:-3,advance:ar?lr[1]:lr[0],localGlyph:!1},sr=pn?-Qi.height*Si:On*gr-17-lr[1]*Si,Er=Qi.advance;const qs=(ar?lr[0]:lr[1])*Si-gr*On;qs>0&&qs>yi&&(yi=qs)}else{const Or=qe[Hi.fontStack];if(!Or)continue;Or[Zn]&&(oi=Or[Zn]);const lr=$e[Hi.fontStack];if(!lr)continue;const qs=lr.glyphs[Zn];if(!qs)continue;if(Qi=qs.metrics,Er=Zn!==8203?gr:0,pn){const su=lr.ascender!==void 0?Math.abs(lr.ascender):0,ld=lr.descender!==void 0?Math.abs(lr.descender):0,cd=(su+ld)*Si;vi<cd&&(vi=cd,Pi=(su-ld)/2*Si),sr=-su*Si}else sr=(On-Si)*gr-17}ar?(ye.verticalizable=!0,pi.push({glyph:Zn,imageName:Oi,x:dn,y:Vt+sr,vertical:ar,scale:Si,localGlyph:Qi.localGlyph,fontStack:Hi.fontStack,sectionIndex:Ni,metrics:Qi,rect:oi}),dn+=Er*Si+Ct):(pi.push({glyph:Zn,imageName:Oi,x:dn,y:Vt+sr,vertical:ar,scale:Si,localGlyph:Qi.localGlyph,fontStack:Hi.fontStack,sectionIndex:Ni,metrics:Qi,rect:oi}),dn+=Qi.advance*Si+Ct)}pi.length!==0&&(en=Math.max(dn-Ct,en),pn?Ax(pi,Ot,yi,Pi,Ke*On/2):Ax(pi,Ot,yi,0,Ke/2)),dn=0;const or=Ke*On+yi;_i.lineOffset=Math.max(yi,ri),Vt+=or,++Dn}var zn;const Mn=Vt,{horizontalAlign:gn,verticalAlign:ti}=l_(ut);(function(wn,On,ri,_i,pi,yi){const vi=(On-ri)*pi,Pi=-yi*_i;for(const or of wn)for(const ni of or.positionedGlyphs)ni.x+=vi,ni.y+=Pi})(ye.positionedLines,Ot,gn,ti,en,Mn),ye.top+=-ti*Mn,ye.bottom=ye.top+Mn,ye.left+=-gn*en,ye.right=ye.left+en,ye.hasBaseline=pn}(we,t,i,a,W,g,y,w,P,E,z,F),!function(ye){for(const $e of ye)if($e.positionedGlyphs.length!==0)return!1;return!0}(de)&&we}const fp={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},CA={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function Ex(n,t,i,a,c,d){if(t.imageName){const g=a[t.imageName];return g?g.displaySize[0]*t.scale*gr/d+c:0}{const g=i[t.fontStack],y=g&&g.glyphs[n];return y?y.metrics.advance*t.scale+c:0}}function Tx(n,t,i,a){const c=Math.pow(n-t,2);return a?n<t?c/2:2*c:c+Math.abs(i)*i}function AA(n,t,i){let a=0;return n===10&&(a-=1e4),i&&(a+=150),n!==40&&n!==65288||(a+=50),t!==41&&t!==65289||(a+=50),a}function Sx(n,t,i,a,c,d){let g=null,y=Tx(t,i,c,d);for(const w of a){const E=Tx(t-w.x,i,c,d)+w.badness;E<=y&&(g=w,y=E)}return{index:n,x:t,priorBreak:g,badness:y}}function Cx(n){return n?Cx(n.priorBreak).concat(n.index):[]}function l_(n){let t=.5,i=.5;switch(n){case"right":case"top-right":case"bottom-right":t=1;break;case"left":case"top-left":case"bottom-left":t=0}switch(n){case"bottom":case"bottom-right":case"bottom-left":i=1;break;case"top":case"top-right":case"top-left":i=0}return{horizontalAlign:t,verticalAlign:i}}function Ax(n,t,i,a,c){if(!(t||i||a||c))return;const d=n.length-1,g=n[d],y=(g.x+g.metrics.advance*g.scale)*t;for(let w=0;w<=d;w++)n[w].x-=y,n[w].y+=i+a+c}function MA(n,t,i){const{horizontalAlign:a,verticalAlign:c}=l_(i),d=t[0]-n.displaySize[0]*a,g=t[1]-n.displaySize[1]*c;return{image:n,top:g,bottom:g+n.displaySize[1],left:d,right:d+n.displaySize[0]}}function Mx(n,t,i,a,c,d){const g=n.image;let y;if(g.content){const W=g.content,le=g.pixelRatio||1;y=[W[0]/le,W[1]/le,g.displaySize[0]-W[2]/le,g.displaySize[1]-W[3]/le]}const w=t.left*d,E=t.right*d;let A,P,z,B;i==="width"||i==="both"?(B=c[0]+w-a[3],P=c[0]+E+a[1]):(B=c[0]+(w+E-g.displaySize[0])/2,P=B+g.displaySize[0]);const F=t.top*d,q=t.bottom*d;return i==="height"||i==="both"?(A=c[1]+F-a[0],z=c[1]+q+a[2]):(A=c[1]+(F+q-g.displaySize[1])/2,z=A+g.displaySize[1]),{image:g,top:A,right:P,bottom:z,left:B,collisionPadding:y}}class Us extends ce{constructor(t,i,a,c,d){super(t,i),this.angle=c,this.z=a,d!==void 0&&(this.segment=d)}clone(){return new Us(this.x,this.y,this.z,this.angle,this.segment)}}function Ix(n,t,i,a,c){if(t.segment===void 0)return!0;let d=t,g=t.segment+1,y=0;for(;y>-i/2;){if(g--,g<0)return!1;y-=n[g].dist(d),d=n[g]}y+=n[g].dist(n[g+1]),g++;const w=[];let E=0;for(;y<i/2;){const A=n[g],P=n[g+1];if(!P)return!1;let z=n[g-1].angleTo(A)-A.angleTo(P);for(z=Math.abs((z+3*Math.PI)%(2*Math.PI)-Math.PI),w.push({distance:y,angleDelta:z}),E+=z;y-w[0].distance>a;)E-=w.shift().angleDelta;if(E>c)return!1;g++,y+=A.dist(P)}return!0}function kx(n){let t=0;for(let i=0;i<n.length-1;i++)t+=n[i].dist(n[i+1]);return t}function Px(n,t,i){return n?.6*t*i:0}function zx(n,t){return Math.max(n?n.right-n.left:0,t?t.right-t.left:0)}function IA(n,t,i,a,c,d){const g=Px(i,c,d),y=zx(i,a)*d;let w=0;const E=kx(n)/2;for(let A=0;A<n.length-1;A++){const P=n[A],z=n[A+1],B=P.dist(z);if(w+B>E){const F=(E-w)/B,q=$n(P.x,z.x,F),W=$n(P.y,z.y,F),le=new Us(q,W,0,z.angleTo(P),A);return!g||Ix(n,le,y,g,t)?le:void 0}w+=B}}function kA(n,t,i,a,c,d,g,y,w){const E=Px(a,d,g),A=zx(a,c),P=A*g,z=n[0].x===0||n[0].x===w||n[0].y===0||n[0].y===w;return t-P<t/4&&(t=P+t/4),Lx(n,z?t/2*y%t:(A/2+2*d)*g*y%t,t,E,i,P,z,!1,w)}function Lx(n,t,i,a,c,d,g,y,w){const E=d/2,A=kx(n);let P=0,z=t-i,B=[];for(let F=0;F<n.length-1;F++){const q=n[F],W=n[F+1],le=q.dist(W),_e=W.angleTo(q);for(;z+i<P+le;){z+=i;const ae=(z-P)/le,de=$n(q.x,W.x,ae),we=$n(q.y,W.y,ae);if(de>=0&&de<w&&we>=0&&we<w&&z-E>=0&&z+E<=A){const ye=new Us(de,we,0,_e,F);ye._round(),a&&!Ix(n,ye,d,a,c)||B.push(ye)}}P+=le}return y||B.length||g||(B=Lx(n,P/2,i,a,c,d,g,!0,w)),B}function Rx(n,t,i,a,c){const d=[];for(let g=0;g<n.length;g++){const y=n[g];let w;for(let E=0;E<y.length-1;E++){let A=y[E],P=y[E+1];A.x<t&&P.x<t||(A.x<t?A=new ce(t,A.y+(t-A.x)/(P.x-A.x)*(P.y-A.y))._round():P.x<t&&(P=new ce(t,A.y+(t-A.x)/(P.x-A.x)*(P.y-A.y))._round()),A.y<i&&P.y<i||(A.y<i?A=new ce(A.x+(i-A.y)/(P.y-A.y)*(P.x-A.x),i)._round():P.y<i&&(P=new ce(A.x+(i-A.y)/(P.y-A.y)*(P.x-A.x),i)._round()),A.x>=a&&P.x>=a||(A.x>=a?A=new ce(a,A.y+(a-A.x)/(P.x-A.x)*(P.y-A.y))._round():P.x>=a&&(P=new ce(a,A.y+(a-A.x)/(P.x-A.x)*(P.y-A.y))._round()),A.y>=c&&P.y>=c||(A.y>=c?A=new ce(A.x+(c-A.y)/(P.y-A.y)*(P.x-A.x),c)._round():P.y>=c&&(P=new ce(A.x+(c-A.y)/(P.y-A.y)*(P.x-A.x),c)._round()),w&&A.equals(w[w.length-1])||(w=[A],d.push(w)),w.push(P)))))}}return d}Zt(Us,"Anchor");const Yh=1e20;function Dx(n,t,i,a,c,d,g,y,w){for(let E=t;E<t+a;E++)Ox(n,i*d+E,d,c,g,y,w);for(let E=i;E<i+c;E++)Ox(n,E*d+t,1,a,g,y,w)}function Ox(n,t,i,a,c,d,g){d[0]=0,g[0]=-Yh,g[1]=Yh,c[0]=n[t];for(let y=1,w=0,E=0;y<a;y++){c[y]=n[t+y*i];const A=y*y;do{const P=d[w];E=(c[y]-c[P]+A-P*P)/(y-P)/2}while(E<=g[w]&&--w>-1);w++,d[w]=y,g[w]=E,g[w+1]=Yh}for(let y=0,w=0;y<a;y++){for(;g[w+1]<y;)w++;const E=d[w],A=y-E;n[t+y*i]=c[E]+A*A}}const c_={none:0,ideographs:1,all:2};class Qc{constructor(t,i,a){this.requestManager=t,this.localGlyphMode=i,this.localFontFamily=a,this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(t){this.url=t}getGlyphs(t,i){const a=[];for(const c in t)for(const d of t[c])a.push({stack:c,id:d});At(a,({stack:c,id:d},g)=>{let y=this.entries[c];y||(y=this.entries[c]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let w=y.glyphs[d];if(w!==void 0)return void g(null,{stack:c,id:d,glyph:w});if(w=this._tinySDF(y,c,d),w)return y.glyphs[d]=w,void g(null,{stack:c,id:d,glyph:w});const E=Math.floor(d/256);if(256*E>65535)return void g(new Error("glyphs > 65535 not supported"));if(y.ranges[E])return void g(null,{stack:c,id:d,glyph:w});let A=y.requests[E];A||(A=y.requests[E]=[],Qc.loadGlyphRange(c,E,this.url,this.requestManager,(P,z)=>{if(z){y.ascender=z.ascender,y.descender=z.descender;for(const B in z.glyphs)this._doesCharSupportLocalGlyph(+B)||(y.glyphs[+B]=z.glyphs[+B]);y.ranges[E]=!0}for(const B of A)B(P,z);delete y.requests[E]})),A.push((P,z)=>{P?g(P):z&&g(null,{stack:c,id:d,glyph:z.glyphs[d]||null})})},(c,d)=>{if(c)i(c);else if(d){const g={};for(const{stack:y,id:w,glyph:E}of d)g[y]===void 0&&(g[y]={}),g[y].glyphs===void 0&&(g[y].glyphs={}),g[y].glyphs[w]=E&&{id:E.id,bitmap:E.bitmap.clone(),metrics:E.metrics},g[y].ascender=this.entries[y].ascender,g[y].descender=this.entries[y].descender;i(null,g)}})}_doesCharSupportLocalGlyph(t){return this.localGlyphMode!==c_.none&&(this.localGlyphMode===c_.all?!!this.localFontFamily:!!this.localFontFamily&&(Mh(t)||Ih(t)||El(t)||Nc(t)||va(t)))}_tinySDF(t,i,a){const c=this.localFontFamily;if(!c||!this._doesCharSupportLocalGlyph(a))return;let d=t.tinySDF;if(!d){let q="400";/bold/i.test(i)?q="900":/medium/i.test(i)?q="500":/light/i.test(i)&&(q="200"),d=t.tinySDF=new Qc.TinySDF({fontFamily:c,fontWeight:q,fontSize:48,buffer:6,radius:16}),d.fontWeight=q}if(this.localGlyphs[d.fontWeight][a])return this.localGlyphs[d.fontWeight][a];const g=String.fromCharCode(a),{data:y,width:w,height:E,glyphWidth:A,glyphHeight:P,glyphLeft:z,glyphTop:B,glyphAdvance:F}=d.draw(g);return this.localGlyphs[d.fontWeight][a]={id:a,bitmap:new Ns({width:w,height:E},y),metrics:{width:A/2,height:P/2,left:z/2,top:B/2-27,advance:F/2,localGlyph:!0}}}}function Bx(n,t,i,a){const c=[],d=n.image,g=d.pixelRatio,y=d.paddedRect.w-2,w=d.paddedRect.h-2,E=n.right-n.left,A=n.bottom-n.top,P=d.stretchX||[[0,y]],z=d.stretchY||[[0,w]],B=(Ke,ut)=>Ke+ut[1]-ut[0],F=P.reduce(B,0),q=z.reduce(B,0),W=y-F,le=w-q;let _e=0,ae=F,de=0,we=q,ye=0,$e=W,qe=0,it=le;if(d.content&&a){const Ke=d.content;_e=pp(P,0,Ke[0]),de=pp(z,0,Ke[1]),ae=pp(P,Ke[0],Ke[2]),we=pp(z,Ke[1],Ke[3]),ye=Ke[0]-_e,qe=Ke[1]-de,$e=Ke[2]-Ke[0]-ae,it=Ke[3]-Ke[1]-we}const St=(Ke,ut,dt,vt)=>{const Ct=mp(Ke.stretch-_e,ae,E,n.left),Qe=gp(Ke.fixed-ye,$e,Ke.stretch,F),Dt=mp(ut.stretch-de,we,A,n.top),dn=gp(ut.fixed-qe,it,ut.stretch,q),Vt=mp(dt.stretch-_e,ae,E,n.left),en=gp(dt.fixed-ye,$e,dt.stretch,F),Ot=mp(vt.stretch-de,we,A,n.top),pn=gp(vt.fixed-qe,it,vt.stretch,q),Dn=new ce(Ct,Dt),zn=new ce(Vt,Dt),Mn=new ce(Vt,Ot),gn=new ce(Ct,Ot),ti=new ce(Qe/g,dn/g),wn=new ce(en/g,pn/g),On=t*Math.PI/180;if(On){const pi=Math.sin(On),yi=Math.cos(On),vi=[yi,-pi,pi,yi];Dn._matMult(vi),zn._matMult(vi),gn._matMult(vi),Mn._matMult(vi)}const ri=Ke.stretch+Ke.fixed,_i=ut.stretch+ut.fixed;return{tl:Dn,tr:zn,bl:gn,br:Mn,tex:{x:d.paddedRect.x+1+ri,y:d.paddedRect.y+1+_i,w:dt.stretch+dt.fixed-ri,h:vt.stretch+vt.fixed-_i},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:ti,pixelOffsetBR:wn,minFontScaleX:$e/g/E,minFontScaleY:it/g/A,isSDF:i}};if(a&&(d.stretchX||d.stretchY)){const Ke=Fx(P,W,F),ut=Fx(z,le,q);for(let dt=0;dt<Ke.length-1;dt++){const vt=Ke[dt],Ct=Ke[dt+1];for(let Qe=0;Qe<ut.length-1;Qe++)c.push(St(vt,ut[Qe],Ct,ut[Qe+1]))}}else c.push(St({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:y+1},{fixed:0,stretch:w+1}));return c}function pp(n,t,i){let a=0;for(const c of n)a+=Math.max(t,Math.min(i,c[1]))-Math.max(t,Math.min(i,c[0]));return a}function Fx(n,t,i){const a=[{fixed:-1,stretch:0}];for(const[c,d]of n){const g=a[a.length-1];a.push({fixed:c-g.stretch,stretch:g.stretch}),a.push({fixed:c-g.stretch,stretch:g.stretch+(d-c)})}return a.push({fixed:t+1,stretch:i}),a}function mp(n,t,i,a){return n/t*i+a}function gp(n,t,i,a){return n-t*i/a}function PA(n,t,i,a){const c=t+n.positionedLines[a].lineOffset;return a===0?i+c/2:i+(c+(t+n.positionedLines[a-1].lineOffset))/2}Qc.loadGlyphRange=function(n,t,i,a,c){const d=256*t,g=d+255,y=a.transformRequest(a.normalizeGlyphsURL(i).replace("{fontstack}",n).replace("{range}",`${d}-${g}`),Hn.Glyphs);tr(y,(w,E)=>{if(w)c(w);else if(E){const A={},P=function(z){return new Xh(z).readFields(EA,{})}(E);for(const z of P.glyphs)A[z.id]=z;c(null,{glyphs:A,ascender:P.ascender,descender:P.descender})}})},Qc.TinySDF=class{constructor({fontSize:n=24,buffer:t=3,radius:i=8,cutoff:a=.25,fontFamily:c="sans-serif",fontWeight:d="normal",fontStyle:g="normal"}={}){this.buffer=t,this.cutoff=a,this.radius=i;const y=this.size=n+4*t,w=this._createCanvas(y),E=this.ctx=w.getContext("2d",{willReadFrequently:!0});E.font=`${g} ${d} ${n}px ${c}`,E.textBaseline="alphabetic",E.textAlign="left",E.fillStyle="black",this.gridOuter=new Float64Array(y*y),this.gridInner=new Float64Array(y*y),this.f=new Float64Array(y),this.z=new Float64Array(y+1),this.v=new Uint16Array(y)}_createCanvas(n){const t=document.createElement("canvas");return t.width=t.height=n,t}draw(n){const{width:t,actualBoundingBoxAscent:i,actualBoundingBoxDescent:a,actualBoundingBoxLeft:c,actualBoundingBoxRight:d}=this.ctx.measureText(n),g=Math.ceil(i),y=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(d-c))),w=Math.min(this.size-this.buffer,g+Math.ceil(a)),E=y+2*this.buffer,A=w+2*this.buffer,P=Math.max(E*A,0),z=new Uint8ClampedArray(P),B={data:z,width:E,height:A,glyphWidth:y,glyphHeight:w,glyphTop:g,glyphLeft:0,glyphAdvance:t};if(y===0||w===0)return B;const{ctx:F,buffer:q,gridInner:W,gridOuter:le}=this;F.clearRect(q,q,y,w),F.fillText(n,q,q+g);const _e=F.getImageData(q,q,y,w);le.fill(Yh,0,P),W.fill(0,0,P);for(let ae=0;ae<w;ae++)for(let de=0;de<y;de++){const we=_e.data[4*(ae*y+de)+3]/255;if(we===0)continue;const ye=(ae+q)*E+de+q;if(we===1)le[ye]=0,W[ye]=Yh;else{const $e=.5-we;le[ye]=$e>0?$e*$e:0,W[ye]=$e<0?$e*$e:0}}Dx(le,0,0,E,A,E,this.f,this.v,this.z),Dx(W,q,q,y,w,E,this.f,this.v,this.z);for(let ae=0;ae<P;ae++){const de=Math.sqrt(le[ae])-Math.sqrt(W[ae]);z[ae]=Math.round(255-255*(de/this.radius+this.cutoff))}return B}};class zA{constructor(t=[],i=LA){if(this.data=t,this.length=this.data.length,this.compare=i,this.length>0)for(let a=(this.length>>1)-1;a>=0;a--)this._down(a)}push(t){this.data.push(t),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const t=this.data[0],i=this.data.pop();return this.length--,this.length>0&&(this.data[0]=i,this._down(0)),t}peek(){return this.data[0]}_up(t){const{data:i,compare:a}=this,c=i[t];for(;t>0;){const d=t-1>>1,g=i[d];if(a(c,g)>=0)break;i[t]=g,t=d}i[t]=c}_down(t){const{data:i,compare:a}=this,c=this.length>>1,d=i[t];for(;t<c;){let g=1+(t<<1),y=i[g];const w=g+1;if(w<this.length&&a(i[w],y)<0&&(g=w,y=i[w]),a(y,d)>=0)break;i[t]=y,t=g}i[t]=d}}function LA(n,t){return n<t?-1:n>t?1:0}function RA(n,t=1,i=!1){let a=1/0,c=1/0,d=-1/0,g=-1/0;const y=n[0];for(let B=0;B<y.length;B++){const F=y[B];(!B||F.x<a)&&(a=F.x),(!B||F.y<c)&&(c=F.y),(!B||F.x>d)&&(d=F.x),(!B||F.y>g)&&(g=F.y)}const w=Math.min(d-a,g-c);let E=w/2;const A=new zA([],DA);if(w===0)return new ce(a,c);for(let B=a;B<d;B+=w)for(let F=c;F<g;F+=w)A.push(new Jc(B+E,F+E,E,n));let P=function(B){let F=0,q=0,W=0;const le=B[0];for(let _e=0,ae=le.length,de=ae-1;_e<ae;de=_e++){const we=le[_e],ye=le[de],$e=we.x*ye.y-ye.x*we.y;q+=(we.x+ye.x)*$e,W+=(we.y+ye.y)*$e,F+=3*$e}return new Jc(q/F,W/F,0,B)}(n),z=A.length;for(;A.length;){const B=A.pop();(B.d>P.d||!P.d)&&(P=B,i&&console.log("found best %d after %d probes",Math.round(1e4*B.d)/1e4,z)),B.max-P.d<=t||(E=B.h/2,A.push(new Jc(B.p.x-E,B.p.y-E,E,n)),A.push(new Jc(B.p.x+E,B.p.y-E,E,n)),A.push(new Jc(B.p.x-E,B.p.y+E,E,n)),A.push(new Jc(B.p.x+E,B.p.y+E,E,n)),z+=4)}return i&&(console.log(`num probes: ${z}`),console.log(`best distance: ${P.d}`)),P.p}function DA(n,t){return t.max-n.max}function Jc(n,t,i,a){this.p=new ce(n,t),this.h=i,this.d=function(c,d){let g=!1,y=1/0;for(let w=0;w<d.length;w++){const E=d[w];for(let A=0,P=E.length,z=P-1;A<P;z=A++){const B=E[A],F=E[z];B.y>c.y!=F.y>c.y&&c.x<(F.x-B.x)*(c.y-B.y)/(F.y-B.y)+B.x&&(g=!g),y=Math.min(y,E0(c,B,F))}}return(g?1:-1)*Math.sqrt(y)}(this.p,a),this.max=this.d+this.h*Math.SQRT2}const u_=Number.POSITIVE_INFINITY,OA=Math.sqrt(2);function Nx(n,[t,i]){let a=0,c=0;if(i===u_){t<0&&(t=0);const d=t/OA;switch(n){case"top-right":case"top-left":c=d-7;break;case"bottom-right":case"bottom-left":c=7-d;break;case"bottom":c=7-t;break;case"top":c=t-7}switch(n){case"top-right":case"bottom-right":a=-d;break;case"top-left":case"bottom-left":a=d;break;case"left":a=t;break;case"right":a=-t}}else{switch(t=Math.abs(t),i=Math.abs(i),n){case"top-right":case"top-left":case"top":c=i-7;break;case"bottom-right":case"bottom-left":case"bottom":c=7-i}switch(n){case"top-right":case"bottom-right":case"right":a=-t;break;case"top-left":case"bottom-left":case"left":a=t}}return[a,c]}function BA(n,t,i,a,c,d,g,y,w,E){n.createArrays(),n.tilePixelRatio=_n/(512*n.overscaling),n.compareText={},n.iconsNeedLinear=!1;const A=n.layers[0].layout,P=n.layers[0]._unevaluatedLayout._values,z={};if(n.textSizeData.kind==="composite"){const{minZoom:q,maxZoom:W}=n.textSizeData;z.compositeTextSizes=[P["text-size"].possiblyEvaluate(new Le(q),y),P["text-size"].possiblyEvaluate(new Le(W),y)]}if(n.iconSizeData.kind==="composite"){const{minZoom:q,maxZoom:W}=n.iconSizeData;z.compositeIconSizes=[P["icon-size"].possiblyEvaluate(new Le(q),y),P["icon-size"].possiblyEvaluate(new Le(W),y)]}z.layoutTextSize=P["text-size"].possiblyEvaluate(new Le(w+1),y),z.layoutIconSize=P["icon-size"].possiblyEvaluate(new Le(w+1),y),z.textMaxSize=P["text-size"].possiblyEvaluate(new Le(18),y);const B=A.get("text-rotation-alignment")==="map"&&A.get("symbol-placement")!=="point",F=A.get("text-size");for(const q of n.features){const W=A.get("text-font").evaluate(q,{},y).join(","),le=F.evaluate(q,{},y),_e=z.layoutTextSize.evaluate(q,{},y),ae=(z.layoutIconSize.evaluate(q,{},y),{horizontal:{},vertical:void 0}),de=q.text;let we,ye=[0,0];if(de){const it=de.toString(),St=A.get("text-letter-spacing").evaluate(q,{},y)*gr,Ke=A.get("text-line-height").evaluate(q,{},y)*gr,ut=C(it)?St:0,dt=A.get("text-anchor").evaluate(q,{},y),vt=A.get("text-variable-anchor");if(!vt){const Vt=A.get("text-radial-offset").evaluate(q,{},y);ye=Vt?Nx(dt,[Vt*gr,u_]):A.get("text-offset").evaluate(q,{},y).map(en=>en*gr)}let Ct=B?"center":A.get("text-justify").evaluate(q,{},y);const Qe=A.get("symbol-placement")==="point",Dt=Qe?A.get("text-max-width").evaluate(q,{},y)*gr:1/0,dn=Vt=>{n.allowVerticalPlacement&&T(it)&&(ae.vertical=a_(de,t,i,c,W,Dt,Ke,dt,Vt,ut,ye,ho.vertical,!0,_e,le))};if(!B&&vt){const Vt=Ct==="auto"?vt.map(Ot=>h_(Ot)):[Ct];let en=!1;for(let Ot=0;Ot<Vt.length;Ot++){const pn=Vt[Ot];if(!ae.horizontal[pn])if(en)ae.horizontal[pn]=ae.horizontal[0];else{const Dn=a_(de,t,i,c,W,Dt,Ke,"center",pn,ut,ye,ho.horizontal,!1,_e,le);Dn&&(ae.horizontal[pn]=Dn,en=Dn.positionedLines.length===1)}}dn("left")}else{if(Ct==="auto"&&(Ct=h_(dt)),Qe||A.get("text-writing-mode").indexOf("horizontal")>=0||!T(it)){const Vt=a_(de,t,i,c,W,Dt,Ke,dt,Ct,ut,ye,ho.horizontal,!1,_e,le);Vt&&(ae.horizontal[Ct]=Vt)}dn(Qe?"left":Ct)}}let $e=!1;if(q.icon&&q.icon.name){const it=a[q.icon.name];it&&(we=MA(c[q.icon.name],A.get("icon-offset").evaluate(q,{},y),A.get("icon-anchor").evaluate(q,{},y)),$e=it.sdf,n.sdfIcons===void 0?n.sdfIcons=it.sdf:n.sdfIcons!==it.sdf&&oe("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(it.pixelRatio!==n.pixelRatio||A.get("icon-rotate").constantOr(1)!==0)&&(n.iconsNeedLinear=!0))}const qe=Ux(ae.horizontal)||ae.vertical;n.iconsInText||(n.iconsInText=!!qe&&qe.iconsInText),(qe||we)&&FA(n,q,ae,we,a,z,_e,0,ye,$e,g,y,E)}d&&n.generateCollisionDebugBuffers(w,n.collisionBoxArray)}function h_(n){switch(n){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function FA(n,t,i,a,c,d,g,y,w,E,A,P,z){let B=d.textMaxSize.evaluate(t,{},P);B===void 0&&(B=g);const F=n.layers[0].layout,q=F.get("icon-offset").evaluate(t,{},P),W=Ux(i.horizontal)||i.vertical,le=z.name==="globe",_e=g/24,ae=n.tilePixelRatio*B/24,de=(ut=n.overscaling,n.zoom>18&&ut>2&&(ut>>=1),Math.max(_n/(512*ut),1)*F.get("symbol-spacing")),we=F.get("text-padding")*n.tilePixelRatio,ye=F.get("icon-padding")*n.tilePixelRatio,$e=Ie(F.get("text-max-angle")),qe=F.get("text-rotation-alignment")==="map"&&F.get("symbol-placement")!=="point",it=F.get("icon-rotation-alignment")==="map"&&F.get("symbol-placement")!=="point",St=F.get("symbol-placement"),Ke=de/2;var ut;const dt=F.get("icon-text-fit");let vt;a&&dt!=="none"&&(n.allowVerticalPlacement&&i.vertical&&(vt=Mx(a,i.vertical,dt,F.get("icon-text-fit-padding"),q,_e)),W&&(a=Mx(a,W,dt,F.get("icon-text-fit-padding"),q,_e)));const Ct=(Qe,Dt,dn)=>{if(Dt.x<0||Dt.x>=_n||Dt.y<0||Dt.y>=_n)return;let Vt=null;if(le){const{x:en,y:Ot,z:pn}=z.projectTilePoint(Dt.x,Dt.y,dn);Vt={anchor:new Us(en,Ot,pn,0,void 0),up:z.upVector(dn,Dt.x,Dt.y)}}(function(en,Ot,pn,Dn,zn,Mn,gn,ti,wn,On,ri,_i,pi,yi,vi,Pi,or,ni,Hi,Ni,Zn,Si,Qi,oi,Oi){const Er=en.addToLineVertexArray(Ot,Dn);let sr,ar,Or,lr,qs,su,ld,cd=0,Sb=0,Cb=0,Ab=0,M_=-1,I_=-1;const _s={};let Mb=Vc.exports("");const Bl=pn?pn.anchor:Ot;let k_=0,P_=0;if(wn._unevaluatedLayout.getValue("text-radial-offset")===void 0?[k_,P_]=wn.layout.get("text-offset").evaluate(Zn,{},Oi).map(Jr=>Jr*gr):(k_=wn.layout.get("text-radial-offset").evaluate(Zn,{},Oi)*gr,P_=u_),en.allowVerticalPlacement&&zn.vertical){const Jr=zn.vertical;if(vi)su=d_(Jr),ti&&(ld=d_(ti));else{const eo=wn.layout.get("text-rotate").evaluate(Zn,{},Oi)+90;Or=_p(On,Bl,Ot,ri,_i,pi,Jr,yi,eo,Pi),ti&&(lr=_p(On,Bl,Ot,ri,_i,pi,ti,ni,eo))}}if(Mn){const Jr=wn.layout.get("icon-rotate").evaluate(Zn,{},Oi),eo=wn.layout.get("icon-text-fit")!=="none",ud=Bx(Mn,Jr,Qi,eo),L_=ti?Bx(ti,Jr,Qi,eo):void 0;ar=_p(On,Bl,Ot,ri,_i,pi,Mn,ni,Jr),cd=4*ud.length;const Ib=en.iconSizeData;let Fl=null;Ib.kind==="source"?(Fl=[ds*wn.layout.get("icon-size").evaluate(Zn,{},Oi)],Fl[0]>Ta&&oe(`${en.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):Ib.kind==="composite"&&(Fl=[ds*Si.compositeIconSizes[0].evaluate(Zn,{},Oi),ds*Si.compositeIconSizes[1].evaluate(Zn,{},Oi)],(Fl[0]>Ta||Fl[1]>Ta)&&oe(`${en.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),en.addSymbols(en.icon,ud,Fl,Ni,Hi,Zn,!1,pn,Ot,Er.lineStartIndex,Er.lineLength,-1,oi,Oi),M_=en.icon.placedSymbolArray.length-1,L_&&(Sb=4*L_.length,en.addSymbols(en.icon,L_,Fl,Ni,Hi,Zn,ho.vertical,pn,Ot,Er.lineStartIndex,Er.lineLength,-1,oi,Oi),I_=en.icon.placedSymbolArray.length-1)}for(const Jr in zn.horizontal){const eo=zn.horizontal[Jr];sr||(Mb=Vc.exports(eo.text),vi?qs=d_(eo):sr=_p(On,Bl,Ot,ri,_i,pi,eo,yi,wn.layout.get("text-rotate").evaluate(Zn,{},Oi),Pi));const ud=eo.positionedLines.length===1;if(Cb+=Vx(en,pn,Ot,eo,gn,wn,vi,Zn,Pi,Er,zn.vertical?ho.horizontal:ho.horizontalOnly,ud?Object.keys(zn.horizontal):[Jr],_s,M_,Si,oi,Oi),ud)break}zn.vertical&&(Ab+=Vx(en,pn,Ot,zn.vertical,gn,wn,vi,Zn,Pi,Er,ho.vertical,["vertical"],_s,I_,Si,oi,Oi));let ka=-1;const z_=(Jr,eo)=>Jr?Math.max(Jr,eo):eo;ka=z_(qs,ka),ka=z_(su,ka),ka=z_(ld,ka);const gM=ka>-1?1:0;en.glyphOffsetArray.length>=Ca.MAX_GLYPHS&&oe("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Zn.sortKey!==void 0&&en.addToSortKeyRanges(en.symbolInstances.length,Zn.sortKey),en.symbolInstances.emplaceBack(Bl.x,Bl.y,Bl.z,Ot.x,Ot.y,_s.right>=0?_s.right:-1,_s.center>=0?_s.center:-1,_s.left>=0?_s.left:-1,_s.vertical>=0?_s.vertical:-1,M_,I_,Mb,sr!==void 0?sr:en.collisionBoxArray.length,sr!==void 0?sr+1:en.collisionBoxArray.length,Or!==void 0?Or:en.collisionBoxArray.length,Or!==void 0?Or+1:en.collisionBoxArray.length,ar!==void 0?ar:en.collisionBoxArray.length,ar!==void 0?ar+1:en.collisionBoxArray.length,lr||en.collisionBoxArray.length,lr?lr+1:en.collisionBoxArray.length,ri,Cb,Ab,cd,Sb,gM,0,k_,P_,ka)})(n,Dt,Vt,Qe,i,a,c,vt,n.layers[0],n.collisionBoxArray,t.index,t.sourceLayerIndex,n.index,we,qe,w,0,ye,it,q,t,d,E,A,P)};if(St==="line")for(const Qe of Rx(t.geometry,0,0,_n,_n)){const Dt=kA(Qe,de,$e,i.vertical||W,a,24,ae,n.overscaling,_n);for(const dn of Dt){const Vt=W;Vt&&NA(n,Vt.text,Ke,dn)||Ct(Qe,dn,P)}}else if(St==="line-center"){for(const Qe of t.geometry)if(Qe.length>1){const Dt=IA(Qe,$e,i.vertical||W,a,24,ae);Dt&&Ct(Qe,Dt,P)}}else if(t.type==="Polygon")for(const Qe of Jg(t.geometry,0)){const Dt=RA(Qe,16);Ct(Qe[0],new Us(Dt.x,Dt.y,0,0,void 0),P)}else if(t.type==="LineString")for(const Qe of t.geometry)Ct(Qe,new Us(Qe[0].x,Qe[0].y,0,0,void 0),P);else if(t.type==="Point")for(const Qe of t.geometry)for(const Dt of Qe)Ct([Dt],new Us(Dt.x,Dt.y,0,0,void 0),P)}const Ta=32640;function Vx(n,t,i,a,c,d,g,y,w,E,A,P,z,B,F,q,W){const le=function(de,we,ye,$e,qe,it,St,Ke){const ut=[];if(we.positionedLines.length===0)return ut;const dt=$e.layout.get("text-rotate").evaluate(it,{})*Math.PI/180,vt=function(Vt){const en=Vt[0],Ot=Vt[1],pn=en*Ot;return pn>0?[en,-Ot]:pn<0?[-en,Ot]:en===0?[Ot,en]:[Ot,-en]}(ye);let Ct=Math.abs(we.top-we.bottom);for(const Vt of we.positionedLines)Ct-=Vt.lineOffset;const Qe=we.positionedLines.length,Dt=Ct/Qe;let dn=we.top-ye[1];for(let Vt=0;Vt<Qe;++Vt){const en=we.positionedLines[Vt];dn=PA(we,Dt,dn,Vt);for(const Ot of en.positionedGlyphs){if(!Ot.rect)continue;const pn=Ot.rect||{};let Dn=4,zn=!0,Mn=1,gn=0;if(Ot.imageName){const oi=St[Ot.imageName];if(!oi)continue;if(oi.sdf){oe("SDF images are not supported in formatted text and will be ignored.");continue}zn=!1,Mn=oi.pixelRatio,Dn=1/Mn}const ti=(qe||Ke)&&Ot.vertical,wn=Ot.metrics.advance*Ot.scale/2,On=Ot.metrics,ri=Ot.rect;if(ri===null)continue;Ke&&we.verticalizable&&(gn=Ot.imageName?wn-Ot.metrics.width*Ot.scale/2:0);const _i=qe?[Ot.x+wn,Ot.y]:[0,0];let pi=[0,0],yi=[0,0],vi=!1;qe||(ti?(yi=[Ot.x+wn+vt[0],Ot.y+vt[1]-gn],vi=!0):pi=[Ot.x+wn+ye[0],Ot.y+ye[1]-gn]);const Pi=ri.w*Ot.scale/(Mn*(Ot.localGlyph?2:1)),or=ri.h*Ot.scale/(Mn*(Ot.localGlyph?2:1));let ni,Hi,Ni,Zn;if(ti){const oi=Ot.y-dn,Oi=new ce(-wn,wn-oi),Er=-Math.PI/2,sr=new ce(...yi);ni=new ce(-wn+pi[0],pi[1]),ni._rotateAround(Er,Oi)._add(sr),ni.x+=-oi+wn,ni.y-=(On.left-Dn)*Ot.scale;const ar=Ot.imageName?On.advance*Ot.scale:gr*Ot.scale,Or=String.fromCharCode(Ot.glyph);dA(Or)?ni.x+=(1-Dn)*Ot.scale:fA(Or)?ni.x+=ar-On.height*Ot.scale+(-Dn-1)*Ot.scale:ni.x+=Ot.imageName||On.width+2*Dn===ri.w&&On.height+2*Dn===ri.h?(ar-or)/2:(ar-(On.height+2*Dn)*Ot.scale)/2,Hi=new ce(ni.x,ni.y-Pi),Ni=new ce(ni.x+or,ni.y),Zn=new ce(ni.x+or,ni.y-Pi)}else{const oi=(On.left-Dn)*Ot.scale-wn+pi[0],Oi=(-On.top-Dn)*Ot.scale+pi[1],Er=oi+Pi,sr=Oi+or;ni=new ce(oi,Oi),Hi=new ce(Er,Oi),Ni=new ce(oi,sr),Zn=new ce(Er,sr)}if(dt){let oi;oi=qe?new ce(0,0):vi?new ce(vt[0],vt[1]):new ce(ye[0],ye[1]),ni._rotateAround(dt,oi),Hi._rotateAround(dt,oi),Ni._rotateAround(dt,oi),Zn._rotateAround(dt,oi)}const Si=new ce(0,0),Qi=new ce(0,0);ut.push({tl:ni,tr:Hi,bl:Ni,br:Zn,tex:pn,writingMode:we.writingMode,glyphOffset:_i,sectionIndex:Ot.sectionIndex,isSDF:zn,pixelOffsetTL:Si,pixelOffsetBR:Qi,minFontScaleX:0,minFontScaleY:0})}}return ut}(0,a,w,d,g,y,c,n.allowVerticalPlacement),_e=n.textSizeData;let ae=null;_e.kind==="source"?(ae=[ds*d.layout.get("text-size").evaluate(y,{},W)],ae[0]>Ta&&oe(`${n.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):_e.kind==="composite"&&(ae=[ds*F.compositeTextSizes[0].evaluate(y,{},W),ds*F.compositeTextSizes[1].evaluate(y,{},W)],(ae[0]>Ta||ae[1]>Ta)&&oe(`${n.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),n.addSymbols(n.text,le,ae,w,g,y,A,t,i,E.lineStartIndex,E.lineLength,B,q,W);for(const de of P)z[de]=n.text.placedSymbolArray.length-1;return 4*le.length}function Ux(n){for(const t in n)return n[t];return null}function _p(n,t,i,a,c,d,g,y,w,E){let A=g.top,P=g.bottom,z=g.left,B=g.right;const F=g.collisionPadding;if(F&&(z-=F[0],A-=F[1],B+=F[2],P+=F[3]),w){const q=new ce(z,A),W=new ce(B,A),le=new ce(z,P),_e=new ce(B,P),ae=Ie(w);let de=new ce(0,0);E&&(de=new ce(E[0],E[1])),q._rotateAround(ae,de),W._rotateAround(ae,de),le._rotateAround(ae,de),_e._rotateAround(ae,de),z=Math.min(q.x,W.x,le.x,_e.x),B=Math.max(q.x,W.x,le.x,_e.x),A=Math.min(q.y,W.y,le.y,_e.y),P=Math.max(q.y,W.y,le.y,_e.y)}return n.emplaceBack(t.x,t.y,t.z,i.x,i.y,z,A,B,P,y,a,c,d),n.length-1}function d_(n){n.collisionPadding&&(n.top-=n.collisionPadding[1],n.bottom+=n.collisionPadding[3]);const t=n.bottom-n.top;return t>0?Math.max(10,t):null}function NA(n,t,i,a){const c=n.compareText;if(t in c){const d=c[t];for(let g=d.length-1;g>=0;g--)if(a.dist(d[g])<i)return!0}else c[t]=[];return c[t].push(a),!1}const VA=Gt([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:jx}=VA,qx=Gt([{name:"a_pos_3",components:3,type:"Int16"}]);var Qh=Gt([{name:"a_pos",type:"Int16",components:2}]);const js=_n/Math.PI/2,f_=2*To(1,0)*js*Math.PI,eu=64,tu=[eu,32,16],Co=-js,Ao=js,UA=[new Rr([Co,Co,Co],[Ao,Ao,Ao]),new Rr([Co,Co,Co],[0,0,Ao]),new Rr([0,Co,Co],[Ao,0,Ao]),new Rr([Co,0,Co],[0,Ao,Ao]),new Rr([0,0,Co],[Ao,Ao,Ao])];function $x(n,t,i,a=!0){const c=uo([],n._camera.position,n.worldSize),d=[t,i,1,1];zl(d,d,n.pixelMatrixInverse),D0(d,d,1/d[3]);const g=Lr([],Zo([],d,c)),y=n.globeMatrix,w=[y[12],y[13],y[14]],E=Zo([],w,c),A=Lh(E),P=Lr([],E),z=n.worldSize/(2*Math.PI),B=So(P,g),F=Math.asin(z/A);if(F<Math.acos(B)){if(!a)return null;const St=[],Ke=[];uo(St,g,A/B),Lr(Ke,Zo(Ke,St,E)),Lr(g,Fs(g,E,uo(g,Ke,Math.tan(F)*A)))}const q=[];new Gg(c,g).closestPointOnSphere(w,z,q);const W=Lr([],bt(y,0)),le=Lr([],bt(y,1)),_e=Lr([],bt(y,2)),ae=So(W,q),de=So(le,q),we=So(_e,q),ye=ke(Math.asin(-de/z));let $e=ke(Math.atan2(ae,we));$e=n.center.lng+function(St,Ke){const ut=(Ke-St+180)%360-180;return ut<-180?ut+360:ut}(n.center.lng,$e);const qe=cs($e),it=lt(us(ye),0,1);return new jc(qe,it)}class jA{constructor(t,i,a){this.a=Zo([],t,a),this.b=Zo([],i,a),this.center=a;const c=Lr([],this.a),d=Lr([],this.b);this.angle=Math.acos(So(c,d))}}function p_(n,t){if(n.angle===0)return null;let i;return i=n.a[t]===0?1/n.angle*.5*Math.PI:1/n.angle*Math.atan(n.b[t]/n.a[t]/Math.sin(n.angle)-1/Math.tan(n.angle)),i<0||i>1?null:function(a,c,d,g){const y=Math.sin(d);return a*(Math.sin((1-g)*d)/y)+c*(Math.sin(g*d)/y)}(n.a[t],n.b[t],n.angle,lt(i,0,1))+n.center[t]}function fs(n){if(n.z<=1)return UA[n.z+2*n.y+n.x];const t=m_(yp(n));return Rr.fromPoints(t)}function Rl(n,t,i){return uo(n,n,1-i),Oh(n,n,t,i)}function Gx(n,t){const i=iu(t.zoom);if(i===0)return fs(n);const a=yp(n),c=m_(a),d=cs(a.getWest())*t.worldSize,g=cs(a.getEast())*t.worldSize,y=us(a.getNorth())*t.worldSize,w=us(a.getSouth())*t.worldSize,E=[d,y,0],A=[g,y,0],P=[d,w,0],z=[g,w,0],B=Vg([],t.globeMatrix);return Di(E,E,B),Di(A,A,B),Di(P,P,B),Di(z,z,B),c[0]=Rl(c[0],P,i),c[1]=Rl(c[1],z,i),c[2]=Rl(c[2],A,i),c[3]=Rl(c[3],E,i),Rr.fromPoints(c)}function Zx(n,t,i){for(const a of n)Di(a,a,t),uo(a,a,i)}function qA(n,t,i){const a=t/n.worldSize,c=n.globeMatrix;if(i.z<=1){const qe=fs(i).getCorners();return Zx(qe,c,a),Rr.fromPoints(qe)}const d=yp(i),g=m_(d);Zx(g,c,a);const y=Number.MAX_VALUE,w=[-y,-y,-y],E=[y,y,y];if(d.contains(n.center)){for(const St of g)Rh(E,E,St),Dh(w,w,St);w[2]=0;const qe=n.point,it=[qe.x*a,qe.y*a,0];return Rh(E,E,it),Dh(w,w,it),new Rr(E,w)}const A=[c[12]*a,c[13]*a,c[14]*a],P=d.getCenter(),z=lt(n.center.lat,-85.051129,hs),B=lt(P.lat,-85.051129,hs),F=cs(n.center.lng),q=us(z);let W=F-cs(P.lng);const le=q-us(B);W>.5?W-=1:W<-.5&&(W+=1);let _e=0;Math.abs(W)>Math.abs(le)?_e=W>=0?1:3:(_e=le>=0?0:2,Oh(A,A,[c[4]*a,c[5]*a,c[6]*a],-Math.sin(Ie(le>=0?d.getSouth():d.getNorth()))*js));const ae=g[_e],de=g[(_e+1)%4],we=new jA(ae,de,A),ye=[p_(we,0)||ae[0],p_(we,1)||ae[1],p_(we,2)||ae[2]],$e=iu(n.zoom);if($e>0){const qe=function({x:St,y:Ke,z:ut},dt,vt,Ct,Qe){const Dt=1/(1<<ut);let dn=St*Dt,Vt=dn+Dt,en=Ke*Dt,Ot=en+Dt,pn=0;const Dn=(dn+Vt)/2-Ct;return Dn>.5?pn=-1:Dn<-.5&&(pn=1),dn=((dn+pn)*dt-(Ct*=dt))*vt+Ct,Vt=((Vt+pn)*dt-Ct)*vt+Ct,en=(en*dt-(Qe*=dt))*vt+Qe,Ot=(Ot*dt-Qe)*vt+Qe,[[dn,Ot,0],[Vt,Ot,0],[Vt,en,0],[dn,en,0]]}(i,t,n._pixelsPerMercatorPixel,F,q);for(let St=0;St<g.length;St++)Rl(g[St],qe[St],$e);const it=Fs([],qe[_e],qe[(_e+1)%4]);uo(it,it,.5),Rl(ye,it,$e)}for(const qe of g)Rh(E,E,qe),Dh(w,w,qe);return E[2]=Math.min(ae[2],de[2]),Rh(E,E,ye),Dh(w,w,ye),new Rr(E,w)}function yp({x:n,y:t,z:i}){const a=1/(1<<i),c=new jn(co(n*a),mr((t+1)*a)),d=new jn(co((n+1)*a),mr(t*a));return new Ea(c,d)}function m_(n){const t=Ie(n.getNorth()),i=Ie(n.getSouth()),a=Math.cos(t),c=Math.cos(i),d=Math.sin(t),g=Math.sin(i),y=n.getWest(),w=n.getEast();return[nu(c,g,y),nu(c,g,w),nu(a,d,w),nu(a,d,y)]}function nu(n,t,i,a=js){return i=Ie(i),[n*Math.sin(i)*a,-t*a,n*Math.cos(i)*a]}function Jh(n,t,i){return nu(Math.cos(Ie(n)),Math.sin(Ie(n)),t,i)}function ed(n,t,i,a){const c=1<<i.z,d=(n/_n+i.x)/c;return Jh(mr((t/_n+i.y)/c),co(d),a)}function vp({min:n,max:t}){return 16383/Math.max(t[0]-n[0],t[1]-n[1],t[2]-n[2])}const Wx=new Float64Array(16);function td(n){const t=vp(n),i=k0(Wx,[t,t,t]);return zh(i,i,((a=[])[0]=-(c=n.min)[0],a[1]=-c[1],a[2]=-c[2],a));var a,c}function g_(n){const t=(a=n.min,(i=Wx)[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=a[0],i[13]=a[1],i[14]=a[2],i[15]=1,i);var i,a;const c=1/vp(n);return Pl(t,t,[c,c,c])}function Hx(n,t,i,a,c){const d=function(w){const E=_n/(2*Math.PI);return w/(2*Math.PI)/E}(i),g=[n,t,-i/(2*Math.PI)],y=Go(new Float64Array(16));return zh(y,y,g),Pl(y,y,[d,d,d]),Ug(y,y,Ie(-c)),ep(y,y,Ie(-a)),y}function iu(n){return Xt(5,6,n)}function Xx(n,t){const i=Jh(t.lat,t.lng),a=function(F){const q=Jh(F._center.lat,F._center.lng);let W=$g([],$c(0,1,0),q);const le=P0([],-F.angle,q);W=Di(W,W,le),P0(le,-F._pitch,W);const _e=Lr([],q);return uo(_e,_e,F.cameraToCenterDistance/F.pixelsPerMeter*f_),Di(_e,_e,le),Fs([],q,_e)}(n);return g=(c=qg([],a,i))[0],y=c[1],w=c[2],E=(d=i)[0],A=d[1],P=d[2],B=(z=Math.sqrt(g*g+y*y+w*w)*Math.sqrt(E*E+A*A+P*P))&&So(c,d)/z,Math.acos(Math.min(Math.max(B,-1),1));var c,d,g,y,w,E,A,P,z,B}function __(n,t){return Xx(n,t)>Math.PI/2*1.01}const Kx=Ie(85),$A=Math.cos(Kx),GA=Math.sin(Kx);function Yx(n,t){const i=n.fovAboveCenter,a=n.elevation?n.elevation.getMinElevationBelowMSL()*t:0,c=(n._camera.position[2]*n.worldSize-a)/Math.cos(n._pitch),d=Math.sin(i)*c/Math.sin(Math.max(Math.PI/2-n._pitch-i,.01)),g=Math.sin(n._pitch)*d+c;return Math.min(1.01*g,c*(1/n._horizonShift))}function Dl(n,t){if(!t.isReprojectedInTileSpace)return{scale:1<<n.z,x:n.x,y:n.y,x2:n.x+1,y2:n.y+1,projection:t};const i=Math.pow(2,-n.z),a=n.x*i,c=(n.x+1)*i,d=n.y*i,g=(n.y+1)*i,y=co(a),w=co(c),E=mr(d),A=mr(g),P=t.project(y,E),z=t.project(w,E),B=t.project(w,A),F=t.project(y,A);let q=Math.min(P.x,z.x,B.x,F.x),W=Math.min(P.y,z.y,B.y,F.y),le=Math.max(P.x,z.x,B.x,F.x),_e=Math.max(P.y,z.y,B.y,F.y);const ae=i/16;function de(ye,$e,qe,it,St,Ke){const ut=(qe+St)/2,dt=(it+Ke)/2,vt=t.project(co(ut),mr(dt)),Ct=Math.max(0,q-vt.x,W-vt.y,vt.x-le,vt.y-_e);q=Math.min(q,vt.x),le=Math.max(le,vt.x),W=Math.min(W,vt.y),_e=Math.max(_e,vt.y),Ct>ae&&(de(ye,vt,qe,it,ut,dt),de(vt,$e,ut,dt,St,Ke))}de(P,z,a,d,c,d),de(z,B,c,d,c,g),de(B,F,c,g,a,g),de(F,P,a,g,a,d),q-=ae,W-=ae,le+=ae,_e+=ae;const we=1/Math.max(le-q,_e-W);return{scale:we,x:q*we,y:W*we,x2:le*we,y2:_e*we,projection:t}}const ZA=Go(new Float32Array(16));class Sa{constructor(t){this.spec=t,this.name=t.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(t,i){return{x:0,y:0,z:0}}unproject(t,i){return new jn(0,0)}projectTilePoint(t,i,a){return{x:t,y:i,z:0}}locationPoint(t,i,a=!0){return t._coordinatePoint(t.locationCoordinate(i),a)}pixelsPerMeter(t,i){return To(1,t)*i}pixelSpaceConversion(t,i,a){return 1}farthestPixelDistance(t){return Yx(t,t.pixelsPerMeter)}pointCoordinate(t,i,a,c){const d=t.horizonLineFromTop(!1),g=new ce(i,Math.max(d,a));return t.rayIntersectionCoordinate(t.pointRayIntersection(g,c))}pointCoordinate3D(t,i,a){const c=new ce(i,a);if(t.elevation)return t.elevation.pointCoordinate(c);{const d=this.pointCoordinate(t,c.x,c.y,0);return[d.x,d.y,d.z]}}isPointAboveHorizon(t,i){if(t.elevation)return!this.pointCoordinate3D(t,i.x,i.y);const a=t.horizonLineFromTop();return i.y<a}createInversionMatrix(t,i){return ZA}createTileMatrix(t,i,a){let c,d,g;const y=a.canonical,w=Go(new Float64Array(16));if(this.isReprojectedInTileSpace){const E=Dl(y,this);c=1,d=E.x+a.wrap*E.scale,g=E.y,Pl(w,w,[c/E.scale,c/E.scale,t.pixelsPerMeter/i])}else c=i/t.zoomScale(y.z),d=(y.x+Math.pow(2,y.z)*a.wrap)*c,g=y.y*c;return zh(w,w,[d,g,0]),Pl(w,w,[c/_n,c/_n,1]),w}upVector(t,i,a){return[0,0,1]}upVectorScale(t,i,a){return{metersToTile:1}}}class WA extends Sa{constructor(t){super(t),this.range=[4,7],this.center=t.center||[-96,37.5];const[i,a]=this.parallels=t.parallels||[29.5,45.5],c=Math.sin(Ie(i));this.n=(c+Math.sin(Ie(a)))/2,this.c=1+c*(2*this.n-c),this.r0=Math.sqrt(this.c)/this.n}project(t,i){const{n:a,c,r0:d}=this,g=Ie(t-this.center[0]),y=Ie(i),w=Math.sqrt(c-2*a*Math.sin(y))/a;return{x:w*Math.sin(g*a),y:w*Math.cos(g*a)-d,z:0}}unproject(t,i){const{n:a,c,r0:d}=this,g=d+i;let y=Math.atan2(t,Math.abs(g))*Math.sign(g);g*a<0&&(y-=Math.PI*Math.sign(t)*Math.sign(g));const w=Ie(this.center[0])*a;y=Ge(y,-Math.PI-w,Math.PI-w);const E=lt(ke(y/a)+this.center[0],-180,180),A=Math.asin(lt((c-(t*t+g*g)*a*a)/(2*a),-1,1)),P=lt(ke(A),-85.051129,hs);return new jn(E,P)}}const nd=1.340264,id=-.081106,rd=893e-6,od=.003796,xp=Math.sqrt(3)/2;class HA extends Sa{project(t,i){i=i/180*Math.PI,t=t/180*Math.PI;const a=Math.asin(xp*Math.sin(i)),c=a*a,d=c*c*c;return{x:.5*(t*Math.cos(a)/(xp*(nd+3*id*c+d*(7*rd+9*od*c)))/Math.PI+.5),y:1-.5*(a*(nd+id*c+d*(rd+od*c))/Math.PI+1),z:0}}unproject(t,i){t=(2*t-.5)*Math.PI;let a=i=(2*(1-i)-1)*Math.PI,c=a*a,d=c*c*c;for(let A,P,z,B=0;B<12&&(P=a*(nd+id*c+d*(rd+od*c))-i,z=nd+3*id*c+d*(7*rd+9*od*c),A=P/z,a=lt(a-A,-Math.PI/3,Math.PI/3),c=a*a,d=c*c*c,!(Math.abs(A)<1e-12));++B);const g=xp*t*(nd+3*id*c+d*(7*rd+9*od*c))/Math.cos(a),y=Math.asin(Math.sin(a)/xp),w=lt(180*g/Math.PI,-180,180),E=lt(180*y/Math.PI,-85.051129,hs);return new jn(w,E)}}class XA extends Sa{constructor(t){super(t),this.wrap=!0,this.supportsWorldCopies=!0}project(t,i){return{x:.5+t/360,y:.5-i/360,z:0}}unproject(t,i){const a=360*(t-.5),c=lt(360*(.5-i),-85.051129,hs);return new jn(a,c)}}const ru=Math.PI/2;function bp(n){return Math.tan((ru+n)/2)}class KA extends Sa{constructor(t){super(t),this.center=t.center||[0,30];const[i,a]=this.parallels=t.parallels||[30,30];let c=Ie(i),d=Ie(a);this.southernCenter=c+d<0,this.southernCenter&&(c=-c,d=-d);const g=Math.cos(c),y=bp(c);this.n=c===d?Math.sin(c):Math.log(g/Math.cos(d))/Math.log(bp(d)/y),this.f=g*Math.pow(bp(c),this.n)/this.n}project(t,i){i=Ie(i),this.southernCenter&&(i=-i),t=Ie(t-this.center[0]);const a=1e-6,{n:c,f:d}=this;d>0?i<-ru+a&&(i=-ru+a):i>ru-a&&(i=ru-a);const g=d/Math.pow(bp(i),c);let y=g*Math.sin(c*t),w=d-g*Math.cos(c*t);return y=.5*(y/Math.PI+.5),w=.5*(w/Math.PI+.5),{x:y,y:this.southernCenter?w:1-w,z:0}}unproject(t,i){t=(2*t-.5)*Math.PI,this.southernCenter&&(i=1-i),i=(2*(1-i)-.5)*Math.PI;const{n:a,f:c}=this,d=c-i,g=Math.sign(d),y=Math.sign(a)*Math.sqrt(t*t+d*d);let w=Math.atan2(t,Math.abs(d))*g;d*a<0&&(w-=Math.PI*Math.sign(t)*g);const E=lt(ke(w/a)+this.center[0],-180,180),A=lt(ke(2*Math.atan(Math.pow(c/y,1/a))-ru),-85.051129,hs);return new jn(E,this.southernCenter?-A:A)}}class Qx extends Sa{constructor(t){super(t),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(t,i){return{x:cs(t),y:us(i),z:0}}unproject(t,i){const a=co(t),c=mr(i);return new jn(a,c)}}const Jx=Ie(hs);class YA extends Sa{project(t,i){const a=(i=Ie(i))*i,c=a*a;return{x:.5*((t=Ie(t))*(.8707-.131979*a+c*(c*(.003971*a-.001529*c)-.013791))/Math.PI+.5),y:1-.5*(i*(1.007226+a*(.015085+c*(.028874*a-.044475-.005916*c)))/Math.PI+1),z:0}}unproject(t,i){t=(2*t-.5)*Math.PI;let a=i=(2*(1-i)-1)*Math.PI,c=25,d=0,g=a*a;do{g=a*a;const E=g*g;d=(a*(1.007226+g*(.015085+E*(.028874*g-.044475-.005916*E)))-i)/(1.007226+g*(.045255+E*(.259866*g-.311325-.005916*11*E))),a=lt(a-d,-Jx,Jx)}while(Math.abs(d)>1e-6&&--c>0);g=a*a;const y=lt(ke(t/(.8707+g*(g*(g*g*g*(.003971-.001529*g)-.013791)-.131979))),-180,180),w=ke(a);return new jn(y,w)}}const eb=Ie(hs);class QA extends Sa{project(t,i){i=Ie(i),t=Ie(t);const a=Math.cos(i),c=2/Math.PI,d=Math.acos(a*Math.cos(t/2)),g=Math.sin(d)/d,y=.5*(t*c+2*a*Math.sin(t/2)/g)||0,w=.5*(i+Math.sin(i)/g)||0;return{x:.5*(y/Math.PI+.5),y:1-.5*(w/Math.PI+1),z:0}}unproject(t,i){let a=t=(2*t-.5)*Math.PI,c=i=(2*(1-i)-1)*Math.PI,d=25;const g=1e-6;let y=0,w=0;do{const E=Math.cos(c),A=Math.sin(c),P=2*A*E,z=A*A,B=E*E,F=Math.cos(a/2),q=Math.sin(a/2),W=2*F*q,le=q*q,_e=1-B*F*F,ae=_e?1/_e:0,de=_e?Math.acos(E*F)*Math.sqrt(1/_e):0,we=.5*(2*de*E*q+2*a/Math.PI)-t,ye=.5*(de*A+c)-i,$e=.5*ae*(B*le+de*E*F*z)+1/Math.PI,qe=ae*(W*P/4-de*A*q),it=.125*ae*(P*q-de*A*B*W),St=.5*ae*(z*F+de*le*E)+.5,Ke=qe*it-St*$e;y=(ye*qe-we*St)/Ke,w=(we*it-ye*$e)/Ke,a=lt(a-y,-Math.PI,Math.PI),c=lt(c-w,-eb,eb)}while((Math.abs(y)>g||Math.abs(w)>g)&&--d>0);return new jn(ke(a),ke(c))}}class tb extends Sa{constructor(t){super(t),this.center=t.center||[0,0],this.parallels=t.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(Ie(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(t,i){const{scale:a,cosPhi:c}=this;return{x:Ie(t)*c*a+.5,y:-Math.sin(Ie(i))/c*a+.5,z:0}}unproject(t,i){const{scale:a,cosPhi:c}=this,d=-(i-.5)/a,g=lt(ke((t-.5)/a)/c,-180,180),y=Math.asin(lt(d*c,-1,1)),w=lt(ke(y),-85.051129,hs);return new jn(g,w)}}class JA extends Qx{constructor(t){super(t),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug","custom"],this.range=[3,5]}projectTilePoint(t,i,a){const c=ed(t,i,a);return Di(c,c,td(fs(a))),{x:c[0],y:c[1],z:c[2]}}locationPoint(t,i){const a=Jh(i.lat,i.lng),c=Lr([],a),d=t.elevation?t.elevation.getAtPointOrZero(t.locationCoordinate(i),t._centerAltitude):t._centerAltitude;Oh(a,a,c,To(1,0)*_n*d);const g=Go(new Float64Array(16));return kl(g,t.pixelMatrix,t.globeMatrix),Di(a,a,g),new ce(a[0],a[1])}pixelsPerMeter(t,i){return To(1,0)*i}pixelSpaceConversion(t,i,a){const c=To(1,t)*i,d=$n(To(1,45)*i,c,a);return this.pixelsPerMeter(t,i)/d}createTileMatrix(t,i,a){const c=g_(fs(a.canonical));return kl(new Float64Array(16),t.globeMatrix,c)}createInversionMatrix(t,i){const{center:a}=t,c=td(fs(i));return ep(c,c,Ie(a.lng)),Ug(c,c,Ie(a.lat)),Pl(c,c,[t._pixelsPerMercatorPixel,t._pixelsPerMercatorPixel,1]),Float32Array.from(c)}pointCoordinate(t,i,a,c){return $x(t,i,a,!0)||new jc(0,0)}pointCoordinate3D(t,i,a){const c=this.pointCoordinate(t,i,a,0);return[c.x,c.y,c.z]}isPointAboveHorizon(t,i){return!$x(t,i.x,i.y,!1)}farthestPixelDistance(t){const i=function(c,d){const g=c.cameraToCenterDistance,y=c._centerAltitude*d,w=c._camera,E=c._camera.forward(),A=Fs([],uo([],E,-g),[0,0,y]),P=c.worldSize/(2*Math.PI),z=[0,0,-P],B=c.width/c.height,F=Math.tan(c.fovAboveCenter),q=uo([],w.up(),F),W=uo([],w.right(),F*B),le=Lr([],Fs([],Fs([],E,q),W)),_e=[];let ae;if(new Gg(A,le).closestPointOnSphere(z,P,_e)){const de=Fs([],_e,z),we=Zo([],de,A);ae=Math.cos(c.fovAboveCenter)*Lh(we)}else{const de=Zo([],A,z),we=Zo([],z,A);Lr(we,we);const ye=Lh(de)-P;ae=Math.sqrt(ye*(ye+2*P));const $e=Math.acos(ae/(P+ye))-Math.acos(So(E,we));ae*=Math.cos($e)}return 1.01*ae}(t,this.pixelsPerMeter(t.center.lat,t.worldSize)),a=iu(t.zoom);if(a>0){const c=Yx(t,To(1,t.center.lat)*t.worldSize),d=t.worldSize/(2*Math.PI),g=Math.max(t.width,t.height)/t.worldSize*Math.PI;return $n(i,c+d*(1-Math.cos(g)),Math.pow(a,10))}return i}upVector(t,i,a){return ed(i,a,t,1)}upVectorScale(t){return{metersToTile:f_*vp(fs(t))}}}function nb(n){const t=n.parallels,i=!!t&&Math.abs(t[0]+t[1])<.01;switch(n.name){case"mercator":return new Qx(n);case"equirectangular":return new XA(n);case"naturalEarth":return new YA(n);case"equalEarth":return new HA(n);case"winkelTripel":return new QA(n);case"albers":return i?new tb(n):new WA(n);case"lambertConformalConic":return i?new tb(n):new KA(n);case"globe":return new JA(n)}throw new Error(`Invalid projection name: ${n.name}`)}const eM=ap.types,tM=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function wp(n,t,i,a,c,d,g,y,w,E,A,P,z){const B=y?Math.min(Ta,Math.round(y[0])):0,F=y?Math.min(Ta,Math.round(y[1])):0;n.emplaceBack(t,i,Math.round(32*a),Math.round(32*c),d,g,(B<<1)+(w?1:0),F,16*E,16*A,256*P,256*z)}function Ep(n,t,i,a,c,d,g){n.emplaceBack(t,i,a,c,d,g)}function Tp(n,t,i,a,c){n.emplaceBack(t,i,a,c),n.emplaceBack(t,i,a,c),n.emplaceBack(t,i,a,c),n.emplaceBack(t,i,a,c)}function nM(n){for(const t of n.sections)if(ee(t.text))return!0;return!1}class y_{constructor(t){this.layoutVertexArray=new ci,this.indexArray=new pr,this.programConfigurations=t,this.segments=new Wi,this.dynamicLayoutVertexArray=new Gr,this.opacityVertexArray=new Ri,this.placedSymbolArray=new t0,this.globeExtVertexArray=new Gn}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(t,i,a,c){this.isEmpty()||(a&&(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,rA.members),this.indexBuffer=t.createIndexBuffer(this.indexArray,i),this.dynamicLayoutVertexBuffer=t.createVertexBuffer(this.dynamicLayoutVertexArray,sA.members,!0),this.opacityVertexBuffer=t.createVertexBuffer(this.opacityVertexArray,tM,!0),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=t.createVertexBuffer(this.globeExtVertexArray,oA.members,!0)),this.opacityVertexBuffer.itemSize=1),(a||c)&&this.programConfigurations.upload(t))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}}Zt(y_,"SymbolBuffers");class v_{constructor(t,i,a){this.layoutVertexArray=new t,this.layoutAttributes=i,this.indexArray=new a,this.segments=new Wi,this.collisionVertexArray=new Sl,this.collisionVertexArrayExt=new jo}upload(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=t.createVertexBuffer(this.collisionVertexArray,aA.members,!0),this.collisionVertexBufferExt=t.createVertexBuffer(this.collisionVertexArrayExt,lA.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}Zt(v_,"CollisionBuffers");class Ca{constructor(t){this.collisionBoxArray=t.collisionBoxArray,this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(g=>g.id),this.index=t.index,this.pixelRatio=t.pixelRatio,this.sourceLayerIndex=t.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Go([]),this.placementViewportMatrix=Go([]);const i=this.layers[0]._unevaluatedLayout._values;this.textSizeData=i_(this.zoom,i["text-size"]),this.iconSizeData=i_(this.zoom,i["icon-size"]);const a=this.layers[0].layout,c=a.get("symbol-sort-key"),d=a.get("symbol-z-order");this.canOverlap=a.get("text-allow-overlap")||a.get("icon-allow-overlap")||a.get("text-ignore-placement")||a.get("icon-ignore-placement"),this.sortFeaturesByKey=d!=="viewport-y"&&c.constantOr(1)!==void 0,this.sortFeaturesByY=(d==="viewport-y"||d==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=a.get("text-writing-mode").map(g=>ho[g]),this.stateDependentLayerIds=this.layers.filter(g=>g.isStateDependent()).map(g=>g.id),this.sourceID=t.sourceID,this.projection=t.projection}createArrays(){this.text=new y_(new Al(this.layers,this.zoom,t=>/^text/.test(t))),this.icon=new y_(new Al(this.layers,this.zoom,t=>/^icon/.test(t))),this.glyphOffsetArray=new r0,this.lineVertexArray=new o0,this.symbolInstances=new i0}calculateGlyphDependencies(t,i,a,c,d){for(let g=0;g<t.length;g++)if(i[t.charCodeAt(g)]=!0,c&&d){const y=Hh[t.charAt(g)];y&&(i[y.charCodeAt(0)]=!0)}}populate(t,i,a,c){const d=this.layers[0],g=d.layout,y=this.projection.name==="globe",w=g.get("text-font"),E=g.get("text-field"),A=g.get("icon-image"),P=(E.value.kind!=="constant"||E.value.value instanceof ir&&!E.value.value.isEmpty()||E.value.value.toString().length>0)&&(w.value.kind!=="constant"||w.value.value.length>0),z=A.value.kind!=="constant"||!!A.value.value||Object.keys(A.parameters).length>0,B=g.get("symbol-sort-key");if(this.features=[],!P&&!z)return;const F=i.iconDependencies,q=i.glyphDependencies,W=i.availableImages,le=new Le(this.zoom);for(const{feature:_e,id:ae,index:de,sourceLayerIndex:we}of t){const ye=d._featureFilter.needGeometry,$e=Ml(_e,ye);if(!d._featureFilter.filter(le,$e,a))continue;if(ye||($e.geometry=Bs(_e,a,c)),y&&_e.type!==1&&a.z<=5){const Ke=$e.geometry,ut=.98078528056,dt=(vt,Ct)=>So(ed(vt.x,vt.y,a,1),ed(Ct.x,Ct.y,a,1))<ut;for(let vt=0;vt<Ke.length;vt++)Ke[vt]=nC(Ke[vt],dt)}let qe,it;if(P){const Ke=d.getValueAndResolveTokens("text-field",$e,a,W),ut=ir.factory(Ke);nM(ut)&&(this.hasRTLText=!0),(!this.hasRTLText||Pe()==="unavailable"||this.hasRTLText&&je.isParsed())&&(qe=hA(ut,d,$e))}if(z){const Ke=d.getValueAndResolveTokens("icon-image",$e,a,W);it=Ke instanceof Hr?Ke:Hr.fromString(Ke)}if(!qe&&!it)continue;const St=this.sortFeaturesByKey?B.evaluate($e,{},a):void 0;if(this.features.push({id:ae,text:qe,icon:it,index:de,sourceLayerIndex:we,geometry:$e.geometry,properties:_e.properties,type:eM[_e.type],sortKey:St}),it&&(F[it.name]=!0),qe){const Ke=w.evaluate($e,{},a).join(","),ut=g.get("text-rotation-alignment")==="map"&&g.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(ho.vertical)>=0;for(const dt of qe.sections)if(dt.image)F[dt.image.name]=!0;else{const vt=T(qe.toString()),Ct=dt.fontStack||Ke,Qe=q[Ct]=q[Ct]||{};this.calculateGlyphDependencies(dt.text,Qe,ut,this.allowVerticalPlacement,vt)}}}g.get("symbol-placement")==="line"&&(this.features=function(_e){const ae={},de={},we=[];let ye=0;function $e(Ke){we.push(_e[Ke]),ye++}function qe(Ke,ut,dt){const vt=de[Ke];return delete de[Ke],de[ut]=vt,we[vt].geometry[0].pop(),we[vt].geometry[0]=we[vt].geometry[0].concat(dt[0]),vt}function it(Ke,ut,dt){const vt=ae[ut];return delete ae[ut],ae[Ke]=vt,we[vt].geometry[0].shift(),we[vt].geometry[0]=dt[0].concat(we[vt].geometry[0]),vt}function St(Ke,ut,dt){const vt=dt?ut[0][ut[0].length-1]:ut[0][0];return`${Ke}:${vt.x}:${vt.y}`}for(let Ke=0;Ke<_e.length;Ke++){const ut=_e[Ke],dt=ut.geometry,vt=ut.text?ut.text.toString():null;if(!vt){$e(Ke);continue}const Ct=St(vt,dt),Qe=St(vt,dt,!0);if(Ct in de&&Qe in ae&&de[Ct]!==ae[Qe]){const Dt=it(Ct,Qe,dt),dn=qe(Ct,Qe,we[Dt].geometry);delete ae[Ct],delete de[Qe],de[St(vt,we[dn].geometry,!0)]=dn,we[Dt].geometry=null}else Ct in de?qe(Ct,Qe,dt):Qe in ae?it(Ct,Qe,dt):($e(Ke),ae[Ct]=ye-1,de[Qe]=ye-1)}return we.filter(Ke=>Ke.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((_e,ae)=>_e.sortKey-ae.sortKey)}update(t,i,a,c){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(t,i,this.layers,a,c),this.icon.programConfigurations.updatePaintArrays(t,i,this.layers,a,c))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(t){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(t),this.iconCollisionBox.upload(t)),this.text.upload(t,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(t,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=nb(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(t,i){const a=this.lineVertexArray.length;if(t.segment!==void 0)for(const{x:c,y:d}of i)this.lineVertexArray.emplaceBack(c,d);return{lineStartIndex:a,lineLength:this.lineVertexArray.length-a}}addSymbols(t,i,a,c,d,g,y,w,E,A,P,z,B,F){const q=t.indexArray,W=t.layoutVertexArray,le=t.globeExtVertexArray,_e=t.segments.prepareSegment(4*i.length,W,q,this.canOverlap?g.sortKey:void 0),ae=this.glyphOffsetArray.length,de=_e.vertexLength,we=this.allowVerticalPlacement&&y===ho.vertical?Math.PI/2:0,ye=g.text&&g.text.sections;for(let qe=0;qe<i.length;qe++){const{tl:it,tr:St,bl:Ke,br:ut,tex:dt,pixelOffsetTL:vt,pixelOffsetBR:Ct,minFontScaleX:Qe,minFontScaleY:Dt,glyphOffset:dn,isSDF:Vt,sectionIndex:en}=i[qe],Ot=_e.vertexLength,pn=dn[1];if(wp(W,E.x,E.y,it.x,pn+it.y,dt.x,dt.y,a,Vt,vt.x,vt.y,Qe,Dt),wp(W,E.x,E.y,St.x,pn+St.y,dt.x+dt.w,dt.y,a,Vt,Ct.x,vt.y,Qe,Dt),wp(W,E.x,E.y,Ke.x,pn+Ke.y,dt.x,dt.y+dt.h,a,Vt,vt.x,Ct.y,Qe,Dt),wp(W,E.x,E.y,ut.x,pn+ut.y,dt.x+dt.w,dt.y+dt.h,a,Vt,Ct.x,Ct.y,Qe,Dt),w){const{x:Dn,y:zn,z:Mn}=w.anchor,[gn,ti,wn]=w.up;Ep(le,Dn,zn,Mn,gn,ti,wn),Ep(le,Dn,zn,Mn,gn,ti,wn),Ep(le,Dn,zn,Mn,gn,ti,wn),Ep(le,Dn,zn,Mn,gn,ti,wn),Tp(t.dynamicLayoutVertexArray,Dn,zn,Mn,we)}else Tp(t.dynamicLayoutVertexArray,E.x,E.y,E.z,we);q.emplaceBack(Ot,Ot+1,Ot+2),q.emplaceBack(Ot+1,Ot+2,Ot+3),_e.vertexLength+=4,_e.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(dn[0]),qe!==i.length-1&&en===i[qe+1].sectionIndex||t.programConfigurations.populatePaintArrays(W.length,g,g.index,{},B,F,ye&&ye[en])}const $e=w?w.anchor:E;t.placedSymbolArray.emplaceBack($e.x,$e.y,$e.z,E.x,E.y,ae,this.glyphOffsetArray.length-ae,de,A,P,E.segment,a?a[0]:0,a?a[1]:0,c[0],c[1],y,0,!1,0,z,0)}_commitLayoutVertex(t,i,a,c,d,g,y){t.emplaceBack(i,a,c,d,g,Math.round(y.x),Math.round(y.y))}_addCollisionDebugVertices(t,i,a,c,d,g,y){const w=a.segments.prepareSegment(4,a.layoutVertexArray,a.indexArray),E=w.vertexLength,A=y.tileAnchorX,P=y.tileAnchorY;for(let B=0;B<4;B++)a.collisionVertexArray.emplaceBack(0,0,0,0);a.collisionVertexArrayExt.emplaceBack(i,-t.padding,-t.padding),a.collisionVertexArrayExt.emplaceBack(i,t.padding,-t.padding),a.collisionVertexArrayExt.emplaceBack(i,t.padding,t.padding),a.collisionVertexArrayExt.emplaceBack(i,-t.padding,t.padding),this._commitLayoutVertex(a.layoutVertexArray,c,d,g,A,P,new ce(t.x1,t.y1)),this._commitLayoutVertex(a.layoutVertexArray,c,d,g,A,P,new ce(t.x2,t.y1)),this._commitLayoutVertex(a.layoutVertexArray,c,d,g,A,P,new ce(t.x2,t.y2)),this._commitLayoutVertex(a.layoutVertexArray,c,d,g,A,P,new ce(t.x1,t.y2)),w.vertexLength+=4;const z=a.indexArray;z.emplaceBack(E,E+1),z.emplaceBack(E+1,E+2),z.emplaceBack(E+2,E+3),z.emplaceBack(E+3,E),w.primitiveLength+=4}_addTextDebugCollisionBoxes(t,i,a,c,d,g){for(let y=c;y<d;y++){const w=a.get(y),E=this.getSymbolInstanceTextSize(t,g,i,y);this._addCollisionDebugVertices(w,E,this.textCollisionBox,w.projectedAnchorX,w.projectedAnchorY,w.projectedAnchorZ,g)}}_addIconDebugCollisionBoxes(t,i,a,c,d,g){for(let y=c;y<d;y++){const w=a.get(y),E=this.getSymbolInstanceIconSize(t,i,g.placedIconSymbolIndex);this._addCollisionDebugVertices(w,E,this.iconCollisionBox,w.projectedAnchorX,w.projectedAnchorY,w.projectedAnchorZ,g)}}generateCollisionDebugBuffers(t,i){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new v_(di,mx.members,Eo),this.iconCollisionBox=new v_(di,mx.members,Eo);const a=Hc(this.iconSizeData,t),c=Hc(this.textSizeData,t);for(let d=0;d<this.symbolInstances.length;d++){const g=this.symbolInstances.get(d);this._addTextDebugCollisionBoxes(c,t,i,g.textBoxStartIndex,g.textBoxEndIndex,g),this._addTextDebugCollisionBoxes(c,t,i,g.verticalTextBoxStartIndex,g.verticalTextBoxEndIndex,g),this._addIconDebugCollisionBoxes(a,t,i,g.iconBoxStartIndex,g.iconBoxEndIndex,g),this._addIconDebugCollisionBoxes(a,t,i,g.verticalIconBoxStartIndex,g.verticalIconBoxEndIndex,g)}}getSymbolInstanceTextSize(t,i,a,c){const d=this.text.placedSymbolArray.get(i.rightJustifiedTextSymbolIndex>=0?i.rightJustifiedTextSymbolIndex:i.centerJustifiedTextSymbolIndex>=0?i.centerJustifiedTextSymbolIndex:i.leftJustifiedTextSymbolIndex>=0?i.leftJustifiedTextSymbolIndex:i.verticalPlacedTextSymbolIndex>=0?i.verticalPlacedTextSymbolIndex:c),g=hp(this.textSizeData,t,d)/gr;return this.tilePixelRatio*g}getSymbolInstanceIconSize(t,i,a){const c=this.icon.placedSymbolArray.get(a),d=hp(this.iconSizeData,t,c);return this.tilePixelRatio*d}_commitDebugCollisionVertexUpdate(t,i,a){t.emplaceBack(i,-a,-a),t.emplaceBack(i,a,-a),t.emplaceBack(i,a,a),t.emplaceBack(i,-a,a)}_updateTextDebugCollisionBoxes(t,i,a,c,d,g){for(let y=c;y<d;y++){const w=a.get(y),E=this.getSymbolInstanceTextSize(t,g,i,y);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,E,w.padding)}}_updateIconDebugCollisionBoxes(t,i,a,c,d,g){for(let y=c;y<d;y++){const w=a.get(y),E=this.getSymbolInstanceIconSize(t,i,g);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,E,w.padding)}}updateCollisionDebugBuffers(t,i){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const a=Hc(this.iconSizeData,t),c=Hc(this.textSizeData,t);for(let d=0;d<this.symbolInstances.length;d++){const g=this.symbolInstances.get(d);this._updateTextDebugCollisionBoxes(c,t,i,g.textBoxStartIndex,g.textBoxEndIndex,g),this._updateTextDebugCollisionBoxes(c,t,i,g.verticalTextBoxStartIndex,g.verticalTextBoxEndIndex,g),this._updateIconDebugCollisionBoxes(a,t,i,g.iconBoxStartIndex,g.iconBoxEndIndex,g.placedIconSymbolIndex),this._updateIconDebugCollisionBoxes(a,t,i,g.verticalIconBoxStartIndex,g.verticalIconBoxEndIndex,g.placedIconSymbolIndex)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(t,i,a,c,d,g,y,w,E){const A={};if(i<a){const{x1:P,y1:z,x2:B,y2:F,padding:q,projectedAnchorX:W,projectedAnchorY:le,projectedAnchorZ:_e,tileAnchorX:ae,tileAnchorY:de,featureIndex:we}=t.get(i);A.textBox={x1:P,y1:z,x2:B,y2:F,padding:q,projectedAnchorX:W,projectedAnchorY:le,projectedAnchorZ:_e,tileAnchorX:ae,tileAnchorY:de},A.textFeatureIndex=we}if(c<d){const{x1:P,y1:z,x2:B,y2:F,padding:q,projectedAnchorX:W,projectedAnchorY:le,projectedAnchorZ:_e,tileAnchorX:ae,tileAnchorY:de,featureIndex:we}=t.get(c);A.verticalTextBox={x1:P,y1:z,x2:B,y2:F,padding:q,projectedAnchorX:W,projectedAnchorY:le,projectedAnchorZ:_e,tileAnchorX:ae,tileAnchorY:de},A.verticalTextFeatureIndex=we}if(g<y){const{x1:P,y1:z,x2:B,y2:F,padding:q,projectedAnchorX:W,projectedAnchorY:le,projectedAnchorZ:_e,tileAnchorX:ae,tileAnchorY:de,featureIndex:we}=t.get(g);A.iconBox={x1:P,y1:z,x2:B,y2:F,padding:q,projectedAnchorX:W,projectedAnchorY:le,projectedAnchorZ:_e,tileAnchorX:ae,tileAnchorY:de},A.iconFeatureIndex=we}if(w<E){const{x1:P,y1:z,x2:B,y2:F,padding:q,projectedAnchorX:W,projectedAnchorY:le,projectedAnchorZ:_e,tileAnchorX:ae,tileAnchorY:de,featureIndex:we}=t.get(w);A.verticalIconBox={x1:P,y1:z,x2:B,y2:F,padding:q,projectedAnchorX:W,projectedAnchorY:le,projectedAnchorZ:_e,tileAnchorX:ae,tileAnchorY:de},A.verticalIconFeatureIndex=we}return A}deserializeCollisionBoxes(t){this.collisionArrays=[];for(let i=0;i<this.symbolInstances.length;i++){const a=this.symbolInstances.get(i);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(t,a.textBoxStartIndex,a.textBoxEndIndex,a.verticalTextBoxStartIndex,a.verticalTextBoxEndIndex,a.iconBoxStartIndex,a.iconBoxEndIndex,a.verticalIconBoxStartIndex,a.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(t,i){const a=t.placedSymbolArray.get(i),c=a.vertexStartIndex+4*a.numGlyphs;for(let d=a.vertexStartIndex;d<c;d+=4)t.indexArray.emplaceBack(d,d+1,d+2),t.indexArray.emplaceBack(d+1,d+2,d+3)}getSortedSymbolIndexes(t){if(this.sortedAngle===t&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const i=Math.sin(t),a=Math.cos(t),c=[],d=[],g=[];for(let y=0;y<this.symbolInstances.length;++y){g.push(y);const w=this.symbolInstances.get(y);c.push(0|Math.round(i*w.tileAnchorX+a*w.tileAnchorY)),d.push(w.featureIndex)}return g.sort((y,w)=>c[y]-c[w]||d[w]-d[y]),g}addToSortKeyRanges(t,i){const a=this.sortKeyRanges[this.sortKeyRanges.length-1];a&&a.sortKey===i?a.symbolInstanceEnd=t+1:this.sortKeyRanges.push({sortKey:i,symbolInstanceStart:t,symbolInstanceEnd:t+1})}sortFeatures(t){if(this.sortFeaturesByY&&this.sortedAngle!==t&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(t),this.sortedAngle=t,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const i of this.symbolInstanceIndexes){const a=this.symbolInstances.get(i);this.featureSortOrder.push(a.featureIndex);const{rightJustifiedTextSymbolIndex:c,centerJustifiedTextSymbolIndex:d,leftJustifiedTextSymbolIndex:g,verticalPlacedTextSymbolIndex:y,placedIconSymbolIndex:w,verticalPlacedIconSymbolIndex:E}=a;c>=0&&this.addIndicesForPlacedSymbol(this.text,c),d>=0&&d!==c&&this.addIndicesForPlacedSymbol(this.text,d),g>=0&&g!==d&&g!==c&&this.addIndicesForPlacedSymbol(this.text,g),y>=0&&this.addIndicesForPlacedSymbol(this.text,y),w>=0&&this.addIndicesForPlacedSymbol(this.icon,w),E>=0&&this.addIndicesForPlacedSymbol(this.icon,E)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}Zt(Ca,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),Ca.MAX_GLYPHS=65535,Ca.addDynamicAttributes=Tp;const iM=new ln({"symbol-placement":new De(tt.layout_symbol["symbol-placement"]),"symbol-spacing":new De(tt.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new De(tt.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new He(tt.layout_symbol["symbol-sort-key"]),"symbol-z-order":new De(tt.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new De(tt.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new De(tt.layout_symbol["icon-ignore-placement"]),"icon-optional":new De(tt.layout_symbol["icon-optional"]),"icon-rotation-alignment":new De(tt.layout_symbol["icon-rotation-alignment"]),"icon-size":new He(tt.layout_symbol["icon-size"]),"icon-text-fit":new De(tt.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new De(tt.layout_symbol["icon-text-fit-padding"]),"icon-image":new He(tt.layout_symbol["icon-image"]),"icon-rotate":new He(tt.layout_symbol["icon-rotate"]),"icon-padding":new De(tt.layout_symbol["icon-padding"]),"icon-keep-upright":new De(tt.layout_symbol["icon-keep-upright"]),"icon-offset":new He(tt.layout_symbol["icon-offset"]),"icon-anchor":new He(tt.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new De(tt.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new De(tt.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new De(tt.layout_symbol["text-rotation-alignment"]),"text-field":new He(tt.layout_symbol["text-field"]),"text-font":new He(tt.layout_symbol["text-font"]),"text-size":new He(tt.layout_symbol["text-size"]),"text-max-width":new He(tt.layout_symbol["text-max-width"]),"text-line-height":new He(tt.layout_symbol["text-line-height"]),"text-letter-spacing":new He(tt.layout_symbol["text-letter-spacing"]),"text-justify":new He(tt.layout_symbol["text-justify"]),"text-radial-offset":new He(tt.layout_symbol["text-radial-offset"]),"text-variable-anchor":new De(tt.layout_symbol["text-variable-anchor"]),"text-anchor":new He(tt.layout_symbol["text-anchor"]),"text-max-angle":new De(tt.layout_symbol["text-max-angle"]),"text-writing-mode":new De(tt.layout_symbol["text-writing-mode"]),"text-rotate":new He(tt.layout_symbol["text-rotate"]),"text-padding":new De(tt.layout_symbol["text-padding"]),"text-keep-upright":new De(tt.layout_symbol["text-keep-upright"]),"text-transform":new He(tt.layout_symbol["text-transform"]),"text-offset":new He(tt.layout_symbol["text-offset"]),"text-allow-overlap":new De(tt.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new De(tt.layout_symbol["text-ignore-placement"]),"text-optional":new De(tt.layout_symbol["text-optional"])});var x_={paint:new ln({"icon-opacity":new He(tt.paint_symbol["icon-opacity"]),"icon-color":new He(tt.paint_symbol["icon-color"]),"icon-halo-color":new He(tt.paint_symbol["icon-halo-color"]),"icon-halo-width":new He(tt.paint_symbol["icon-halo-width"]),"icon-halo-blur":new He(tt.paint_symbol["icon-halo-blur"]),"icon-translate":new De(tt.paint_symbol["icon-translate"]),"icon-translate-anchor":new De(tt.paint_symbol["icon-translate-anchor"]),"text-opacity":new He(tt.paint_symbol["text-opacity"]),"text-color":new He(tt.paint_symbol["text-color"],{runtimeType:lo,getOverride:n=>n.textColor,hasOverride:n=>!!n.textColor}),"text-halo-color":new He(tt.paint_symbol["text-halo-color"]),"text-halo-width":new He(tt.paint_symbol["text-halo-width"]),"text-halo-blur":new He(tt.paint_symbol["text-halo-blur"]),"text-translate":new De(tt.paint_symbol["text-translate"]),"text-translate-anchor":new De(tt.paint_symbol["text-translate-anchor"])}),layout:iM};class ib{constructor(t){this.type=t.property.overrides?t.property.overrides.runtimeType:xr,this.defaultValue=t}evaluate(t){if(t.formattedSection){const i=this.defaultValue.property.overrides;if(i&&i.hasOverride(t.formattedSection))return i.getOverride(t.formattedSection)}return t.feature&&t.featureState?this.defaultValue.evaluate(t.feature,t.featureState):this.defaultValue.property.specification.default}eachChild(t){this.defaultValue.isConstant()||t(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Zt(ib,"FormatSectionOverride",{omit:["defaultValue"]});class Sp extends $o{constructor(t){super(t,x_)}recalculate(t,i){super.recalculate(t,i),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const a=this.layout.get("text-writing-mode");if(a){const c=[];for(const d of a)c.indexOf(d)<0&&c.push(d);this.layout._values["text-writing-mode"]=c}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(t,i,a,c){const d=this.layout.get(t).evaluate(i,{},a,c),g=this._unevaluatedLayout._values[t];return g.isDataDriven()||_l(g.value)||!d?d:function(y,w){return w.replace(/{([^{}]+)}/g,(E,A)=>A in y?String(y[A]):"")}(i.properties,d)}createBucket(t){return new Ca(t)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const t of x_.paint.overridableProperties){if(!Sp.hasPaintOverride(this.layout,t))continue;const i=this.paint.get(t),a=new ib(i),c=new Pc(a,i.property.specification);let d=null;d=i.value.kind==="constant"||i.value.kind==="source"?new as("source",c):new zc("composite",c,i.value.zoomStops,i.value._interpolationType),this.paint._values[t]=new pt(i.property,d,i.parameters)}}_handleOverridablePaintPropertyUpdate(t,i,a){return!(!this.layout||i.isDataDriven()||a.isDataDriven())&&Sp.hasPaintOverride(this.layout,t)}static hasPaintOverride(t,i){const a=t.get("text-field"),c=x_.paint.properties[i];let d=!1;const g=y=>{for(const w of y)if(c.overrides&&c.overrides.hasOverride(w))return void(d=!0)};if(a.value.kind==="constant"&&a.value.value instanceof ir)g(a.value.value.sections);else if(a.value.kind==="source"){const y=E=>{d||(E instanceof ol&&Zi(E.value)===oa?g(E.value.sections):E instanceof sl?g(E.sections):E.eachChild(y))},w=a.value;w._styleExpression&&y(w._styleExpression.expression)}return d}getProgramConfiguration(t){return new wa(this,t)}}var rM={paint:new ln({"background-color":new De(tt.paint_background["background-color"]),"background-pattern":new De(tt.paint_background["background-pattern"]),"background-opacity":new De(tt.paint_background["background-opacity"])})},oM={paint:new ln({"raster-opacity":new De(tt.paint_raster["raster-opacity"]),"raster-hue-rotate":new De(tt.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new De(tt.paint_raster["raster-brightness-min"]),"raster-brightness-max":new De(tt.paint_raster["raster-brightness-max"]),"raster-saturation":new De(tt.paint_raster["raster-saturation"]),"raster-contrast":new De(tt.paint_raster["raster-contrast"]),"raster-resampling":new De(tt.paint_raster["raster-resampling"]),"raster-fade-duration":new De(tt.paint_raster["raster-fade-duration"])})};class sM extends $o{constructor(t){super(t,{}),this.implementation=t}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(t){this.implementation.onAdd&&this.implementation.onAdd(t,t.painter.context.gl)}onRemove(t){this.implementation.onRemove&&this.implementation.onRemove(t,t.painter.context.gl)}}var aM={paint:new ln({"sky-type":new De(tt.paint_sky["sky-type"]),"sky-atmosphere-sun":new De(tt.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new De(tt.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new De(tt.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new De(tt.paint_sky["sky-gradient-radius"]),"sky-gradient":new Qt(tt.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new De(tt.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new De(tt.paint_sky["sky-atmosphere-color"]),"sky-opacity":new De(tt.paint_sky["sky-opacity"])})};function b_(n,t,i){const a=[0,0,1],c=F0([]);return V0(c,c,i?-Ie(n)+Math.PI:Ie(n)),N0(c,c,-Ie(t)),R0(a,a,c),Lr(a,a)}const lM={circle:class extends $o{constructor(n){super(n,cC)}createBucket(n){return new Bg(n)}queryRadius(n){const t=n;return qc("circle-radius",this,t)+qc("circle-stroke-width",this,t)+Qf(this.paint.get("circle-translate"))}queryIntersectsFeature(n,t,i,a,c,d,g,y){const w=A0(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),d.angle,n.pixelToTileUnitsFactor),E=this.paint.get("circle-radius").evaluate(t,i)+this.paint.get("circle-stroke-width").evaluate(t,i);return U0(n,a,d,g,y,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",w,E)}getProgramIds(){return["circle"]}getProgramConfiguration(n){return new wa(this,n)}},heatmap:class extends $o{createBucket(n){return new q0(n)}constructor(n){super(n,_C),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(n){n==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Xg({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(n){return qc("heatmap-radius",this,n)}queryIntersectsFeature(n,t,i,a,c,d,g,y){const w=this.paint.get("heatmap-radius").evaluate(t,i);return U0(n,a,d,g,y,!0,!0,new ce(0,0),w)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getProgramConfiguration(n){return new wa(this,n)}},hillshade:class extends $o{constructor(n){super(n,yC)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}},fill:class extends $o{constructor(n){super(n,RC)}getProgramIds(){const n=this.paint.get("fill-pattern"),t=n&&n.constantOr(1),i=[t?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&i.push(t&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),i}getProgramConfiguration(n){return new wa(this,n)}recalculate(n,t){super.recalculate(n,t);const i=this.paint._values["fill-outline-color"];i.value.kind==="constant"&&i.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(n){return new op(n)}queryRadius(){return Qf(this.paint.get("fill-translate"))}queryIntersectsFeature(n,t,i,a,c,d){return!n.queryGeometry.isAboveHorizon&&w0(C0(n.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),d.angle,n.pixelToTileUnitsFactor),a)}isTileClipped(){return!0}},"fill-extrusion":class extends $o{constructor(n){super(n,KC)}createBucket(n){return new Gh(n)}queryRadius(){return Qf(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}getProgramConfiguration(n){return new wa(this,n)}queryIntersectsFeature(n,t,i,a,c,d,g,y,w){const E=A0(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),d.angle,n.pixelToTileUnitsFactor),A=this.paint.get("fill-extrusion-height").evaluate(t,i),P=this.paint.get("fill-extrusion-base").evaluate(t,i),z=[0,0],B=y&&d.elevation,F=d.elevation?d.elevation.exaggeration():1,q=n.tile.getBucket(this);if(B&&q instanceof Gh){const de=q.centroidVertexArray,we=w+1;we<de.length&&(z[0]=de.geta_centroid_pos0(we),z[1]=de.geta_centroid_pos1(we))}if(z[0]===0&&z[1]===1)return!1;d.projection.name==="globe"&&(a=ax([a],[new ce(0,0),new ce(_n,_n)],n.tileID.canonical).map(de=>de.polygon).flat());const W=B?y:null,[le,_e]=function(de,we,ye,$e,qe,it,St,Ke,ut,dt,vt){return de.projection.name==="globe"?function(Ct,Qe,Dt,dn,Vt,en,Ot,pn,Dn,zn,Mn){const gn=[],ti=[],wn=Ct.projection.upVectorScale(Mn,Ct.center.lat,Ct.worldSize).metersToTile,On=[0,0,0,1],ri=[0,0,0,1],_i=(yi,vi,Pi,or)=>{yi[0]=vi,yi[1]=Pi,yi[2]=or,yi[3]=1},pi=sx();Dt>0&&(Dt+=pi),dn+=pi;for(const yi of Qe){const vi=[],Pi=[];for(const or of yi){const ni=or.x+Vt.x,Hi=or.y+Vt.y,Ni=Ct.projection.projectTilePoint(ni,Hi,Mn),Zn=Ct.projection.upVector(Mn,or.x,or.y);let Si=Dt,Qi=dn;if(Ot){const oi=hx(ni,Hi,Dt,dn,Ot,pn,Dn,zn);Si+=oi.base,Qi+=oi.top}Dt!==0?_i(On,Ni.x+Zn[0]*wn*Si,Ni.y+Zn[1]*wn*Si,Ni.z+Zn[2]*wn*Si):_i(On,Ni.x,Ni.y,Ni.z),_i(ri,Ni.x+Zn[0]*wn*Qi,Ni.y+Zn[1]*wn*Qi,Ni.z+Zn[2]*wn*Qi),Di(On,On,en),Di(ri,ri,en),vi.push(new Wc(On[0],On[1],On[2])),Pi.push(new Wc(ri[0],ri[1],ri[2]))}gn.push(vi),ti.push(Pi)}return[gn,ti]}(de,we,ye,$e,qe,it,St,Ke,ut,dt,vt):St?function(Ct,Qe,Dt,dn,Vt,en,Ot,pn,Dn){const zn=[],Mn=[],gn=[0,0,0,1];for(const ti of Ct){const wn=[],On=[];for(const ri of ti){const _i=ri.x+dn.x,pi=ri.y+dn.y,yi=hx(_i,pi,Qe,Dt,en,Ot,pn,Dn);gn[0]=_i,gn[1]=pi,gn[2]=yi.base,gn[3]=1,zl(gn,gn,Vt),gn[3]=Math.max(gn[3],1e-5);const vi=new Wc(gn[0]/gn[3],gn[1]/gn[3],gn[2]/gn[3]);gn[0]=_i,gn[1]=pi,gn[2]=yi.top,gn[3]=1,zl(gn,gn,Vt),gn[3]=Math.max(gn[3],1e-5);const Pi=new Wc(gn[0]/gn[3],gn[1]/gn[3],gn[2]/gn[3]);wn.push(vi),On.push(Pi)}zn.push(wn),Mn.push(On)}return[zn,Mn]}(we,ye,$e,qe,it,St,Ke,ut,dt):function(Ct,Qe,Dt,dn,Vt){const en=[],Ot=[],pn=Vt[8]*Qe,Dn=Vt[9]*Qe,zn=Vt[10]*Qe,Mn=Vt[11]*Qe,gn=Vt[8]*Dt,ti=Vt[9]*Dt,wn=Vt[10]*Dt,On=Vt[11]*Dt;for(const ri of Ct){const _i=[],pi=[];for(const yi of ri){const vi=yi.x+dn.x,Pi=yi.y+dn.y,or=Vt[0]*vi+Vt[4]*Pi+Vt[12],ni=Vt[1]*vi+Vt[5]*Pi+Vt[13],Hi=Vt[2]*vi+Vt[6]*Pi+Vt[14],Ni=Vt[3]*vi+Vt[7]*Pi+Vt[15],Zn=or+pn,Si=ni+Dn,Qi=Hi+zn,oi=Math.max(Ni+Mn,1e-5),Oi=or+gn,Er=ni+ti,sr=Hi+wn,ar=Math.max(Ni+On,1e-5);_i.push(new Wc(Zn/oi,Si/oi,Qi/oi)),pi.push(new Wc(Oi/ar,Er/ar,sr/ar))}en.push(_i),Ot.push(pi)}return[en,Ot]}(we,ye,$e,qe,it)}(d,a,P,A,E,g,W,z,F,d.center.lat,n.tileID.canonical),ae=n.queryGeometry;return function(de,we,ye){let $e=1/0;w0(ye,we)&&($e=ux(ye,we[0]));for(let qe=0;qe<we.length;qe++){const it=we[qe],St=de[qe];for(let Ke=0;Ke<it.length-1;Ke++){const ut=it[Ke],dt=[ut,it[Ke+1],St[Ke+1],St[Ke],ut];b0(ye,dt)&&($e=Math.min($e,ux(ye,dt)))}}return $e!==1/0&&$e}(le,_e,ae.isPointQuery()?ae.screenBounds:ae.screenGeometry)}},line:class extends $o{constructor(n){super(n,dx),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(n){if(n==="line-gradient"){const t=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=t._styleExpression&&t._styleExpression.expression instanceof vc,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(n,t){super.recalculate(n,t),this.paint._values["line-floorwidth"]=fx.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,n)}createBucket(n){return new up(n)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getProgramConfiguration(n){return new wa(this,n)}queryRadius(n){const t=n,i=px(qc("line-width",this,t),qc("line-gap-width",this,t)),a=qc("line-offset",this,t);return i/2+Math.abs(a)+Qf(this.paint.get("line-translate"))}queryIntersectsFeature(n,t,i,a,c,d){if(n.queryGeometry.isAboveHorizon)return!1;const g=C0(n.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),d.angle,n.pixelToTileUnitsFactor),y=n.pixelToTileUnitsFactor/2*px(this.paint.get("line-width").evaluate(t,i),this.paint.get("line-gap-width").evaluate(t,i)),w=this.paint.get("line-offset").evaluate(t,i);return w&&(a=function(E,A){const P=[],z=new ce(0,0);for(let B=0;B<E.length;B++){const F=E[B],q=[];for(let W=0;W<F.length;W++){const le=F[W-1],_e=F[W],ae=F[W+1],de=W===0?z:_e.sub(le)._unit()._perp(),we=W===F.length-1?z:ae.sub(_e)._unit()._perp(),ye=de._add(we)._unit();ye._mult(1/(ye.x*we.x+ye.y*we.y)),q.push(ye._mult(A)._add(_e))}P.push(q)}return P}(a,w*n.pixelToTileUnitsFactor)),function(E,A,P){for(let z=0;z<A.length;z++){const B=A[z];if(E.length>=3){for(let F=0;F<B.length;F++)if(Il(E,B[F]))return!0}if(oC(E,B,P))return!0}return!1}(g,a,y)}isTileClipped(){return!0}},symbol:Sp,background:class extends $o{constructor(n){super(n,rM)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}},raster:class extends $o{constructor(n){super(n,oM)}getProgramIds(){return["raster"]}},sky:class extends $o{constructor(n){super(n,aM),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(n){n==="sky-gradient"?this._updateColorRamp():n!=="sky-atmosphere-sun"&&n!=="sky-atmosphere-halo-color"&&n!=="sky-atmosphere-color"&&n!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=Xg({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(n){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const t=n.style.light.properties.get("position");return this._lightPosition.azimuthal!==t.azimuthal||this._lightPosition.polar!==t.polar}return!1}getCenter(n,t){if(this.paint.get("sky-type")==="atmosphere"){const a=this.paint.get("sky-atmosphere-sun"),c=!a,d=n.style.light,g=d.properties.get("position");return c&&d.properties.get("anchor")==="viewport"&&oe("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),c?b_(g.azimuthal,90-g.polar,t):b_(a[0],90-a[1],t)}const i=this.paint.get("sky-gradient-center");return b_(i[0],90-i[1],t)}is3D(){return!1}isSky(){return!0}markSkyboxValid(n){this._skyboxInvalidated=!1,this._lightPosition=n.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const n=this.paint.get("sky-type");return n==="atmosphere"?["skyboxCapture","skybox"]:n==="gradient"?["skyboxGradient"]:null}}};class sd{constructor(t,i,a,c){this.context=t,this.format=a,this.texture=t.gl.createTexture(),this.update(i,c)}update(t,i,a){const{width:c,height:d}=t,{context:g}=this,{gl:y}=g,{HTMLImageElement:w,HTMLCanvasElement:E,HTMLVideoElement:A,ImageData:P,ImageBitmap:z}=S;if(y.bindTexture(y.TEXTURE_2D,this.texture),g.pixelStoreUnpackFlipY.set(!1),g.pixelStoreUnpack.set(1),g.pixelStoreUnpackPremultiplyAlpha.set(this.format===y.RGBA&&(!i||i.premultiply!==!1)),a||this.size&&this.size[0]===c&&this.size[1]===d){const{x:B,y:F}=a||{x:0,y:0};t instanceof w||t instanceof E||t instanceof A||t instanceof P||z&&t instanceof z?y.texSubImage2D(y.TEXTURE_2D,0,B,F,y.RGBA,y.UNSIGNED_BYTE,t):y.texSubImage2D(y.TEXTURE_2D,0,B,F,c,d,y.RGBA,y.UNSIGNED_BYTE,t.data)}else this.size=[c,d],t instanceof w||t instanceof E||t instanceof A||t instanceof P||z&&t instanceof z?y.texImage2D(y.TEXTURE_2D,0,this.format,this.format,y.UNSIGNED_BYTE,t):y.texImage2D(y.TEXTURE_2D,0,this.format,c,d,0,this.format,y.UNSIGNED_BYTE,t.data);this.useMipmap=Boolean(i&&i.useMipmap&&this.isSizePowerOfTwo()),this.useMipmap&&y.generateMipmap(y.TEXTURE_2D)}bind(t,i){const{context:a}=this,{gl:c}=a;c.bindTexture(c.TEXTURE_2D,this.texture),t!==this.filter&&(c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MAG_FILTER,t),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER,this.useMipmap?t===c.NEAREST?c.NEAREST_MIPMAP_NEAREST:c.LINEAR_MIPMAP_NEAREST:t),this.filter=t),i!==this.wrap&&(c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_S,i),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_T,i),this.wrap=i)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:t}=this.context;t.deleteTexture(this.texture),this.texture=null}}class cM{constructor(t){this._callback=t,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class uM{constructor(){this.tasks={},this.taskQueue=[],gt(["process"],this),this.invoker=new cM(this.process),this.nextId=0}add(t,i){const a=this.nextId++,c=function({type:d,isSymbolTile:g,zoom:y}){return y=y||0,d==="message"?0:d!=="maybePrepare"||g?d!=="parseTile"||g?d==="parseTile"&&g?300-y:d==="maybePrepare"&&g?400-y:500:200-y:100-y}(i);if(c===0){nt();try{t()}finally{}return{cancel:()=>{}}}return this.tasks[a]={fn:t,metadata:i,priority:c,id:a},this.taskQueue.push(a),this.invoker.trigger(),{cancel:()=>{delete this.tasks[a]}}}process(){nt();try{if(this.taskQueue=this.taskQueue.filter(a=>!!this.tasks[a]),!this.taskQueue.length)return;const t=this.pick();if(t===null)return;const i=this.tasks[t];if(delete this.tasks[t],this.taskQueue.length&&this.invoker.trigger(),!i)return;i.fn()}finally{}}pick(){let t=null,i=1/0;for(let c=0;c<this.taskQueue.length;c++){const d=this.tasks[this.taskQueue[c]];d.priority<i&&(i=d.priority,t=c)}if(t===null)return null;const a=this.taskQueue[t];return this.taskQueue.splice(t,1),a}remove(){this.invoker.remove()}}class rb{constructor(t){this._stringToNumber={},this._numberToString=[];for(let i=0;i<t.length;i++){const a=t[i];this._stringToNumber[a]=i,this._numberToString[i]=a}}encode(t){return this._stringToNumber[t]}decode(t){return this._numberToString[t]}}const hM=["tile","layer","source","sourceLayer","state"];class ob{constructor(t,i,a,c,d){this.type="Feature",this._vectorTileFeature=t,this._z=i,this._x=a,this._y=c,this.properties=t.properties,this.id=d}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(t){this._geometry=t}toJSON(){const t={type:"Feature",geometry:this.geometry,properties:this.properties};this.id!==void 0&&(t.id=this.id);for(const i of hM)this[i]!==void 0&&(t[i]=this[i]);return t}}const Mo=32,ps=33,Aa=new Uint16Array(8184);for(let n=0;n<2046;n++){let t=n+2,i=0,a=0,c=0,d=0,g=0,y=0;for(1&t?c=d=g=Mo:i=a=y=Mo;(t>>=1)>1;){const E=i+c>>1,A=a+d>>1;1&t?(c=i,d=a,i=g,a=y):(i=c,a=d,c=g,d=y),g=E,y=A}const w=4*n;Aa[w+0]=i,Aa[w+1]=a,Aa[w+2]=c,Aa[w+3]=d}const ms=new Uint16Array(2178),Ma=new Uint8Array(1089),Cp=new Uint16Array(1089);function sb(n){return n===0?-.03125:n===32?.03125:0}var ab=Gt([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);const lb={type:2,extent:_n,loadGeometry:()=>[[new ce(0,0),new ce(8193,0),new ce(8193,8193),new ce(0,8193),new ce(0,0)]]};class w_{constructor(t,i,a,c,d){this.tileID=t,this.uid=Bt(),this.uses=0,this.tileSize=i,this.tileZoom=a,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=d,this.expiredRequestCount=0,this.state="loading",c&&c.transform&&(this.projection=c.transform.projection)}registerFadeDuration(t){const i=t+this.timeAdded;i<at.now()||this.fadeEndTime&&i<this.fadeEndTime||(this.fadeEndTime=i)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=Dl(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(t,i,a){if(this.unloadVectorData(),this.state="loaded",t){t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=function(c,d){const g={};if(!d)return g;for(const y of c){const w=y.layerIds.map(E=>d.getLayer(E)).filter(Boolean);if(w.length!==0){y.layers=w,y.stateDependentLayerIds&&(y.stateDependentLayers=y.stateDependentLayerIds.map(E=>w.filter(A=>A.id===E)[0]));for(const E of w)g[E.id]=y}}return g}(t.buckets,i.style),this.hasSymbolBuckets=!1;for(const c in this.buckets){const d=this.buckets[c];if(d instanceof Ca){if(this.hasSymbolBuckets=!0,!a)break;d.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const c in this.buckets){const d=this.buckets[c];if(d instanceof Ca&&d.hasRTLText){this.hasRTLText=!0,je.isLoading()||je.isLoaded()||Pe()!=="deferred"||We();break}}this.queryPadding=0;for(const c in this.buckets){const d=this.buckets[c];this.queryPadding=Math.max(this.queryPadding,i.style.getLayer(c).queryRadius(d))}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage),t.lineAtlas&&(this.lineAtlas=t.lineAtlas)}else this.collisionBoxArray=new kg}unloadVectorData(){if(this.hasData()){for(const t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(t){return this.buckets[t.id]}upload(t){for(const a in this.buckets){const c=this.buckets[a];c.uploadPending()&&c.upload(t)}const i=t.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new sd(t,this.imageAtlas.image,i.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new sd(t,this.glyphAtlasImage,i.ALPHA),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new sd(t,this.lineAtlas.image,i.ALPHA),this.lineAtlas.uploaded=!0)}prepare(t){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture)}queryRenderedFeatures(t,i,a,c,d,g,y,w){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({tileResult:c,pixelPosMatrix:y,transform:g,params:d,tileTransform:this.tileTransform},t,i,a):{}}querySourceFeatures(t,i){const a=this.latestFeatureIndex;if(!a||!a.rawTileData)return;const c=a.loadVTLayers(),d=i?i.sourceLayer:"",g=c._geojsonTileLayer||c[d];if(!g)return;const y=Rs(i&&i.filter),{z:w,x:E,y:A}=this.tileID.canonical,P={z:w,x:E,y:A};for(let z=0;z<g.length;z++){const B=g.feature(z);if(y.needGeometry){const W=Ml(B,!0);if(!y.filter(new Le(this.tileID.overscaledZ),W,this.tileID.canonical))continue}else if(!y.filter(new Le(this.tileID.overscaledZ),B))continue;const F=a.getId(B,d),q=new ob(B,w,E,A,F);q.tile=P,t.push(q)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(t){const i=this.expirationTime;if(t.cacheControl){const a=yt(t.cacheControl);a["max-age"]&&(this.expirationTime=Date.now()+1e3*a["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){const a=Date.now();let c=!1;if(this.expirationTime>a)c=!1;else if(i)if(this.expirationTime<i)c=!0;else{const d=this.expirationTime-i;d?this.expirationTime=a+Math.max(d,3e4):c=!0}else c=!0;c?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(t,i){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(t).length===0||!i)return;const a=this.latestFeatureIndex.loadVTLayers(),c=i.style.listImages();for(const d in this.buckets){if(!i.style.hasLayer(d))continue;const g=this.buckets[d],y=g.layers[0].sourceLayer||"_geojsonTileLayer",w=a[y],E=t[y];if(!w||!E||Object.keys(E).length===0)continue;if(g.update(E,w,c,this.imageAtlas&&this.imageAtlas.patternPositions||{}),g instanceof up||g instanceof op){const P=i.style._getSourceCache(g.layers[0].source);i._terrain&&i._terrain.enabled&&P&&g.programConfigurations.needsUpload&&i._terrain._clearRenderCacheForTile(P.id,this.tileID)}const A=i&&i.style&&i.style.getLayer(d);A&&(this.queryPadding=Math.max(this.queryPadding,A.queryRadius(g)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<at.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(t){this.symbolFadeHoldUntil=at.now()+t}setTexture(t,i){const a=i.context,c=a.gl;this.texture=this.texture||i.getTileTexture(t.width),this.texture?this.texture.update(t,{useMipmap:!0}):(this.texture=new sd(a,t,c.RGBA,{useMipmap:!0}),this.texture.bind(c.LINEAR,c.CLAMP_TO_EDGE),a.extTextureFilterAnisotropic&&c.texParameterf(c.TEXTURE_2D,a.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,a.extTextureFilterAnisotropicMax))}setDependencies(t,i){const a={};for(const c of i)a[c]=!0;this.dependencies[t]=a}hasDependency(t,i){for(const a of t){const c=this.dependencies[a];if(c){for(const d of i)if(c[d])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(t,i){if(!i||i.name==="mercator"||this._tileDebugBuffer)return;const a=Bs(lb,this.tileID.canonical,this.tileTransform)[0],c=new Wn,d=new kh;for(let g=0;g<a.length;g++){const{x:y,y:w}=a[g];c.emplaceBack(y,w),d.emplaceBack(g)}d.emplaceBack(0),this._tileDebugIndexBuffer=t.createIndexBuffer(d),this._tileDebugBuffer=t.createVertexBuffer(c,Qh.members),this._tileDebugSegments=Wi.simpleSegment(0,0,c.length,d.length)}_makeTileBoundsBuffers(t,i){if(this._tileBoundsBuffer||!i||i.name==="mercator")return;const a=Bs(lb,this.tileID.canonical,this.tileTransform)[0];let c,d;if(this.isRaster){const g=function(y,w){const E=Dl(y,w),A=Math.pow(2,y.z);for(let W=0;W<ps;W++)for(let le=0;le<ps;le++){const _e=co((y.x+(le+sb(le))/Mo)/A),ae=mr((y.y+(W+sb(W))/Mo)/A),de=w.project(_e,ae),we=W*ps+le;ms[2*we+0]=Math.round((de.x*E.scale-E.x)*_n),ms[2*we+1]=Math.round((de.y*E.scale-E.y)*_n)}Ma.fill(0),Cp.fill(0);for(let W=2045;W>=0;W--){const le=4*W,_e=Aa[le+0],ae=Aa[le+1],de=Aa[le+2],we=Aa[le+3],ye=_e+de>>1,$e=ae+we>>1,qe=ye+$e-ae,it=$e+_e-ye,St=ae*ps+_e,Ke=we*ps+de,ut=$e*ps+ye,dt=Math.hypot((ms[2*St+0]+ms[2*Ke+0])/2-ms[2*ut+0],(ms[2*St+1]+ms[2*Ke+1])/2-ms[2*ut+1])>=16;if(Ma[ut]=Ma[ut]||(dt?1:0),W<1022){const vt=(ae+it>>1)*ps+(_e+qe>>1),Ct=(we+it>>1)*ps+(de+qe>>1);Ma[ut]=Ma[ut]||Ma[vt]||Ma[Ct]}}const P=new ii,z=new pr;let B=0;function F(W,le){const _e=le*ps+W;return Cp[_e]===0&&(P.emplaceBack(ms[2*_e+0],ms[2*_e+1],W*_n/Mo,le*_n/Mo),Cp[_e]=++B),Cp[_e]-1}function q(W,le,_e,ae,de,we){const ye=W+_e>>1,$e=le+ae>>1;if(Math.abs(W-de)+Math.abs(le-we)>1&&Ma[$e*ps+ye])q(de,we,W,le,ye,$e),q(_e,ae,de,we,ye,$e);else{const qe=F(W,le),it=F(_e,ae),St=F(de,we);z.emplaceBack(qe,it,St)}}return q(0,0,Mo,Mo,Mo,0),q(Mo,Mo,0,0,0,Mo),{vertices:P,indices:z}}(this.tileID.canonical,i);c=g.vertices,d=g.indices}else{c=new ii,d=new pr;for(const{x:y,y:w}of a)c.emplaceBack(y,w,0,0);const g=Fh.exports(c.int16,void 0,4);for(let y=0;y<g.length;y+=3)d.emplaceBack(g[y],g[y+1],g[y+2])}this._tileBoundsBuffer=t.createVertexBuffer(c,ab.members),this._tileBoundsIndexBuffer=t.createIndexBuffer(d),this._tileBoundsSegments=Wi.simpleSegment(0,0,c.length,d.length)}_makeGlobeTileDebugBuffers(t,i){const a=i.projection;if(!a||a.name!=="globe"||i.freezeTileCoverage)return;const c=this.tileID.canonical,d=td(Gx(c,i)),g=iu(i.zoom);let y;g>0&&(y=Vg(new Float64Array(16),i.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(t,c,i,d,y,g),this._makeGlobeTileDebugTextBuffer(t,c,i,d,y,g)}_globePoint(t,i,a,c,d,g,y){let w=ed(t,i,a);if(g){const E=1<<a.z,A=cs(c.center.lng),P=us(c.center.lat),z=(a.x+.5)/E-A;let B=0;z>.5?B=-1:z<-.5&&(B=1);let F=(t/_n+a.x)/E+B,q=(i/_n+a.y)/E;F=(F-A)*c._pixelsPerMercatorPixel+A,q=(q-P)*c._pixelsPerMercatorPixel+P;const W=[F*c.worldSize,q*c.worldSize,0];Di(W,W,g),w=Rl(w,W,y)}return Di(w,w,d)}_makeGlobeTileDebugBorderBuffer(t,i,a,c,d,g){const y=new Wn,w=new kh,E=new li,A=(z,B,F,q,W)=>{const le=(F-z)/(W-1),_e=(q-B)/(W-1),ae=y.length;for(let de=0;de<W;de++){const we=z+de*le,ye=B+de*_e;y.emplaceBack(we,ye);const $e=this._globePoint(we,ye,i,a,c,d,g);E.emplaceBack($e[0],$e[1],$e[2]),w.emplaceBack(ae+de)}},P=_n;A(0,0,P,0,16),A(P,0,P,P,16),A(P,P,0,P,16),A(0,P,0,0,16),this._tileDebugIndexBuffer=t.createIndexBuffer(w),this._tileDebugBuffer=t.createVertexBuffer(y,Qh.members),this._globeTileDebugBorderBuffer=t.createVertexBuffer(E,qx.members),this._tileDebugSegments=Wi.simpleSegment(0,0,y.length,w.length)}_makeGlobeTileDebugTextBuffer(t,i,a,c,d,g){const y=new Wn,w=new pr,E=new li,A=25;w.reserve(32),y.reserve(A),E.reserve(A);const P=(z,B)=>A*z+B;for(let z=0;z<A;z++){const B=2048*z;for(let F=0;F<A;F++){const q=2048*F;y.emplaceBack(q,B);const W=this._globePoint(q,B,i,a,c,d,g);E.emplaceBack(W[0],W[1],W[2])}}for(let z=0;z<4;z++)for(let B=0;B<4;B++){const F=P(z,B),q=P(z,B+1),W=P(z+1,B),le=P(z+1,B+1);w.emplaceBack(F,q,W),w.emplaceBack(W,q,le)}this._tileDebugTextIndexBuffer=t.createIndexBuffer(w),this._tileDebugTextBuffer=t.createVertexBuffer(y,Qh.members),this._globeTileDebugTextBuffer=t.createVertexBuffer(E,qx.members),this._tileDebugTextSegments=Wi.simpleSegment(0,0,A,32)}}class dM{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(t,i,a){const c=String(i);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][c]=this.stateChanges[t][c]||{},Ve(this.stateChanges[t][c],a),this.deletedStates[t]===null){this.deletedStates[t]={};for(const d in this.state[t])d!==c&&(this.deletedStates[t][d]=null)}else if(this.deletedStates[t]&&this.deletedStates[t][c]===null){this.deletedStates[t][c]={};for(const d in this.state[t][c])a[d]||(this.deletedStates[t][c][d]=null)}else for(const d in a)this.deletedStates[t]&&this.deletedStates[t][c]&&this.deletedStates[t][c][d]===null&&delete this.deletedStates[t][c][d]}removeFeatureState(t,i,a){if(this.deletedStates[t]===null)return;const c=String(i);if(this.deletedStates[t]=this.deletedStates[t]||{},a&&i!==void 0)this.deletedStates[t][c]!==null&&(this.deletedStates[t][c]=this.deletedStates[t][c]||{},this.deletedStates[t][c][a]=null);else if(i!==void 0)if(this.stateChanges[t]&&this.stateChanges[t][c])for(a in this.deletedStates[t][c]={},this.stateChanges[t][c])this.deletedStates[t][c][a]=null;else this.deletedStates[t][c]=null;else this.deletedStates[t]=null}getState(t,i){const a=String(i),c=Ve({},(this.state[t]||{})[a],(this.stateChanges[t]||{})[a]);if(this.deletedStates[t]===null)return{};if(this.deletedStates[t]){const d=this.deletedStates[t][i];if(d===null)return{};for(const g in d)delete c[g]}return c}initializeTileState(t,i){t.setFeatureState(this.state,i)}coalesceChanges(t,i){const a={};for(const c in this.stateChanges){this.state[c]=this.state[c]||{};const d={};for(const g in this.stateChanges[c])this.state[c][g]||(this.state[c][g]={}),Ve(this.state[c][g],this.stateChanges[c][g]),d[g]=this.state[c][g];a[c]=d}for(const c in this.deletedStates){this.state[c]=this.state[c]||{};const d={};if(this.deletedStates[c]===null)for(const g in this.state[c])d[g]={},this.state[c][g]={};else for(const g in this.deletedStates[c]){if(this.deletedStates[c][g]===null)this.state[c][g]={};else for(const y of Object.keys(this.deletedStates[c][g]))delete this.state[c][g][y];d[g]=this.state[c][g]}a[c]=a[c]||{},Ve(a[c],d)}if(this.stateChanges={},this.deletedStates={},Object.keys(a).length!==0)for(const c in t)t[c].setFeatureState(a,i)}}class cb{constructor(t){this.size=t,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(t,i){const a=this.toIdx(t,i);return{min:this.minimums[a],max:this.maximums[a]}}isLeaf(t,i){return this.leaves[this.toIdx(t,i)]}toIdx(t,i){return i*this.size+t}}function ub(n,t,i,a){let c=0,d=Number.MAX_VALUE;for(let g=0;g<3;g++)if(Math.abs(a[g])<1e-15){if(i[g]<n[g]||i[g]>t[g])return null}else{const y=1/a[g];let w=(n[g]-i[g])*y,E=(t[g]-i[g])*y;if(w>E){const A=w;w=E,E=A}if(w>c&&(c=w),E<d&&(d=E),c>d)return null}return c}function hb(n,t,i,a,c,d,g,y,w,E,A){const P=a-n,z=c-t,B=d-i,F=g-n,q=y-t,W=w-i,le=A[1]*W-A[2]*q,_e=A[2]*F-A[0]*W,ae=A[0]*q-A[1]*F,de=P*le+z*_e+B*ae;if(Math.abs(de)<1e-15)return null;const we=1/de,ye=E[0]-n,$e=E[1]-t,qe=E[2]-i,it=(ye*le+$e*_e+qe*ae)*we;if(it<0||it>1)return null;const St=$e*B-qe*z,Ke=qe*P-ye*B,ut=ye*z-$e*P,dt=(A[0]*St+A[1]*Ke+A[2]*ut)*we;return dt<0||it+dt>1?null:(F*St+q*Ke+W*ut)*we}function db(n,t,i){return(n-t)/(i-t)}function fb(n,t,i,a,c,d,g,y,w){const E=1<<i,A=d-a,P=g-c,z=(n+1)/E*A+a,B=(t+0)/E*P+c,F=(t+1)/E*P+c;y[0]=(n+0)/E*A+a,y[1]=B,w[0]=z,w[1]=F}class pb{constructor(t){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=t,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const i=function(d){const g=Math.ceil(Math.log2(d.dim/8)),y=[];let w=Math.ceil(Math.pow(2,g));const E=1/w,A=(B,F,q,W,le)=>{const _e=W?1:0,ae=(B+1)*q-_e,de=F*q,we=(F+1)*q-_e;le[0]=B*q,le[1]=de,le[2]=ae,le[3]=we};let P=new cb(w);const z=[];for(let B=0;B<w*w;B++){A(B%w,Math.floor(B/w),E,!1,z);const F=Ia(z[0],z[1],d),q=Ia(z[2],z[1],d),W=Ia(z[2],z[3],d),le=Ia(z[0],z[3],d);P.minimums.push(Math.min(F,q,W,le)),P.maximums.push(Math.max(F,q,W,le)),P.leaves.push(1)}for(y.push(P),w/=2;w>=1;w/=2){const B=y[y.length-1];P=new cb(w);for(let F=0;F<w*w;F++){A(F%w,Math.floor(F/w),2,!0,z);const q=B.getElevation(z[0],z[1]),W=B.getElevation(z[2],z[1]),le=B.getElevation(z[2],z[3]),_e=B.getElevation(z[0],z[3]),ae=B.isLeaf(z[0],z[1]),de=B.isLeaf(z[2],z[1]),we=B.isLeaf(z[2],z[3]),ye=B.isLeaf(z[0],z[3]),$e=Math.min(q.min,W.min,le.min,_e.min),qe=Math.max(q.max,W.max,le.max,_e.max),it=ae&&de&&we&&ye;P.maximums.push(qe),P.minimums.push($e),P.leaves.push(qe-$e<=5&&it?1:0)}y.push(P)}return y}(this.dem),a=i.length-1,c=i[a];this._addNode(c.minimums[0],c.maximums[0],c.leaves[0]),this._construct(i,0,0,a,0)}raycastRoot(t,i,a,c,d,g,y=1){return ub([t,i,-100],[a,c,this.maximums[0]*y],d,g)}raycast(t,i,a,c,d,g,y=1){if(!this.nodeCount)return null;const w=this.raycastRoot(t,i,a,c,d,g,y);if(w==null)return null;const E=[],A=[],P=[],z=[],B=[{idx:0,t:w,nodex:0,nodey:0,depth:0}];for(;B.length>0;){const{idx:F,t:q,nodex:W,nodey:le,depth:_e}=B.pop();if(this.leaves[F]){fb(W,le,_e,t,i,a,c,P,z);const de=1<<_e,we=(W+0)/de,ye=(W+1)/de,$e=(le+0)/de,qe=(le+1)/de,it=Ia(we,$e,this.dem)*y,St=Ia(ye,$e,this.dem)*y,Ke=Ia(ye,qe,this.dem)*y,ut=Ia(we,qe,this.dem)*y,dt=hb(P[0],P[1],it,z[0],P[1],St,z[0],z[1],Ke,d,g),vt=hb(z[0],z[1],Ke,P[0],z[1],ut,P[0],P[1],it,d,g),Ct=Math.min(dt!==null?dt:Number.MAX_VALUE,vt!==null?vt:Number.MAX_VALUE);if(Ct!==Number.MAX_VALUE)return Ct;{const Qe=Oh([],d,g,q);if(mb(it,St,ut,Ke,db(Qe[0],P[0],z[0]),db(Qe[1],P[1],z[1]))>=Qe[2])return q}continue}let ae=0;for(let de=0;de<this._siblingOffset.length;de++){fb((W<<1)+this._siblingOffset[de][0],(le<<1)+this._siblingOffset[de][1],_e+1,t,i,a,c,P,z),P[2]=-100,z[2]=this.maximums[this.childOffsets[F]+de]*y;const we=ub(P,z,d,g);if(we!=null){const ye=we;E[de]=ye;let $e=!1;for(let qe=0;qe<ae&&!$e;qe++)ye>=E[A[qe]]&&(A.splice(qe,0,de),$e=!0);$e||(A[ae]=de),ae++}}for(let de=0;de<ae;de++){const we=A[de];B.push({idx:this.childOffsets[F]+we,t:E[we],nodex:(W<<1)+this._siblingOffset[we][0],nodey:(le<<1)+this._siblingOffset[we][1],depth:_e+1})}}return null}_addNode(t,i,a){return this.minimums.push(t),this.maximums.push(i),this.leaves.push(a),this.childOffsets.push(0),this.nodeCount++}_construct(t,i,a,c,d){if(t[c].isLeaf(i,a)===1)return;this.childOffsets[d]||(this.childOffsets[d]=this.nodeCount);const g=c-1,y=t[g];let w=0,E=0;for(let A=0;A<this._siblingOffset.length;A++){const P=2*i+this._siblingOffset[A][0],z=2*a+this._siblingOffset[A][1],B=y.getElevation(P,z),F=y.isLeaf(P,z),q=this._addNode(B.min,B.max,F);F&&(w|=1<<A),E||(E=q)}for(let A=0;A<this._siblingOffset.length;A++)w&1<<A||this._construct(t,2*i+this._siblingOffset[A][0],2*a+this._siblingOffset[A][1],g,E+A)}}function mb(n,t,i,a,c,d){return $n($n(n,i,d),$n(t,a,d),c)}function Ia(n,t,i){const a=i.dim,c=lt(n*a-.5,0,a-1),d=lt(t*a-.5,0,a-1),g=Math.floor(c),y=Math.floor(d),w=Math.min(g+1,a-1),E=Math.min(y+1,a-1);return mb(i.get(g,y),i.get(w,y),i.get(g,E),i.get(w,E),c-g,d-y)}const gb={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};class Ap{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(t,i,a,c=!1,d=!1){if(this.uid=t,i.height!==i.width)throw new RangeError("DEM tiles must be square");if(a&&a!=="mapbox"&&a!=="terrarium")return oe(`"${a}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=i.height;const g=this.dim=i.height-2,y=new Uint32Array(i.data.buffer);if(this.pixels=new Uint8Array(i.data.buffer),this.encoding=a||"mapbox",this.borderReady=c,!c){for(let w=0;w<g;w++)y[this._idx(-1,w)]=y[this._idx(0,w)],y[this._idx(g,w)]=y[this._idx(g-1,w)],y[this._idx(w,-1)]=y[this._idx(w,0)],y[this._idx(w,g)]=y[this._idx(w,g-1)];y[this._idx(-1,-1)]=y[this._idx(0,0)],y[this._idx(g,-1)]=y[this._idx(g-1,0)],y[this._idx(-1,g)]=y[this._idx(0,g-1)],y[this._idx(g,g)]=y[this._idx(g-1,g-1)],d&&this._buildQuadTree()}}_buildQuadTree(){this._tree=new pb(this)}get(t,i,a=!1){a&&(t=lt(t,-1,this.dim),i=lt(i,-1,this.dim));const c=4*this._idx(t,i);return(this.encoding==="terrarium"?this._unpackTerrarium:this._unpackMapbox)(this.pixels[c],this.pixels[c+1],this.pixels[c+2])}static getUnpackVector(t){return gb[t]}get unpackVector(){return gb[this.encoding]}_idx(t,i){if(t<-1||t>=this.dim+1||i<-1||i>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(i+1)*this.stride+(t+1)}_unpackMapbox(t,i,a){return(256*t*256+256*i+a)/10-1e4}_unpackTerrarium(t,i,a){return 256*t+i+a/256-32768}static pack(t,i){const a=[0,0,0,0],c=Ap.getUnpackVector(i);let d=Math.floor((t+c[3])/c[2]);return a[2]=d%256,d=Math.floor(d/256),a[1]=d%256,d=Math.floor(d/256),a[0]=d,a}getPixels(){return new Qr({width:this.stride,height:this.stride},this.pixels)}backfillBorder(t,i,a){if(this.dim!==t.dim)throw new Error("dem dimension mismatch");let c=i*this.dim,d=i*this.dim+this.dim,g=a*this.dim,y=a*this.dim+this.dim;switch(i){case-1:c=d-1;break;case 1:d=c+1}switch(a){case-1:g=y-1;break;case 1:y=g+1}const w=-i*this.dim,E=-a*this.dim;for(let A=g;A<y;A++)for(let P=c;P<d;P++){const z=4*this._idx(P,A),B=4*this._idx(P+w,A+E);this.pixels[z+0]=t.pixels[B+0],this.pixels[z+1]=t.pixels[B+1],this.pixels[z+2]=t.pixels[B+2],this.pixels[z+3]=t.pixels[B+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}Zt(Ap,"DEMData"),Zt(pb,"DemMinMaxQuadTree",{omit:["dem"]});class fM{constructor(t,i){this.max=t,this.onRemove=i,this.reset()}reset(){for(const t in this.data)for(const i of this.data[t])i.timeout&&clearTimeout(i.timeout),this.onRemove(i.value);return this.data={},this.order=[],this}add(t,i,a){const c=t.wrapped().key;this.data[c]===void 0&&(this.data[c]=[]);const d={value:i,timeout:void 0};if(a!==void 0&&(d.timeout=setTimeout(()=>{this.remove(t,d)},a)),this.data[c].push(d),this.order.push(c),this.order.length>this.max){const g=this._getAndRemoveByKey(this.order[0]);g&&this.onRemove(g)}return this}has(t){return t.wrapped().key in this.data}getAndRemove(t){return this.has(t)?this._getAndRemoveByKey(t.wrapped().key):null}_getAndRemoveByKey(t){const i=this.data[t].shift();return i.timeout&&clearTimeout(i.timeout),this.data[t].length===0&&delete this.data[t],this.order.splice(this.order.indexOf(t),1),i.value}getByKey(t){const i=this.data[t];return i?i[0].value:null}get(t){return this.has(t)?this.data[t.wrapped().key][0].value:null}remove(t,i){if(!this.has(t))return this;const a=t.wrapped().key,c=i===void 0?0:this.data[a].indexOf(i),d=this.data[a][c];return this.data[a].splice(c,1),d.timeout&&clearTimeout(d.timeout),this.data[a].length===0&&delete this.data[a],this.onRemove(d.value),this.order.splice(this.order.indexOf(a),1),this}setMaxSize(t){for(this.max=t;this.order.length>this.max;){const i=this._getAndRemoveByKey(this.order[0]);i&&this.onRemove(i)}return this}filter(t){const i=[];for(const a in this.data)for(const c of this.data[a])t(c.value)||i.push(c);for(const a of i)this.remove(a.value.tileID,a)}}class ou{constructor(t,i,a){this.func=t,this.mask=i,this.range=a}}ou.ReadOnly=!1,ou.ReadWrite=!0,ou.disabled=new ou(519,ou.ReadOnly,[0,1]);const E_=7680;class T_{constructor(t,i,a,c,d,g){this.test=t,this.ref=i,this.mask=a,this.fail=c,this.depthFail=d,this.pass=g}}T_.disabled=new T_({func:519,mask:0},0,0,E_,E_,E_);class gs{constructor(t,i,a){this.blendFunction=t,this.blendColor=i,this.mask=a}}gs.Replace=[1,0],gs.disabled=new gs(gs.Replace,ki.transparent,[!1,!1,!1,!1]),gs.unblended=new gs(gs.Replace,ki.transparent,[!0,!0,!0,!0]),gs.alphaBlended=new gs([1,771],ki.transparent,[!0,!0,!0,!0]);const S_=1029,C_=2305;class Wo{constructor(t,i,a){this.enable=t,this.mode=i,this.frontFace=a}}Wo.disabled=new Wo(!1,S_,C_),Wo.backCCW=new Wo(!0,S_,C_),Wo.backCW=new Wo(!0,S_,2304),Wo.frontCW=new Wo(!0,1028,2304),Wo.frontCCW=new Wo(!0,1028,C_);class Ol extends mi{constructor(t,i,a){super(),this.id=t,this._onlySymbols=a,i.on("data",c=>{c.dataType==="source"&&c.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&c.dataType==="source"&&c.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),i.on("error",()=>{this._sourceErrored=!0}),this._source=i,this._tiles={},this._cache=new fM(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=i.minTileCacheSize,this._maxTileCacheSize=i.maxTileCacheSize,this._loadedParentTiles={},this._coveredTiles={},this._state=new dM,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(t){this.map=t,this._minTileCacheSize=this._minTileCacheSize===void 0&&t?t._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&t?t._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const t in this._tiles){const i=this._tiles[t];if(i.state!=="loaded"&&i.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const t=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,t&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(t,i){return t.isSymbolTile=this._onlySymbols,this._source.loadTile(t,i)}_unloadTile(t){if(this._source.unloadTile)return this._source.unloadTile(t,()=>{})}_abortTile(t){if(this._source.abortTile)return this._source.abortTile(t,()=>{})}serialize(){return this._source.serialize()}prepare(t){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const i in this._tiles){const a=this._tiles[i];a.upload(t),a.prepare(this.map.style.imageManager)}}getIds(){return tn(this._tiles).map(t=>t.tileID).sort(_b).map(t=>t.key)}getRenderableIds(t){const i=[];for(const a in this._tiles)this._isIdRenderable(+a,t)&&i.push(this._tiles[a]);return t?i.sort((a,c)=>{const d=a.tileID,g=c.tileID,y=new ce(d.canonical.x,d.canonical.y)._rotate(this.transform.angle),w=new ce(g.canonical.x,g.canonical.y)._rotate(this.transform.angle);return d.overscaledZ-g.overscaledZ||w.y-y.y||w.x-y.x}).map(a=>a.tileID.key):i.map(a=>a.tileID).sort(_b).map(a=>a.key)}hasRenderableParent(t){const i=this.findLoadedParent(t,0);return!!i&&this._isIdRenderable(i.tileID.key)}_isIdRenderable(t,i){return this._tiles[t]&&this._tiles[t].hasData()&&!this._coveredTiles[t]&&(i||!this._tiles[t].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const t in this._tiles)this._tiles[t].state!=="errored"&&this._reloadTile(+t,"reloading")}}_reloadTile(t,i){const a=this._tiles[t];a&&(a.state!=="loading"&&(a.state=i),this._loadTile(a,this._tileLoaded.bind(this,a,t,i)))}_tileLoaded(t,i,a,c){if(c)if(t.state="errored",c.status!==404)this._source.fire(new ai(c,{tile:t}));else if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const d=this.map.painter.terrain;this.update(this.transform,d.getScaledDemTileSize(),!0),d.resetTileLookupCache(this.id)}else this.update(this.transform);else t.timeAdded=at.now(),a==="expired"&&(t.refreshedUponExpiration=!0),this._setTileReloadTimer(i,t),this._source.type==="raster-dem"&&t.dem&&this._backfillDEM(t),this._state.initializeTileState(t,this.map?this.map.painter:null),this._source.fire(new Fn("data",{dataType:"source",tile:t,coord:t.tileID,sourceCacheId:this.id}))}_backfillDEM(t){const i=this.getRenderableIds();for(let c=0;c<i.length;c++){const d=i[c];if(t.neighboringTiles&&t.neighboringTiles[d]){const g=this.getTileByID(d);a(t,g),a(g,t)}}function a(c,d){if(!c.dem||c.dem.borderReady)return;c.needsHillshadePrepare=!0,c.needsDEMTextureUpload=!0;let g=d.tileID.canonical.x-c.tileID.canonical.x;const y=d.tileID.canonical.y-c.tileID.canonical.y,w=Math.pow(2,c.tileID.canonical.z),E=d.tileID.key;g===0&&y===0||Math.abs(y)>1||(Math.abs(g)>1&&(Math.abs(g+w)===1?g+=w:Math.abs(g-w)===1&&(g-=w)),d.dem&&c.dem&&(c.dem.backfillBorder(d.dem,g,y),c.neighboringTiles&&c.neighboringTiles[E]&&(c.neighboringTiles[E].backfilled=!0)))}}getTile(t){return this.getTileByID(t.key)}getTileByID(t){return this._tiles[t]}_retainLoadedChildren(t,i,a,c){for(const d in this._tiles){let g=this._tiles[d];if(c[d]||!g.hasData()||g.tileID.overscaledZ<=i||g.tileID.overscaledZ>a)continue;let y=g.tileID;for(;g&&g.tileID.overscaledZ>i+1;){const E=g.tileID.scaledTo(g.tileID.overscaledZ-1);g=this._tiles[E.key],g&&g.hasData()&&(y=E)}let w=y;for(;w.overscaledZ>i;)if(w=w.scaledTo(w.overscaledZ-1),t[w.key]){c[y.key]=y;break}}}findLoadedParent(t,i){if(t.key in this._loadedParentTiles){const a=this._loadedParentTiles[t.key];return a&&a.tileID.overscaledZ>=i?a:null}for(let a=t.overscaledZ-1;a>=i;a--){const c=t.scaledTo(a),d=this._getLoadedTile(c);if(d)return d}}_getLoadedTile(t){const i=this._tiles[t.key];return i&&i.hasData()?i:this._cache.getByKey(this._source.reparseOverscaled?t.wrapped().key:t.canonical.key)}updateCacheSize(t,i){i=i||this._source.tileSize;const a=Math.ceil(t.width/i)+1,c=Math.ceil(t.height/i)+1,d=Math.floor(a*c*5),g=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,d):d,y=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,g):g;this._cache.setMaxSize(y)}handleWrapJump(t){const i=Math.round((t-(this._prevLng===void 0?t:this._prevLng))/360);if(this._prevLng=t,i){const a={};for(const c in this._tiles){const d=this._tiles[c];d.tileID=d.tileID.unwrapTo(d.tileID.wrap+i),a[d.tileID.key]=d}this._tiles=a;for(const c in this._timers)clearTimeout(this._timers[c]),delete this._timers[c];for(const c in this._tiles)this._setTileReloadTimer(+c,this._tiles[c])}}update(t,i,a){if(this.transform=t,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!a)return;let c;this.updateCacheSize(t,i),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?c=t.getVisibleUnwrappedCoordinates(this._source.tileID).map(y=>new Dr(y.canonical.z,y.wrap,y.canonical.z,y.canonical.x,y.canonical.y)):(c=t.coveringTiles({tileSize:i||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!a,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(c=c.filter(y=>this._source.hasTile(y)))):c=[];const d=this._updateRetainedTiles(c);if(yb(this._source.type)&&c.length!==0){const y={},w={},E=Object.keys(d);for(const P of E){const z=d[P],B=this._tiles[P];if(!B||B.fadeEndTime&&B.fadeEndTime<=at.now())continue;const F=this.findLoadedParent(z,Math.max(z.overscaledZ-Ol.maxOverzooming,this._source.minzoom));F&&(this._addTile(F.tileID),y[F.tileID.key]=F.tileID),w[P]=z}const A=c[c.length-1].overscaledZ;for(const P in this._tiles){const z=this._tiles[P];if(d[P]||!z.hasData())continue;let B=z.tileID;for(;B.overscaledZ>A;){B=B.scaledTo(B.overscaledZ-1);const F=this._tiles[B.key];if(F&&F.hasData()&&w[B.key]){d[P]=z.tileID;break}}}for(const P in y)d[P]||(this._coveredTiles[P]=!0,d[P]=y[P])}for(const y in d)this._tiles[y].clearFadeHold();const g=function(y,w){const E=[];for(const A in y)A in w||E.push(A);return E}(this._tiles,d);for(const y of g){const w=this._tiles[y];w.hasSymbolBuckets&&!w.holdingForFade()?w.setHoldDuration(this.map._fadeDuration):w.hasSymbolBuckets&&!w.symbolFadeFinished()||this._removeTile(+y)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const t in this._tiles)this._tiles[t].holdingForFade()&&this._removeTile(+t)}_updateRetainedTiles(t){const i={};if(t.length===0)return i;const a={},c=t.reduce((E,A)=>Math.min(E,A.overscaledZ),1/0),d=t[0].overscaledZ,g=Math.max(d-Ol.maxOverzooming,this._source.minzoom),y=Math.max(d+Ol.maxUnderzooming,this._source.minzoom),w={};for(const E of t){const A=this._addTile(E);i[E.key]=E,A.hasData()||c<this._source.maxzoom&&(w[E.key]=E)}this._retainLoadedChildren(w,c,y,i);for(const E of t){let A=this._tiles[E.key];if(A.hasData())continue;if(E.canonical.z>=this._source.maxzoom){const z=E.children(this._source.maxzoom)[0],B=this.getTile(z);if(B&&B.hasData()){i[z.key]=z;continue}}else{const z=E.children(this._source.maxzoom);if(i[z[0].key]&&i[z[1].key]&&i[z[2].key]&&i[z[3].key])continue}let P=A.wasRequested();for(let z=E.overscaledZ-1;z>=g;--z){const B=E.scaledTo(z);if(a[B.key]||(a[B.key]=!0,A=this.getTile(B),!A&&P&&(A=this._addTile(B)),A&&(i[B.key]=B,P=A.wasRequested(),A.hasData())))break}}return i}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const t in this._tiles){const i=[];let a,c=this._tiles[t].tileID;for(;c.overscaledZ>0;){if(c.key in this._loadedParentTiles){a=this._loadedParentTiles[c.key];break}i.push(c.key);const d=c.scaledTo(c.overscaledZ-1);if(a=this._getLoadedTile(d),a)break;c=d}for(const d of i)this._loadedParentTiles[d]=a}}_addTile(t){let i=this._tiles[t.key];if(i)return i;i=this._cache.getAndRemove(t),i&&(this._setTileReloadTimer(t.key,i),i.tileID=t,this._state.initializeTileState(i,this.map?this.map.painter:null),this._cacheTimers[t.key]&&(clearTimeout(this._cacheTimers[t.key]),delete this._cacheTimers[t.key],this._setTileReloadTimer(t.key,i)));const a=Boolean(i);if(!a){const c=this.map?this.map.painter:null;i=new w_(t,this._source.tileSize*t.overscaleFactor(),this.transform.tileZoom,c,this._isRaster),this._loadTile(i,this._tileLoaded.bind(this,i,t.key,i.state))}return i?(i.uses++,this._tiles[t.key]=i,a||this._source.fire(new Fn("dataloading",{tile:i,coord:i.tileID,dataType:"source"})),i):null}_setTileReloadTimer(t,i){t in this._timers&&(clearTimeout(this._timers[t]),delete this._timers[t]);const a=i.getExpiryTimeout();a&&(this._timers[t]=setTimeout(()=>{this._reloadTile(t,"expired"),delete this._timers[t]},a))}_removeTile(t){const i=this._tiles[t];i&&(i.uses--,delete this._tiles[t],this._timers[t]&&(clearTimeout(this._timers[t]),delete this._timers[t]),i.uses>0||(i.hasData()&&i.state!=="reloading"?this._cache.add(i.tileID,i,i.getExpiryTimeout()):(i.aborted=!0,this._abortTile(i),this._unloadTile(i))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const t in this._tiles)this._removeTile(+t);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(t,i,a){const c=[],d=this.transform;if(!d)return c;const g=d.projection.name==="globe",y=cs(d.center.lng);for(const w in this._tiles){const E=this._tiles[w];if(a&&E.clearQueryDebugViz(),E.holdingForFade())continue;let A;if(g){const P=E.tileID.canonical;if(P.z===0){const z=[Math.abs(lt(y,...ad(P,-1))-y),Math.abs(lt(y,...ad(P,1))-y)];A=[0,2*z.indexOf(Math.min(...z))-1]}else{const z=[Math.abs(lt(y,...ad(P,-1))-y),Math.abs(lt(y,...ad(P,0))-y),Math.abs(lt(y,...ad(P,1))-y)];A=[z.indexOf(Math.min(...z))-1]}}else A=[0];for(const P of A){const z=t.containsTile(E,d,i,P);z&&c.push(z)}}return c}getVisibleCoordinates(t){const i=this.getRenderableIds(t).map(a=>this._tiles[a].tileID);for(const a of i)a.projMatrix=this.transform.calculateProjMatrix(a.toUnwrapped());return i}hasTransition(){if(this._source.hasTransition())return!0;if(yb(this._source.type))for(const t in this._tiles){const i=this._tiles[t];if(i.fadeEndTime!==void 0&&i.fadeEndTime>=at.now())return!0}return!1}setFeatureState(t,i,a){this._state.updateState(t=t||"_geojsonTileLayer",i,a)}removeFeatureState(t,i,a){this._state.removeFeatureState(t=t||"_geojsonTileLayer",i,a)}getFeatureState(t,i){return this._state.getState(t=t||"_geojsonTileLayer",i)}setDependencies(t,i,a){const c=this._tiles[t];c&&c.setDependencies(i,a)}reloadTilesForDependencies(t,i){for(const a in this._tiles)this._tiles[a].hasDependency(t,i)&&this._reloadTile(+a,"reloading");this._cache.filter(a=>!a.hasDependency(t,i))}_preloadTiles(t,i){const a=new Map,c=Array.isArray(t)?t:[t],d=this.map.painter.terrain,g=this.usedForTerrain&&d?d.getScaledDemTileSize():this._source.tileSize;for(const y of c){const w=y.coveringTiles({tileSize:g,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const E of w)a.set(E.key,E);this.usedForTerrain&&y.updateElevation(!1)}At(Array.from(a.values()),(y,w)=>{const E=new w_(y,this._source.tileSize*y.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(E,A=>{this._source.type==="raster-dem"&&E.dem&&this._backfillDEM(E),w(A,E)})},i)}}function _b(n,t){const i=Math.abs(2*n.wrap)-+(n.wrap<0),a=Math.abs(2*t.wrap)-+(t.wrap<0);return n.overscaledZ-t.overscaledZ||a-i||t.canonical.y-n.canonical.y||t.canonical.x-n.canonical.x}function yb(n){return n==="raster"||n==="image"||n==="video"||n==="custom"}function ad(n,t){const i=1<<n.z;return[n.x/i+t,(n.x+1)/i+t]}Ol.maxOverzooming=10,Ol.maxUnderzooming=3;class Mp{constructor(t,i,a){this._demTile=t,this._dem=this._demTile.dem,this._scale=i,this._offset=a}static create(t,i,a){const c=a||t.findDEMTileFor(i);if(!c||!c.dem)return;const d=c.dem,g=c.tileID,y=1<<i.canonical.z-g.canonical.z;return new Mp(c,c.tileSize/_n/y,[(i.canonical.x/y-g.canonical.x)*d.dim,(i.canonical.y/y-g.canonical.y)*d.dim])}tileCoordToPixel(t,i){const a=i*this._scale+this._offset[1],c=Math.floor(t*this._scale+this._offset[0]),d=Math.floor(a);return new ce(c,d)}getElevationAt(t,i,a,c){const d=t*this._scale+this._offset[0],g=i*this._scale+this._offset[1],y=Math.floor(d),w=Math.floor(g),E=this._dem;return c=!!c,a?$n($n(E.get(y,w,c),E.get(y,w+1,c),g-w),$n(E.get(y+1,w,c),E.get(y+1,w+1,c),g-w),d-y):E.get(y,w,c)}getElevationAtPixel(t,i,a){return this._dem.get(t,i,!!a)}getMeterToDEM(t){return(1<<this._demTile.tileID.canonical.z)*To(1,t)*this._dem.stride}}class vb{constructor(t,i){this.tileID=t,this.x=t.canonical.x,this.y=t.canonical.y,this.z=t.canonical.z,this.grid=new ya(_n,16,0),this.featureIndexArray=new a0,this.promoteId=i}insert(t,i,a,c,d,g=0){const y=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(a,c,d,g);const w=this.grid;for(let E=0;E<i.length;E++){const A=i[E],P=[1/0,1/0,-1/0,-1/0];for(let z=0;z<A.length;z++){const B=A[z];P[0]=Math.min(P[0],B.x),P[1]=Math.min(P[1],B.y),P[2]=Math.max(P[2],B.x),P[3]=Math.max(P[3],B.y)}P[0]<_n&&P[1]<_n&&P[2]>=0&&P[3]>=0&&w.insert(y,P[0],P[1],P[2],P[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new n_(new Xh(this.rawTileData)).layers,this.sourceLayerCoder=new rb(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const t in this.vtLayers)this.vtFeatures[t]=[]}return this.vtLayers}query(t,i,a,c){this.loadVTLayers();const d=t.params||{},g=Rs(d.filter),y=t.tileResult,w=t.transform,E=y.bufferedTilespaceBounds,A=this.grid.query(E.min.x,E.min.y,E.max.x,E.max.y,(F,q,W,le)=>S0(y.bufferedTilespaceGeometry,F,q,W,le));A.sort(pM);let P=null;w.elevation&&A.length>0&&(P=Mp.create(w.elevation,this.tileID));const z={};let B;for(let F=0;F<A.length;F++){const q=A[F];if(q===B)continue;B=q;const W=this.featureIndexArray.get(q);let le=null;this.loadMatchingFeature(z,W,g,d.layers,d.availableImages,i,a,c,(_e,ae,de,we=0)=>(le||(le=Bs(_e,this.tileID.canonical,t.tileTransform)),ae.queryIntersectsFeature(y,_e,de,le,this.z,t.transform,t.pixelPosMatrix,P,we)))}return z}loadMatchingFeature(t,i,a,c,d,g,y,w,E){const{featureIndex:A,bucketIndex:P,sourceLayerIndex:z,layoutVertexArrayOffset:B}=i,F=this.bucketLayerIDs[P];if(c&&!function(_e,ae){for(let de=0;de<_e.length;de++)if(ae.indexOf(_e[de])>=0)return!0;return!1}(c,F))return;const q=this.sourceLayerCoder.decode(z),W=this.vtLayers[q].feature(A);if(a.needGeometry){const _e=Ml(W,!0);if(!a.filter(new Le(this.tileID.overscaledZ),_e,this.tileID.canonical))return}else if(!a.filter(new Le(this.tileID.overscaledZ),W))return;const le=this.getId(W,q);for(let _e=0;_e<F.length;_e++){const ae=F[_e];if(c&&c.indexOf(ae)<0)continue;const de=g[ae];if(!de)continue;let we={};le!==void 0&&w&&(we=w.getState(de.sourceLayer||"_geojsonTileLayer",le));const ye=Ve({},y[ae]);ye.paint=xb(ye.paint,de.paint,W,we,d),ye.layout=xb(ye.layout,de.layout,W,we,d);const $e=!E||E(W,de,we,B);if(!$e)continue;const qe=new ob(W,this.z,this.x,this.y,le);qe.layer=ye;let it=t[ae];it===void 0&&(it=t[ae]=[]),it.push({featureIndex:A,feature:qe,intersectionZ:$e})}}lookupSymbolFeatures(t,i,a,c,d,g,y,w){const E={};this.loadVTLayers();const A=Rs(d);for(const P of t)this.loadMatchingFeature(E,{bucketIndex:a,sourceLayerIndex:c,featureIndex:P,layoutVertexArrayOffset:0},A,g,y,w,i);return E}loadFeature(t){const{featureIndex:i,sourceLayerIndex:a}=t;this.loadVTLayers();const c=this.sourceLayerCoder.decode(a),d=this.vtFeatures[c];if(d[i])return d[i];const g=this.vtLayers[c].feature(i);return d[i]=g,g}hasLayer(t){for(const i of this.bucketLayerIDs)for(const a of i)if(t===a)return!0;return!1}getId(t,i){let a=t.id;if(this.promoteId){const c=typeof this.promoteId=="string"?this.promoteId:this.promoteId[i];c!=null&&(a=t.properties[c]),typeof a=="boolean"&&(a=Number(a))}return a}}function xb(n,t,i,a,c){return _t(n,(d,g)=>{const y=t instanceof Pt?t.get(g):null;return y&&y.evaluate?y.evaluate(i,a,c):y})}function pM(n,t){return t-n}Zt(vb,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});class bb{constructor(t,i){this.width=t,this.height=i,this.nextRow=0,this.image=new Ns({width:t,height:i}),this.positions={},this.uploaded=!1}getDash(t,i){const a=this.getKey(t,i);return this.positions[a]}trim(){const t=this.width,i=this.height=xn(this.nextRow);this.image.resize({width:t,height:i})}getKey(t,i){return t.join(",")+i}getDashRanges(t,i,a){const c=[];let d=t.length%2==1?-t[t.length-1]*a:0,g=t[0]*a,y=!0;c.push({left:d,right:g,isDash:y,zeroLength:t[0]===0});let w=t[0];for(let E=1;E<t.length;E++){y=!y;const A=t[E];d=w*a,w+=A,g=w*a,c.push({left:d,right:g,isDash:y,zeroLength:A===0})}return c}addRoundDash(t,i,a){const c=i/2;for(let d=-a;d<=a;d++){const g=this.width*(this.nextRow+a+d);let y=0,w=t[y];for(let E=0;E<this.width;E++){E/w.right>1&&(w=t[++y]);const A=Math.abs(E-w.left),P=Math.abs(E-w.right),z=Math.min(A,P);let B;const F=d/a*(c+1);if(w.isDash){const q=c-Math.abs(F);B=Math.sqrt(z*z+q*q)}else B=c-Math.sqrt(z*z+F*F);this.image.data[g+E]=Math.max(0,Math.min(255,B+128))}}}addRegularDash(t,i){for(let w=t.length-1;w>=0;--w){const E=t[w],A=t[w+1];E.zeroLength?t.splice(w,1):A&&A.isDash===E.isDash&&(A.left=E.left,t.splice(w,1))}const a=t[0],c=t[t.length-1];a.isDash===c.isDash&&(a.left=c.left-this.width,c.right=a.right+this.width);const d=this.width*this.nextRow;let g=0,y=t[g];for(let w=0;w<this.width;w++){w/y.right>1&&(y=t[++g]);const E=Math.abs(w-y.left),A=Math.abs(w-y.right),P=Math.min(E,A);this.image.data[d+w]=Math.max(0,Math.min(255,(y.isDash?P:-P)+i+128))}}addDash(t,i){const a=this.getKey(t,i);if(this.positions[a])return this.positions[a];const c=i==="round",d=c?7:0,g=2*d+1;if(this.nextRow+g>this.height)return oe("LineAtlas out of space"),null;t.length===0&&t.push(1);let y=0;for(let A=0;A<t.length;A++)t[A]<0&&(oe("Negative value is found in line dasharray, replacing values with 0"),t[A]=0),y+=t[A];if(y!==0){const A=this.width/y,P=this.getDashRanges(t,this.width,A);c?this.addRoundDash(P,A,d):this.addRegularDash(P,i==="square"?.5*A:0)}const w=this.nextRow+d;this.nextRow+=g;const E={tl:[w,d],br:[y,0]};return this.positions[a]=E,E}}Zt(bb,"LineAtlas");class wb{constructor(t){const i={},a=[];for(const y in t){const w=t[y],E=i[y]={};for(const A in w.glyphs){const P=w.glyphs[+A];if(!P||P.bitmap.width===0||P.bitmap.height===0)continue;const z=P.metrics.localGlyph?2:1,B={x:0,y:0,w:P.bitmap.width+2*z,h:P.bitmap.height+2*z};a.push(B),E[A]=B}}const{w:c,h:d}=o_(a),g=new Ns({width:c||1,height:d||1});for(const y in t){const w=t[y];for(const E in w.glyphs){const A=w.glyphs[+E];if(!A||A.bitmap.width===0||A.bitmap.height===0)continue;const P=i[y][E],z=A.metrics.localGlyph?2:1;Ns.copy(A.bitmap,g,{x:0,y:0},{x:P.x+z,y:P.y+z},A.bitmap)}}this.image=g,this.positions=i}}Zt(wb,"GlyphAtlas");class mM{constructor(t){this.tileID=new Dr(t.tileID.overscaledZ,t.tileID.wrap,t.tileID.canonical.z,t.tileID.canonical.x,t.tileID.canonical.y),this.tileZoom=t.tileZoom,this.uid=t.uid,this.zoom=t.zoom,this.canonical=t.tileID.canonical,this.pixelRatio=t.pixelRatio,this.tileSize=t.tileSize,this.source=t.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=t.showCollisionBoxes,this.collectResourceTiming=!!t.collectResourceTiming,this.returnDependencies=!!t.returnDependencies,this.promoteId=t.promoteId,this.enableTerrain=!!t.enableTerrain,this.isSymbolTile=t.isSymbolTile,this.tileTransform=Dl(t.tileID.canonical,t.projection),this.projection=t.projection}parse(t,i,a,c,d){this.status="parsing",this.data=t,this.collisionBoxArray=new kg;const g=new rb(Object.keys(t.layers).sort()),y=new vb(this.tileID,this.promoteId);y.bucketLayerIDs=[];const w={},E=new bb(256,256),A={featureIndex:y,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:E,availableImages:a},P=i.familiesBySource[this.source];for(const we in P){const ye=t.layers[we];if(!ye)continue;let $e=!1,qe=!1;for(const Ke of P[we])Ke[0].type==="symbol"?$e=!0:qe=!0;if(this.isSymbolTile===!0&&!$e||this.isSymbolTile===!1&&!qe)continue;ye.version===1&&oe(`Vector tile source "${this.source}" layer "${we}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const it=g.encode(we),St=[];for(let Ke=0;Ke<ye.length;Ke++){const ut=ye.feature(Ke),dt=y.getId(ut,we);St.push({feature:ut,id:dt,index:Ke,sourceLayerIndex:it})}for(const Ke of P[we]){const ut=Ke[0];this.isSymbolTile!==void 0&&ut.type==="symbol"!==this.isSymbolTile||ut.minzoom&&this.zoom<Math.floor(ut.minzoom)||ut.maxzoom&&this.zoom>=ut.maxzoom||ut.visibility!=="none"&&(A_(Ke,this.zoom,a),(w[ut.id]=ut.createBucket({index:y.bucketLayerIDs.length,layers:Ke,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:it,sourceID:this.source,enableTerrain:this.enableTerrain,projection:this.projection.spec,availableImages:a})).populate(St,A,this.tileID.canonical,this.tileTransform),y.bucketLayerIDs.push(Ke.map(dt=>dt.id)))}}let z,B,F,q;E.trim();const W={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},le=_t(A.glyphDependencies,we=>Object.keys(we).map(Number));Object.keys(le).length?c.send("getGlyphs",{uid:this.uid,stacks:le},(we,ye)=>{z||(z=we,B=ye,de.call(this))},void 0,!1,W):B={};const _e=Object.keys(A.iconDependencies);_e.length?c.send("getImages",{icons:_e,source:this.source,tileID:this.tileID,type:"icons"},(we,ye)=>{z||(z=we,F=ye,de.call(this))},void 0,!1,W):F={};const ae=Object.keys(A.patternDependencies);function de(){if(z)return d(z);if(B&&F&&q){const we=new wb(B),ye=new wx(F,q);for(const $e in w){const qe=w[$e];qe instanceof Ca?(A_(qe.layers,this.zoom,a),BA(qe,B,we.positions,F,ye.iconPositions,this.showCollisionBoxes,a,this.tileID.canonical,this.tileZoom,this.projection)):qe.hasPattern&&(qe instanceof up||qe instanceof op||qe instanceof Gh)&&(A_(qe.layers,this.zoom,a),qe.addFeatures(A,this.tileID.canonical,ye.patternPositions,a,this.tileTransform))}this.status="done",d(null,{buckets:tn(w).filter($e=>!$e.isEmpty()),featureIndex:y,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:we.image,lineAtlas:E,imageAtlas:ye,glyphMap:this.returnDependencies?B:null,iconMap:this.returnDependencies?F:null,glyphPositions:this.returnDependencies?we.positions:null})}}ae.length?c.send("getImages",{icons:ae,source:this.source,tileID:this.tileID,type:"patterns"},(we,ye)=>{z||(z=we,q=ye,de.call(this))},void 0,!1,W):q={},de.call(this)}}function A_(n,t,i){const a=new Le(t);for(const c of n)c.recalculate(a,i)}class Eb{constructor(t){this.entries={},this.scheduler=t}request(t,i,a,c){const d=this.entries[t]=this.entries[t]||{callbacks:[]};if(d.result){const[g,y]=d.result;return this.scheduler?this.scheduler.add(()=>{c(g,y)},i):c(g,y),()=>{}}return d.callbacks.push(c),d.cancel||(d.cancel=a((g,y)=>{d.result=[g,y];for(const w of d.callbacks)this.scheduler?this.scheduler.add(()=>{w(g,y)},i):w(g,y);setTimeout(()=>delete this.entries[t],3e3)})),()=>{d.result||(d.callbacks=d.callbacks.filter(g=>g!==c),d.callbacks.length||(d.cancel(),delete this.entries[t]))}}}function Tb(n,t,i){const a=JSON.stringify(n.request);return n.data&&(this.deduped.entries[a]={result:[null,n.data]}),this.deduped.request(a,{type:"parseTile",isSymbolTile:n.isSymbolTile,zoom:n.tileZoom},c=>{const d=tr(n.request,(g,y,w,E)=>{g?c(g):y&&c(null,{vectorTile:i?void 0:new n_(new Xh(y)),rawData:y,cacheControl:w,expires:E})});return()=>{d.cancel(),c()}},t)}o.ARRAY_TYPE=Yr,o.AUTH_ERR_MSG=mo,o.Aabb=Rr,o.Actor=class{constructor(n,t,i){this.target=n,this.parent=t,this.mapId=i,this.callbacks={},this.cancelCallbacks={},gt(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.globalScope=nt()?n:S,this.scheduler=new uM}send(n,t,i,a,c=!1,d){const g=Math.round(1e18*Math.random()).toString(36).substring(0,10);i&&(i.metadata=d,this.callbacks[g]=i);const y=Nt(this.globalScope)?void 0:[];return this.target.postMessage({id:g,type:n,hasCallback:!!i,targetMapId:a,mustQueue:c,sourceMapId:this.mapId,data:ls(t,y)},y),{cancel:()=>{i&&delete this.callbacks[g],this.target.postMessage({id:g,type:"<cancel>",targetMapId:a,sourceMapId:this.mapId})}}}receive(n){const t=n.data,i=t.id;if(i&&(!t.targetMapId||this.mapId===t.targetMapId))if(t.type==="<cancel>"){const a=this.cancelCallbacks[i];delete this.cancelCallbacks[i],a&&a.cancel()}else if(t.mustQueue||nt()){const a=this.callbacks[i];this.cancelCallbacks[i]=this.scheduler.add(()=>this.processTask(i,t),a&&a.metadata||{type:"message"})}else this.processTask(i,t)}processTask(n,t){if(t.type==="<response>"){const i=this.callbacks[n];delete this.callbacks[n],i&&(t.error?i(wl(t.error)):i(null,wl(t.data)))}else{const i=Nt(this.globalScope)?void 0:[],a=t.hasCallback?(d,g)=>{delete this.cancelCallbacks[n],this.target.postMessage({id:n,type:"<response>",sourceMapId:this.mapId,error:d?ls(d):null,data:ls(g,i)},i)}:d=>{},c=wl(t.data);if(this.parent[t.type])this.parent[t.type](t.sourceMapId,c,a);else if(this.parent.getWorkerSource){const d=t.type.split(".");this.parent.getWorkerSource(t.sourceMapId,d[0],c.source)[d[1]](c,a)}else a(new Error(`Could not find function ${t.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}},o.CanonicalTileID=cp,o.Color=ki,o.ColorMode=gs,o.CullFaceMode=Wo,o.DEMData=Ap,o.DataConstantProperty=De,o.DedupedRequest=Eb,o.DepthMode=ou,o.EXTENT=_n,o.Elevation=class{isDataAvailableAtPoint(n){const t=this._source();if(this.isUsingMockSource()||!t||n.y<0||n.y>1)return!1;const i=t.getSource().maxzoom,a=1<<i,c=Math.floor(n.x),d=Math.floor((n.x-c)*a),g=Math.floor(n.y*a),y=this.findDEMTileFor(new Dr(i,c,i,d,g));return!(!y||!y.dem)}getAtPointOrZero(n,t=0){return this.getAtPoint(n,t)||0}getAtPoint(n,t,i=!0){if(this.isUsingMockSource())return null;t==null&&(t=null);const a=this._source();if(!a||n.y<0||n.y>1)return t;const c=a.getSource().maxzoom,d=1<<c,g=Math.floor(n.x),y=n.x-g,w=new Dr(c,g,c,Math.floor(y*d),Math.floor(n.y*d)),E=this.findDEMTileFor(w);if(!E||!E.dem)return t;const A=E.dem,P=1<<E.tileID.canonical.z,z=(y*P-E.tileID.canonical.x)*A.dim,B=(n.y*P-E.tileID.canonical.y)*A.dim,F=Math.floor(z),q=Math.floor(B);return(i?this.exaggeration():1)*$n($n(A.get(F,q),A.get(F,q+1),B-q),$n(A.get(F+1,q),A.get(F+1,q+1),B-q),z-F)}getAtTileOffset(n,t,i){const a=1<<n.canonical.z;return this.getAtPointOrZero(new jc(n.wrap+(n.canonical.x+t/_n)/a,(n.canonical.y+i/_n)/a))}getAtTileOffsetFunc(n,t,i,a){return c=>{const d=this.getAtTileOffset(n,c.x,c.y),g=a.upVector(n.canonical,c.x,c.y);return uo(g,g,d*a.upVectorScale(n.canonical,t,i).metersToTile),g}}getForTilePoints(n,t,i,a){if(this.isUsingMockSource())return!1;const c=Mp.create(this,n,a);return!!c&&(t.forEach(d=>{d[2]=this.exaggeration()*c.getElevationAt(d[0],d[1],i)}),!0)}getMinMaxForTile(n){if(this.isUsingMockSource())return null;const t=this.findDEMTileFor(n);if(!t||!t.dem)return null;const i=t.dem.tree,a=t.tileID,c=1<<n.canonical.z-a.canonical.z;let d=n.canonical.x/c-a.canonical.x,g=n.canonical.y/c-a.canonical.y,y=0;for(let w=0;w<n.canonical.z-a.canonical.z&&!i.leaves[y];w++){d*=2,g*=2;const E=2*Math.floor(g)+Math.floor(d);y=i.childOffsets[y]+E,d%=1,g%=1}return{min:this.exaggeration()*i.minimums[y],max:this.exaggeration()*i.maximums[y]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(n,t,i){throw new Error("Pure virtual method called.")}pointCoordinate(n){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(n){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}},o.ErrorEvent=ai,o.EvaluationParameters=Le,o.Event=Fn,o.Evented=mi,o.FillExtrusionBucket=Gh,o.Frustum=Wg,o.FrustumCorners=Zg,o.GLOBE_METERS_TO_ECEF=f_,o.GLOBE_RADIUS=js,o.GLOBE_SCALE_MATCH_LATITUDE=45,o.GLOBE_ZOOM_THRESHOLD_MAX=6,o.GLOBE_ZOOM_THRESHOLD_MIN=5,o.GlobeSharedBuffers=class{constructor(n){this._createGrid(n),this._createPoles(n)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const n of this._poleSegments)n.destroy();for(const n of this._gridSegments)n.destroy();if(this._wireframeIndexBuffer){this._wireframeIndexBuffer.destroy();for(const n of this._wireframeSegments)n.destroy()}}_createGrid(n){const t=new Wn,i=new pr,a=65;for(let c=0;c<a;c++)for(let d=0;d<a;d++)t.emplaceBack(d,c);this._gridSegments=[];for(let c=0,d=0;c<tu.length;c++){const g=tu[c];for(let w=0;w<g;w++)for(let E=0;E<64;E++){const A=w*a+E;i.emplaceBack(A+1,A,A+a),i.emplaceBack(A+a,A+a+1,A+1)}const y=64*g*2;this._gridSegments.push(Wi.simpleSegment(0,d,(g+1)*a,y)),d+=y}this._gridBuffer=n.createVertexBuffer(t,Qh.members),this._gridIndexBuffer=n.createIndexBuffer(i,!0)}_createPoles(n){const t=new pr;for(let c=0;c<=eu;c++)t.emplaceBack(0,c+1,c+2);this._poleIndexBuffer=n.createIndexBuffer(t,!0);const i=new Cl,a=new Cl;this._poleSegments=[];for(let c=0,d=0;c<5;c++){const g=360/(1<<c);i.emplaceBack(0,-js,0,.5,0),a.emplaceBack(0,-js,0,.5,1);for(let y=0;y<=eu;y++){const w=y/eu,E=$n(0,g,w),[A,P,z]=nu($A,GA,E,js);i.emplaceBack(A,P,z,w,0),a.emplaceBack(A,P,z,w,1)}this._poleSegments.push(Wi.simpleSegment(d,0,66,64)),d+=66}this._poleNorthVertexBuffer=n.createVertexBuffer(i,jx,!1),this._poleSouthVertexBuffer=n.createVertexBuffer(a,jx,!1)}getGridBuffers(n){return[this._gridBuffer,this._gridIndexBuffer,this._gridSegments[n]]}getPoleBuffers(n){return[this._poleNorthVertexBuffer,this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[n]]}getWirefameBuffers(n,t){if(!this._wireframeSegments){const i=new Eo,a=eu,c=a+1;this._wireframeSegments=[];for(let d=0,g=0;d<tu.length;d++){const y=tu[d];for(let E=0;E<y;E++)for(let A=0;A<a;A++){const P=E*c+A;i.emplaceBack(P,P+1),i.emplaceBack(P,P+c),i.emplaceBack(P,P+c+1)}const w=y*a*3;this._wireframeSegments.push(Wi.simpleSegment(0,g,(y+1)*c,w)),g+=w}this._wireframeIndexBuffer=n.createIndexBuffer(i)}return[this._gridBuffer,this._wireframeIndexBuffer,this._wireframeSegments[t]]}},o.GlyphManager=Qc,o.ImagePosition=s_,o.LivePerformanceUtils=Ft,o.LngLat=jn,o.LngLatBounds=Ea,o.LocalGlyphMode=c_,o.MAX_MERCATOR_LATITUDE=hs,o.MercatorCoordinate=jc,o.ONE_EM=gr,o.OverscaledTileID=Dr,o.PerformanceMarkers=ht,o.Properties=ln,o.RGBAImage=Qr,o.Ray=Gg,o.RequestManager=class{constructor(n,t,i){this._transformRequestFn=n,this._customAccessToken=t,this._silenceAuthErrors=!!i,this._createSkuToken()}_createSkuToken(){const n=function(){let t="";for(let i=0;i<10;i++)t+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",te,t].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=n.token,this._skuTokenExpiresAt=n.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(n,t){return this._transformRequestFn&&this._transformRequestFn(n,t)||{url:n}}normalizeStyleURL(n,t){if(!vr(n))return n;const i=hn(n);return i.path=`/styles/v1${i.path}`,this._makeAPIURL(i,this._customAccessToken||t)}normalizeGlyphsURL(n,t){if(!vr(n))return n;const i=hn(n);return i.path=`/fonts/v1${i.path}`,this._makeAPIURL(i,this._customAccessToken||t)}normalizeSourceURL(n,t,i,a){if(!vr(n))return n;const c=hn(n);return c.path=`/v4/${c.authority}.json`,c.params.push("secure"),i&&c.params.push(`language=${i}`),a&&c.params.push(`worldview=${a}`),this._makeAPIURL(c,this._customAccessToken||t)}normalizeSpriteURL(n,t,i,a){const c=hn(n);return vr(n)?(c.path=`/styles/v1${c.path}/sprite${t}${i}`,this._makeAPIURL(c,this._customAccessToken||a)):(c.path+=`${t}${i}`,En(c))}normalizeTileURL(n,t,i){if(this._isSkuTokenExpired()&&this._createSkuToken(),n&&!vr(n))return n;const a=hn(n);a.path=a.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${t||i&&a.authority!=="raster"&&i===512?"@2x":""}${D.supported?".webp":"$1"}`),a.authority==="raster"?a.path=`/${L.RASTER_URL_PREFIX}${a.path}`:(a.path=a.path.replace(/^.+\/v4\//,"/"),a.path=`/${L.TILE_URL_VERSION}${a.path}`);const c=this._customAccessToken||function(d){for(const g of d){const y=g.match(/^access_token=(.*)$/);if(y)return y[1]}return null}(a.params)||L.ACCESS_TOKEN;return L.REQUIRE_ACCESS_TOKEN&&c&&this._skuToken&&a.params.push(`sku=${this._skuToken}`),this._makeAPIURL(a,c)}canonicalizeTileURL(n,t){const i=hn(n);if(!i.path.match(/^(\/v4\/|\/raster\/v1\/)/)||!i.path.match(/\.[\w]+$/))return n;let a="mapbox://";i.path.match(/^\/raster\/v1\//)?a+=`raster/${i.path.replace(`/${L.RASTER_URL_PREFIX}/`,"")}`:a+=`tiles/${i.path.replace(`/${L.TILE_URL_VERSION}/`,"")}`;let c=i.params;return t&&(c=c.filter(d=>!d.match(/^access_token=/))),c.length&&(a+=`?${c.join("&")}`),a}canonicalizeTileset(n,t){const i=!!t&&vr(t),a=[];for(const c of n.tiles||[])so(c)?a.push(this.canonicalizeTileURL(c,i)):a.push(c);return a}_makeAPIURL(n,t){const i="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",a=hn(L.API_URL);if(n.protocol=a.protocol,n.authority=a.authority,n.protocol==="http"){const c=n.params.indexOf("secure");c>=0&&n.params.splice(c,1)}if(a.path!=="/"&&(n.path=`${a.path}${n.path}`),!L.REQUIRE_ACCESS_TOKEN)return En(n);if(t=t||L.ACCESS_TOKEN,!this._silenceAuthErrors){if(!t)throw new Error(`An API access token is required to use Mapbox GL. ${i}`);if(t[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${i}`)}return n.params=n.params.filter(c=>c.indexOf("access_token")===-1),n.params.push(`access_token=${t||""}`),En(n)}},o.ResourceType=Hn,o.SegmentVector=Wi,o.SourceCache=Ol,o.StencilMode=T_,o.StructArrayLayout1ui2=kh,o.StructArrayLayout2f1f2i16=wr,o.StructArrayLayout2i4=Wn,o.StructArrayLayout2ui4=Eo,o.StructArrayLayout3f12=jo,o.StructArrayLayout3ui6=pr,o.StructArrayLayout4i8=ii,o.StructArrayLayout5f20=Cl,o.Texture=sd,o.Tile=w_,o.Transitionable=st,o.Uniform1f=Wf,o.Uniform1i=class extends Ds{constructor(n){super(n),this.current=0}set(n,t,i){this.fetchUniformLocation(n,t)&&this.current!==i&&(this.current=i,this.gl.uniform1i(this.location,i))}},o.Uniform2f=class extends Ds{constructor(n){super(n),this.current=[0,0]}set(n,t,i){this.fetchUniformLocation(n,t)&&(i[0]===this.current[0]&&i[1]===this.current[1]||(this.current=i,this.gl.uniform2f(this.location,i[0],i[1])))}},o.Uniform3f=class extends Ds{constructor(n){super(n),this.current=[0,0,0]}set(n,t,i){this.fetchUniformLocation(n,t)&&(i[0]===this.current[0]&&i[1]===this.current[1]&&i[2]===this.current[2]||(this.current=i,this.gl.uniform3f(this.location,i[0],i[1],i[2])))}},o.Uniform4f=f0,o.UniformColor=p0,o.UniformMatrix2f=class extends Ds{constructor(n){super(n),this.current=X2}set(n,t,i){if(this.fetchUniformLocation(n,t)){for(let a=0;a<4;a++)if(i[a]!==this.current[a]){this.current=i,this.gl.uniformMatrix2fv(this.location,!1,i);break}}}},o.UniformMatrix3f=class extends Ds{constructor(n){super(n),this.current=H2}set(n,t,i){if(this.fetchUniformLocation(n,t)){for(let a=0;a<9;a++)if(i[a]!==this.current[a]){this.current=i,this.gl.uniformMatrix3fv(this.location,!1,i);break}}}},o.UniformMatrix4f=class extends Ds{constructor(n){super(n),this.current=W2}set(n,t,i){if(this.fetchUniformLocation(n,t)){if(i[12]!==this.current[12]||i[0]!==this.current[0])return this.current=i,void this.gl.uniformMatrix4fv(this.location,!1,i);for(let a=1;a<16;a++)if(i[a]!==this.current[a]){this.current=i,this.gl.uniformMatrix4fv(this.location,!1,i);break}}}},o.UnwrappedTileID=cx,o.ValidationError=$t,o.VectorTileFeature=ap,o.VectorTileWorkerSource=class extends mi{constructor(n,t,i,a,c){super(),this.actor=n,this.layerIndex=t,this.availableImages=i,this.loadVectorData=c||Tb,this.loading={},this.loaded={},this.deduped=new Eb(n.scheduler),this.isSpriteLoaded=a,this.scheduler=n.scheduler}loadTile(n,t){const i=n.uid,a=n&&n.request,c=a&&a.collectResourceTiming,d=this.loading[i]=new mM(n);d.abort=this.loadVectorData(n,(g,y)=>{const w=!this.loading[i];if(delete this.loading[i],w||g||!y)return d.status="done",w||(this.loaded[i]=d),t(g);const E=y.rawData,A={};y.expires&&(A.expires=y.expires),y.cacheControl&&(A.cacheControl=y.cacheControl),d.vectorTile=y.vectorTile||new n_(new Xh(E));const P=()=>{d.parse(d.vectorTile,this.layerIndex,this.availableImages,this.actor,(z,B)=>{if(z||!B)return t(z);const F={};if(c){const q=on(a);q.length>0&&(F.resourceTiming=JSON.parse(JSON.stringify(q)))}t(null,Ve({rawTileData:E.slice(0)},B,A,F))})};this.isSpriteLoaded?P():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(P,{type:"parseTile",isSymbolTile:n.isSymbolTile,zoom:n.tileZoom}):P()}),this.loaded=this.loaded||{},this.loaded[i]=d})}reloadTile(n,t){const i=this.loaded,a=n.uid,c=this;if(i&&i[a]){const d=i[a];d.showCollisionBoxes=n.showCollisionBoxes,d.enableTerrain=!!n.enableTerrain,d.projection=n.projection,d.tileTransform=Dl(n.tileID.canonical,n.projection);const g=(y,w)=>{const E=d.reloadCallback;E&&(delete d.reloadCallback,d.parse(d.vectorTile,c.layerIndex,this.availableImages,c.actor,E)),t(y,w)};d.status==="parsing"?d.reloadCallback=g:d.status==="done"&&(d.vectorTile?d.parse(d.vectorTile,this.layerIndex,this.availableImages,this.actor,g):g())}}abortTile(n,t){const i=n.uid,a=this.loading[i];a&&(a.abort&&a.abort(),delete this.loading[i]),t()}removeTile(n,t){const i=this.loaded,a=n.uid;i&&i[a]&&delete i[a],t()}},o.WritingMode=ho,o.add=Fs,o.addDynamicAttributes=Tp,o.adjoint=function(n,t){var i=t[0],a=t[1],c=t[2],d=t[3],g=t[4],y=t[5],w=t[6],E=t[7],A=t[8];return n[0]=g*A-y*E,n[1]=c*E-a*A,n[2]=a*y-c*g,n[3]=y*w-d*A,n[4]=i*A-c*w,n[5]=c*d-i*y,n[6]=d*E-g*w,n[7]=a*w-i*E,n[8]=i*g-a*d,n},o.asyncAll=At,o.bezier=Ze,o.bindAll=gt,o.boundsAttributes=ab,o.bufferConvexPolygon=function(n,t){const i=[];for(let a=0;a<n.length;a++){const c=Ge(a-1,-1,n.length-1),d=Ge(a+1,-1,n.length-1),g=n[a],y=n[d],w=n[c].sub(g).unit(),E=y.sub(g).unit(),A=E.angleWithSep(w.x,w.y),P=w.add(E).unit().mult(-1*t/Math.sin(A/2));i.push(g.add(P))}return i},o.cacheEntryPossiblyAdded=function(n){qn++,qn>nn&&(n.getActor().send("enforceCacheSizeLimit",Rt),qn=0)},o.calculateGlobeLabelMatrix=function(n,t){const{x:i,y:a}=n.point,c=Hx(i,a,n.worldSize/n._pixelsPerMercatorPixel,0,0);return kl(c,c,g_(fs(t)))},o.calculateGlobeMatrix=function(n){const{x:t,y:i}=n.point,{lng:a,lat:c}=n._center;return Hx(t,i,n.worldSize,a,c)},o.calculateGlobeMercatorMatrix=function(n){const t=n.pixelsPerMeter,i=t/To(1,n.center.lat),a=Go(new Float64Array(16));return zh(a,a,[n.point.x,n.point.y,0]),Pl(a,a,[i,i,t]),Float32Array.from(a)},o.circumferenceAtLatitude=Lg,o.clamp=lt,o.clearTileCache=function(n){if(!bn())return;const t=S.caches.delete(Mt);n&&t.catch(n).then(()=>n())},o.clipLine=Rx,o.clone=function(n){var t=new Yr(16);return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t[9]=n[9],t[10]=n[10],t[11]=n[11],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15],t},o.clone$1=sn,o.collisionCircleLayout=cA,o.config=L,o.conjugate=function(n,t){return n[0]=-t[0],n[1]=-t[1],n[2]=-t[2],n[3]=t[3],n},o.create=function(){var n=new Yr(16);return Yr!=Float32Array&&(n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=0,n[12]=0,n[13]=0,n[14]=0),n[0]=1,n[5]=1,n[10]=1,n[15]=1,n},o.create$1=M0,o.createExpression=ss,o.createLayout=Gt,o.createStyleLayer=function(n){return n.type==="custom"?new sM(n):new lM[n.type](n)},o.cross=$g,o.degToRad=Ie,o.distance=function(n,t){return Math.hypot(t[0]-n[0],t[1]-n[1],t[2]-n[2])},o.div=function(n,t,i){return n[0]=t[0]/i[0],n[1]=t[1]/i[1],n[2]=t[2]/i[2],n},o.dot=So,o.earthRadius=Xf,o.ease=Ye,o.easeCubicInOut=Re,o.ecefToLatLng=function([n,t,i]){const a=Math.hypot(n,t,i),c=Math.atan2(n,i),d=.5*Math.PI-Math.acos(-t/a);return new jn(ke(c),ke(d))},o.emitValidationErrors=zf,o.endsWith=ot,o.enforceCacheSizeLimit=function(n){Ln(),Wt&&Wt.then(t=>{t.keys().then(i=>{for(let a=0;a<i.length-n;a++)t.delete(i[a])})})},o.evaluateSizeForFeature=hp,o.evaluateSizeForZoom=Hc,o.evaluateVariableOffset=Nx,o.evented=xe,o.exactEquals=function(n,t){return n[0]===t[0]&&n[1]===t[1]&&n[2]===t[2]&&n[3]===t[3]},o.exactEquals$1=function(n,t){return n[0]===t[0]&&n[1]===t[1]&&n[2]===t[2]},o.exported=at,o.exported$1=D,o.extend=Ve,o.extend$1=Bo,o.fillExtrusionHeightLift=sx,o.filterObject=ft,o.fromMat4=function(n,t){return n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[4],n[4]=t[5],n[5]=t[6],n[6]=t[8],n[7]=t[9],n[8]=t[10],n},o.fromQuat=function(n,t){var i=t[0],a=t[1],c=t[2],d=t[3],g=i+i,y=a+a,w=c+c,E=i*g,A=a*g,P=a*y,z=c*g,B=c*y,F=c*w,q=d*g,W=d*y,le=d*w;return n[0]=1-P-F,n[1]=A+le,n[2]=z-W,n[3]=0,n[4]=A-le,n[5]=1-E-F,n[6]=B+q,n[7]=0,n[8]=z+W,n[9]=B-q,n[10]=1-E-P,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n},o.fromRotation=function(n,t){var i=Math.sin(t),a=Math.cos(t);return n[0]=a,n[1]=i,n[2]=0,n[3]=-i,n[4]=a,n[5]=0,n[6]=0,n[7]=0,n[8]=1,n},o.fromScaling=k0,o.furthestTileCorner=function(n){const t=Math.round((n+45+360)%360/90)%4;return Be[t]},o.getAABBPointSquareDist=function(n,t,i){let a=0;for(let c=0;c<2;++c){const d=i?i[c]:0;n[c]>d&&(a+=(n[c]-d)*(n[c]-d)),t[c]<d&&(a+=(d-t[c])*(d-t[c]))}return a},o.getAnchorAlignment=l_,o.getAnchorJustification=h_,o.getBounds=function(n){let t=1/0,i=1/0,a=-1/0,c=-1/0;for(const d of n)t=Math.min(t,d.x),i=Math.min(i,d.y),a=Math.max(a,d.x),c=Math.max(c,d.y);return{min:new ce(t,i),max:new ce(a,c)}},o.getColumn=bt,o.getGridMatrix=function(n,t,i,a){const c=t.getNorth(),d=t.getSouth(),g=t.getWest(),y=t.getEast(),w=1<<n.z,E=y-g,A=c-d,P=E/eu,z=-A/tu[i],B=[0,P,0,z,0,0,c,g,0];if(n.z>0){const F=180/a;I0(B,B,[F/E+1,0,0,0,F/A+1,0,-.5*F/P,.5*F/z,1])}return B[2]=w,B[5]=n.x,B[8]=n.y,B},o.getImage=Ir,o.getJSON=function(n,t){return qi(Ve(n,{type:"json"}),t)},o.getLatitudinalLod=function(n){const t=80.051129;n=lt(n,-80.051129,t)/t*90;const i=Math.pow(Math.abs(Math.sin(Ie(n))),3);return Math.round(i*(tu.length-1))},o.getMapSessionAPI=Ae,o.getPerformanceMeasurement=on,o.getProjection=nb,o.getRTLTextPluginStatus=Pe,o.getReferrer=ji,o.getTilePoint=function(n,{x:t,y:i},a=0){return new ce(((t-a)*n.scale-n.x)*_n,(i*n.scale-n.y)*_n)},o.getTileVec3=function(n,t,i=0){return $c(((t.x-i)*n.scale-n.x)*_n,(t.y*n.scale-n.y)*_n,_0(t.z,t.y))},o.getVideo=function(n,t){const i=S.document.createElement("video");i.muted=!0,i.onloadstart=function(){t(null,i)};for(let a=0;a<n.length;a++){const c=S.document.createElement("source");Ei(n[a])||(i.crossOrigin="Anonymous"),c.src=n[a],i.appendChild(c)}return{cancel:()=>{}}},o.globeCenterToScreenPoint=function(n){const t=[0,0,0],i=Go(new Float64Array(16));return kl(i,n.pixelMatrix,n.globeMatrix),Di(t,t,i),new ce(t[0],t[1])},o.globeDenormalizeECEF=g_,o.globeECEFOrigin=function(n,t){const i=[0,0,0];return Di(i,i,td(fs(t.canonical))),Di(i,i,n),i},o.globeNormalizeECEF=td,o.globePixelsToTileUnits=function(n,t){return _n/(512*Math.pow(2,n))*vp(fs(t))},o.globePoleMatrixForTile=function(n,t,i){const a=Go(new Float64Array(16)),c=(t/(1<<n)-.5)*Math.PI*2;return ep(a,i.globeMatrix,c),Float32Array.from(a)},o.globeTileBounds=fs,o.globeTiltAtLngLat=Xx,o.globeToMercatorTransition=iu,o.globeUseCustomAntiAliasing=function(n,t,i){const a=iu(i.zoom),c=n.style.map._antialias,d=!!t.extStandardDerivatives,g=t.extStandardDerivativesForceOff||n.terrain&&n.terrain.exaggeration()>0;return a===0&&!c&&!g&&d},o.identity=Go,o.identity$1=F0,o.invert=Vg,o.isFullscreen=function(){return!!S.document.fullscreenElement||!!S.document.webkitFullscreenElement},o.isLngLatBehindGlobe=__,o.isMapAuthenticated=function(n){return Ne.has(n)},o.isMapboxURL=vr,o.isSafariWithAntialiasingBug=function(n){const t=n.navigator?n.navigator.userAgent:null;return!!Nt(n)&&t&&(t.match("Version/15.4")||t.match("Version/15.5")||t.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},o.latFromMercatorY=mr,o.latLngToECEF=Jh,o.len=dC,o.length=Lh,o.length$1=function(n){return Math.hypot(n[0],n[1],n[2],n[3])},o.lngFromMercatorX=co,o.loadVectorTile=Tb,o.makeRequest=qi,o.mapValue=function(n,t,i,a,c){return lt((n-t)/(i-t)*(c-a)+a,a,c)},o.mercatorScale=y0,o.mercatorXfromLng=cs,o.mercatorYfromLat=us,o.mercatorZfromAltitude=To,o.mul=uC,o.mul$1=hC,o.multiply=kl,o.multiply$1=I0,o.multiply$2=L0,o.nextPowerOfTwo=xn,o.normalize=Lr,o.normalize$1=fC,o.normalize$2=O0,o.number=$n,o.ortho=function(n,t,i,a,c,d,g){var y=1/(t-i),w=1/(a-c),E=1/(d-g);return n[0]=-2*y,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=-2*w,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=2*E,n[11]=0,n[12]=(t+i)*y,n[13]=(c+a)*w,n[14]=(g+d)*E,n[15]=1,n},o.pbf=Xh,o.perspective=function(n,t,i,a,c){var d,g=1/Math.tan(t/2);return n[0]=g/i,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=g,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=-1,n[12]=0,n[13]=0,n[15]=0,c!=null&&c!==1/0?(n[10]=(c+a)*(d=1/(a-c)),n[14]=2*c*a*d):(n[10]=-1,n[14]=-2*a),n},o.pick=function(n,t){const i={};for(let a=0;a<t.length;a++){const c=t[a];c in n&&(i[c]=n[c])}return i},o.plugin=je,o.pointGeometry=ce,o.polesInViewport=function(n){const t=Go(new Float64Array(16));kl(t,n.pixelMatrix,n.globeMatrix);const i=[0,Co,0],a=[0,Ao,0];return Di(i,i,t),Di(a,a,t),[i[0]>0&&i[0]<=n.width&&i[1]>0&&i[1]<=n.height&&!__(n,new jn(n.center.lat,90)),a[0]>0&&a[0]<=n.width&&a[1]>0&&a[1]<=n.height&&!__(n,new jn(n.center.lat,-90))]},o.polygonContainsPoint=Il,o.polygonIntersectsBox=S0,o.polygonIntersectsPolygon=b0,o.polygonizeBounds=function(n,t,i=0,a=!0){const c=new ce(i,i),d=n.sub(c),g=t.add(c),y=[d,new ce(g.x,d.y),g,new ce(d.x,g.y)];return a&&y.push(d.clone()),y},o.posAttributes=Qh,o.postMapLoadEvent=ue,o.postPerformanceEvent=Oe,o.postTurnstileEvent=$,o.potpack=o_,o.prevPowerOfTwo=function(n){return n<=1?1:Math.pow(2,Math.floor(Math.log(n)/Math.LN2))},o.radToDeg=ke,o.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],o.registerForPluginStateChange=function(n){return n({pluginStatus:re,pluginURL:ie}),xe.on("pluginStateChange",n),n},o.removeAuthState=function(n){Ne.delete(n)},o.renderColorRamp=Xg,o.resample=v0,o.rotateX=Ug,o.rotateX$1=N0,o.rotateY=ep,o.rotateY$1=V0,o.rotateZ=function(n,t,i){var a=Math.sin(i),c=Math.cos(i),d=t[0],g=t[1],y=t[2],w=t[3],E=t[4],A=t[5],P=t[6],z=t[7];return t!==n&&(n[8]=t[8],n[9]=t[9],n[10]=t[10],n[11]=t[11],n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15]),n[0]=d*c+E*a,n[1]=g*c+A*a,n[2]=y*c+P*a,n[3]=w*c+z*a,n[4]=E*c-d*a,n[5]=A*c-g*a,n[6]=P*c-y*a,n[7]=z*c-w*a,n},o.rotateZ$1=function(n,t,i){i*=.5;var a=t[0],c=t[1],d=t[2],g=t[3],y=Math.sin(i),w=Math.cos(i);return n[0]=a*w+c*y,n[1]=c*w-a*y,n[2]=d*w+g*y,n[3]=g*w-d*y,n},o.scale=Pl,o.scale$1=D0,o.scale$2=uo,o.scaleAndAdd=Oh,o.set=function(n,t,i,a){return n[0]=t,n[1]=i,n[2]=a,n},o.setCacheLimits=function(n,t){Rt=n,nn=t},o.setColumn=function(n,t,i){n[4*t+0]=i[0],n[4*t+1]=i[1],n[4*t+2]=i[2],n[4*t+3]=i[3]},o.setRTLTextPlugin=function(n,t,i=!1){if(re===Q||re===ne||re===H)throw new Error("setRTLTextPlugin cannot be called multiple times.");ie=at.resolveURL(n),re=Q,X=t,Ee(),i||We()},o.smoothstep=Xt,o.spec=tt,o.squaredLength=function(n){var t=n[0],i=n[1],a=n[2];return t*t+i*i+a*a},o.storeAuthState=function(n,t){t?Ne.add(n):Ne.delete(n)},o.sub=Zo,o.subtract=qg,o.symbolSize=uA,o.tileAABB=function(n,t,i,a,c,d,g,y,w){if(w.name==="globe")return qA(n,t,new cp(i,a,c));const E=Dl({z:i,x:a,y:c},w);return new Rr([(d+E.x/E.scale)*t,t*(E.y/E.scale),g],[(d+E.x2/E.scale)*t,t*(E.y2/E.scale),y])},o.tileCornersToBounds=yp,o.tileTransform=Dl,o.transformMat3=function(n,t,i){var a=t[0],c=t[1],d=t[2];return n[0]=a*i[0]+c*i[3]+d*i[6],n[1]=a*i[1]+c*i[4]+d*i[7],n[2]=a*i[2]+c*i[5]+d*i[8],n},o.transformMat4=Di,o.transformMat4$1=zl,o.transformQuat=R0,o.transitionTileAABBinECEF=Gx,o.translate=zh,o.transpose=function(n,t){if(n===t){var i=t[1],a=t[2],c=t[5];n[1]=t[3],n[2]=t[6],n[3]=i,n[5]=t[7],n[6]=a,n[7]=c}else n[0]=t[0],n[1]=t[3],n[2]=t[6],n[3]=t[1],n[4]=t[4],n[5]=t[7],n[6]=t[2],n[7]=t[5],n[8]=t[8];return n},o.triggerPluginCompletionEvent=he,o.uniqueId=Bt,o.updateGlobeVertexNormal=function(n,t,i,a,c){const d=5*t+2;n.float32[d+0]=i,n.float32[d+1]=a,n.float32[d+2]=c},o.validateCustomStyleLayer=function(n){const t=[],i=n.id;return i===void 0&&t.push({message:`layers.${i}: missing required property "id"`}),n.render===void 0&&t.push({message:`layers.${i}: missing required method "render"`}),n.renderingMode&&n.renderingMode!=="2d"&&n.renderingMode!=="3d"&&t.push({message:`layers.${i}: property "renderingMode" must be either "2d" or "3d"`}),t},o.validateFilter=n=>Uo(bl(n)),o.validateFog=n=>Uo(kf(n)),o.validateLayer=n=>Uo(Oc(n)),o.validateLight=n=>Uo(If(n)),o.validateSource=n=>Uo(Af(n)),o.validateStyle=bh,o.validateTerrain=n=>Uo(Bc(n)),o.values=tn,o.vectorTile=sp,o.version=k,o.warnOnce=oe,o.window=S,o.wrap=Ge}),v(["./shared"],function(o){function S(Y){if(typeof Y=="number"||typeof Y=="boolean"||typeof Y=="string"||Y==null)return JSON.stringify(Y);if(Array.isArray(Y)){let $="[";for(const J of Y)$+=`${S(J)},`;return`${$}]`}let V="{";for(const $ of Object.keys(Y).sort())V+=`${$}:${S(Y[$])},`;return`${V}}`}function k(Y){let V="";for(const $ of o.refProperties)V+=`/${S(Y[$])}`;return V}class I{constructor(V){this.keyCache={},V&&this.replace(V)}replace(V){this._layerConfigs={},this._layers={},this.update(V,[])}update(V,$){for(const ue of V)this._layerConfigs[ue.id]=ue,(this._layers[ue.id]=o.createStyleLayer(ue)).compileFilter(),this.keyCache[ue.id]&&delete this.keyCache[ue.id];for(const ue of $)delete this.keyCache[ue],delete this._layerConfigs[ue],delete this._layers[ue];this.familiesBySource={};const J=function(ue,Se){const Oe={};for(let Ae=0;Ae<ue.length;Ae++){const Ne=Se&&Se[ue[Ae].id]||k(ue[Ae]);Se&&(Se[ue[Ae].id]=Ne);let ht=Oe[Ne];ht||(ht=Oe[Ne]=[]),ht.push(ue[Ae])}const ze=[];for(const Ae in Oe)ze.push(Oe[Ae]);return ze}(o.values(this._layerConfigs),this.keyCache);for(const ue of J){const Se=ue.map(Ft=>this._layers[Ft.id]),Oe=Se[0];if(Oe.visibility==="none")continue;const ze=Oe.source||"";let Ae=this.familiesBySource[ze];Ae||(Ae=this.familiesBySource[ze]={});const Ne=Oe.sourceLayer||"_geojsonTileLayer";let ht=Ae[Ne];ht||(ht=Ae[Ne]=[]),ht.push(Se)}}}class L{loadTile(V,$){const{uid:J,encoding:ue,rawImageData:Se,padding:Oe,buildQuadTree:ze}=V,Ae=o.window.ImageBitmap&&Se instanceof o.window.ImageBitmap?this.getImageData(Se,Oe):Se;$(null,new o.DEMData(J,Ae,ue,Oe<1,ze))}getImageData(V,$){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(V.width,V.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=V.width,this.offscreenCanvas.height=V.height,this.offscreenCanvasContext.drawImage(V,0,0,V.width,V.height);const J=this.offscreenCanvasContext.getImageData(-$,-$,V.width+2*$,V.height+2*$);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),J}}var D=function Y(V,$){var J,ue=V&&V.type;if(ue==="FeatureCollection")for(J=0;J<V.features.length;J++)Y(V.features[J],$);else if(ue==="GeometryCollection")for(J=0;J<V.geometries.length;J++)Y(V.geometries[J],$);else if(ue==="Feature")Y(V.geometry,$);else if(ue==="Polygon")N(V.coordinates,$);else if(ue==="MultiPolygon")for(J=0;J<V.coordinates.length;J++)N(V.coordinates[J],$);return V};function N(Y,V){if(Y.length!==0){j(Y[0],V);for(var $=1;$<Y.length;$++)j(Y[$],!V)}}function j(Y,V){for(var $=0,J=0,ue=0,Se=Y.length,Oe=Se-1;ue<Se;Oe=ue++){var ze=(Y[ue][0]-Y[Oe][0])*(Y[Oe][1]+Y[ue][1]),Ae=$+ze;J+=Math.abs($)>=Math.abs(ze)?$-Ae+ze:ze-Ae+$,$=Ae}$+J>=0!=!!V&&Y.reverse()}const Z=o.VectorTileFeature.prototype.toGeoJSON;class K{constructor(V){this._feature=V,this.extent=o.EXTENT,this.type=V.type,this.properties=V.tags,"id"in V&&!isNaN(V.id)&&(this.id=parseInt(V.id,10))}loadGeometry(){if(this._feature.type===1){const V=[];for(const $ of this._feature.geometry)V.push([new o.pointGeometry($[0],$[1])]);return V}{const V=[];for(const $ of this._feature.geometry){const J=[];for(const ue of $)J.push(new o.pointGeometry(ue[0],ue[1]));V.push(J)}return V}}toGeoJSON(V,$,J){return Z.call(this,V,$,J)}}class fe{constructor(V){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=o.EXTENT,this.length=V.length,this._features=V}feature(V){return new K(this._features[V])}}var te={exports:{}},ve=o.pointGeometry,Ce=o.vectorTile.VectorTileFeature,ce=pe;function pe(Y,V){this.options=V||{},this.features=Y,this.length=Y.length}function Te(Y,V){this.id=typeof Y.id=="number"?Y.id:void 0,this.type=Y.type,this.rawGeometry=Y.type===1?[Y.geometry]:Y.geometry,this.properties=Y.tags,this.extent=V||4096}pe.prototype.feature=function(Y){return new Te(this.features[Y],this.options.extent)},Te.prototype.loadGeometry=function(){var Y=this.rawGeometry;this.geometry=[];for(var V=0;V<Y.length;V++){for(var $=Y[V],J=[],ue=0;ue<$.length;ue++)J.push(new ve($[ue][0],$[ue][1]));this.geometry.push(J)}return this.geometry},Te.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var Y=this.geometry,V=1/0,$=-1/0,J=1/0,ue=-1/0,Se=0;Se<Y.length;Se++)for(var Oe=Y[Se],ze=0;ze<Oe.length;ze++){var Ae=Oe[ze];V=Math.min(V,Ae.x),$=Math.max($,Ae.x),J=Math.min(J,Ae.y),ue=Math.max(ue,Ae.y)}return[V,J,$,ue]},Te.prototype.toGeoJSON=Ce.prototype.toGeoJSON;var Me=o.pbf,Ie=ce;function ke(Y){var V=new Me;return function($,J){for(var ue in $.layers)J.writeMessage(3,Be,$.layers[ue])}(Y,V),V.finish()}function Be(Y,V){var $;V.writeVarintField(15,Y.version||1),V.writeStringField(1,Y.name||""),V.writeVarintField(5,Y.extent||4096);var J={keys:[],values:[],keycache:{},valuecache:{}};for($=0;$<Y.length;$++)J.feature=Y.feature($),V.writeMessage(2,Re,J);var ue=J.keys;for($=0;$<ue.length;$++)V.writeStringField(3,ue[$]);var Se=J.values;for($=0;$<Se.length;$++)V.writeMessage(4,Ge,Se[$])}function Re(Y,V){var $=Y.feature;$.id!==void 0&&V.writeVarintField(1,$.id),V.writeMessage(2,Ze,Y),V.writeVarintField(3,$.type),V.writeMessage(4,Xt,$)}function Ze(Y,V){var $=Y.feature,J=Y.keys,ue=Y.values,Se=Y.keycache,Oe=Y.valuecache;for(var ze in $.properties){var Ae=$.properties[ze],Ne=Se[ze];if(Ae!==null){Ne===void 0&&(J.push(ze),Se[ze]=Ne=J.length-1),V.writeVarint(Ne);var ht=typeof Ae;ht!=="string"&&ht!=="boolean"&&ht!=="number"&&(Ae=JSON.stringify(Ae));var Ft=ht+":"+Ae,wt=Oe[Ft];wt===void 0&&(ue.push(Ae),Oe[Ft]=wt=ue.length-1),V.writeVarint(wt)}}}function Ye(Y,V){return(V<<3)+(7&Y)}function lt(Y){return Y<<1^Y>>31}function Xt(Y,V){for(var $=Y.loadGeometry(),J=Y.type,ue=0,Se=0,Oe=$.length,ze=0;ze<Oe;ze++){var Ae=$[ze],Ne=1;J===1&&(Ne=Ae.length),V.writeVarint(Ye(1,Ne));for(var ht=J===3?Ae.length-1:Ae.length,Ft=0;Ft<ht;Ft++){Ft===1&&J!==1&&V.writeVarint(Ye(2,ht-1));var wt=Ae[Ft].x-ue,an=Ae[Ft].y-Se;V.writeVarint(lt(wt)),V.writeVarint(lt(an)),ue+=wt,Se+=an}J===3&&V.writeVarint(Ye(7,1))}}function Ge(Y,V){var $=typeof Y;$==="string"?V.writeStringField(1,Y):$==="boolean"?V.writeBooleanField(7,Y):$==="number"&&(Y%1!=0?V.writeDoubleField(3,Y):Y<0?V.writeSVarintField(6,Y):V.writeVarintField(5,Y))}function At(Y,V,$,J,ue,Se){if(ue-J<=$)return;const Oe=J+ue>>1;tn(Y,V,Oe,J,ue,Se%2),At(Y,V,$,J,Oe-1,Se+1),At(Y,V,$,Oe+1,ue,Se+1)}function tn(Y,V,$,J,ue,Se){for(;ue>J;){if(ue-J>600){const Ne=ue-J+1,ht=$-J+1,Ft=Math.log(Ne),wt=.5*Math.exp(2*Ft/3),an=.5*Math.sqrt(Ft*wt*(Ne-wt)/Ne)*(ht-Ne/2<0?-1:1);tn(Y,V,$,Math.max(J,Math.floor($-ht*wt/Ne+an)),Math.min(ue,Math.floor($+(Ne-ht)*wt/Ne+an)),Se)}const Oe=V[2*$+Se];let ze=J,Ae=ue;for(Ve(Y,V,J,$),V[2*ue+Se]>Oe&&Ve(Y,V,J,ue);ze<Ae;){for(Ve(Y,V,ze,Ae),ze++,Ae--;V[2*ze+Se]<Oe;)ze++;for(;V[2*Ae+Se]>Oe;)Ae--}V[2*J+Se]===Oe?Ve(Y,V,J,Ae):(Ae++,Ve(Y,V,Ae,ue)),Ae<=$&&(J=Ae+1),$<=Ae&&(ue=Ae-1)}}function Ve(Y,V,$,J){mt(Y,$,J),mt(V,2*$,2*J),mt(V,2*$+1,2*J+1)}function mt(Y,V,$){const J=Y[V];Y[V]=Y[$],Y[$]=J}function Bt(Y,V,$,J){const ue=Y-$,Se=V-J;return ue*ue+Se*Se}te.exports=ke,te.exports.fromVectorTileJs=ke,te.exports.fromGeojsonVt=function(Y,V){V=V||{};var $={};for(var J in Y)$[J]=new Ie(Y[J].features,V),$[J].name=J,$[J].version=V.version,$[J].extent=V.extent;return ke({layers:$})},te.exports.GeoJSONWrapper=Ie;const jt=Y=>Y[0],xn=Y=>Y[1];class rt{constructor(V,$=jt,J=xn,ue=64,Se=Float64Array){this.nodeSize=ue,this.points=V;const Oe=V.length<65536?Uint16Array:Uint32Array,ze=this.ids=new Oe(V.length),Ae=this.coords=new Se(2*V.length);for(let Ne=0;Ne<V.length;Ne++)ze[Ne]=Ne,Ae[2*Ne]=$(V[Ne]),Ae[2*Ne+1]=J(V[Ne]);At(ze,Ae,ue,0,ze.length-1,0)}range(V,$,J,ue){return function(Se,Oe,ze,Ae,Ne,ht,Ft){const wt=[0,Se.length-1,0],an=[];let on,rn;for(;wt.length;){const fn=wt.pop(),ge=wt.pop(),Lt=wt.pop();if(ge-Lt<=Ft){for(let yn=Lt;yn<=ge;yn++)on=Oe[2*yn],rn=Oe[2*yn+1],on>=ze&&on<=Ne&&rn>=Ae&&rn<=ht&&an.push(Se[yn]);continue}const at=Math.floor((Lt+ge)/2);on=Oe[2*at],rn=Oe[2*at+1],on>=ze&&on<=Ne&&rn>=Ae&&rn<=ht&&an.push(Se[at]);const Yt=(fn+1)%2;(fn===0?ze<=on:Ae<=rn)&&(wt.push(Lt),wt.push(at-1),wt.push(Yt)),(fn===0?Ne>=on:ht>=rn)&&(wt.push(at+1),wt.push(ge),wt.push(Yt))}return an}(this.ids,this.coords,V,$,J,ue,this.nodeSize)}within(V,$,J){return function(ue,Se,Oe,ze,Ae,Ne){const ht=[0,ue.length-1,0],Ft=[],wt=Ae*Ae;for(;ht.length;){const an=ht.pop(),on=ht.pop(),rn=ht.pop();if(on-rn<=Ne){for(let Yt=rn;Yt<=on;Yt++)Bt(Se[2*Yt],Se[2*Yt+1],Oe,ze)<=wt&&Ft.push(ue[Yt]);continue}const fn=Math.floor((rn+on)/2),ge=Se[2*fn],Lt=Se[2*fn+1];Bt(ge,Lt,Oe,ze)<=wt&&Ft.push(ue[fn]);const at=(an+1)%2;(an===0?Oe-Ae<=ge:ze-Ae<=Lt)&&(ht.push(rn),ht.push(fn-1),ht.push(at)),(an===0?Oe+Ae>=ge:ze+Ae>=Lt)&&(ht.push(fn+1),ht.push(on),ht.push(at))}return Ft}(this.ids,this.coords,V,$,J,this.nodeSize)}}const gt={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Y=>Y},ot=Math.fround||(_t=new Float32Array(1),Y=>(_t[0]=+Y,_t[0]));var _t;class ft{constructor(V){this.options=zt(Object.create(gt),V),this.trees=new Array(this.options.maxZoom+1)}load(V){const{log:$,minZoom:J,maxZoom:ue,nodeSize:Se}=this.options;$&&console.time("total time");const Oe=`prepare ${V.length} points`;$&&console.time(Oe),this.points=V;let ze=[];for(let Ae=0;Ae<V.length;Ae++)V[Ae].geometry&&ze.push(un(V[Ae],Ae));this.trees[ue+1]=new rt(ze,Nt,kt,Se,Float32Array),$&&console.timeEnd(Oe);for(let Ae=ue;Ae>=J;Ae--){const Ne=+Date.now();ze=this._cluster(ze,Ae),this.trees[Ae]=new rt(ze,Nt,kt,Se,Float32Array),$&&console.log("z%d: %d clusters in %dms",Ae,ze.length,+Date.now()-Ne)}return $&&console.timeEnd("total time"),this}getClusters(V,$){let J=((V[0]+180)%360+360)%360-180;const ue=Math.max(-90,Math.min(90,V[1]));let Se=V[2]===180?180:((V[2]+180)%360+360)%360-180;const Oe=Math.max(-90,Math.min(90,V[3]));if(V[2]-V[0]>=360)J=-180,Se=180;else if(J>Se){const ht=this.getClusters([J,ue,180,Oe],$),Ft=this.getClusters([-180,ue,Se,Oe],$);return ht.concat(Ft)}const ze=this.trees[this._limitZoom($)],Ae=ze.range(Fe(J),nt(Oe),Fe(Se),nt(ue)),Ne=[];for(const ht of Ae){const Ft=ze.points[ht];Ne.push(Ft.numPoints?oe(Ft):this.points[Ft.index])}return Ne}getChildren(V){const $=this._getOriginId(V),J=this._getOriginZoom(V),ue="No cluster with the specified id.",Se=this.trees[J];if(!Se)throw new Error(ue);const Oe=Se.points[$];if(!Oe)throw new Error(ue);const ze=this.options.radius/(this.options.extent*Math.pow(2,J-1)),Ae=Se.within(Oe.x,Oe.y,ze),Ne=[];for(const ht of Ae){const Ft=Se.points[ht];Ft.parentId===V&&Ne.push(Ft.numPoints?oe(Ft):this.points[Ft.index])}if(Ne.length===0)throw new Error(ue);return Ne}getLeaves(V,$,J){const ue=[];return this._appendLeaves(ue,V,$=$||10,J=J||0,0),ue}getTile(V,$,J){const ue=this.trees[this._limitZoom(V)],Se=Math.pow(2,V),{extent:Oe,radius:ze}=this.options,Ae=ze/Oe,Ne=(J-Ae)/Se,ht=(J+1+Ae)/Se,Ft={features:[]};return this._addTileFeatures(ue.range(($-Ae)/Se,Ne,($+1+Ae)/Se,ht),ue.points,$,J,Se,Ft),$===0&&this._addTileFeatures(ue.range(1-Ae/Se,Ne,1,ht),ue.points,Se,J,Se,Ft),$===Se-1&&this._addTileFeatures(ue.range(0,Ne,Ae/Se,ht),ue.points,-1,J,Se,Ft),Ft.features.length?Ft:null}getClusterExpansionZoom(V){let $=this._getOriginZoom(V)-1;for(;$<=this.options.maxZoom;){const J=this.getChildren(V);if($++,J.length!==1)break;V=J[0].properties.cluster_id}return $}_appendLeaves(V,$,J,ue,Se){const Oe=this.getChildren($);for(const ze of Oe){const Ae=ze.properties;if(Ae&&Ae.cluster?Se+Ae.point_count<=ue?Se+=Ae.point_count:Se=this._appendLeaves(V,Ae.cluster_id,J,ue,Se):Se<ue?Se++:V.push(ze),V.length===J)break}return Se}_addTileFeatures(V,$,J,ue,Se,Oe){for(const ze of V){const Ae=$[ze],Ne=Ae.numPoints;let ht,Ft,wt;if(Ne)ht=be(Ae),Ft=Ae.x,wt=Ae.y;else{const rn=this.points[Ae.index];ht=rn.properties,Ft=Fe(rn.geometry.coordinates[0]),wt=nt(rn.geometry.coordinates[1])}const an={type:1,geometry:[[Math.round(this.options.extent*(Ft*Se-J)),Math.round(this.options.extent*(wt*Se-ue))]],tags:ht};let on;Ne?on=Ae.id:this.options.generateId?on=Ae.index:this.points[Ae.index].id&&(on=this.points[Ae.index].id),on!==void 0&&(an.id=on),Oe.features.push(an)}}_limitZoom(V){return Math.max(this.options.minZoom,Math.min(Math.floor(+V),this.options.maxZoom+1))}_cluster(V,$){const J=[],{radius:ue,extent:Se,reduce:Oe,minPoints:ze}=this.options,Ae=ue/(Se*Math.pow(2,$));for(let Ne=0;Ne<V.length;Ne++){const ht=V[Ne];if(ht.zoom<=$)continue;ht.zoom=$;const Ft=this.trees[$+1],wt=Ft.within(ht.x,ht.y,Ae),an=ht.numPoints||1;let on=an;for(const rn of wt){const fn=Ft.points[rn];fn.zoom>$&&(on+=fn.numPoints||1)}if(on>an&&on>=ze){let rn=ht.x*an,fn=ht.y*an,ge=Oe&&an>1?this._map(ht,!0):null;const Lt=(Ne<<5)+($+1)+this.points.length;for(const at of wt){const Yt=Ft.points[at];if(Yt.zoom<=$)continue;Yt.zoom=$;const yn=Yt.numPoints||1;rn+=Yt.x*yn,fn+=Yt.y*yn,Yt.parentId=Lt,Oe&&(ge||(ge=this._map(ht,!0)),Oe(ge,this._map(Yt)))}ht.parentId=Lt,J.push(sn(rn/on,fn/on,Lt,on,ge))}else if(J.push(ht),on>1)for(const rn of wt){const fn=Ft.points[rn];fn.zoom<=$||(fn.zoom=$,J.push(fn))}}return J}_getOriginId(V){return V-this.points.length>>5}_getOriginZoom(V){return(V-this.points.length)%32}_map(V,$){if(V.numPoints)return $?zt({},V.properties):V.properties;const J=this.points[V.index].properties,ue=this.options.map(J);return $&&ue===J?zt({},ue):ue}}function sn(Y,V,$,J,ue){return{x:ot(Y),y:ot(V),zoom:1/0,id:$,parentId:-1,numPoints:J,properties:ue}}function un(Y,V){const[$,J]=Y.geometry.coordinates;return{x:ot(Fe($)),y:ot(nt(J)),zoom:1/0,index:V,parentId:-1}}function oe(Y){return{type:"Feature",id:Y.id,properties:be(Y),geometry:{type:"Point",coordinates:[(V=Y.x,360*(V-.5)),yt(Y.y)]}};var V}function be(Y){const V=Y.numPoints,$=V>=1e4?`${Math.round(V/1e3)}k`:V>=1e3?Math.round(V/100)/10+"k":V;return zt(zt({},Y.properties),{cluster:!0,cluster_id:Y.id,point_count:V,point_count_abbreviated:$})}function Fe(Y){return Y/360+.5}function nt(Y){const V=Math.sin(Y*Math.PI/180),$=.5-.25*Math.log((1+V)/(1-V))/Math.PI;return $<0?0:$>1?1:$}function yt(Y){const V=(180-360*Y)*Math.PI/180;return 360*Math.atan(Math.exp(V))/Math.PI-90}function zt(Y,V){for(const $ in V)Y[$]=V[$];return Y}function Nt(Y){return Y.x}function kt(Y){return Y.y}function bt(Y,V,$,J){for(var ue,Se=J,Oe=$-V>>1,ze=$-V,Ae=Y[V],Ne=Y[V+1],ht=Y[$],Ft=Y[$+1],wt=V+3;wt<$;wt+=3){var an=Mt(Y[wt],Y[wt+1],Ae,Ne,ht,Ft);if(an>Se)ue=wt,Se=an;else if(an===Se){var on=Math.abs(wt-Oe);on<ze&&(ue=wt,ze=on)}}Se>J&&(ue-V>3&&bt(Y,V,ue,J),Y[ue+2]=Se,$-ue>3&&bt(Y,ue,$,J))}function Mt(Y,V,$,J,ue,Se){var Oe=ue-$,ze=Se-J;if(Oe!==0||ze!==0){var Ae=((Y-$)*Oe+(V-J)*ze)/(Oe*Oe+ze*ze);Ae>1?($=ue,J=Se):Ae>0&&($+=Oe*Ae,J+=ze*Ae)}return(Oe=Y-$)*Oe+(ze=V-J)*ze}function Wt(Y,V,$,J){var ue={id:Y===void 0?null:Y,type:V,geometry:$,tags:J,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(Se){var Oe=Se.geometry,ze=Se.type;if(ze==="Point"||ze==="MultiPoint"||ze==="LineString")et(Se,Oe);else if(ze==="Polygon"||ze==="MultiLineString")for(var Ae=0;Ae<Oe.length;Ae++)et(Se,Oe[Ae]);else if(ze==="MultiPolygon")for(Ae=0;Ae<Oe.length;Ae++)for(var Ne=0;Ne<Oe[Ae].length;Ne++)et(Se,Oe[Ae][Ne])}(ue),ue}function et(Y,V){for(var $=0;$<V.length;$+=3)Y.minX=Math.min(Y.minX,V[$]),Y.minY=Math.min(Y.minY,V[$+1]),Y.maxX=Math.max(Y.maxX,V[$]),Y.maxY=Math.max(Y.maxY,V[$+1])}function Rt(Y,V,$,J){if(V.geometry){var ue=V.geometry.coordinates,Se=V.geometry.type,Oe=Math.pow($.tolerance/((1<<$.maxZoom)*$.extent),2),ze=[],Ae=V.id;if($.promoteId?Ae=V.properties[$.promoteId]:$.generateId&&(Ae=J||0),Se==="Point")nn(ue,ze);else if(Se==="MultiPoint")for(var Ne=0;Ne<ue.length;Ne++)nn(ue[Ne],ze);else if(Se==="LineString")bn(ue,ze,Oe,!1);else if(Se==="MultiLineString"){if($.lineMetrics){for(Ne=0;Ne<ue.length;Ne++)bn(ue[Ne],ze=[],Oe,!1),Y.push(Wt(Ae,"LineString",ze,V.properties));return}Ln(ue,ze,Oe,!1)}else if(Se==="Polygon")Ln(ue,ze,Oe,!0);else{if(Se!=="MultiPolygon"){if(Se==="GeometryCollection"){for(Ne=0;Ne<V.geometry.geometries.length;Ne++)Rt(Y,{id:Ae,geometry:V.geometry.geometries[Ne],properties:V.properties},$,J);return}throw new Error("Input data is not a valid GeoJSON object.")}for(Ne=0;Ne<ue.length;Ne++){var ht=[];Ln(ue[Ne],ht,Oe,!0),ze.push(ht)}}Y.push(Wt(Ae,Se,ze,V.properties))}}function nn(Y,V){V.push(An(Y[0])),V.push(qn(Y[1])),V.push(0)}function bn(Y,V,$,J){for(var ue,Se,Oe=0,ze=0;ze<Y.length;ze++){var Ae=An(Y[ze][0]),Ne=qn(Y[ze][1]);V.push(Ae),V.push(Ne),V.push(0),ze>0&&(Oe+=J?(ue*Ne-Ae*Se)/2:Math.sqrt(Math.pow(Ae-ue,2)+Math.pow(Ne-Se,2))),ue=Ae,Se=Ne}var ht=V.length-3;V[2]=1,bt(V,0,ht,$),V[ht+2]=1,V.size=Math.abs(Oe),V.start=0,V.end=V.size}function Ln(Y,V,$,J){for(var ue=0;ue<Y.length;ue++){var Se=[];bn(Y[ue],Se,$,J),V.push(Se)}}function An(Y){return Y/360+.5}function qn(Y){var V=Math.sin(Y*Math.PI/180),$=.5-.25*Math.log((1+V)/(1-V))/Math.PI;return $<0?0:$>1?1:$}function Hn(Y,V,$,J,ue,Se,Oe,ze){if(J/=V,Se>=($/=V)&&Oe<J)return Y;if(Oe<$||Se>=J)return null;for(var Ae=[],Ne=0;Ne<Y.length;Ne++){var ht=Y[Ne],Ft=ht.geometry,wt=ht.type,an=ue===0?ht.minX:ht.minY,on=ue===0?ht.maxX:ht.maxY;if(an>=$&&on<J)Ae.push(ht);else if(!(on<$||an>=J)){var rn=[];if(wt==="Point"||wt==="MultiPoint")Bi(Ft,rn,$,J,ue);else if(wt==="LineString")ji(Ft,rn,$,J,ue,!1,ze.lineMetrics);else if(wt==="MultiLineString")tr(Ft,rn,$,J,ue,!1);else if(wt==="Polygon")tr(Ft,rn,$,J,ue,!0);else if(wt==="MultiPolygon")for(var fn=0;fn<Ft.length;fn++){var ge=[];tr(Ft[fn],ge,$,J,ue,!0),ge.length&&rn.push(ge)}if(rn.length){if(ze.lineMetrics&&wt==="LineString"){for(fn=0;fn<rn.length;fn++)Ae.push(Wt(ht.id,wt,rn[fn],ht.tags));continue}wt!=="LineString"&&wt!=="MultiLineString"||(rn.length===1?(wt="LineString",rn=rn[0]):wt="MultiLineString"),wt!=="Point"&&wt!=="MultiPoint"||(wt=rn.length===3?"Point":"MultiPoint"),Ae.push(Wt(ht.id,wt,rn,ht.tags))}}}return Ae.length?Ae:null}function Bi(Y,V,$,J,ue){for(var Se=0;Se<Y.length;Se+=3){var Oe=Y[Se+ue];Oe>=$&&Oe<=J&&(V.push(Y[Se]),V.push(Y[Se+1]),V.push(Y[Se+2]))}}function ji(Y,V,$,J,ue,Se,Oe){for(var ze,Ae,Ne=qi(Y),ht=ue===0?$i:hr,Ft=Y.start,wt=0;wt<Y.length-3;wt+=3){var an=Y[wt],on=Y[wt+1],rn=Y[wt+2],fn=Y[wt+3],ge=Y[wt+4],Lt=ue===0?an:on,at=ue===0?fn:ge,Yt=!1;Oe&&(ze=Math.sqrt(Math.pow(an-fn,2)+Math.pow(on-ge,2))),Lt<$?at>$&&(Ae=ht(Ne,an,on,fn,ge,$),Oe&&(Ne.start=Ft+ze*Ae)):Lt>J?at<J&&(Ae=ht(Ne,an,on,fn,ge,J),Oe&&(Ne.start=Ft+ze*Ae)):Ei(Ne,an,on,rn),at<$&&Lt>=$&&(Ae=ht(Ne,an,on,fn,ge,$),Yt=!0),at>J&&Lt<=J&&(Ae=ht(Ne,an,on,fn,ge,J),Yt=!0),!Se&&Yt&&(Oe&&(Ne.end=Ft+ze*Ae),V.push(Ne),Ne=qi(Y)),Oe&&(Ft+=ze)}var yn=Y.length-3;an=Y[yn],on=Y[yn+1],rn=Y[yn+2],(Lt=ue===0?an:on)>=$&&Lt<=J&&Ei(Ne,an,on,rn),yn=Ne.length-3,Se&&yn>=3&&(Ne[yn]!==Ne[0]||Ne[yn+1]!==Ne[1])&&Ei(Ne,Ne[0],Ne[1],Ne[2]),Ne.length&&V.push(Ne)}function qi(Y){var V=[];return V.size=Y.size,V.start=Y.start,V.end=Y.end,V}function tr(Y,V,$,J,ue,Se){for(var Oe=0;Oe<Y.length;Oe++)ji(Y[Oe],V,$,J,ue,Se,!1)}function Ei(Y,V,$,J){Y.push(V),Y.push($),Y.push(J)}function $i(Y,V,$,J,ue,Se){var Oe=(Se-V)/(J-V);return Y.push(Se),Y.push($+(ue-$)*Oe),Y.push(1),Oe}function hr(Y,V,$,J,ue,Se){var Oe=(Se-$)/(ue-$);return Y.push(V+(J-V)*Oe),Y.push(Se),Y.push(1),Oe}function Mr(Y,V){for(var $=[],J=0;J<Y.length;J++){var ue,Se=Y[J],Oe=Se.type;if(Oe==="Point"||Oe==="MultiPoint"||Oe==="LineString")ue=Ir(Se.geometry,V);else if(Oe==="MultiLineString"||Oe==="Polygon"){ue=[];for(var ze=0;ze<Se.geometry.length;ze++)ue.push(Ir(Se.geometry[ze],V))}else if(Oe==="MultiPolygon")for(ue=[],ze=0;ze<Se.geometry.length;ze++){for(var Ae=[],Ne=0;Ne<Se.geometry[ze].length;Ne++)Ae.push(Ir(Se.geometry[ze][Ne],V));ue.push(Ae)}$.push(Wt(Se.id,Oe,ue,Se.tags))}return $}function Ir(Y,V){var $=[];$.size=Y.size,Y.start!==void 0&&($.start=Y.start,$.end=Y.end);for(var J=0;J<Y.length;J+=3)$.push(Y[J]+V,Y[J+1],Y[J+2]);return $}function mo(Y,V){if(Y.transformed)return Y;var $,J,ue,Se=1<<Y.z,Oe=Y.x,ze=Y.y;for($=0;$<Y.features.length;$++){var Ae=Y.features[$],Ne=Ae.geometry,ht=Ae.type;if(Ae.geometry=[],ht===1)for(J=0;J<Ne.length;J+=2)Ae.geometry.push(vr(Ne[J],Ne[J+1],V,Se,Oe,ze));else for(J=0;J<Ne.length;J++){var Ft=[];for(ue=0;ue<Ne[J].length;ue+=2)Ft.push(vr(Ne[J][ue],Ne[J][ue+1],V,Se,Oe,ze));Ae.geometry.push(Ft)}}return Y.transformed=!0,Y}function vr(Y,V,$,J,ue,Se){return[Math.round($*(Y*J-ue)),Math.round($*(V*J-Se))]}function so(Y,V,$,J,ue){for(var Se=V===ue.maxZoom?0:ue.tolerance/((1<<V)*ue.extent),Oe={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:$,y:J,z:V,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},ze=0;ze<Y.length;ze++){Oe.numFeatures++,ns(Oe,Y[ze],Se,ue);var Ae=Y[ze].minX,Ne=Y[ze].minY,ht=Y[ze].maxX,Ft=Y[ze].maxY;Ae<Oe.minX&&(Oe.minX=Ae),Ne<Oe.minY&&(Oe.minY=Ne),ht>Oe.maxX&&(Oe.maxX=ht),Ft>Oe.maxY&&(Oe.maxY=Ft)}return Oe}function ns(Y,V,$,J){var ue=V.geometry,Se=V.type,Oe=[];if(Se==="Point"||Se==="MultiPoint")for(var ze=0;ze<ue.length;ze+=3)Oe.push(ue[ze]),Oe.push(ue[ze+1]),Y.numPoints++,Y.numSimplified++;else if(Se==="LineString")ao(Oe,ue,Y,$,!1,!1);else if(Se==="MultiLineString"||Se==="Polygon")for(ze=0;ze<ue.length;ze++)ao(Oe,ue[ze],Y,$,Se==="Polygon",ze===0);else if(Se==="MultiPolygon")for(var Ae=0;Ae<ue.length;Ae++){var Ne=ue[Ae];for(ze=0;ze<Ne.length;ze++)ao(Oe,Ne[ze],Y,$,!0,ze===0)}if(Oe.length){var ht=V.tags||null;if(Se==="LineString"&&J.lineMetrics){for(var Ft in ht={},V.tags)ht[Ft]=V.tags[Ft];ht.mapbox_clip_start=ue.start/ue.size,ht.mapbox_clip_end=ue.end/ue.size}var wt={geometry:Oe,type:Se==="Polygon"||Se==="MultiPolygon"?3:Se==="LineString"||Se==="MultiLineString"?2:1,tags:ht};V.id!==null&&(wt.id=V.id),Y.features.push(wt)}}function ao(Y,V,$,J,ue,Se){var Oe=J*J;if(J>0&&V.size<(ue?Oe:J))$.numPoints+=V.length/3;else{for(var ze=[],Ae=0;Ae<V.length;Ae+=3)(J===0||V[Ae+2]>Oe)&&($.numSimplified++,ze.push(V[Ae]),ze.push(V[Ae+1])),$.numPoints++;ue&&function(Ne,ht){for(var Ft=0,wt=0,an=Ne.length,on=an-2;wt<an;on=wt,wt+=2)Ft+=(Ne[wt]-Ne[on])*(Ne[wt+1]+Ne[on+1]);if(Ft>0===ht)for(wt=0,an=Ne.length;wt<an/2;wt+=2){var rn=Ne[wt],fn=Ne[wt+1];Ne[wt]=Ne[an-2-wt],Ne[wt+1]=Ne[an-1-wt],Ne[an-2-wt]=rn,Ne[an-1-wt]=fn}}(ze,Se),Y.push(ze)}}function ct(Y,V){var $=(V=this.options=function(ue,Se){for(var Oe in Se)ue[Oe]=Se[Oe];return ue}(Object.create(this.options),V)).debug;if($&&console.time("preprocess data"),V.maxZoom<0||V.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(V.promoteId&&V.generateId)throw new Error("promoteId and generateId cannot be used together.");var J=function(ue,Se){var Oe=[];if(ue.type==="FeatureCollection")for(var ze=0;ze<ue.features.length;ze++)Rt(Oe,ue.features[ze],Se,ze);else Rt(Oe,ue.type==="Feature"?ue:{geometry:ue},Se);return Oe}(Y,V);this.tiles={},this.tileCoords=[],$&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",V.indexMaxZoom,V.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),J=function(ue,Se){var Oe=Se.buffer/Se.extent,ze=ue,Ae=Hn(ue,1,-1-Oe,Oe,0,-1,2,Se),Ne=Hn(ue,1,1-Oe,2+Oe,0,-1,2,Se);return(Ae||Ne)&&(ze=Hn(ue,1,-Oe,1+Oe,0,-1,2,Se)||[],Ae&&(ze=Mr(Ae,1).concat(ze)),Ne&&(ze=ze.concat(Mr(Ne,-1)))),ze}(J,V),J.length&&this.splitTile(J,0,0,0),$&&(J.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Kt(Y,V,$){return 32*((1<<Y)*$+V)+Y}function hn(Y,V){const $=Y.tileID.canonical;if(!this._geoJSONIndex)return V(null,null);const J=this._geoJSONIndex.getTile($.z,$.x,$.y);if(!J)return V(null,null);const ue=new fe(J.features);let Se=te.exports(ue);Se.byteOffset===0&&Se.byteLength===Se.buffer.byteLength||(Se=new Uint8Array(Se)),V(null,{vectorTile:ue,rawData:Se.buffer})}ct.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},ct.prototype.splitTile=function(Y,V,$,J,ue,Se,Oe){for(var ze=[Y,V,$,J],Ae=this.options,Ne=Ae.debug;ze.length;){J=ze.pop(),$=ze.pop(),V=ze.pop(),Y=ze.pop();var ht=1<<V,Ft=Kt(V,$,J),wt=this.tiles[Ft];if(!wt&&(Ne>1&&console.time("creation"),wt=this.tiles[Ft]=so(Y,V,$,J,Ae),this.tileCoords.push({z:V,x:$,y:J}),Ne)){Ne>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",V,$,J,wt.numFeatures,wt.numPoints,wt.numSimplified),console.timeEnd("creation"));var an="z"+V;this.stats[an]=(this.stats[an]||0)+1,this.total++}if(wt.source=Y,ue){if(V===Ae.maxZoom||V===ue)continue;var on=1<<ue-V;if($!==Math.floor(Se/on)||J!==Math.floor(Oe/on))continue}else if(V===Ae.indexMaxZoom||wt.numPoints<=Ae.indexMaxPoints)continue;if(wt.source=null,Y.length!==0){Ne>1&&console.time("clipping");var rn,fn,ge,Lt,at,Yt,yn=.5*Ae.buffer/Ae.extent,Fn=.5-yn,ai=.5+yn,mi=1+yn;rn=fn=ge=Lt=null,at=Hn(Y,ht,$-yn,$+ai,0,wt.minX,wt.maxX,Ae),Yt=Hn(Y,ht,$+Fn,$+mi,0,wt.minX,wt.maxX,Ae),Y=null,at&&(rn=Hn(at,ht,J-yn,J+ai,1,wt.minY,wt.maxY,Ae),fn=Hn(at,ht,J+Fn,J+mi,1,wt.minY,wt.maxY,Ae),at=null),Yt&&(ge=Hn(Yt,ht,J-yn,J+ai,1,wt.minY,wt.maxY,Ae),Lt=Hn(Yt,ht,J+Fn,J+mi,1,wt.minY,wt.maxY,Ae),Yt=null),Ne>1&&console.timeEnd("clipping"),ze.push(rn||[],V+1,2*$,2*J),ze.push(fn||[],V+1,2*$,2*J+1),ze.push(ge||[],V+1,2*$+1,2*J),ze.push(Lt||[],V+1,2*$+1,2*J+1)}}},ct.prototype.getTile=function(Y,V,$){var J=this.options,ue=J.extent,Se=J.debug;if(Y<0||Y>24)return null;var Oe=1<<Y,ze=Kt(Y,V=(V%Oe+Oe)%Oe,$);if(this.tiles[ze])return mo(this.tiles[ze],ue);Se>1&&console.log("drilling down to z%d-%d-%d",Y,V,$);for(var Ae,Ne=Y,ht=V,Ft=$;!Ae&&Ne>0;)Ne--,ht=Math.floor(ht/2),Ft=Math.floor(Ft/2),Ae=this.tiles[Kt(Ne,ht,Ft)];return Ae&&Ae.source?(Se>1&&console.log("found parent tile z%d-%d-%d",Ne,ht,Ft),Se>1&&console.time("drilling down"),this.splitTile(Ae.source,Ne,ht,Ft,Y,V,$),Se>1&&console.timeEnd("drilling down"),this.tiles[ze]?mo(this.tiles[ze],ue):null):null};class En extends o.VectorTileWorkerSource{constructor(V,$,J,ue,Se){super(V,$,J,ue,hn),Se&&(this.loadGeoJSON=Se)}loadData(V,$){const J=V&&V.request,ue=J&&J.collectResourceTiming;this.loadGeoJSON(V,(Se,Oe)=>{if(Se||!Oe)return $(Se);if(typeof Oe!="object")return $(new Error(`Input data given to '${V.source}' is not a valid GeoJSON object.`));{D(Oe,!0);try{if(V.filter){const Ae=o.createExpression(V.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Ae.result==="error")throw new Error(Ae.value.map(ht=>`${ht.key}: ${ht.message}`).join(", "));Oe={type:"FeatureCollection",features:Oe.features.filter(ht=>Ae.value.evaluate({zoom:0},ht))}}this._geoJSONIndex=V.cluster?new ft(function({superclusterOptions:Ae,clusterProperties:Ne}){if(!Ne||!Ae)return Ae;const ht={},Ft={},wt={accumulated:null,zoom:0},an={properties:null},on=Object.keys(Ne);for(const rn of on){const[fn,ge]=Ne[rn],Lt=o.createExpression(ge),at=o.createExpression(typeof fn=="string"?[fn,["accumulated"],["get",rn]]:fn);ht[rn]=Lt.value,Ft[rn]=at.value}return Ae.map=rn=>{an.properties=rn;const fn={};for(const ge of on)fn[ge]=ht[ge].evaluate(wt,an);return fn},Ae.reduce=(rn,fn)=>{an.properties=fn;for(const ge of on)wt.accumulated=rn[ge],rn[ge]=Ft[ge].evaluate(wt,an)},Ae}(V)).load(Oe.features):function(Ae,Ne){return new ct(Ae,Ne)}(Oe,V.geojsonVtOptions)}catch(Ae){return $(Ae)}this.loaded={};const ze={};if(ue){const Ae=o.getPerformanceMeasurement(J);Ae&&(ze.resourceTiming={},ze.resourceTiming[V.source]=JSON.parse(JSON.stringify(Ae)))}$(null,ze)}})}reloadTile(V,$){const J=this.loaded;return J&&J[V.uid]?super.reloadTile(V,$):this.loadTile(V,$)}loadGeoJSON(V,$){if(V.request)o.getJSON(V.request,$);else{if(typeof V.data!="string")return $(new Error(`Input data given to '${V.source}' is not a valid GeoJSON object.`));try{return $(null,JSON.parse(V.data))}catch{return $(new Error(`Input data given to '${V.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(V,$){try{$(null,this._geoJSONIndex.getClusterExpansionZoom(V.clusterId))}catch(J){$(J)}}getClusterChildren(V,$){try{$(null,this._geoJSONIndex.getChildren(V.clusterId))}catch(J){$(J)}}getClusterLeaves(V,$){try{$(null,this._geoJSONIndex.getLeaves(V.clusterId,V.limit,V.offset))}catch(J){$(J)}}}class kn{constructor(V){this.self=V,this.actor=new o.Actor(V,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=o.getProjection({name:"mercator"}),this.workerSourceTypes={vector:o.VectorTileWorkerSource,geojson:En},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=($,J)=>{if(this.workerSourceTypes[$])throw new Error(`Worker source with name "${$}" already registered.`);this.workerSourceTypes[$]=J},this.self.registerRTLTextPlugin=$=>{if(o.plugin.isParsed())throw new Error("RTL text plugin already registered.");o.plugin.applyArabicShaping=$.applyArabicShaping,o.plugin.processBidirectionalText=$.processBidirectionalText,o.plugin.processStyledBidirectionalText=$.processStyledBidirectionalText}}clearCaches(V,$,J){delete this.layerIndexes[V],delete this.availableImages[V],delete this.workerSources[V],delete this.demWorkerSources[V],J()}checkIfReady(V,$,J){J()}setReferrer(V,$){this.referrer=$}spriteLoaded(V,$){this.isSpriteLoaded[V]=$;for(const J in this.workerSources[V]){const ue=this.workerSources[V][J];for(const Se in ue)ue[Se]instanceof o.VectorTileWorkerSource&&(ue[Se].isSpriteLoaded=$,ue[Se].fire(new o.Event("isSpriteLoaded")))}}setImages(V,$,J){this.availableImages[V]=$;for(const ue in this.workerSources[V]){const Se=this.workerSources[V][ue];for(const Oe in Se)Se[Oe].availableImages=$}J()}enableTerrain(V,$,J){this.terrain=$,J()}setProjection(V,$){this.projections[V]=o.getProjection($)}setLayers(V,$,J){this.getLayerIndex(V).replace($),J()}updateLayers(V,$,J){this.getLayerIndex(V).update($.layers,$.removedIds),J()}loadTile(V,$,J){const ue=this.enableTerrain?o.extend({enableTerrain:this.terrain},$):$;ue.projection=this.projections[V]||this.defaultProjection,this.getWorkerSource(V,$.type,$.source).loadTile(ue,J)}loadDEMTile(V,$,J){const ue=this.enableTerrain?o.extend({buildQuadTree:this.terrain},$):$;this.getDEMWorkerSource(V,$.source).loadTile(ue,J)}reloadTile(V,$,J){const ue=this.enableTerrain?o.extend({enableTerrain:this.terrain},$):$;ue.projection=this.projections[V]||this.defaultProjection,this.getWorkerSource(V,$.type,$.source).reloadTile(ue,J)}abortTile(V,$,J){this.getWorkerSource(V,$.type,$.source).abortTile($,J)}removeTile(V,$,J){this.getWorkerSource(V,$.type,$.source).removeTile($,J)}removeSource(V,$,J){if(!this.workerSources[V]||!this.workerSources[V][$.type]||!this.workerSources[V][$.type][$.source])return;const ue=this.workerSources[V][$.type][$.source];delete this.workerSources[V][$.type][$.source],ue.removeSource!==void 0?ue.removeSource($,J):J()}loadWorkerSource(V,$,J){try{this.self.importScripts($.url),J()}catch(ue){J(ue.toString())}}syncRTLPluginState(V,$,J){try{o.plugin.setState($);const ue=o.plugin.getPluginURL();if(o.plugin.isLoaded()&&!o.plugin.isParsed()&&ue!=null){this.self.importScripts(ue);const Se=o.plugin.isParsed();J(Se?void 0:new Error(`RTL Text Plugin failed to import scripts from ${ue}`),Se)}}catch(ue){J(ue.toString())}}getAvailableImages(V){let $=this.availableImages[V];return $||($=[]),$}getLayerIndex(V){let $=this.layerIndexes[V];return $||($=this.layerIndexes[V]=new I),$}getWorkerSource(V,$,J){if(this.workerSources[V]||(this.workerSources[V]={}),this.workerSources[V][$]||(this.workerSources[V][$]={}),!this.workerSources[V][$][J]){const ue={send:(Se,Oe,ze,Ae,Ne,ht)=>{this.actor.send(Se,Oe,ze,V,Ne,ht)},scheduler:this.actor.scheduler};this.workerSources[V][$][J]=new this.workerSourceTypes[$](ue,this.getLayerIndex(V),this.getAvailableImages(V),this.isSpriteLoaded[V])}return this.workerSources[V][$][J]}getDEMWorkerSource(V,$){return this.demWorkerSources[V]||(this.demWorkerSources[V]={}),this.demWorkerSources[V][$]||(this.demWorkerSources[V][$]=new L),this.demWorkerSources[V][$]}enforceCacheSizeLimit(V,$){o.enforceCacheSizeLimit($)}getWorkerPerformanceMetrics(V,$,J){J(void 0,void 0)}}return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new kn(self)),kn}),v(["./shared"],function(o){function S(h,r){if(Array.isArray(h)){if(!Array.isArray(r)||h.length!==r.length)return!1;for(let l=0;l<h.length;l++)if(!S(h[l],r[l]))return!1;return!0}if(typeof h=="object"&&h!==null&&r!==null){if(typeof r!="object"||Object.keys(h).length!==Object.keys(r).length)return!1;for(const l in h)if(!S(h[l],r[l]))return!1;return!0}return h===r}var k=I;function I(h){return!function(r){return typeof window>"u"||typeof document>"u"?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var p,_,x=new Blob([""],{type:"text/javascript"}),T=URL.createObjectURL(x);try{_=new Worker(T),p=!0}catch{p=!1}return _&&_.terminate(),URL.revokeObjectURL(T),p}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var p=document.createElement("canvas");p.width=p.height=1;var _=p.getContext("2d");if(!_)return!1;var x=_.getImageData(0,0,1,1);return x&&x.width===p.width}()?(L[l=r&&r.failIfMajorPerformanceCaveat]===void 0&&(L[l]=function(p){var _,x=function(T){var C=document.createElement("canvas"),M=Object.create(I.webGLContextAttributes);return M.failIfMajorPerformanceCaveat=T,C.getContext("webgl",M)||C.getContext("experimental-webgl",M)}(p);if(!x)return!1;try{_=x.createShader(x.VERTEX_SHADER)}catch{return!1}return!(!_||x.isContextLost())&&(x.shaderSource(_,"void main() {}"),x.compileShader(_),x.getShaderParameter(_,x.COMPILE_STATUS)===!0)}(l)),L[l]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var l}(h)}var L={};function D(h,r,l){const p=o.window.document.createElement(h);return r!==void 0&&(p.className=r),l&&l.appendChild(p),p}function N(h,r,l){const p=o.window.document.createElementNS("http://www.w3.org/2000/svg",h);for(const _ of Object.keys(r))p.setAttributeNS(null,_,r[_]);return l&&l.appendChild(p),p}I.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const j=o.window.document&&o.window.document.documentElement.style,Z=j&&j.userSelect!==void 0?"userSelect":"WebkitUserSelect";let K;function fe(){j&&Z&&(K=j[Z],j[Z]="none")}function te(){j&&Z&&(j[Z]=K)}function ve(h){h.preventDefault(),h.stopPropagation(),o.window.removeEventListener("click",ve,!0)}function Ce(){o.window.addEventListener("click",ve,!0),o.window.setTimeout(()=>{o.window.removeEventListener("click",ve,!0)},0)}function ce(h,r){const l=h.getBoundingClientRect();return Me(h,l,r)}function pe(h,r){const l=h.getBoundingClientRect(),p=[];for(let _=0;_<r.length;_++)p.push(Me(h,l,r[_]));return p}function Te(h){return o.window.InstallTrigger!==void 0&&h.button===2&&h.ctrlKey&&o.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:h.button}function Me(h,r,l){const p=h.offsetWidth===r.width?1:h.offsetWidth/r.width;return new o.pointGeometry((l.clientX-r.left)*p,(l.clientY-r.top)*p)}function Ie(h,r){var l=r[0],p=r[1],_=r[2],x=r[3],T=l*x-_*p;return T?(h[0]=x*(T=1/T),h[1]=-p*T,h[2]=-_*T,h[3]=l*T,h):null}function ke(h){const{userImage:r}=h;return!!(r&&r.render&&r.render())&&(h.data.replace(new Uint8Array(r.data.buffer)),!0)}class Be extends o.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new o.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(r){if(this.loaded!==r&&(this.loaded=r,r)){for(const{ids:l,callback:p}of this.requestors)this._notify(l,p);this.requestors=[]}}hasImage(r){return!!this.getImage(r)}getImage(r){return this.images[r]}addImage(r,l){this._validate(r,l)&&(this.images[r]=l)}_validate(r,l){let p=!0;return this._validateStretch(l.stretchX,l.data&&l.data.width)||(this.fire(new o.ErrorEvent(new Error(`Image "${r}" has invalid "stretchX" value`))),p=!1),this._validateStretch(l.stretchY,l.data&&l.data.height)||(this.fire(new o.ErrorEvent(new Error(`Image "${r}" has invalid "stretchY" value`))),p=!1),this._validateContent(l.content,l)||(this.fire(new o.ErrorEvent(new Error(`Image "${r}" has invalid "content" value`))),p=!1),p}_validateStretch(r,l){if(!r)return!0;let p=0;for(const _ of r){if(_[0]<p||_[1]<_[0]||l<_[1])return!1;p=_[1]}return!0}_validateContent(r,l){return!(r&&(r.length!==4||r[0]<0||l.data.width<r[0]||r[1]<0||l.data.height<r[1]||r[2]<0||l.data.width<r[2]||r[3]<0||l.data.height<r[3]||r[2]<r[0]||r[3]<r[1]))}updateImage(r,l){l.version=this.images[r].version+1,this.images[r]=l,this.updatedImages[r]=!0}removeImage(r){const l=this.images[r];delete this.images[r],delete this.patterns[r],l.userImage&&l.userImage.onRemove&&l.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(r,l){let p=!0;if(!this.isLoaded())for(const _ of r)this.images[_]||(p=!1);this.isLoaded()||p?this._notify(r,l):this.requestors.push({ids:r,callback:l})}_notify(r,l){const p={};for(const _ of r){this.images[_]||this.fire(new o.Event("styleimagemissing",{id:_}));const x=this.images[_];x?p[_]={data:x.data.clone(),pixelRatio:x.pixelRatio,sdf:x.sdf,version:x.version,stretchX:x.stretchX,stretchY:x.stretchY,content:x.content,hasRenderCallback:Boolean(x.userImage&&x.userImage.render)}:o.warnOnce(`Image "${_}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}l(null,p)}getPixelSize(){const{width:r,height:l}=this.atlasImage;return{width:r,height:l}}getPattern(r){const l=this.patterns[r],p=this.getImage(r);if(!p)return null;if(l&&l.position.version===p.version)return l.position;if(l)l.position.version=p.version;else{const _={w:p.data.width+2,h:p.data.height+2,x:0,y:0},x=new o.ImagePosition(_,p);this.patterns[r]={bin:_,position:x}}return this._updatePatternAtlas(),this.patterns[r].position}bind(r){const l=r.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new o.Texture(r,this.atlasImage,l.RGBA),this.atlasTexture.bind(l.LINEAR,l.CLAMP_TO_EDGE)}_updatePatternAtlas(){const r=[];for(const x in this.patterns)r.push(this.patterns[x].bin);const{w:l,h:p}=o.potpack(r),_=this.atlasImage;_.resize({width:l||1,height:p||1});for(const x in this.patterns){const{bin:T}=this.patterns[x],C=T.x+1,M=T.y+1,O=this.images[x].data,R=O.width,U=O.height;o.RGBAImage.copy(O,_,{x:0,y:0},{x:C,y:M},{width:R,height:U}),o.RGBAImage.copy(O,_,{x:0,y:U-1},{x:C,y:M-1},{width:R,height:1}),o.RGBAImage.copy(O,_,{x:0,y:0},{x:C,y:M+U},{width:R,height:1}),o.RGBAImage.copy(O,_,{x:R-1,y:0},{x:C-1,y:M},{width:1,height:U}),o.RGBAImage.copy(O,_,{x:0,y:0},{x:C+R,y:M},{width:1,height:U})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(r){for(const l of r){if(this.callbackDispatchedThisFrame[l])continue;this.callbackDispatchedThisFrame[l]=!0;const p=this.images[l];ke(p)&&this.updateImage(l,p)}}}const Re=new o.Properties({anchor:new o.DataConstantProperty(o.spec.light.anchor),position:new class{constructor(){this.specification=o.spec.light.position}possiblyEvaluate(h,r){return function([l,p,_]){const x=o.degToRad(p+90),T=o.degToRad(_);return{x:l*Math.cos(x)*Math.sin(T),y:l*Math.sin(x)*Math.sin(T),z:l*Math.cos(T),azimuthal:p,polar:_}}(h.expression.evaluate(r))}interpolate(h,r,l){return{x:o.number(h.x,r.x,l),y:o.number(h.y,r.y,l),z:o.number(h.z,r.z,l),azimuthal:o.number(h.azimuthal,r.azimuthal,l),polar:o.number(h.polar,r.polar,l)}}},color:new o.DataConstantProperty(o.spec.light.color),intensity:new o.DataConstantProperty(o.spec.light.intensity)}),Ze="-transition";class Ye extends o.Evented{constructor(r){super(),this._transitionable=new o.Transitionable(Re),this.setLight(r),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(r,l={}){if(!this._validate(o.validateLight,r,l))for(const p in r){const _=r[p];o.endsWith(p,Ze)?this._transitionable.setTransition(p.slice(0,-Ze.length),_):this._transitionable.setValue(p,_)}}updateTransitions(r){this._transitioning=this._transitionable.transitioned(r,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(r){this.properties=this._transitioning.possiblyEvaluate(r)}_validate(r,l,p){return(!p||p.validate!==!1)&&o.emitValidationErrors(this,r.call(o.validateStyle,o.extend({value:l,style:{glyphs:!0,sprite:!0},styleSpec:o.spec})))}}const lt=new o.Properties({source:new o.DataConstantProperty(o.spec.terrain.source),exaggeration:new o.DataConstantProperty(o.spec.terrain.exaggeration)}),Xt="-transition";class Ge extends o.Evented{constructor(r,l){super(),this._transitionable=new o.Transitionable(lt),this.set(r),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=l}get(){return this._transitionable.serialize()}set(r){for(const l in r){const p=r[l];o.endsWith(l,Xt)?this._transitionable.setTransition(l.slice(0,-Xt.length),p):this._transitionable.setValue(l,p)}}updateTransitions(r){this._transitioning=this._transitionable.transitioned(r,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(r){this.properties=this._transitioning.possiblyEvaluate(r)}}function At(h,r,l,p){const _=o.smoothstep(45,65,l),[x,T]=tn(h,p),C=o.length(r);let M=1-Math.min(1,Math.exp((C-x)/(T-x)*-6));return M*=M*M,M=Math.min(1,1.00747*M),M*_*h.alpha}function tn(h,r){const l=.5/Math.tan(.5*r);return[h.range[0]+l,h.range[1]+l]}const Ve=new o.Properties({range:new o.DataConstantProperty(o.spec.fog.range),color:new o.DataConstantProperty(o.spec.fog.color),"high-color":new o.DataConstantProperty(o.spec.fog["high-color"]),"space-color":new o.DataConstantProperty(o.spec.fog["space-color"]),"horizon-blend":new o.DataConstantProperty(o.spec.fog["horizon-blend"]),"star-intensity":new o.DataConstantProperty(o.spec.fog["star-intensity"])}),mt="-transition";class Bt extends o.Evented{constructor(r,l){super(),this._transitionable=new o.Transitionable(Ve),this.set(r),this._transitioning=this._transitionable.untransitioned(),this._transform=l}get state(){const r=this._transform,l=r.projection.name==="globe",p=o.globeToMercatorTransition(r.zoom),_=this.properties.get("range"),x=[.5,3];return{range:l?[o.number(x[0],_[0],p),o.number(x[1],_[1],p)]:_,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(r,l={}){if(!this._validate(o.validateFog,r,l)){for(const p of Object.keys(o.spec.fog))r&&r[p]===void 0&&(r[p]=o.spec.fog[p].default);for(const p in r){const _=r[p];o.endsWith(p,mt)?this._transitionable.setTransition(p.slice(0,-mt.length),_):this._transitionable.setValue(p,_)}}}getOpacity(r){if(!this._transform.projection.supportsFog)return 0;const l=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:o.smoothstep(45,65,r))*l.a}getOpacityAtLatLng(r,l){return this._transform.projection.supportsFog?function(p,_,x){const T=o.MercatorCoordinate.fromLngLat(_),C=x.elevation?x.elevation.getAtPointOrZero(T):0,M=[T.x,T.y,C];return o.transformMat4(M,M,x.mercatorFogMatrix),At(p,M,x.pitch,x._fov)}(this.state,r,l):0}getFovAdjustedRange(r){return this._transform.projection.supportsFog?tn(this.state,r):[0,1]}updateTransitions(r){this._transitioning=this._transitionable.transitioned(r,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(r){this.properties=this._transitioning.possiblyEvaluate(r)}_validate(r,l,p){return(!p||p.validate!==!1)&&o.emitValidationErrors(this,r.call(o.validateStyle,o.extend({value:l,style:{glyphs:!0,sprite:!0},styleSpec:o.spec})))}}class jt{constructor(r,l){this.workerPool=r,this.actors=[],this.currentActor=0,this.id=o.uniqueId();const p=this.workerPool.acquire(this.id);for(let _=0;_<p.length;_++){const x=new jt.Actor(p[_],l,this.id);x.name=`Worker ${_}`,this.actors.push(x)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(r,l,p){o.asyncAll(this.actors,(_,x)=>{_.send(r,l,x)},p=p||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(r=>{r.remove()}),this.actors=[],this.workerPool.release(this.id)}}function xn(h,r,l){return r*(o.EXTENT/(h.tileSize*Math.pow(2,l-h.tileID.overscaledZ)))}jt.Actor=o.Actor;class rt{constructor(r,l,p,_){this.screenBounds=r,this.cameraPoint=l,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=p,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,_)}static createFromScreenPoints(r,l){let p,_;if(r instanceof o.pointGeometry||typeof r[0]=="number"){const x=o.pointGeometry.convert(r);p=[x],_=l.isPointAboveHorizon(x)}else{const x=o.pointGeometry.convert(r[0]),T=o.pointGeometry.convert(r[1]);p=[x,T],_=o.polygonizeBounds(x,T).every(C=>l.isPointAboveHorizon(C))}return new rt(p,l.getCameraPoint(),_,l)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(r){return o.polygonizeBounds(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],r)}bufferedCameraGeometry(r){const l=this.screenBounds[0],p=this.screenBounds.length===1?this.screenBounds[0].add(new o.pointGeometry(1,1)):this.screenBounds[1],_=o.polygonizeBounds(l,p,0,!1);return this.cameraPoint.y>p.y&&(this.cameraPoint.x>l.x&&this.cameraPoint.x<p.x?_.splice(3,0,this.cameraPoint):this.cameraPoint.x>=p.x?_[2]=this.cameraPoint:this.cameraPoint.x<=l.x&&(_[3]=this.cameraPoint)),o.bufferConvexPolygon(_,r)}bufferedCameraGeometryGlobe(r){const l=this.screenBounds[0],p=this.screenBounds.length===1?this.screenBounds[0].add(new o.pointGeometry(1,1)):this.screenBounds[1],_=o.polygonizeBounds(l,p,r),x=this.cameraPoint.clone();switch(3*((x.y>l.y)+(x.y>p.y))+((x.x>l.x)+(x.x>p.x))){case 0:_[0]=x,_[4]=x.clone();break;case 1:_.splice(1,0,x);break;case 2:_[1]=x;break;case 3:_.splice(4,0,x);break;case 5:_.splice(2,0,x);break;case 6:_[3]=x;break;case 7:_.splice(3,0,x);break;case 8:_[2]=x}return _}containsTile(r,l,p,_=0){const x=r.queryPadding/l._pixelsPerMercatorPixel+1,T=p?this._bufferedCameraMercator(x,l):this._bufferedScreenMercator(x,l);let C=r.tileID.wrap+(T.unwrapped?_:0);const M=T.polygon.map(H=>o.getTilePoint(r.tileTransform,H,C));if(!o.polygonIntersectsBox(M,0,0,o.EXTENT,o.EXTENT))return;C=r.tileID.wrap+(this.screenGeometryMercator.unwrapped?_:0);const O=this.screenGeometryMercator.polygon.map(H=>o.getTileVec3(r.tileTransform,H,C)),R=O.map(H=>new o.pointGeometry(H[0],H[1])),U=l.getFreeCameraOptions().position||new o.MercatorCoordinate(0,0,0),G=o.getTileVec3(r.tileTransform,U,C),ee=O.map(H=>{const X=o.sub(H,H,G);return o.normalize(X,X),new o.Ray(G,X)}),Q=xn(r,1,l.zoom)*l._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:R,tilespaceRays:ee,bufferedTilespaceGeometry:M,bufferedTilespaceBounds:(ne=o.getBounds(M),ne.min.x=o.clamp(ne.min.x,0,o.EXTENT),ne.min.y=o.clamp(ne.min.y,0,o.EXTENT),ne.max.x=o.clamp(ne.max.x,0,o.EXTENT),ne.max.y=o.clamp(ne.max.y,0,o.EXTENT),ne),tile:r,tileID:r.tileID,pixelToTileUnitsFactor:Q};var ne}_bufferedScreenMercator(r,l){const p=_t(r);if(this._screenRaycastCache[p])return this._screenRaycastCache[p];{let _;return _=l.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(r),l):{polygon:this.bufferedScreenGeometry(r).map(x=>l.pointCoordinate3D(x)),unwrapped:!0},this._screenRaycastCache[p]=_,_}}_bufferedCameraMercator(r,l){const p=_t(r);if(this._cameraRaycastCache[p])return this._cameraRaycastCache[p];{let _;return _=l.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(r),l):{polygon:this.bufferedCameraGeometry(r).map(x=>l.pointCoordinate3D(x)),unwrapped:!0},this._cameraRaycastCache[p]=_,_}}_projectAndResample(r,l){const p=function(x,T){const C=o.multiply([],T.pixelMatrix,T.globeMatrix),M=[0,-o.GLOBE_RADIUS,0,1],O=[0,o.GLOBE_RADIUS,0,1],R=[0,0,0,1];o.transformMat4$1(M,M,C),o.transformMat4$1(O,O,C),o.transformMat4$1(R,R,C);const U=new o.pointGeometry(M[0]/M[3],M[1]/M[3]),G=new o.pointGeometry(O[0]/O[3],O[1]/O[3]),ee=o.polygonContainsPoint(x,U)&&M[3]<R[3],Q=o.polygonContainsPoint(x,G)&&O[3]<R[3];if(!ee&&!Q)return null;const ne=function(Pe,We,je){for(let Le=1;Le<Pe.length;Le++){const It=ot(We.pointCoordinate3D(Pe[Le-1]).x),Ue=ot(We.pointCoordinate3D(Pe[Le]).x);if(je<0){if(It<Ue)return{idx:Le,t:-It/(Ue-1-It)}}else if(Ue<It)return{idx:Le,t:(1-It)/(Ue+1-It)}}return null}(x,T,ee?-1:1);if(!ne)return null;const{idx:H,t:X}=ne;let re=H>1?gt(x.slice(0,H),T):[],ie=H<x.length?gt(x.slice(H),T):[];re=re.map(Pe=>new o.pointGeometry(ot(Pe.x),Pe.y)),ie=ie.map(Pe=>new o.pointGeometry(ot(Pe.x),Pe.y));const he=[...re];he.length===0&&he.push(ie[ie.length-1]);const Ee=o.number(he[he.length-1].y,(ie.length===0?re[0]:ie[0]).y,X);let xe;return xe=ee?[new o.pointGeometry(0,Ee),new o.pointGeometry(0,0),new o.pointGeometry(1,0),new o.pointGeometry(1,Ee)]:[new o.pointGeometry(1,Ee),new o.pointGeometry(1,1),new o.pointGeometry(0,1),new o.pointGeometry(0,Ee)],he.push(...xe),ie.length===0?he.push(re[0]):he.push(...ie),{polygon:he.map(Pe=>new o.MercatorCoordinate(Pe.x,Pe.y)),unwrapped:!1}}(r,l);if(p)return p;const _=function(x,T){let C=!1,M=-1/0,O=0;for(let U=0;U<x.length-1;U++)x[U].x>M&&(M=x[U].x,O=U);for(let U=0;U<x.length-1;U++){const G=(O+U)%(x.length-1),ee=x[G],Q=x[G+1];Math.abs(ee.x-Q.x)>.5&&(ee.x<Q.x?(ee.x+=1,G===0&&(x[x.length-1].x+=1)):(Q.x+=1,G+1===x.length-1&&(x[0].x+=1)),C=!0)}const R=o.mercatorXfromLng(T.center.lng);return C&&R<Math.abs(R-1)&&x.forEach(U=>{U.x-=1}),{polygon:x,unwrapped:C}}(gt(r,l).map(x=>new o.pointGeometry(ot(x.x),x.y)),l);return{polygon:_.polygon.map(x=>new o.MercatorCoordinate(x.x,x.y)),unwrapped:_.unwrapped}}}function gt(h,r){return o.resample(h,l=>{const p=r.pointCoordinate3D(l);l.x=p.x,l.y=p.y},1/256)}function ot(h){return h<0?1+h%1:h%1}function _t(h){return 100*h|0}function ft(h,r,l,p,_){const x=function(T,C){if(T)return _(T);if(C){h.url&&C.tiles&&h.tiles&&delete h.tiles;const M=o.pick(o.extend(C,h),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);C.vector_layers&&(M.vectorLayers=C.vector_layers,M.vectorLayerIds=M.vectorLayers.map(O=>O.id)),M.tiles=r.canonicalizeTileset(M,h.url),_(null,M)}};return h.url?o.getJSON(r.transformRequest(r.normalizeSourceURL(h.url,null,l,p),o.ResourceType.Source),x):o.exported.frame(()=>x(null,h))}class sn{constructor(r,l,p){this.bounds=o.LngLatBounds.convert(this.validateBounds(r)),this.minzoom=l||0,this.maxzoom=p||24}validateBounds(r){return Array.isArray(r)&&r.length===4?[Math.max(-180,r[0]),Math.max(-90,r[1]),Math.min(180,r[2]),Math.min(90,r[3])]:[-180,-90,180,90]}contains(r){const l=Math.pow(2,r.z),p=Math.floor(o.mercatorXfromLng(this.bounds.getWest())*l),_=Math.floor(o.mercatorYfromLat(this.bounds.getNorth())*l),x=Math.ceil(o.mercatorXfromLng(this.bounds.getEast())*l),T=Math.ceil(o.mercatorYfromLat(this.bounds.getSouth())*l);return r.x>=p&&r.x<x&&r.y>=_&&r.y<T}}class un{constructor(r,l,p){this.context=r;const _=r.gl;this.buffer=_.createBuffer(),this.dynamicDraw=Boolean(p),this.context.unbindVAO(),r.bindElementBuffer.set(this.buffer),_.bufferData(_.ELEMENT_ARRAY_BUFFER,l.arrayBuffer,this.dynamicDraw?_.DYNAMIC_DRAW:_.STATIC_DRAW),this.dynamicDraw||l.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(r){const l=this.context.gl;this.context.unbindVAO(),this.bind(),l.bufferSubData(l.ELEMENT_ARRAY_BUFFER,0,r.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const oe={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class be{constructor(r,l,p,_){this.length=l.length,this.attributes=p,this.itemSize=l.bytesPerElement,this.dynamicDraw=_,this.context=r;const x=r.gl;this.buffer=x.createBuffer(),r.bindVertexBuffer.set(this.buffer),x.bufferData(x.ARRAY_BUFFER,l.arrayBuffer,this.dynamicDraw?x.DYNAMIC_DRAW:x.STATIC_DRAW),this.dynamicDraw||l.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(r){const l=this.context.gl;this.bind(),l.bufferSubData(l.ARRAY_BUFFER,0,r.arrayBuffer)}enableAttributes(r,l){for(let p=0;p<this.attributes.length;p++){const _=l.attributes[this.attributes[p].name];_!==void 0&&r.enableVertexAttribArray(_)}}setVertexAttribPointers(r,l,p){for(let _=0;_<this.attributes.length;_++){const x=this.attributes[_],T=l.attributes[x.name];T!==void 0&&r.vertexAttribPointer(T,x.components,r[oe[x.type]],!1,this.itemSize,x.offset+this.itemSize*(p||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Fe{constructor(r){this.gl=r.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(r){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class nt extends Fe{getDefault(){return o.Color.transparent}set(r){const l=this.current;(r.r!==l.r||r.g!==l.g||r.b!==l.b||r.a!==l.a||this.dirty)&&(this.gl.clearColor(r.r,r.g,r.b,r.a),this.current=r,this.dirty=!1)}}class yt extends Fe{getDefault(){return 1}set(r){(r!==this.current||this.dirty)&&(this.gl.clearDepth(r),this.current=r,this.dirty=!1)}}class zt extends Fe{getDefault(){return 0}set(r){(r!==this.current||this.dirty)&&(this.gl.clearStencil(r),this.current=r,this.dirty=!1)}}class Nt extends Fe{getDefault(){return[!0,!0,!0,!0]}set(r){const l=this.current;(r[0]!==l[0]||r[1]!==l[1]||r[2]!==l[2]||r[3]!==l[3]||this.dirty)&&(this.gl.colorMask(r[0],r[1],r[2],r[3]),this.current=r,this.dirty=!1)}}class kt extends Fe{getDefault(){return!0}set(r){(r!==this.current||this.dirty)&&(this.gl.depthMask(r),this.current=r,this.dirty=!1)}}class bt extends Fe{getDefault(){return 255}set(r){(r!==this.current||this.dirty)&&(this.gl.stencilMask(r),this.current=r,this.dirty=!1)}}class Mt extends Fe{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(r){const l=this.current;(r.func!==l.func||r.ref!==l.ref||r.mask!==l.mask||this.dirty)&&(this.gl.stencilFunc(r.func,r.ref,r.mask),this.current=r,this.dirty=!1)}}class Wt extends Fe{getDefault(){const r=this.gl;return[r.KEEP,r.KEEP,r.KEEP]}set(r){const l=this.current;(r[0]!==l[0]||r[1]!==l[1]||r[2]!==l[2]||this.dirty)&&(this.gl.stencilOp(r[0],r[1],r[2]),this.current=r,this.dirty=!1)}}class et extends Fe{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const l=this.gl;r?l.enable(l.STENCIL_TEST):l.disable(l.STENCIL_TEST),this.current=r,this.dirty=!1}}class Rt extends Fe{getDefault(){return[0,1]}set(r){const l=this.current;(r[0]!==l[0]||r[1]!==l[1]||this.dirty)&&(this.gl.depthRange(r[0],r[1]),this.current=r,this.dirty=!1)}}class nn extends Fe{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const l=this.gl;r?l.enable(l.DEPTH_TEST):l.disable(l.DEPTH_TEST),this.current=r,this.dirty=!1}}class bn extends Fe{getDefault(){return this.gl.LESS}set(r){(r!==this.current||this.dirty)&&(this.gl.depthFunc(r),this.current=r,this.dirty=!1)}}class Ln extends Fe{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const l=this.gl;r?l.enable(l.BLEND):l.disable(l.BLEND),this.current=r,this.dirty=!1}}class An extends Fe{getDefault(){const r=this.gl;return[r.ONE,r.ZERO]}set(r){const l=this.current;(r[0]!==l[0]||r[1]!==l[1]||this.dirty)&&(this.gl.blendFunc(r[0],r[1]),this.current=r,this.dirty=!1)}}class qn extends Fe{getDefault(){return o.Color.transparent}set(r){const l=this.current;(r.r!==l.r||r.g!==l.g||r.b!==l.b||r.a!==l.a||this.dirty)&&(this.gl.blendColor(r.r,r.g,r.b,r.a),this.current=r,this.dirty=!1)}}class Hn extends Fe{getDefault(){return this.gl.FUNC_ADD}set(r){(r!==this.current||this.dirty)&&(this.gl.blendEquation(r),this.current=r,this.dirty=!1)}}class Bi extends Fe{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const l=this.gl;r?l.enable(l.CULL_FACE):l.disable(l.CULL_FACE),this.current=r,this.dirty=!1}}class ji extends Fe{getDefault(){return this.gl.BACK}set(r){(r!==this.current||this.dirty)&&(this.gl.cullFace(r),this.current=r,this.dirty=!1)}}class qi extends Fe{getDefault(){return this.gl.CCW}set(r){(r!==this.current||this.dirty)&&(this.gl.frontFace(r),this.current=r,this.dirty=!1)}}class tr extends Fe{getDefault(){return null}set(r){(r!==this.current||this.dirty)&&(this.gl.useProgram(r),this.current=r,this.dirty=!1)}}class Ei extends Fe{getDefault(){return this.gl.TEXTURE0}set(r){(r!==this.current||this.dirty)&&(this.gl.activeTexture(r),this.current=r,this.dirty=!1)}}class $i extends Fe{getDefault(){const r=this.gl;return[0,0,r.drawingBufferWidth,r.drawingBufferHeight]}set(r){const l=this.current;(r[0]!==l[0]||r[1]!==l[1]||r[2]!==l[2]||r[3]!==l[3]||this.dirty)&&(this.gl.viewport(r[0],r[1],r[2],r[3]),this.current=r,this.dirty=!1)}}class hr extends Fe{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const l=this.gl;l.bindFramebuffer(l.FRAMEBUFFER,r),this.current=r,this.dirty=!1}}class Mr extends Fe{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const l=this.gl;l.bindRenderbuffer(l.RENDERBUFFER,r),this.current=r,this.dirty=!1}}class Ir extends Fe{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const l=this.gl;l.bindTexture(l.TEXTURE_2D,r),this.current=r,this.dirty=!1}}class mo extends Fe{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const l=this.gl;l.bindBuffer(l.ARRAY_BUFFER,r),this.current=r,this.dirty=!1}}class vr extends Fe{getDefault(){return null}set(r){const l=this.gl;l.bindBuffer(l.ELEMENT_ARRAY_BUFFER,r),this.current=r,this.dirty=!1}}class so extends Fe{constructor(r){super(r),this.vao=r.extVertexArrayObject}getDefault(){return null}set(r){this.vao&&(r!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(r),this.current=r,this.dirty=!1)}}class ns extends Fe{getDefault(){return 4}set(r){if(r===this.current&&!this.dirty)return;const l=this.gl;l.pixelStorei(l.UNPACK_ALIGNMENT,r),this.current=r,this.dirty=!1}}class ao extends Fe{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const l=this.gl;l.pixelStorei(l.UNPACK_PREMULTIPLY_ALPHA_WEBGL,r),this.current=r,this.dirty=!1}}class ct extends Fe{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const l=this.gl;l.pixelStorei(l.UNPACK_FLIP_Y_WEBGL,r),this.current=r,this.dirty=!1}}class Kt extends Fe{constructor(r,l){super(r),this.context=r,this.parent=l}getDefault(){return null}}class hn extends Kt{setDirty(){this.dirty=!0}set(r){if(r===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const l=this.gl;l.framebufferTexture2D(l.FRAMEBUFFER,l.COLOR_ATTACHMENT0,l.TEXTURE_2D,r,0),this.current=r,this.dirty=!1}}class En extends Kt{attachment(){return this.gl.DEPTH_ATTACHMENT}set(r){if(r===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const l=this.gl;l.framebufferRenderbuffer(l.FRAMEBUFFER,this.attachment(),l.RENDERBUFFER,r),this.current=r,this.dirty=!1}}class kn extends En{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class Y{constructor(r,l,p,_){this.context=r,this.width=l,this.height=p;const x=this.framebuffer=r.gl.createFramebuffer();this.colorAttachment=new hn(r,x),_&&(this.depthAttachment=new En(r,x))}destroy(){const r=this.context.gl,l=this.colorAttachment.get();if(l&&r.deleteTexture(l),this.depthAttachment){const p=this.depthAttachment.get();p&&r.deleteRenderbuffer(p)}r.deleteFramebuffer(this.framebuffer)}}class V{constructor(r){this.gl=r,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new nt(this),this.clearDepth=new yt(this),this.clearStencil=new zt(this),this.colorMask=new Nt(this),this.depthMask=new kt(this),this.stencilMask=new bt(this),this.stencilFunc=new Mt(this),this.stencilOp=new Wt(this),this.stencilTest=new et(this),this.depthRange=new Rt(this),this.depthTest=new nn(this),this.depthFunc=new bn(this),this.blend=new Ln(this),this.blendFunc=new An(this),this.blendColor=new qn(this),this.blendEquation=new Hn(this),this.cullFace=new Bi(this),this.cullFaceSide=new ji(this),this.frontFace=new qi(this),this.program=new tr(this),this.activeTexture=new Ei(this),this.viewport=new $i(this),this.bindFramebuffer=new hr(this),this.bindRenderbuffer=new Mr(this),this.bindTexture=new Ir(this),this.bindVertexBuffer=new mo(this),this.bindElementBuffer=new vr(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new so(this),this.pixelStoreUnpack=new ns(this),this.pixelStoreUnpackPremultiplyAlpha=new ao(this),this.pixelStoreUnpackFlipY=new ct(this),this.extTextureFilterAnisotropic=r.getExtension("EXT_texture_filter_anisotropic")||r.getExtension("MOZ_EXT_texture_filter_anisotropic")||r.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=r.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureFilterAnisotropicForceOff=!1,this.extStandardDerivativesForceOff=!1,this.extDebugRendererInfo=r.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=r.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=r.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.extTextureHalfFloat=r.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(r.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=r.getExtension("EXT_color_buffer_half_float")),this.extStandardDerivatives=r.getExtension("OES_standard_derivatives"),this.extTimerQuery=r.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=r.getParameter(r.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(r,l){return new un(this,r,l)}createVertexBuffer(r,l,p){return new be(this,r,l,p)}createRenderbuffer(r,l,p){const _=this.gl,x=_.createRenderbuffer();return this.bindRenderbuffer.set(x),_.renderbufferStorage(_.RENDERBUFFER,r,l,p),this.bindRenderbuffer.set(null),x}createFramebuffer(r,l,p){return new Y(this,r,l,p)}clear({color:r,depth:l,stencil:p}){const _=this.gl;let x=0;r&&(x|=_.COLOR_BUFFER_BIT,this.clearColor.set(r),this.colorMask.set([!0,!0,!0,!0])),l!==void 0&&(x|=_.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(l),this.depthMask.set(!0)),p!==void 0&&(x|=_.STENCIL_BUFFER_BIT,this.clearStencil.set(p),this.stencilMask.set(255)),_.clear(x)}setCullFace(r){r.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(r.mode),this.frontFace.set(r.frontFace))}setDepthMode(r){r.func!==this.gl.ALWAYS||r.mask?(this.depthTest.set(!0),this.depthFunc.set(r.func),this.depthMask.set(r.mask),this.depthRange.set(r.range)):this.depthTest.set(!1)}setStencilMode(r){r.test.func!==this.gl.ALWAYS||r.mask?(this.stencilTest.set(!0),this.stencilMask.set(r.mask),this.stencilOp.set([r.fail,r.depthFail,r.pass]),this.stencilFunc.set({func:r.test.func,ref:r.ref,mask:r.test.mask})):this.stencilTest.set(!1)}setColorMode(r){S(r.blendFunction,o.ColorMode.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(r.blendFunction),this.blendColor.set(r.blendColor)),this.colorMask.set(r.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class $ extends o.Evented{constructor(r,l,p,_){super(),this.id=r,this.dispatcher=p,this.setEventedParent(_),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=o.extend({type:"raster"},l),o.extend(this,o.pick(l,["url","scheme","tileSize"]))}load(){this._loaded=!1,this.fire(new o.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=ft(this._options,this.map._requestManager,null,null,(r,l)=>{this._tileJSONRequest=null,this._loaded=!0,r?this.fire(new o.ErrorEvent(r)):l&&(o.extend(this,l),l.bounds&&(this.tileBounds=new sn(l.bounds,this.minzoom,this.maxzoom)),o.postTurnstileEvent(l.tiles),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}onAdd(r){this.map=r,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return o.extend({},this._options)}hasTile(r){return!this.tileBounds||this.tileBounds.contains(r.canonical)}loadTile(r,l){const p=o.exported.devicePixelRatio>=2,_=this.map._requestManager.normalizeTileURL(r.tileID.canonical.url(this.tiles,this.scheme),p,this.tileSize);r.request=o.getImage(this.map._requestManager.transformRequest(_,o.ResourceType.Tile),(x,T,C,M)=>(delete r.request,r.aborted?(r.state="unloaded",l(null)):x?(r.state="errored",l(x)):T?(this.map._refreshExpiredTiles&&r.setExpiryData({cacheControl:C,expires:M}),r.setTexture(T,this.map.painter),r.state="loaded",o.cacheEntryPossiblyAdded(this.dispatcher),void l(null)):l(null)))}static loadTileData(r,l,p){r.setTexture(l,p)}static unloadTileData(r,l){r.texture&&l.saveTileTexture(r.texture)}abortTile(r,l){r.request&&(r.request.cancel(),delete r.request),l()}unloadTile(r,l){r.texture&&this.map.painter.saveTileTexture(r.texture),l()}hasTransition(){return!1}}let J;function ue(h,r,l,p,_,x,T,C){const M=[h,l,_,r,p,x,1,1,1],O=[T,C,1],R=o.adjoint([],M),[U,G,ee]=o.transformMat3(O,O,o.transpose(R,R));return o.multiply$1(M,[U,0,0,0,G,0,0,0,ee],M)}class Se extends o.Evented{constructor(r,l,p,_){super(),this.id=r,this.dispatcher=p,this.coordinates=l.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(_),this.options=l,this._dirty=!1}load(r,l){this._loaded=l||!1,this.fire(new o.Event("dataloading",{dataType:"source"})),this.url=this.options.url,this._imageRequest=o.getImage(this.map._requestManager.transformRequest(this.url,o.ResourceType.Image),(p,_)=>{if(this._imageRequest=null,this._loaded=!0,p)this.fire(new o.ErrorEvent(p));else if(_){const{HTMLImageElement:x}=o.window;this.image=_ instanceof x?o.exported.getImageData(_):_,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,r&&(this.coordinates=r),this._finishLoading()}})}loaded(){return this._loaded}updateImage(r){return this.image&&r.url?(this._imageRequest&&r.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=r.url,this.load(r.coordinates,this._loaded),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(r){this.map=r,this.load()}onRemove(){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),this.texture&&this.texture.destroy()}setCoordinates(r){this.coordinates=r,this._boundsArray=void 0;const l=r.map(o.MercatorCoordinate.fromLngLat);return this.tileID=function(p){let _=1/0,x=1/0,T=-1/0,C=-1/0;for(const U of p)_=Math.min(_,U.x),x=Math.min(x,U.y),T=Math.max(T,U.x),C=Math.max(C,U.y);const M=Math.max(T-_,C-x),O=Math.max(0,Math.floor(-Math.log(M)/Math.LN2)),R=Math.pow(2,O);return new o.CanonicalTileID(O,Math.floor((_+T)/2*R),Math.floor((x+C)/2*R))}(l),this.minzoom=this.maxzoom=this.tileID.z,this.fire(new o.Event("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0}_prepareData(r){for(const M in this.tiles){const O=this.tiles[M];O.state!=="loaded"&&(O.state="loaded",O.texture=this.texture)}if(this._boundsArray)return;const l=o.tileTransform(this.tileID,this.map.transform.projection),[p,_,x,T]=this.coordinates.map(M=>{const O=l.projection.project(M[0],M[1]);return o.getTilePoint(l,O)._round()});this.perspectiveTransform=function(M,O,R,U,G,ee,Q,ne,H,X){const re=ue(0,0,M,0,0,O,M,O),ie=ue(R,U,G,ee,Q,ne,H,X);return o.multiply$1(ie,o.adjoint(re,re),ie),[ie[6]/ie[8]*M/o.EXTENT,ie[7]/ie[8]*O/o.EXTENT]}(this.width,this.height,p.x,p.y,_.x,_.y,T.x,T.y,x.x,x.y);const C=this._boundsArray=new o.StructArrayLayout4i8;C.emplaceBack(p.x,p.y,0,0),C.emplaceBack(_.x,_.y,o.EXTENT,0),C.emplaceBack(T.x,T.y,0,o.EXTENT),C.emplaceBack(x.x,x.y,o.EXTENT,o.EXTENT),this.boundsBuffer&&this.boundsBuffer.destroy(),this.boundsBuffer=r.createVertexBuffer(C,o.boundsAttributes.members),this.boundsSegments=o.SegmentVector.simpleSegment(0,0,4,2)}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const r=this.map.painter.context,l=r.gl;this._dirty&&(this.texture?this.texture.update(this.image):(this.texture=new o.Texture(r,this.image,l.RGBA),this.texture.bind(l.LINEAR,l.CLAMP_TO_EDGE)),this._dirty=!1),this._prepareData(r)}loadTile(r,l){this.tileID&&this.tileID.equals(r.tileID.canonical)?(this.tiles[String(r.tileID.wrap)]=r,r.buckets={},l(null)):(r.state="errored",l(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}const Oe={vector:class extends o.Evented{constructor(h,r,l,p){if(super(),this.id=h,this.dispatcher=l,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,o.extend(this,o.pick(r,["url","scheme","tileSize","promoteId"])),this._options=o.extend({type:"vector"},r),this._collectResourceTiming=r.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(p),this._tileWorkers={},this._deduped=new o.DedupedRequest}load(h){this._loaded=!1,this.fire(new o.Event("dataloading",{dataType:"source"}));const r=Array.isArray(this.map._language)?this.map._language.join():this.map._language,l=this.map._worldview;this._tileJSONRequest=ft(this._options,this.map._requestManager,r,l,(p,_)=>{this._tileJSONRequest=null,this._loaded=!0,p?(r&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${r}`),l&&l.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${l}`),this.fire(new o.ErrorEvent(p))):_&&(o.extend(this,_),_.bounds&&(this.tileBounds=new sn(_.bounds,this.minzoom,this.maxzoom)),o.postTurnstileEvent(_.tiles,this.map._requestManager._customAccessToken),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"content"}))),h&&h(p)})}loaded(){return this._loaded}hasTile(h){return!this.tileBounds||this.tileBounds.contains(h.canonical)}onAdd(h){this.map=h,this.load()}reload(){this.cancelTileJSONRequest(),this.load(()=>{const h=this.map.style._getSourceCaches(this.id);for(const r of h)r.clearTiles()})}setSourceProperty(h){h(),this.reload()}setTiles(h){return this._options.tiles=h,this.reload(),this}setUrl(h){return this.url=h,this._options.url=h,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return o.extend({},this._options)}loadTile(h,r){const l=this.map._requestManager.normalizeTileURL(h.tileID.canonical.url(this.tiles,this.scheme)),p={request:this.map._requestManager.transformRequest(l,o.ResourceType.Tile),data:void 0,uid:h.uid,tileID:h.tileID,tileZoom:h.tileZoom,zoom:h.tileID.overscaledZ,tileSize:this.tileSize*h.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:o.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:h.isSymbolTile};if(p.request.collectResourceTiming=this._collectResourceTiming,h.actor&&h.state!=="expired")h.state==="loading"?h.reloadCallback=r:h.request=h.actor.send("reloadTile",p,_.bind(this));else if(h.actor=this._tileWorkers[l]=this._tileWorkers[l]||this.dispatcher.getActor(),this.dispatcher.ready)h.request=h.actor.send("loadTile",p,_.bind(this),void 0,!0);else{const x=o.loadVectorTile.call({deduped:this._deduped},p,(T,C)=>{T||!C?_.call(this,T):(p.data={cacheControl:C.cacheControl,expires:C.expires,rawData:C.rawData.slice(0)},h.actor&&h.actor.send("loadTile",p,_.bind(this),void 0,!0))},!0);h.request={cancel:x}}function _(x,T){return delete h.request,h.aborted?r(null):x&&x.status!==404?r(x):(T&&T.resourceTiming&&(h.resourceTiming=T.resourceTiming),this.map._refreshExpiredTiles&&T&&h.setExpiryData(T),h.loadVectorData(T,this.map.painter),o.cacheEntryPossiblyAdded(this.dispatcher),r(null),void(h.reloadCallback&&(this.loadTile(h,h.reloadCallback),h.reloadCallback=null)))}}abortTile(h){h.request&&(h.request.cancel(),delete h.request),h.actor&&h.actor.send("abortTile",{uid:h.uid,type:this.type,source:this.id})}unloadTile(h){h.unloadVectorData(),h.actor&&h.actor.send("removeTile",{uid:h.uid,type:this.type,source:this.id})}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}},raster:$,"raster-dem":class extends ${constructor(h,r,l,p){super(h,r,l,p),this.type="raster-dem",this.maxzoom=22,this._options=o.extend({type:"raster-dem"},r),this.encoding=r.encoding||"mapbox"}loadTile(h,r){const l=this.map._requestManager.normalizeTileURL(h.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function p(_,x){_&&(h.state="errored",r(_)),x&&(h.dem=x,h.dem.onDeserialize(),h.needsHillshadePrepare=!0,h.needsDEMTextureUpload=!0,h.state="loaded",r(null))}h.request=o.getImage(this.map._requestManager.transformRequest(l,o.ResourceType.Tile),function(_,x,T,C){if(delete h.request,h.aborted)h.state="unloaded",r(null);else if(_)h.state="errored",r(_);else if(x){this.map._refreshExpiredTiles&&h.setExpiryData({cacheControl:T,expires:C});const M=o.window.ImageBitmap&&x instanceof o.window.ImageBitmap&&(J==null&&(J=o.window.OffscreenCanvas&&new o.window.OffscreenCanvas(1,1).getContext("2d")&&typeof o.window.createImageBitmap=="function"),J),O=1-(x.width-o.prevPowerOfTwo(x.width))/2;O<1||h.neighboringTiles||(h.neighboringTiles=this._getNeighboringTiles(h.tileID));const R=M?x:o.exported.getImageData(x,O),U={uid:h.uid,coord:h.tileID,source:this.id,rawImageData:R,encoding:this.encoding,padding:O};h.actor&&h.state!=="expired"||(h.actor=this.dispatcher.getActor(),h.actor.send("loadDEMTile",U,p.bind(this),void 0,!0))}}.bind(this))}_getNeighboringTiles(h){const r=h.canonical,l=Math.pow(2,r.z),p=(r.x-1+l)%l,_=r.x===0?h.wrap-1:h.wrap,x=(r.x+1+l)%l,T=r.x+1===l?h.wrap+1:h.wrap,C={};return C[new o.OverscaledTileID(h.overscaledZ,_,r.z,p,r.y).key]={backfilled:!1},C[new o.OverscaledTileID(h.overscaledZ,T,r.z,x,r.y).key]={backfilled:!1},r.y>0&&(C[new o.OverscaledTileID(h.overscaledZ,_,r.z,p,r.y-1).key]={backfilled:!1},C[new o.OverscaledTileID(h.overscaledZ,h.wrap,r.z,r.x,r.y-1).key]={backfilled:!1},C[new o.OverscaledTileID(h.overscaledZ,T,r.z,x,r.y-1).key]={backfilled:!1}),r.y+1<l&&(C[new o.OverscaledTileID(h.overscaledZ,_,r.z,p,r.y+1).key]={backfilled:!1},C[new o.OverscaledTileID(h.overscaledZ,h.wrap,r.z,r.x,r.y+1).key]={backfilled:!1},C[new o.OverscaledTileID(h.overscaledZ,T,r.z,x,r.y+1).key]={backfilled:!1}),C}unloadTile(h){h.demTexture&&this.map.painter.saveTileTexture(h.demTexture),h.fbo&&(h.fbo.destroy(),delete h.fbo),h.dem&&delete h.dem,delete h.neighboringTiles,h.state="unloaded"}},geojson:class extends o.Evented{constructor(h,r,l,p){super(),this.id=h,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=l.getActor(),this.setEventedParent(p),this._data=r.data,this._options=o.extend({},r),this._collectResourceTiming=r.collectResourceTiming,r.maxzoom!==void 0&&(this.maxzoom=r.maxzoom),r.type&&(this.type=r.type),r.attribution&&(this.attribution=r.attribution),this.promoteId=r.promoteId;const _=o.EXTENT/this.tileSize;this.workerOptions=o.extend({source:this.id,cluster:r.cluster||!1,geojsonVtOptions:{buffer:(r.buffer!==void 0?r.buffer:128)*_,tolerance:(r.tolerance!==void 0?r.tolerance:.375)*_,extent:o.EXTENT,maxZoom:this.maxzoom,lineMetrics:r.lineMetrics||!1,generateId:r.generateId||!1},superclusterOptions:{maxZoom:r.clusterMaxZoom!==void 0?r.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,r.clusterMinPoints||2),extent:o.EXTENT,radius:(r.clusterRadius!==void 0?r.clusterRadius:50)*_,log:!1,generateId:r.generateId||!1},clusterProperties:r.clusterProperties,filter:r.filter},r.workerOptions)}onAdd(h){this.map=h,this.setData(this._data)}setData(h){return this._data=h,this._updateWorkerData(),this}getClusterExpansionZoom(h,r){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:h,source:this.id},r),this}getClusterChildren(h,r){return this.actor.send("geojson.getClusterChildren",{clusterId:h,source:this.id},r),this}getClusterLeaves(h,r,l,p){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:h,limit:r,offset:l},p),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new o.Event("dataloading",{dataType:"source"})),this._loaded=!1;const h=o.extend({},this.workerOptions),r=this._data;typeof r=="string"?(h.request=this.map._requestManager.transformRequest(o.exported.resolveURL(r),o.ResourceType.Source),h.request.collectResourceTiming=this._collectResourceTiming):h.data=JSON.stringify(r),this._pendingLoad=this.actor.send(`${this.type}.loadData`,h,(l,p)=>{if(this._loaded=!0,this._pendingLoad=null,l)this.fire(new o.ErrorEvent(l));else{const _={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&p&&p.resourceTiming&&p.resourceTiming[this.id]&&(_.resourceTiming=p.resourceTiming[this.id]),this.fire(new o.Event("data",_)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(h,r){const l=h.actor?"reloadTile":"loadTile";h.actor=this.actor,h.request=this.actor.send(l,{type:this.type,uid:h.uid,tileID:h.tileID,tileZoom:h.tileZoom,zoom:h.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:o.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},(p,_)=>(delete h.request,h.unloadVectorData(),h.aborted?r(null):p?r(p):(h.loadVectorData(_,this.map.painter,l==="reloadTile"),r(null))),void 0,l==="loadTile")}abortTile(h){h.request&&(h.request.cancel(),delete h.request),h.aborted=!0}unloadTile(h){h.unloadVectorData(),this.actor.send("removeTile",{uid:h.uid,type:this.type,source:this.id})}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return o.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends Se{constructor(h,r,l,p){super(h,r,l,p),this.roundZoom=!0,this.type="video",this.options=r}load(){this._loaded=!1;const h=this.options;this.urls=[];for(const r of h.urls)this.urls.push(this.map._requestManager.transformRequest(r,o.ResourceType.Source).url);o.getVideo(this.urls,(r,l)=>{this._loaded=!0,r?this.fire(new o.ErrorEvent(r)):l&&(this.video=l,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(h){if(this.video){const r=this.video.seekable;h<r.start(0)||h>r.end(0)?this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${r.start(0)} and ${r.end(0)}-second mark.`))):this.video.currentTime=h}}getVideo(){return this.video}onAdd(h){this.map||(this.map=h,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const h=this.map.painter.context,r=h.gl;this.texture?this.video.paused||(this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE),r.texSubImage2D(r.TEXTURE_2D,0,0,0,r.RGBA,r.UNSIGNED_BYTE,this.video)):(this.texture=new o.Texture(h,this.video,r.RGBA),this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(h)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:Se,canvas:class extends Se{constructor(h,r,l,p){super(h,r,l,p),r.coordinates?Array.isArray(r.coordinates)&&r.coordinates.length===4&&!r.coordinates.some(_=>!Array.isArray(_)||_.length!==2||_.some(x=>typeof x!="number"))||this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${h}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${h}`,null,'missing required property "coordinates"'))),r.animate&&typeof r.animate!="boolean"&&this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${h}`,null,'optional "animate" property must be a boolean value'))),r.canvas?typeof r.canvas=="string"||r.canvas instanceof o.window.HTMLCanvasElement||this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${h}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${h}`,null,'missing required property "canvas"'))),this.options=r,this.animate=r.animate===void 0||r.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof o.window.HTMLCanvasElement?this.options.canvas:o.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new o.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(h){this.map=h,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let h=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,h=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,h=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const r=this.map.painter.context;this.texture?(h||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new o.Texture(r,this.canvas,r.gl.RGBA,{premultiply:!0}),this._prepareData(r)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const h of[this.canvas.width,this.canvas.height])if(isNaN(h)||h<=0)return!0;return!1}},custom:class extends o.Evented{constructor(h,r,l,p){super(),this.id=h,this.type="custom",this._dataType="raster",this._dispatcher=l,this._implementation=r,this.setEventedParent(p),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new o.ErrorEvent(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new o.ErrorEvent(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new sn(this._implementation.bounds,this.minzoom,this.maxzoom)),r.update=this._update.bind(this),r.clearTiles=this._clearTiles.bind(this),r.coveringTiles=this._coveringTiles.bind(this),o.extend(this,o.pick(r,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return o.pick(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new o.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(h){this._map=h,this._loaded=!1,this.fire(new o.Event("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(h),this.load()}onRemove(h){this._implementation.onRemove&&this._implementation.onRemove(h)}hasTile(h){if(this._implementation.hasTile){const{x:r,y:l,z:p}=h.canonical;return this._implementation.hasTile({x:r,y:l,z:p})}return!this.tileBounds||this.tileBounds.contains(h.canonical)}loadTile(h,r){const{x:l,y:p,z:_}=h.tileID.canonical,x=new o.window.AbortController;h.request=Promise.resolve(this._implementation.loadTile({x:l,y:p,z:_},{signal:x.signal})).then(function(T){return delete h.request,h.aborted?(h.state="unloaded",r(null)):T===void 0?(h.state="errored",r(null)):T===null?(this.loadTileData(h,{width:this.tileSize,height:this.tileSize,data:null}),h.state="loaded",r(null)):function(C){return C instanceof o.window.ImageData||C instanceof o.window.HTMLCanvasElement||C instanceof o.window.ImageBitmap||C instanceof o.window.HTMLImageElement}(T)?(this.loadTileData(h,T),h.state="loaded",void r(null)):(h.state="errored",r(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}.bind(this)).catch(T=>{T.code!==20&&(h.state="errored",r(T))}),h.request.cancel=()=>x.abort()}loadTileData(h,r){$.loadTileData(h,r,this._map.painter)}unloadTileData(h){$.unloadTileData(h,this._map.painter)}unloadTile(h,r){if(this.unloadTileData(h),this._implementation.unloadTile){const{x:l,y:p,z:_}=h.tileID.canonical;this._implementation.unloadTile({x:l,y:p,z:_})}r()}abortTile(h,r){h.request&&h.request.cancel&&(h.request.cancel(),delete h.request),r()}hasTransition(){return!1}_coveringTiles(){return this._map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(h=>({x:h.canonical.x,y:h.canonical.y,z:h.canonical.z}))}_clearTiles(){this._map.style._clearSource(this.id)}_update(){this.fire(new o.Event("data",{dataType:"source",sourceDataType:"content"}))}}},ze=function(h,r,l,p){const _=new Oe[r.type](h,r,l,p);if(_.id!==h)throw new Error(`Expected Source id to be ${h} instead of ${_.id}`);return o.bindAll(["load","abort","unload","serialize","prepare"],_),_};function Ae(h,r){const l=o.identity([]);return o.scale(l,l,[.5*h.width,.5*-h.height,1]),o.translate(l,l,[1,-1,0]),o.multiply(l,l,h.calculateProjMatrix(r.toUnwrapped())),Float32Array.from(l)}function Ne(h,r,l,p,_,x,T,C=!1){const M=h.tilesIn(p,T,C);M.sort(Ft);const O=[];for(const U of M)O.push({wrappedTileID:U.tile.tileID.wrapped().key,queryResults:U.tile.queryRenderedFeatures(r,l,h._state,U,_,x,Ae(h.transform,U.tile.tileID),C)});const R=function(U){const G={},ee={};for(const Q of U){const ne=Q.queryResults,H=Q.wrappedTileID,X=ee[H]=ee[H]||{};for(const re in ne){const ie=ne[re],he=X[re]=X[re]||{},Ee=G[re]=G[re]||[];for(const xe of ie)he[xe.featureIndex]||(he[xe.featureIndex]=!0,Ee.push(xe))}}return G}(O);for(const U in R)R[U].forEach(G=>{const ee=G.feature,Q=ee.layer;Q&&Q.type!=="background"&&Q.type!=="sky"&&(ee.source=Q.source,Q["source-layer"]&&(ee.sourceLayer=Q["source-layer"]),ee.state=ee.id!==void 0?h.getFeatureState(Q["source-layer"],ee.id):{})});return R}function ht(h,r){const l=h.getRenderableIds().map(x=>h.getTileByID(x)),p=[],_={};for(let x=0;x<l.length;x++){const T=l[x],C=T.tileID.canonical.key;_[C]||(_[C]=!0,T.querySourceFeatures(p,r))}return p}function Ft(h,r){const l=h.tileID,p=r.tileID;return l.overscaledZ-p.overscaledZ||l.canonical.y-p.canonical.y||l.wrap-p.wrap||l.canonical.x-p.canonical.x}function wt(){return Tl.workerClass!=null?new Tl.workerClass:new o.window.Worker(Tl.workerUrl)}const an="mapboxgl_preloaded_worker_pool";class on{constructor(){this.active={}}acquire(r){if(!this.workers)for(this.workers=[];this.workers.length<on.workerCount;)this.workers.push(new wt);return this.active[r]=!0,this.workers.slice()}release(r){delete this.active[r],this.numActive()===0&&(this.workers.forEach(l=>{l.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[an]}numActive(){return Object.keys(this.active).length}}let rn;function fn(){return rn||(rn=new on),rn}function ge(h,r){const l={};for(const p in h)p!=="ref"&&(l[p]=h[p]);return o.refProperties.forEach(p=>{p in r&&(l[p]=r[p])}),l}function Lt(h){h=h.slice();const r=Object.create(null);for(let l=0;l<h.length;l++)r[h[l].id]=h[l];for(let l=0;l<h.length;l++)"ref"in h[l]&&(h[l]=ge(h[l],r[h[l].ref]));return h}on.workerCount=2;const at={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setProjection:"setProjection"};function Yt(h,r,l){l.push({command:at.addSource,args:[h,r[h]]})}function yn(h,r,l){r.push({command:at.removeSource,args:[h]}),l[h]=!0}function Fn(h,r,l,p){yn(h,l,p),Yt(h,r,l)}function ai(h,r,l){let p;for(p in h[l])if(h[l].hasOwnProperty(p)&&p!=="data"&&!S(h[l][p],r[l][p]))return!1;for(p in r[l])if(r[l].hasOwnProperty(p)&&p!=="data"&&!S(h[l][p],r[l][p]))return!1;return!0}function mi(h,r,l,p,_,x){let T;for(T in r=r||{},h=h||{})h.hasOwnProperty(T)&&(S(h[T],r[T])||l.push({command:x,args:[p,T,r[T],_]}));for(T in r)r.hasOwnProperty(T)&&!h.hasOwnProperty(T)&&(S(h[T],r[T])||l.push({command:x,args:[p,T,r[T],_]}))}function tt(h){return h.id}function Bo(h,r){return h[r.id]=r,h}class Gi{constructor(r,l){this.reset(r,l)}reset(r,l){this.points=r||[],this._distances=[0];for(let p=1;p<this.points.length;p++)this._distances[p]=this._distances[p-1]+this.points[p].dist(this.points[p-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(l||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(r){if(this.points.length===1)return this.points[0];r=o.clamp(r,0,1);let l=1,p=this._distances[l];const _=r*this.paddedLength+this.padding;for(;p<_&&l<this._distances.length;)p=this._distances[++l];const x=l-1,T=this._distances[x],C=p-T,M=C>0?(_-T)/C:0;return this.points[x].mult(1-M).add(this.points[l].mult(M))}}class Fo{constructor(r,l,p){const _=this.boxCells=[],x=this.circleCells=[];this.xCellCount=Math.ceil(r/p),this.yCellCount=Math.ceil(l/p);for(let T=0;T<this.xCellCount*this.yCellCount;T++)_.push([]),x.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=r,this.height=l,this.xScale=this.xCellCount/r,this.yScale=this.yCellCount/l,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(r,l,p,_,x){this._forEachCell(l,p,_,x,this._insertBoxCell,this.boxUid++),this.boxKeys.push(r),this.bboxes.push(l),this.bboxes.push(p),this.bboxes.push(_),this.bboxes.push(x)}insertCircle(r,l,p,_){this._forEachCell(l-_,p-_,l+_,p+_,this._insertCircleCell,this.circleUid++),this.circleKeys.push(r),this.circles.push(l),this.circles.push(p),this.circles.push(_)}_insertBoxCell(r,l,p,_,x,T){this.boxCells[x].push(T)}_insertCircleCell(r,l,p,_,x,T){this.circleCells[x].push(T)}_query(r,l,p,_,x,T){if(p<0||r>this.width||_<0||l>this.height)return!x&&[];const C=[];if(r<=0&&l<=0&&this.width<=p&&this.height<=_){if(x)return!0;for(let M=0;M<this.boxKeys.length;M++)C.push({key:this.boxKeys[M],x1:this.bboxes[4*M],y1:this.bboxes[4*M+1],x2:this.bboxes[4*M+2],y2:this.bboxes[4*M+3]});for(let M=0;M<this.circleKeys.length;M++){const O=this.circles[3*M],R=this.circles[3*M+1],U=this.circles[3*M+2];C.push({key:this.circleKeys[M],x1:O-U,y1:R-U,x2:O+U,y2:R+U})}return T?C.filter(T):C}return this._forEachCell(r,l,p,_,this._queryCell,C,{hitTest:x,seenUids:{box:{},circle:{}}},T),x?C.length>0:C}_queryCircle(r,l,p,_,x){const T=r-p,C=r+p,M=l-p,O=l+p;if(C<0||T>this.width||O<0||M>this.height)return!_&&[];const R=[];return this._forEachCell(T,M,C,O,this._queryCellCircle,R,{hitTest:_,circle:{x:r,y:l,radius:p},seenUids:{box:{},circle:{}}},x),_?R.length>0:R}query(r,l,p,_,x){return this._query(r,l,p,_,!1,x)}hitTest(r,l,p,_,x){return this._query(r,l,p,_,!0,x)}hitTestCircle(r,l,p,_){return this._queryCircle(r,l,p,!0,_)}_queryCell(r,l,p,_,x,T,C,M){const O=C.seenUids,R=this.boxCells[x];if(R!==null){const G=this.bboxes;for(const ee of R)if(!O.box[ee]){O.box[ee]=!0;const Q=4*ee;if(r<=G[Q+2]&&l<=G[Q+3]&&p>=G[Q+0]&&_>=G[Q+1]&&(!M||M(this.boxKeys[ee]))){if(C.hitTest)return T.push(!0),!0;T.push({key:this.boxKeys[ee],x1:G[Q],y1:G[Q+1],x2:G[Q+2],y2:G[Q+3]})}}}const U=this.circleCells[x];if(U!==null){const G=this.circles;for(const ee of U)if(!O.circle[ee]){O.circle[ee]=!0;const Q=3*ee;if(this._circleAndRectCollide(G[Q],G[Q+1],G[Q+2],r,l,p,_)&&(!M||M(this.circleKeys[ee]))){if(C.hitTest)return T.push(!0),!0;{const ne=G[Q],H=G[Q+1],X=G[Q+2];T.push({key:this.circleKeys[ee],x1:ne-X,y1:H-X,x2:ne+X,y2:H+X})}}}}}_queryCellCircle(r,l,p,_,x,T,C,M){const O=C.circle,R=C.seenUids,U=this.boxCells[x];if(U!==null){const ee=this.bboxes;for(const Q of U)if(!R.box[Q]){R.box[Q]=!0;const ne=4*Q;if(this._circleAndRectCollide(O.x,O.y,O.radius,ee[ne+0],ee[ne+1],ee[ne+2],ee[ne+3])&&(!M||M(this.boxKeys[Q])))return T.push(!0),!0}}const G=this.circleCells[x];if(G!==null){const ee=this.circles;for(const Q of G)if(!R.circle[Q]){R.circle[Q]=!0;const ne=3*Q;if(this._circlesCollide(ee[ne],ee[ne+1],ee[ne+2],O.x,O.y,O.radius)&&(!M||M(this.circleKeys[Q])))return T.push(!0),!0}}}_forEachCell(r,l,p,_,x,T,C,M){const O=this._convertToXCellCoord(r),R=this._convertToYCellCoord(l),U=this._convertToXCellCoord(p),G=this._convertToYCellCoord(_);for(let ee=O;ee<=U;ee++)for(let Q=R;Q<=G;Q++)if(x.call(this,r,l,p,_,this.xCellCount*Q+ee,T,C,M))return}_convertToXCellCoord(r){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(r*this.xScale)))}_convertToYCellCoord(r){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(r*this.yScale)))}_circlesCollide(r,l,p,_,x,T){const C=_-r,M=x-l,O=p+T;return O*O>C*C+M*M}_circleAndRectCollide(r,l,p,_,x,T,C){const M=(T-_)/2,O=Math.abs(r-(_+M));if(O>M+p)return!1;const R=(C-x)/2,U=Math.abs(l-(x+R));if(U>R+p)return!1;if(O<=M||U<=R)return!0;const G=O-M,ee=U-R;return G*G+ee*ee<=p*p}}const pg=Math.tan(85*Math.PI/180);function qr(h,r,l,p,_,x,T){const C=o.create();if(l)if(x.name==="globe"){const M=o.calculateGlobeLabelMatrix(_,r);o.multiply(C,C,M)}else{const M=Ie([],T);C[0]=M[0],C[1]=M[1],C[4]=M[2],C[5]=M[3],p||o.rotateZ(C,C,_.angle)}else o.multiply(C,_.labelPlaneMatrix,h);return C}function sc(h,r,l,p,_,x,T){const C=qr(h,r,l,p,_,x,T);return x.name==="globe"&&l||(C[2]=C[6]=C[10]=C[14]=0),C}function Wd(h,r,l,p,_,x,T){if(l){if(x.name==="globe"){const C=qr(h,r,l,p,_,x,T);return o.invert(C,C),o.multiply(C,h,C),C}{const C=o.clone(h),M=o.identity([]);return M[0]=T[0],M[1]=T[1],M[4]=T[2],M[5]=T[3],o.multiply(C,C,M),p||o.rotateZ(C,C,-_.angle),C}}return _.glCoordMatrix}function xr(h,r,l,p){const _=[h,r,l,1];l?o.transformMat4$1(_,_,p):Ti(_,_,p);const x=_[3];return _[0]/=x,_[1]/=x,_[2]/=x,_}function qt(h,r){return Math.min(.5+h/r*.5,1.5)}function Nn(h,r){const l=h[0]/h[3],p=h[1]/h[3];return l>=-r[0]&&l<=r[0]&&p>=-r[1]&&p<=r[1]}function Rn(h,r,l,p,_,x,T,C,M,O){const R=l.transform,U=p?h.textSizeData:h.iconSizeData,G=o.evaluateSizeForZoom(U,l.transform.zoom),ee=R.projection.name==="globe",Q=[256/l.width*2+1,256/l.height*2+1],ne=p?h.text.dynamicLayoutVertexArray:h.icon.dynamicLayoutVertexArray;ne.clear();let H=null;ee&&(H=p?h.text.globeExtVertexArray:h.icon.globeExtVertexArray);const X=h.lineVertexArray,re=p?h.text.placedSymbolArray:h.icon.placedSymbolArray,ie=l.transform.width/l.transform.height;let he,Ee=!1;for(let xe=0;xe<re.length;xe++){const Pe=re.get(xe),{numGlyphs:We,writingMode:je}=Pe;if(je!==o.WritingMode.vertical||Ee||he===o.WritingMode.horizontal||(Ee=!0),he=je,(Pe.hidden||je===o.WritingMode.vertical)&&!Ee){nr(We,ne);continue}Ee=!1;const Le=new o.pointGeometry(Pe.tileAnchorX,Pe.tileAnchorY);let{x:It,y:Ue,z:st}=R.projection.projectTilePoint(Le.x,Le.y,O.canonical);if(M){const[ln,Jt,mn]=M(Le);It+=ln,Ue+=Jt,st+=mn}const Xe=[It,Ue,st,1];if(o.transformMat4$1(Xe,Xe,r),!Nn(Xe,Q)){nr(We,ne);continue}const Et=qt(l.transform.cameraToCenterDistance,Xe[3]),Je=o.evaluateSizeForFeature(U,G,Pe),pt=T?Je/Et:Je*Et,Pt=xr(It,Ue,st,_);if(Pt[3]<=0){nr(We,ne);continue}let De={};const He=T?null:M,Qt=Pn(Pe,pt,!1,C,r,_,x,h.glyphOffsetArray,X,ne,H,Pt,Le,De,ie,He,R.projection,O,T);Ee=Qt.useVertical,He&&Qt.needsFlipping&&(De={}),(Qt.notEnoughRoom||Ee||Qt.needsFlipping&&Pn(Pe,pt,!0,C,r,_,x,h.glyphOffsetArray,X,ne,H,Pt,Le,De,ie,He,R.projection,O,T).notEnoughRoom)&&nr(We,ne)}p?(h.text.dynamicLayoutVertexBuffer.updateData(ne),H&&h.text.globeExtVertexBuffer.updateData(H)):(h.icon.dynamicLayoutVertexBuffer.updateData(ne),H&&h.icon.globeExtVertexBuffer.updateData(H))}function lo(h,r,l,p,_,x,T,C,M,O,R,U,G,ee,Q,ne){const{lineStartIndex:H,glyphStartIndex:X,segment:re}=C,ie=X+C.numGlyphs,he=H+C.lineLength,Ee=r.getoffsetX(X),xe=r.getoffsetX(ie-1),Pe=is(h*Ee,l,p,_,x,T,re,H,he,M,O,R,U,G,!0,ee,Q,ne);if(!Pe)return null;const We=is(h*xe,l,p,_,x,T,re,H,he,M,O,R,U,G,!0,ee,Q,ne);return We?{first:Pe,last:We}:null}function As(h,r,l,p){return h===o.WritingMode.horizontal&&Math.abs(p)>Math.abs(l)?{useVertical:!0}:h===o.WritingMode.vertical?p>0?{needsFlipping:!0}:null:r!==0&&function(_,x){return _===0||Math.abs(x/_)>pg}(l,p)?r===1?{needsFlipping:!0}:null:l<0?{needsFlipping:!0}:null}function Pn(h,r,l,p,_,x,T,C,M,O,R,U,G,ee,Q,ne,H,X,re){const ie=r/24,he=h.lineOffsetX*ie,Ee=h.lineOffsetY*ie,{lineStartIndex:xe,glyphStartIndex:Pe,numGlyphs:We,segment:je,writingMode:Le,flipState:It}=h,Ue=xe+h.lineLength,st=Xe=>{if(R){const[Pt,De,He]=Xe.up,Qt=O.length;o.updateGlobeVertexNormal(R,Qt+0,Pt,De,He),o.updateGlobeVertexNormal(R,Qt+1,Pt,De,He),o.updateGlobeVertexNormal(R,Qt+2,Pt,De,He),o.updateGlobeVertexNormal(R,Qt+3,Pt,De,He)}const[Et,Je,pt]=Xe.point;o.addDynamicAttributes(O,Et,Je,pt,Xe.angle)};if(We>1){const Xe=lo(ie,C,he,Ee,l,U,G,h,M,x,ee,ne,!1,H,X,re);if(!Xe)return{notEnoughRoom:!0};if(p&&!l){let[Et,Je,pt]=Xe.first.point,[Pt,De,He]=Xe.last.point;[Et,Je]=xr(Et,Je,pt,T),[Pt,De]=xr(Pt,De,He,T);const Qt=As(Le,It,(Pt-Et)*Q,De-Je);if(h.flipState=Qt&&Qt.needsFlipping?1:2,Qt)return Qt}st(Xe.first);for(let Et=Pe+1;Et<Pe+We-1;Et++){const Je=is(ie*C.getoffsetX(Et),he,Ee,l,U,G,je,xe,Ue,M,x,ee,ne,!1,!1,H,X,re);if(!Je)return O.length-=4*(Et-Pe),{notEnoughRoom:!0};st(Je)}st(Xe.last)}else{if(p&&!l){const Et=xr(G.x,G.y,0,_),Je=xe+je+1,pt=new o.pointGeometry(M.getx(Je),M.gety(Je)),Pt=xr(pt.x,pt.y,0,_),De=Pt[3]>0?Pt:oa(G,pt,Et,1,_,void 0,H,X.canonical),He=As(Le,It,(De[0]-Et[0])*Q,De[1]-Et[1]);if(h.flipState=He&&He.needsFlipping?1:2,He)return He}const Xe=is(ie*C.getoffsetX(Pe),he,Ee,l,U,G,je,xe,Ue,M,x,ee,ne,!1,!1,H,X,re);if(!Xe)return{notEnoughRoom:!0};st(Xe)}return{}}function Ya(h,r,l,p,_){const{x,y:T,z:C}=p.projectTilePoint(h.x,h.y,r);if(!_)return xr(x,T,C,l);const[M,O,R]=_(h);return xr(x+M,T+O,C+R,l)}function oa(h,r,l,p,_,x,T,C){const M=Ya(h.sub(r)._unit()._add(h),C,_,T,x);return o.sub(M,l,M),o.normalize(M,M),o.scaleAndAdd(M,l,M,p)}function is(h,r,l,p,_,x,T,C,M,O,R,U,G,ee,Q,ne,H,X){const re=p?h-r:h+r;let ie=re>0?1:-1,he=0;p&&(ie*=-1,he=Math.PI),ie<0&&(he+=Math.PI);let Ee=C+T+(ie>0?0:1)|0,xe=_,Pe=_,We=0,je=0;const Le=Math.abs(re),It=[],Ue=[];let st=x,Xe=st;const Et=()=>oa(Xe,st,Pe,Le-We+1,R,G,ne,H.canonical);for(;We+je<=Le;){if(Ee+=ie,Ee<C||Ee>=M)return null;if(Pe=xe,Xe=st,It.push(Pe),ee&&Ue.push(Xe),st=new o.pointGeometry(O.getx(Ee),O.gety(Ee)),xe=U[Ee],!xe){const mn=Ya(st,H.canonical,R,ne,G);xe=mn[3]>0?U[Ee]=mn:Et()}We+=je,je=o.distance(Pe,xe)}Q&&G&&(U[Ee]&&(xe=Et(),je=o.distance(Pe,xe)),U[Ee]=xe);const Je=(Le-We)/je,pt=st.sub(Xe)._mult(Je)._add(Xe),Pt=o.sub([],xe,Pe),De=o.scaleAndAdd([],Pe,Pt,Je);let He=[0,0,1],Qt=Pt[0],ln=Pt[1];if(X&&(He=ne.upVector(H.canonical,pt.x,pt.y),He[0]!==0||He[1]!==0||He[2]!==1)){const mn=[He[2],0,-He[0]],Sn=o.cross([],He,mn);o.normalize(mn,mn),o.normalize(Sn,Sn),Qt=o.dot(Pt,mn),ln=o.dot(Pt,Sn)}if(l){const mn=o.cross([],He,Pt);o.normalize(mn,mn),o.scaleAndAdd(De,De,mn,l*ie)}const Jt=he+Math.atan2(ln,Qt);return It.push(De),ee&&Ue.push(pt),{point:De,angle:Jt,path:It,tilePath:Ue,up:He}}function nr(h,r){const l=r.length,p=l+4*h;r.resize(p),r.float32.fill(-1/0,4*l,4*p)}function Ti(h,r,l){const p=r[0],_=r[1];return h[0]=l[0]*p+l[4]*_+l[12],h[1]=l[1]*p+l[5]*_+l[13],h[3]=l[3]*p+l[7]*_+l[15],h}const go=100;class Qa{constructor(r,l,p=new Fo(r.width+200,r.height+200,25),_=new Fo(r.width+200,r.height+200,25)){this.transform=r,this.grid=p,this.ignoredGrid=_,this.pitchfactor=Math.cos(r._pitch)*r.cameraToCenterDistance,this.screenRightBoundary=r.width+go,this.screenBottomBoundary=r.height+go,this.gridRightBoundary=r.width+200,this.gridBottomBoundary=r.height+200,this.fogState=l}placeCollisionBox(r,l,p,_,x,T,C,M){let O=p.projectedAnchorX,R=p.projectedAnchorY,U=p.projectedAnchorZ;const G=p.elevation,ee=p.tileID,Q=r.getProjection();if(G&&ee){const[xe,Pe,We]=Q.upVector(ee.canonical,p.tileAnchorX,p.tileAnchorY),je=Q.upVectorScale(ee.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;O+=xe*G*je,R+=Pe*G*je,U+=We*G*je}const ne=this.projectAndGetPerspectiveRatio(C,O,R,U,p.tileID,Q.name==="globe"||!!G||this.transform.pitch>0,Q),H=T*ne.perspectiveRatio,X=(p.x1*l+_.x-p.padding)*H+ne.point.x,re=(p.y1*l+_.y-p.padding)*H+ne.point.y,ie=(p.x2*l+_.x+p.padding)*H+ne.point.x,he=(p.y2*l+_.y+p.padding)*H+ne.point.y,Ee=ne.perspectiveRatio<=.55||ne.occluded;return!this.isInsideGrid(X,re,ie,he)||!x&&this.grid.hitTest(X,re,ie,he,M)||Ee?{box:[],offscreen:!1,occluded:ne.occluded}:{box:[X,re,ie,he],offscreen:this.isOffscreen(X,re,ie,he),occluded:!1}}placeCollisionCircles(r,l,p,_,x,T,C,M,O,R,U,G,ee,Q,ne){const H=[],X=this.transform.elevation,re=r.getProjection(),ie=X?X.getAtTileOffsetFunc(ne,this.transform.center.lat,this.transform.worldSize,re):null,he=new o.pointGeometry(p.tileAnchorX,p.tileAnchorY);let{x:Ee,y:xe,z:Pe}=re.projectTilePoint(he.x,he.y,ne.canonical);if(ie){const[pt,Pt,De]=ie(he);Ee+=pt,xe+=Pt,Pe+=De}const We=re.name==="globe",je=this.projectAndGetPerspectiveRatio(C,Ee,xe,Pe,ne,We||!!X||this.transform.pitch>0,re),{perspectiveRatio:Le}=je,It=(U?T/Le:T*Le)/o.ONE_EM,Ue=xr(Ee,xe,Pe,M),st=je.signedDistanceFromCamera>0?lo(It,x,p.lineOffsetX*It,p.lineOffsetY*It,!1,Ue,he,p,_,M,{},X&&!U?ie:null,U&&!!X,re,ne,U):null;let Xe=!1,Et=!1,Je=!0;if(st&&!je.occluded){const pt=.5*ee*Le+Q,Pt=new o.pointGeometry(-100,-100),De=new o.pointGeometry(this.screenRightBoundary,this.screenBottomBoundary),He=new Gi,{first:Qt,last:ln}=st,Jt=Qt.path.length;let mn=[];for(let Gt=Jt-1;Gt>=1;Gt--)mn.push(Qt.path[Gt]);for(let Gt=1;Gt<ln.path.length;Gt++)mn.push(ln.path[Gt]);const Sn=2.5*pt;O&&(mn=mn.map(([Gt,ei,Wn],li)=>(ie&&!We&&(Wn=ie(li<Jt-1?Qt.tilePath[Jt-1-li]:ln.tilePath[li-Jt+2])[2]),xr(Gt,ei,Wn,O))),mn.some(Gt=>Gt[3]<=0)&&(mn=[]));let cn=[];if(mn.length>0){let Gt=1/0,ei=-1/0,Wn=1/0,li=-1/0;for(const ii of mn)Gt=Math.min(Gt,ii[0]),Wn=Math.min(Wn,ii[1]),ei=Math.max(ei,ii[0]),li=Math.max(li,ii[1]);ei>=Pt.x&&Gt<=De.x&&li>=Pt.y&&Wn<=De.y&&(cn=[mn.map(ii=>new o.pointGeometry(ii[0],ii[1]))],(Gt<Pt.x||ei>De.x||Wn<Pt.y||li>De.y)&&(cn=o.clipLine(cn,Pt.x,Pt.y,De.x,De.y)))}for(const Gt of cn){He.reset(Gt,.25*pt);let ei=0;ei=He.length<=.5*pt?1:Math.ceil(He.paddedLength/Sn)+1;for(let Wn=0;Wn<ei;Wn++){const li=Wn/Math.max(ei-1,1),ii=He.lerp(li),zr=ii.x+go,Gr=ii.y+go;H.push(zr,Gr,pt,0);const br=zr-pt,xo=Gr-pt,gi=zr+pt,ci=Gr+pt;if(Je=Je&&this.isOffscreen(br,xo,gi,ci),Et=Et||this.isInsideGrid(br,xo,gi,ci),!l&&this.grid.hitTestCircle(zr,Gr,pt,G)&&(Xe=!0,!R))return{circles:[],offscreen:!1,collisionDetected:Xe,occluded:!1}}}}return{circles:!R&&Xe||!Et?[]:H,offscreen:Je,collisionDetected:Xe,occluded:je.occluded}}queryRenderedSymbols(r){if(r.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const l=[];let p=1/0,_=1/0,x=-1/0,T=-1/0;for(const R of r){const U=new o.pointGeometry(R.x+go,R.y+go);p=Math.min(p,U.x),_=Math.min(_,U.y),x=Math.max(x,U.x),T=Math.max(T,U.y),l.push(U)}const C=this.grid.query(p,_,x,T).concat(this.ignoredGrid.query(p,_,x,T)),M={},O={};for(const R of C){const U=R.key;if(M[U.bucketInstanceId]===void 0&&(M[U.bucketInstanceId]={}),M[U.bucketInstanceId][U.featureIndex])continue;const G=[new o.pointGeometry(R.x1,R.y1),new o.pointGeometry(R.x2,R.y1),new o.pointGeometry(R.x2,R.y2),new o.pointGeometry(R.x1,R.y2)];o.polygonIntersectsPolygon(l,G)&&(M[U.bucketInstanceId][U.featureIndex]=!0,O[U.bucketInstanceId]===void 0&&(O[U.bucketInstanceId]=[]),O[U.bucketInstanceId].push(U.featureIndex))}return O}insertCollisionBox(r,l,p,_,x){(l?this.ignoredGrid:this.grid).insert({bucketInstanceId:p,featureIndex:_,collisionGroupID:x},r[0],r[1],r[2],r[3])}insertCollisionCircles(r,l,p,_,x){const T=l?this.ignoredGrid:this.grid,C={bucketInstanceId:p,featureIndex:_,collisionGroupID:x};for(let M=0;M<r.length;M+=4)T.insertCircle(C,r[M],r[M+1],r[M+2])}projectAndGetPerspectiveRatio(r,l,p,_,x,T,C){const M=[l,p,_,1];let O=!1;if(_||this.transform.pitch>0){o.transformMat4$1(M,M,r);const U=C.name==="globe";this.fogState&&x&&!U&&(O=function(ee,Q,ne,H,X,re){const ie=re.calculateFogTileMatrix(X),he=[Q,ne,H];return o.transformMat4(he,he,ie),At(ee,he,re.pitch,re._fov)}(this.fogState,l,p,_,x.toUnwrapped(),this.transform)>.9)}else Ti(M,M,r);const R=M[3];return{point:new o.pointGeometry((M[0]/R+1)/2*this.transform.width+go,(-M[1]/R+1)/2*this.transform.height+go),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(C)/R*.5,1.5),signedDistanceFromCamera:R,occluded:T&&M[2]>R||O}}isOffscreen(r,l,p,_){return p<go||r>=this.screenRightBoundary||_<go||l>this.screenBottomBoundary}isInsideGrid(r,l,p,_){return p>=0&&r<this.gridRightBoundary&&_>=0&&l<this.gridBottomBoundary}getViewportMatrix(){const r=o.identity([]);return o.translate(r,r,[-100,-100,0]),r}}function Ja(h,r,l){const p=r.createTileMatrix(h,h.worldSize,l.toUnwrapped());return o.multiply(new Float32Array(16),h.projMatrix,p)}function el(h,r,l){if(r.projection.name===l.projection.name)return h.projMatrix;const p=l.clone();return p.setProjection(r.projection),Ja(p,r.getProjection(),h)}function tl(h,r,l){return r.name===l.projection.name?h.projMatrix:Ja(l,r,h)}class $u{constructor(r,l,p,_){this.opacity=r?Math.max(0,Math.min(1,r.opacity+(r.placed?l:-l))):_&&p?1:0,this.placed=p}isHidden(){return this.opacity===0&&!this.placed}}class rs{constructor(r,l,p,_,x,T=!1){this.text=new $u(r?r.text:null,l,p,x),this.icon=new $u(r?r.icon:null,l,_,x),this.clipped=T}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class nl{constructor(r,l,p,_=!1){this.text=r,this.icon=l,this.skipFade=p,this.clipped=_}}class ac{constructor(){this.invProjMatrix=o.create(),this.viewportMatrix=o.create(),this.circles=[]}}class Gu{constructor(r,l,p,_,x){this.bucketInstanceId=r,this.featureIndex=l,this.sourceLayerIndex=p,this.bucketIndex=_,this.tileID=x}}class kr{constructor(r){this.crossSourceCollisions=r,this.maxGroupID=0,this.collisionGroups={}}get(r){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[r]){const l=++this.maxGroupID;this.collisionGroups[r]={ID:l,predicate:p=>p.collisionGroupID===l}}return this.collisionGroups[r]}}function ki(h,r,l,p,_){const{horizontalAlign:x,verticalAlign:T}=o.getAnchorAlignment(h),C=-(x-.5)*r,M=-(T-.5)*l,O=o.evaluateVariableOffset(h,p);return new o.pointGeometry(C+O[0]*_,M+O[1]*_)}function il(h,r,l,p,_){const x=new o.pointGeometry(h,r);return l&&x._rotate(p?_:-_),x}class Zu{constructor(r,l,p,_,x){this.transform=r.clone(),this.projection=r.projection.name,this.collisionIndex=new Qa(this.transform,x),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=l,this.retainedQueryData={},this.collisionGroups=new kr(p),this.collisionCircleArrays={},this.prevPlacement=_,_&&(_.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(r,l,p,_){const x=p.getBucket(l),T=p.latestFeatureIndex;if(!x||!T||l.id!==x.layerIds[0])return;const C=x.layers[0].layout,M=p.collisionBoxArray,O=Math.pow(2,this.transform.zoom-p.tileID.overscaledZ),R=p.tileSize/o.EXTENT,U=p.tileID.toUnwrapped();this.transform.setProjection(x.projection);const G=(ee=p.tileID,Q=x.getProjection(),ne=this.transform,Q.name===this.projection?ne.calculateProjMatrix(ee.toUnwrapped()):Ja(ne,Q,ee));var ee,Q,ne;const H=C.get("text-pitch-alignment")==="map",X=C.get("text-rotation-alignment")==="map";l.compileFilter();const re=l.dynamicFilter(),ie=l.dynamicFilterNeedsFeature(),he=this.transform.calculatePixelsToTileUnitsMatrix(p),Ee=sc(G,p.tileID.canonical,H,X,this.transform,x.getProjection(),he);let xe=null;if(H){const je=Wd(G,p.tileID.canonical,H,X,this.transform,x.getProjection(),he);xe=o.multiply([],this.transform.labelPlaneMatrix,je)}let Pe=null;re&&p.latestFeatureIndex&&(Pe={unwrappedTileID:U,dynamicFilter:re,dynamicFilterNeedsFeature:ie,featureIndex:p.latestFeatureIndex}),this.retainedQueryData[x.bucketInstanceId]=new Gu(x.bucketInstanceId,T,x.sourceLayerIndex,x.index,p.tileID);const We={bucket:x,layout:C,posMatrix:G,textLabelPlaneMatrix:Ee,labelToScreenMatrix:xe,clippingData:Pe,scale:O,textPixelRatio:R,holdingForFade:p.holdingForFade(),collisionBoxArray:M,partiallyEvaluatedTextSize:o.evaluateSizeForZoom(x.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:o.evaluateSizeForZoom(x.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(x.sourceID)};if(_)for(const je of x.sortKeyRanges){const{sortKey:Le,symbolInstanceStart:It,symbolInstanceEnd:Ue}=je;r.push({sortKey:Le,symbolInstanceStart:It,symbolInstanceEnd:Ue,parameters:We})}else r.push({symbolInstanceStart:0,symbolInstanceEnd:x.symbolInstances.length,parameters:We})}attemptAnchorPlacement(r,l,p,_,x,T,C,M,O,R,U,G,ee,Q,ne,H,X,re){const{textOffset0:ie,textOffset1:he,crossTileID:Ee}=G,xe=[ie,he],Pe=ki(r,p,_,xe,x),We=this.collisionIndex.placeCollisionBox(Q,x,l,il(Pe.x,Pe.y,T,C,this.transform.angle),U,M,O,R.predicate);if(H){const je=Q.getSymbolInstanceIconSize(re,this.transform.zoom,G.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(Q,je,H,il(Pe.x,Pe.y,T,C,this.transform.angle),U,M,O,R.predicate).box.length===0)return}if(We.box.length>0){let je;return this.prevPlacement&&this.prevPlacement.variableOffsets[Ee]&&this.prevPlacement.placements[Ee]&&this.prevPlacement.placements[Ee].text&&(je=this.prevPlacement.variableOffsets[Ee].anchor),this.variableOffsets[Ee]={textOffset:xe,width:p,height:_,anchor:r,textScale:x,prevAnchor:je},this.markUsedJustification(Q,r,G,ne),Q.allowVerticalPlacement&&(this.markUsedOrientation(Q,ne,G),this.placedOrientations[Ee]=ne),{shift:Pe,placedGlyphBoxes:We}}}placeLayerBucketPart(r,l,p,_){const{bucket:x,layout:T,posMatrix:C,textLabelPlaneMatrix:M,labelToScreenMatrix:O,clippingData:R,textPixelRatio:U,holdingForFade:G,collisionBoxArray:ee,partiallyEvaluatedTextSize:Q,partiallyEvaluatedIconSize:ne,collisionGroup:H}=r.parameters,X=T.get("text-optional"),re=T.get("icon-optional"),ie=T.get("text-allow-overlap"),he=T.get("icon-allow-overlap"),Ee=T.get("text-rotation-alignment")==="map",xe=T.get("text-pitch-alignment")==="map",Pe=T.get("icon-text-fit")!=="none",We=T.get("symbol-z-order")==="viewport-y";this.transform.setProjection(x.projection);let je=ie&&(he||!x.hasIconData()||re),Le=he&&(ie||!x.hasTextData()||X);!x.collisionArrays&&ee&&x.deserializeCollisionBoxes(ee),p&&_&&x.updateCollisionDebugBuffers(this.transform.zoom,ee);const It=(Ue,st,Xe)=>{const{crossTileID:Et,numVerticalGlyphVertices:Je}=Ue;if(R){const gi={zoom:this.transform.zoom,pitch:this.transform.pitch};let ci=null;if(R.dynamicFilterNeedsFeature){const Gn=this.retainedQueryData[x.bucketInstanceId];ci=R.featureIndex.loadFeature({featureIndex:Ue.featureIndex,bucketIndex:Gn.bucketIndex,sourceLayerIndex:Gn.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,R.dynamicFilter)(gi,ci,this.retainedQueryData[x.bucketInstanceId].tileID.canonical,new o.pointGeometry(Ue.tileAnchorX,Ue.tileAnchorY),this.transform.calculateDistanceTileData(R.unwrappedTileID)))return this.placements[Et]=new nl(!1,!1,!1,!0),void(l[Et]=!0)}if(l[Et])return;if(G)return void(this.placements[Et]=new nl(!1,!1,!1));let pt=!1,Pt=!1,De=!0,He=!1,Qt=!1,ln=null,Jt={box:null,offscreen:null,occluded:null},mn={box:null,offscreen:null,occluded:null},Sn=null,cn=null,Gt=null,ei=0,Wn=0,li=0;Xe.textFeatureIndex?ei=Xe.textFeatureIndex:Ue.useRuntimeCollisionCircles&&(ei=Ue.featureIndex),Xe.verticalTextFeatureIndex&&(Wn=Xe.verticalTextFeatureIndex);const ii=gi=>{gi.tileID=this.retainedQueryData[x.bucketInstanceId].tileID;const ci=this.transform.elevation;(ci||gi.elevation)&&(gi.elevation=ci?ci.getAtTileOffset(gi.tileID,gi.tileAnchorX,gi.tileAnchorY):0)},zr=Xe.textBox;if(zr){ii(zr);const gi=Gn=>{let Ri=o.WritingMode.horizontal;if(x.allowVerticalPlacement&&!Gn&&this.prevPlacement){const fr=this.prevPlacement.placedOrientations[Et];fr&&(this.placedOrientations[Et]=fr,Ri=fr,this.markUsedOrientation(x,Ri,Ue))}return Ri},ci=(Gn,Ri)=>{if(x.allowVerticalPlacement&&Je>0&&Xe.verticalTextBox){for(const fr of x.writingModes)if(fr===o.WritingMode.vertical?(Jt=Ri(),mn=Jt):Jt=Gn(),Jt&&Jt.box&&Jt.box.length)break}else Jt=Gn()};if(T.get("text-variable-anchor")){let Gn=T.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[Et]){const di=this.prevPlacement.variableOffsets[Et];Gn.indexOf(di.anchor)>0&&(Gn=Gn.filter(wr=>wr!==di.anchor),Gn.unshift(di.anchor))}const Ri=(di,wr,Sl)=>{const jo=x.getSymbolInstanceTextSize(Q,Ue,this.transform.zoom,st),pr=(di.x2-di.x1)*jo+2*di.padding,Kr=(di.y2-di.y1)*jo+2*di.padding,bo=Pe&&!he?wr:null;bo&&ii(bo);let wo={box:[],offscreen:!1,occluded:!1};const Cl=ie?2*Gn.length:Gn.length;for(let xa=0;xa<Cl;++xa){const Eo=this.attemptAnchorPlacement(Gn[xa%Gn.length],di,pr,Kr,jo,Ee,xe,U,C,H,xa>=Gn.length,Ue,st,x,Sl,bo,Q,ne);if(Eo&&(wo=Eo.placedGlyphBoxes,wo&&wo.box&&wo.box.length)){pt=!0,ln=Eo.shift;break}}return wo};ci(()=>Ri(zr,Xe.iconBox,o.WritingMode.horizontal),()=>{const di=Xe.verticalTextBox;return di&&ii(di),x.allowVerticalPlacement&&!(Jt&&Jt.box&&Jt.box.length)&&Je>0&&di?Ri(di,Xe.verticalIconBox,o.WritingMode.vertical):{box:null,offscreen:null,occluded:null}}),Jt&&(pt=Jt.box,De=Jt.offscreen,He=Jt.occluded);const fr=gi(Jt&&Jt.box);if(!pt&&this.prevPlacement){const di=this.prevPlacement.variableOffsets[Et];di&&(this.variableOffsets[Et]=di,this.markUsedJustification(x,di.anchor,Ue,fr))}}else{const Gn=(Ri,fr)=>{const di=x.getSymbolInstanceTextSize(Q,Ue,this.transform.zoom,st),wr=this.collisionIndex.placeCollisionBox(x,di,Ri,new o.pointGeometry(0,0),ie,U,C,H.predicate);return wr&&wr.box&&wr.box.length&&(this.markUsedOrientation(x,fr,Ue),this.placedOrientations[Et]=fr),wr};ci(()=>Gn(zr,o.WritingMode.horizontal),()=>{const Ri=Xe.verticalTextBox;return x.allowVerticalPlacement&&Je>0&&Ri?(ii(Ri),Gn(Ri,o.WritingMode.vertical)):{box:null,offscreen:null,occluded:null}}),gi(Jt&&Jt.box&&Jt.box.length)}}if(Sn=Jt,pt=Sn&&Sn.box&&Sn.box.length>0,De=Sn&&Sn.offscreen,He=Sn&&Sn.occluded,Ue.useRuntimeCollisionCircles){const gi=x.text.placedSymbolArray.get(Ue.centerJustifiedTextSymbolIndex>=0?Ue.centerJustifiedTextSymbolIndex:Ue.verticalPlacedTextSymbolIndex),ci=o.evaluateSizeForFeature(x.textSizeData,Q,gi),Gn=T.get("text-padding");cn=this.collisionIndex.placeCollisionCircles(x,ie,gi,x.lineVertexArray,x.glyphOffsetArray,ci,C,M,O,p,xe,H.predicate,Ue.collisionCircleDiameter*ci/o.ONE_EM,Gn,this.retainedQueryData[x.bucketInstanceId].tileID),pt=ie||cn.circles.length>0&&!cn.collisionDetected,De=De&&cn.offscreen,He=cn.occluded}if(Xe.iconFeatureIndex&&(li=Xe.iconFeatureIndex),Xe.iconBox){const gi=ci=>{ii(ci);const Gn=Pe&&ln?il(ln.x,ln.y,Ee,xe,this.transform.angle):new o.pointGeometry(0,0),Ri=x.getSymbolInstanceIconSize(ne,this.transform.zoom,Ue.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(x,Ri,ci,Gn,he,U,C,H.predicate)};mn&&mn.box&&mn.box.length&&Xe.verticalIconBox?(Gt=gi(Xe.verticalIconBox),Pt=Gt.box.length>0):(Gt=gi(Xe.iconBox),Pt=Gt.box.length>0),De=De&&Gt.offscreen,Qt=Gt.occluded}const Gr=X||Ue.numHorizontalGlyphVertices===0&&Je===0,br=re||Ue.numIconVertices===0;if(Gr||br?br?Gr||(Pt=Pt&&pt):pt=Pt&&pt:Pt=pt=Pt&&pt,pt&&Sn&&Sn.box&&this.collisionIndex.insertCollisionBox(Sn.box,T.get("text-ignore-placement"),x.bucketInstanceId,mn&&mn.box&&Wn?Wn:ei,H.ID),Pt&&Gt&&this.collisionIndex.insertCollisionBox(Gt.box,T.get("icon-ignore-placement"),x.bucketInstanceId,li,H.ID),cn&&(pt&&this.collisionIndex.insertCollisionCircles(cn.circles,T.get("text-ignore-placement"),x.bucketInstanceId,ei,H.ID),p)){const gi=x.bucketInstanceId;let ci=this.collisionCircleArrays[gi];ci===void 0&&(ci=this.collisionCircleArrays[gi]=new ac);for(let Gn=0;Gn<cn.circles.length;Gn+=4)ci.circles.push(cn.circles[Gn+0]),ci.circles.push(cn.circles[Gn+1]),ci.circles.push(cn.circles[Gn+2]),ci.circles.push(cn.collisionDetected?1:0)}const xo=x.projection.name!=="globe";je=je&&(xo||!He),Le=Le&&(xo||!Qt),this.placements[Et]=new nl(pt||je,Pt||Le,De||x.justReloaded),l[Et]=!0};if(We){const Ue=x.getSortedSymbolIndexes(this.transform.angle);for(let st=Ue.length-1;st>=0;--st){const Xe=Ue[st];It(x.symbolInstances.get(Xe),Xe,x.collisionArrays[Xe])}}else for(let Ue=r.symbolInstanceStart;Ue<r.symbolInstanceEnd;Ue++)It(x.symbolInstances.get(Ue),Ue,x.collisionArrays[Ue]);if(p&&x.bucketInstanceId in this.collisionCircleArrays){const Ue=this.collisionCircleArrays[x.bucketInstanceId];o.invert(Ue.invProjMatrix,C),Ue.viewportMatrix=this.collisionIndex.getViewportMatrix()}x.justReloaded=!1}markUsedJustification(r,l,p,_){const{leftJustifiedTextSymbolIndex:x,centerJustifiedTextSymbolIndex:T,rightJustifiedTextSymbolIndex:C,verticalPlacedTextSymbolIndex:M,crossTileID:O}=p,R=o.getAnchorJustification(l),U=_===o.WritingMode.vertical?M:R==="left"?x:R==="center"?T:R==="right"?C:-1;x>=0&&(r.text.placedSymbolArray.get(x).crossTileID=U>=0&&x!==U?0:O),T>=0&&(r.text.placedSymbolArray.get(T).crossTileID=U>=0&&T!==U?0:O),C>=0&&(r.text.placedSymbolArray.get(C).crossTileID=U>=0&&C!==U?0:O),M>=0&&(r.text.placedSymbolArray.get(M).crossTileID=U>=0&&M!==U?0:O)}markUsedOrientation(r,l,p){const _=l===o.WritingMode.horizontal||l===o.WritingMode.horizontalOnly?l:0,x=l===o.WritingMode.vertical?l:0,{leftJustifiedTextSymbolIndex:T,centerJustifiedTextSymbolIndex:C,rightJustifiedTextSymbolIndex:M,verticalPlacedTextSymbolIndex:O}=p,R=r.text.placedSymbolArray;T>=0&&(R.get(T).placedOrientation=_),C>=0&&(R.get(C).placedOrientation=_),M>=0&&(R.get(M).placedOrientation=_),O>=0&&(R.get(O).placedOrientation=x)}commit(r){this.commitTime=r,this.zoomAtLastRecencyCheck=this.transform.zoom;const l=this.prevPlacement;let p=!1;this.prevZoomAdjustment=l?l.zoomAdjustment(this.transform.zoom):0;const _=l?l.symbolFadeChange(r):1,x=l?l.opacities:{},T=l?l.variableOffsets:{},C=l?l.placedOrientations:{};for(const M in this.placements){const O=this.placements[M],R=x[M];R?(this.opacities[M]=new rs(R,_,O.text,O.icon,null,O.clipped),p=p||O.text!==R.text.placed||O.icon!==R.icon.placed):(this.opacities[M]=new rs(null,_,O.text,O.icon,O.skipFade,O.clipped),p=p||O.text||O.icon)}for(const M in x){const O=x[M];if(!this.opacities[M]){const R=new rs(O,_,!1,!1);R.isHidden()||(this.opacities[M]=R,p=p||O.text.placed||O.icon.placed)}}for(const M in T)this.variableOffsets[M]||!this.opacities[M]||this.opacities[M].isHidden()||(this.variableOffsets[M]=T[M]);for(const M in C)this.placedOrientations[M]||!this.opacities[M]||this.opacities[M].isHidden()||(this.placedOrientations[M]=C[M]);p?this.lastPlacementChangeTime=r:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=l?l.lastPlacementChangeTime:r)}updateLayerOpacities(r,l){const p={};for(const _ of l){const x=_.getBucket(r);x&&_.latestFeatureIndex&&r.id===x.layerIds[0]&&this.updateBucketOpacities(x,p,_.collisionBoxArray)}}updateBucketOpacities(r,l,p){r.hasTextData()&&r.text.opacityVertexArray.clear(),r.hasIconData()&&r.icon.opacityVertexArray.clear(),r.hasIconCollisionBoxData()&&r.iconCollisionBox.collisionVertexArray.clear(),r.hasTextCollisionBoxData()&&r.textCollisionBox.collisionVertexArray.clear();const _=r.layers[0].layout,x=!!r.layers[0].dynamicFilter(),T=new rs(null,0,!1,!1,!0),C=_.get("text-allow-overlap"),M=_.get("icon-allow-overlap"),O=_.get("text-variable-anchor"),R=_.get("text-rotation-alignment")==="map",U=_.get("text-pitch-alignment")==="map",G=_.get("icon-text-fit")!=="none",ee=new rs(null,0,C&&(M||!r.hasIconData()||_.get("icon-optional")),M&&(C||!r.hasTextData()||_.get("text-optional")),!0);!r.collisionArrays&&p&&(r.hasIconCollisionBoxData()||r.hasTextCollisionBoxData())&&r.deserializeCollisionBoxes(p);const Q=(H,X,re)=>{for(let ie=0;ie<X/4;ie++)H.opacityVertexArray.emplaceBack(re)};let ne=0;for(let H=0;H<r.symbolInstances.length;H++){const X=r.symbolInstances.get(H),{numHorizontalGlyphVertices:re,numVerticalGlyphVertices:ie,crossTileID:he,numIconVertices:Ee}=X;let xe=this.opacities[he];l[he]?xe=T:xe||(xe=ee,this.opacities[he]=xe),l[he]=!0;const Pe=re>0||ie>0,We=Ee>0,je=this.placedOrientations[he],Le=je===o.WritingMode.vertical,It=je===o.WritingMode.horizontal||je===o.WritingMode.horizontalOnly;if(!Pe&&!We||xe.isHidden()||ne++,Pe){const Ue=Ji(xe.text);Q(r.text,re,Le?sa:Ue),Q(r.text,ie,It?sa:Ue);const st=xe.text.isHidden(),{leftJustifiedTextSymbolIndex:Xe,centerJustifiedTextSymbolIndex:Et,rightJustifiedTextSymbolIndex:Je,verticalPlacedTextSymbolIndex:pt}=X,Pt=r.text.placedSymbolArray,De=st||Le?1:0;Xe>=0&&(Pt.get(Xe).hidden=De),Et>=0&&(Pt.get(Et).hidden=De),Je>=0&&(Pt.get(Je).hidden=De),pt>=0&&(Pt.get(pt).hidden=st||It?1:0);const He=this.variableOffsets[he];He&&this.markUsedJustification(r,He.anchor,X,je);const Qt=this.placedOrientations[he];Qt&&(this.markUsedJustification(r,"left",X,Qt),this.markUsedOrientation(r,Qt,X))}if(We){const Ue=Ji(xe.icon),{placedIconSymbolIndex:st,verticalPlacedIconSymbolIndex:Xe}=X,Et=r.icon.placedSymbolArray,Je=xe.icon.isHidden()?1:0;st>=0&&(Q(r.icon,Ee,Le?sa:Ue),Et.get(st).hidden=Je),Xe>=0&&(Q(r.icon,X.numVerticalIconVertices,It?sa:Ue),Et.get(Xe).hidden=Je)}if(r.hasIconCollisionBoxData()||r.hasTextCollisionBoxData()){const Ue=r.collisionArrays[H];if(Ue){let st=new o.pointGeometry(0,0),Xe=!0;if(Ue.textBox||Ue.verticalTextBox){if(O){const Je=this.variableOffsets[he];Je?(st=ki(Je.anchor,Je.width,Je.height,Je.textOffset,Je.textScale),R&&st._rotate(U?this.transform.angle:-this.transform.angle)):Xe=!1}x&&(Xe=!xe.clipped),Ue.textBox&&ir(r.textCollisionBox.collisionVertexArray,xe.text.placed,!Xe||Le,st.x,st.y),Ue.verticalTextBox&&ir(r.textCollisionBox.collisionVertexArray,xe.text.placed,!Xe||It,st.x,st.y)}const Et=Xe&&Boolean(!It&&Ue.verticalIconBox);Ue.iconBox&&ir(r.iconCollisionBox.collisionVertexArray,xe.icon.placed,Et,G?st.x:0,G?st.y:0),Ue.verticalIconBox&&ir(r.iconCollisionBox.collisionVertexArray,xe.icon.placed,!Et,G?st.x:0,G?st.y:0)}}}if(r.fullyClipped=ne===0,r.sortFeatures(this.transform.angle),this.retainedQueryData[r.bucketInstanceId]&&(this.retainedQueryData[r.bucketInstanceId].featureSortOrder=r.featureSortOrder),r.hasTextData()&&r.text.opacityVertexBuffer&&r.text.opacityVertexBuffer.updateData(r.text.opacityVertexArray),r.hasIconData()&&r.icon.opacityVertexBuffer&&r.icon.opacityVertexBuffer.updateData(r.icon.opacityVertexArray),r.hasIconCollisionBoxData()&&r.iconCollisionBox.collisionVertexBuffer&&r.iconCollisionBox.collisionVertexBuffer.updateData(r.iconCollisionBox.collisionVertexArray),r.hasTextCollisionBoxData()&&r.textCollisionBox.collisionVertexBuffer&&r.textCollisionBox.collisionVertexBuffer.updateData(r.textCollisionBox.collisionVertexArray),r.bucketInstanceId in this.collisionCircleArrays){const H=this.collisionCircleArrays[r.bucketInstanceId];r.placementInvProjMatrix=H.invProjMatrix,r.placementViewportMatrix=H.viewportMatrix,r.collisionCircleArray=H.circles,delete this.collisionCircleArrays[r.bucketInstanceId]}}symbolFadeChange(r){return this.fadeDuration===0?1:(r-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(r){return Math.max(0,(this.transform.zoom-r)/1.5)}hasTransitions(r){return this.stale||r-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(r,l){const p=this.zoomAtLastRecencyCheck===l?1-this.zoomAdjustment(l):1;return this.zoomAtLastRecencyCheck=l,this.commitTime+this.fadeDuration*p>r}setStale(){this.stale=!0}}function ir(h,r,l,p,_){h.emplaceBack(r?1:0,l?1:0,p||0,_||0),h.emplaceBack(r?1:0,l?1:0,p||0,_||0),h.emplaceBack(r?1:0,l?1:0,p||0,_||0),h.emplaceBack(r?1:0,l?1:0,p||0,_||0)}const Hr=Math.pow(2,25),Hd=Math.pow(2,24),lc=Math.pow(2,17),Zi=Math.pow(2,16),rl=Math.pow(2,9),Wu=Math.pow(2,8),ol=Math.pow(2,1);function Ji(h){if(h.opacity===0&&!h.placed)return 0;if(h.opacity===1&&h.placed)return 4294967295;const r=h.placed?1:0,l=Math.floor(127*h.opacity);return l*Hr+r*Hd+l*lc+r*Zi+l*rl+r*Wu+l*ol+r}const sa=0;class Hu{constructor(r){this._sortAcrossTiles=r.layout.get("symbol-z-order")!=="viewport-y"&&r.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(r,l,p,_,x){const T=this._bucketParts;for(;this._currentTileIndex<r.length;)if(l.getBucketParts(T,_,r[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,x())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,T.sort((C,M)=>C.sortKey-M.sortKey));this._currentPartIndex<T.length;){const C=T[this._currentPartIndex];if(l.placeLayerBucketPart(C,this._seenCrossTileIDs,p,C.symbolInstanceStart===0),this._currentPartIndex++,x())return!0}return!1}}class No{constructor(r,l,p,_,x,T,C,M){this.placement=new Zu(r,x,T,C,M),this._currentPlacementIndex=l.length-1,this._forceFullPlacement=p,this._showCollisionBoxes=_,this._done=!1}isDone(){return this._done}continuePlacement(r,l,p){const _=o.exported.now(),x=()=>{const T=o.exported.now()-_;return!this._forceFullPlacement&&T>2};for(;this._currentPlacementIndex>=0;){const T=l[r[this._currentPlacementIndex]],C=this.placement.collisionIndex.transform.zoom;if(T.type==="symbol"&&(!T.minzoom||T.minzoom<=C)&&(!T.maxzoom||T.maxzoom>C)){if(this._inProgressLayer||(this._inProgressLayer=new Hu(T)),this._inProgressLayer.continuePlacement(p[T.source],this.placement,this._showCollisionBoxes,T,x))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(r){return this.placement.commit(r),this.placement}}const sl=512/o.EXTENT/2;class cc{constructor(r,l,p){this.tileID=r,this.indexedSymbolInstances={},this.bucketInstanceId=p;for(let _=0;_<l.length;_++){const x=l.get(_),T=x.key;this.indexedSymbolInstances[T]||(this.indexedSymbolInstances[T]=[]),this.indexedSymbolInstances[T].push({crossTileID:x.crossTileID,coord:this.getScaledCoordinates(x,r)})}}getScaledCoordinates(r,l){const p=sl/Math.pow(2,l.canonical.z-this.tileID.canonical.z);return{x:Math.floor((l.canonical.x*o.EXTENT+r.tileAnchorX)*p),y:Math.floor((l.canonical.y*o.EXTENT+r.tileAnchorY)*p)}}findMatches(r,l,p){const _=this.tileID.canonical.z<l.canonical.z?1:Math.pow(2,this.tileID.canonical.z-l.canonical.z);for(let x=0;x<r.length;x++){const T=r.get(x);if(T.crossTileID)continue;const C=this.indexedSymbolInstances[T.key];if(!C)continue;const M=this.getScaledCoordinates(T,l);for(const O of C)if(Math.abs(O.coord.x-M.x)<=_&&Math.abs(O.coord.y-M.y)<=_&&!p[O.crossTileID]){p[O.crossTileID]=!0,T.crossTileID=O.crossTileID;break}}}}class mg{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Xu{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(r){const l=Math.round((r-this.lng)/360);if(l!==0)for(const p in this.indexes){const _=this.indexes[p],x={};for(const T in _){const C=_[T];C.tileID=C.tileID.unwrapTo(C.tileID.wrap+l),x[C.tileID.key]=C}this.indexes[p]=x}this.lng=r}addBucket(r,l,p){if(this.indexes[r.overscaledZ]&&this.indexes[r.overscaledZ][r.key]){if(this.indexes[r.overscaledZ][r.key].bucketInstanceId===l.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(r.overscaledZ,this.indexes[r.overscaledZ][r.key])}for(let x=0;x<l.symbolInstances.length;x++)l.symbolInstances.get(x).crossTileID=0;this.usedCrossTileIDs[r.overscaledZ]||(this.usedCrossTileIDs[r.overscaledZ]={});const _=this.usedCrossTileIDs[r.overscaledZ];for(const x in this.indexes){const T=this.indexes[x];if(Number(x)>r.overscaledZ)for(const C in T){const M=T[C];M.tileID.isChildOf(r)&&M.findMatches(l.symbolInstances,r,_)}else{const C=T[r.scaledTo(Number(x)).key];C&&C.findMatches(l.symbolInstances,r,_)}}for(let x=0;x<l.symbolInstances.length;x++){const T=l.symbolInstances.get(x);T.crossTileID||(T.crossTileID=p.generate(),_[T.crossTileID]=!0)}return this.indexes[r.overscaledZ]===void 0&&(this.indexes[r.overscaledZ]={}),this.indexes[r.overscaledZ][r.key]=new cc(r,l.symbolInstances,l.bucketInstanceId),!0}removeBucketCrossTileIDs(r,l){for(const p in l.indexedSymbolInstances)for(const _ of l.indexedSymbolInstances[p])delete this.usedCrossTileIDs[r][_.crossTileID]}removeStaleBuckets(r){let l=!1;for(const p in this.indexes){const _=this.indexes[p];for(const x in _)r[_[x].bucketInstanceId]||(this.removeBucketCrossTileIDs(p,_[x]),delete _[x],l=!0)}return l}}class Ms{constructor(){this.layerIndexes={},this.crossTileIDs=new mg,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(r,l,p,_){let x=this.layerIndexes[r.id];x===void 0&&(x=this.layerIndexes[r.id]=new Xu);let T=!1;const C={};_.name!=="globe"&&x.handleWrapJump(p);for(const M of l){const O=M.getBucket(r);O&&r.id===O.layerIds[0]&&(O.bucketInstanceId||(O.bucketInstanceId=++this.maxBucketInstanceId),x.addBucket(M.tileID,O,this.crossTileIDs)&&(T=!0),C[O.bucketInstanceId]=!0)}return x.removeStaleBuckets(C)&&(T=!0),T}pruneUnusedLayers(r){const l={};r.forEach(p=>{l[p]=!0});for(const p in this.layerIndexes)l[p]||delete this.layerIndexes[p]}}const uc=(h,r)=>o.emitValidationErrors(h,r&&r.filter(l=>l.identifier!=="source.canvas")),Xd=o.pick(at,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection"]),aa=o.pick(at,["setCenter","setZoom","setBearing","setPitch"]),os={version:8,layers:[],sources:{}},hc={fill:!0,line:!0,background:!0,hillshade:!0,raster:!0};class rr extends o.Evented{constructor(r,l={}){super(),this.map=r,this.dispatcher=new jt(fn(),this),this.imageManager=new Be,this.imageManager.setEventedParent(this),this.glyphManager=new o.GlyphManager(r._requestManager,l.localFontFamily?o.LocalGlyphMode.all:l.localIdeographFontFamily?o.LocalGlyphMode.ideographs:o.LocalGlyphMode.none,l.localFontFamily||l.localIdeographFontFamily),this.crossTileSymbolIndex=new Ms,this._layers={},this._num3DLayers=0,this._numSymbolLayers=0,this._numCircleLayers=0,this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._availableImages=[],this._order=[],this._drapedFirstOrder=[],this._markersNeedUpdate=!1,this._resetUpdates(),this.dispatcher.broadcast("setReferrer",o.getReferrer());const p=this;this._rtlTextPluginCallback=rr.registerForPluginStateChange(_=>{p.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:_.pluginStatus,pluginURL:_.pluginURL},(x,T)=>{if(o.triggerPluginCompletionEvent(x),T&&T.every(C=>C))for(const C in p._sourceCaches){const M=p._sourceCaches[C],O=M.getSource().type;O!=="vector"&&O!=="geojson"||M.reload()}})}),this.on("data",_=>{if(_.dataType!=="source"||_.sourceDataType!=="metadata")return;const x=this.getSource(_.sourceId);if(x&&x.vectorLayerIds)for(const T in this._layers){const C=this._layers[T];C.source===x.id&&this._validateLayer(C)}})}loadURL(r,l={}){this.fire(new o.Event("dataloading",{dataType:"style"}));const p=typeof l.validate=="boolean"?l.validate:!o.isMapboxURL(r);r=this.map._requestManager.normalizeStyleURL(r,l.accessToken);const _=this.map._requestManager.transformRequest(r,o.ResourceType.Style);this._request=o.getJSON(_,(x,T)=>{this._request=null,x?this.fire(new o.ErrorEvent(x)):T&&this._load(T,p)})}loadJSON(r,l={}){this.fire(new o.Event("dataloading",{dataType:"style"})),this._request=o.exported.frame(()=>{this._request=null,this._load(r,l.validate!==!1)})}loadEmpty(){this.fire(new o.Event("dataloading",{dataType:"style"})),this._load(os,!1)}_updateLayerCount(r,l){const p=l?1:-1;r.is3D()&&(this._num3DLayers+=p),r.type==="circle"&&(this._numCircleLayers+=p),r.type==="symbol"&&(this._numSymbolLayers+=p)}_load(r,l){if(l&&uc(this,o.validateStyle(r)))return;this._loaded=!0,this.stylesheet=o.clone$1(r),this._updateMapProjection();for(const _ in r.sources)this.addSource(_,r.sources[_],{validate:!1});this._changed=!1,r.sprite?this._loadSprite(r.sprite):(this.imageManager.setLoaded(!0),this.dispatcher.broadcast("spriteLoaded",!0)),this.glyphManager.setURL(r.glyphs);const p=Lt(this.stylesheet.layers);this._order=p.map(_=>_.id),this._layers={},this._serializedLayers={};for(let _ of p)_=o.createStyleLayer(_),_.setEventedParent(this,{layer:{id:_.id}}),this._layers[_.id]=_,this._serializedLayers[_.id]=_.serialize(),this._updateLayerCount(_,!0);this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new Ye(this.stylesheet.light),this.stylesheet.terrain&&!this.terrainSetForDrapingOnly()&&this._createTerrain(this.stylesheet.terrain,1),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this._updateDrapeFirstLayers(),this.fire(new o.Event("data",{dataType:"style"})),this.fire(new o.Event("style.load"))}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}setProjection(r){r?this.stylesheet.projection=r:delete this.stylesheet.projection,this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?this.getTerrain()||this.stylesheet.terrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null))}_updateMapProjection(){this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.stylesheet.projection)}_loadSprite(r){this._spriteRequest=function(l,p,_){let x,T,C;const M=o.exported.devicePixelRatio>1?"@2x":"";let O=o.getJSON(p.transformRequest(p.normalizeSpriteURL(l,M,".json"),o.ResourceType.SpriteJSON),(G,ee)=>{O=null,C||(C=G,x=ee,U())}),R=o.getImage(p.transformRequest(p.normalizeSpriteURL(l,M,".png"),o.ResourceType.SpriteImage),(G,ee)=>{R=null,C||(C=G,T=ee,U())});function U(){if(C)_(C);else if(x&&T){const G=o.exported.getImageData(T),ee={};for(const Q in x){const{width:ne,height:H,x:X,y:re,sdf:ie,pixelRatio:he,stretchX:Ee,stretchY:xe,content:Pe}=x[Q],We=new o.RGBAImage({width:ne,height:H});o.RGBAImage.copy(G,We,{x:X,y:re},{x:0,y:0},{width:ne,height:H}),ee[Q]={data:We,pixelRatio:he,sdf:ie,stretchX:Ee,stretchY:xe,content:Pe}}_(null,ee)}}return{cancel(){O&&(O.cancel(),O=null),R&&(R.cancel(),R=null)}}}(r,this.map._requestManager,(l,p)=>{if(this._spriteRequest=null,l)this.fire(new o.ErrorEvent(l));else if(p)for(const _ in p)this.imageManager.addImage(_,p[_]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.dispatcher.broadcast("spriteLoaded",!0),this.fire(new o.Event("data",{dataType:"style"}))})}_validateLayer(r){const l=this.getSource(r.source);if(!l)return;const p=r.sourceLayer;p&&(l.type==="geojson"||l.vectorLayerIds&&l.vectorLayerIds.indexOf(p)===-1)&&this.fire(new o.ErrorEvent(new Error(`Source layer "${p}" does not exist on source "${l.id}" as specified by style layer "${r.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const r in this._sourceCaches)if(!this._sourceCaches[r].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(r){const l=[];for(const p of r){const _=this._layers[p];_.type!=="custom"&&l.push(_.serialize())}return l}hasTransitions(){if(this.light&&this.light.hasTransition()||this.fog&&this.fog.hasTransition())return!0;for(const r in this._sourceCaches)if(this._sourceCaches[r].hasTransition())return!0;for(const r in this._layers)if(this._layers[r].hasTransition())return!0;return!1}get order(){return this.map._optimizeForTerrain&&this.terrain?this._drapedFirstOrder:this._order}isLayerDraped(r){return!!this.terrain&&hc[r.type]}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}update(r){if(!this._loaded)return;const l=this._changed;if(this._changed){const _=Object.keys(this._updatedLayers),x=Object.keys(this._removedLayers);(_.length||x.length)&&this._updateWorkerLayers(_,x);for(const T in this._updatedSources){const C=this._updatedSources[T];C==="reload"?this._reloadSource(T):C==="clear"&&this._clearSource(T)}this._updateTilesForChangedImages();for(const T in this._updatedPaintProps)this._layers[T].updateTransitions(r);this.light.updateTransitions(r),this.fog&&this.fog.updateTransitions(r),this._resetUpdates()}const p={};for(const _ in this._sourceCaches){const x=this._sourceCaches[_];p[_]=x.used,x.used=!1}for(const _ of this._order){const x=this._layers[_];if(x.recalculate(r,this._availableImages),!x.isHidden(r.zoom)){const C=this._getLayerSourceCache(x);C&&(C.used=!0)}const T=this.map.painter;if(T){const C=x.getProgramIds();if(!C)continue;const M=x.getProgramConfiguration(r.zoom);for(const O of C)T.useProgram(O,M)}}for(const _ in p){const x=this._sourceCaches[_];p[_]!==x.used&&x.getSource().fire(new o.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:x.getSource().id}))}this.light.recalculate(r),this.terrain&&this.terrain.recalculate(r),this.fog&&this.fog.recalculate(r),this.z=r.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),l&&this.fire(new o.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const r=Object.keys(this._changedImages);if(r.length){for(const l in this._sourceCaches)this._sourceCaches[l].reloadTilesForDependencies(["icons","patterns"],r);this._changedImages={}}}_updateWorkerLayers(r,l){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(r),removedIds:l})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setState(r){if(this._checkLoaded(),uc(this,o.validateStyle(r)))return!1;(r=o.clone$1(r)).layers=Lt(r.layers);const l=function(_,x){if(!_)return[{command:at.setStyle,args:[x]}];let T=[];try{if(!S(_.version,x.version))return[{command:at.setStyle,args:[x]}];S(_.center,x.center)||T.push({command:at.setCenter,args:[x.center]}),S(_.zoom,x.zoom)||T.push({command:at.setZoom,args:[x.zoom]}),S(_.bearing,x.bearing)||T.push({command:at.setBearing,args:[x.bearing]}),S(_.pitch,x.pitch)||T.push({command:at.setPitch,args:[x.pitch]}),S(_.sprite,x.sprite)||T.push({command:at.setSprite,args:[x.sprite]}),S(_.glyphs,x.glyphs)||T.push({command:at.setGlyphs,args:[x.glyphs]}),S(_.transition,x.transition)||T.push({command:at.setTransition,args:[x.transition]}),S(_.light,x.light)||T.push({command:at.setLight,args:[x.light]}),S(_.fog,x.fog)||T.push({command:at.setFog,args:[x.fog]}),S(_.projection,x.projection)||T.push({command:at.setProjection,args:[x.projection]});const C={},M=[];(function(U,G,ee,Q){let ne;for(ne in G=G||{},U=U||{})U.hasOwnProperty(ne)&&(G.hasOwnProperty(ne)||yn(ne,ee,Q));for(ne in G)G.hasOwnProperty(ne)&&(U.hasOwnProperty(ne)?S(U[ne],G[ne])||(U[ne].type==="geojson"&&G[ne].type==="geojson"&&ai(U,G,ne)?ee.push({command:at.setGeoJSONSourceData,args:[ne,G[ne].data]}):Fn(ne,G,ee,Q)):Yt(ne,G,ee))})(_.sources,x.sources,M,C);const O=[];_.layers&&_.layers.forEach(U=>{U.source&&C[U.source]?T.push({command:at.removeLayer,args:[U.id]}):O.push(U)});let R=_.terrain;R&&C[R.source]&&(T.push({command:at.setTerrain,args:[void 0]}),R=void 0),T=T.concat(M),S(R,x.terrain)||T.push({command:at.setTerrain,args:[x.terrain]}),function(U,G,ee){G=G||[];const Q=(U=U||[]).map(tt),ne=G.map(tt),H=U.reduce(Bo,{}),X=G.reduce(Bo,{}),re=Q.slice(),ie=Object.create(null);let he,Ee,xe,Pe,We,je,Le;for(he=0,Ee=0;he<Q.length;he++)xe=Q[he],X.hasOwnProperty(xe)?Ee++:(ee.push({command:at.removeLayer,args:[xe]}),re.splice(re.indexOf(xe,Ee),1));for(he=0,Ee=0;he<ne.length;he++)xe=ne[ne.length-1-he],re[re.length-1-he]!==xe&&(H.hasOwnProperty(xe)?(ee.push({command:at.removeLayer,args:[xe]}),re.splice(re.lastIndexOf(xe,re.length-Ee),1)):Ee++,je=re[re.length-he],ee.push({command:at.addLayer,args:[X[xe],je]}),re.splice(re.length-he,0,xe),ie[xe]=!0);for(he=0;he<ne.length;he++)if(xe=ne[he],Pe=H[xe],We=X[xe],!ie[xe]&&!S(Pe,We))if(S(Pe.source,We.source)&&S(Pe["source-layer"],We["source-layer"])&&S(Pe.type,We.type)){for(Le in mi(Pe.layout,We.layout,ee,xe,null,at.setLayoutProperty),mi(Pe.paint,We.paint,ee,xe,null,at.setPaintProperty),S(Pe.filter,We.filter)||ee.push({command:at.setFilter,args:[xe,We.filter]}),S(Pe.minzoom,We.minzoom)&&S(Pe.maxzoom,We.maxzoom)||ee.push({command:at.setLayerZoomRange,args:[xe,We.minzoom,We.maxzoom]}),Pe)Pe.hasOwnProperty(Le)&&Le!=="layout"&&Le!=="paint"&&Le!=="filter"&&Le!=="metadata"&&Le!=="minzoom"&&Le!=="maxzoom"&&(Le.indexOf("paint.")===0?mi(Pe[Le],We[Le],ee,xe,Le.slice(6),at.setPaintProperty):S(Pe[Le],We[Le])||ee.push({command:at.setLayerProperty,args:[xe,Le,We[Le]]}));for(Le in We)We.hasOwnProperty(Le)&&!Pe.hasOwnProperty(Le)&&Le!=="layout"&&Le!=="paint"&&Le!=="filter"&&Le!=="metadata"&&Le!=="minzoom"&&Le!=="maxzoom"&&(Le.indexOf("paint.")===0?mi(Pe[Le],We[Le],ee,xe,Le.slice(6),at.setPaintProperty):S(Pe[Le],We[Le])||ee.push({command:at.setLayerProperty,args:[xe,Le,We[Le]]}))}else ee.push({command:at.removeLayer,args:[xe]}),je=re[re.lastIndexOf(xe)+1],ee.push({command:at.addLayer,args:[We,je]})}(O,x.layers,T)}catch(C){console.warn("Unable to compute style diff:",C),T=[{command:at.setStyle,args:[x]}]}return T}(this.serialize(),r).filter(_=>!(_.command in aa));if(l.length===0)return!1;const p=l.filter(_=>!(_.command in Xd));if(p.length>0)throw new Error(`Unimplemented: ${p.map(_=>_.command).join(", ")}.`);return l.forEach(_=>{_.command!=="setTransition"&&_.command!=="setProjection"&&this[_.command].apply(this,_.args)}),this.stylesheet=r,this._updateMapProjection(),!0}addImage(r,l){return this.getImage(r)?this.fire(new o.ErrorEvent(new Error("An image with this name already exists."))):(this.imageManager.addImage(r,l),this._afterImageUpdated(r),this)}updateImage(r,l){this.imageManager.updateImage(r,l)}getImage(r){return this.imageManager.getImage(r)}removeImage(r){return this.getImage(r)?(this.imageManager.removeImage(r),this._afterImageUpdated(r),this):this.fire(new o.ErrorEvent(new Error("No image with this name exists.")))}_afterImageUpdated(r){this._availableImages=this.imageManager.listImages(),this._changedImages[r]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new o.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addSource(r,l,p={}){if(this._checkLoaded(),this.getSource(r)!==void 0)throw new Error("There is already a source with this ID");if(!l.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(l).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(l.type)>=0&&this._validate(o.validateSource,`sources.${r}`,l,null,p))return;this.map&&this.map._collectResourceTiming&&(l.collectResourceTiming=!0);const _=ze(r,l,this.dispatcher,this);_.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(r),source:_.serialize(),sourceId:r}));const x=T=>{const C=(T?"symbol:":"other:")+r,M=this._sourceCaches[C]=new o.SourceCache(C,_,T);(T?this._symbolSourceCaches:this._otherSourceCaches)[r]=M,M.style=this,M.onAdd(this.map)};x(!1),l.type!=="vector"&&l.type!=="geojson"||x(!0),_.onAdd&&_.onAdd(this.map),this._changed=!0}removeSource(r){this._checkLoaded();const l=this.getSource(r);if(!l)throw new Error("There is no source with this ID");for(const _ in this._layers)if(this._layers[_].source===r)return this.fire(new o.ErrorEvent(new Error(`Source "${r}" cannot be removed while layer "${_}" is using it.`)));if(this.terrain&&this.terrain.get().source===r)return this.fire(new o.ErrorEvent(new Error(`Source "${r}" cannot be removed while terrain is using it.`)));const p=this._getSourceCaches(r);for(const _ of p)delete this._sourceCaches[_.id],delete this._updatedSources[_.id],_.fire(new o.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:_.getSource().id})),_.setEventedParent(null),_.clearTiles();return delete this._otherSourceCaches[r],delete this._symbolSourceCaches[r],l.setEventedParent(null),l.onRemove&&l.onRemove(this.map),this._changed=!0,this}setGeoJSONSourceData(r,l){this._checkLoaded(),this.getSource(r).setData(l),this._changed=!0}getSource(r){const l=this._getSourceCache(r);return l&&l.getSource()}_getSources(){const r=[];for(const l in this._otherSourceCaches){const p=this._getSourceCache(l);p&&r.push(p.getSource())}return r}addLayer(r,l,p={}){this._checkLoaded();const _=r.id;if(this.getLayer(_))return void this.fire(new o.ErrorEvent(new Error(`Layer with id "${_}" already exists on this map`)));let x;if(r.type==="custom"){if(uc(this,o.validateCustomStyleLayer(r)))return;x=o.createStyleLayer(r)}else{if(typeof r.source=="object"&&(this.addSource(_,r.source),r=o.clone$1(r),r=o.extend(r,{source:_})),this._validate(o.validateLayer,`layers.${_}`,r,{arrayIndex:-1},p))return;x=o.createStyleLayer(r),this._validateLayer(x),x.setEventedParent(this,{layer:{id:_}}),this._serializedLayers[x.id]=x.serialize(),this._updateLayerCount(x,!0)}const T=l?this._order.indexOf(l):this._order.length;if(l&&T===-1)return void this.fire(new o.ErrorEvent(new Error(`Layer with id "${l}" does not exist on this map.`)));this._order.splice(T,0,_),this._layerOrderChanged=!0,this._layers[_]=x;const C=this._getLayerSourceCache(x);if(this._removedLayers[_]&&x.source&&C&&x.type!=="custom"){const M=this._removedLayers[_];delete this._removedLayers[_],M.type!==x.type?this._updatedSources[x.source]="clear":(this._updatedSources[x.source]="reload",C.pause())}this._updateLayer(x),x.onAdd&&x.onAdd(this.map),this._updateDrapeFirstLayers()}moveLayer(r,l){if(this._checkLoaded(),this._changed=!0,!this._layers[r])return void this.fire(new o.ErrorEvent(new Error(`The layer '${r}' does not exist in the map's style and cannot be moved.`)));if(r===l)return;const p=this._order.indexOf(r);this._order.splice(p,1);const _=l?this._order.indexOf(l):this._order.length;l&&_===-1?this.fire(new o.ErrorEvent(new Error(`Layer with id "${l}" does not exist on this map.`))):(this._order.splice(_,0,r),this._layerOrderChanged=!0,this._updateDrapeFirstLayers())}removeLayer(r){this._checkLoaded();const l=this._layers[r];if(!l)return void this.fire(new o.ErrorEvent(new Error(`The layer '${r}' does not exist in the map's style and cannot be removed.`)));l.setEventedParent(null),this._updateLayerCount(l,!1);const p=this._order.indexOf(r);this._order.splice(p,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[r]=l,delete this._layers[r],delete this._serializedLayers[r],delete this._updatedLayers[r],delete this._updatedPaintProps[r],l.onRemove&&l.onRemove(this.map),this._updateDrapeFirstLayers()}getLayer(r){return this._layers[r]}hasLayer(r){return r in this._layers}hasLayerType(r){for(const l in this._layers)if(this._layers[l].type===r)return!0;return!1}setLayerZoomRange(r,l,p){this._checkLoaded();const _=this.getLayer(r);_?_.minzoom===l&&_.maxzoom===p||(l!=null&&(_.minzoom=l),p!=null&&(_.maxzoom=p),this._updateLayer(_)):this.fire(new o.ErrorEvent(new Error(`The layer '${r}' does not exist in the map's style and cannot have zoom extent.`)))}setFilter(r,l,p={}){this._checkLoaded();const _=this.getLayer(r);if(_){if(!S(_.filter,l))return l==null?(_.filter=void 0,void this._updateLayer(_)):void(this._validate(o.validateFilter,`layers.${_.id}.filter`,l,{layerType:_.type},p)||(_.filter=o.clone$1(l),this._updateLayer(_)))}else this.fire(new o.ErrorEvent(new Error(`The layer '${r}' does not exist in the map's style and cannot be filtered.`)))}getFilter(r){const l=this.getLayer(r);return l&&o.clone$1(l.filter)}setLayoutProperty(r,l,p,_={}){this._checkLoaded();const x=this.getLayer(r);x?S(x.getLayoutProperty(l),p)||(x.setLayoutProperty(l,p,_),this._updateLayer(x)):this.fire(new o.ErrorEvent(new Error(`The layer '${r}' does not exist in the map's style and cannot be styled.`)))}getLayoutProperty(r,l){const p=this.getLayer(r);if(p)return p.getLayoutProperty(l);this.fire(new o.ErrorEvent(new Error(`The layer '${r}' does not exist in the map's style.`)))}setPaintProperty(r,l,p,_={}){this._checkLoaded();const x=this.getLayer(r);x?S(x.getPaintProperty(l),p)||(x.setPaintProperty(l,p,_)&&this._updateLayer(x),this._changed=!0,this._updatedPaintProps[r]=!0):this.fire(new o.ErrorEvent(new Error(`The layer '${r}' does not exist in the map's style and cannot be styled.`)))}getPaintProperty(r,l){const p=this.getLayer(r);return p&&p.getPaintProperty(l)}setFeatureState(r,l){this._checkLoaded();const p=r.source,_=r.sourceLayer,x=this.getSource(p);if(!x)return void this.fire(new o.ErrorEvent(new Error(`The source '${p}' does not exist in the map's style.`)));const T=x.type;if(T==="geojson"&&_)return void this.fire(new o.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(T==="vector"&&!_)return void this.fire(new o.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));r.id===void 0&&this.fire(new o.ErrorEvent(new Error("The feature id parameter must be provided.")));const C=this._getSourceCaches(p);for(const M of C)M.setFeatureState(_,r.id,l)}removeFeatureState(r,l){this._checkLoaded();const p=r.source,_=this.getSource(p);if(!_)return void this.fire(new o.ErrorEvent(new Error(`The source '${p}' does not exist in the map's style.`)));const x=_.type,T=x==="vector"?r.sourceLayer:void 0;if(x==="vector"&&!T)return void this.fire(new o.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));if(l&&typeof r.id!="string"&&typeof r.id!="number")return void this.fire(new o.ErrorEvent(new Error("A feature id is required to remove its specific state property.")));const C=this._getSourceCaches(p);for(const M of C)M.removeFeatureState(T,r.id,l)}getFeatureState(r){this._checkLoaded();const l=r.source,p=r.sourceLayer,_=this.getSource(l);if(_){if(_.type!=="vector"||p)return r.id===void 0&&this.fire(new o.ErrorEvent(new Error("The feature id parameter must be provided."))),this._getSourceCaches(l)[0].getFeatureState(p,r.id);this.fire(new o.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new o.ErrorEvent(new Error(`The source '${l}' does not exist in the map's style.`)))}getTransition(){return o.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){const r={};for(const l in this._sourceCaches){const p=this._sourceCaches[l].getSource();r[p.id]||(r[p.id]=p.serialize())}return o.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,terrain:this.getTerrain()||void 0,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:r,layers:this._serializeLayers(this._order)},l=>l!==void 0)}_updateLayer(r){this._updatedLayers[r.id]=!0;const l=this._getLayerSourceCache(r);r.source&&!this._updatedSources[r.source]&&l&&l.getSource().type!=="raster"&&(this._updatedSources[r.source]="reload",l.pause()),this._changed=!0,r.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(r){const l=T=>this._layers[T].type==="fill-extrusion",p={},_=[];for(let T=this._order.length-1;T>=0;T--){const C=this._order[T];if(l(C)){p[C]=T;for(const M of r){const O=M[C];if(O)for(const R of O)_.push(R)}}}_.sort((T,C)=>C.intersectionZ-T.intersectionZ);const x=[];for(let T=this._order.length-1;T>=0;T--){const C=this._order[T];if(l(C))for(let M=_.length-1;M>=0;M--){const O=_[M].feature;if(p[O.layer.id]<T)break;x.push(O),_.pop()}else for(const M of r){const O=M[C];if(O)for(const R of O)x.push(R.feature)}}return x}queryRenderedFeatures(r,l,p){l&&l.filter&&this._validate(o.validateFilter,"queryRenderedFeatures.filter",l.filter,null,l);const _={};if(l&&l.layers){if(!Array.isArray(l.layers))return this.fire(new o.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const M of l.layers){const O=this._layers[M];if(!O)return this.fire(new o.ErrorEvent(new Error(`The layer '${M}' does not exist in the map's style and cannot be queried for features.`))),[];_[O.source]=!0}}const x=[];l.availableImages=this._availableImages;const T=l&&l.layers?l.layers.some(M=>{const O=this.getLayer(M);return O&&O.is3D()}):this.has3DLayers(),C=rt.createFromScreenPoints(r,p);for(const M in this._sourceCaches){const O=this._sourceCaches[M].getSource().id;l.layers&&!_[O]||x.push(Ne(this._sourceCaches[M],this._layers,this._serializedLayers,C,l,p,T,!!this.map._showQueryGeometry))}return this.placement&&x.push(function(M,O,R,U,G,ee,Q){const ne={},H=ee.queryRenderedSymbols(U),X=[];for(const re of Object.keys(H).map(Number))X.push(Q[re]);X.sort(Ft);for(const re of X){const ie=re.featureIndex.lookupSymbolFeatures(H[re.bucketInstanceId],O,re.bucketIndex,re.sourceLayerIndex,G.filter,G.layers,G.availableImages,M);for(const he in ie){const Ee=ne[he]=ne[he]||[],xe=ie[he];xe.sort((Pe,We)=>{const je=re.featureSortOrder;if(je){const Le=je.indexOf(Pe.featureIndex);return je.indexOf(We.featureIndex)-Le}return We.featureIndex-Pe.featureIndex});for(const Pe of xe)Ee.push(Pe)}}for(const re in ne)ne[re].forEach(ie=>{const he=ie.feature,Ee=R(M[re]).getFeatureState(he.layer["source-layer"],he.id);he.source=he.layer.source,he.layer["source-layer"]&&(he.sourceLayer=he.layer["source-layer"]),he.state=Ee});return ne}(this._layers,this._serializedLayers,this._getLayerSourceCache.bind(this),C.screenGeometry,l,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(x)}querySourceFeatures(r,l){l&&l.filter&&this._validate(o.validateFilter,"querySourceFeatures.filter",l.filter,null,l);const p=this._getSourceCaches(r);let _=[];for(const x of p)_=_.concat(ht(x,l));return _}addSourceType(r,l,p){return rr.getSourceType(r)?p(new Error(`A source type called "${r}" already exists.`)):(rr.setSourceType(r,l),l.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:r,url:l.workerSourceURL},p):p(null,null))}getLight(){return this.light.getLight()}setLight(r,l={}){this._checkLoaded();const p=this.light.getLight();let _=!1;for(const T in r)if(!S(r[T],p[T])){_=!0;break}if(!_)return;const x=this._setTransitionParameters({duration:300,delay:0});this.light.setLight(r,l),this.light.updateTransitions(x)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}setTerrain(r,l=1){if(this._checkLoaded(),!r)return delete this.terrain,delete this.stylesheet.terrain,this.dispatcher.broadcast("enableTerrain",!1),this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);if(l===1){if(typeof r.source=="object"){const p="terrain-dem-src";this.addSource(p,r.source),r=o.clone$1(r),r=o.extend(r,{source:p})}if(this._validate(o.validateTerrain,"terrain",r))return}if(!this.terrain||this.terrain&&l!==this.terrain.drapeRenderMode)this._createTerrain(r,l);else{const p=this.terrain,_=p.get();for(const x of Object.keys(o.spec.terrain))!r.hasOwnProperty(x)&&o.spec.terrain[x].default&&(r[x]=o.spec.terrain[x].default);for(const x in r)if(!S(r[x],_[x])){p.set(r),this.stylesheet.terrain=r;const T=this._setTransitionParameters({duration:0});p.updateTransitions(T);break}}this._updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(r){const l=this.fog=new Bt(r,this.map.transform);this.stylesheet.fog=r;const p=this._setTransitionParameters({duration:0});l.updateTransitions(p)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(const r of this.map._markers)r._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(r){if(this._checkLoaded(),!r)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const l=this.fog,p=l.get();Object.keys(r).length===0&&l.set(r);for(const _ in r)if(!S(r[_],p[_])){l.set(r),this.stylesheet.fog=r;const x=this._setTransitionParameters({duration:0});l.updateTransitions(x);break}}else this._createFog(r);this._markersNeedUpdate=!0}_setTransitionParameters(r){return{now:o.exported.now(),transition:o.extend(r,this.stylesheet.transition)}}_updateDrapeFirstLayers(){if(!this.map._optimizeForTerrain||!this.terrain)return;const r=this._order.filter(p=>this.isLayerDraped(this._layers[p])),l=this._order.filter(p=>!this.isLayerDraped(this._layers[p]));this._drapedFirstOrder=[],this._drapedFirstOrder.push(...r),this._drapedFirstOrder.push(...l)}_createTerrain(r,l){const p=this.terrain=new Ge(r,l);this.stylesheet.terrain=r,this.dispatcher.broadcast("enableTerrain",!this.terrainSetForDrapingOnly()),this._force3DLayerUpdate();const _=this._setTransitionParameters({duration:0});p.updateTransitions(_)}_force3DLayerUpdate(){for(const r in this._layers){const l=this._layers[r];l.type==="fill-extrusion"&&this._updateLayer(l)}}_forceSymbolLayerUpdate(){for(const r in this._layers){const l=this._layers[r];l.type==="symbol"&&this._updateLayer(l)}}_validate(r,l,p,_,x={}){return(!x||x.validate!==!1)&&uc(this,r.call(o.validateStyle,o.extend({key:l,style:this.serialize(),value:p,styleSpec:o.spec},_)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),o.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const r in this._layers)this._layers[r].setEventedParent(null);for(const r in this._sourceCaches)this._sourceCaches[r].clearTiles(),this._sourceCaches[r].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(r){const l=this._getSourceCaches(r);for(const p of l)p.clearTiles()}_reloadSource(r){const l=this._getSourceCaches(r);for(const p of l)p.resume(),p.reload()}_reloadSources(){for(const r of this._getSources())r.reload&&r.reload()}_updateSources(r){for(const l in this._sourceCaches)this._sourceCaches[l].update(r)}_generateCollisionBoxes(){for(const r in this._sourceCaches){const l=this._sourceCaches[r];l.resume(),l.reload()}}_updatePlacement(r,l,p,_,x=!1){let T=!1,C=!1;const M={};for(const O of this._order){const R=this._layers[O];if(R.type!=="symbol")continue;if(!M[R.source]){const G=this._getLayerSourceCache(R);if(!G)continue;M[R.source]=G.getRenderableIds(!0).map(ee=>G.getTileByID(ee)).sort((ee,Q)=>Q.tileID.overscaledZ-ee.tileID.overscaledZ||(ee.tileID.isLessThan(Q.tileID)?-1:1))}const U=this.crossTileSymbolIndex.addLayer(R,M[R.source],r.center.lng,r.projection);T=T||U}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),x=x||this._layerOrderChanged||p===0,this._layerOrderChanged&&this.fire(new o.Event("neworder")),(x||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(o.exported.now(),r.zoom))&&(this.pauseablePlacement=new No(r,this._order,x,l,p,_,this.placement,this.fog&&r.projection.supportsFog?this.fog.state:null),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,M),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(o.exported.now()),C=!0),T&&this.pauseablePlacement.placement.setStale()),C||T)for(const O of this._order){const R=this._layers[O];R.type==="symbol"&&this.placement.updateLayerOpacities(R,M[R.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(o.exported.now())}_releaseSymbolFadeTiles(){for(const r in this._sourceCaches)this._sourceCaches[r].releaseSymbolFadeTiles()}getImages(r,l,p){this.imageManager.getImages(l.icons,p),this._updateTilesForChangedImages();const _=x=>{x&&x.setDependencies(l.tileID.key,l.type,l.icons)};_(this._otherSourceCaches[l.source]),_(this._symbolSourceCaches[l.source])}getGlyphs(r,l,p){this.glyphManager.getGlyphs(l.stacks,p)}getResource(r,l,p){return o.makeRequest(l,p)}_getSourceCache(r){return this._otherSourceCaches[r]}_getLayerSourceCache(r){return r.type==="symbol"?this._symbolSourceCaches[r.source]:this._otherSourceCaches[r.source]}_getSourceCaches(r){const l=[];return this._otherSourceCaches[r]&&l.push(this._otherSourceCaches[r]),this._symbolSourceCaches[r]&&l.push(this._symbolSourceCaches[r]),l}_isSourceCacheLoaded(r){const l=this._getSourceCaches(r);return l.length===0?(this.fire(new o.ErrorEvent(new Error(`There is no source with ID '${r}'`))),!1):l.every(p=>p.loaded())}has3DLayers(){return this._num3DLayers>0}hasSymbolLayers(){return this._numSymbolLayers>0}hasCircleLayers(){return this._numCircleLayers>0}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}rr.getSourceType=function(h){return Oe[h]},rr.setSourceType=function(h,r){Oe[h]=r},rr.registerForPluginStateChange=o.registerForPluginStateChange;var dc=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#define EXTENT 8192.0
#define HALF_PI PI/2.0
#define QUARTER_PI PI/4.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0`,al="attribute highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;varying highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",Kd=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
#ifdef TERRAIN
#ifdef TERRAIN_DEM_FLOAT_FORMAT
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;
#else
uniform sampler2D u_dem;uniform sampler2D u_dem_prev;
#endif
uniform vec4 u_dem_unpack;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float decodeElevation(vec4 v) {return dot(vec4(v.xyz*255.0,-1.0),u_dem_unpack);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem,pos).a;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem,pos));
#ifdef TERRAIN_DEM_NEAREST_FILTER
return u_exaggeration*tl;
#endif
float tr=decodeElevation(texture2D(u_dem,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem_prev,pos).a;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem_prev,pos));float tr=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem_prev,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture2D(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(
unpack_depth(texture2D(u_depth,uv-df.xz)),unpack_depth(texture2D(u_depth,uv+df.xz)),unpack_depth(texture2D(u_depth,uv-df.zy)),unpack_depth(texture2D(u_depth,uv+df.zy))
);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
float tl=texture2D(u_dem,pos).a;float tr=texture2D(u_dem,pos+vec2(off.x,0.0)).a;float bl=texture2D(u_dem,pos+vec2(0.0,off.y)).a;float br=texture2D(u_dem,pos+off).a;
#else
vec4 demtl=vec4(texture2D(u_dem,pos).xyz*255.0,-1.0);float tl=dot(demtl,u_dem_unpack);vec4 demtr=vec4(texture2D(u_dem,pos+vec2(off.x,0.0)).xyz*255.0,-1.0);float tr=dot(demtr,u_dem_unpack);vec4 dembl=vec4(texture2D(u_dem,pos+vec2(0.0,off.y)).xyz*255.0,-1.0);float bl=dot(dembl,u_dem_unpack);vec4 dembr=vec4(texture2D(u_dem,pos+off).xyz*255.0,-1.0);float br=dot(dembr,u_dem_unpack);
#endif
return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }
#endif`,Yd=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;varying vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,fc=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump float u_fog_temporal_offset;varying vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,opacity);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec3 fog_dither(vec3 color) {vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`;let Qd={},pc={};const ll=[];Is(dc,ll),Is(Kd,ll),Is(Yd,ll),Is(fc,ll),Qd=Xn("",Kd),pc=Xn(fc,Yd);const Ku=Xn(`
highp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}`,`
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);//Normalized device coordinate that is not rendered.`),Jd=dc,cl=`
#ifdef GL_ES
precision mediump float;
#else

#if !defined(lowp)
#define lowp
#endif

#if !defined(mediump)
#define mediump
#endif

#if !defined(highp)
#define highp
#endif

#endif`;var Yu={background:Xn(`uniform vec4 u_color;uniform float u_opacity;
#ifdef LIGHTING_3D_MODE
varying vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#ifdef LIGHTING_3D_MODE
uniform vec4 u_color;varying vec4 v_color;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting(u_color);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:Xn(`uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos;void main() {vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),circle:Xn(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
gl_FragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:Xn("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Xn(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {gl_FragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:Xn(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:Xn("varying float v_placed;varying float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);gl_FragColor =mix(red,blue,step(0.5,v_placed))*0.5;gl_FragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`attribute vec3 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;attribute float a_size_scale;attribute vec2 a_padding;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*elevation(a_anchor_pos),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:Xn("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}",`attribute vec2 a_pos_2f;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:Xn("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}",`attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;
#endif
varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),fill:Xn(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutline:Xn(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:Xn(`uniform vec2 u_texsize;uniform sampler2D u_image;varying vec2 v_pos;varying vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;varying vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:Xn(`uniform vec2 u_texsize;uniform sampler2D u_image;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:Xn(`varying vec4 v_color;
#ifdef RENDER_SHADOWS
varying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#ifdef ZERO_ROOF_RADIUS
varying vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)
varying highp vec3 v_normal;
#endif
void main() {
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)
vec3 normal=v_normal;
#endif
float z;vec4 color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);color=mix(v_color,v_roof_color,z);
#else
color=v_color;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);color.rgb=color.rgb*shade;
#endif
#ifdef RENDER_SHADOWS
#ifdef ZERO_ROOF_RADIUS
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#endif
color.xyz=shadowed_color_normal(color.xyz,normalize(normal),v_pos_light_view_0,v_pos_light_view_1,v_depth);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
varying vec4 v_color;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;
#endif
#ifdef ZERO_ROOF_RADIUS
varying vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)
varying highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)
v_normal=normal;
#endif
base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele;vec3 pos;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);
#ifdef RENDER_SHADOWS
v_pos_light_view_0=u_light_matrix_0*vec4(pos,1);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1);v_depth=gl_Position.w;
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}v_color=vec4(0.0,0.0,0.0,1.0);
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting(color,NdotL);
#else
v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));
#endif
v_color*=u_opacity;
#ifdef ZERO_ROOF_RADIUS
v_roof_color=vec4(0.0,0.0,0.0,1.0);
#ifdef LIGHTING_3D_MODE
v_roof_color=apply_lighting(color,calculate_NdotL(vec3(0.0,0.0,1.0)));
#else
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));
#endif
v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionPattern:Xn(`uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
varying float v_NdotL;
#endif
varying vec2 v_pos;varying vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,v_NdotL)*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
varying vec2 v_pos;varying vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
varying float v_NdotL;
#endif
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_NdotL=NdotL;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif 
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),hillshadePrepare:Xn(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
return texture2D(u_image,coord).a/4.0;
#else
vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;
#endif
}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Xn(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
gl_FragColor=apply_lighting(gl_FragColor);
#endif
#ifdef FOG
gl_FragColor=fog_dither(fog_apply_premultiplied(gl_FragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:Xn(`uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;varying vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
uniform float u_border_width;uniform vec4 u_border_color;float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist=texture2D(u_dash_image,v_tex).a;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;alpha*=linearstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture2D(u_gradient_image,v_uv.xy);
#else
out_color=color;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
highp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {out_color=vec4(0,0,0,0);}}
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef RENDER_LINE_ALPHA_DISCARD
if (alpha < u_alpha_discard_threshold) {discard;}
#endif
#ifdef RENDER_LINE_BORDER
float edgeBlur=(u_border_width+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);
#ifdef RENDER_LINE_BORDER_AUTO
float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}
#else
out_color.rgb=mix(u_border_color.rgb,out_color.rgb,smoothAlpha);
#endif
}
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define EXTRUDE_SCALE 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
attribute highp vec4 a_packed;
#endif
#ifdef RENDER_LINE_DASH
attribute float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;varying vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);
#else
v_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/floorwidth,(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),linePattern:Xn(`uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;vec2 pattern_size=vec2(display_size.x/u_tile_units_to_pixels,display_size.y);float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x=mod(v_linesofar/pattern_size.x*aspect,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));vec4 color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
color=apply_lighting(color);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),raster:Xn(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply(out_color,v_fog_pos));
#endif
gl_FragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {float w=1.0+dot(a_texture_pos,u_perspective_transform);gl_Position=u_matrix*vec4(a_pos*w,0,w);v_pos0=a_texture_pos/8192.0;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),symbolIcon:Xn(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform vec3 u_up_vector;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjected_point;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetProjected_point=u_matrix*vec4(a_globe_anchor+displacement,1);
#else
offsetProjected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);
#endif
vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#endif
float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;}`),symbolSDF:Xn(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);
#endif
vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#endif
float gamma_scale=gl_Position.w;float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade);}`),symbolTextAndIcon:Xn(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_projected_pos;attribute float a_fade_opacity;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#endif
float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade,is_sdf);}`),terrainRaster:Xn(`uniform sampler2D u_image0;varying vec2 v_pos0;
#ifdef FOG
varying float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
varying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;
#endif
void main() {vec4 color=texture2D(u_image0,v_pos0);
#ifdef RENDER_SHADOWS
color.xyz=shadowed_color(color.xyz,v_pos_light_view_0,v_pos_light_view_1,v_depth);
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
gl_FragColor=color;
#ifdef TERRAIN_WIREFRAME
gl_FragColor=vec4(1.0,0.0,0.0,0.8);
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_skirt_height;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;
#ifdef FOG
varying float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;
#endif
const float skirtOffset=24575.0;const float wireframeOffset=0.00015;void main() {v_pos0=a_texture_pos/8192.0;float skirt=float(a_pos.x >=skirtOffset);float elevation=elevation(a_texture_pos)-skirt*u_skirt_height;
#ifdef TERRAIN_WIREFRAME
elevation+=u_skirt_height*u_skirt_height*wireframeOffset;
#endif
vec2 decodedPos=a_pos-vec2(skirt*skirtOffset,0.0);gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);v_depth=gl_Position.w;
#endif
}`),terrainDepth:Xn(`#ifdef GL_ES
precision highp float;
#endif
varying float v_depth;void main() {gl_FragColor=pack_depth(v_depth);}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying float v_depth;void main() {float elevation=elevation(a_texture_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}"),skybox:Xn(`
varying lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=textureCube(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);gl_FragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,al),skyboxGradient:Xn(`varying highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture2D(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,al),skyboxCapture:Xn(`
varying highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;
#ifdef GL_ES
precision highp float;
#endif
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;gl_FragColor=vec4(color,1.0);}`,"attribute highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;varying highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:Xn(`uniform sampler2D u_image0;varying vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture2D(u_image0,v_pos0);color=vec4(raster.rgb*antialias,raster.a*antialias);
#else
color=texture2D(u_image0,v_pos0);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color;
#ifdef TERRAIN_WIREFRAME
gl_FragColor=vec4(1.0,0.0,0.0,0.8);
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;
#ifdef GLOBE_POLES
attribute vec3 a_globe_pos;attribute vec2 a_uv;
#else
attribute vec2 a_pos;
#endif
varying vec2 v_pos0;const float wireframeOffset=1e3;float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(QUARTER_PI+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 latLng=u_grid_matrix*vec3(a_pos,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;
#ifdef GLOBE_POLES
vec3 up_vector=normalize(globe_pos)*u_tile_up_scale;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);
#ifdef TERRAIN_WIREFRAME
height+=wireframeOffset;
#endif
globe_pos+=up_vector*height;
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:Xn(`uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec3 u_start_color;uniform vec4 u_color;uniform vec4 u_space_color;uniform vec4 u_high_color;uniform float u_star_intensity;uniform float u_star_size;uniform float u_star_density;uniform float u_horizon_angle;uniform mat4 u_rotation_matrix;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;highp float random(highp vec3 p) {p=fract(p*vec3(23.2342,97.1231,91.2342));p+=dot(p.zxy,p.yxz+123.1234);return fract(p.x*p.y);}float stars(vec3 p,float scale,vec2 offset) {vec2 uv_scale=(u_viewport/u_star_size)*scale;vec3 position=vec3(p.xy*uv_scale+offset*u_viewport,p.z);vec3 q=fract(position)-0.5;vec3 id=floor(position);float random_visibility=step(random(id),u_star_density);float circle=smoothstep(0.5+u_star_intensity,0.5,length(q));return circle*random_visibility;}void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {discard;return;}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(dot(dir,horizon_dir)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;float closest_point_to_center=length(closest_point-u_globe_pos);float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c =mix(color_stop_2,c2,t);float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);vec2 uv=gl_FragCoord.xy/u_viewport-0.5;float aspect_ratio=u_viewport.x/u_viewport.y;vec4 uv_dir=vec4(normalize(vec3(uv.x*aspect_ratio,uv.y,1.0)),1.0);uv_dir=u_rotation_matrix*uv_dir;vec3 n=abs(uv_dir.xyz);vec2 uv_remap=(n.x > n.y && n.x > n.z) ? uv_dir.yz/uv_dir.x:
(n.y > n.x && n.y > n.z) ? uv_dir.zx/uv_dir.y:
uv_dir.xy/uv_dir.z;uv_remap.x/=aspect_ratio;vec3 D=vec3(uv_remap,1.0);highp float star_field=0.0;if (u_star_intensity > 0.0) {star_field+=stars(D,1.2,vec2(0.0,0.0));star_field+=stars(D,1.0,vec2(1.0,0.0));star_field+=stars(D,0.8,vec2(0.0,1.0));star_field+=stars(D,0.6,vec2(1.0,1.0));star_field*=(1.0-pow(t,0.25+(1.0-u_high_color.a)*0.75));c+=star_field*alpha_2;}c=dither(c,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=vec4(c,a);}`,`attribute vec3 a_pos;attribute vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`)};function Is(h,r){const l=h.replace(/\s*\/\/[^\n]*\n/g,`
`).split(`
`);for(let p of l)if(p=p.trim(),p[0]==="#"&&p.includes("if")&&!p.includes("endif")){p=p.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const _=p.split(" ");for(const x of _)r.includes(x)||r.push(x)}}function Xn(h,r){const l=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,p=r.match(/attribute (highp |mediump |lowp )?([\w]+) ([\w]+)/g),_={},x=[...ll];return Is(h,x),Is(r,x),{fragmentSource:h=h.replace(l,(T,C,M,O,R)=>(_[R]=!0,C==="define"?`
#ifndef HAS_UNIFORM_u_${R}
varying ${M} ${O} ${R};
#else
uniform ${M} ${O} u_${R};
#endif
`:`
#ifdef HAS_UNIFORM_u_${R}
    ${M} ${O} ${R} = u_${R};
#endif
`)),vertexSource:r=r.replace(l,(T,C,M,O,R)=>{const U=O==="float"?"vec2":"vec4",G=R.match(/color/)?"color":U;return _[R]?C==="define"?`
#ifndef HAS_UNIFORM_u_${R}
uniform lowp float u_${R}_t;
attribute ${M} ${U} a_${R};
varying ${M} ${O} ${R};
#else
uniform ${M} ${O} u_${R};
#endif
`:G==="vec4"?`
#ifndef HAS_UNIFORM_u_${R}
    ${R} = a_${R};
#else
    ${M} ${O} ${R} = u_${R};
#endif
`:`
#ifndef HAS_UNIFORM_u_${R}
    ${R} = unpack_mix_${G}(a_${R}, u_${R}_t);
#else
    ${M} ${O} ${R} = u_${R};
#endif
`:C==="define"?`
#ifndef HAS_UNIFORM_u_${R}
uniform lowp float u_${R}_t;
attribute ${M} ${U} a_${R};
#else
uniform ${M} ${O} u_${R};
#endif
`:G==="vec4"?`
#ifndef HAS_UNIFORM_u_${R}
    ${M} ${O} ${R} = a_${R};
#else
    ${M} ${O} ${R} = u_${R};
#endif
`:`
#ifndef HAS_UNIFORM_u_${R}
    ${M} ${O} ${R} = unpack_mix_${G}(a_${R}, u_${R}_t);
#else
    ${M} ${O} ${R} = u_${R};
#endif
`}),staticAttributes:p,usedDefines:x}}class ef{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(r,l,p,_,x,T,C){this.context=r;let M=this.boundPaintVertexBuffers.length!==_.length;for(let R=0;!M&&R<_.length;R++)this.boundPaintVertexBuffers[R]!==_[R]&&(M=!0);let O=this.boundDynamicVertexBuffers.length!==C.length;for(let R=0;!O&&R<C.length;R++)this.boundDynamicVertexBuffers[R]!==C[R]&&(O=!0);if(!r.extVertexArrayObject||!this.vao||this.boundProgram!==l||this.boundLayoutVertexBuffer!==p||M||O||this.boundIndexBuffer!==x||this.boundVertexOffset!==T)this.freshBind(l,p,_,x,T,C);else{r.bindVertexArrayOES.set(this.vao);for(const R of C)R&&R.bind();x&&x.dynamicDraw&&x.bind()}}freshBind(r,l,p,_,x,T){let C;const M=r.numAttributes,O=this.context,R=O.gl;if(O.extVertexArrayObject)this.vao&&this.destroy(),this.vao=O.extVertexArrayObject.createVertexArrayOES(),O.bindVertexArrayOES.set(this.vao),C=0,this.boundProgram=r,this.boundLayoutVertexBuffer=l,this.boundPaintVertexBuffers=p,this.boundIndexBuffer=_,this.boundVertexOffset=x,this.boundDynamicVertexBuffers=T;else{C=O.currentNumAttributes||0;for(let U=M;U<C;U++)R.disableVertexAttribArray(U)}l.enableAttributes(R,r),l.bind(),l.setVertexAttribPointers(R,r,x);for(const U of p)U.enableAttributes(R,r),U.bind(),U.setVertexAttribPointers(R,r,x);for(const U of T)U&&(U.enableAttributes(R,r),U.bind(),U.setVertexAttribPointers(R,r,x));_&&_.bind(),O.currentNumAttributes=M}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function ul(h,r){const l=Math.pow(2,r.canonical.z),p=r.canonical.y;return[new o.MercatorCoordinate(0,p/l).toLngLat().lat,new o.MercatorCoordinate(0,(p+1)/l).toLngLat().lat]}function Qu(h,r,l,p,_,x,T){const C=h.context,M=C.gl,O=l.fbo;if(!O)return;h.prepareDrawTile();const R=h.useProgram("hillshade");C.activeTexture.set(M.TEXTURE0),M.bindTexture(M.TEXTURE_2D,O.colorAttachment.get());const U=((ne,H,X,re)=>{const ie=X.paint.get("hillshade-shadow-color"),he=X.paint.get("hillshade-highlight-color"),Ee=X.paint.get("hillshade-accent-color");let xe=X.paint.get("hillshade-illumination-direction")*(Math.PI/180);X.paint.get("hillshade-illumination-anchor")==="viewport"&&(xe-=ne.transform.angle);const Pe=!ne.options.moving;return{u_matrix:re||ne.transform.calculateProjMatrix(H.tileID.toUnwrapped(),Pe),u_image:0,u_latrange:ul(0,H.tileID),u_light:[X.paint.get("hillshade-exaggeration"),xe],u_shadow:ie,u_highlight:he,u_accent:Ee}})(h,l,p,h.terrain?r.projMatrix:null);h.prepareDrawProgram(C,R,r.toUnwrapped());const{tileBoundsBuffer:G,tileBoundsIndexBuffer:ee,tileBoundsSegments:Q}=h.getTileBoundsBuffers(l);R.draw(C,M.TRIANGLES,_,x,T,o.CullFaceMode.disabled,U,p.id,G,ee,Q)}function la(h,r,l){if(!r.needsDEMTextureUpload)return;const p=h.context,_=p.gl;p.pixelStoreUnpackPremultiplyAlpha.set(!1),r.demTexture=r.demTexture||h.getTileTexture(l.stride);const x=l.getPixels();r.demTexture?r.demTexture.update(x,{premultiply:!1}):r.demTexture=new o.Texture(p,x,_.RGBA,{premultiply:!1}),r.needsDEMTextureUpload=!1}function mc(h,r,l,p,_,x){const T=h.context,C=T.gl;if(!r.dem)return;const M=r.dem;if(T.activeTexture.set(C.TEXTURE1),la(h,r,M),!r.demTexture)return;r.demTexture.bind(C.NEAREST,C.CLAMP_TO_EDGE);const O=M.dim;T.activeTexture.set(C.TEXTURE0);let R=r.fbo;if(!R){const Q=new o.Texture(T,{width:O,height:O,data:null},C.RGBA);Q.bind(C.LINEAR,C.CLAMP_TO_EDGE),R=r.fbo=T.createFramebuffer(O,O,!0),R.colorAttachment.set(Q.texture)}T.bindFramebuffer.set(R.framebuffer),T.viewport.set([0,0,O,O]);const{tileBoundsBuffer:U,tileBoundsIndexBuffer:G,tileBoundsSegments:ee}=h.getMercatorTileBoundsBuffers();h.useProgram("hillshadePrepare").draw(T,C.TRIANGLES,p,_,x,o.CullFaceMode.disabled,((Q,ne)=>{const H=ne.stride,X=o.create();return o.ortho(X,0,o.EXTENT,-o.EXTENT,0,0,1),o.translate(X,X,[0,-o.EXTENT,0]),{u_matrix:X,u_image:1,u_dimension:[H,H],u_zoom:Q.overscaledZ,u_unpack:ne.unpackVector}})(r.tileID,M),l.id,U,G,ee),r.needsHillshadePrepare=!1}const hl=h=>({u_matrix:new o.UniformMatrix4f(h),u_image0:new o.Uniform1i(h),u_skirt_height:new o.Uniform1f(h)}),gc=(h,r)=>({u_matrix:h,u_image0:0,u_skirt_height:r}),Ju=(h,r,l,p,_,x,T,C,M,O,R,U,G,ee)=>({u_proj_matrix:Float32Array.from(h),u_globe_matrix:r,u_normalize_matrix:Float32Array.from(p),u_merc_matrix:l,u_zoom_transition:_,u_merc_center:x,u_image0:0,u_frustum_tl:T,u_frustum_tr:C,u_frustum_br:M,u_frustum_bl:O,u_globe_pos:R,u_globe_radius:U,u_viewport:G,u_grid_matrix:ee?Float32Array.from(ee):new Float32Array(9)});function _c(h,r){return h!=null&&r!=null&&!(!h.hasData()||!r.hasData())&&h.demTexture!=null&&r.demTexture!=null&&h.tileID.key!==r.tileID.key}const ks=new class{constructor(){this.operations={}}newMorphing(h,r,l,p,_){if(h in this.operations){const x=this.operations[h];x.to.tileID.key!==l.tileID.key&&(x.queued=l)}else this.operations[h]={startTime:p,phase:0,duration:_,from:r,to:l,queued:null}}getMorphValuesForProxy(h){if(!(h in this.operations))return null;const r=this.operations[h];return{from:r.from,to:r.to,phase:r.phase}}update(h){for(const r in this.operations){const l=this.operations[r];for(l.phase=(h-l.startTime)/l.duration;l.phase>=1||!this._validOp(l);)if(!this._nextOp(l,h)){delete this.operations[r];break}}}_nextOp(h,r){return!!h.queued&&(h.from=h.to,h.to=h.queued,h.queued=null,h.phase=0,h.startTime=r,!0)}_validOp(h){return h.from.hasData()&&h.to.hasData()}},ca={0:null,1:"TERRAIN_VERTEX_MORPHING",2:"TERRAIN_WIREFRAME"};function yc(h,r){const l=1<<h.z;return!r&&(h.x===0||h.x===l-1)||h.y===0||h.y===l-1}const dl=h=>({u_matrix:h});function vc(h,r,l,p,_){if(_>0){const x=o.exported.now(),T=(x-h.timeAdded)/_,C=r?(x-r.timeAdded)/_:-1,M=l.getSource(),O=p.coveringZoomLevel({tileSize:M.tileSize,roundZoom:M.roundZoom}),R=!r||Math.abs(r.tileID.overscaledZ-O)>Math.abs(h.tileID.overscaledZ-O),U=R&&h.refreshedUponExpiration?1:o.clamp(R?T:1-C,0,1);return h.refreshedUponExpiration&&T>=1&&(h.refreshedUponExpiration=!1),r?{opacity:1,mix:1-U}:{opacity:U,mix:0}}return{opacity:1,mix:0}}class $n extends o.SourceCache{constructor(r){const l={type:"raster-dem",maxzoom:r.transform.maxZoom},p=new jt(fn(),null),_=ze("mock-dem",l,p,r.style);super("mock-dem",_,!1),_.setEventedParent(this),this._sourceLoaded=!0}_loadTile(r,l){r.state="loaded",l(null)}}class xc extends o.SourceCache{constructor(r){const l=ze("proxy",{type:"geojson",maxzoom:r.transform.maxZoom},new jt(fn(),null),r.style);super("proxy",l,!1),l.setEventedParent(this),this.map=this.getSource().map=r,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(r,l,p){if(r.freezeTileCoverage)return;this.transform=r;const _=r.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((x,T)=>{if(x[T.key]="",!this._tiles[T.key]){const C=new o.Tile(T,this._source.tileSize*T.overscaleFactor(),r.tileZoom);C.state="loaded",this._tiles[T.key]=C}return x},{});for(const x in this._tiles)x in _||(this.freeFBO(x),this._tiles[x].unloadVectorData(),delete this._tiles[x])}freeFBO(r){const l=this.proxyCachedFBO[r];if(l!==void 0){const p=Object.values(l);this.renderCachePool.push(...p),delete this.proxyCachedFBO[r]}}deallocRenderCache(){this.renderCache.forEach(r=>r.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class eh extends o.OverscaledTileID{constructor(r,l,p){super(r.overscaledZ,r.wrap,r.canonical.z,r.canonical.x,r.canonical.y),this.proxyTileKey=l,this.projMatrix=p}}class tf extends o.Elevation{constructor(r,l){super(),this.painter=r,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[p,_,x]=function(M){const O=new o.StructArrayLayout4i8,R=new o.StructArrayLayout3ui6,U=131;O.reserve(17161),R.reserve(33800);const G=o.EXTENT/128,ee=o.EXTENT+G/2,Q=ee+G;for(let H=-G;H<Q;H+=G)for(let X=-G;X<Q;X+=G){const re=X<0||X>ee||H<0||H>ee?24575:0,ie=o.clamp(Math.round(X),0,o.EXTENT),he=o.clamp(Math.round(H),0,o.EXTENT);O.emplaceBack(ie+re,he,ie,he)}const ne=(H,X)=>{const re=X*U+H;R.emplaceBack(re+1,re,re+U),R.emplaceBack(re+U,re+U+1,re+1)};for(let H=1;H<129;H++)for(let X=1;X<129;X++)ne(X,H);return[0,129].forEach(H=>{for(let X=0;X<130;X++)ne(X,H),ne(H,X)}),[O,R,32768]}(),T=r.context;this.gridBuffer=T.createVertexBuffer(p,o.boundsAttributes.members),this.gridIndexBuffer=T.createIndexBuffer(_),this.gridSegments=o.SegmentVector.simpleSegment(0,0,p.length,_.length),this.gridNoSkirtSegments=o.SegmentVector.simpleSegment(0,0,p.length,x),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new xc(l.map),this.orthoMatrix=o.create(),o.ortho(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,o.EXTENT,0,o.EXTENT,0,1);const C=T.gl;this._overlapStencilMode=new o.StencilMode({func:C.GEQUAL,mask:255},0,255,C.KEEP,C.KEEP,C.REPLACE),this._previousZoom=r.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=l,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new $n(l.map)}set style(r){r.on("data",this._onStyleDataEvent.bind(this)),r.on("neworder",this._checkRenderCacheEfficiency.bind(this)),this._style=r,this._checkRenderCacheEfficiency()}update(r,l,p){if(r&&r.terrain){this._style!==r&&(this.style=r),this.enabled=!0;const _=r.terrain.properties;this.sourceCache=r.terrain.drapeRenderMode===0?this._mockSourceCache:r._getSourceCache(_.get("source")),this._exaggeration=_.get("exaggeration");const x=()=>{this.sourceCache.used&&o.warnOnce(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const T=this.getScaledDemTileSize();this.sourceCache.update(l,T,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,x(),this._initializing=!0),x(),l.updateElevation(!0,p),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(l),this._emptyDEMTextureDirty=!0}else this._disable()}resetTileLookupCache(r){this._findCoveringTileCache[r]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_checkRenderCacheEfficiency(){const r=this.renderCacheEfficiency(this._style);this._style.map._optimizeForTerrain||r.efficiency!==100&&o.warnOnce(`Terrain render cache efficiency is not optimal (${r.efficiency}%) and performance
                may be affected negatively, consider placing all background, fill and line layers before layer
                with id '${r.firstUndrapedLayer}' or create a map using optimizeForTerrain: true option.`)}_onStyleDataEvent(r){r.coord&&r.dataType==="source"?this._clearRenderCacheForTile(r.sourceCacheId,r.coord):r.dataType==="style"&&(this._invalidateRenderCache=!0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const r in this._style._sourceCaches)this._style._sourceCaches[r].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach(r=>r.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0)}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const r=2*this.proxySourceCache.getSource().tileSize;return[r,r]}set useVertexMorphing(r){this._useVertexMorphing=r}updateTileBinding(r){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const l=this.proxySourceCache,p=this.painter.transform;this._initializing&&(this._initializing=p._centerAltitude===0&&this.getAtPointOrZero(o.MercatorCoordinate.fromLngLat(p.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const _=this.proxyCoords=l.getIds().map(M=>{const O=l.getTileByID(M).tileID;return O.projMatrix=p.calculateProjMatrix(O.toUnwrapped()),O});(function(M,O){const R=O.transform.pointCoordinate(O.transform.getCameraPoint()),U=new o.pointGeometry(R.x,R.y);M.sort((G,ee)=>{if(ee.overscaledZ-G.overscaledZ)return ee.overscaledZ-G.overscaledZ;const Q=new o.pointGeometry(G.canonical.x+(1<<G.canonical.z)*G.wrap,G.canonical.y),ne=new o.pointGeometry(ee.canonical.x+(1<<ee.canonical.z)*ee.wrap,ee.canonical.y),H=U.mult(1<<G.canonical.z);return H.x-=.5,H.y-=.5,H.distSqr(Q)-H.distSqr(ne)})})(_,this.painter),this._previousZoom=p.zoom;const x=this.proxyToSource||{};this.proxyToSource={},_.forEach(M=>{this.proxyToSource[M.key]={}}),this.terrainTileForTile={};const T=this._style._sourceCaches;for(const M in T){const O=T[M];if(!O.used||(O!==this.sourceCache&&this.resetTileLookupCache(O.id),this._setupProxiedCoordsForOrtho(O,r[M],x),O.usedForTerrain))continue;const R=r[M];O.getSource().reparseOverscaled&&this._assignTerrainTiles(R)}this.proxiedCoords[l.id]=_.map(M=>new eh(M,M.key,this.orthoMatrix)),this._assignTerrainTiles(_),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(x),this.renderingToTexture=!1,this._updateTimestamp=o.exported.now();const C={};this._visibleDemTiles=[];for(const M of this.proxyCoords){const O=this.terrainTileForTile[M.key];if(!O)continue;const R=O.tileID.key;R in C||(this._visibleDemTiles.push(O),C[R]=R)}}_assignTerrainTiles(r){this._initializing||r.forEach(l=>{if(this.terrainTileForTile[l.key])return;const p=this._findTileCoveringTileID(l,this.sourceCache);p&&(this.terrainTileForTile[l.key]=p)})}_prepareDEMTextures(){const r=this.painter.context,l=r.gl;for(const p in this.terrainTileForTile){const _=this.terrainTileForTile[p],x=_.dem;!x||_.demTexture&&!_.needsDEMTextureUpload||(r.activeTexture.set(l.TEXTURE1),la(this.painter,_,x))}}_prepareDemTileUniforms(r,l,p,_){if(!l||l.demTexture==null)return!1;const x=r.tileID.canonical,T=Math.pow(2,l.tileID.canonical.z-x.z),C=_||"";return p[`u_dem_tl${C}`]=[x.x*T%1,x.y*T%1],p[`u_dem_scale${C}`]=T,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){const r=this.painter.context,l=r.gl;if(!this._emptyDepthBufferTexture){const p=new o.RGBAImage({width:1,height:1},Uint8Array.of(255,255,255,255));this._emptyDepthBufferTexture=new o.Texture(r,p,l.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){let r=0;const l=this._visibleDemTiles.reduce((p,_)=>{if(!_.dem)return p;const x=_.dem.tree.minimums[0];return x>0&&r++,p+x},0);return r?l/r:0}_updateEmptyDEMTexture(){const r=this.painter.context,l=r.gl;r.activeTexture.set(l.TEXTURE2);const p=this._getLoadedAreaMinimum(),_=new o.RGBAImage({width:1,height:1},new Uint8Array(o.DEMData.pack(p,this.sourceCache.getSource().encoding)));this._emptyDEMTextureDirty=!1;let x=this._emptyDEMTexture;return x?x.update(_,{premultiply:!1}):x=this._emptyDEMTexture=new o.Texture(r,_,l.RGBA,{premultiply:!1}),x}setupElevationDraw(r,l,p){const _=this.painter.context,x=_.gl,T=(C=this.sourceCache.getSource().encoding,{u_dem:2,u_dem_prev:4,u_dem_unpack:o.DEMData.getUnpackVector(C),u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0});var C;T.u_dem_size=this.sourceCache.getSource().tileSize,T.u_exaggeration=this.exaggeration();let M=null,O=null,R=1;if(p&&p.morphing&&this._useVertexMorphing){const U=p.morphing.srcDemTile,G=p.morphing.dstDemTile;R=p.morphing.phase,U&&G&&(this._prepareDemTileUniforms(r,U,T,"_prev")&&(O=U),this._prepareDemTileUniforms(r,G,T)&&(M=G))}if(O&&M?(_.activeTexture.set(x.TEXTURE2),M.demTexture.bind(x.NEAREST,x.CLAMP_TO_EDGE,x.NEAREST),_.activeTexture.set(x.TEXTURE4),O.demTexture.bind(x.NEAREST,x.CLAMP_TO_EDGE,x.NEAREST),T.u_dem_lerp=R):(M=this.terrainTileForTile[r.tileID.key],_.activeTexture.set(x.TEXTURE2),(this._prepareDemTileUniforms(r,M,T)?M.demTexture:this.emptyDEMTexture).bind(x.NEAREST,x.CLAMP_TO_EDGE)),_.activeTexture.set(x.TEXTURE3),p&&p.useDepthForOcclusion?(this._depthTexture&&this._depthTexture.bind(x.NEAREST,x.CLAMP_TO_EDGE),this._depthFBO&&(T.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height])):(this.emptyDepthBufferTexture.bind(x.NEAREST,x.CLAMP_TO_EDGE),T.u_depth_size_inv=[1,1]),p&&p.useMeterToDem&&M){const U=(1<<M.tileID.canonical.z)*o.mercatorZfromAltitude(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;T.u_meter_to_dem=U}if(p&&p.labelPlaneMatrixInv&&(T.u_label_plane_matrix_inv=p.labelPlaneMatrixInv),l.setTerrainUniformValues(_,T),this.painter.transform.projection.name==="globe"){const U=this.globeUniformValues(this.painter.transform,r.tileID.canonical,p&&p.useDenormalizedUpVectorScale);l.setGlobeUniformValues(_,U)}}globeUniformValues(r,l,p){const _=r.projection;return{u_tile_tl_up:_.upVector(l,0,0),u_tile_tr_up:_.upVector(l,o.EXTENT,0),u_tile_br_up:_.upVector(l,o.EXTENT,o.EXTENT),u_tile_bl_up:_.upVector(l,0,o.EXTENT),u_tile_up_scale:p?o.GLOBE_METERS_TO_ECEF:_.upVectorScale(l,r.center.lat,r.worldSize).metersToTile}}renderToBackBuffer(r){const l=this.painter,p=this.painter.context;r.length!==0&&(p.bindFramebuffer.set(null),p.viewport.set([0,0,l.width,l.height]),l.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(_,x,T,C,M){if(_.transform.projection.name==="globe")(function(O,R,U,G,ee){const Q=O.context,ne=Q.gl;let H,X;const re=O.options.showTerrainWireframe?2:0,ie=O.transform,he=o.globeUseCustomAntiAliasing(O,Q,ie),Ee=(Et,Je)=>{if(X===Et)return;const pt=[ca[Et],"PROJECTION_GLOBE_VIEW"];he&&pt.push("CUSTOM_ANTIALIASING"),Je&&pt.push(ca[re]),H=O.useProgram("globeRaster",null,pt),X=Et},xe=O.colorModeForRenderPass(),Pe=new o.DepthMode(ne.LEQUAL,o.DepthMode.ReadWrite,O.depthRangeFor3D);ks.update(ee);const We=o.calculateGlobeMercatorMatrix(ie),je=[o.mercatorXfromLng(ie.center.lng),o.mercatorYfromLat(ie.center.lat)],Le=re?[!1,!0]:[!1],It=O.globeSharedBuffers,Ue=[ie.width*o.exported.devicePixelRatio,ie.height*o.exported.devicePixelRatio],st=Float32Array.from(ie.globeMatrix),Xe={useDenormalizedUpVectorScale:!0};if(Le.forEach(Et=>{X=-1;const Je=Et?ne.LINES:ne.TRIANGLES;for(const pt of G){const Pt=U.getTile(pt),De=o.StencilMode.disabled,He=R.prevTerrainTileForTile[pt.key],Qt=R.terrainTileForTile[pt.key];_c(He,Qt)&&ks.newMorphing(pt.key,He,Qt,ee,250),Q.activeTexture.set(ne.TEXTURE0),Pt.texture.bind(ne.LINEAR,ne.CLAMP_TO_EDGE);const ln=ks.getMorphValuesForProxy(pt.key),Jt=ln?1:0;ln&&o.extend$1(Xe,{morphing:{srcDemTile:ln.from,dstDemTile:ln.to,phase:o.easeCubicInOut(ln.phase)}});const mn=o.tileCornersToBounds(pt.canonical),Sn=o.getLatitudinalLod(mn.getCenter().lat),cn=o.getGridMatrix(pt.canonical,mn,Sn,ie.worldSize/ie._pixelsPerMercatorPixel),Gt=o.globeNormalizeECEF(o.globeTileBounds(pt.canonical)),ei=Ju(ie.projMatrix,st,We,Gt,o.globeToMercatorTransition(ie.zoom),je,ie.frustumCorners.TL,ie.frustumCorners.TR,ie.frustumCorners.BR,ie.frustumCorners.BL,ie.globeCenterInViewSpace,ie.globeRadius,Ue,cn);if(Ee(Jt,Et),R.setupElevationDraw(Pt,H,Xe),O.prepareDrawProgram(Q,H,pt.toUnwrapped()),It){const[Wn,li,ii]=Et?It.getWirefameBuffers(O.context,Sn):It.getGridBuffers(Sn);H.draw(Q,Je,Pe,De,xe,o.CullFaceMode.backCCW,ei,"globe_raster",Wn,li,ii)}}}),It){const Et=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];he&&Et.push("CUSTOM_ANTIALIASING"),H=O.useProgram("globeRaster",null,Et);for(const Je of G){const{x:pt,y:Pt,z:De}=Je.canonical,He=Pt===0,Qt=Pt===(1<<De)-1,[ln,Jt,mn,Sn]=It.getPoleBuffers(De);if(Sn&&(He||Qt)){const cn=U.getTile(Je);Q.activeTexture.set(ne.TEXTURE0),cn.texture.bind(ne.LINEAR,ne.CLAMP_TO_EDGE);let Gt=o.globePoleMatrixForTile(De,pt,ie);const ei=o.globeNormalizeECEF(o.globeTileBounds(Je.canonical)),Wn=(li,ii)=>li.draw(Q,ne.TRIANGLES,Pe,o.StencilMode.disabled,xe,o.CullFaceMode.disabled,Ju(ie.projMatrix,Gt,Gt,ei,0,je,ie.frustumCorners.TL,ie.frustumCorners.TR,ie.frustumCorners.BR,ie.frustumCorners.BL,ie.globeCenterInViewSpace,ie.globeRadius,Ue),"globe_pole_raster",ii,mn,Sn);R.setupElevationDraw(cn,H,Xe),O.prepareDrawProgram(Q,H,Je.toUnwrapped()),He&&Wn(H,ln),Qt&&(Gt=o.scale(o.create(),Gt,[1,-1,1]),Wn(H,Jt))}}}})(_,x,T,C,M);else{const O=_.context,R=O.gl;let U,G;const ee=_.options.showTerrainWireframe?2:0,Q=(ie,he)=>{if(G===ie)return;const Ee=[ca[ie]];he&&Ee.push(ca[ee]),U=_.useProgram("terrainRaster",null,Ee),G=ie},ne=_.colorModeForRenderPass(),H=new o.DepthMode(R.LEQUAL,o.DepthMode.ReadWrite,_.depthRangeFor3D);ks.update(M);const X=_.transform,re=6*Math.pow(1.5,22-X.zoom)*x.exaggeration();(ee?[!1,!0]:[!1]).forEach(ie=>{G=-1;const he=ie?R.LINES:R.TRIANGLES,[Ee,xe]=ie?x.getWirefameBuffer():[x.gridIndexBuffer,x.gridSegments];for(const Pe of C){const We=T.getTile(Pe),je=o.StencilMode.disabled,Le=x.prevTerrainTileForTile[Pe.key],It=x.terrainTileForTile[Pe.key];_c(Le,It)&&ks.newMorphing(Pe.key,Le,It,M,250),O.activeTexture.set(R.TEXTURE0),We.texture.bind(R.LINEAR,R.CLAMP_TO_EDGE,R.LINEAR_MIPMAP_NEAREST);const Ue=ks.getMorphValuesForProxy(Pe.key),st=Ue?1:0;let Xe;Ue&&(Xe={morphing:{srcDemTile:Ue.from,dstDemTile:Ue.to,phase:o.easeCubicInOut(Ue.phase)}});const Et=gc(Pe.projMatrix,yc(Pe.canonical,X.renderWorldCopies)?re/10:re);Q(st,ie),x.setupElevationDraw(We,U,Xe),_.prepareDrawProgram(O,U,Pe.toUnwrapped()),U.draw(O,he,H,je,ne,o.CullFaceMode.backCCW,Et,"terrain_raster",x.gridBuffer,Ee,xe)}})}}(l,this,this.proxySourceCache,r,this._updateTimestamp),this.renderingToTexture=!0,l.gpuTimingDeferredRenderEnd(),r.splice(0,r.length))}renderBatch(r){if(this._drapedRenderBatches.length===0)return r+1;this.renderingToTexture=!0;const l=this.painter,p=this.painter.context,_=this.proxySourceCache,x=this.proxiedCoords[_.id],T=this._drapedRenderBatches.shift(),C=[],M=l.style.order;let O=0;for(const R of x){const U=_.getTileByID(R.proxyTileKey),G=_.proxyCachedFBO[R.key]?_.proxyCachedFBO[R.key][r]:void 0,ee=G!==void 0?_.renderCache[G]:this.pool[O++],Q=G!==void 0;if(U.texture=ee.tex,Q&&!ee.dirty){C.push(U.tileID);continue}let ne;p.bindFramebuffer.set(ee.fb.framebuffer),this.renderedToTile=!1,ee.dirty&&(p.clear({color:o.Color.transparent,stencil:0}),ee.dirty=!1);for(let H=T.start;H<=T.end;++H){const X=l.style._layers[M[H]];if(X.isHidden(l.transform.zoom))continue;const re=l.style._getLayerSourceCache(X),ie=re?this.proxyToSource[R.key][re.id]:[R];if(!ie)continue;const he=ie;p.viewport.set([0,0,ee.fb.width,ee.fb.height]),ne!==(re?re.id:null)&&(this._setupStencil(ee,ie,X,re),ne=re?re.id:null),l.renderLayer(l,re,X,he)}this.renderedToTile?(ee.dirty=!0,C.push(U.tileID)):Q||--O,O===5&&(O=0,this.renderToBackBuffer(C))}return this.renderToBackBuffer(C),this.renderingToTexture=!1,p.bindFramebuffer.set(null),p.viewport.set([0,0,l.width,l.height]),T.end+1}postRender(){}renderCacheEfficiency(r){const l=r.order.length;if(l===0)return{efficiency:100};let p,_=0,x=0,T=!1;for(let C=0;C<l;++C){const M=r._layers[r.order[C]];this._style.isLayerDraped(M)?(T&&++_,++x):T||(T=!0,p=M.id)}return x===0?{efficiency:100}:{efficiency:100*(1-_/x),firstUndrapedLayer:p}}getMinElevationBelowMSL(){let r=0;return this._visibleDemTiles.filter(l=>l.dem).forEach(l=>{r=Math.min(r,l.dem.tree.minimums[0])}),r===0?r:(r-30)*this._exaggeration}raycast(r,l,p){if(!this._visibleDemTiles)return null;const _=this._visibleDemTiles.filter(x=>x.dem).map(x=>{const T=x.tileID,C=1<<T.overscaledZ,{x:M,y:O}=T.canonical,R=M/C,U=(M+1)/C,G=O/C,ee=(O+1)/C;return{minx:R,miny:G,maxx:U,maxy:ee,t:x.dem.tree.raycastRoot(R,G,U,ee,r,l,p),tile:x}});_.sort((x,T)=>(x.t!==null?x.t:Number.MAX_VALUE)-(T.t!==null?T.t:Number.MAX_VALUE));for(const x of _){if(x.t==null)return null;const T=x.tile.dem.tree.raycast(x.minx,x.miny,x.maxx,x.maxy,r,l,p);if(T!=null)return T}return null}_createFBO(){const r=this.painter.context,l=r.gl,p=this.drapeBufferSize;r.activeTexture.set(l.TEXTURE0);const _=new o.Texture(r,{width:p[0],height:p[1],data:null},l.RGBA);_.bind(l.LINEAR,l.CLAMP_TO_EDGE);const x=r.createFramebuffer(p[0],p[1],!1);return x.colorAttachment.set(_.texture),x.depthAttachment=new kn(r,x.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=r.createRenderbuffer(r.gl.DEPTH_STENCIL,p[0],p[1]),this._stencilRef=0,x.depthAttachment.set(this._sharedDepthStencil),r.clear({stencil:0})):x.depthAttachment.set(this._sharedDepthStencil),r.extTextureFilterAnisotropic&&!r.extTextureFilterAnisotropicForceOff&&l.texParameterf(l.TEXTURE_2D,r.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,r.extTextureFilterAnisotropicMax),{fb:x,tex:_,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._style.light&&this._style.light.hasTransition())return!0;for(const r in this._style._sourceCaches)if(this._style._sourceCaches[r].hasTransition())return!0;return this._style.order.some(r=>{const l=this._style._layers[r],p=l.isHidden(this.painter.transform.zoom);return l.type!=="custom"&&!p&&l.hasTransition()})}_clearRasterFadeFromRenderCache(){let r=!1;for(const l in this._style._sourceCaches)if(this._style._sourceCaches[l]._source instanceof $){r=!0;break}if(r)for(let l=0;l<this._style.order.length;++l){const p=this._style._layers[this._style.order[l]],_=p.isHidden(this.painter.transform.zoom),x=this._style._getLayerSourceCache(p);if(p.type!=="raster"||_||!x)continue;const T=p.paint.get("raster-fade-duration");for(const C of this.proxyCoords){const M=this.proxyToSource[C.key][x.id];if(M)for(const O of M){const R=vc(x.getTile(O),x.findLoadedParent(O,0),x,this.painter.transform,T);(R.opacity!==1||R.mix!==0)&&this._clearRenderCacheForTile(x.id,O)}}}}_setupDrapedRenderBatches(){const r=this._style.order,l=r.length;if(l===0)return;const p=[];let _,x=0,T=this._style._layers[r[x]];for(;!this._style.isLayerDraped(T)&&T.isHidden(this.painter.transform.zoom)&&++x<l;)T=this._style._layers[r[x]];for(;x<l;++x){const C=this._style._layers[r[x]];C.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(C)?_===void 0&&(_=x):_!==void 0&&(p.push({start:_,end:x-1}),_=void 0))}_!==void 0&&p.push({start:_,end:x-1}),this._drapedRenderBatches=p}_setupRenderCache(r){const l=this.proxySourceCache;if(this._shouldDisableRenderCache()||this._invalidateRenderCache){if(this._invalidateRenderCache=!1,l.renderCache.length>l.renderCachePool.length){const T=Object.values(l.proxyCachedFBO);l.proxyCachedFBO={};for(let C=0;C<T.length;++C){const M=Object.values(T[C]);l.renderCachePool.push(...M)}}return}this._clearRasterFadeFromRenderCache();const p=this.proxyCoords,_=this._tilesDirty;for(let T=p.length-1;T>=0;T--){const C=p[T];if(l.getTileByID(C.key),l.proxyCachedFBO[C.key]!==void 0){const M=r[C.key],O=this.proxyToSource[C.key];let R=0;for(const U in O){const G=O[U],ee=M[U];if(!ee||ee.length!==G.length||G.some((Q,ne)=>Q!==ee[ne]||_[U]&&_[U].hasOwnProperty(Q.key))){R=-1;break}++R}for(const U in l.proxyCachedFBO[C.key])l.renderCache[l.proxyCachedFBO[C.key][U]].dirty=R<0||R!==Object.values(M).length}}const x=[...this._drapedRenderBatches];x.sort((T,C)=>C.end-C.start-(T.end-T.start));for(const T of x)for(const C of p){if(l.proxyCachedFBO[C.key])continue;let M=l.renderCachePool.pop();M===void 0&&l.renderCache.length<50&&(M=l.renderCache.length,l.renderCache.push(this._createFBO())),M!==void 0&&(l.proxyCachedFBO[C.key]={},l.proxyCachedFBO[C.key][T.start]=M,l.renderCache[M].dirty=!0)}this._tilesDirty={}}_setupStencil(r,l,p,_){if(!_||!this._sourceTilesOverlap[_.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const x=this.painter.context,T=x.gl;if(l.length<=1)return void(this._overlapStencilType=!1);let C;if(p.isTileClipped())C=l.length,this._overlapStencilMode.test={func:T.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(l[0].overscaledZ>l[l.length-1].overscaledZ))return void(this._overlapStencilType=!1);C=1,this._overlapStencilMode.test={func:T.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+C>255&&(x.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=C,this._overlapStencilMode.ref=this._stencilRef,p.isTileClipped()&&this._renderTileClippingMasks(l,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(r){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[r.key]),this._overlapStencilMode):o.StencilMode.disabled}_renderTileClippingMasks(r,l){const p=this.painter,_=this.painter.context,x=_.gl;p._tileClippingMaskIDs={},_.setColorMode(o.ColorMode.disabled),_.setDepthMode(o.DepthMode.disabled);const T=p.useProgram("clippingMask");for(const C of r){const M=p._tileClippingMaskIDs[C.key]=--l;T.draw(_,x.TRIANGLES,o.DepthMode.disabled,new o.StencilMode({func:x.ALWAYS,mask:0},M,255,x.KEEP,x.KEEP,x.REPLACE),o.ColorMode.disabled,o.CullFaceMode.disabled,dl(C.projMatrix),"$clipping",p.tileExtentBuffer,p.quadTriangleIndexBuffer,p.tileExtentSegments)}}pointCoordinate(r){const l=this.painter.transform;if(r.x<0||r.x>l.width||r.y<0||r.y>l.height)return null;const p=[r.x,r.y,1,1];o.transformMat4$1(p,p,l.pixelMatrixInverse),o.scale$1(p,p,1/p[3]),p[0]/=l.worldSize,p[1]/=l.worldSize;const _=l._camera.position,x=o.mercatorZfromAltitude(1,l.center.lat),T=[_[0],_[1],_[2]/x,0],C=o.subtract([],p.slice(0,3),T);o.normalize(C,C);const M=this.raycast(T,C,this._exaggeration);return M!==null&&M?(o.scaleAndAdd(T,T,C,M),T[3]=T[2],T[2]*=x,T):null}drawDepth(){const r=this.painter,l=r.context,p=this.proxySourceCache,_=Math.ceil(r.width),x=Math.ceil(r.height);if(!this._depthFBO||this._depthFBO.width===_&&this._depthFBO.height===x||(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),!this._depthFBO){const T=l.gl,C=l.createFramebuffer(_,x,!0);l.activeTexture.set(T.TEXTURE0);const M=new o.Texture(l,{width:_,height:x,data:null},T.RGBA);M.bind(T.NEAREST,T.CLAMP_TO_EDGE),C.colorAttachment.set(M.texture);const O=l.createRenderbuffer(l.gl.DEPTH_COMPONENT16,_,x);C.depthAttachment.set(O),this._depthFBO=C,this._depthTexture=M}l.bindFramebuffer.set(this._depthFBO.framebuffer),l.viewport.set([0,0,_,x]),function(T,C,M,O){if(T.transform.projection.name==="globe")return;const R=T.context,U=R.gl;R.clear({depth:1});const G=T.useProgram("terrainDepth"),ee=new o.DepthMode(U.LESS,o.DepthMode.ReadWrite,T.depthRangeFor3D);for(const Q of O){const ne=M.getTile(Q),H=gc(Q.projMatrix,0);C.setupElevationDraw(ne,G),G.draw(R,U.TRIANGLES,ee,o.StencilMode.disabled,o.ColorMode.unblended,o.CullFaceMode.backCCW,H,"terrain_depth",C.gridBuffer,C.gridIndexBuffer,C.gridNoSkirtSegments)}}(r,this,p,this.proxyCoords)}_setupProxiedCoordsForOrtho(r,l,p){if(r.getSource()instanceof Se)return this._setupProxiedCoordsForImageSource(r,l,p);this._findCoveringTileCache[r.id]=this._findCoveringTileCache[r.id]||{};const _=this.proxiedCoords[r.id]=[],x=this.proxyCoords;for(let C=0;C<x.length;C++){const M=x[C],O=this._findTileCoveringTileID(M,r);if(O){const R=this._createProxiedId(M,O,p[M.key]&&p[M.key][r.id]);_.push(R),this.proxyToSource[M.key][r.id]=[R]}}let T=!1;for(let C=0;C<l.length;C++){const M=r.getTile(l[C]);if(!M||!M.hasData())continue;const O=this._findTileCoveringTileID(M.tileID,this.proxySourceCache);if(O&&O.tileID.canonical.z!==M.tileID.canonical.z){const R=this.proxyToSource[O.tileID.key][r.id],U=this._createProxiedId(O.tileID,M,p[O.tileID.key]&&p[O.tileID.key][r.id]);R?R.splice(R.length-1,0,U):this.proxyToSource[O.tileID.key][r.id]=[U],_.push(U),T=!0}}this._sourceTilesOverlap[r.id]=T}_setupProxiedCoordsForImageSource(r,l,p){if(!r.getSource().loaded())return;const _=this.proxiedCoords[r.id]=[],x=this.proxyCoords,T=r.getSource(),C=new o.pointGeometry(T.tileID.x,T.tileID.y)._div(1<<T.tileID.z),M=T.coordinates.map(o.MercatorCoordinate.fromLngLat).reduce((R,U)=>(R.min.x=Math.min(R.min.x,U.x-C.x),R.min.y=Math.min(R.min.y,U.y-C.y),R.max.x=Math.max(R.max.x,U.x-C.x),R.max.y=Math.max(R.max.y,U.y-C.y),R),{min:new o.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE),max:new o.pointGeometry(-Number.MAX_VALUE,-Number.MAX_VALUE)}),O=(R,U)=>{const G=R.wrap+R.canonical.x/(1<<R.canonical.z),ee=R.canonical.y/(1<<R.canonical.z),Q=o.EXTENT/(1<<R.canonical.z),ne=U.wrap+U.canonical.x/(1<<U.canonical.z),H=U.canonical.y/(1<<U.canonical.z);return G+Q<ne+M.min.x||G>ne+M.max.x||ee+Q<H+M.min.y||ee>H+M.max.y};for(let R=0;R<x.length;R++){const U=x[R];for(let G=0;G<l.length;G++){const ee=r.getTile(l[G]);if(!ee||!ee.hasData()||O(U,ee.tileID))continue;const Q=this._createProxiedId(U,ee,p[U.key]&&p[U.key][r.id]),ne=this.proxyToSource[U.key][r.id];ne?ne.push(Q):this.proxyToSource[U.key][r.id]=[Q],_.push(Q)}}}_createProxiedId(r,l,p){let _=this.orthoMatrix;if(p){const x=p.find(T=>T.key===l.tileID.key);if(x)return x}if(l.tileID.key!==r.key){const x=r.canonical.z-l.tileID.canonical.z;let T,C,M;_=o.create();const O=l.tileID.wrap-r.wrap<<r.overscaledZ;x>0?(T=o.EXTENT>>x,C=T*((l.tileID.canonical.x<<x)-r.canonical.x+O),M=T*((l.tileID.canonical.y<<x)-r.canonical.y)):(T=o.EXTENT<<-x,C=o.EXTENT*(l.tileID.canonical.x-(r.canonical.x+O<<-x)),M=o.EXTENT*(l.tileID.canonical.y-(r.canonical.y<<-x))),o.ortho(_,0,T,0,T,0,1),o.translate(_,_,[C,M,0])}return new eh(l.tileID,r.key,_)}_findTileCoveringTileID(r,l){let p=l.getTile(r);if(p&&p.hasData())return p;const _=this._findCoveringTileCache[l.id],x=_[r.key];if(p=x?l.getTileByID(x):null,p&&p.hasData()||x===null)return p;let T=p?p.tileID:r,C=T.overscaledZ;const M=l.getSource().minzoom,O=[];if(!x){const U=l.getSource().maxzoom;if(r.canonical.z>=U){const G=r.canonical.z-U;l.getSource().reparseOverscaled?(C=Math.max(r.canonical.z+2,l.transform.tileZoom),T=new o.OverscaledTileID(C,r.wrap,U,r.canonical.x>>G,r.canonical.y>>G)):G!==0&&(C=U,T=new o.OverscaledTileID(C,r.wrap,U,r.canonical.x>>G,r.canonical.y>>G))}T.key!==r.key&&(O.push(T.key),p=l.getTile(T))}const R=U=>{O.forEach(G=>{_[G]=U}),O.length=0};for(C-=1;C>=M&&(!p||!p.hasData());C--){p&&R(p.tileID.key);const U=T.calculateScaledKey(C);if(p=l.getTileByID(U),p&&p.hasData())break;const G=_[U];if(G===null)break;G===void 0?O.push(U):p=l.getTileByID(G)}return R(p?p.tileID.key:null),p&&p.hasData()?p:null}findDEMTileFor(r){return this.enabled?this._findTileCoveringTileID(r,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(r,l){let p=this._tilesDirty[r];p||(p=this._tilesDirty[r]={}),p[l.key]=!0}getWirefameBuffer(){if(!this.wireframeSegments){const r=function(l){let p=0;const _=new o.StructArrayLayout2ui4,x=131;for(let T=1;T<129;T++){for(let C=1;C<129;C++)p=T*x+C,_.emplaceBack(p,p+1),_.emplaceBack(p,p+x),_.emplaceBack(p+1,p+x),T===128&&_.emplaceBack(p+x,p+x+1);_.emplaceBack(p+1,p+1+x)}return _}();this.wireframeIndexBuffer=this.painter.context.createIndexBuffer(r),this.wireframeSegments=o.SegmentVector.simpleSegment(0,0,this.gridBuffer.length,r.length)}return[this.wireframeIndexBuffer,this.wireframeSegments]}}class th{static cacheKey(r,l,p,_){let x=`${l}${_?_.cacheKey:""}`;for(const T of p)r.usedDefines.includes(T)&&(x+=`/${T}`);return x}constructor(r,l,p,_,x,T){const C=r.gl;this.program=C.createProgram();const M=function(H){const X=[];for(let re=0;re<H.length;re++){if(H[re]===null)continue;const ie=H[re].split(" ");X.push(ie.pop())}return X}(p.staticAttributes),O=_?_.getBinderAttributes():[],R=M.concat(O);let U=_?_.defines():[];U=U.concat(T.map(H=>`#define ${H}`));const G=U.concat(r.extStandardDerivatives?`#extension GL_OES_standard_derivatives : enable
`.concat(cl):cl,cl,Jd,Ku.fragmentSource,pc.fragmentSource,p.fragmentSource).join(`
`),ee=U.concat(`
#ifdef GL_ES
precision highp float;
#else

#if !defined(lowp)
#define lowp
#endif

#if !defined(mediump)
#define mediump
#endif

#if !defined(highp)
#define highp
#endif

#endif`,Jd,Ku.vertexSource,pc.vertexSource,Qd.vertexSource,p.vertexSource).join(`
`),Q=C.createShader(C.FRAGMENT_SHADER);if(C.isContextLost())return void(this.failedToCreate=!0);C.shaderSource(Q,G),C.compileShader(Q),C.attachShader(this.program,Q);const ne=C.createShader(C.VERTEX_SHADER);if(C.isContextLost())this.failedToCreate=!0;else{C.shaderSource(ne,ee),C.compileShader(ne),C.attachShader(this.program,ne),this.attributes={},this.numAttributes=R.length;for(let H=0;H<this.numAttributes;H++)R[H]&&(C.bindAttribLocation(this.program,H,R[H]),this.attributes[R[H]]=H);C.linkProgram(this.program),C.deleteShader(ne),C.deleteShader(Q),this.fixedUniforms=x(r),this.binderUniforms=_?_.getUniforms(r):[],T.includes("TERRAIN")&&(this.terrainUniforms=(H=>({u_dem:new o.Uniform1i(H),u_dem_prev:new o.Uniform1i(H),u_dem_unpack:new o.Uniform4f(H),u_dem_tl:new o.Uniform2f(H),u_dem_scale:new o.Uniform1f(H),u_dem_tl_prev:new o.Uniform2f(H),u_dem_scale_prev:new o.Uniform1f(H),u_dem_size:new o.Uniform1f(H),u_dem_lerp:new o.Uniform1f(H),u_exaggeration:new o.Uniform1f(H),u_depth:new o.Uniform1i(H),u_depth_size_inv:new o.Uniform2f(H),u_meter_to_dem:new o.Uniform1f(H),u_label_plane_matrix_inv:new o.UniformMatrix4f(H)}))(r)),T.includes("GLOBE")&&(this.globeUniforms=(H=>({u_tile_tl_up:new o.Uniform3f(H),u_tile_tr_up:new o.Uniform3f(H),u_tile_br_up:new o.Uniform3f(H),u_tile_bl_up:new o.Uniform3f(H),u_tile_up_scale:new o.Uniform1f(H)}))(r)),T.includes("FOG")&&(this.fogUniforms=(H=>({u_fog_matrix:new o.UniformMatrix4f(H),u_fog_range:new o.Uniform2f(H),u_fog_color:new o.Uniform4f(H),u_fog_horizon_blend:new o.Uniform1f(H),u_fog_temporal_offset:new o.Uniform1f(H),u_frustum_tl:new o.Uniform3f(H),u_frustum_tr:new o.Uniform3f(H),u_frustum_br:new o.Uniform3f(H),u_frustum_bl:new o.Uniform3f(H),u_globe_pos:new o.Uniform3f(H),u_globe_radius:new o.Uniform1f(H),u_globe_transition:new o.Uniform1f(H),u_is_globe:new o.Uniform1i(H),u_viewport:new o.Uniform2f(H)}))(r))}}setTerrainUniformValues(r,l){if(!this.terrainUniforms)return;const p=this.terrainUniforms;if(!this.failedToCreate){r.program.set(this.program);for(const _ in l)p[_]&&p[_].set(this.program,_,l[_])}}setGlobeUniformValues(r,l){if(!this.globeUniforms)return;const p=this.globeUniforms;if(!this.failedToCreate){r.program.set(this.program);for(const _ in l)p[_]&&p[_].set(this.program,_,l[_])}}setFogUniformValues(r,l){if(!this.fogUniforms)return;const p=this.fogUniforms;if(!this.failedToCreate){r.program.set(this.program);for(const _ in l)p[_].set(this.program,_,l[_])}}draw(r,l,p,_,x,T,C,M,O,R,U,G,ee,Q,ne){const H=r.gl;if(this.failedToCreate)return;r.program.set(this.program),r.setDepthMode(p),r.setStencilMode(_),r.setColorMode(x),r.setCullFace(T);for(const re of Object.keys(this.fixedUniforms))this.fixedUniforms[re].set(this.program,re,C[re]);Q&&Q.setUniforms(this.program,r,this.binderUniforms,G,{zoom:ee});const X={[H.LINES]:2,[H.TRIANGLES]:3,[H.LINE_STRIP]:1}[l];for(const re of U.get()){const ie=re.vaos||(re.vaos={});(ie[M]||(ie[M]=new ef)).bind(r,this,O,Q?Q.getPaintVertexBuffers():[],R,re.vertexOffset,ne||[]),H.drawElements(l,re.primitiveLength*X,H.UNSIGNED_SHORT,re.primitiveOffset*X*2)}}}function bc(h,r){const l=Math.pow(2,r.tileID.overscaledZ),p=r.tileSize*Math.pow(2,h.transform.tileZoom)/l,_=p*(r.tileID.canonical.x+r.tileID.wrap*l),x=p*r.tileID.canonical.y;return{u_image:0,u_texsize:r.imageAtlasTexture.size,u_tile_units_to_pixels:1/xn(r,1,h.transform.tileZoom),u_pixel_coord_upper:[_>>16,x>>16],u_pixel_coord_lower:[65535&_,65535&x]}}const nf=o.create(),rf=(h,r,l,p,_,x,T,C,M,O,R)=>{const U=r.style.light,G=U.properties.get("position"),ee=[G.x,G.y,G.z],Q=o.create$1();U.properties.get("anchor")==="viewport"&&(o.fromRotation(Q,-r.transform.angle),o.transformMat3(ee,ee,Q));const ne=U.properties.get("color"),H=r.transform,X={u_matrix:h,u_lightpos:ee,u_lightintensity:U.properties.get("intensity"),u_lightcolor:[ne.r,ne.g,ne.b],u_vertical_gradient:+l,u_opacity:p,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:nf,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_ao:_,u_edge_radius:x};return H.projection.name==="globe"&&(X.u_tile_id=[T.canonical.x,T.canonical.y,1<<T.canonical.z],X.u_zoom_transition=M,X.u_inv_rot_matrix=R,X.u_merc_center=O,X.u_up_dir=H.projection.upVector(new o.CanonicalTileID(0,0,0),O[0]*o.EXTENT,O[1]*o.EXTENT),X.u_height_lift=C),X},gg=(h,r,l,p,_,x,T,C,M,O,R,U)=>{const G=rf(h,r,l,p,_,x,T,M,O,R,U),ee={u_height_factor:-Math.pow(2,T.overscaledZ)/C.tileSize/8};return o.extend(G,bc(r,C),ee)},wc=h=>({u_matrix:h}),Ec=(h,r,l)=>o.extend(wc(h),bc(r,l)),nh=(h,r)=>({u_matrix:h,u_world:r}),ih=(h,r,l,p)=>o.extend(Ec(h,r,l),{u_world:p}),of=o.create(),sf=(h,r,l,p,_,x)=>{const T=h.transform,C=T.projection.name==="globe";let M;if(x.paint.get("circle-pitch-alignment")==="map")if(C){const R=o.globePixelsToTileUnits(T.zoom,r.canonical)*T._pixelsPerMercatorPixel;M=Float32Array.from([R,0,0,R])}else M=T.calculatePixelsToTileUnitsMatrix(l);else M=new Float32Array([T.pixelsToGLUnits[0],0,0,T.pixelsToGLUnits[1]]);const O={u_camera_to_center_distance:T.cameraToCenterDistance,u_matrix:h.translatePosMatrix(r.projMatrix,l,x.paint.get("circle-translate"),x.paint.get("circle-translate-anchor")),u_device_pixel_ratio:o.exported.devicePixelRatio,u_extrude_scale:M,u_inv_rot_matrix:of,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(C){O.u_inv_rot_matrix=p,O.u_merc_center=_,O.u_tile_id=[r.canonical.x,r.canonical.y,1<<r.canonical.z],O.u_zoom_transition=o.globeToMercatorTransition(T.zoom);const R=_[0]*o.EXTENT,U=_[1]*o.EXTENT;O.u_up_dir=T.projection.upVector(new o.CanonicalTileID(0,0,0),R,U)}return O},_g=h=>{const r=[];return h.paint.get("circle-pitch-alignment")==="map"&&r.push("PITCH_WITH_MAP"),h.paint.get("circle-pitch-scale")==="map"&&r.push("SCALE_WITH_MAP"),r},fl=(h,r,l,p)=>{const _=o.EXTENT/l.tileSize;return{u_matrix:h,u_camera_to_center_distance:r.getCameraToCenterDistance(p),u_extrude_scale:[r.pixelsToGLUnits[0]/_,r.pixelsToGLUnits[1]/_]}},ua=(h,r,l=1)=>({u_matrix:h,u_color:r,u_overlay:0,u_overlay_scale:l}),af=o.create(),Tc=(h,r,l,p,_,x,T)=>{const C=h.transform,M=C.projection.name==="globe",O=M?o.globePixelsToTileUnits(C.zoom,r.canonical)*C._pixelsPerMercatorPixel:xn(l,1,x),R={u_matrix:r.projMatrix,u_extrude_scale:O,u_intensity:T,u_inv_rot_matrix:af,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(M){R.u_inv_rot_matrix=p,R.u_merc_center=_,R.u_tile_id=[r.canonical.x,r.canonical.y,1<<r.canonical.z],R.u_zoom_transition=o.globeToMercatorTransition(C.zoom);const U=_[0]*o.EXTENT,G=_[1]*o.EXTENT;R.u_up_dir=C.projection.upVector(new o.CanonicalTileID(0,0,0),U,G)}return R},rh=(h,r,l,p,_,x,T)=>{const C=h.transform,M=C.calculatePixelsToTileUnitsMatrix(r);return{u_matrix:oh(h,r,l,p),u_pixels_to_tile_units:M,u_device_pixel_ratio:x,u_units_to_pixels:[1/C.pixelsToGLUnits[0],1/C.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:_,u_texsize:Cc(l)?r.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:Sc(r,h.transform),u_alpha_discard_threshold:0,u_trim_offset:T}},_o=(h,r,l,p,_)=>{const x=h.transform;return{u_matrix:oh(h,r,l,p),u_texsize:r.imageAtlasTexture.size,u_pixels_to_tile_units:x.calculatePixelsToTileUnitsMatrix(r),u_device_pixel_ratio:_,u_image:0,u_tile_units_to_pixels:Sc(r,x),u_units_to_pixels:[1/x.pixelsToGLUnits[0],1/x.pixelsToGLUnits[1]],u_alpha_discard_threshold:0}};function Sc(h,r){return 1/xn(h,1,r.tileZoom)}function oh(h,r,l,p){return h.translatePosMatrix(p||r.tileID.projMatrix,r,l.paint.get("line-translate"),l.paint.get("line-translate-anchor"))}function Cc(h){const r=h.paint.get("line-dasharray").value;return r.value||r.kind!=="constant"}const lf=(h,r,l,p,_,x)=>{return{u_matrix:h,u_tl_parent:r,u_scale_parent:l,u_fade_t:p.mix,u_opacity:p.opacity*_.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:_.paint.get("raster-brightness-min"),u_brightness_high:_.paint.get("raster-brightness-max"),u_saturation_factor:(C=_.paint.get("raster-saturation"),C>0?1-1/(1.001-C):-C),u_contrast_factor:(T=_.paint.get("raster-contrast"),T>0?1/(1-T):1+T),u_spin_weights:sh(_.paint.get("raster-hue-rotate")),u_perspective_transform:x};var T,C};function sh(h){h*=Math.PI/180;const r=Math.sin(h),l=Math.cos(h);return[(2*l+1)/3,(-Math.sqrt(3)*r-l+1)/3,(Math.sqrt(3)*r-l+1)/3]}const cf=o.create(),Ac=(h,r,l,p,_,x,T,C,M,O,R,U,G,ee,Q,ne)=>{const H=_.transform,X={u_is_size_zoom_constant:+(h==="constant"||h==="source"),u_is_size_feature_constant:+(h==="constant"||h==="camera"),u_size_t:r?r.uSizeT:0,u_size:r?r.uSize:0,u_camera_to_center_distance:H.cameraToCenterDistance,u_rotate_symbol:+l,u_aspect_ratio:H.width/H.height,u_fade_change:_.options.fadeDuration?_.symbolFadeChange:1,u_matrix:x,u_label_plane_matrix:T,u_coord_matrix:C,u_is_text:+M,u_pitch_with_map:+p,u_texsize:O,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:cf,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:cf,u_up_vector:[0,-1,0]};return ne.name==="globe"&&(X.u_tile_id=[R.canonical.x,R.canonical.y,1<<R.canonical.z],X.u_zoom_transition=U,X.u_inv_rot_matrix=ee,X.u_merc_center=G,X.u_camera_forward=H._camera.forward(),X.u_ecef_origin=o.globeECEFOrigin(H.globeMatrix,R.toUnwrapped()),X.u_tile_matrix=Float32Array.from(H.globeMatrix),X.u_up_vector=Q),X},uf=(h,r,l,p,_,x,T,C,M,O,R,U,G,ee,Q,ne,H)=>o.extend(Ac(h,r,l,p,_,x,T,C,M,O,U,G,ee,Q,ne,H),{u_gamma_scale:p?_.transform.cameraToCenterDistance*Math.cos(_.terrain?0:_.transform._pitch):1,u_device_pixel_ratio:o.exported.devicePixelRatio,u_is_halo:+R}),Mc=(h,r,l,p,_,x,T,C,M,O,R,U,G,ee,Q,ne)=>o.extend(uf(h,r,l,p,_,x,T,C,!0,M,!0,R,U,G,ee,Q,ne),{u_texsize_icon:O,u_texture_icon:1}),yg=(h,r,l)=>({u_matrix:h,u_opacity:r,u_color:l}),ah=(h,r,l,p,_)=>o.extend(function(x,T,C){const M=T.imageManager.getPattern(x.toString()),{width:O,height:R}=T.imageManager.getPixelSize(),U=Math.pow(2,C.tileID.overscaledZ),G=C.tileSize*Math.pow(2,T.transform.tileZoom)/U,ee=G*(C.tileID.canonical.x+C.tileID.wrap*U),Q=G*C.tileID.canonical.y;return{u_image:0,u_pattern_tl:M.tl,u_pattern_br:M.br,u_texsize:[O,R],u_pattern_size:M.displaySize,u_tile_units_to_pixels:1/xn(C,1,T.transform.tileZoom),u_pixel_coord_upper:[ee>>16,Q>>16],u_pixel_coord_lower:[65535&ee,65535&Q]}}(p,l,_),{u_matrix:h,u_opacity:r}),vg={fillExtrusion:h=>({u_matrix:new o.UniformMatrix4f(h),u_lightpos:new o.Uniform3f(h),u_lightintensity:new o.Uniform1f(h),u_lightcolor:new o.Uniform3f(h),u_vertical_gradient:new o.Uniform1f(h),u_opacity:new o.Uniform1f(h),u_edge_radius:new o.Uniform1f(h),u_ao:new o.Uniform2f(h),u_tile_id:new o.Uniform3f(h),u_zoom_transition:new o.Uniform1f(h),u_inv_rot_matrix:new o.UniformMatrix4f(h),u_merc_center:new o.Uniform2f(h),u_up_dir:new o.Uniform3f(h),u_height_lift:new o.Uniform1f(h)}),fillExtrusionPattern:h=>({u_matrix:new o.UniformMatrix4f(h),u_lightpos:new o.Uniform3f(h),u_lightintensity:new o.Uniform1f(h),u_lightcolor:new o.Uniform3f(h),u_vertical_gradient:new o.Uniform1f(h),u_height_factor:new o.Uniform1f(h),u_edge_radius:new o.Uniform1f(h),u_ao:new o.Uniform2f(h),u_tile_id:new o.Uniform3f(h),u_zoom_transition:new o.Uniform1f(h),u_inv_rot_matrix:new o.UniformMatrix4f(h),u_merc_center:new o.Uniform2f(h),u_up_dir:new o.Uniform3f(h),u_height_lift:new o.Uniform1f(h),u_image:new o.Uniform1i(h),u_texsize:new o.Uniform2f(h),u_pixel_coord_upper:new o.Uniform2f(h),u_pixel_coord_lower:new o.Uniform2f(h),u_tile_units_to_pixels:new o.Uniform1f(h),u_opacity:new o.Uniform1f(h)}),fill:h=>({u_matrix:new o.UniformMatrix4f(h)}),fillPattern:h=>({u_matrix:new o.UniformMatrix4f(h),u_image:new o.Uniform1i(h),u_texsize:new o.Uniform2f(h),u_pixel_coord_upper:new o.Uniform2f(h),u_pixel_coord_lower:new o.Uniform2f(h),u_tile_units_to_pixels:new o.Uniform1f(h)}),fillOutline:h=>({u_matrix:new o.UniformMatrix4f(h),u_world:new o.Uniform2f(h)}),fillOutlinePattern:h=>({u_matrix:new o.UniformMatrix4f(h),u_world:new o.Uniform2f(h),u_image:new o.Uniform1i(h),u_texsize:new o.Uniform2f(h),u_pixel_coord_upper:new o.Uniform2f(h),u_pixel_coord_lower:new o.Uniform2f(h),u_tile_units_to_pixels:new o.Uniform1f(h)}),circle:h=>({u_camera_to_center_distance:new o.Uniform1f(h),u_extrude_scale:new o.UniformMatrix2f(h),u_device_pixel_ratio:new o.Uniform1f(h),u_matrix:new o.UniformMatrix4f(h),u_inv_rot_matrix:new o.UniformMatrix4f(h),u_merc_center:new o.Uniform2f(h),u_tile_id:new o.Uniform3f(h),u_zoom_transition:new o.Uniform1f(h),u_up_dir:new o.Uniform3f(h)}),collisionBox:h=>({u_matrix:new o.UniformMatrix4f(h),u_camera_to_center_distance:new o.Uniform1f(h),u_extrude_scale:new o.Uniform2f(h)}),collisionCircle:h=>({u_matrix:new o.UniformMatrix4f(h),u_inv_matrix:new o.UniformMatrix4f(h),u_camera_to_center_distance:new o.Uniform1f(h),u_viewport_size:new o.Uniform2f(h)}),debug:h=>({u_color:new o.UniformColor(h),u_matrix:new o.UniformMatrix4f(h),u_overlay:new o.Uniform1i(h),u_overlay_scale:new o.Uniform1f(h)}),clippingMask:h=>({u_matrix:new o.UniformMatrix4f(h)}),heatmap:h=>({u_extrude_scale:new o.Uniform1f(h),u_intensity:new o.Uniform1f(h),u_matrix:new o.UniformMatrix4f(h),u_inv_rot_matrix:new o.UniformMatrix4f(h),u_merc_center:new o.Uniform2f(h),u_tile_id:new o.Uniform3f(h),u_zoom_transition:new o.Uniform1f(h),u_up_dir:new o.Uniform3f(h)}),heatmapTexture:h=>({u_image:new o.Uniform1i(h),u_color_ramp:new o.Uniform1i(h),u_opacity:new o.Uniform1f(h)}),hillshade:h=>({u_matrix:new o.UniformMatrix4f(h),u_image:new o.Uniform1i(h),u_latrange:new o.Uniform2f(h),u_light:new o.Uniform2f(h),u_shadow:new o.UniformColor(h),u_highlight:new o.UniformColor(h),u_accent:new o.UniformColor(h)}),hillshadePrepare:h=>({u_matrix:new o.UniformMatrix4f(h),u_image:new o.Uniform1i(h),u_dimension:new o.Uniform2f(h),u_zoom:new o.Uniform1f(h),u_unpack:new o.Uniform4f(h)}),line:h=>({u_matrix:new o.UniformMatrix4f(h),u_pixels_to_tile_units:new o.UniformMatrix2f(h),u_device_pixel_ratio:new o.Uniform1f(h),u_units_to_pixels:new o.Uniform2f(h),u_dash_image:new o.Uniform1i(h),u_gradient_image:new o.Uniform1i(h),u_image_height:new o.Uniform1f(h),u_texsize:new o.Uniform2f(h),u_tile_units_to_pixels:new o.Uniform1f(h),u_alpha_discard_threshold:new o.Uniform1f(h),u_trim_offset:new o.Uniform2f(h)}),linePattern:h=>({u_matrix:new o.UniformMatrix4f(h),u_texsize:new o.Uniform2f(h),u_pixels_to_tile_units:new o.UniformMatrix2f(h),u_device_pixel_ratio:new o.Uniform1f(h),u_image:new o.Uniform1i(h),u_units_to_pixels:new o.Uniform2f(h),u_tile_units_to_pixels:new o.Uniform1f(h),u_alpha_discard_threshold:new o.Uniform1f(h)}),raster:h=>({u_matrix:new o.UniformMatrix4f(h),u_tl_parent:new o.Uniform2f(h),u_scale_parent:new o.Uniform1f(h),u_fade_t:new o.Uniform1f(h),u_opacity:new o.Uniform1f(h),u_image0:new o.Uniform1i(h),u_image1:new o.Uniform1i(h),u_brightness_low:new o.Uniform1f(h),u_brightness_high:new o.Uniform1f(h),u_saturation_factor:new o.Uniform1f(h),u_contrast_factor:new o.Uniform1f(h),u_spin_weights:new o.Uniform3f(h),u_perspective_transform:new o.Uniform2f(h)}),symbolIcon:h=>({u_is_size_zoom_constant:new o.Uniform1i(h),u_is_size_feature_constant:new o.Uniform1i(h),u_size_t:new o.Uniform1f(h),u_size:new o.Uniform1f(h),u_camera_to_center_distance:new o.Uniform1f(h),u_rotate_symbol:new o.Uniform1i(h),u_aspect_ratio:new o.Uniform1f(h),u_fade_change:new o.Uniform1f(h),u_matrix:new o.UniformMatrix4f(h),u_label_plane_matrix:new o.UniformMatrix4f(h),u_coord_matrix:new o.UniformMatrix4f(h),u_is_text:new o.Uniform1i(h),u_pitch_with_map:new o.Uniform1i(h),u_texsize:new o.Uniform2f(h),u_tile_id:new o.Uniform3f(h),u_zoom_transition:new o.Uniform1f(h),u_inv_rot_matrix:new o.UniformMatrix4f(h),u_merc_center:new o.Uniform2f(h),u_camera_forward:new o.Uniform3f(h),u_tile_matrix:new o.UniformMatrix4f(h),u_up_vector:new o.Uniform3f(h),u_ecef_origin:new o.Uniform3f(h),u_texture:new o.Uniform1i(h)}),symbolSDF:h=>({u_is_size_zoom_constant:new o.Uniform1i(h),u_is_size_feature_constant:new o.Uniform1i(h),u_size_t:new o.Uniform1f(h),u_size:new o.Uniform1f(h),u_camera_to_center_distance:new o.Uniform1f(h),u_rotate_symbol:new o.Uniform1i(h),u_aspect_ratio:new o.Uniform1f(h),u_fade_change:new o.Uniform1f(h),u_matrix:new o.UniformMatrix4f(h),u_label_plane_matrix:new o.UniformMatrix4f(h),u_coord_matrix:new o.UniformMatrix4f(h),u_is_text:new o.Uniform1i(h),u_pitch_with_map:new o.Uniform1i(h),u_texsize:new o.Uniform2f(h),u_texture:new o.Uniform1i(h),u_gamma_scale:new o.Uniform1f(h),u_device_pixel_ratio:new o.Uniform1f(h),u_tile_id:new o.Uniform3f(h),u_zoom_transition:new o.Uniform1f(h),u_inv_rot_matrix:new o.UniformMatrix4f(h),u_merc_center:new o.Uniform2f(h),u_camera_forward:new o.Uniform3f(h),u_tile_matrix:new o.UniformMatrix4f(h),u_up_vector:new o.Uniform3f(h),u_ecef_origin:new o.Uniform3f(h),u_is_halo:new o.Uniform1i(h)}),symbolTextAndIcon:h=>({u_is_size_zoom_constant:new o.Uniform1i(h),u_is_size_feature_constant:new o.Uniform1i(h),u_size_t:new o.Uniform1f(h),u_size:new o.Uniform1f(h),u_camera_to_center_distance:new o.Uniform1f(h),u_rotate_symbol:new o.Uniform1i(h),u_aspect_ratio:new o.Uniform1f(h),u_fade_change:new o.Uniform1f(h),u_matrix:new o.UniformMatrix4f(h),u_label_plane_matrix:new o.UniformMatrix4f(h),u_coord_matrix:new o.UniformMatrix4f(h),u_is_text:new o.Uniform1i(h),u_pitch_with_map:new o.Uniform1i(h),u_texsize:new o.Uniform2f(h),u_texsize_icon:new o.Uniform2f(h),u_texture:new o.Uniform1i(h),u_texture_icon:new o.Uniform1i(h),u_gamma_scale:new o.Uniform1f(h),u_device_pixel_ratio:new o.Uniform1f(h),u_is_halo:new o.Uniform1i(h)}),background:h=>({u_matrix:new o.UniformMatrix4f(h),u_opacity:new o.Uniform1f(h),u_color:new o.UniformColor(h)}),backgroundPattern:h=>({u_matrix:new o.UniformMatrix4f(h),u_opacity:new o.Uniform1f(h),u_image:new o.Uniform1i(h),u_pattern_tl:new o.Uniform2f(h),u_pattern_br:new o.Uniform2f(h),u_texsize:new o.Uniform2f(h),u_pattern_size:new o.Uniform2f(h),u_pixel_coord_upper:new o.Uniform2f(h),u_pixel_coord_lower:new o.Uniform2f(h),u_tile_units_to_pixels:new o.Uniform1f(h)}),terrainRaster:hl,terrainDepth:hl,skybox:h=>({u_matrix:new o.UniformMatrix4f(h),u_sun_direction:new o.Uniform3f(h),u_cubemap:new o.Uniform1i(h),u_opacity:new o.Uniform1f(h),u_temporal_offset:new o.Uniform1f(h)}),skyboxGradient:h=>({u_matrix:new o.UniformMatrix4f(h),u_color_ramp:new o.Uniform1i(h),u_center_direction:new o.Uniform3f(h),u_radius:new o.Uniform1f(h),u_opacity:new o.Uniform1f(h),u_temporal_offset:new o.Uniform1f(h)}),skyboxCapture:h=>({u_matrix_3f:new o.UniformMatrix3f(h),u_sun_direction:new o.Uniform3f(h),u_sun_intensity:new o.Uniform1f(h),u_color_tint_r:new o.Uniform4f(h),u_color_tint_m:new o.Uniform4f(h),u_luminance:new o.Uniform1f(h)}),globeRaster:h=>({u_proj_matrix:new o.UniformMatrix4f(h),u_globe_matrix:new o.UniformMatrix4f(h),u_normalize_matrix:new o.UniformMatrix4f(h),u_merc_matrix:new o.UniformMatrix4f(h),u_zoom_transition:new o.Uniform1f(h),u_merc_center:new o.Uniform2f(h),u_image0:new o.Uniform1i(h),u_grid_matrix:new o.UniformMatrix3f(h),u_frustum_tl:new o.Uniform3f(h),u_frustum_tr:new o.Uniform3f(h),u_frustum_br:new o.Uniform3f(h),u_frustum_bl:new o.Uniform3f(h),u_globe_pos:new o.Uniform3f(h),u_globe_radius:new o.Uniform1f(h),u_viewport:new o.Uniform2f(h)}),globeAtmosphere:h=>({u_frustum_tl:new o.Uniform3f(h),u_frustum_tr:new o.Uniform3f(h),u_frustum_br:new o.Uniform3f(h),u_frustum_bl:new o.Uniform3f(h),u_horizon:new o.Uniform1f(h),u_transition:new o.Uniform1f(h),u_fadeout_range:new o.Uniform1f(h),u_color:new o.Uniform4f(h),u_high_color:new o.Uniform4f(h),u_space_color:new o.Uniform4f(h),u_star_intensity:new o.Uniform1f(h),u_star_density:new o.Uniform1f(h),u_star_size:new o.Uniform1f(h),u_temporal_offset:new o.Uniform1f(h),u_horizon_angle:new o.Uniform1f(h),u_rotation_matrix:new o.UniformMatrix4f(h)})};let ha;function hf(h,r,l,p,_,x,T){const C=h.context,M=C.gl,O=h.transform,R=h.useProgram("collisionBox"),U=[];let G=0,ee=0;for(let he=0;he<p.length;he++){const Ee=p[he],xe=r.getTile(Ee),Pe=xe.getBucket(l);if(!Pe)continue;const We=el(Ee,Pe,O);let je=We;_[0]===0&&_[1]===0||(je=h.translatePosMatrix(We,xe,_,x));const Le=T?Pe.textCollisionBox:Pe.iconCollisionBox,It=Pe.collisionCircleArray;if(It.length>0){const Ue=o.create(),st=je;o.mul(Ue,Pe.placementInvProjMatrix,O.glCoordMatrix),o.mul(Ue,Ue,Pe.placementViewportMatrix),U.push({circleArray:It,circleOffset:ee,transform:st,invTransform:Ue,projection:Pe.getProjection()}),G+=It.length/4,ee=G}Le&&(h.terrain&&h.terrain.setupElevationDraw(xe,R),R.draw(C,M.LINES,o.DepthMode.disabled,o.StencilMode.disabled,h.colorModeForRenderPass(),o.CullFaceMode.disabled,fl(je,O,xe,Pe.getProjection()),l.id,Le.layoutVertexBuffer,Le.indexBuffer,Le.segments,null,O.zoom,null,[Le.collisionVertexBuffer,Le.collisionVertexBufferExt]))}if(!T||!U.length)return;const Q=h.useProgram("collisionCircle"),ne=new o.StructArrayLayout2f1f2i16;ne.resize(4*G),ne._trim();let H=0;for(const he of U)for(let Ee=0;Ee<he.circleArray.length/4;Ee++){const xe=4*Ee,Pe=he.circleArray[xe+0],We=he.circleArray[xe+1],je=he.circleArray[xe+2],Le=he.circleArray[xe+3];ne.emplace(H++,Pe,We,je,Le,0),ne.emplace(H++,Pe,We,je,Le,1),ne.emplace(H++,Pe,We,je,Le,2),ne.emplace(H++,Pe,We,je,Le,3)}(!ha||ha.length<2*G)&&(ha=function(he){const Ee=2*he,xe=new o.StructArrayLayout3ui6;xe.resize(Ee),xe._trim();for(let Pe=0;Pe<Ee;Pe++){const We=6*Pe;xe.uint16[We+0]=4*Pe+0,xe.uint16[We+1]=4*Pe+1,xe.uint16[We+2]=4*Pe+2,xe.uint16[We+3]=4*Pe+2,xe.uint16[We+4]=4*Pe+3,xe.uint16[We+5]=4*Pe+0}return xe}(G));const X=C.createIndexBuffer(ha,!0),re=C.createVertexBuffer(ne,o.collisionCircleLayout.members,!0);for(const he of U){const Ee={u_matrix:he.transform,u_inv_matrix:he.invTransform,u_camera_to_center_distance:(ie=O).getCameraToCenterDistance(he.projection),u_viewport_size:[ie.width,ie.height]};Q.draw(C,M.TRIANGLES,o.DepthMode.disabled,o.StencilMode.disabled,h.colorModeForRenderPass(),o.CullFaceMode.disabled,Ee,l.id,re,X,o.SegmentVector.simpleSegment(0,2*he.circleOffset,he.circleArray.length,he.circleArray.length/2),null,O.zoom)}var ie;re.destroy(),X.destroy()}const pl=o.create();function xg({width:h,height:r,anchor:l,textOffset:p,textScale:_},x){const{horizontalAlign:T,verticalAlign:C}=o.getAnchorAlignment(l),M=-(T-.5)*h,O=-(C-.5)*r,R=o.evaluateVariableOffset(l,p);return new o.pointGeometry((M/_+R[0])*x,(O/_+R[1])*x)}function df(h,r,l,p,_,x,T,C,M,O,R){const U=h.text.placedSymbolArray,G=h.text.dynamicLayoutVertexArray,ee=h.icon.dynamicLayoutVertexArray,Q={},ne=h.getProjection(),H=tl(C,ne,x),X=x.elevation,re=ne.upVectorScale(C.canonical,x.center.lat,x.worldSize).metersToTile;G.clear();for(let ie=0;ie<U.length;ie++){const he=U.get(ie),{tileAnchorX:Ee,tileAnchorY:xe,numGlyphs:Pe}=he,We=h.allowVerticalPlacement&&!he.placedOrientation,je=he.hidden||!he.crossTileID||We?null:p[he.crossTileID];if(je){let Le=0,It=0,Ue=0;if(X){const Qt=X?X.getAtTileOffset(C,Ee,xe):0,[ln,Jt,mn]=ne.upVector(C.canonical,Ee,xe);Le=Qt*ln*re,It=Qt*Jt*re,Ue=Qt*mn*re}let[st,Xe,Et,Je]=xr(he.projectedAnchorX+Le,he.projectedAnchorY+It,he.projectedAnchorZ+Ue,l?H:T);const pt=qt(x.getCameraToCenterDistance(ne),Je);let Pt=_.evaluateSizeForFeature(h.textSizeData,O,he)*pt/o.ONE_EM;l&&(Pt*=h.tilePixelRatio/M);const De=xg(je,Pt);l?({x:st,y:Xe,z:Et}=ne.projectTilePoint(Ee+De.x,xe+De.y,C.canonical),[st,Xe,Et]=xr(st+Le,Xe+It,Et+Ue,T)):(r&&De._rotate(-x.angle),st+=De.x,Xe+=De.y,Et=0);const He=h.allowVerticalPlacement&&he.placedOrientation===o.WritingMode.vertical?Math.PI/2:0;for(let Qt=0;Qt<Pe;Qt++)o.addDynamicAttributes(G,st,Xe,Et,He);R&&he.associatedIconIndex>=0&&(Q[he.associatedIconIndex]={x:st,y:Xe,z:Et,angle:He})}else nr(Pe,G)}if(R){ee.clear();const ie=h.icon.placedSymbolArray;for(let he=0;he<ie.length;he++){const Ee=ie.get(he),{numGlyphs:xe}=Ee,Pe=Q[he];if(Ee.hidden||!Pe)nr(xe,ee);else{const{x:We,y:je,z:Le,angle:It}=Pe;for(let Ue=0;Ue<xe;Ue++)o.addDynamicAttributes(ee,We,je,Le,It)}}h.icon.dynamicLayoutVertexBuffer.updateData(ee)}h.text.dynamicLayoutVertexBuffer.updateData(G)}function ff(h,r,l){return l.iconsInText&&r?"symbolTextAndIcon":h?"symbolSDF":"symbolIcon"}function Ps(h,r,l,p,_,x,T,C,M,O,R,U){const G=h.context,ee=G.gl,Q=h.transform,ne=C==="map",H=M==="map",X=ne&&l.layout.get("symbol-placement")!=="point",re=ne&&!H&&!X,ie=l.layout.get("symbol-sort-key").constantOr(1)!==void 0;let he=!1;const Ee=h.depthModeForSublayer(0,o.DepthMode.ReadOnly),xe=[o.mercatorXfromLng(Q.center.lng),o.mercatorYfromLat(Q.center.lat)],Pe=l.layout.get("text-variable-anchor"),We=Q.projection.name==="globe",je=[],Le=[0,-1,0];let It=Le;!We&&!Q.mercatorFromTransition||ne||(It=function(Ue){const st=Ue._camera.getWorldToCamera(Ue.worldSize,1),Xe=o.multiply([],st,Ue.globeMatrix);o.invert(Xe,Xe);const Et=[0,0,0],Je=[0,1,0,0];return o.transformMat4$1(Je,Je,Xe),Et[0]=Je[0],Et[1]=Je[1],Et[2]=Je[2],o.normalize(Et,Et),Et}(Q));for(const Ue of p){const st=r.getTile(Ue),Xe=st.getBucket(l);if(!Xe||Xe.projection.name==="mercator"&&We)continue;const Et=_?Xe.text:Xe.icon;if(!Et||Xe.fullyClipped||!Et.segments.get().length)continue;const Je=Et.programConfigurations.get(l.id),pt=_||Xe.sdfIcons,Pt=_?Xe.textSizeData:Xe.iconSizeData,De=H||Q.pitch!==0,He=o.evaluateSizeForZoom(Pt,Q.zoom);let Qt,ln,Jt,mn,Sn=[0,0],cn=null;if(_){if(ln=st.glyphAtlasTexture,Jt=ee.LINEAR,Qt=st.glyphAtlasTexture.size,Xe.iconsInText){Sn=st.imageAtlasTexture.size,cn=st.imageAtlasTexture;const Kr=Pt.kind==="composite"||Pt.kind==="camera";mn=De||h.options.rotating||h.options.zooming||Kr?ee.LINEAR:ee.NEAREST}}else{const Kr=l.layout.get("icon-size").constantOr(0)!==1||Xe.iconsNeedLinear;ln=st.imageAtlasTexture,Jt=pt||h.options.rotating||h.options.zooming||Kr||De?ee.LINEAR:ee.NEAREST,Qt=st.imageAtlasTexture.size}const Gt=Xe.projection.name==="globe",ei=Gt?It:Le,Wn=Gt?o.globeToMercatorTransition(Q.zoom):0,li=tl(Ue,Xe.getProjection(),Q),ii=Q.calculatePixelsToTileUnitsMatrix(st),zr=qr(li,st.tileID.canonical,H,ne,Q,Xe.getProjection(),ii),Gr=h.terrain&&H&&X?o.invert(o.create(),zr):pl,br=Wd(li,st.tileID.canonical,H,ne,Q,Xe.getProjection(),ii),xo=Pe&&Xe.hasTextData(),gi=l.layout.get("icon-text-fit")!=="none"&&xo&&Xe.hasIconData();if(X){const Kr=Q.elevation,bo=Kr?Kr.getAtTileOffsetFunc(Ue,Q.center.lat,Q.worldSize,Xe.getProjection()):null,wo=sc(li,st.tileID.canonical,H,ne,Q,Xe.getProjection(),ii);Rn(Xe,li,h,_,wo,br,H,O,bo,Ue)}const ci=X||_&&Pe||gi,Gn=h.translatePosMatrix(li,st,x,T),Ri=ci?pl:zr,fr=h.translatePosMatrix(br,st,x,T,!0),di=Xe.getProjection().createInversionMatrix(Q,Ue.canonical),wr=[];h.terrainRenderModeElevated()&&H&&wr.push("PITCH_WITH_MAP_TERRAIN"),Gt&&wr.push("PROJECTION_GLOBE_VIEW"),ci&&wr.push("PROJECTED_POS_ON_VIEWPORT");const Sl=pt&&l.paint.get(_?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let jo;jo=pt?Xe.iconsInText?Mc(Pt.kind,He,re,H,h,Gn,Ri,fr,Qt,Sn,Ue,Wn,xe,di,ei,Xe.getProjection()):uf(Pt.kind,He,re,H,h,Gn,Ri,fr,_,Qt,!0,Ue,Wn,xe,di,ei,Xe.getProjection()):Ac(Pt.kind,He,re,H,h,Gn,Ri,fr,_,Qt,Ue,Wn,xe,di,ei,Xe.getProjection());const pr={program:h.useProgram(ff(pt,_,Xe),Je,wr),buffers:Et,uniformValues:jo,atlasTexture:ln,atlasTextureIcon:cn,atlasInterpolation:Jt,atlasInterpolationIcon:mn,isSDF:pt,hasHalo:Sl,tile:st,labelPlaneMatrixInv:Gr};if(ie&&Xe.canOverlap){he=!0;const Kr=Et.segments.get();for(const bo of Kr)je.push({segments:new o.SegmentVector([bo]),sortKey:bo.sortKey,state:pr})}else je.push({segments:Et.segments,sortKey:0,state:pr})}he&&je.sort((Ue,st)=>Ue.sortKey-st.sortKey);for(const Ue of je){const st=Ue.state;if(h.terrain&&h.terrain.setupElevationDraw(st.tile,st.program,{useDepthForOcclusion:!We,labelPlaneMatrixInv:st.labelPlaneMatrixInv}),G.activeTexture.set(ee.TEXTURE0),st.atlasTexture.bind(st.atlasInterpolation,ee.CLAMP_TO_EDGE),st.atlasTextureIcon&&(G.activeTexture.set(ee.TEXTURE1),st.atlasTextureIcon&&st.atlasTextureIcon.bind(st.atlasInterpolationIcon,ee.CLAMP_TO_EDGE)),st.isSDF){const Xe=st.uniformValues;st.hasHalo&&(Xe.u_is_halo=1,pf(st.buffers,Ue.segments,l,h,st.program,Ee,R,U,Xe)),Xe.u_is_halo=0}pf(st.buffers,Ue.segments,l,h,st.program,Ee,R,U,st.uniformValues)}}function pf(h,r,l,p,_,x,T,C,M){const O=p.context,R=[h.dynamicLayoutVertexBuffer,h.opacityVertexBuffer,h.globeExtVertexBuffer];_.draw(O,O.gl.TRIANGLES,x,T,C,o.CullFaceMode.disabled,M,l.id,h.layoutVertexBuffer,h.indexBuffer,r,l.paint,p.transform.zoom,h.programConfigurations.get(l.id),R)}function mf(h,r,l,p,_,x,T){const C=h.context.gl,M=l.paint.get("fill-pattern"),O=M&&M.constantOr(1);let R,U,G,ee,Q;T?(U=O&&!l.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",R=C.LINES):(U=O?"fillPattern":"fill",R=C.TRIANGLES);for(const ne of p){const H=r.getTile(ne);if(O&&!H.patternsLoaded())continue;const X=H.getBucket(l);if(!X)continue;h.prepareDrawTile();const re=X.programConfigurations.get(l.id),ie=h.useProgram(U,re);O&&(h.context.activeTexture.set(C.TEXTURE0),H.imageAtlasTexture.bind(C.LINEAR,C.CLAMP_TO_EDGE),re.updatePaintBuffers());const he=M.constantOr(null);if(he&&H.imageAtlas){const xe=H.imageAtlas.patternPositions[he.toString()];xe&&re.setConstantPatternPositions(xe)}const Ee=h.translatePosMatrix(ne.projMatrix,H,l.paint.get("fill-translate"),l.paint.get("fill-translate-anchor"));if(T){ee=X.indexBuffer2,Q=X.segments2;const xe=h.terrain&&h.terrain.renderingToTexture?h.terrain.drapeBufferSize:[C.drawingBufferWidth,C.drawingBufferHeight];G=U==="fillOutlinePattern"&&O?ih(Ee,h,H,xe):nh(Ee,xe)}else ee=X.indexBuffer,Q=X.segments,G=O?Ec(Ee,h,H):wc(Ee);h.prepareDrawProgram(h.context,ie,ne.toUnwrapped()),ie.draw(h.context,R,_,h.stencilModeForClipping(ne),x,o.CullFaceMode.disabled,G,l.id,X.layoutVertexBuffer,ee,Q,l.paint,h.transform.zoom,re)}}function lh(h,r,l,p,_,x,T){const C=h.context,M=C.gl,O=h.transform,R=l.paint.get("fill-extrusion-pattern"),U=R.constantOr(1),G=l.paint.get("fill-extrusion-opacity"),ee=[l.paint.get("fill-extrusion-ambient-occlusion-intensity"),l.paint.get("fill-extrusion-ambient-occlusion-radius")],Q=l.layout.get("fill-extrusion-edge-radius"),ne=O.projection.name==="globe"?o.fillExtrusionHeightLift():0,H=O.projection.name==="globe",X=H?o.globeToMercatorTransition(O.zoom):0,re=[o.mercatorXfromLng(O.center.lng),o.mercatorYfromLat(O.center.lat)],ie=[];H&&(ie.push("PROJECTION_GLOBE_VIEW"),h.style.terrainSetForDrapingOnly()&&ie.push("TERRAIN")),ee[0]>0&&ie.push("FAUX_AO");for(const he of p){const Ee=r.getTile(he),xe=Ee.getBucket(l);if(!xe||xe.projection.name!==O.projection.name)continue;const Pe=xe.programConfigurations.get(l.id),We=h.useProgram(U?"fillExtrusionPattern":"fillExtrusion",Pe,ie);if(h.terrain){const Et=h.terrain;if(h.style.terrainSetForDrapingOnly())Et.setupElevationDraw(Ee,We,{useMeterToDem:!0});else{if(!xe.enableTerrain)continue;if(Et.setupElevationDraw(Ee,We,{useMeterToDem:!0}),bg(C,r,he,xe,l,Et),!xe.centroidVertexBuffer){const Je=We.attributes.a_centroid_pos;Je!==void 0&&M.vertexAttrib2f(Je,0,0)}}}U&&(h.context.activeTexture.set(M.TEXTURE0),Ee.imageAtlasTexture.bind(M.LINEAR,M.CLAMP_TO_EDGE),Pe.updatePaintBuffers());const je=R.constantOr(null);if(je&&Ee.imageAtlas){const Et=Ee.imageAtlas.patternPositions[je.toString()];Et&&Pe.setConstantPatternPositions(Et)}const Le=h.translatePosMatrix(he.projMatrix,Ee,l.paint.get("fill-extrusion-translate"),l.paint.get("fill-extrusion-translate-anchor")),It=O.projection.createInversionMatrix(O,he.canonical),Ue=l.paint.get("fill-extrusion-vertical-gradient"),st=U?gg(Le,h,Ue,G,ee,Q,he,Ee,ne,X,re,It):rf(Le,h,Ue,G,ee,Q,he,ne,X,re,It);h.prepareDrawProgram(C,We,he.toUnwrapped());const Xe=[];h.terrain&&Xe.push(xe.centroidVertexBuffer),H&&Xe.push(xe.layoutVertexExtBuffer),We.draw(C,C.gl.TRIANGLES,_,x,T,o.CullFaceMode.backCCW,st,l.id,xe.layoutVertexBuffer,xe.indexBuffer,xe.segments,l.paint,h.transform.zoom,Pe,Xe)}}function bg(h,r,l,p,_,x){const T=[X=>{let re=X.canonical.x-1,ie=X.wrap;return re<0&&(re=(1<<X.canonical.z)-1,ie--),new o.OverscaledTileID(X.overscaledZ,ie,X.canonical.z,re,X.canonical.y)},X=>{let re=X.canonical.x+1,ie=X.wrap;return re===1<<X.canonical.z&&(re=0,ie++),new o.OverscaledTileID(X.overscaledZ,ie,X.canonical.z,re,X.canonical.y)},X=>new o.OverscaledTileID(X.overscaledZ,X.wrap,X.canonical.z,X.canonical.x,(X.canonical.y===0?1<<X.canonical.z:X.canonical.y)-1),X=>new o.OverscaledTileID(X.overscaledZ,X.wrap,X.canonical.z,X.canonical.x,X.canonical.y===(1<<X.canonical.z)-1?0:X.canonical.y+1)],C=X=>{const re=r.getSource().minzoom,ie=Ee=>{const xe=r.getTileByID(Ee);if(xe&&xe.hasData())return xe.getBucket(_)},he=[0,-1,1];for(const Ee of he){if(X.overscaledZ+Ee<re)continue;const xe=ie(X.calculateScaledKey(X.overscaledZ+Ee));if(xe)return xe}},M=[0,0,0],O=(X,re)=>(M[0]=Math.min(X.min.y,re.min.y),M[1]=Math.max(X.max.y,re.max.y),M[2]=o.EXTENT-re.min.x>X.max.x?re.min.x-o.EXTENT:X.max.x,M),R=(X,re)=>(M[0]=Math.min(X.min.x,re.min.x),M[1]=Math.max(X.max.x,re.max.x),M[2]=o.EXTENT-re.min.y>X.max.y?re.min.y-o.EXTENT:X.max.y,M),U=[(X,re)=>O(X,re),(X,re)=>O(re,X),(X,re)=>R(X,re),(X,re)=>R(re,X)],G=new o.pointGeometry(0,0);let ee,Q,ne;const H=(X,re,ie,he,Ee)=>{const xe=[[he?ie:X,he?X:ie,0],[he?ie:re,he?re:ie,0]],Pe=Ee<0?o.EXTENT+Ee:Ee,We=[he?Pe:(X+re)/2,he?(X+re)/2:Pe,0];return ie===0&&Ee<0||ie!==0&&Ee>0?x.getForTilePoints(ne,[We],!0,Q):xe.push(We),x.getForTilePoints(l,xe,!0,ee),Math.max(xe[0][2],xe[1][2],We[2])/x.exaggeration()};for(let X=0;X<4;X++){const re=(X<2?1:5)-X,ie=p.borders[X];if(ie.length===0)continue;const he=ne=T[X](l),Ee=C(he);if(!(Ee&&Ee instanceof o.FillExtrusionBucket&&Ee.enableTerrain)||p.borderDoneWithNeighborZ[X]===Ee.canonical.z&&Ee.borderDoneWithNeighborZ[re]===p.canonical.z||(Q=x.findDEMTileFor(he),!Q||!Q.dem))continue;if(!ee){const je=x.findDEMTileFor(l);if(!je||!je.dem)return;ee=je}const xe=Ee.borders[re];let Pe=0;const We=Ee.borderDoneWithNeighborZ[re]!==p.canonical.z;if(p.canonical.z===Ee.canonical.z){for(let je=0;je<ie.length;je++){const Le=p.featuresOnBorder[ie[je]],It=Le.borders[X];let Ue;for(;Pe<xe.length&&(Ue=Ee.featuresOnBorder[xe[Pe]],!(Ue.borders[re][1]>It[0]+3));)We&&Ee.encodeCentroid(void 0,Ue,!1),Pe++;if(Ue&&Pe<xe.length){const st=Pe;let Xe=0;for(;!(Ue.borders[re][0]>It[1]-3)&&(Xe++,++Pe!==xe.length);)Ue=Ee.featuresOnBorder[xe[Pe]];if(Ue=Ee.featuresOnBorder[xe[st]],Le.intersectsCount()>1||Ue.intersectsCount()>1||Xe!==1){Xe!==1&&(Pe=st),p.encodeCentroid(void 0,Le,!1),We&&Ee.encodeCentroid(void 0,Ue,!1);continue}const Et=U[X](Le,Ue),Je=X%2?o.EXTENT-1:0;G.x=H(Et[0],Math.min(o.EXTENT-1,Et[1]),Je,X<2,Et[2]),G.y=0,p.encodeCentroid(G,Le,!1),We&&Ee.encodeCentroid(G,Ue,!1)}else p.encodeCentroid(void 0,Le,!1)}p.borderDoneWithNeighborZ[X]=Ee.canonical.z,p.needsCentroidUpdate=!0,We&&(Ee.borderDoneWithNeighborZ[re]=p.canonical.z,Ee.needsCentroidUpdate=!0)}else{for(const je of ie)p.encodeCentroid(void 0,p.featuresOnBorder[je],!1);if(We){for(const je of xe)Ee.encodeCentroid(void 0,Ee.featuresOnBorder[je],!1);Ee.borderDoneWithNeighborZ[re]=p.canonical.z,Ee.needsCentroidUpdate=!0}p.borderDoneWithNeighborZ[X]=Ee.canonical.z,p.needsCentroidUpdate=!0}}(p.needsCentroidUpdate||!p.centroidVertexBuffer&&p.centroidVertexArray.length!==0)&&p.uploadCentroid(h)}const wg=new o.Color(1,0,0,1),Eg=new o.Color(0,1,0,1),ch=new o.Color(0,0,1,1),uh=new o.Color(1,0,1,1),gf=new o.Color(0,1,1,1);function _f(h,r,l){const p=h.context,_=h.transform,x=p.gl,T=_.projection.name==="globe",C=T?["PROJECTION_GLOBE_VIEW"]:null;let M=l.projMatrix;if(T&&o.globeToMercatorTransition(_.zoom)>0){const Le=o.transitionTileAABBinECEF(l.canonical,_),It=o.globeDenormalizeECEF(Le);M=o.multiply(new Float32Array(16),_.globeMatrix,It),o.multiply(M,_.projMatrix,M)}const O=h.useProgram("debug",null,C),R=r.getTileByID(l.key);h.terrain&&h.terrain.setupElevationDraw(R,O);const U=o.DepthMode.disabled,G=o.StencilMode.disabled,ee=h.colorModeForRenderPass(),Q="$debug";p.activeTexture.set(x.TEXTURE0),h.emptyTexture.bind(x.LINEAR,x.CLAMP_TO_EDGE),T?R._makeGlobeTileDebugBuffers(h.context,_):R._makeDebugTileBoundsBuffers(h.context,_.projection);const ne=R._tileDebugBuffer||h.debugBuffer,H=R._tileDebugIndexBuffer||h.debugIndexBuffer,X=R._tileDebugSegments||h.debugSegments;O.draw(p,x.LINE_STRIP,U,G,ee,o.CullFaceMode.disabled,ua(M,o.Color.red),Q,ne,H,X,null,null,null,[R._globeTileDebugBorderBuffer]);const re=R.latestRawTileData,ie=Math.floor((re&&re.byteLength||0)/1024),he=r.getTile(l).tileSize,Ee=512/Math.min(he,512)*(l.overscaledZ/_.zoom)*.5;let xe=l.canonical.toString();l.overscaledZ!==l.canonical.z&&(xe+=` => ${l.overscaledZ}`),xe+=` ${ie}kb`,function(Le,It){Le.initDebugOverlayCanvas();const Ue=Le.debugOverlayCanvas,st=Le.context.gl,Xe=Le.debugOverlayCanvas.getContext("2d");Xe.clearRect(0,0,Ue.width,Ue.height),Xe.shadowColor="white",Xe.shadowBlur=2,Xe.lineWidth=1.5,Xe.strokeStyle="white",Xe.textBaseline="top",Xe.font="bold 36px Open Sans, sans-serif",Xe.fillText(It,5,5),Xe.strokeText(It,5,5),Le.debugOverlayTexture.update(Ue),Le.debugOverlayTexture.bind(st.LINEAR,st.CLAMP_TO_EDGE)}(h,xe);const Pe=R._tileDebugTextBuffer||h.debugBuffer,We=R._tileDebugTextIndexBuffer||h.quadTriangleIndexBuffer,je=R._tileDebugTextSegments||h.debugSegments;O.draw(p,x.TRIANGLES,U,G,o.ColorMode.alphaBlended,o.CullFaceMode.disabled,ua(M,o.Color.transparent,Ee),Q,Pe,We,je,null,null,null,[R._globeTileDebugTextBuffer])}function hh(h,r,l,p){yo(h,0,r+l/2,h.transform.width,l,p)}function Ic(h,r,l,p){yo(h,r-l/2,0,l,h.transform.height,p)}function yo(h,r,l,p,_,x){const T=h.context,C=T.gl;C.enable(C.SCISSOR_TEST),C.scissor(r*o.exported.devicePixelRatio,l*o.exported.devicePixelRatio,p*o.exported.devicePixelRatio,_*o.exported.devicePixelRatio),T.clear({color:x}),C.disable(C.SCISSOR_TEST)}const ml=o.createLayout([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:yf}=ml;function $r(h,r,l,p){h.emplaceBack(r,l,p)}class zs{constructor(r){this.vertexArray=new o.StructArrayLayout3f12,this.indices=new o.StructArrayLayout3ui6,$r(this.vertexArray,-1,-1,1),$r(this.vertexArray,1,-1,1),$r(this.vertexArray,-1,1,1),$r(this.vertexArray,1,1,1),$r(this.vertexArray,-1,-1,-1),$r(this.vertexArray,1,-1,-1),$r(this.vertexArray,-1,1,-1),$r(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=r.createVertexBuffer(this.vertexArray,yf),this.indexBuffer=r.createIndexBuffer(this.indices),this.segment=o.SegmentVector.simpleSegment(0,0,36,12)}}function Ls(h,r,l,p,_,x){const T=h.gl,C=r.paint.get("sky-atmosphere-color"),M=r.paint.get("sky-atmosphere-halo-color"),O=r.paint.get("sky-atmosphere-sun-intensity"),R=((U,G,ee,Q,ne)=>({u_matrix_3f:U,u_sun_direction:G,u_sun_intensity:ee,u_color_tint_r:[Q.r,Q.g,Q.b,Q.a],u_color_tint_m:[ne.r,ne.g,ne.b,ne.a],u_luminance:5e-5}))(o.fromMat4(o.create$1(),p),_,O,C,M);T.framebufferTexture2D(T.FRAMEBUFFER,T.COLOR_ATTACHMENT0,T.TEXTURE_CUBE_MAP_POSITIVE_X+x,r.skyboxTexture,0),l.draw(h,T.TRIANGLES,o.DepthMode.disabled,o.StencilMode.disabled,o.ColorMode.unblended,o.CullFaceMode.frontCW,R,"skyboxCapture",r.skyboxGeometry.vertexBuffer,r.skyboxGeometry.indexBuffer,r.skyboxGeometry.segment)}const dh=o.createLayout([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class Kn{constructor(r){const l=new o.StructArrayLayout5f20;l.emplaceBack(-1,1,1,0,0),l.emplaceBack(1,1,1,1,0),l.emplaceBack(1,-1,1,1,1),l.emplaceBack(-1,-1,1,0,1);const p=new o.StructArrayLayout3ui6;p.emplaceBack(0,1,2),p.emplaceBack(2,3,0),this.vertexBuffer=r.createVertexBuffer(l,dh.members),this.indexBuffer=r.createIndexBuffer(p),this.segments=o.SegmentVector.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const gl={symbol:function(h,r,l,p,_){if(h.renderPass!=="translucent")return;const x=o.StencilMode.disabled,T=h.colorModeForRenderPass();l.layout.get("text-variable-anchor")&&function(C,M,O,R,U,G,ee){const Q=M.transform,ne=U==="map",H=G==="map";for(const X of C){const re=R.getTile(X),ie=re.getBucket(O);if(!ie||!ie.text||!ie.text.segments.get().length)continue;const he=o.evaluateSizeForZoom(ie.textSizeData,Q.zoom),Ee=tl(X,ie.getProjection(),Q),xe=Q.calculatePixelsToTileUnitsMatrix(re),Pe=qr(Ee,re.tileID.canonical,H,ne,Q,ie.getProjection(),xe),We=O.layout.get("icon-text-fit")!=="none"&&ie.hasIconData();if(he){const je=Math.pow(2,Q.zoom-re.tileID.overscaledZ);df(ie,ne,H,ee,o.symbolSize,Q,Pe,X,je,he,We)}}}(p,h,l,r,l.layout.get("text-rotation-alignment"),l.layout.get("text-pitch-alignment"),_),l.paint.get("icon-opacity").constantOr(1)!==0&&Ps(h,r,l,p,!1,l.paint.get("icon-translate"),l.paint.get("icon-translate-anchor"),l.layout.get("icon-rotation-alignment"),l.layout.get("icon-pitch-alignment"),l.layout.get("icon-keep-upright"),x,T),l.paint.get("text-opacity").constantOr(1)!==0&&Ps(h,r,l,p,!0,l.paint.get("text-translate"),l.paint.get("text-translate-anchor"),l.layout.get("text-rotation-alignment"),l.layout.get("text-pitch-alignment"),l.layout.get("text-keep-upright"),x,T),r.map.showCollisionBoxes&&(hf(h,r,l,p,l.paint.get("text-translate"),l.paint.get("text-translate-anchor"),!0),hf(h,r,l,p,l.paint.get("icon-translate"),l.paint.get("icon-translate-anchor"),!1))},circle:function(h,r,l,p){if(h.renderPass!=="translucent")return;const _=l.paint.get("circle-opacity"),x=l.paint.get("circle-stroke-width"),T=l.paint.get("circle-stroke-opacity"),C=l.layout.get("circle-sort-key").constantOr(1)!==void 0;if(_.constantOr(1)===0&&(x.constantOr(1)===0||T.constantOr(1)===0))return;const M=h.context,O=M.gl,R=h.transform,U=h.depthModeForSublayer(0,o.DepthMode.ReadOnly),G=o.StencilMode.disabled,ee=h.colorModeForRenderPass(),Q=R.projection.name==="globe",ne=[o.mercatorXfromLng(R.center.lng),o.mercatorYfromLat(R.center.lat)],H=[];for(let re=0;re<p.length;re++){const ie=p[re],he=r.getTile(ie),Ee=he.getBucket(l);if(!Ee||Ee.projection.name!==R.projection.name)continue;const xe=Ee.programConfigurations.get(l.id),Pe=_g(l);Q&&Pe.push("PROJECTION_GLOBE_VIEW");const We=h.useProgram("circle",xe,Pe),je=Ee.layoutVertexBuffer,Le=Ee.globeExtVertexBuffer,It=Ee.indexBuffer,Ue=R.projection.createInversionMatrix(R,ie.canonical),st={programConfiguration:xe,program:We,layoutVertexBuffer:je,globeExtVertexBuffer:Le,indexBuffer:It,uniformValues:sf(h,ie,he,Ue,ne,l),tile:he};if(C){const Xe=Ee.segments.get();for(const Et of Xe)H.push({segments:new o.SegmentVector([Et]),sortKey:Et.sortKey,state:st})}else H.push({segments:Ee.segments,sortKey:0,state:st})}C&&H.sort((re,ie)=>re.sortKey-ie.sortKey);const X={useDepthForOcclusion:!Q};for(const re of H){const{programConfiguration:ie,program:he,layoutVertexBuffer:Ee,globeExtVertexBuffer:xe,indexBuffer:Pe,uniformValues:We,tile:je}=re.state,Le=re.segments;h.terrain&&h.terrain.setupElevationDraw(je,he,X),h.prepareDrawProgram(M,he,je.tileID.toUnwrapped()),he.draw(M,O.TRIANGLES,U,G,ee,o.CullFaceMode.disabled,We,l.id,Ee,Pe,Le,l.paint,R.zoom,ie,[xe])}},heatmap:function(h,r,l,p){if(l.paint.get("heatmap-opacity")!==0)if(h.renderPass==="offscreen"){const _=h.context,x=_.gl,T=o.StencilMode.disabled,C=new o.ColorMode([x.ONE,x.ONE],o.Color.transparent,[!0,!0,!0,!0]);(function(ee,Q,ne,H){const X=ee.gl,re=Q.width*H,ie=Q.height*H;ee.activeTexture.set(X.TEXTURE1),ee.viewport.set([0,0,re,ie]);let he=ne.heatmapFbo;if(!he||he&&(he.width!==re||he.height!==ie)){he&&he.destroy();const Ee=X.createTexture();X.bindTexture(X.TEXTURE_2D,Ee),X.texParameteri(X.TEXTURE_2D,X.TEXTURE_WRAP_S,X.CLAMP_TO_EDGE),X.texParameteri(X.TEXTURE_2D,X.TEXTURE_WRAP_T,X.CLAMP_TO_EDGE),X.texParameteri(X.TEXTURE_2D,X.TEXTURE_MIN_FILTER,X.LINEAR),X.texParameteri(X.TEXTURE_2D,X.TEXTURE_MAG_FILTER,X.LINEAR),he=ne.heatmapFbo=ee.createFramebuffer(re,ie,!1),function(xe,Pe,We,je,Le,It){const Ue=xe.gl;Ue.texImage2D(Ue.TEXTURE_2D,0,Ue.RGBA,Le,It,0,Ue.RGBA,xe.extRenderToTextureHalfFloat?xe.extTextureHalfFloat.HALF_FLOAT_OES:Ue.UNSIGNED_BYTE,null),je.colorAttachment.set(We)}(ee,0,Ee,he,re,ie)}else X.bindTexture(X.TEXTURE_2D,he.colorAttachment.get()),ee.bindFramebuffer.set(he.framebuffer)})(_,h,l,h.transform.projection.name==="globe"?.5:.25),_.clear({color:o.Color.transparent});const M=h.transform,O=M.projection.name==="globe",R=O?["PROJECTION_GLOBE_VIEW"]:null,U=O?o.CullFaceMode.frontCCW:o.CullFaceMode.disabled,G=[o.mercatorXfromLng(M.center.lng),o.mercatorYfromLat(M.center.lat)];for(let ee=0;ee<p.length;ee++){const Q=p[ee];if(r.hasRenderableParent(Q))continue;const ne=r.getTile(Q),H=ne.getBucket(l);if(!H||H.projection.name!==M.projection.name)continue;const X=H.programConfigurations.get(l.id),re=h.useProgram("heatmap",X,R),{zoom:ie}=h.transform;h.terrain&&h.terrain.setupElevationDraw(ne,re),h.prepareDrawProgram(_,re,Q.toUnwrapped());const he=M.projection.createInversionMatrix(M,Q.canonical);re.draw(_,x.TRIANGLES,o.DepthMode.disabled,T,C,U,Tc(h,Q,ne,he,G,ie,l.paint.get("heatmap-intensity")),l.id,H.layoutVertexBuffer,H.indexBuffer,H.segments,l.paint,h.transform.zoom,X,O?[H.globeExtVertexBuffer]:null)}_.viewport.set([0,0,h.width,h.height])}else h.renderPass==="translucent"&&(h.context.setColorMode(h.colorModeForRenderPass()),function(_,x){const T=_.context,C=T.gl,M=x.heatmapFbo;if(!M)return;T.activeTexture.set(C.TEXTURE0),C.bindTexture(C.TEXTURE_2D,M.colorAttachment.get()),T.activeTexture.set(C.TEXTURE1);let O=x.colorRampTexture;O||(O=x.colorRampTexture=new o.Texture(T,x.colorRamp,C.RGBA)),O.bind(C.LINEAR,C.CLAMP_TO_EDGE),_.useProgram("heatmapTexture").draw(T,C.TRIANGLES,o.DepthMode.disabled,o.StencilMode.disabled,_.colorModeForRenderPass(),o.CullFaceMode.disabled,((R,U,G,ee)=>({u_image:0,u_color_ramp:1,u_opacity:U.paint.get("heatmap-opacity")}))(0,x),x.id,_.viewportBuffer,_.quadTriangleIndexBuffer,_.viewportSegments,x.paint,_.transform.zoom)}(h,l))},line:function(h,r,l,p){if(h.renderPass!=="translucent")return;const _=l.paint.get("line-opacity"),x=l.paint.get("line-width");if(_.constantOr(1)===0||x.constantOr(1)===0)return;const T=h.depthModeForSublayer(0,o.DepthMode.ReadOnly),C=h.colorModeForRenderPass(),M=h.terrain&&h.terrain.renderingToTexture?1:o.exported.devicePixelRatio,O=l.paint.get("line-dasharray"),R=O.constantOr(1),U=l.layout.get("line-cap"),G=l.paint.get("line-pattern"),ee=G.constantOr(1),Q=l.paint.get("line-gradient"),ne=ee?"linePattern":"line",H=h.context,X=H.gl,re=(he=>{const Ee=[];Cc(he)&&Ee.push("RENDER_LINE_DASH"),he.paint.get("line-gradient")&&Ee.push("RENDER_LINE_GRADIENT");const xe=he.paint.get("line-trim-offset");xe[0]===0&&xe[1]===0||Ee.push("RENDER_LINE_TRIM_OFFSET");const Pe=he.paint.get("line-pattern").constantOr(1),We=he.paint.get("line-opacity").constantOr(1)!==1;return!Pe&&We&&Ee.push("RENDER_LINE_ALPHA_DISCARD"),Ee})(l);let ie=re.includes("RENDER_LINE_ALPHA_DISCARD");h.terrain&&h.terrain.clipOrMaskOverlapStencilType()&&(ie=!1);for(const he of p){const Ee=r.getTile(he);if(ee&&!Ee.patternsLoaded())continue;const xe=Ee.getBucket(l);if(!xe)continue;h.prepareDrawTile();const Pe=xe.programConfigurations.get(l.id),We=h.useProgram(ne,Pe,re),je=G.constantOr(null);if(je&&Ee.imageAtlas){const pt=Ee.imageAtlas.patternPositions[je.toString()];pt&&Pe.setConstantPatternPositions(pt)}const Le=O.constantOr(null),It=U.constantOr(null);if(!ee&&Le&&It&&Ee.lineAtlas){const pt=Ee.lineAtlas.getDash(Le,It);pt&&Pe.setConstantPatternPositions(pt)}let[Ue,st]=l.paint.get("line-trim-offset");(It==="round"||It==="square")&&Ue!==st&&(Ue===0&&(Ue-=1),st===1&&(st+=1));const Xe=h.terrain?he.projMatrix:null,Et=ee?_o(h,Ee,l,Xe,M):rh(h,Ee,l,Xe,xe.lineClipsArray.length,M,[Ue,st]);if(Q){const pt=xe.gradients[l.id];let Pt=pt.texture;if(l.gradientVersion!==pt.version){let De=256;if(l.stepInterpolant){const He=r.getSource().maxzoom,Qt=he.canonical.z===He?Math.ceil(1<<h.transform.maxZoom-he.canonical.z):1;De=o.clamp(o.nextPowerOfTwo(xe.maxLineLength/o.EXTENT*1024*Qt),256,H.maxTextureSize)}pt.gradient=o.renderColorRamp({expression:l.gradientExpression(),evaluationKey:"lineProgress",resolution:De,image:pt.gradient||void 0,clips:xe.lineClipsArray}),pt.texture?pt.texture.update(pt.gradient):pt.texture=new o.Texture(H,pt.gradient,X.RGBA),pt.version=l.gradientVersion,Pt=pt.texture}H.activeTexture.set(X.TEXTURE1),Pt.bind(l.stepInterpolant?X.NEAREST:X.LINEAR,X.CLAMP_TO_EDGE)}R&&(H.activeTexture.set(X.TEXTURE0),Ee.lineAtlasTexture.bind(X.LINEAR,X.REPEAT),Pe.updatePaintBuffers()),ee&&(H.activeTexture.set(X.TEXTURE0),Ee.imageAtlasTexture.bind(X.LINEAR,X.CLAMP_TO_EDGE),Pe.updatePaintBuffers()),h.prepareDrawProgram(H,We,he.toUnwrapped());const Je=pt=>{We.draw(H,X.TRIANGLES,T,pt,C,o.CullFaceMode.disabled,Et,l.id,xe.layoutVertexBuffer,xe.indexBuffer,xe.segments,l.paint,h.transform.zoom,Pe,[xe.layoutVertexBuffer2])};if(ie){const pt=h.stencilModeForClipping(he).ref;pt===0&&h.terrain&&H.clear({stencil:0});const Pt={func:X.EQUAL,mask:255};Et.u_alpha_discard_threshold=.8,Je(new o.StencilMode(Pt,pt,255,X.KEEP,X.KEEP,X.INVERT)),Et.u_alpha_discard_threshold=0,Je(new o.StencilMode(Pt,pt,255,X.KEEP,X.KEEP,X.KEEP))}else Je(h.stencilModeForClipping(he))}ie&&(h.resetStencilClippingMasks(),h.terrain&&H.clear({stencil:0}))},fill:function(h,r,l,p){const _=l.paint.get("fill-color"),x=l.paint.get("fill-opacity");if(x.constantOr(1)===0)return;const T=h.colorModeForRenderPass(),C=l.paint.get("fill-pattern"),M=h.opaquePassEnabledForLayer()&&!C.constantOr(1)&&_.constantOr(o.Color.transparent).a===1&&x.constantOr(0)===1?"opaque":"translucent";if(h.renderPass===M){const O=h.depthModeForSublayer(1,h.renderPass==="opaque"?o.DepthMode.ReadWrite:o.DepthMode.ReadOnly);mf(h,r,l,p,O,T,!1)}if(h.renderPass==="translucent"&&l.paint.get("fill-antialias")){const O=h.depthModeForSublayer(l.getPaintProperty("fill-outline-color")?2:0,o.DepthMode.ReadOnly);mf(h,r,l,p,O,T,!0)}},"fill-extrusion":function(h,r,l,p){const _=l.paint.get("fill-extrusion-opacity");if(_!==0&&h.renderPass==="translucent"){const x=new o.DepthMode(h.context.gl.LEQUAL,o.DepthMode.ReadWrite,h.depthRangeFor3D);if(_!==1||l.paint.get("fill-extrusion-pattern").constantOr(1))lh(h,r,l,p,x,o.StencilMode.disabled,o.ColorMode.disabled),lh(h,r,l,p,x,h.stencilModeFor3D(),h.colorModeForRenderPass()),h.resetStencilClippingMasks();else{const T=h.colorModeForRenderPass();lh(h,r,l,p,x,o.StencilMode.disabled,T)}}},hillshade:function(h,r,l,p){if(h.renderPass!=="offscreen"&&h.renderPass!=="translucent")return;const _=h.context,x=h.depthModeForSublayer(0,o.DepthMode.ReadOnly),T=h.colorModeForRenderPass(),C=h.terrain&&h.terrain.renderingToTexture,[M,O]=h.renderPass!=="translucent"||C?[{},p]:h.stencilConfigForOverlap(p);for(const R of O){const U=r.getTile(R);if(U.needsHillshadePrepare&&h.renderPass==="offscreen")mc(h,U,l,x,o.StencilMode.disabled,T);else if(h.renderPass==="translucent"){const G=C&&h.terrain?h.terrain.stencilModeForRTTOverlap(R):M[R.overscaledZ];Qu(h,R,U,l,x,G,T)}}_.viewport.set([0,0,h.width,h.height]),h.resetStencilClippingMasks()},raster:function(h,r,l,p,_,x){if(h.renderPass!=="translucent"||l.paint.get("raster-opacity")===0||!p.length)return;const T=h.context,C=T.gl,M=r.getSource(),O=h.useProgram("raster"),R=h.colorModeForRenderPass(),U=h.terrain&&h.terrain.renderingToTexture,[G,ee]=M instanceof Se||U?[{},p]:h.stencilConfigForOverlap(p),Q=ee[ee.length-1].overscaledZ,ne=!h.options.moving;for(const H of ee){const X=U?o.DepthMode.disabled:h.depthModeForSublayer(H.overscaledZ-Q,l.paint.get("raster-opacity")===1?o.DepthMode.ReadWrite:o.DepthMode.ReadOnly,C.LESS),re=H.toUnwrapped(),ie=r.getTile(H);if(U&&(!ie||!ie.hasData()))continue;const he=U?H.projMatrix:h.transform.calculateProjMatrix(re,ne),Ee=h.terrain&&U?h.terrain.stencilModeForRTTOverlap(H):G[H.overscaledZ],xe=x?0:l.paint.get("raster-fade-duration");ie.registerFadeDuration(xe);const Pe=r.findLoadedParent(H,0),We=vc(ie,Pe,r,h.transform,xe);let je,Le;h.terrain&&h.terrain.prepareDrawTile();const It=l.paint.get("raster-resampling")==="nearest"?C.NEAREST:C.LINEAR;T.activeTexture.set(C.TEXTURE0),ie.texture.bind(It,C.CLAMP_TO_EDGE),T.activeTexture.set(C.TEXTURE1),Pe?(Pe.texture.bind(It,C.CLAMP_TO_EDGE),je=Math.pow(2,Pe.tileID.overscaledZ-ie.tileID.overscaledZ),Le=[ie.tileID.canonical.x*je%1,ie.tileID.canonical.y*je%1]):ie.texture.bind(It,C.CLAMP_TO_EDGE);const Ue=lf(he,Le||[0,0],je||1,We,l,M instanceof Se?M.perspectiveTransform:[0,0]);if(h.prepareDrawProgram(T,O,re),M instanceof Se)M.boundsBuffer&&M.boundsSegments&&O.draw(T,C.TRIANGLES,X,o.StencilMode.disabled,R,o.CullFaceMode.disabled,Ue,l.id,M.boundsBuffer,h.quadTriangleIndexBuffer,M.boundsSegments);else{const{tileBoundsBuffer:st,tileBoundsIndexBuffer:Xe,tileBoundsSegments:Et}=h.getTileBoundsBuffers(ie);O.draw(T,C.TRIANGLES,X,Ee,R,o.CullFaceMode.disabled,Ue,l.id,st,Xe,Et)}}h.resetStencilClippingMasks()},background:function(h,r,l,p){const _=l.paint.get("background-color"),x=l.paint.get("background-opacity");if(x===0)return;const T=h.context,C=T.gl,M=h.transform,O=M.tileSize,R=l.paint.get("background-pattern");if(h.isPatternMissing(R))return;const U=!R&&_.a===1&&x===1&&h.opaquePassEnabledForLayer()?"opaque":"translucent";if(h.renderPass!==U)return;const G=o.StencilMode.disabled,ee=h.depthModeForSublayer(0,U==="opaque"?o.DepthMode.ReadWrite:o.DepthMode.ReadOnly),Q=h.colorModeForRenderPass(),ne=h.useProgram(R?"backgroundPattern":"background");let H,X=p;X||(H=h.getBackgroundTiles(),X=Object.values(H).map(re=>re.tileID)),R&&(T.activeTexture.set(C.TEXTURE0),h.imageManager.bind(h.context));for(const re of X){const ie=re.toUnwrapped(),he=p?re.projMatrix:h.transform.calculateProjMatrix(ie);h.prepareDrawTile();const Ee=r?r.getTile(re):H?H[re.key]:new o.Tile(re,O,M.zoom,h),xe=R?ah(he,x,h,R,{tileID:re,tileSize:O}):yg(he,x,_);h.prepareDrawProgram(T,ne,ie);const{tileBoundsBuffer:Pe,tileBoundsIndexBuffer:We,tileBoundsSegments:je}=h.getTileBoundsBuffers(Ee);ne.draw(T,C.TRIANGLES,ee,G,Q,o.CullFaceMode.disabled,xe,l.id,Pe,We,je)}},sky:function(h,r,l){const p=h.transform,_=p.projection.name==="mercator"||p.projection.name==="globe"?1:o.smoothstep(7,8,p.zoom),x=l.paint.get("sky-opacity")*_;if(x===0)return;const T=h.context,C=l.paint.get("sky-type"),M=new o.DepthMode(T.gl.LEQUAL,o.DepthMode.ReadOnly,[0,1]),O=h.frameCounter/1e3%1;C==="atmosphere"?h.renderPass==="offscreen"?l.needsSkyboxCapture(h)&&(function(R,U,G,ee){const Q=R.context,ne=Q.gl;let H=U.skyboxFbo;if(!H){H=U.skyboxFbo=Q.createFramebuffer(32,32,!1),U.skyboxGeometry=new zs(Q),U.skyboxTexture=Q.gl.createTexture(),ne.bindTexture(ne.TEXTURE_CUBE_MAP,U.skyboxTexture),ne.texParameteri(ne.TEXTURE_CUBE_MAP,ne.TEXTURE_WRAP_S,ne.CLAMP_TO_EDGE),ne.texParameteri(ne.TEXTURE_CUBE_MAP,ne.TEXTURE_WRAP_T,ne.CLAMP_TO_EDGE),ne.texParameteri(ne.TEXTURE_CUBE_MAP,ne.TEXTURE_MIN_FILTER,ne.LINEAR),ne.texParameteri(ne.TEXTURE_CUBE_MAP,ne.TEXTURE_MAG_FILTER,ne.LINEAR);for(let he=0;he<6;++he)ne.texImage2D(ne.TEXTURE_CUBE_MAP_POSITIVE_X+he,0,ne.RGBA,32,32,0,ne.RGBA,ne.UNSIGNED_BYTE,null)}Q.bindFramebuffer.set(H.framebuffer),Q.viewport.set([0,0,32,32]);const X=U.getCenter(R,!0),re=R.useProgram("skyboxCapture"),ie=new Float64Array(16);o.identity(ie),o.rotateY(ie,ie,.5*-Math.PI),Ls(Q,U,re,ie,X,0),o.identity(ie),o.rotateY(ie,ie,.5*Math.PI),Ls(Q,U,re,ie,X,1),o.identity(ie),o.rotateX(ie,ie,.5*-Math.PI),Ls(Q,U,re,ie,X,2),o.identity(ie),o.rotateX(ie,ie,.5*Math.PI),Ls(Q,U,re,ie,X,3),o.identity(ie),Ls(Q,U,re,ie,X,4),o.identity(ie),o.rotateY(ie,ie,Math.PI),Ls(Q,U,re,ie,X,5),Q.viewport.set([0,0,R.width,R.height])}(h,l),l.markSkyboxValid(h)):h.renderPass==="sky"&&function(R,U,G,ee,Q){const ne=R.context,H=ne.gl,X=R.transform,re=R.useProgram("skybox");ne.activeTexture.set(H.TEXTURE0),H.bindTexture(H.TEXTURE_CUBE_MAP,U.skyboxTexture);const ie=((he,Ee,xe,Pe,We)=>({u_matrix:he,u_sun_direction:Ee,u_cubemap:0,u_opacity:Pe,u_temporal_offset:We}))(X.skyboxMatrix,U.getCenter(R,!1),0,ee,Q);R.prepareDrawProgram(ne,re),re.draw(ne,H.TRIANGLES,G,o.StencilMode.disabled,R.colorModeForRenderPass(),o.CullFaceMode.backCW,ie,"skybox",U.skyboxGeometry.vertexBuffer,U.skyboxGeometry.indexBuffer,U.skyboxGeometry.segment)}(h,l,M,x,O):C==="gradient"&&h.renderPass==="sky"&&function(R,U,G,ee,Q){const ne=R.context,H=ne.gl,X=R.transform,re=R.useProgram("skyboxGradient");U.skyboxGeometry||(U.skyboxGeometry=new zs(ne)),ne.activeTexture.set(H.TEXTURE0);let ie=U.colorRampTexture;ie||(ie=U.colorRampTexture=new o.Texture(ne,U.colorRamp,H.RGBA)),ie.bind(H.LINEAR,H.CLAMP_TO_EDGE);const he=((Ee,xe,Pe,We,je)=>({u_matrix:Ee,u_color_ramp:0,u_center_direction:xe,u_radius:o.degToRad(Pe),u_opacity:We,u_temporal_offset:je}))(X.skyboxMatrix,U.getCenter(R,!1),U.paint.get("sky-gradient-radius"),ee,Q);R.prepareDrawProgram(ne,re),re.draw(ne,H.TRIANGLES,G,o.StencilMode.disabled,R.colorModeForRenderPass(),o.CullFaceMode.backCW,he,"skyboxGradient",U.skyboxGeometry.vertexBuffer,U.skyboxGeometry.indexBuffer,U.skyboxGeometry.segment)}(h,l,M,x,O)},debug:function(h,r,l){for(let p=0;p<l.length;p++)_f(h,r,l[p])},custom:function(h,r,l){const p=h.context,_=l.implementation;if(h.transform.projection.unsupportedLayers&&h.transform.projection.unsupportedLayers.includes("custom"))o.warnOnce("Custom layers are not yet supported with non-mercator projections. Use mercator to enable custom layers.");else if(h.renderPass==="offscreen"){const x=_.prerender;x&&(h.setCustomLayerDefaults(),p.setColorMode(h.colorModeForRenderPass()),x.call(_,p.gl,h.transform.customLayerMatrix()),p.setDirty(),h.setBaseState())}else if(h.renderPass==="translucent"){h.setCustomLayerDefaults(),p.setColorMode(h.colorModeForRenderPass()),p.setStencilMode(o.StencilMode.disabled);const x=_.renderingMode==="3d"?new o.DepthMode(h.context.gl.LEQUAL,o.DepthMode.ReadWrite,h.depthRangeFor3D):h.depthModeForSublayer(0,o.DepthMode.ReadOnly);p.setDepthMode(x),_.render(p.gl,h.transform.customLayerMatrix()),p.setDirty(),h.setBaseState(),p.bindFramebuffer.set(null)}}};class Tg{constructor(r,l){this.context=new V(r),this.transform=l,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.setup(),this.numSublayers=o.SourceCache.maxUnderzooming+o.SourceCache.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Ms,this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={}}updateTerrain(r,l){const p=!!r&&!!r.terrain&&this.transform.projection.supportsTerrain;if(!(p||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new tf(this,r));const _=this._terrain;this.transform.elevation=p?_:null,_.update(r,this.transform,l)}_updateFog(r){const l=r.fog;if(!l||this.transform.projection.name==="globe"||l.getOpacity(this.transform.pitch)<1||l.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[p,_]=l.getFovAdjustedRange(this.transform._fov);if(p>_)return void(this.transform.fogCullDistSq=null);const x=p+.78*(_-p);this.transform.fogCullDistSq=x*x}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}resize(r,l){if(this.width=r*o.exported.devicePixelRatio,this.height=l*o.exported.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const p of this.style.order)this.style._layers[p].resize()}setup(){const r=this.context,l=new o.StructArrayLayout2i4;l.emplaceBack(0,0),l.emplaceBack(o.EXTENT,0),l.emplaceBack(0,o.EXTENT),l.emplaceBack(o.EXTENT,o.EXTENT),this.tileExtentBuffer=r.createVertexBuffer(l,o.posAttributes.members),this.tileExtentSegments=o.SegmentVector.simpleSegment(0,0,4,2);const p=new o.StructArrayLayout2i4;p.emplaceBack(0,0),p.emplaceBack(o.EXTENT,0),p.emplaceBack(0,o.EXTENT),p.emplaceBack(o.EXTENT,o.EXTENT),this.debugBuffer=r.createVertexBuffer(p,o.posAttributes.members),this.debugSegments=o.SegmentVector.simpleSegment(0,0,4,5);const _=new o.StructArrayLayout2i4;_.emplaceBack(-1,-1),_.emplaceBack(1,-1),_.emplaceBack(-1,1),_.emplaceBack(1,1),this.viewportBuffer=r.createVertexBuffer(_,o.posAttributes.members),this.viewportSegments=o.SegmentVector.simpleSegment(0,0,4,2);const x=new o.StructArrayLayout4i8;x.emplaceBack(0,0,0,0),x.emplaceBack(o.EXTENT,0,o.EXTENT,0),x.emplaceBack(0,o.EXTENT,0,o.EXTENT),x.emplaceBack(o.EXTENT,o.EXTENT,o.EXTENT,o.EXTENT),this.mercatorBoundsBuffer=r.createVertexBuffer(x,o.boundsAttributes.members),this.mercatorBoundsSegments=o.SegmentVector.simpleSegment(0,0,4,2);const T=new o.StructArrayLayout3ui6;T.emplaceBack(0,1,2),T.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=r.createIndexBuffer(T);const C=new o.StructArrayLayout1ui2;for(const O of[0,1,3,2,0])C.emplaceBack(O);this.debugIndexBuffer=r.createIndexBuffer(C),this.emptyTexture=new o.Texture(r,new o.RGBAImage({width:1,height:1},Uint8Array.of(0,0,0,0)),r.gl.RGBA),this.identityMat=o.create();const M=this.context.gl;this.stencilClearMode=new o.StencilMode({func:M.ALWAYS,mask:0},0,255,M.ZERO,M.ZERO,M.ZERO),this.loadTimeStamps.push(o.window.performance.now()),this.atmosphereBuffer=new Kn(this.context)}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(r){return r._makeTileBoundsBuffers(this.context,this.transform.projection),r._tileBoundsBuffer?{tileBoundsBuffer:r._tileBoundsBuffer,tileBoundsIndexBuffer:r._tileBoundsIndexBuffer,tileBoundsSegments:r._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const r=this.context,l=r.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.useProgram("clippingMask").draw(r,l.TRIANGLES,o.DepthMode.disabled,this.stencilClearMode,o.ColorMode.disabled,o.CullFaceMode.disabled,dl(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(r,l,p){if(!l||this.currentStencilSource===l.id||!r.isTileClipped()||!p||p.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let C=!1;for(const M of p)if(this._tileClippingMaskIDs[M.key]===void 0){C=!0;break}if(!C)return}this.currentStencilSource=l.id;const _=this.context,x=_.gl;this.nextStencilID+p.length>256&&this.clearStencil(),_.setColorMode(o.ColorMode.disabled),_.setDepthMode(o.DepthMode.disabled);const T=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const C of p){const M=l.getTile(C),O=this._tileClippingMaskIDs[C.key]=this.nextStencilID++,{tileBoundsBuffer:R,tileBoundsIndexBuffer:U,tileBoundsSegments:G}=this.getTileBoundsBuffers(M);T.draw(_,x.TRIANGLES,o.DepthMode.disabled,new o.StencilMode({func:x.ALWAYS,mask:0},O,255,x.KEEP,x.KEEP,x.REPLACE),o.ColorMode.disabled,o.CullFaceMode.disabled,dl(C.projMatrix),"$clipping",R,U,G)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const r=this.nextStencilID++,l=this.context.gl;return new o.StencilMode({func:l.NOTEQUAL,mask:255},r,255,l.KEEP,l.KEEP,l.REPLACE)}stencilModeForClipping(r){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(r);const l=this.context.gl;return new o.StencilMode({func:l.EQUAL,mask:255},this._tileClippingMaskIDs[r.key],0,l.KEEP,l.KEEP,l.REPLACE)}stencilConfigForOverlap(r){const l=this.context.gl,p=r.sort((T,C)=>C.overscaledZ-T.overscaledZ),_=p[p.length-1].overscaledZ,x=p[0].overscaledZ-_+1;if(x>1){this.currentStencilSource=void 0,this.nextStencilID+x>256&&this.clearStencil();const T={};for(let C=0;C<x;C++)T[C+_]=new o.StencilMode({func:l.GEQUAL,mask:255},C+this.nextStencilID,255,l.KEEP,l.KEEP,l.REPLACE);return this.nextStencilID+=x,[T,p]}return[{[_]:o.StencilMode.disabled},p]}colorModeForRenderPass(){const r=this.context.gl;return this._showOverdrawInspector?new o.ColorMode([r.CONSTANT_COLOR,r.ONE],new o.Color(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?o.ColorMode.unblended:o.ColorMode.alphaBlended}depthModeForSublayer(r,l,p){if(!this.opaquePassEnabledForLayer())return o.DepthMode.disabled;const _=1-((1+this.currentLayer)*this.numSublayers+r)*this.depthEpsilon;return new o.DepthMode(p||this.context.gl.LEQUAL,l,[_,_])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(r,l){this.style=r,this.options=l,this.imageManager=r.imageManager,this.glyphManager=r.glyphManager,this.symbolFadeChange=r.placement.symbolFadeChange(o.exported.now()),this.imageManager.beginFrame();const p=this.style.order,_=this.style._sourceCaches;for(const M in _){const O=_[M];O.used&&O.prepare(this.context)}const x={},T={},C={};for(const M in _){const O=_[M];x[M]=O.getVisibleCoordinates(),T[M]=x[M].slice().reverse(),C[M]=O.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let M=0;M<p.length;M++)if(this.style._layers[p[M]].is3D()){this.opaquePassCutoff=M;break}if(this.terrain&&(this.terrain.updateTileBinding(C),this.opaquePassCutoff=0),this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new o.GlobeSharedBuffers(this.context)),o.isMapAuthenticated(this.context.gl)){this.renderPass="offscreen";for(const M of p){const O=this.style._layers[M],R=r._getLayerSourceCache(O);if(!O.hasOffscreenPass()||O.isHidden(this.transform.zoom))continue;const U=R?T[R.id]:void 0;(O.type==="custom"||O.isSky()||U&&U.length)&&this.renderLayer(this,R,O,U)}if(this.depthRangeFor3D=[0,1-(r.order.length+2)*this.numSublayers*this.depthEpsilon],this.terrain&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&this.terrain.drawDepth(),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]),this.context.clear({color:l.showOverdrawInspector?o.Color.black:o.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=l.showOverdrawInspector,this.renderPass="opaque",!this.terrain)for(this.currentLayer=p.length-1;this.currentLayer>=0;this.currentLayer--){const M=this.style._layers[p[this.currentLayer]],O=r._getLayerSourceCache(M);if(M.isSky())continue;const R=O?T[O.id]:void 0;this._renderTileClippingMasks(M,O,R),this.renderLayer(this,O,M,R)}if(this.style.fog&&this.transform.projection.supportsFog&&function(M,O){const R=M.context,U=R.gl,G=M.transform,ee=new o.DepthMode(U.LEQUAL,o.DepthMode.ReadOnly,[0,1]),Q=M.useProgram("globeAtmosphere",null,G.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"]),ne=o.globeToMercatorTransition(G.zoom),H=O.properties.get("color").toArray01(),X=O.properties.get("high-color").toArray01(),re=O.properties.get("space-color").toArray01PremultipliedAlpha(),ie=o.identity$1([]);o.rotateY$1(ie,ie,-o.degToRad(G._center.lng)),o.rotateX$1(ie,ie,o.degToRad(G._center.lat)),o.rotateZ$1(ie,ie,G.angle),o.rotateX$1(ie,ie,-G._pitch);const he=o.fromQuat(new Float32Array(16),ie),Ee=o.mapValue(O.properties.get("star-intensity"),0,1,0,.25),xe=5e-4,Pe=o.mapValue(O.properties.get("horizon-blend"),0,1,xe,.25),We=o.globeUseCustomAntiAliasing(M,R,G)&&Pe===xe?G.worldSize/(2*Math.PI*1.025)-1:G.globeRadius,je=M.frameCounter/1e3%1,Le=o.length(G.globeCenterInViewSpace),It=Math.sqrt(Math.pow(Le,2)-Math.pow(We,2)),Ue=Math.acos(It/Le),st=((Et,Je,pt,Pt,De,He,Qt,ln,Jt,mn,Sn,cn,Gt,ei)=>({u_frustum_tl:Et,u_frustum_tr:Je,u_frustum_br:pt,u_frustum_bl:Pt,u_horizon:De,u_transition:He,u_fadeout_range:Qt,u_color:ln,u_high_color:Jt,u_space_color:mn,u_star_intensity:Sn,u_star_size:5*o.exported.devicePixelRatio,u_star_density:0,u_temporal_offset:cn,u_horizon_angle:Gt,u_rotation_matrix:ei}))(G.frustumCorners.TL,G.frustumCorners.TR,G.frustumCorners.BR,G.frustumCorners.BL,G.frustumCorners.horizon,ne,Pe,H,X,re,Ee,je,Ue,he);M.prepareDrawProgram(R,Q);const Xe=M.atmosphereBuffer;Xe&&Q.draw(R,U.TRIANGLES,ee,o.StencilMode.disabled,o.ColorMode.alphaBlended,o.CullFaceMode.backCW,st,"skybox",Xe.vertexBuffer,Xe.indexBuffer,Xe.segments)}(this,this.style.fog),this.renderPass="sky",(o.globeToMercatorTransition(this.transform.zoom)>0||this.transform.projection.name!=="globe")&&this.transform.isHorizonVisible())for(this.currentLayer=0;this.currentLayer<p.length;this.currentLayer++){const M=this.style._layers[p[this.currentLayer]],O=r._getLayerSourceCache(M);M.isSky()&&this.renderLayer(this,O,M,O?T[O.id]:void 0)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<p.length;){const M=this.style._layers[p[this.currentLayer]],O=r._getLayerSourceCache(M);if(M.isSky()){++this.currentLayer;continue}if(this.terrain&&this.style.isLayerDraped(M)){if(M.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer);continue}const R=O?(M.type==="symbol"?C:T)[O.id]:void 0;this._renderTileClippingMasks(M,O,O?x[O.id]:void 0),this.renderLayer(this,O,M,R),++this.currentLayer}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let M=null;o.values(this.style._layers).forEach(O=>{const R=r._getLayerSourceCache(O);R&&!O.isHidden(this.transform.zoom)&&(!M||M.getSource().maxzoom<R.getSource().maxzoom)&&(M=R)}),M&&this.options.showTileBoundaries&&gl.debug(this,M,M.getVisibleCoordinates())}this.options.showPadding&&function(M){const O=M.transform.padding;hh(M,M.transform.height-(O.top||0),3,wg),hh(M,O.bottom||0,3,Eg),Ic(M,O.left||0,3,ch),Ic(M,M.transform.width-(O.right||0),3,uh);const R=M.transform.centerPoint;(function(U,G,ee,Q){yo(U,G-1,ee-10,2,20,Q),yo(U,G-10,ee-1,20,2,Q)})(M,R.x,M.transform.height-R.y,gf)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(o.window.performance.now()),this.saveCanvasCopy())}}renderLayer(r,l,p,_){p.isHidden(this.transform.zoom)||(p.type==="background"||p.type==="sky"||p.type==="custom"||_&&_.length)&&(this.id=p.id,this.gpuTimingStart(p),r.transform.projection.unsupportedLayers&&r.transform.projection.unsupportedLayers.includes(p.type)||gl[p.type](r,l,p,_,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(r){if(!this.options.gpuTiming)return;const l=this.context.extTimerQuery;let p=this.gpuTimers[r.id];p||(p=this.gpuTimers[r.id]={calls:0,cpuTime:0,query:l.createQueryEXT()}),p.calls++,l.beginQueryEXT(l.TIME_ELAPSED_EXT,p.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const r=this.context.extTimerQuery,l=r.createQueryEXT();this.deferredRenderGpuTimeQueries.push(l),r.beginQueryEXT(r.TIME_ELAPSED_EXT,l)}}gpuTimingDeferredRenderEnd(){if(!this.options.gpuTimingDeferredRender)return;const r=this.context.extTimerQuery;r.endQueryEXT(r.TIME_ELAPSED_EXT)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const r=this.context.extTimerQuery;r.endQueryEXT(r.TIME_ELAPSED_EXT)}collectGpuTimers(){const r=this.gpuTimers;return this.gpuTimers={},r}collectDeferredRenderGpuQueries(){const r=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],r}queryGpuTimers(r){const l={};for(const p in r){const _=r[p],x=this.context.extTimerQuery,T=x.getQueryObjectEXT(_.query,x.QUERY_RESULT_EXT)/1e6;x.deleteQueryEXT(_.query),l[p]=T}return l}queryGpuTimeDeferredRender(r){if(!this.options.gpuTimingDeferredRender)return 0;const l=this.context.extTimerQuery;let p=0;for(const _ of r)p+=l.getQueryObjectEXT(_,l.QUERY_RESULT_EXT)/1e6,l.deleteQueryEXT(_);return p}translatePosMatrix(r,l,p,_,x){if(!p[0]&&!p[1])return r;const T=x?_==="map"?this.transform.angle:0:_==="viewport"?-this.transform.angle:0;if(T){const O=Math.sin(T),R=Math.cos(T);p=[p[0]*R-p[1]*O,p[0]*O+p[1]*R]}const C=[x?p[0]:xn(l,p[0],this.transform.zoom),x?p[1]:xn(l,p[1],this.transform.zoom),0],M=new Float32Array(16);return o.translate(M,r,C),M}saveTileTexture(r){const l=this._tileTextures[r.size[0]];l?l.push(r):this._tileTextures[r.size[0]]=[r]}getTileTexture(r){const l=this._tileTextures[r];return l&&l.length>0?l.pop():null}isPatternMissing(r){return r===null||r!==void 0&&!this.imageManager.getPattern(r.toString())}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture}currentGlobalDefines(){const r=this.terrain&&this.terrain.renderingToTexture,l=this.terrain&&this.terrain.exaggeration()===0,p=this.style&&this.style.fog,_=[];return this.terrainRenderModeElevated()&&_.push("TERRAIN"),this.transform.projection.name==="globe"&&_.push("GLOBE"),l&&_.push("ZERO_EXAGGERATION"),p&&!r&&p.getOpacity(this.transform.pitch)!==0&&_.push("FOG"),r&&_.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&_.push("OVERDRAW_INSPECTOR"),_}useProgram(r,l,p){this.cache=this.cache||{};const _=p||[],x=this.currentGlobalDefines().concat(_),T=th.cacheKey(Yu[r],r,x,l);return this.cache[T]||(this.cache[T]=new th(this.context,r,Yu[r],l,vg[r],x)),this.cache[T]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const r=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(r.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=o.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new o.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this.atmosphereBuffer&&this.atmosphereBuffer.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}prepareDrawProgram(r,l,p){if(this.terrain&&this.terrain.renderingToTexture)return;const _=this.style.fog;if(_){const x=_.getOpacity(this.transform.pitch),T=((C,M,O,R,U,G,ee,Q,ne,H,X)=>{const re=C.transform,ie=M.properties.get("color").toArray01();ie[3]=R;const he=C.frameCounter/1e3%1;return{u_fog_matrix:O?re.calculateFogTileMatrix(O):C.identityMat,u_fog_range:M.getFovAdjustedRange(re._fov),u_fog_color:ie,u_fog_horizon_blend:M.properties.get("horizon-blend"),u_fog_temporal_offset:he,u_frustum_tl:U,u_frustum_tr:G,u_frustum_br:ee,u_frustum_bl:Q,u_globe_pos:ne,u_globe_radius:H,u_viewport:X,u_globe_transition:o.globeToMercatorTransition(re.zoom),u_is_globe:+(re.projection.name==="globe")}})(this,_,p,x,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*o.exported.devicePixelRatio,this.transform.height*o.exported.devicePixelRatio]);l.setFogUniformValues(r,T)}}setTileLoadedFlag(r){this.tileLoaded=r}saveCanvasCopy(){this.frameCopies.push(this.canvasCopy()),this.tileLoaded=!1}canvasCopy(){const r=this.context.gl,l=r.createTexture();return r.bindTexture(r.TEXTURE_2D,l),r.copyTexImage2D(r.TEXTURE_2D,0,r.RGBA,0,0,r.drawingBufferWidth,r.drawingBufferHeight,0),l}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const r=this.style&&this.style.fog;return!!r&&r.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const r=this._backgroundTiles,l=this._backgroundTiles={},p=this.transform.coveringTiles({tileSize:512});for(const _ of p)l[_.key]=r[_.key]||new o.Tile(_,512,this.transform.tileZoom,this);return l}clearBackgroundTiles(){this._backgroundTiles={}}}class kc{constructor(r=0,l=0,p=0,_=0){if(isNaN(r)||r<0||isNaN(l)||l<0||isNaN(p)||p<0||isNaN(_)||_<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=r,this.bottom=l,this.left=p,this.right=_}interpolate(r,l,p){return l.top!=null&&r.top!=null&&(this.top=o.number(r.top,l.top,p)),l.bottom!=null&&r.bottom!=null&&(this.bottom=o.number(r.bottom,l.bottom,p)),l.left!=null&&r.left!=null&&(this.left=o.number(r.left,l.left,p)),l.right!=null&&r.right!=null&&(this.right=o.number(r.right,l.right,p)),this}getCenter(r,l){const p=o.clamp((this.left+r-this.right)/2,0,r),_=o.clamp((this.top+l-this.bottom)/2,0,l);return new o.pointGeometry(p,_)}equals(r){return this.top===r.top&&this.bottom===r.bottom&&this.left===r.left&&this.right===r.right}clone(){return new kc(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function da(h,r){const l=o.getColumn(h,3);o.fromQuat(h,r),o.setColumn(h,3,l)}function fh(h,r){const l=o.identity$1([]);return o.rotateZ$1(l,l,-r),o.rotateX$1(l,l,-h),l}function vf(h,r){const l=[h[0],h[1],0],p=[r[0],r[1],0];if(o.length(l)>=1e-15){const T=o.normalize([],l);o.scale$2(p,T,o.dot(p,T)),r[0]=p[0],r[1]=p[1]}const _=o.cross([],r,h);if(o.len(_)<1e-15)return null;const x=Math.atan2(-_[1],_[0]);return fh(Math.atan2(Math.sqrt(h[0]*h[0]+h[1]*h[1]),-h[2]),x)}class ph{constructor(r,l){this.position=r,this.orientation=l}get position(){return this._position}set position(r){if(r){const l=r instanceof o.MercatorCoordinate?r:new o.MercatorCoordinate(r[0],r[1],r[2]);this._renderWorldCopies&&(l.x=o.wrap(l.x,0,1)),this._position=l}else this._position=null}lookAtPoint(r,l){if(this.orientation=null,!this.position)return;const p=this._elevation?this._elevation.getAtPointOrZero(o.MercatorCoordinate.fromLngLat(r)):0,_=this.position,x=o.MercatorCoordinate.fromLngLat(r,p),T=[x.x-_.x,x.y-_.y,x.z-_.z];l||(l=[0,0,1]),l[2]=Math.abs(l[2]),this.orientation=vf(T,l)}setPitchBearing(r,l){this.orientation=fh(o.degToRad(r),o.degToRad(-l))}}class mh{constructor(r,l){this._transform=o.identity([]),this.orientation=l,this.position=r}get mercatorPosition(){const r=this.position;return new o.MercatorCoordinate(r[0],r[1],r[2])}get position(){const r=o.getColumn(this._transform,3);return[r[0],r[1],r[2]]}set position(r){var l;r&&o.setColumn(this._transform,3,[(l=r)[0],l[1],l[2],1])}get orientation(){return this._orientation}set orientation(r){this._orientation=r||o.identity$1([]),r&&da(this._transform,this._orientation)}getPitchBearing(){const r=this.forward(),l=this.right();return{bearing:Math.atan2(-l[1],l[0]),pitch:Math.atan2(Math.sqrt(r[0]*r[0]+r[1]*r[1]),-r[2])}}setPitchBearing(r,l){this._orientation=fh(r,l),da(this._transform,this._orientation)}forward(){const r=o.getColumn(this._transform,2);return[-r[0],-r[1],-r[2]]}up(){const r=o.getColumn(this._transform,1);return[-r[0],-r[1],-r[2]]}right(){const r=o.getColumn(this._transform,0);return[r[0],r[1],r[2]]}getCameraToWorld(r,l){const p=new Float64Array(16);return o.invert(p,this.getWorldToCamera(r,l)),p}getWorldToCameraPosition(r,l,p){const _=this.position;o.scale$2(_,_,-r);const x=new Float64Array(16);return o.fromScaling(x,[p,p,p]),o.translate(x,x,_),x[10]*=l,x}getWorldToCamera(r,l){const p=new Float64Array(16),_=new Float64Array(4),x=this.position;return o.conjugate(_,this._orientation),o.scale$2(x,x,-r),o.fromQuat(p,_),o.translate(p,p,x),p[1]*=-1,p[5]*=-1,p[9]*=-1,p[13]*=-1,p[8]*=l,p[9]*=l,p[10]*=l,p[11]*=l,p}getCameraToClipPerspective(r,l,p,_){const x=new Float64Array(16);return o.perspective(x,r,l,p,_),x}getDistanceToElevation(r,l=!1){const p=r===0?0:o.mercatorZfromAltitude(r,l?o.latFromMercatorY(this.position[1]):this.position[1]),_=this.forward();return(p-this.position[2])/_[2]}clone(){return new mh([...this.position],[...this.orientation])}}function Pc(h,r){const l=ss(h.projection,h.zoom,h.width,h.height),p=function(x,T,C,M,O){const R=new o.LngLat(C.lng-180*as,C.lat),U=new o.LngLat(C.lng+180*as,C.lat),G=x.project(R.lng,R.lat),ee=x.project(U.lng,U.lat),Q=-Math.atan2(ee.y-G.y,ee.x-G.x),ne=o.MercatorCoordinate.fromLngLat(C);ne.y=o.clamp(ne.y,-.999975,.999975);const H=ne.toLngLat(),X=x.project(H.lng,H.lat),re=o.MercatorCoordinate.fromLngLat(H);re.x+=as;const ie=re.toLngLat(),he=x.project(ie.lng,ie.lat),Ee=gh(he.x-X.x,he.y-X.y,Q),xe=o.MercatorCoordinate.fromLngLat(H);xe.y+=as;const Pe=xe.toLngLat(),We=x.project(Pe.lng,Pe.lat),je=gh(We.x-X.x,We.y-X.y,Q),Le=Math.abs(Ee.x)/Math.abs(je.y),It=o.identity([]);o.rotateZ(It,It,-Q*(1-(O?0:M)));const Ue=o.identity([]);return o.scale(Ue,Ue,[1,1-(1-Le)*M,1]),Ue[4]=-je.x/je.y*M,o.rotateZ(Ue,Ue,Q),o.multiply(Ue,It,Ue),Ue}(h.projection,0,h.center,l,r),_=_l(h);return o.scale(p,p,[_,_,1]),p}function _l(h){const r=h.projection,l=ss(h.projection,h.zoom,h.width,h.height),p=zc(r,h.center),_=zc(r,o.LngLat.convert(r.center));return Math.pow(2,p*l+(1-l)*_)}function ss(h,r,l,p,_=1/0){const x=h.range;if(!x)return 0;const T=Math.min(_,Math.max(l,p)),C=Math.log(T/1024)/Math.LN2;return o.smoothstep(x[0]+C,x[1]+C,r)}const as=1/4e4;function zc(h,r){const l=o.clamp(r.lat,-o.MAX_MERCATOR_LATITUDE,o.MAX_MERCATOR_LATITUDE),p=new o.LngLat(r.lng-180*as,l),_=new o.LngLat(r.lng+180*as,l),x=h.project(p.lng,l),T=h.project(_.lng,l),C=o.MercatorCoordinate.fromLngLat(p),M=o.MercatorCoordinate.fromLngLat(_),O=T.x-x.x,R=T.y-x.y,U=M.x-C.x,G=M.y-C.y,ee=Math.sqrt((U*U+G*G)/(O*O+R*R));return Math.log(ee)/Math.LN2}function gh(h,r,l){const p=Math.cos(l),_=Math.sin(l);return{x:h*p-r*_,y:h*_+r*p}}class fa{constructor(r,l,p,_,x,T,C){this.tileSize=512,this._renderWorldCopies=x===void 0||x,this._minZoom=r||0,this._maxZoom=l||22,this._minPitch=p==null?0:p,this._maxPitch=_==null?60:_,this.setProjection(T),this.setMaxBounds(C),this.width=0,this.height=0,this._center=new o.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new kc,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._distanceTileDataCache={},this._camera=new mh,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._horizonShift=.1}clone(){const r=new fa(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return r._elevation=this._elevation,r._centerAltitude=this._centerAltitude,r._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,r.tileSize=this.tileSize,r.mercatorFromTransition=this.mercatorFromTransition,r.width=this.width,r.height=this.height,r.cameraElevationReference=this.cameraElevationReference,r._center=this._center,r._setZoom(this.zoom),r._seaLevelZoom=this._seaLevelZoom,r.angle=this.angle,r._fov=this._fov,r._pitch=this._pitch,r._nearZ=this._nearZ,r._farZ=this._farZ,r._averageElevation=this._averageElevation,r._unmodified=this._unmodified,r._edgeInsets=this._edgeInsets.clone(),r._camera=this._camera.clone(),r._calcMatrices(),r.freezeTileCoverage=this.freezeTileCoverage,r.frustumCorners=this.frustumCorners,r}get elevation(){return this._elevation}set elevation(r){this._elevation!==r&&(this._elevation=r,this._updateCameraOnTerrain(),this._calcMatrices())}updateElevation(r,l=!1){const p=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||p)&&this._updateCameraOnTerrain(),(r||p)&&this._constrainCamera(l),this._calcMatrices()}getProjection(){return o.pick(this.projection,["name","center","parallels"])}setProjection(r){this.projectionOptions=r||{name:"mercator"};const l=this.projection?this.getProjection():void 0;this.projection=o.getProjection(this.projectionOptions);const p=!S(l,this.getProjection());return p&&this._calcMatrices(),this.mercatorFromTransition=!1,p}setMercatorFromTransition(){const r=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=o.getProjection({name:"mercator"});const l=r!==this.projection.name;return l&&this._calcMatrices(),l}get minZoom(){return this._minZoom}set minZoom(r){this._minZoom!==r&&(this._minZoom=r,this.zoom=Math.max(this.zoom,r))}get maxZoom(){return this._maxZoom}set maxZoom(r){this._maxZoom!==r&&(this._maxZoom=r,this.zoom=Math.min(this.zoom,r))}get minPitch(){return this._minPitch}set minPitch(r){this._minPitch!==r&&(this._minPitch=r,this.pitch=Math.max(this.pitch,r))}get maxPitch(){return this._maxPitch}set maxPitch(r){this._maxPitch!==r&&(this._maxPitch=r,this.pitch=Math.min(this.pitch,r))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(r){r===void 0?r=!0:r===null&&(r=!1),this._renderWorldCopies=r}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const r=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(r))}get cameraWorldSize(){const r=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(r))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return o.mercatorZfromAltitude(this.center.lat,this.cameraWorldSizeForFog)}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new o.pointGeometry(this.width,this.height)}get bearing(){return o.wrap(this.rotation,-180,180)}set bearing(r){this.rotation=r}get rotation(){return-this.angle/Math.PI*180}set rotation(r){const l=-r*Math.PI/180;var p;this.angle!==l&&(this._unmodified=!1,this.angle=l,this._calcMatrices(),this.rotationMatrix=(p=new o.ARRAY_TYPE(4),o.ARRAY_TYPE!=Float32Array&&(p[1]=0,p[2]=0),p[0]=1,p[3]=1,p),function(_,x,T){var C=x[0],M=x[1],O=x[2],R=x[3],U=Math.sin(T),G=Math.cos(T);_[0]=C*G+O*U,_[1]=M*G+R*U,_[2]=C*-U+O*G,_[3]=M*-U+R*G}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(r){const l=o.clamp(r,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==l&&(this._unmodified=!1,this._pitch=l,this._calcMatrices())}get aspect(){return this.width/this.height}get fovX(){return this._fov}get fovY(){const r=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/r)}set fov(r){r=Math.max(.01,Math.min(60,r)),this._fov!==r&&(this._unmodified=!1,this._fov=o.degToRad(r),this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(r){this._averageElevation=r,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(r){const l=Math.min(Math.max(r,this.minZoom),this.maxZoom);this._zoom!==l&&(this._unmodified=!1,this._setZoom(l),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(r){this._zoom=r,this.scale=this.zoomScale(r),this.tileZoom=Math.floor(r),this.zoomFraction=r-this.tileZoom}_updateCameraOnTerrain(){if(!this._elevation||!this._elevation.isDataAvailableAtPoint(this.locationCoordinate(this.center)))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const r=this._elevation;this._centerAltitude=r.getAtPointOrZero(this.locationCoordinate(this.center)),this._centerAltitudeValidForExaggeration=r.exaggeration(),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){this._centerAltitudeValidForExaggeration!==void 0&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const r=this._elevation,l=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],p=this.horizonLineFromTop();let _=0,x=0;for(let T=0;T<l.length;T++){const C=new o.pointGeometry(l[T][0]*this.width,p+l[T][1]*(this.height-p)),M=r.pointCoordinate(C);if(!M)continue;const O=1/Math.hypot(M[0]-this._camera.position[0],M[1]-this._camera.position[1]);_+=M[3]*O,x+=O}return x===0?NaN:_/x}get center(){return this._center}set center(r){r.lat===this._center.lat&&r.lng===this._center.lng||(this._unmodified=!1,this._center=r,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;const r=this._seaLevelZoom,l=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),p=this.pixelsPerMeter/this.worldSize*l,_=this._mercatorZfromZoom(r),x=this._mercatorZfromZoom(this._maxZoom),T=Math.max(_-p,x);this._setZoom(this._zoomFromMercatorZ(T))}get padding(){return this._edgeInsets.toJSON()}set padding(r){this._edgeInsets.equals(r)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,r,1),this._calcMatrices())}computeZoomRelativeTo(r){const l=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,r.toAltitude()));let p;p=r.z<this._camera.position[2]?[l.x,l.y,l.z]:[r.x,r.y,r.z];const _=o.length(o.sub([],this._camera.position,p));return o.clamp(this._zoomFromMercatorZ(_),this._minZoom,this._maxZoom)}setFreeCameraOptions(r){if(!this.height||!r.position&&!r.orientation)return;this._updateCameraState();let l=!1;if(r.orientation&&!o.exactEquals(r.orientation,this._camera.orientation)&&(l=this._setCameraOrientation(r.orientation)),r.position){const p=[r.position.x,r.position.y,r.position.z];o.exactEquals$1(p,this._camera.position)||(this._setCameraPosition(p),l=!0)}l&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const r=this._camera.position,l=new ph;return l.position=new o.MercatorCoordinate(r[0],r[1],r[2]),l.orientation=this._camera.orientation,l._elevation=this.elevation,l._renderWorldCopies=this.renderWorldCopies,l}_setCameraOrientation(r){if(!o.length$1(r))return!1;o.normalize$1(r,r);const l=o.transformQuat([],[0,0,-1],r),p=o.transformQuat([],[0,-1,0],r);if(p[2]<0)return!1;const _=vf(l,p);return!!_&&(this._camera.orientation=_,!0)}_setCameraPosition(r){const l=this.zoomScale(this.minZoom)*this.tileSize,p=this.zoomScale(this.maxZoom)*this.tileSize,_=this.cameraToCenterDistance;r[2]=o.clamp(r[2],_/p,_/l),this._camera.position=r}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(r){return this._edgeInsets.equals(r)}interpolatePadding(r,l,p){this._unmodified=!1,this._edgeInsets.interpolate(r,l,p),this._constrain(),this._calcMatrices()}coveringZoomLevel(r){const l=(r.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/r.tileSize));return Math.max(0,l)}getVisibleUnwrappedCoordinates(r){const l=[new o.UnwrappedTileID(0,r)];if(this.renderWorldCopies){const p=this.pointCoordinate(new o.pointGeometry(0,0)),_=this.pointCoordinate(new o.pointGeometry(this.width,0)),x=this.pointCoordinate(new o.pointGeometry(this.width,this.height)),T=this.pointCoordinate(new o.pointGeometry(0,this.height)),C=Math.floor(Math.min(p.x,_.x,x.x,T.x)),M=Math.floor(Math.max(p.x,_.x,x.x,T.x)),O=1;for(let R=C-O;R<=M+O;R++)R!==0&&l.push(new o.UnwrappedTileID(R,r))}return l}coveringTiles(r){let l=this.coveringZoomLevel(r);const p=l,_=this.elevation&&!r.isTerrainDEM,x=this.projection.name==="mercator";if(r.minzoom!==void 0&&l<r.minzoom)return[];r.maxzoom!==void 0&&l>r.maxzoom&&(l=r.maxzoom);const T=this.locationCoordinate(this.center),C=this.center.lat,M=1<<l,O=[M*T.x,M*T.y,0],R=this.projection.name==="globe",U=!R,G=o.Frustum.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,l,U),ee=R?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),Q=M*o.mercatorZfromAltitude(1,this.center.lat),ne=this._camera.position[2]/o.mercatorZfromAltitude(1,this.center.lat),H=[M*ee.x,M*ee.y,ne*(U?1:Q)],X=this.cameraToCenterDistance/r.tileSize*(r.roundZoom?1:.502),re=this.pitch<=60&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace?l:0,ie=r.isTerrainDEM&&this._elevation?1e4*this._elevation.exaggeration():this._centerAltitude,he=r.isTerrainDEM?-ie:this._elevation?this._elevation.getMinElevationBelowMSL():0,Ee=this.projection.isReprojectedInTileSpace?_l(this):1,xe=Je=>{const Pt=new o.MercatorCoordinate(Je.x+25e-6,Je.y,Je.z),De=new o.MercatorCoordinate(Je.x,Je.y+25e-6,Je.z),He=Je.toLngLat(),Qt=Pt.toLngLat(),ln=De.toLngLat(),Jt=this.locationCoordinate(He),mn=this.locationCoordinate(Qt),Sn=this.locationCoordinate(ln),cn=Math.hypot(mn.x-Jt.x,mn.y-Jt.y),Gt=Math.hypot(Sn.x-Jt.x,Sn.y-Jt.y);return Math.sqrt(cn*Gt)*Ee/25e-6},Pe=Je=>{const pt=ie,Pt=he;return{aabb:o.tileAABB(this,M,0,0,0,Je,Pt,pt,this.projection),zoom:0,x:0,y:0,minZ:Pt,maxZ:pt,wrap:Je,fullyVisible:!1}},We=[];let je=[];const Le=l,It=r.reparseOverscaled?p:l,Ue=Je=>Je*Je,st=Ue((ne-this._centerAltitude)*Q),Xe=Je=>{if(!this._elevation||!Je.tileID||!x)return;const pt=this._elevation.getMinMaxForTile(Je.tileID),Pt=Je.aabb;pt?(Pt.min[2]=pt.min,Pt.max[2]=pt.max,Pt.center[2]=(Pt.min[2]+Pt.max[2])/2):(Je.shouldSplit=Et(Je),Je.shouldSplit||(Pt.min[2]=Pt.max[2]=Pt.center[2]=this._centerAltitude))},Et=Je=>{if(Je.zoom<re)return!0;if(Je.zoom===Le)return!1;if(Je.shouldSplit!=null)return Je.shouldSplit;const pt=Je.aabb.distanceX(H),Pt=Je.aabb.distanceY(H);let De=st,He=1;if(R){De=Ue(Je.aabb.distanceZ(H));const Jt=Math.pow(2,Je.zoom),mn=o.latFromMercatorY((Je.y+1)/Jt),Sn=o.latFromMercatorY(Je.y/Jt),cn=Math.min(Math.max(C,mn),Sn),Gt=o.circumferenceAtLatitude(cn)/o.circumferenceAtLatitude(C);if(He=cn===C?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,Gt/this._mercatorScaleRatio),this.zoom<=o.GLOBE_ZOOM_THRESHOLD_MIN&&Je.zoom===Le-1&&Gt>=.9)return!0}else if(_&&(De=Ue(Je.aabb.distanceZ(H)*Q)),this.projection.isReprojectedInTileSpace&&p<=5){const Jt=Math.pow(2,Je.zoom),mn=xe(new o.MercatorCoordinate((Je.x+.5)/Jt,(Je.y+.5)/Jt));He=mn>.85?1:mn}const Qt=pt*pt+Pt*Pt+De,ln=Ue((1<<Le-Je.zoom)*X*He*((Jt,mn)=>{if(mn*Ue(.707)<Jt)return 1;const Sn=Math.sqrt(mn/Jt);return Sn/(1.4144271570014144+(Math.pow(1.1,Sn-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(De,st),Qt));return Qt<ln};if(this.renderWorldCopies)for(let Je=1;Je<=3;Je++)We.push(Pe(-Je)),We.push(Pe(Je));for(We.push(Pe(0));We.length>0;){const Je=We.pop(),pt=Je.x,Pt=Je.y;let De=Je.fullyVisible;if(!De){const He=Je.aabb.intersects(G);if(He===0)continue;De=He===2}if(Je.zoom!==Le&&Et(Je))for(let He=0;He<4;He++){const Qt=(pt<<1)+He%2,ln=(Pt<<1)+(He>>1),Jt={aabb:x?Je.aabb.quadrant(He):o.tileAABB(this,M,Je.zoom+1,Qt,ln,Je.wrap,Je.minZ,Je.maxZ,this.projection),zoom:Je.zoom+1,x:Qt,y:ln,wrap:Je.wrap,fullyVisible:De,tileID:void 0,shouldSplit:void 0,minZ:Je.minZ,maxZ:Je.maxZ};_&&!R&&(Jt.tileID=new o.OverscaledTileID(Je.zoom+1===Le?It:Je.zoom+1,Je.wrap,Je.zoom+1,Qt,ln),Xe(Jt)),We.push(Jt)}else{const He=Je.zoom===Le?It:Je.zoom;if(r.minzoom&&r.minzoom>He)continue;const Qt=O[0]-(.5+pt+(Je.wrap<<Je.zoom))*(1<<l-Je.zoom),ln=O[1]-.5-Pt,Jt=Je.tileID?Je.tileID:new o.OverscaledTileID(He,Je.wrap,Je.zoom,pt,Pt);je.push({tileID:Jt,distanceSq:Qt*Qt+ln*ln})}}if(this.fogCullDistSq){const Je=this.fogCullDistSq,pt=this.horizonLineFromTop();je=je.filter(Pt=>{const De=[0,0,0,1],He=[o.EXTENT,o.EXTENT,0,1],Qt=this.calculateFogTileMatrix(Pt.tileID.toUnwrapped());o.transformMat4$1(De,De,Qt),o.transformMat4$1(He,He,Qt);const ln=o.getAABBPointSquareDist(De,He);if(ln===0)return!0;let Jt=!1;const mn=this._elevation;if(mn&&ln>Je&&pt!==0){const Sn=this.calculateProjMatrix(Pt.tileID.toUnwrapped());let cn;r.isTerrainDEM||(cn=mn.getMinMaxForTile(Pt.tileID)),cn||(cn={min:he,max:ie});const Gt=o.furthestTileCorner(this.rotation),ei=[Gt[0]*o.EXTENT,Gt[1]*o.EXTENT,cn.max];o.transformMat4(ei,ei,Sn),Jt=(1-ei[1])*this.height*.5<pt}return ln<Je||Jt})}return je.sort((Je,pt)=>Je.distanceSq-pt.distanceSq).map(Je=>Je.tileID)}resize(r,l){this.width=r,this.height=l,this.pixelsToGLUnits=[2/r,-2/l],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(r){return Math.pow(2,r)}scaleZoom(r){return Math.log(r)/Math.LN2}project(r){const l=o.clamp(r.lat,-o.MAX_MERCATOR_LATITUDE,o.MAX_MERCATOR_LATITUDE),p=this.projection.project(r.lng,l);return new o.pointGeometry(p.x*this.worldSize,p.y*this.worldSize)}unproject(r){return this.projection.unproject(r.x/this.worldSize,r.y/this.worldSize)}get point(){return this.project(this.center)}setLocationAtPoint(r,l){let p,_;const x=this.centerPoint;if(this.projection.name==="globe"){const C=this.worldSize;p=(l.x-x.x)/C,_=(l.y-x.y)/C}else{const C=this.pointCoordinate(l),M=this.pointCoordinate(x);p=C.x-M.x,_=C.y-M.y}const T=this.locationCoordinate(r);this.setLocation(new o.MercatorCoordinate(T.x-p,T.y-_))}setLocation(r){this.center=this.coordinateLocation(r),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(r){return this.projection.locationPoint(this,r)}locationPoint3D(r){return this.projection.locationPoint(this,r,!0)}pointLocation(r){return this.coordinateLocation(this.pointCoordinate(r))}pointLocation3D(r){return this.coordinateLocation(this.pointCoordinate3D(r))}locationCoordinate(r,l){const p=l?o.mercatorZfromAltitude(l,r.lat):void 0,_=this.projection.project(r.lng,r.lat);return new o.MercatorCoordinate(_.x,_.y,p)}coordinateLocation(r){return this.projection.unproject(r.x,r.y)}pointRayIntersection(r,l){const p=l!=null?l:this._centerAltitude,_=[r.x,r.y,0,1],x=[r.x,r.y,1,1];o.transformMat4$1(_,_,this.pixelMatrixInverse),o.transformMat4$1(x,x,this.pixelMatrixInverse);const T=x[3];o.scale$1(_,_,1/_[3]),o.scale$1(x,x,1/T);const C=_[2],M=x[2];return{p0:_,p1:x,t:C===M?0:(p-C)/(M-C)}}screenPointToMercatorRay(r){const l=[r.x,r.y,0,1],p=[r.x,r.y,1,1];return o.transformMat4$1(l,l,this.pixelMatrixInverse),o.transformMat4$1(p,p,this.pixelMatrixInverse),o.scale$1(l,l,1/l[3]),o.scale$1(p,p,1/p[3]),l[2]=o.mercatorZfromAltitude(l[2],this._center.lat)*this.worldSize,p[2]=o.mercatorZfromAltitude(p[2],this._center.lat)*this.worldSize,o.scale$1(l,l,1/this.worldSize),o.scale$1(p,p,1/this.worldSize),new o.Ray([l[0],l[1],l[2]],o.normalize([],o.sub([],p,l)))}rayIntersectionCoordinate(r){const{p0:l,p1:p,t:_}=r,x=o.mercatorZfromAltitude(l[2],this._center.lat),T=o.mercatorZfromAltitude(p[2],this._center.lat);return new o.MercatorCoordinate(o.number(l[0],p[0],_)/this.worldSize,o.number(l[1],p[1],_)/this.worldSize,o.number(x,T,_))}pointCoordinate(r,l=this._centerAltitude){return this.projection.pointCoordinate(this,r.x,r.y,l)}pointCoordinate3D(r){if(!this.elevation)return this.pointCoordinate(r);let l=this.projection.pointCoordinate3D(this,r.x,r.y);if(l)return new o.MercatorCoordinate(l[0],l[1],l[2]);let p=0,_=this.horizonLineFromTop();if(r.y>_)return this.pointCoordinate(r);const x=.02*_,T=r.clone();for(let C=0;C<10&&_-p>x;C++){T.y=o.number(p,_,.66);const M=this.projection.pointCoordinate3D(this,T.x,T.y);M?(_=T.y,l=M):p=T.y}return l?new o.MercatorCoordinate(l[0],l[1],l[2]):this.pointCoordinate(r)}isPointAboveHorizon(r){return this.projection.isPointAboveHorizon(this,r)}_coordinatePoint(r,l){const p=l&&this.elevation?this.elevation.getAtPointOrZero(r,this._centerAltitude):this._centerAltitude,_=[r.x*this.worldSize,r.y*this.worldSize,p+r.toAltitude(),1];return o.transformMat4$1(_,_,this.pixelMatrix),_[3]>0?new o.pointGeometry(_[0]/_[3],_[1]/_[3]):new o.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE)}_getGlobeBounds(){const{top:r,left:l}=this._edgeInsets,p=this.height-this._edgeInsets.bottom,_=this.width-this._edgeInsets.right,x=this.pointCoordinate3D(new o.pointGeometry(l,r)),T=this.pointCoordinate3D(new o.pointGeometry(_,r)),C=this.pointCoordinate3D(new o.pointGeometry(_,p)),M=this.pointCoordinate3D(new o.pointGeometry(l,p));let O=Math.min(x.x,M.x),R=Math.max(T.x,C.x),U=Math.min(x.y,T.y),G=Math.max(M.y,C.y);const ee=Math.pow(2,-this.zoom)/16,Q=(xe,Pe,We,je)=>{const Le=(xe+We)/2,It=(Pe+je)/2,Ue=new o.pointGeometry(Le,It),st=this.pointCoordinate3D(Ue),Xe=Math.max(0,O-st.x,U-st.y,st.x-R,st.y-G);O=Math.min(O,st.x),R=Math.max(R,st.x),U=Math.min(U,st.y),G=Math.max(G,st.y),Xe>ee&&(Q(xe,Pe,Le,It),Q(Le,It,We,je))};Q(l,r,_,r),Q(_,r,_,p),Q(_,p,l,p),Q(l,p,l,r);const[ne,H]=o.polesInViewport(this),X=ne||H,re=ne?90:o.latFromMercatorY(U),ie=X?180:o.lngFromMercatorX(R),he=H?-90:o.latFromMercatorY(G),Ee=X?-180:o.lngFromMercatorX(O);return new o.LngLatBounds(new o.LngLat(Ee,he),new o.LngLat(ie,re))}_getBounds(r,l){if(this.projection.name==="globe")return this._getGlobeBounds();const p=new o.pointGeometry(this._edgeInsets.left,this._edgeInsets.top),_=new o.pointGeometry(this.width-this._edgeInsets.right,this._edgeInsets.top),x=new o.pointGeometry(this.width-this._edgeInsets.right,this.height-this._edgeInsets.bottom),T=new o.pointGeometry(this._edgeInsets.left,this.height-this._edgeInsets.bottom);let C=this.pointCoordinate(p,r),M=this.pointCoordinate(_,r);const O=this.pointCoordinate(x,l),R=this.pointCoordinate(T,l),U=(G,ee)=>(ee.y-G.y)/(ee.x-G.x);return C.y>1&&M.y>=0?C=new o.MercatorCoordinate((1-R.y)/U(R,C)+R.x,1):C.y<0&&M.y<=1&&(C=new o.MercatorCoordinate(-R.y/U(R,C)+R.x,0)),M.y>1&&C.y>=0?M=new o.MercatorCoordinate((1-O.y)/U(O,M)+O.x,1):M.y<0&&C.y<=1&&(M=new o.MercatorCoordinate(-O.y/U(O,M)+O.x,0)),new o.LngLatBounds().extend(this.coordinateLocation(C)).extend(this.coordinateLocation(M)).extend(this.coordinateLocation(R)).extend(this.coordinateLocation(O))}_getBounds3D(){const r=this.elevation;if(!r.visibleDemTiles.length||r.isUsingMockSource())return this._getBounds(0,0);const l=r.visibleDemTiles.reduce((p,_)=>{if(_.dem){const x=_.dem.tree;p.min=Math.min(p.min,x.minimums[0]),p.max=Math.max(p.max,x.maximums[0])}return p},{min:Number.MAX_VALUE,max:0});return this._getBounds(l.min*r.exaggeration(),l.max*r.exaggeration())}getBounds(){return this._terrainEnabled()?this._getBounds3D():this._getBounds(0,0)}horizonLineFromTop(r=!0){const l=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))+this.centerOffset.y,p=this.height/2-l*(1-this._horizonShift);return r?Math.max(0,p):p}getMaxBounds(){return this.maxBounds}setMaxBounds(r){this.maxBounds=r,this.minLat=-o.MAX_MERCATOR_LATITUDE,this.maxLat=o.MAX_MERCATOR_LATITUDE,this.minLng=-180,this.maxLng=180,r&&(this.minLat=r.getSouth(),this.maxLat=r.getNorth(),this.minLng=r.getWest(),this.maxLng=r.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=o.mercatorXfromLng(this.minLng)*this.tileSize,this.worldMaxX=o.mercatorXfromLng(this.maxLng)*this.tileSize,this.worldMinY=o.mercatorYfromLat(this.maxLat)*this.tileSize,this.worldMaxY=o.mercatorYfromLat(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(r,l){return this.projection.createTileMatrix(this,l,r)}calculateDistanceTileData(r){const l=r.key,p=this._distanceTileDataCache;if(p[l])return p[l];const _=r.canonical,x=1/this.height,T=this.cameraWorldSize,C=T/this.zoomScale(_.z),M=(_.x+Math.pow(2,_.z)*r.wrap)*C,O=_.y*C,R=this.point;R.x*=T/this.worldSize,R.y*=T/this.worldSize;const U=this.angle,G=Math.sin(-U),ee=-Math.cos(-U);return p[l]={bearing:[G,ee],center:[(R.x-M)*x,(R.y-O)*x],scale:C/o.EXTENT*x},p[l]}calculateFogTileMatrix(r){const l=r.key,p=this._fogTileMatrixCache;if(p[l])return p[l];const _=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,r);return o.multiply(_,this.worldToFogMatrix,_),p[l]=new Float32Array(_),p[l]}calculateProjMatrix(r,l=!1){const p=r.key,_=l?this._alignedProjMatrixCache:this._projMatrixCache;if(_[p])return _[p];const x=this.calculatePosMatrix(r,this.worldSize);return o.multiply(x,this.projection.isReprojectedInTileSpace?this.mercatorMatrix:l?this.alignedProjMatrix:this.projMatrix,x),_[p]=new Float32Array(x),_[p]}calculatePixelsToTileUnitsMatrix(r){const l=r.tileID.key,p=this._pixelsToTileUnitsCache;if(p[l])return p[l];const _=function(x,T){const{scale:C}=x.tileTransform,M=C*o.EXTENT/(x.tileSize*Math.pow(2,T.zoom-x.tileID.overscaledZ+x.tileID.canonical.z));return O=new Float32Array(4),G=(R=T.inverseAdjustmentMatrix)[1],ee=R[2],Q=R[3],H=(U=[M,M])[1],O[0]=R[0]*(ne=U[0]),O[1]=G*ne,O[2]=ee*H,O[3]=Q*H,O;var O,R,U,G,ee,Q,ne,H}(r,this);return p[l]=_,p[l]}customLayerMatrix(){return this.mercatorMatrix.slice()}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;const r=this._elevation;this._updateCameraState();const l=o.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,p=this._computeCameraPosition(l),_=this._camera.forward(),x=o.mercatorZfromAltitude(1,this._center.lat);p[2]/=x,_[2]/=x,o.normalize(_,_);const T=r.raycast(p,_,r.exaggeration());if(T){const C=o.scaleAndAdd([],p,_,T),M=new o.MercatorCoordinate(C[0],C[1],o.mercatorZfromAltitude(C[2],o.latFromMercatorY(C[1]))),O=(M.z+o.length([M.x-p[0],M.y-p[1],M.z-p[2]*x]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(O),this._centerAltitude=M.toAltitude(),this._center=this.coordinateLocation(M),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(r=!1){if(!this._elevation)return;const l=this._elevation,p=o.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,_=this._computeCameraPosition(p),x=l.getAtPointOrZero(new o.MercatorCoordinate(..._)),T=this.pixelsPerMeter/this.worldSize*x,C=this._minimumHeightOverTerrain(),M=_[2]-T;if(M<=C)if(M<0||r){const O=this.locationCoordinate(this._center,this._centerAltitude),R=[_[0],_[1],O.z-_[2]],U=o.length(R);R[2]-=(C-M)/this._pixelsPerMercatorPixel;const G=o.length(R);if(G===0)return;o.scale$2(R,R,U/G*this._pixelsPerMercatorPixel),this._camera.position=[_[0],_[1],O.z*this._pixelsPerMercatorPixel-R[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const r=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||r){const G=this.center;return G.lat=o.clamp(G.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!r)&&(G.lng=o.clamp(G.lng,this.minLng,this.maxLng)),this.center=G,void(this._constraining=!1)}const l=this._unmodified,{x:p,y:_}=this.point;let x=0,T=p,C=_;const M=this.width/2,O=this.height/2,R=this.worldMinY*this.scale,U=this.worldMaxY*this.scale;if(_-O<R&&(C=R+O),_+O>U&&(C=U-O),U-R<this.height&&(x=Math.max(x,this.height/(U-R)),C=(U+R)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const G=this.worldMinX*this.scale,ee=this.worldMaxX*this.scale,Q=this.worldSize/2-(G+ee)/2;T=(p+Q+this.worldSize)%this.worldSize-Q,T-M<G&&(T=G+M),T+M>ee&&(T=ee-M),ee-G<this.width&&(x=Math.max(x,this.width/(ee-G)),T=(ee+G)/2)}T===p&&C===_||(this.center=this.unproject(new o.pointGeometry(T,C))),x&&(this.zoom+=this.scaleZoom(x)),this._constrainCamera(),this._unmodified=l,this._constraining=!1}_minZoomForBounds(){let r=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(r=Math.max(r,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),r}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const r=this.centerOffset,l=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=o.mercatorZfromAltitude(1,this.center.lat)/o.mercatorZfromAltitude(1,o.GLOBE_SCALE_MATCH_LATITUDE));const p=ss(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,p),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const _=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?l:1),x=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);x[8]=2*-r.x/this.width,x[9]=2*r.y/this.height;let T=o.mul([],x,_);if(this.projection.isReprojectedInTileSpace){const Ee=this.locationCoordinate(this.center),xe=o.identity([]);o.translate(xe,xe,[Ee.x*this.worldSize,Ee.y*this.worldSize,0]),o.multiply(xe,xe,Pc(this)),o.translate(xe,xe,[-Ee.x*this.worldSize,-Ee.y*this.worldSize,0]),o.multiply(T,T,xe),this.inverseAdjustmentMatrix=function(Pe){const We=Pc(Pe,!0);return Ie([],[We[0],We[1],We[4],We[5]])}(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];this.mercatorMatrix=o.scale([],T,[this.worldSize,this.worldSize,this.worldSize/l,1]),this.projMatrix=T,this.invProjMatrix=o.invert(new Float64Array(16),this.projMatrix);const C=o.invert([],x);this.frustumCorners=o.FrustumCorners.fromInvProjectionMatrix(C,this.horizonLineFromTop(),this.height);const M=new Float32Array(16);o.identity(M),o.scale(M,M,[1,-1,1]),o.rotateX(M,M,this._pitch),o.rotateZ(M,M,this.angle);const O=o.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ),R=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;O[8]=2*-r.x/this.width,O[9]=2*(r.y+R)/this.height,this.skyboxMatrix=o.multiply(M,O,M);const U=this.point,G=U.x,ee=U.y,Q=this.width%2/2,ne=this.height%2/2,H=Math.cos(this.angle),X=Math.sin(this.angle),re=G-Math.round(G)+H*Q+X*ne,ie=ee-Math.round(ee)+H*ne+X*Q,he=new Float64Array(T);if(o.translate(he,he,[re>.5?re-1:re,ie>.5?ie-1:ie,0]),this.alignedProjMatrix=he,T=o.create(),o.scale(T,T,[this.width/2,-this.height/2,1]),o.translate(T,T,[1,-1,0]),this.labelPlaneMatrix=T,T=o.create(),o.scale(T,T,[1,-1,1]),o.translate(T,T,[-1,-1,0]),o.scale(T,T,[2/this.width,2/this.height,1]),this.glCoordMatrix=T,this.pixelMatrix=o.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),this._calcFogMatrices(),this._distanceTileDataCache={},T=o.invert(new Float64Array(16),this.pixelMatrix),!T)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=T,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=o.calculateGlobeMatrix(this);const Ee=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=o.transformMat4(Ee,Ee,_),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=T;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const r=this.cameraWorldSizeForFog,l=this.cameraPixelsPerMeter,p=this._camera.position,_=1/this.height/this._pixelsPerMercatorPixel,x=[r,r,l];o.scale$2(x,x,_),o.scale$2(p,p,-1),o.multiply$2(p,p,x);const T=o.create();o.translate(T,T,p),o.scale(T,T,x),this.mercatorFogMatrix=T,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(r,l,_)}_computeCameraPosition(r){const l=(r=r||this.pixelsPerMeter)/this.pixelsPerMeter,p=this._camera.forward(),_=this.point,x=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*l-r/this.worldSize*this._centerAltitude;return[_.x/this.worldSize-p[0]*x,_.y/this.worldSize-p[1]*x,r/this.worldSize*this._centerAltitude-p[2]*x]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(r){const l=this._maxCameraBoundsDistance()*Math.cos(this._pitch),p=this._camera.position[2],_=r[2];let x=1;this.projection.wrap&&(this.center=this.center.wrap()),_>0&&(x=Math.min((l-p)/_,1)),this._camera.position=o.scaleAndAdd([],this._camera.position,r,x),this._updateStateFromCamera()}_updateStateFromCamera(){const r=this._camera.position,l=this._camera.forward(),{pitch:p,bearing:_}=this._camera.getPitchBearing(),x=o.mercatorZfromAltitude(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,T=this._mercatorZfromZoom(this._maxZoom)*Math.cos(o.degToRad(this._maxPitch)),C=Math.max((r[2]-x)/Math.cos(p),T),M=this._zoomFromMercatorZ(C);o.scaleAndAdd(r,r,l,C),this._pitch=o.clamp(p,o.degToRad(this.minPitch),o.degToRad(this.maxPitch)),this.angle=o.wrap(_,-Math.PI,Math.PI),this._setZoom(o.clamp(M,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new o.MercatorCoordinate(r[0],r[1],r[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(r){return Math.pow(2,r)*this.tileSize}_mercatorZfromZoom(r){return this.cameraToCenterDistance/this._worldSizeFromZoom(r)}_minimumHeightOverTerrain(){const r=Math.min((this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom)+4,this._maxZoom);return this._mercatorZfromZoom(r)}_zoomFromMercatorZ(r){return this.scaleZoom(this.cameraToCenterDistance/(r*this.tileSize))}zoomFromMercatorZAdjusted(r){const l=T=>{const C=this.getCameraToCenterDistance(this.projection,T);return this.scaleZoom(C/(r*this.tileSize))};let p,_=l(this.zoom),x=Math.abs(_-l(_));for(;p!==x;)_=l(_),p=x,x=Math.abs(_-l(_));return _}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(o.warnOnce("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(r,l){const p=Math.min(r.x,l.x),_=Math.max(r.x,l.x),x=Math.min(r.y,l.y),T=Math.max(r.y,l.y);if(x<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const C=[new o.pointGeometry(p,x),new o.pointGeometry(_,T),new o.pointGeometry(p,T),new o.pointGeometry(_,x)],M=this.renderWorldCopies?-3:0,O=this.renderWorldCopies?4:1;for(const R of C){const U=this.pointRayIntersection(R);if(U.t<0)return!0;const G=this.rayIntersectionCoordinate(U);if(G.x<M||G.y<0||G.x>O||G.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+o.radToDeg(this.fovAboveCenter)>88||this.anyCornerOffEdge(new o.pointGeometry(0,0),new o.pointGeometry(this.width,this.height))}zoomDeltaToMovement(r,l){const p=o.length(o.sub([],this._camera.position,r)),_=this._zoomFromMercatorZ(p)+l;return p-this._mercatorZfromZoom(_)}getCameraPoint(){if(this.projection.name==="globe"){const r=function([l,p,_],x){const T=[l,p,_,1];o.transformMat4$1(T,T,x);const C=T[3]=Math.max(T[3],1e-6);return T[0]/=C,T[1]/=C,T[2]/=C,T}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new o.pointGeometry(r[0],r[1])}{const r=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new o.pointGeometry(0,r))}}getCameraToCenterDistance(r,l=this.zoom){const p=ss(r,l,this.width,this.height,1024),_=r.pixelSpaceConversion(this.center.lat,this.worldSize,p);return .5/Math.tan(.5*this._fov)*this.height*_}getWorldToCameraMatrix(){const r=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&o.multiply(r,r,this.globeMatrix),r}}function yl(h,r){let l=!1,p=null;const _=()=>{p=null,l&&(h(),p=setTimeout(_,r),l=!1)};return()=>(l=!0,p||_(),p)}class $t{constructor(r){this._hashName=r&&encodeURIComponent(r),o.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=yl(this._updateHashUnthrottled.bind(this),300)}addTo(r){return this._map=r,o.window.addEventListener("hashchange",this._onHashChange,!1),r.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),o.window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const r=this._map;if(!r)return"";const l=Xr(r);if(this._hashName){const p=this._hashName;let _=!1;const x=o.window.location.hash.slice(1).split("&").map(T=>{const C=T.split("=")[0];return C===p?(_=!0,`${C}=${l}`):T}).filter(T=>T);return _||x.push(`${p}=${l}`),`#${x.join("&")}`}return`#${l}`}_getCurrentHash(){const r=o.window.location.hash.replace("#","");if(this._hashName){let l;return r.split("&").map(p=>p.split("=")).forEach(p=>{p[0]===this._hashName&&(l=p)}),(l&&l[1]||"").split("/")}return r.split("/")}_onHashChange(){const r=this._map;if(!r)return!1;const l=this._getCurrentHash();if(l.length>=3&&!l.some(p=>isNaN(p))){const p=r.dragRotate.isEnabled()&&r.touchZoomRotate.isEnabled()?+(l[3]||0):r.getBearing();return r.jumpTo({center:[+l[2],+l[1]],zoom:+l[0],bearing:p,pitch:+(l[4]||0)}),!0}return!1}_updateHashUnthrottled(){const r=o.window.location.href.replace(/(#.+)?$/,this.getHashString());o.window.history.replaceState(o.window.history.state,null,r)}}function Xr(h,r){const l=h.getCenter(),p=Math.round(100*h.getZoom())/100,_=Math.ceil((p*Math.LN2+Math.log(512/360/.5))/Math.LN10),x=Math.pow(10,_),T=Math.round(l.lng*x)/x,C=Math.round(l.lat*x)/x,M=h.getBearing(),O=h.getPitch();let R=r?`/${T}/${C}/${p}`:`${p}/${C}/${T}`;return(M||O)&&(R+="/"+Math.round(10*M)/10),O&&(R+=`/${Math.round(O)}`),R}const vl={linearity:.3,easing:o.bezier(0,0,.3,1)},xf=o.extend({deceleration:2500,maxSpeed:1400},vl),bf=o.extend({deceleration:20,maxSpeed:1400},vl),pa=o.extend({deceleration:1e3,maxSpeed:360},vl),wf=o.extend({deceleration:1e3,maxSpeed:90},vl);class Lc{constructor(r){this._map=r,this.clear()}clear(){this._inertiaBuffer=[]}record(r){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:o.exported.now(),settings:r})}_drainInertiaBuffer(){const r=this._inertiaBuffer,l=o.exported.now();for(;r.length>0&&l-r[0].time>160;)r.shift()}_onMoveEnd(r){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const l={zoom:0,bearing:0,pitch:0,pan:new o.pointGeometry(0,0),pinchAround:void 0,around:void 0};for(const{settings:x}of this._inertiaBuffer)l.zoom+=x.zoomDelta||0,l.bearing+=x.bearingDelta||0,l.pitch+=x.pitchDelta||0,x.panDelta&&l.pan._add(x.panDelta),x.around&&(l.around=x.around),x.pinchAround&&(l.pinchAround=x.pinchAround);const p=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,_={};if(l.pan.mag()){const x=Rs(l.pan.mag(),p,o.extend({},xf,r||{}));_.offset=l.pan.mult(x.amount/l.pan.mag()),_.center=this._map.transform.center,ma(_,x)}if(l.zoom){const x=Rs(l.zoom,p,bf);_.zoom=this._map.transform.zoom+x.amount,ma(_,x)}if(l.bearing){const x=Rs(l.bearing,p,pa);_.bearing=this._map.transform.bearing+o.clamp(x.amount,-179,179),ma(_,x)}if(l.pitch){const x=Rs(l.pitch,p,wf);_.pitch=this._map.transform.pitch+x.amount,ma(_,x)}if(_.zoom||_.bearing){const x=l.pinchAround===void 0?l.around:l.pinchAround;_.around=x?this._map.unproject(x):this._map.getCenter()}return this.clear(),_.noMoveStart=!0,_}}function ma(h,r){(!h.duration||h.duration<r.duration)&&(h.duration=r.duration,h.easing=r.easing)}function Rs(h,r,l){const{maxSpeed:p,linearity:_,deceleration:x}=l,T=o.clamp(h*_/(r/1e3),-p,p),C=Math.abs(T)/(x*_);return{easing:l.easing,duration:1e3*C,amount:T*(C/2)}}class Pr extends o.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(r,l,p,_={}){const x=ce(l.getCanvasContainer(),p),T=l.unproject(x);super(r,o.extend({point:x,lngLat:T,originalEvent:p},_)),this._defaultPrevented=!1,this.target=l}}class xl extends o.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(r,l,p){const _=r==="touchend"?p.changedTouches:p.touches,x=pe(l.getCanvasContainer(),_),T=x.map(M=>l.unproject(M)),C=x.reduce((M,O,R,U)=>M.add(O.div(U.length)),new o.pointGeometry(0,0));super(r,{points:x,point:C,lngLats:T,lngLat:l.unproject(C),originalEvent:p}),this._defaultPrevented=!1}}class ga extends o.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(r,l,p){super(r,{originalEvent:p}),this._defaultPrevented=!1}}class Sg{constructor(r,l){this._map=r,this._clickTolerance=l.clickTolerance}reset(){this._mousedownPos=void 0}wheel(r){return this._firePreventable(new ga(r.type,this._map,r))}mousedown(r,l){return this._mousedownPos=l,this._firePreventable(new Pr(r.type,this._map,r))}mouseup(r){this._map.fire(new Pr(r.type,this._map,r))}preclick(r){const l=o.extend({},r);l.type="preclick",this._map.fire(new Pr(l.type,this._map,l))}click(r,l){this._mousedownPos&&this._mousedownPos.dist(l)>=this._clickTolerance||(this.preclick(r),this._map.fire(new Pr(r.type,this._map,r)))}dblclick(r){return this._firePreventable(new Pr(r.type,this._map,r))}mouseover(r){this._map.fire(new Pr(r.type,this._map,r))}mouseout(r){this._map.fire(new Pr(r.type,this._map,r))}touchstart(r){return this._firePreventable(new xl(r.type,this._map,r))}touchmove(r){this._map.fire(new xl(r.type,this._map,r))}touchend(r){this._map.fire(new xl(r.type,this._map,r))}touchcancel(r){this._map.fire(new xl(r.type,this._map,r))}_firePreventable(r){if(this._map.fire(r),r.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Cg{constructor(r){this._map=r}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(r){this._map.fire(new Pr(r.type,this._map,r))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Pr("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(r){this._delayContextMenu?this._contextMenuEvent=r:this._map.fire(new Pr(r.type,this._map,r)),this._map.listens("contextmenu")&&r.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Ef{constructor(r,l){this._map=r,this._el=r.getCanvasContainer(),this._container=r.getContainer(),this._clickTolerance=l.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(r,l){this.isEnabled()&&r.shiftKey&&r.button===0&&(fe(),this._startPos=this._lastPos=l,this._active=!0)}mousemoveWindow(r,l){if(!this._active)return;const p=l,_=this._startPos,x=this._lastPos;if(!_||!x||x.equals(p)||!this._box&&p.dist(_)<this._clickTolerance)return;this._lastPos=p,this._box||(this._box=D("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",r));const T=Math.min(_.x,p.x),C=Math.max(_.x,p.x),M=Math.min(_.y,p.y),O=Math.max(_.y,p.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${T}px,${M}px)`,this._box.style.width=C-T+"px",this._box.style.height=O-M+"px")})}mouseupWindow(r,l){if(!this._active)return;const p=this._startPos,_=l;if(p&&r.button===0){if(this.reset(),Ce(),p.x!==_.x||p.y!==_.y)return this._map.fire(new o.Event("boxzoomend",{originalEvent:r})),{cameraAnimation:x=>x.fitScreenCoordinates(p,_,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",r)}}keydown(r){this._active&&r.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",r))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),te(),delete this._startPos,delete this._lastPos}_fireEvent(r,l){return this._map.fire(new o.Event(r,{originalEvent:l}))}}function _a(h,r){const l={};for(let p=0;p<h.length;p++)l[h[p].identifier]=r[p];return l}class _h{constructor(r){this.reset(),this.numTouches=r.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(r,l,p){(this.centroid||p.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=r.timeStamp),p.length===this.numTouches&&(this.centroid=function(_){const x=new o.pointGeometry(0,0);for(const T of _)x._add(T);return x.div(_.length)}(l),this.touches=_a(p,l)))}touchmove(r,l,p){if(this.aborted||!this.centroid)return;const _=_a(p,l);for(const x in this.touches){const T=this.touches[x],C=_[x];(!C||C.dist(T)>30)&&(this.aborted=!0)}}touchend(r,l,p){if((!this.centroid||r.timeStamp-this.startTime>500)&&(this.aborted=!0),p.length===0){const _=!this.aborted&&this.centroid;if(this.reset(),_)return _}}}class Rc{constructor(r){this.singleTap=new _h(r),this.numTaps=r.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(r,l,p){this.singleTap.touchstart(r,l,p)}touchmove(r,l,p){this.singleTap.touchmove(r,l,p)}touchend(r,l,p){const _=this.singleTap.touchend(r,l,p);if(_){const x=r.timeStamp-this.lastTime<500,T=!this.lastTap||this.lastTap.dist(_)<30;if(x&&T||this.reset(),this.count++,this.lastTime=r.timeStamp,this.lastTap=_,this.count===this.numTaps)return this.reset(),_}}}class Tf{constructor(){this._zoomIn=new Rc({numTouches:1,numTaps:2}),this._zoomOut=new Rc({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(r,l,p){this._zoomIn.touchstart(r,l,p),this._zoomOut.touchstart(r,l,p)}touchmove(r,l,p){this._zoomIn.touchmove(r,l,p),this._zoomOut.touchmove(r,l,p)}touchend(r,l,p){const _=this._zoomIn.touchend(r,l,p),x=this._zoomOut.touchend(r,l,p);return _?(this._active=!0,r.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:T=>T.easeTo({duration:300,zoom:T.getZoom()+1,around:T.unproject(_)},{originalEvent:r})}):x?(this._active=!0,r.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:T=>T.easeTo({duration:300,zoom:T.getZoom()-1,around:T.unproject(x)},{originalEvent:r})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const Dc={0:1,2:2};class bl{constructor(r){this.reset(),this._clickTolerance=r.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(r,l){return!1}_move(r,l){return{}}mousedown(r,l){if(this._lastPoint)return;const p=Te(r);this._correctButton(r,p)&&(this._lastPoint=l,this._eventButton=p)}mousemoveWindow(r,l){const p=this._lastPoint;if(p){if(r.preventDefault(),this._eventButton!=null&&function(_,x){const T=Dc[x];return _.buttons===void 0||(_.buttons&T)!==T}(r,this._eventButton))this.reset();else if(this._moved||!(l.dist(p)<this._clickTolerance))return this._moved=!0,this._lastPoint=l,this._move(p,l)}}mouseupWindow(r){this._lastPoint&&Te(r)===this._eventButton&&(this._moved&&Ce(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Sf extends bl{mousedown(r,l){super.mousedown(r,l),this._lastPoint&&(this._active=!0)}_correctButton(r,l){return l===0&&!r.ctrlKey}_move(r,l){return{around:l,panDelta:l.sub(r)}}}class yh extends bl{_correctButton(r,l){return l===0&&r.ctrlKey||l===2}_move(r,l){const p=.8*(l.x-r.x);if(p)return this._active=!0,{bearingDelta:p}}contextmenu(r){r.preventDefault()}}class vh extends bl{_correctButton(r,l){return l===0&&r.ctrlKey||l===2}_move(r,l){const p=-.5*(l.y-r.y);if(p)return this._active=!0,{pitchDelta:p}}contextmenu(r){r.preventDefault()}}class Cf{constructor(r,l){this._map=r,this._el=r.getCanvasContainer(),this._minTouches=1,this._clickTolerance=l.clickTolerance||1,this.reset(),o.bindAll(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new o.pointGeometry(0,0)}touchstart(r,l,p){return this._calculateTransform(r,l,p)}touchmove(r,l,p){if(this._active&&!(p.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(p.length===1&&!o.isFullscreen())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return r.cancelable&&r.preventDefault(),this._calculateTransform(r,l,p)}}touchend(r,l,p){this._calculateTransform(r,l,p),this._active&&p.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(r,l,p){p.length>0&&(this._active=!0);const _=_a(p,l),x=new o.pointGeometry(0,0),T=new o.pointGeometry(0,0);let C=0;for(const O in _){const R=_[O],U=this._touches[O];U&&(x._add(R),T._add(R.sub(U)),C++,_[O]=R)}if(this._touches=_,C<this._minTouches||!T.mag())return;const M=T.div(C);return this._sum._add(M),this._sum.mag()<this._clickTolerance?void 0:{around:x.div(C),panDelta:M}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=D("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","null")},500)}}class Oc{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(r){}_move(r,l,p){return{}}touchstart(r,l,p){this._firstTwoTouches||p.length<2||(this._firstTwoTouches=[p[0].identifier,p[1].identifier],this._start([l[0],l[1]]))}touchmove(r,l,p){const _=this._firstTwoTouches;if(!_)return;r.preventDefault();const[x,T]=_,C=Vo(p,l,x),M=Vo(p,l,T);if(!C||!M)return;const O=this._aroundCenter?null:C.add(M).div(2);return this._move([C,M],O,r)}touchend(r,l,p){if(!this._firstTwoTouches)return;const[_,x]=this._firstTwoTouches,T=Vo(p,l,_),C=Vo(p,l,x);T&&C||(this._active&&Ce(),this.reset())}touchcancel(){this.reset()}enable(r){this._enabled=!0,this._aroundCenter=!!r&&r.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Vo(h,r,l){for(let p=0;p<h.length;p++)if(h[p].identifier===l)return r[p]}function xh(h,r){return Math.log(h/r)/Math.LN2}class Af extends Oc{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(r){this._startDistance=this._distance=r[0].dist(r[1])}_move(r,l){const p=this._distance;if(this._distance=r[0].dist(r[1]),this._active||!(Math.abs(xh(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:xh(this._distance,p),pinchAround:l}}}function Mf(h,r){return 180*h.angleWith(r)/Math.PI}class If extends Oc{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(r){this._startVector=this._vector=r[0].sub(r[1]),this._minDiameter=r[0].dist(r[1])}_move(r,l){const p=this._vector;if(this._vector=r[0].sub(r[1]),p&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:Mf(this._vector,p),pinchAround:l}}_isBelowThreshold(r){this._minDiameter=Math.min(this._minDiameter,r.mag());const l=25/(Math.PI*this._minDiameter)*360,p=this._startVector;if(!p)return!1;const _=Mf(r,p);return Math.abs(_)<l}}function Bc(h){return Math.abs(h.y)>Math.abs(h.x)}class kf extends Oc{constructor(r){super(),this._map=r}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(r){this._lastPoints=r,Bc(r[0].sub(r[1]))&&(this._valid=!1)}_move(r,l,p){const _=this._lastPoints;if(!_)return;const x=r[0].sub(_[0]),T=r[1].sub(_[1]);return this._map._cooperativeGestures&&!o.isFullscreen()&&p.touches.length<3||(this._valid=this.gestureBeginsVertically(x,T,p.timeStamp),!this._valid)?void 0:(this._lastPoints=r,this._active=!0,{pitchDelta:(x.y+T.y)/2*-.5})}gestureBeginsVertically(r,l,p){if(this._valid!==void 0)return this._valid;const _=r.mag()>=2,x=l.mag()>=2;if(!_&&!x)return;if(!_||!x)return this._firstMove==null&&(this._firstMove=p),p-this._firstMove<100&&void 0;const T=r.y>0==l.y>0;return Bc(r)&&Bc(l)&&T}}const Pf={panStep:100,bearingStep:15,pitchStep:10};class dr{constructor(){const r=Pf;this._panStep=r.panStep,this._bearingStep=r.bearingStep,this._pitchStep=r.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(r){if(r.altKey||r.ctrlKey||r.metaKey)return;let l=0,p=0,_=0,x=0,T=0;switch(r.keyCode){case 61:case 107:case 171:case 187:l=1;break;case 189:case 109:case 173:l=-1;break;case 37:r.shiftKey?p=-1:(r.preventDefault(),x=-1);break;case 39:r.shiftKey?p=1:(r.preventDefault(),x=1);break;case 38:r.shiftKey?_=1:(r.preventDefault(),T=-1);break;case 40:r.shiftKey?_=-1:(r.preventDefault(),T=1);break;default:return}return this._rotationDisabled&&(p=0,_=0),{cameraAnimation:C=>{const M=C.getZoom();C.easeTo({duration:300,easeId:"keyboardHandler",easing:Ag,zoom:l?Math.round(M)+l*(r.shiftKey?2:1):M,bearing:C.getBearing()+p*this._bearingStep,pitch:C.getPitch()+_*this._pitchStep,offset:[-x*this._panStep,-T*this._panStep],center:C.getCenter()},{originalEvent:r})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Ag(h){return h*(2-h)}const bh=4.000244140625;class Mg{constructor(r,l){this._map=r,this._el=r.getCanvasContainer(),this._handler=l,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,o.bindAll(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(r){this._defaultZoomRate=r}setWheelZoomRate(r){this._wheelZoomRate=r}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(r){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!r&&r.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(r){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(r.ctrlKey||r.metaKey||this.isZooming()||o.isFullscreen()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let l=r.deltaMode===o.window.WheelEvent.DOM_DELTA_LINE?40*r.deltaY:r.deltaY;const p=o.exported.now(),_=p-(this._lastWheelEventTime||0);this._lastWheelEventTime=p,l!==0&&l%bh==0?this._type="wheel":l!==0&&Math.abs(l)<4?this._type="trackpad":_>400?(this._type=null,this._lastValue=l,this._timeout=setTimeout(this._onTimeout,40,r)):this._type||(this._type=Math.abs(_*l)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,l+=this._lastValue)),r.shiftKey&&l&&(l/=4),this._type&&(this._lastWheelEvent=r,this._delta-=l,this._active||this._start(r)),r.preventDefault()}_onTimeout(r){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(r)}_start(r){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const l=ce(this._el,r);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:l,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const r=this._map.transform;this._type==="wheel"&&r.projection.wrap&&(r._center.lng>=180||r._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const l=()=>r._terrainEnabled()&&this._aroundCoord?r.computeZoomRelativeTo(this._aroundCoord):r.zoom;if(this._delta!==0){const M=this._type==="wheel"&&Math.abs(this._delta)>bh?this._wheelZoomRate:this._defaultZoomRate;let O=2/(1+Math.exp(-Math.abs(this._delta*M)));this._delta<0&&O!==0&&(O=1/O);const R=l(),U=Math.pow(2,R),G=typeof this._targetZoom=="number"?r.zoomScale(this._targetZoom):U;this._targetZoom=Math.min(r.maxZoom,Math.max(r.minZoom,r.scaleZoom(G*O))),this._type==="wheel"&&(this._startZoom=R,this._easing=this._smoothOutEasing(200)),this._delta=0}const p=typeof this._targetZoom=="number"?this._targetZoom:l(),_=this._startZoom,x=this._easing;let T,C=!1;if(this._type==="wheel"&&_&&x){const M=Math.min((o.exported.now()-this._lastWheelEventTime)/200,1),O=x(M);T=o.number(_,p,O),M<1?this._frameId||(this._frameId=!0):C=!0}else T=p,C=!0;return this._active=!0,C&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!C,zoomDelta:T-l(),around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(r){let l=o.ease;if(this._prevEase){const p=this._prevEase,_=(o.exported.now()-p.start)/p.duration,x=p.easing(_+.01)-p.easing(_),T=.27/Math.sqrt(x*x+1e-4)*.01,C=Math.sqrt(.0729-T*T);l=o.bezier(T,C,.25,1)}return this._prevEase={start:o.exported.now(),duration:r,easing:l},l}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=D("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(o.window.navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","null")},200)}}class Ig{constructor(r,l){this._clickZoom=r,this._tapZoom=l}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Uo{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(r,l){return r.preventDefault(),{cameraAnimation:p=>{p.easeTo({duration:300,zoom:p.getZoom()+(r.shiftKey?-1:1),around:p.unproject(l)},{originalEvent:r})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class zf{constructor(){this._tap=new Rc({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(r,l,p){this._swipePoint||(this._tapTime&&r.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?p.length>0&&(this._swipePoint=l[0],this._swipeTouch=p[0].identifier):this._tap.touchstart(r,l,p))}touchmove(r,l,p){if(this._tapTime){if(this._swipePoint){if(p[0].identifier!==this._swipeTouch)return;const _=l[0],x=_.y-this._swipePoint.y;return this._swipePoint=_,r.preventDefault(),this._active=!0,{zoomDelta:x/128}}}else this._tap.touchmove(r,l,p)}touchend(r,l,p){this._tapTime?this._swipePoint&&p.length===0&&this.reset():this._tap.touchend(r,l,p)&&(this._tapTime=r.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ya{constructor(r,l,p){this._el=r,this._mousePan=l,this._touchPan=p}enable(r){this._inertiaOptions=r||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class vo{constructor(r,l,p){this._pitchWithRotate=r.pitchWithRotate,this._mouseRotate=l,this._mousePitch=p}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Fc{constructor(r,l,p,_){this._el=r,this._touchZoom=l,this._touchRotate=p,this._tapDragZoom=_,this._rotationDisabled=!1,this._enabled=!0}enable(r){this._touchZoom.enable(r),this._rotationDisabled||this._touchRotate.enable(r),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const Zt=h=>h.zoom||h.drag||h.pitch||h.rotate;class Lf extends o.Event{}class Rf{constructor(){this.constants=[1,1,.01],this.radius=0}setup(r,l){const p=o.sub([],l,r);this.radius=o.length(p[2]<0?o.div([],p,this.constants):[p[0],p[1],0])}projectRay(r){o.div(r,r,this.constants),o.normalize(r,r),o.mul$1(r,r,this.constants);const l=o.scale$2([],r,this.radius);if(l[2]>0){const p=o.scale$2([],[0,0,1],o.dot(l,[0,0,1])),_=o.scale$2([],o.normalize([],[l[0],l[1],0]),this.radius),x=o.add([],l,o.scale$2([],o.sub([],o.add([],_,p),l),2));l[0]=x[0],l[1]=x[1]}return l}}function ls(h){return h.panDelta&&h.panDelta.mag()||h.zoomDelta||h.bearingDelta||h.pitchDelta}class wl{constructor(r,l){this._map=r,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Lc(r),this._bearingSnap=l.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new Rf,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(l),o.bindAll(["handleEvent","handleWindowEvent"],this);const p=this._el;this._listeners=[[p,"touchstart",{passive:!0}],[p,"touchmove",{passive:!1}],[p,"touchend",void 0],[p,"touchcancel",void 0],[p,"mousedown",void 0],[p,"mousemove",void 0],[p,"mouseup",void 0],[o.window.document,"mousemove",{capture:!0}],[o.window.document,"mouseup",void 0],[p,"mouseover",void 0],[p,"mouseout",void 0],[p,"dblclick",void 0],[p,"click",void 0],[p,"keydown",{capture:!1}],[p,"keyup",void 0],[p,"wheel",{passive:!1}],[p,"contextmenu",void 0],[o.window,"blur",void 0]];for(const[_,x,T]of this._listeners)_.addEventListener(x,_===o.window.document?this.handleWindowEvent:this.handleEvent,T)}destroy(){for(const[r,l,p]of this._listeners)r.removeEventListener(l,r===o.window.document?this.handleWindowEvent:this.handleEvent,p)}_addDefaultHandlers(r){const l=this._map,p=l.getCanvasContainer();this._add("mapEvent",new Sg(l,r));const _=l.boxZoom=new Ef(l,r);this._add("boxZoom",_);const x=new Tf,T=new Uo;l.doubleClickZoom=new Ig(T,x),this._add("tapZoom",x),this._add("clickZoom",T);const C=new zf;this._add("tapDragZoom",C);const M=l.touchPitch=new kf(l);this._add("touchPitch",M);const O=new yh(r),R=new vh(r);l.dragRotate=new vo(r,O,R),this._add("mouseRotate",O,["mousePitch"]),this._add("mousePitch",R,["mouseRotate"]);const U=new Sf(r),G=new Cf(l,r);l.dragPan=new ya(p,U,G),this._add("mousePan",U),this._add("touchPan",G,["touchZoom","touchRotate"]);const ee=new If,Q=new Af;l.touchZoomRotate=new Fc(p,Q,ee,C),this._add("touchRotate",ee,["touchPan","touchZoom"]),this._add("touchZoom",Q,["touchPan","touchRotate"]),this._add("blockableMapEvent",new Cg(l));const ne=l.scrollZoom=new Mg(l,this);this._add("scrollZoom",ne,["mousePan"]);const H=l.keyboard=new dr;this._add("keyboard",H);for(const X of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])r.interactive&&r[X]&&l[X].enable(r[X])}_add(r,l,p){this._handlers.push({handlerName:r,handler:l,allowed:p}),this._handlersById[r]=l}stop(r){if(!this._updatingCamera){for(const{handler:l}of this._handlers)l.reset();this._inertia.clear(),this._fireEvents({},{},r),this._changes=[]}}isActive(){for(const{handler:r}of this._handlers)if(r.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Zt(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(r,l,p){for(const _ in r)if(_!==p&&(!l||l.indexOf(_)<0))return!0;return!1}handleWindowEvent(r){this.handleEvent(r,`${r.type}Window`)}_getMapTouches(r){const l=[];for(const p of r)this._el.contains(p.target)&&l.push(p);return l}handleEvent(r,l){this._updatingCamera=!0;const p=r.type==="renderFrame",_=p?void 0:r,x={needsRenderFrame:!1},T={},C={},M=r.touches?this._getMapTouches(r.touches):void 0,O=M?pe(this._el,M):p?void 0:ce(this._el,r);for(const{handlerName:G,handler:ee,allowed:Q}of this._handlers){if(!ee.isEnabled())continue;let ne;this._blockedByActive(C,Q,G)?ee.reset():ee[l||r.type]&&(ne=ee[l||r.type](r,O,M),this.mergeHandlerResult(x,T,ne,G,_),ne&&ne.needsRenderFrame&&this._triggerRenderFrame()),(ne||ee.isActive())&&(C[G]=ee)}const R={};for(const G in this._previousActiveHandlers)C[G]||(R[G]=_);this._previousActiveHandlers=C,(Object.keys(R).length||ls(x))&&(this._changes.push([x,T,R]),this._triggerRenderFrame()),(Object.keys(C).length||ls(x))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:U}=x;U&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],U(this._map))}mergeHandlerResult(r,l,p,_,x){if(!p)return;o.extend(r,p);const T={handlerName:_,originalEvent:p.originalEvent||x};p.zoomDelta!==void 0&&(l.zoom=T),p.panDelta!==void 0&&(l.drag=T),p.pitchDelta!==void 0&&(l.pitch=T),p.bearingDelta!==void 0&&(l.rotate=T)}_applyChanges(){const r={},l={},p={};for(const[_,x,T]of this._changes)_.panDelta&&(r.panDelta=(r.panDelta||new o.pointGeometry(0,0))._add(_.panDelta)),_.zoomDelta&&(r.zoomDelta=(r.zoomDelta||0)+_.zoomDelta),_.bearingDelta&&(r.bearingDelta=(r.bearingDelta||0)+_.bearingDelta),_.pitchDelta&&(r.pitchDelta=(r.pitchDelta||0)+_.pitchDelta),_.around!==void 0&&(r.around=_.around),_.aroundCoord!==void 0&&(r.aroundCoord=_.aroundCoord),_.pinchAround!==void 0&&(r.pinchAround=_.pinchAround),_.noInertia&&(r.noInertia=_.noInertia),o.extend(l,x),o.extend(p,T);this._updateMapTransform(r,l,p),this._changes=[]}_updateMapTransform(r,l,p){const _=this._map,x=_.transform,T=re=>[re.x,re.y,re.z];if((re=>{const ie=this._eventsInProgress.drag;return ie&&!this._handlersById[ie.handlerName].isActive()})()&&!ls(r)){const re=x.zoom;x.cameraElevationReference="sea",x.recenterOnTerrain(),x.cameraElevationReference="ground",re!==x.zoom&&this._map._update(!0)}if(x._isCameraConstrained&&_._stop(!0),!ls(r))return void this._fireEvents(l,p,!0);let{panDelta:C,zoomDelta:M,bearingDelta:O,pitchDelta:R,around:U,aroundCoord:G,pinchAround:ee}=r;x._isCameraConstrained&&(M>0&&(M=0),x._isCameraConstrained=!1),ee!==void 0&&(U=ee),(re=>l.drag&&!this._eventsInProgress.drag)()&&U&&(this._dragOrigin=T(x.pointCoordinate3D(U)),this._trackingEllipsoid.setup(x._camera.position,this._dragOrigin)),x.cameraElevationReference="sea",_._stop(!0),U=U||_.transform.centerPoint,O&&(x.bearing+=O),R&&(x.pitch+=R),x._updateCameraState();const Q=[0,0,0];if(C)if(x.projection.name==="mercator"){const re=this._trackingEllipsoid.projectRay(x.screenPointToMercatorRay(U).dir),ie=this._trackingEllipsoid.projectRay(x.screenPointToMercatorRay(U.sub(C)).dir);Q[0]=ie[0]-re[0],Q[1]=ie[1]-re[1]}else{const re=x.pointCoordinate(U);if(x.projection.name==="globe"){C=C.rotate(-x.angle);const ie=x._pixelsPerMercatorPixel/x.worldSize;Q[0]=-C.x*o.mercatorScale(o.latFromMercatorY(re.y))*ie,Q[1]=-C.y*o.mercatorScale(x.center.lat)*ie}else{const ie=x.pointCoordinate(U.sub(C));re&&ie&&(Q[0]=ie.x-re.x,Q[1]=ie.y-re.y)}}const ne=x.zoom,H=[0,0,0];if(M){const re=T(G||x.pointCoordinate3D(U)),ie={dir:o.normalize([],o.sub([],re,x._camera.position))};if(ie.dir[2]<0){const he=x.zoomDeltaToMovement(re,M);o.scale$2(H,ie.dir,he)}}const X=o.add(Q,Q,H);x._translateCameraConstrained(X),M&&Math.abs(x.zoom-ne)>1e-4&&x.recenterOnTerrain(),x.cameraElevationReference="ground",this._map._update(),r.noInertia||this._inertia.record(r),this._fireEvents(l,p,!0)}_fireEvents(r,l,p){const _=Zt(this._eventsInProgress),x=Zt(r),T={};for(const R in r){const{originalEvent:U}=r[R];this._eventsInProgress[R]||(T[`${R}start`]=U),this._eventsInProgress[R]=r[R]}!_&&x&&this._fireEvent("movestart",x.originalEvent);for(const R in T)this._fireEvent(R,T[R]);x&&this._fireEvent("move",x.originalEvent);for(const R in r){const{originalEvent:U}=r[R];this._fireEvent(R,U)}const C={};let M;for(const R in this._eventsInProgress){const{handlerName:U,originalEvent:G}=this._eventsInProgress[R];this._handlersById[U].isActive()||(delete this._eventsInProgress[R],M=l[U]||G,C[`${R}end`]=M)}for(const R in C)this._fireEvent(R,C[R]);const O=Zt(this._eventsInProgress);if(p&&(_||x)&&!O){this._updatingCamera=!0;const R=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),U=G=>G!==0&&-this._bearingSnap<G&&G<this._bearingSnap;R?(U(R.bearing||this._map.getBearing())&&(R.bearing=0),this._map.easeTo(R,{originalEvent:M})):(this._map.fire(new o.Event("moveend",{originalEvent:M})),U(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(r,l){this._map.fire(new o.Event(r,l?{originalEvent:l}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(r=>{this._frameId=void 0,this.handleEvent(new Lf("renderFrame",{timeStamp:r})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const wh="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class Df extends o.Evented{constructor(r,l){super(),this._moving=!1,this._zooming=!1,this.transform=r,this._bearingSnap=l.bearingSnap,o.bindAll(["_renderFrameCallback"],this)}getCenter(){return new o.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(r,l){return this.jumpTo({center:r},l)}panBy(r,l,p){return r=o.pointGeometry.convert(r).mult(-1),this.panTo(this.transform.center,o.extend({offset:r},l),p)}panTo(r,l,p){return this.easeTo(o.extend({center:r},l),p)}getZoom(){return this.transform.zoom}setZoom(r,l){return this.jumpTo({zoom:r},l),this}zoomTo(r,l,p){return this.easeTo(o.extend({zoom:r},l),p)}zoomIn(r,l){return this.zoomTo(this.getZoom()+1,r,l),this}zoomOut(r,l){return this.zoomTo(this.getZoom()-1,r,l),this}getBearing(){return this.transform.bearing}setBearing(r,l){return this.jumpTo({bearing:r},l),this}getPadding(){return this.transform.padding}setPadding(r,l){return this.jumpTo({padding:r},l),this}rotateTo(r,l,p){return this.easeTo(o.extend({bearing:r},l),p)}resetNorth(r,l){return this.rotateTo(0,o.extend({duration:1e3},r),l),this}resetNorthPitch(r,l){return this.easeTo(o.extend({bearing:0,pitch:0,duration:1e3},r),l),this}snapToNorth(r,l){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(r,l):this}getPitch(){return this.transform.pitch}setPitch(r,l){return this.jumpTo({pitch:r},l),this}cameraForBounds(r,l){r=o.LngLatBounds.convert(r);const p=l&&l.bearing||0,_=l&&l.pitch||0,x=r.getNorthWest(),T=r.getSouthEast();return this._cameraForBounds(this.transform,x,T,p,_,l)}_extendCameraOptions(r){const l={top:0,bottom:0,right:0,left:0};if(typeof(r=o.extend({padding:l,offset:[0,0],maxZoom:this.transform.maxZoom},r)).padding=="number"){const p=r.padding;r.padding={top:p,bottom:p,right:p,left:p}}return r.padding=o.extend(l,r.padding),r}_minimumAABBFrustumDistance(r,l){const p=l.max[0]-l.min[0],_=l.max[1]-l.min[1];return p/_>r.aspect?p/(2*Math.tan(.5*r.fovX)*r.aspect):_/(2*Math.tan(.5*r.fovY)*r.aspect)}_cameraForBoundsOnGlobe(r,l,p,_,x,T){const C=r.clone(),M=this._extendCameraOptions(T);C.bearing=_,C.pitch=x;const O=o.LngLat.convert(l),R=o.LngLat.convert(p),U=.5*(O.lat+R.lat),G=.5*(O.lng+R.lng),ee=o.latLngToECEF(U,G),Q=o.normalize([],ee),ne=o.normalize([],o.cross([],Q,[0,1,0])),H=o.cross([],ne,Q),X=[ne[0],ne[1],ne[2],0,H[0],H[1],H[2],0,Q[0],Q[1],Q[2],0,0,0,0,1],re=[ee,o.latLngToECEF(O.lat,O.lng),o.latLngToECEF(R.lat,O.lng),o.latLngToECEF(R.lat,R.lng),o.latLngToECEF(O.lat,R.lng),o.latLngToECEF(U,O.lng),o.latLngToECEF(U,R.lng),o.latLngToECEF(O.lat,G),o.latLngToECEF(R.lat,G)];let ie=o.Aabb.fromPoints(re.map(De=>[o.dot(ne,De),o.dot(H,De),o.dot(Q,De)]));const he=o.transformMat4([],ie.center,X);o.squaredLength(he)===0&&o.set(he,0,0,1),o.normalize(he,he),o.scale$2(he,he,o.GLOBE_RADIUS),C.center=o.ecefToLatLng(he);const Ee=C.getWorldToCameraMatrix(),xe=o.invert(new Float64Array(16),Ee);ie=o.Aabb.applyTransform(ie,o.multiply([],Ee,X)),o.transformMat4(he,he,Ee);const Pe=.5*(ie.max[2]-ie.min[2]),We=this._minimumAABBFrustumDistance(C,ie),je=o.scale$2([],[0,0,1],Pe),Le=o.add(je,he,je),It=We+(C.pitch===0?0:o.distance(he,Le)),Ue=C.globeCenterInViewSpace,st=o.sub([],he,[Ue[0],Ue[1],Ue[2]]);o.normalize(st,st),o.scale$2(st,st,It);const Xe=o.add([],he,st);o.transformMat4(Xe,Xe,xe);const Et=o.earthRadius/o.GLOBE_RADIUS,Je=o.length(Xe),pt=o.mercatorZfromAltitude(Je*Et-o.earthRadius,0),Pt=Math.min(C.zoomFromMercatorZAdjusted(pt),M.maxZoom);return Pt>.5*(o.GLOBE_ZOOM_THRESHOLD_MIN+o.GLOBE_ZOOM_THRESHOLD_MAX)?(C.setProjection({name:"mercator"}),C.zoom=Pt,this._cameraForBounds(C,l,p,_,x,T)):{center:C.center,zoom:Pt,bearing:_,pitch:x}}queryTerrainElevation(r,l){const p=this.transform.elevation;return p?(l=o.extend({},{exaggerated:!0},l),p.getAtPoint(o.MercatorCoordinate.fromLngLat(r),null,l.exaggerated)):null}_cameraForBounds(r,l,p,_,x,T){if(r.projection.name==="globe")return this._cameraForBoundsOnGlobe(r,l,p,_,x,T);const C=r.clone(),M=this._extendCameraOptions(T),O=C.padding;C.bearing=_,C.pitch=x;const R=o.LngLat.convert(l),U=o.LngLat.convert(p),G=new o.LngLat(R.lng,U.lat),ee=new o.LngLat(U.lng,R.lat),Q=C.project(R),ne=C.project(U),H=this.queryTerrainElevation(R),X=this.queryTerrainElevation(U),re=this.queryTerrainElevation(G),ie=this.queryTerrainElevation(ee),he=[[Q.x,Q.y,Math.min(H||0,X||0,re||0,ie||0)],[ne.x,ne.y,Math.max(H||0,X||0,re||0,ie||0)]];let Ee=o.Aabb.fromPoints(he);const xe=C.getWorldToCameraMatrix(),Pe=o.invert(new Float64Array(16),xe);Ee=o.Aabb.applyTransform(Ee,xe);const We=o.sub([],Ee.max,Ee.min),je=O.left||0,Le=O.right||0,It=O.bottom||0,Ue=O.top||0,{left:st,right:Xe,top:Et,bottom:Je}=M.padding,pt=.5*(je+Le),Pt=.5*(Ue+It),De=Math.min(C.scaleZoom(C.scale*Math.min((C.width-(je+Le+st+Xe))/We[0],(C.height-(It+Ue+Je+Et))/We[1])),M.maxZoom),He=C.scale/C.zoomScale(De);Ee=new o.Aabb([Ee.min[0]-(st+pt)*He,Ee.min[1]-(Je+Pt)*He,Ee.min[2]],[Ee.max[0]+(Xe+pt)*He,Ee.max[1]+(Et+Pt)*He,Ee.max[2]]);const Qt=.5*We[2],ln=this._minimumAABBFrustumDistance(C,Ee),Jt=[0,0,1,0];o.transformMat4$1(Jt,Jt,xe),o.normalize$2(Jt,Jt);const mn=o.scale$2([],Jt,ln+Qt),Sn=o.add([],Ee.center,mn),cn=(typeof M.offset.x=="number"&&typeof M.offset.y=="number"?new o.pointGeometry(M.offset.x,M.offset.y):o.pointGeometry.convert(M.offset)).rotate(-o.degToRad(_));Ee.center[0]-=cn.x*He,Ee.center[1]+=cn.y*He,o.transformMat4(Ee.center,Ee.center,Pe),o.transformMat4(Sn,Sn,Pe);const Gt=[Ee.center[0],Ee.center[1],Sn[2]*C.pixelsPerMeter];o.scale$2(Gt,Gt,1/C.worldSize);const ei=o.lngFromMercatorX(Gt[0]),Wn=o.latFromMercatorY(Gt[1]),li=Math.min(C._zoomFromMercatorZ(Gt[2]),M.maxZoom),ii=new o.LngLat(ei,Wn);return C.mercatorFromTransition&&li<.5*(o.GLOBE_ZOOM_THRESHOLD_MIN+o.GLOBE_ZOOM_THRESHOLD_MAX)?(C.setProjection({name:"globe"}),C.zoom=li,this._cameraForBounds(C,l,p,_,x,T)):{center:ii,zoom:li,bearing:_,pitch:x}}fitBounds(r,l,p){const _=this.cameraForBounds(r,l);return this._fitInternal(_,l,p)}fitScreenCoordinates(r,l,p,_,x){const T=o.pointGeometry.convert(r),C=o.pointGeometry.convert(l),M=new o.pointGeometry(Math.min(T.x,C.x),Math.min(T.y,C.y)),O=new o.pointGeometry(Math.max(T.x,C.x),Math.max(T.y,C.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(T,C))return this;const R=this.transform.pointLocation3D(M),U=this.transform.pointLocation3D(O),G=this.transform.pointLocation3D(new o.pointGeometry(M.x,O.y)),ee=this.transform.pointLocation3D(new o.pointGeometry(O.x,M.y)),Q=[Math.min(R.lng,U.lng,G.lng,ee.lng),Math.min(R.lat,U.lat,G.lat,ee.lat)],ne=[Math.max(R.lng,U.lng,G.lng,ee.lng),Math.max(R.lat,U.lat,G.lat,ee.lat)],H=_&&_.pitch?_.pitch:this.getPitch(),X=this._cameraForBounds(this.transform,Q,ne,p,H,_);return this._fitInternal(X,_,x)}_fitInternal(r,l,p){return r?(delete(l=o.extend(r,l)).padding,l.linear?this.easeTo(l,p):this.flyTo(l,p)):this}jumpTo(r,l){this.stop();const p=r.preloadOnly?this.transform.clone():this.transform;let _=!1,x=!1,T=!1;return"zoom"in r&&p.zoom!==+r.zoom&&(_=!0,p.zoom=+r.zoom),r.center!==void 0&&(p.center=o.LngLat.convert(r.center)),"bearing"in r&&p.bearing!==+r.bearing&&(x=!0,p.bearing=+r.bearing),"pitch"in r&&p.pitch!==+r.pitch&&(T=!0,p.pitch=+r.pitch),r.padding==null||p.isPaddingEqual(r.padding)||(p.padding=r.padding),r.preloadOnly?(this._preloadTiles(p),this):(this.fire(new o.Event("movestart",l)).fire(new o.Event("move",l)),_&&this.fire(new o.Event("zoomstart",l)).fire(new o.Event("zoom",l)).fire(new o.Event("zoomend",l)),x&&this.fire(new o.Event("rotatestart",l)).fire(new o.Event("rotate",l)).fire(new o.Event("rotateend",l)),T&&this.fire(new o.Event("pitchstart",l)).fire(new o.Event("pitch",l)).fire(new o.Event("pitchend",l)),this.fire(new o.Event("moveend",l)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||o.warnOnce(wh),this.transform.getFreeCameraOptions()}setFreeCameraOptions(r,l){const p=this.transform;if(!p.projection.supportsFreeCamera)return o.warnOnce(wh),this;this.stop();const _=p.zoom,x=p.pitch,T=p.bearing;p.setFreeCameraOptions(r);const C=_!==p.zoom,M=x!==p.pitch,O=T!==p.bearing;return this.fire(new o.Event("movestart",l)).fire(new o.Event("move",l)),C&&this.fire(new o.Event("zoomstart",l)).fire(new o.Event("zoom",l)).fire(new o.Event("zoomend",l)),O&&this.fire(new o.Event("rotatestart",l)).fire(new o.Event("rotate",l)).fire(new o.Event("rotateend",l)),M&&this.fire(new o.Event("pitchstart",l)).fire(new o.Event("pitch",l)).fire(new o.Event("pitchend",l)),this.fire(new o.Event("moveend",l)),this}easeTo(r,l){this._stop(!1,r.easeId),((r=o.extend({offset:[0,0],duration:500,easing:o.ease},r)).animate===!1||!r.essential&&o.exported.prefersReducedMotion)&&(r.duration=0);const p=this.transform,_=this.getZoom(),x=this.getBearing(),T=this.getPitch(),C=this.getPadding(),M="zoom"in r?+r.zoom:_,O="bearing"in r?this._normalizeBearing(r.bearing,x):x,R="pitch"in r?+r.pitch:T,U="padding"in r?r.padding:p.padding,G=o.pointGeometry.convert(r.offset);let ee,Q,ne;if(p.projection.name==="globe"){const je=o.MercatorCoordinate.fromLngLat(p.center),Le=G.rotate(-p.angle);je.x+=Le.x/p.worldSize,je.y+=Le.y/p.worldSize;const It=je.toLngLat(),Ue=o.LngLat.convert(r.center||It);this._normalizeCenter(Ue),ee=p.centerPoint.add(Le),Q=new o.pointGeometry(je.x,je.y).mult(p.worldSize),ne=new o.pointGeometry(o.mercatorXfromLng(Ue.lng),o.mercatorYfromLat(Ue.lat)).mult(p.worldSize).sub(Q)}else{ee=p.centerPoint.add(G);const je=p.pointLocation(ee),Le=o.LngLat.convert(r.center||je);this._normalizeCenter(Le),Q=p.project(je),ne=p.project(Le).sub(Q)}const H=p.zoomScale(M-_);let X,re;r.around&&(X=o.LngLat.convert(r.around),re=p.locationPoint(X));const ie=this._zooming||M!==_,he=this._rotating||x!==O,Ee=this._pitching||R!==T,xe=!p.isPaddingEqual(U),Pe=je=>Le=>{if(ie&&(je.zoom=o.number(_,M,Le)),he&&(je.bearing=o.number(x,O,Le)),Ee&&(je.pitch=o.number(T,R,Le)),xe&&(je.interpolatePadding(C,U,Le),ee=je.centerPoint.add(G)),X)je.setLocationAtPoint(X,re);else{const It=je.zoomScale(je.zoom-_),Ue=M>_?Math.min(2,H):Math.max(.5,H),st=Math.pow(Ue,1-Le),Xe=je.unproject(Q.add(ne.mult(Le*st)).mult(It));je.setLocationAtPoint(je.renderWorldCopies?Xe.wrap():Xe,ee)}return r.preloadOnly||this._fireMoveEvents(l),je};if(r.preloadOnly){const je=this._emulate(Pe,r.duration,p);return this._preloadTiles(je),this}const We={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=ie,this._rotating=he,this._pitching=Ee,this._padding=xe,this._easeId=r.easeId,this._prepareEase(l,r.noMoveStart,We),this._ease(Pe(p),je=>{p.recenterOnTerrain(),this._afterEase(l,je)},r),this}_prepareEase(r,l,p={}){this._moving=!0,this.transform.cameraElevationReference="sea",l||p.moving||this.fire(new o.Event("movestart",r)),this._zooming&&!p.zooming&&this.fire(new o.Event("zoomstart",r)),this._rotating&&!p.rotating&&this.fire(new o.Event("rotatestart",r)),this._pitching&&!p.pitching&&this.fire(new o.Event("pitchstart",r))}_fireMoveEvents(r){this.fire(new o.Event("move",r)),this._zooming&&this.fire(new o.Event("zoom",r)),this._rotating&&this.fire(new o.Event("rotate",r)),this._pitching&&this.fire(new o.Event("pitch",r))}_afterEase(r,l){if(this._easeId&&l&&this._easeId===l)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const p=this._zooming,_=this._rotating,x=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,p&&this.fire(new o.Event("zoomend",r)),_&&this.fire(new o.Event("rotateend",r)),x&&this.fire(new o.Event("pitchend",r)),this.fire(new o.Event("moveend",r))}flyTo(r,l){if(!r.essential&&o.exported.prefersReducedMotion){const De=o.pick(r,["center","zoom","bearing","pitch","around"]);return this.jumpTo(De,l)}this.stop(),r=o.extend({offset:[0,0],speed:1.2,curve:1.42,easing:o.ease},r);const p=this.transform,_=this.getZoom(),x=this.getBearing(),T=this.getPitch(),C=this.getPadding(),M="zoom"in r?o.clamp(+r.zoom,p.minZoom,p.maxZoom):_,O="bearing"in r?this._normalizeBearing(r.bearing,x):x,R="pitch"in r?+r.pitch:T,U="padding"in r?r.padding:p.padding,G=p.zoomScale(M-_),ee=o.pointGeometry.convert(r.offset);let Q=p.centerPoint.add(ee);const ne=p.pointLocation(Q),H=o.LngLat.convert(r.center||ne);this._normalizeCenter(H);const X=p.project(ne),re=p.project(H).sub(X);let ie=r.curve;const he=Math.max(p.width,p.height),Ee=he/G,xe=re.mag();if("minZoom"in r){const De=o.clamp(Math.min(r.minZoom,_,M),p.minZoom,p.maxZoom),He=he/p.zoomScale(De-_);ie=Math.sqrt(He/xe*2)}const Pe=ie*ie;function We(De){const He=(Ee*Ee-he*he+(De?-1:1)*Pe*Pe*xe*xe)/(2*(De?Ee:he)*Pe*xe);return Math.log(Math.sqrt(He*He+1)-He)}function je(De){return(Math.exp(De)-Math.exp(-De))/2}function Le(De){return(Math.exp(De)+Math.exp(-De))/2}const It=We(0);let Ue=function(De){return Le(It)/Le(It+ie*De)},st=function(De){return he*((Le(It)*(je(He=It+ie*De)/Le(He))-je(It))/Pe)/xe;var He},Xe=(We(1)-It)/ie;if(Math.abs(xe)<1e-6||!isFinite(Xe)){if(Math.abs(he-Ee)<1e-6)return this.easeTo(r,l);const De=Ee<he?-1:1;Xe=Math.abs(Math.log(Ee/he))/ie,st=function(){return 0},Ue=function(He){return Math.exp(De*ie*He)}}r.duration="duration"in r?+r.duration:1e3*Xe/("screenSpeed"in r?+r.screenSpeed/ie:+r.speed),r.maxDuration&&r.duration>r.maxDuration&&(r.duration=0);const Et=x!==O,Je=R!==T,pt=!p.isPaddingEqual(U),Pt=De=>He=>{const Qt=He*Xe,ln=1/Ue(Qt);De.zoom=He===1?M:_+De.scaleZoom(ln),Et&&(De.bearing=o.number(x,O,He)),Je&&(De.pitch=o.number(T,R,He)),pt&&(De.interpolatePadding(C,U,He),Q=De.centerPoint.add(ee));const Jt=He===1?H:De.unproject(X.add(re.mult(st(Qt))).mult(ln));return De.setLocationAtPoint(De.renderWorldCopies?Jt.wrap():Jt,Q),De._updateCameraOnTerrain(),r.preloadOnly||this._fireMoveEvents(l),De};if(r.preloadOnly){const De=this._emulate(Pt,r.duration,p);return this._preloadTiles(De),this}return this._zooming=!0,this._rotating=Et,this._pitching=Je,this._padding=pt,this._prepareEase(l,!1),this._ease(Pt(p),()=>this._afterEase(l),r),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(r,l){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const p=this._onEaseEnd;this._onEaseEnd=void 0,p.call(this,l)}if(!r){const p=this.handlers;p&&p.stop(!1)}return this}_ease(r,l,p){p.animate===!1||p.duration===0?(r(1),l()):(this._easeStart=o.exported.now(),this._easeOptions=p,this._onEaseFrame=r,this._onEaseEnd=l,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const r=Math.min((o.exported.now()-this._easeStart)/this._easeOptions.duration,1),l=this._onEaseFrame;l&&l(this._easeOptions.easing(r)),r<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(r,l){r=o.wrap(r,-180,180);const p=Math.abs(r-l);return Math.abs(r-360-l)<p&&(r-=360),Math.abs(r+360-l)<p&&(r+=360),r}_normalizeCenter(r){const l=this.transform;if(!l.renderWorldCopies||l.maxBounds)return;const p=r.lng-l.center.lng;r.lng+=p>180?-360:p<-180?360:0}_emulate(r,l,p){const _=Math.ceil(15*l/1e3),x=[],T=r(p.clone());for(let C=0;C<=_;C++){const M=T(C/_);x.push(M.clone())}return x}}class Eh{constructor(r={}){this.options=r,o.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(r){const l=this.options&&this.options.compact;return this._map=r,this._container=D("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=D("button","mapboxgl-ctrl-attrib-button",this._container),D("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden","true"),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=D("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),l&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),l===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(r,l){const p=this._map._getUIString(`AttributionControl.${l}`);r.setAttribute("aria-label",p),r.removeAttribute("title"),r.firstElementChild&&r.firstElementChild.setAttribute("title",p)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let r=this._editLink;r||(r=this._editLink=this._container.querySelector(".mapbox-improve-map"));const l=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||o.config.ACCESS_TOKEN}];if(r){const p=l.reduce((_,x,T)=>(x.value&&(_+=`${x.key}=${x.value}${T<l.length-1?"&":""}`),_),"?");r.href=`${o.config.FEEDBACK_URL}/${p}#${Xr(this._map,!0)}`,r.rel="noopener nofollow",this._setElementTitle(r,"MapFeedback")}}_updateData(r){!r||r.sourceDataType!=="metadata"&&r.sourceDataType!=="visibility"&&r.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let r=[];if(this._map.style.stylesheet){const _=this._map.style.stylesheet;this.styleOwner=_.owner,this.styleId=_.id}const l=this._map.style._sourceCaches;for(const _ in l){const x=l[_];if(x.used){const T=x.getSource();T.attribution&&r.indexOf(T.attribution)<0&&r.push(T.attribution)}}r.sort((_,x)=>_.length-x.length),r=r.filter((_,x)=>{for(let T=x+1;T<r.length;T++)if(r[T].indexOf(_)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?r=[...this.options.customAttribution,...r]:r.unshift(this.options.customAttribution));const p=r.join(" | ");p!==this._attribHTML&&(this._attribHTML=p,r.length?(this._innerContainer.innerHTML=p,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class Th{constructor(){o.bindAll(["_updateLogo","_updateCompact"],this)}onAdd(r){this._map=r,this._container=D("div","mapboxgl-ctrl");const l=D("a","mapboxgl-ctrl-logo");return l.target="_blank",l.rel="noopener nofollow",l.href="https://www.mapbox.com/",l.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),l.setAttribute("rel","noopener nofollow"),this._container.appendChild(l),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(r){r&&r.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const r=this._map.style._sourceCaches;if(Object.entries(r).length===0)return!0;for(const l in r){const p=r[l].getSource();if(p.hasOwnProperty("mapbox_logo")&&!p.mapbox_logo)return!1}return!0}_updateCompact(){const r=this._container.children;if(r.length){const l=r[0];this._map.getCanvasContainer().offsetWidth<250?l.classList.add("mapboxgl-compact"):l.classList.remove("mapboxgl-compact")}}}class Sh{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(r){const l=++this._id;return this._queue.push({callback:r,id:l,cancelled:!1}),l}remove(r){const l=this._currentlyRunning,p=l?this._queue.concat(l):this._queue;for(const _ of p)if(_.id===r)return void(_.cancelled=!0)}run(r=0){const l=this._currentlyRunning=this._queue;this._queue=[];for(const p of l)if(!p.cancelled&&(p.callback(r),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function Ch(h,r,l){if(h=new o.LngLat(h.lng,h.lat),r){const p=new o.LngLat(h.lng-360,h.lat),_=new o.LngLat(h.lng+360,h.lat),x=360*Math.ceil(Math.abs(h.lng-l.center.lng)/360),T=l.locationPoint(h).distSqr(r),C=r.x<0||r.y<0||r.x>l.width||r.y>l.height;l.locationPoint(p).distSqr(r)<T&&(C||Math.abs(p.lng-l.center.lng)<x)?h=p:l.locationPoint(_).distSqr(r)<T&&(C||Math.abs(_.lng-l.center.lng)<x)&&(h=_)}for(;Math.abs(h.lng-l.center.lng)>180;){const p=l.locationPoint(h);if(p.x>=0&&p.y>=0&&p.x<=l.width&&p.y<=l.height)break;h.lng>l.center.lng?h.lng-=360:h.lng+=360}return h}const va={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class El extends o.Evented{constructor(r,l){if(super(),(r instanceof o.window.HTMLElement||l)&&(r=o.extend({element:r},l)),o.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=r&&r.anchor||"center",this._color=r&&r.color||"#3FB1CE",this._scale=r&&r.scale||1,this._draggable=r&&r.draggable||!1,this._clickTolerance=r&&r.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=r&&r.rotation||0,this._rotationAlignment=r&&r.rotationAlignment||"auto",this._pitchAlignment=r&&r.pitchAlignment&&r.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),this._occludedOpacity=r&&r.occludedOpacity||.2,r&&r.element)this._element=r.element,this._offset=o.pointGeometry.convert(r&&r.offset||[0,0]);else{this._defaultMarker=!0,this._element=D("div");const _=41,x=27,T=N("svg",{display:"block",height:_*this._scale+"px",width:x*this._scale+"px",viewBox:`0 0 ${x} ${_}`},this._element),C=N("radialGradient",{id:"shadowGradient"},N("defs",{},T));N("stop",{offset:"10%","stop-opacity":.4},C),N("stop",{offset:"100%","stop-opacity":.05},C),N("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},T),N("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},T),N("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},T),N("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},T),this._offset=o.pointGeometry.convert(r&&r.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",_=>{_.preventDefault()}),this._element.addEventListener("mousedown",_=>{_.preventDefault()});const p=this._element.classList;for(const _ in va)p.remove(`mapboxgl-marker-anchor-${_}`);p.add(`mapboxgl-marker-anchor-${this._anchor}`),this._popup=null}addTo(r){return r===this._map||(this.remove(),this._map=r,r.getCanvasContainer().appendChild(this._element),r.on("move",this._updateMoving),r.on("moveend",this._update),r.on("remove",this._clearFadeTimer),r._addMarker(this),this.setDraggable(this._draggable),this._update(),r.on("click",this._onMapClick)),this}remove(){const r=this._map;return r&&(r.off("click",this._onMapClick),r.off("move",this._updateMoving),r.off("moveend",this._update),r.off("mousedown",this._addDragHandler),r.off("touchstart",this._addDragHandler),r.off("mouseup",this._onUp),r.off("touchend",this._onUp),r.off("mousemove",this._onMove),r.off("touchmove",this._onMove),r.off("remove",this._clearFadeTimer),r._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(r){return this._lngLat=o.LngLat.convert(r),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(r){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),r){if(!("offset"in r.options)){const _=Math.sqrt(Math.pow(13.5,2)/2);r.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[_,-1*(38.1-13.5+_)],"bottom-right":[-_,-1*(38.1-13.5+_)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=r,r._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(r){const l=r.code,p=r.charCode||r.keyCode;l!=="Space"&&l!=="Enter"&&p!==32&&p!==13||this.togglePopup()}_onMapClick(r){const l=r.originalEvent.target,p=this._element;this._popup&&(l===p||p.contains(l))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const r=this._popup;return r?(r.isOpen()?(r.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(r.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const r=this._map,l=this._pos;if(!r||!l)return!1;const p=r.unproject(l),_=r.getFreeCameraOptions();if(!_.position)return!1;const x=_.position.toLngLat();return x.distanceTo(p)<.9*x.distanceTo(this._lngLat)}_evaluateOpacity(){const r=this._map;if(!r)return;const l=this._pos;if(!l||l.x<0||l.x>r.transform.width||l.y<0||l.y>r.transform.height)return void this._clearFadeTimer();const p=r.unproject(l);let _;r._showingGlobe()&&o.isLngLatBehindGlobe(r.transform,this._lngLat)?_=0:(_=1-r._queryFogOpacity(p),r.transform._terrainEnabled()&&r.getTerrain()&&this._behindTerrain()&&(_*=this._occludedOpacity)),this._element.style.opacity=`${_}`,this._element.style.pointerEvents=_>0?"auto":"none",this._popup&&this._popup._setOpacity(_),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const r=this._pos;if(!r||!this._map)return;const l=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${r.x}px,${r.y}px)
            ${va[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${l.x}px,${l.y}px)
        `}_calculateXYTransform(){const r=this._pos,l=this._map,p=this.getPitchAlignment();if(!l||!r||p!=="map")return"";if(!l._showingGlobe()){const M=l.getPitch();return M?`rotateX(${M}deg)`:""}const _=o.radToDeg(o.globeTiltAtLngLat(l.transform,this._lngLat)),x=r.sub(o.globeCenterToScreenPoint(l.transform)),T=Math.abs(x.x)+Math.abs(x.y);if(T===0)return"";const C=_/T;return`rotateX(${-x.y*C}deg) rotateY(${x.x*C}deg)`}_calculateZTransform(){const r=this._pos,l=this._map;if(!l||!r)return"";let p=0;const _=this.getRotationAlignment();if(_==="map")if(l._showingGlobe()){const x=l.project(new o.LngLat(this._lngLat.lng,this._lngLat.lat+.001)),T=l.project(new o.LngLat(this._lngLat.lng,this._lngLat.lat-.001)).sub(x);p=o.radToDeg(Math.atan2(T.y,T.x))-90}else p=-l.getBearing();else if(_==="horizon"){const x=o.smoothstep(4,6,l.getZoom()),T=o.globeCenterToScreenPoint(l.transform);T.y+=x*l.transform.height;const C=r.sub(T),M=o.radToDeg(Math.atan2(C.y,C.x));p=(M>90?M-270:M+90)*(1-x)}return p+=this._rotation,p?`rotateZ(${p}deg)`:""}_update(r){o.window.cancelAnimationFrame(this._updateFrameId);const l=this._map;l&&(l.transform.renderWorldCopies&&(this._lngLat=Ch(this._lngLat,this._pos,l.transform)),this._pos=l.project(this._lngLat),r===!0?this._updateFrameId=o.window.requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),l._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(l._showingGlobe()||l.getTerrain()||l.getFog())&&!this._fadeTimer&&(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(r){return this._offset=o.pointGeometry.convert(r),this._update(),this}_onMove(r){const l=this._map;if(!l)return;const p=this._pointerdownPos,_=this._positionDelta;if(p&&_){if(!this._isDragging){const x=this._clickTolerance||l._clickTolerance;if(r.point.dist(p)<x)return;this._isDragging=!0}this._pos=r.point.sub(_),this._lngLat=l.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new o.Event("dragstart"))),this.fire(new o.Event("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const r=this._map;r&&(r.off("mousemove",this._onMove),r.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new o.Event("dragend")),this._state="inactive"}_addDragHandler(r){const l=this._map,p=this._pos;l&&p&&this._element.contains(r.originalEvent.target)&&(r.preventDefault(),this._positionDelta=r.point.sub(p),this._pointerdownPos=r.point,this._state="pending",l.on("mousemove",this._onMove),l.on("touchmove",this._onMove),l.once("mouseup",this._onUp),l.once("touchend",this._onUp))}setDraggable(r){this._draggable=!!r;const l=this._map;return l&&(r?(l.on("mousedown",this._addDragHandler),l.on("touchstart",this._addDragHandler)):(l.off("mousedown",this._addDragHandler),l.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(r){return this._rotation=r||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(r){return this._rotationAlignment=r||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(r){return this._pitchAlignment=r||"auto",this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(r){return this._occludedOpacity=r||.2,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const Nc={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},Of=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Ah(h=new o.pointGeometry(0,0),r="bottom"){if(typeof h=="number"){const l=Math.round(Math.sqrt(.5*Math.pow(h,2)));switch(r){case"top":return new o.pointGeometry(0,h);case"top-left":return new o.pointGeometry(l,l);case"top-right":return new o.pointGeometry(-l,l);case"bottom":return new o.pointGeometry(0,-h);case"bottom-left":return new o.pointGeometry(l,-l);case"bottom-right":return new o.pointGeometry(-l,-l);case"left":return new o.pointGeometry(h,0);case"right":return new o.pointGeometry(-h,0)}return new o.pointGeometry(0,0)}return h instanceof o.pointGeometry||Array.isArray(h)?o.pointGeometry.convert(h):o.pointGeometry.convert(h[r]||[0,0])}class Bf{constructor(r){this.jumpTo(r)}getValue(r){if(r<=this._startTime)return this._start;if(r>=this._endTime)return this._end;const l=o.easeCubicInOut((r-this._startTime)/(this._endTime-this._startTime));return this._start*(1-l)+this._end*l}isEasing(r){return r>=this._startTime&&r<=this._endTime}jumpTo(r){this._startTime=-1/0,this._endTime=-1/0,this._start=r,this._end=r}easeTo(r,l,p){this._start=this.getValue(l),this._end=r,this._startTime=l,this._endTime=l+p}}const Ff={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use \u2318 + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},Nf={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,optimizeForTerrain:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0},Vf={showCompass:!0,showZoom:!0,visualizePitch:!1};class Uf{constructor(r,l,p=!1){this._clickTolerance=10,this.element=l,this.mouseRotate=new yh({clickTolerance:r.dragRotate._mouseRotate._clickTolerance}),this.map=r,p&&(this.mousePitch=new vh({clickTolerance:r.dragRotate._mousePitch._clickTolerance})),o.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),l.addEventListener("mousedown",this.mousedown),l.addEventListener("touchstart",this.touchstart,{passive:!1}),l.addEventListener("touchmove",this.touchmove),l.addEventListener("touchend",this.touchend),l.addEventListener("touchcancel",this.reset)}down(r,l){this.mouseRotate.mousedown(r,l),this.mousePitch&&this.mousePitch.mousedown(r,l),fe()}move(r,l){const p=this.map,_=this.mouseRotate.mousemoveWindow(r,l),x=_&&_.bearingDelta;if(x&&p.setBearing(p.getBearing()+x),this.mousePitch){const T=this.mousePitch.mousemoveWindow(r,l),C=T&&T.pitchDelta;C&&p.setPitch(p.getPitch()+C)}}off(){const r=this.element;r.removeEventListener("mousedown",this.mousedown),r.removeEventListener("touchstart",this.touchstart,{passive:!1}),r.removeEventListener("touchmove",this.touchmove),r.removeEventListener("touchend",this.touchend),r.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){te(),o.window.removeEventListener("mousemove",this.mousemove),o.window.removeEventListener("mouseup",this.mouseup)}mousedown(r){this.down(o.extend({},r,{ctrlKey:!0,preventDefault:()=>r.preventDefault()}),ce(this.element,r)),o.window.addEventListener("mousemove",this.mousemove),o.window.addEventListener("mouseup",this.mouseup)}mousemove(r){this.move(r,ce(this.element,r))}mouseup(r){this.mouseRotate.mouseupWindow(r),this.mousePitch&&this.mousePitch.mouseupWindow(r),this.offTemp()}touchstart(r){r.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=pe(this.element,r.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>r.preventDefault()},this._startPos))}touchmove(r){r.targetTouches.length!==1?this.reset():(this._lastPos=pe(this.element,r.targetTouches)[0],this.move({preventDefault:()=>r.preventDefault()},this._lastPos))}touchend(r){r.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const Mh={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},jf={maxWidth:100,unit:"metric"};function qf(h,r,l){const p=Ih(r),_=p/r,x={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"}[l];this._map._requestDomTask(()=>{this._container.style.width=h*_+"px",this._container.innerHTML=`${p}&nbsp;${x}`})}function Ih(h){const r=Math.pow(10,`${Math.floor(h)}`.length-1);let l=h/r;return l=l>=10?10:l>=5?5:l>=3?3:l>=2?2:l>=1?1:function(p){const _=Math.pow(10,Math.ceil(-Math.log(p)/Math.LN10));return Math.round(p*_)/_}(l),r*l}const Tl={version:o.version,supported:k,setRTLTextPlugin:o.setRTLTextPlugin,getRTLTextPluginStatus:o.getRTLTextPluginStatus,Map:class extends Df{constructor(h){if(o.LivePerformanceUtils.mark(o.PerformanceMarkers.create),(h=o.extend({},Nf,h)).minZoom!=null&&h.maxZoom!=null&&h.minZoom>h.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(h.minPitch!=null&&h.maxPitch!=null&&h.minPitch>h.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(h.minPitch!=null&&h.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(h.maxPitch!=null&&h.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(h.antialias&&o.isSafariWithAntialiasingBug(o.window)&&(h.antialias=!1,o.warnOnce("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new fa(h.minZoom,h.maxZoom,h.minPitch,h.maxPitch,h.renderWorldCopies),h),this._interactive=h.interactive,this._minTileCacheSize=h.minTileCacheSize,this._maxTileCacheSize=h.maxTileCacheSize,this._failIfMajorPerformanceCaveat=h.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=h.preserveDrawingBuffer,this._antialias=h.antialias,this._trackResize=h.trackResize,this._bearingSnap=h.bearingSnap,this._refreshExpiredTiles=h.refreshExpiredTiles,this._fadeDuration=h.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=h.crossSourceCollisions,this._collectResourceTiming=h.collectResourceTiming,this._optimizeForTerrain=h.optimizeForTerrain,this._language=this._parseLanguage(h.language),this._worldview=h.worldview,this._renderTaskQueue=new Sh,this._domRenderTaskQueue=new Sh,this._controls=[],this._markers=[],this._popups=[],this._mapId=o.uniqueId(),this._locale=o.extend({},Ff,h.locale),this._clickTolerance=h.clickTolerance,this._cooperativeGestures=h.cooperativeGestures,this._performanceMetricsCollection=h.performanceMetricsCollection,this._containerWidth=0,this._containerHeight=0,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new Bf(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._requestManager=new o.RequestManager(h.transformRequest,h.accessToken,h.testMode),this._silenceAuthErrors=!!h.testMode,typeof h.container=="string"){if(this._container=o.window.document.getElementById(h.container),!this._container)throw new Error(`Container '${h.container}' not found.`)}else{if(!(h.container instanceof o.window.HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=h.container}if(this._container.childNodes.length>0&&o.warnOnce("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),h.maxBounds&&this.setMaxBounds(h.maxBounds),o.bindAll(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),o.window!==void 0&&(o.window.addEventListener("online",this._onWindowOnline,!1),o.window.addEventListener("resize",this._onWindowResize,!1),o.window.addEventListener("orientationchange",this._onWindowResize,!1),o.window.addEventListener("webkitfullscreenchange",this._onWindowResize,!1),o.window.addEventListener("visibilitychange",this._onVisibilityChange,!1)),this.handlers=new wl(this,h),this._localFontFamily=h.localFontFamily,this._localIdeographFontFamily=h.localIdeographFontFamily,h.style&&this.setStyle(h.style,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),h.projection&&this.setProjection(h.projection),this._hash=h.hash&&new $t(typeof h.hash=="string"&&h.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:h.center,zoom:h.zoom,bearing:h.bearing,pitch:h.pitch}),h.bounds&&(this.resize(),this.fitBounds(h.bounds,o.extend({},h.fitBoundsOptions,{duration:0})))),this.resize(),h.attributionControl&&this.addControl(new Eh({customAttribution:h.customAttribution})),this._logoControl=new Th,this.addControl(this._logoControl,h.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",r=>{this._update(r.dataType==="style"),this.fire(new o.Event(`${r.dataType}data`,r))}),this.on("dataloading",r=>{this.fire(new o.Event(`${r.dataType}dataloading`,r))})}_getMapId(){return this._mapId}addControl(h,r){if(r===void 0&&(r=h.getDefaultPosition?h.getDefaultPosition():"top-right"),!h||!h.onAdd)return this.fire(new o.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const l=h.onAdd(this);this._controls.push(h);const p=this._controlPositions[r];return r.indexOf("bottom")!==-1?p.insertBefore(l,p.firstChild):p.appendChild(l),this}removeControl(h){if(!h||!h.onRemove)return this.fire(new o.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const r=this._controls.indexOf(h);return r>-1&&this._controls.splice(r,1),h.onRemove(this),this}hasControl(h){return this._controls.indexOf(h)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(h){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const r=!this._moving;return r&&this.fire(new o.Event("movestart",h)).fire(new o.Event("move",h)),this.fire(new o.Event("resize",h)),r&&this.fire(new o.Event("moveend",h)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(h){return this.transform.setMaxBounds(o.LngLatBounds.convert(h)),this._update()}setMinZoom(h){if((h=h==null?-2:h)>=-2&&h<=this.transform.maxZoom)return this.transform.minZoom=h,this._update(),this.getZoom()<h?this.setZoom(h):this.fire(new o.Event("zoomstart")).fire(new o.Event("zoom")).fire(new o.Event("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(h){if((h=h==null?22:h)>=this.transform.minZoom)return this.transform.maxZoom=h,this._update(),this.getZoom()>h?this.setZoom(h):this.fire(new o.Event("zoomstart")).fire(new o.Event("zoom")).fire(new o.Event("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(h){if((h=h==null?0:h)<0)throw new Error("minPitch must be greater than or equal to 0");if(h>=0&&h<=this.transform.maxPitch)return this.transform.minPitch=h,this._update(),this.getPitch()<h?this.setPitch(h):this.fire(new o.Event("pitchstart")).fire(new o.Event("pitch")).fire(new o.Event("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(h){if((h=h==null?85:h)>85)throw new Error("maxPitch must be less than or equal to 85");if(h>=this.transform.minPitch)return this.transform.maxPitch=h,this._update(),this.getPitch()>h?this.setPitch(h):this.fire(new o.Event("pitchstart")).fire(new o.Event("pitch")).fire(new o.Event("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(h){return this.transform.renderWorldCopies=h,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(h){return h==="auto"?o.window.navigator.language:Array.isArray(h)?h.length===0?void 0:h.map(r=>r==="auto"?o.window.navigator.language:r):h}setLanguage(h){const r=this._parseLanguage(h);if(!this.style||r===this._language)return this;this._language=r,this.style._reloadSources();for(const l of this._controls)l._setLanguage&&l._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(h){return this.style&&h!==this._worldview?(this._worldview=h,this.style._reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(h){return this._lazyInitEmptyStyle(),h?typeof h=="string"&&(h={name:h}):h=null,this._useExplicitProjection=!!h,this._prioritizeAndUpdateProjection(h,this.style.stylesheet?this.style.stylesheet.projection:null)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;const h=this.transform,r=h.projection.name;let l;r==="globe"&&h.zoom>=o.GLOBE_ZOOM_THRESHOLD_MAX?(h.setMercatorFromTransition(),l=!0):r==="mercator"&&h.zoom<o.GLOBE_ZOOM_THRESHOLD_MAX&&(h.setProjection({name:"globe"}),l=!0),l&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(h,r){return this._updateProjection(h||r||{name:"mercator"})}_updateProjection(h){let r;if(r=h.name==="globe"&&this.transform.zoom>=o.GLOBE_ZOOM_THRESHOLD_MAX?this.transform.setMercatorFromTransition():this.transform.setProjection(h),this.style.applyProjectionUpdate(),r){this.painter.clearBackgroundTiles();for(const l in this.style._sourceCaches)this.style._sourceCaches[l].clearTiles();this._update(!0),this._forceMarkerAndPopupUpdate(!0)}return this}project(h){return this.transform.locationPoint3D(o.LngLat.convert(h))}unproject(h){return this.transform.pointLocation3D(o.pointGeometry.convert(h))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(h,r,l){if(h==="mouseenter"||h==="mouseover"){let p=!1;const _=T=>{const C=r.filter(O=>this.getLayer(O)),M=C.length?this.queryRenderedFeatures(T.point,{layers:C}):[];M.length?p||(p=!0,l.call(this,new Pr(h,this,T.originalEvent,{features:M}))):p=!1},x=()=>{p=!1};return{layers:new Set(r),listener:l,delegates:{mousemove:_,mouseout:x}}}if(h==="mouseleave"||h==="mouseout"){let p=!1;const _=T=>{const C=r.filter(M=>this.getLayer(M));(C.length?this.queryRenderedFeatures(T.point,{layers:C}):[]).length?p=!0:p&&(p=!1,l.call(this,new Pr(h,this,T.originalEvent)))},x=T=>{p&&(p=!1,l.call(this,new Pr(h,this,T.originalEvent)))};return{layers:new Set(r),listener:l,delegates:{mousemove:_,mouseout:x}}}{const p=_=>{const x=r.filter(C=>this.getLayer(C)),T=x.length?this.queryRenderedFeatures(_.point,{layers:x}):[];T.length&&(_.features=T,l.call(this,_),delete _.features)};return{layers:new Set(r),listener:l,delegates:{[h]:p}}}}on(h,r,l){if(l===void 0)return super.on(h,r);Array.isArray(r)||(r=[r]);const p=this._createDelegatedListener(h,r,l);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[h]=this._delegatedListeners[h]||[],this._delegatedListeners[h].push(p);for(const _ in p.delegates)this.on(_,p.delegates[_]);return this}once(h,r,l){if(l===void 0)return super.once(h,r);Array.isArray(r)||(r=[r]);const p=this._createDelegatedListener(h,r,l);for(const _ in p.delegates)this.once(_,p.delegates[_]);return this}off(h,r,l){if(l===void 0)return super.off(h,r);r=new Set(Array.isArray(r)?r:[r]);const p=(x,T)=>{if(x.size!==T.size)return!1;for(const C of x)if(!T.has(C))return!1;return!0},_=this._delegatedListeners?this._delegatedListeners[h]:void 0;return _&&(x=>{for(let T=0;T<x.length;T++){const C=x[T];if(C.listener===l&&p(C.layers,r)){for(const M in C.delegates)this.off(M,C.delegates[M]);return x.splice(T,1),this}}})(_),this}queryRenderedFeatures(h,r){return this.style?(r!==void 0||h===void 0||h instanceof o.pointGeometry||Array.isArray(h)||(r=h,h=void 0),this.style.queryRenderedFeatures(h=h||[[0,0],[this.transform.width,this.transform.height]],r=r||{},this.transform)):[]}querySourceFeatures(h,r){return this.style.querySourceFeatures(h,r)}setStyle(h,r){return(r=o.extend({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},r)).diff!==!1&&r.localIdeographFontFamily===this._localIdeographFontFamily&&r.localFontFamily===this._localFontFamily&&this.style&&h?(this._diffStyle(h,r),this):(this._localIdeographFontFamily=r.localIdeographFontFamily,this._localFontFamily=r.localFontFamily,this._updateStyle(h,r))}_getUIString(h){const r=this._locale[h];if(r==null)throw new Error(`Missing UI string '${h}'`);return r}_updateStyle(h,r){return this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),h&&(this.style=new rr(this,r||{}),this.style.setEventedParent(this,{style:this.style}),typeof h=="string"?this.style.loadURL(h):this.style.loadJSON(h)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new rr(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(h,r){if(typeof h=="string"){const l=this._requestManager.normalizeStyleURL(h),p=this._requestManager.transformRequest(l,o.ResourceType.Style);o.getJSON(p,(_,x)=>{_?this.fire(new o.ErrorEvent(_)):x&&this._updateDiff(x,r)})}else typeof h=="object"&&this._updateDiff(h,r)}_updateDiff(h,r){try{this.style.setState(h)&&this._update(!0)}catch(l){o.warnOnce(`Unable to perform style diff: ${l.message||l.error||l}.  Rebuilding the style from scratch.`),this._updateStyle(h,r)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(o.warnOnce("There is no style added to the map."),!1)}addSource(h,r){return this._lazyInitEmptyStyle(),this.style.addSource(h,r),this._update(!0)}isSourceLoaded(h){return!!this.style&&this.style._isSourceCacheLoaded(h)}areTilesLoaded(){const h=this.style&&this.style._sourceCaches;for(const r in h){const l=h[r]._tiles;for(const p in l){const _=l[p];if(_.state!=="loaded"&&_.state!=="errored")return!1}}return!0}addSourceType(h,r,l){this._lazyInitEmptyStyle(),this.style.addSourceType(h,r,l)}removeSource(h){return this.style.removeSource(h),this._updateTerrain(),this._update(!0)}getSource(h){return this.style.getSource(h)}addImage(h,r,{pixelRatio:l=1,sdf:p=!1,stretchX:_,stretchY:x,content:T}={}){if(this._lazyInitEmptyStyle(),r instanceof o.window.HTMLImageElement||o.window.ImageBitmap&&r instanceof o.window.ImageBitmap){const{width:C,height:M,data:O}=o.exported.getImageData(r);this.style.addImage(h,{data:new o.RGBAImage({width:C,height:M},O),pixelRatio:l,stretchX:_,stretchY:x,content:T,sdf:p,version:0})}else if(r.width===void 0||r.height===void 0)this.fire(new o.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:C,height:M}=r,O=r;this.style.addImage(h,{data:new o.RGBAImage({width:C,height:M},new Uint8Array(O.data)),pixelRatio:l,stretchX:_,stretchY:x,content:T,sdf:p,version:0,userImage:O}),O.onAdd&&O.onAdd(this,h)}}updateImage(h,r){const l=this.style.getImage(h);if(!l)return void this.fire(new o.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const p=r instanceof o.window.HTMLImageElement||o.window.ImageBitmap&&r instanceof o.window.ImageBitmap?o.exported.getImageData(r):r,{width:_,height:x}=p;_!==void 0&&x!==void 0?_===l.data.width&&x===l.data.height?(l.data.replace(p.data,!(r instanceof o.window.HTMLImageElement||o.window.ImageBitmap&&r instanceof o.window.ImageBitmap)),this.style.updateImage(h,l)):this.fire(new o.ErrorEvent(new Error(`The width and height of the updated image (${_}, ${x})
                must be that same as the previous version of the image
                (${l.data.width}, ${l.data.height})`))):this.fire(new o.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")))}hasImage(h){return h?!!this.style.getImage(h):(this.fire(new o.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(h){this.style.removeImage(h)}loadImage(h,r){o.getImage(this._requestManager.transformRequest(h,o.ResourceType.Image),(l,p)=>{r(l,p instanceof o.window.HTMLImageElement?o.exported.getImageData(p):p)})}listImages(){return this.style.listImages()}addLayer(h,r){return this._lazyInitEmptyStyle(),this.style.addLayer(h,r),this._update(!0)}moveLayer(h,r){return this.style.moveLayer(h,r),this._update(!0)}removeLayer(h){return this.style.removeLayer(h),this._update(!0)}getLayer(h){return this.style.getLayer(h)}setLayerZoomRange(h,r,l){return this.style.setLayerZoomRange(h,r,l),this._update(!0)}setFilter(h,r,l={}){return this.style.setFilter(h,r,l),this._update(!0)}getFilter(h){return this.style.getFilter(h)}setPaintProperty(h,r,l,p={}){return this.style.setPaintProperty(h,r,l,p),this._update(!0)}getPaintProperty(h,r){return this.style.getPaintProperty(h,r)}setLayoutProperty(h,r,l,p={}){return this.style.setLayoutProperty(h,r,l,p),this._update(!0)}getLayoutProperty(h,r){return this.style.getLayoutProperty(h,r)}setLight(h,r={}){return this._lazyInitEmptyStyle(),this.style.setLight(h,r),this._update(!0)}getLight(){return this.style.getLight()}setTerrain(h){return this._lazyInitEmptyStyle(),!h&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(h),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(h){return this._lazyInitEmptyStyle(),this.style.setFog(h),this._update(!0)}getFog(){return this.style?this.style.getFog():null}_queryFogOpacity(h){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(o.LngLat.convert(h),this.transform):0}setFeatureState(h,r){return this.style.setFeatureState(h,r),this._update()}removeFeatureState(h,r){return this.style.removeFeatureState(h,r),this._update()}getFeatureState(h){return this.style.getFeatureState(h)}_updateContainerDimensions(){if(!this._container)return;const h=this._container.getBoundingClientRect().width||400,r=this._container.getBoundingClientRect().height||300;let l,p,_,x=this._container;for(;x&&(!p||!_);){const T=o.window.getComputedStyle(x).transform;T&&T!=="none"&&(l=T.match(/matrix.*\((.+)\)/)[1].split(", "),l[0]&&l[0]!=="0"&&l[0]!=="1"&&(p=l[0]),l[3]&&l[3]!=="0"&&l[3]!=="1"&&(_=l[3])),x=x.parentElement}this._containerWidth=p?Math.abs(h/p):h,this._containerHeight=_?Math.abs(r/_):r}_detectMissingCSS(){o.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&o.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const h=this._container;h.classList.add("mapboxgl-map"),(this._missingCSSCanary=D("div","mapboxgl-canary",h)).style.visibility="hidden",this._detectMissingCSS();const r=this._canvasContainer=D("div","mapboxgl-canvas-container",h);this._interactive&&r.classList.add("mapboxgl-interactive"),this._canvas=D("canvas","mapboxgl-canvas",r),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const l=this._controlContainer=D("div","mapboxgl-control-container",h),p=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(_=>{p[_]=D("div",`mapboxgl-ctrl-${_}`,l)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(h,r){const l=o.exported.devicePixelRatio||1;this._canvas.width=l*Math.ceil(h),this._canvas.height=l*Math.ceil(r),this._canvas.style.width=`${h}px`,this._canvas.style.height=`${r}px`}_addMarker(h){this._markers.push(h)}_removeMarker(h){const r=this._markers.indexOf(h);r!==-1&&this._markers.splice(r,1)}_addPopup(h){this._popups.push(h)}_removePopup(h){const r=this._popups.indexOf(h);r!==-1&&this._popups.splice(r,1)}_setupPainter(){const h=o.extend({},k.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),r=this._canvas.getContext("webgl",h)||this._canvas.getContext("experimental-webgl",h);r?(o.storeAuthState(r,!0),this.painter=new Tg(r,this.transform),this.on("data",l=>{l.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),o.exported$1.testSupport(r)):this.fire(new o.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(h){h.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new o.Event("webglcontextlost",{originalEvent:h}))}_contextRestored(h){this._setupPainter(),this.resize(),this._update(),this.fire(new o.Event("webglcontextrestored",{originalEvent:h}))}_onMapScroll(h){if(h.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(h){return this.style?(this._styleDirty=this._styleDirty||h,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(h){return this._update(),this._renderTaskQueue.add(h)}_cancelRenderFrame(h){this._renderTaskQueue.remove(h)}_requestDomTask(h){!this.loaded()||this.loaded()&&!this.isMoving()?h():this._domRenderTaskQueue.add(h)}_render(h){let r;const l=this.painter.context.extTimerQuery,p=o.exported.now();if(this.listens("gpu-timing-frame")&&(r=l.createQueryEXT(),l.beginQueryEXT(l.TIME_ELAPSED_EXT,r)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],o.window.performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],o.window.performance.now())),this._renderTaskQueue.run(h),this._domRenderTaskQueue.run(h),this._removed)return;this._updateProjectionTransition();const _=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const C=this.transform.zoom,M=this.transform.pitch,O=o.exported.now(),R=new o.EvaluationParameters(C,{now:O,fadeDuration:_,pitch:M,transition:this.style.getTransition()});this.style.update(R)}this.style&&this.style.fog&&this.style.fog.hasTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let x=!1;if(this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),x=this._updateAverageElevation(p),this.style._updateSources(this.transform),this._forceMarkerAndPopupUpdate()):x=this._updateAverageElevation(p),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,_,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showTerrainWireframe:this.showTerrainWireframe,showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:_,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new o.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new o.Event("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),r){const C=o.exported.now()-p;l.endQueryEXT(l.TIME_ELAPSED_EXT,r),setTimeout(()=>{const M=l.getQueryObjectEXT(r,l.QUERY_RESULT_EXT)/1e6;l.deleteQueryEXT(r),this.fire(new o.Event("gpu-timing-frame",{cpuTime:C,gpuTime:M})),o.window.performance.mark("frame-gpu",{startTime:p,detail:{gpuTime:M}})},50)}if(this.listens("gpu-timing-layer")){const C=this.painter.collectGpuTimers();setTimeout(()=>{const M=this.painter.queryGpuTimers(C);this.fire(new o.Event("gpu-timing-layer",{layerTimes:M}))},50)}if(this.listens("gpu-timing-deferred-render")){const C=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const M=this.painter.queryGpuTimeDeferredRender(C);this.fire(new o.Event("gpu-timing-deferred-render",{gpuTime:M}))},50)}const T=this._sourcesDirty||this._styleDirty||this._placementDirty||x;if(T||this._repaint)this.triggerRepaint();else{const C=!this.isMoving()&&this.loaded();if(C&&(x=this._updateAverageElevation(p,!0)),x)this.triggerRepaint();else if(this._triggerFrame(!1),C&&(this.fire(new o.Event("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const M=this._calculateSpeedIndex();this.fire(new o.Event("speedindexcompleted",{speedIndex:M})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||T||(this._fullyLoaded=!0,o.LivePerformanceUtils.mark(o.PerformanceMarkers.fullLoad),this._performanceMetricsCollection&&o.postPerformanceEvent(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(h){for(const r of this._markers)h&&!this.getRenderWorldCopies()&&(r._lngLat=r._lngLat.wrap()),r._update();for(const r of this._popups)!h||this.getRenderWorldCopies()||r._trackPointer||(r._lngLat=r._lngLat.wrap()),r._update()}_updateAverageElevation(h,r=!1){const l=p=>(this.transform.averageElevation=p,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&l(0);if((r||h-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(h)){const p=this.transform.averageElevation;let _=this.transform.sampleAverageElevation(),x=!1;this.transform.elevation&&(x=this.transform.elevation.exaggeration()!==this._averageElevationExaggeration,this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(_)?_=0:this._averageElevationLastSampledAt=h;const T=Math.abs(p-_);if(T>1){if(this._isInitialLoad||x)return this._averageElevation.jumpTo(_),l(_);this._averageElevation.easeTo(_,h,300)}else if(T>1e-4)return this._averageElevation.jumpTo(_),l(_)}return!!this._averageElevation.isEasing(h)&&l(this._averageElevation.getValue(h))}_authenticate(){o.getMapSessionAPI(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,h=>{if(h&&(h.message===o.AUTH_ERR_MSG||h.status===401)){const r=this.painter.context.gl;o.storeAuthState(r,!1),this._logoControl instanceof Th&&this._logoControl._updateLogo(),r&&r.clear(r.DEPTH_BUFFER_BIT|r.COLOR_BUFFER_BIT|r.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new o.ErrorEvent(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),o.postMapLoadEvent(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_updateTerrain(){const h=this._isDragging();this.painter.updateTerrain(this.style,h)}_calculateSpeedIndex(){const h=this.painter.canvasCopy(),r=this.painter.getCanvasCopiesAndTimestamps();r.timeStamps.push(performance.now());const l=this.painter.context.gl,p=l.createFramebuffer();function _(x){l.framebufferTexture2D(l.FRAMEBUFFER,l.COLOR_ATTACHMENT0,l.TEXTURE_2D,x,0);const T=new Uint8Array(l.drawingBufferWidth*l.drawingBufferHeight*4);return l.readPixels(0,0,l.drawingBufferWidth,l.drawingBufferHeight,l.RGBA,l.UNSIGNED_BYTE,T),T}return l.bindFramebuffer(l.FRAMEBUFFER,p),this._canvasPixelComparison(_(h),r.canvasCopies.map(_),r.timeStamps)}_canvasPixelComparison(h,r,l){let p=l[1]-l[0];const _=h.length/4;for(let x=0;x<r.length;x++){const T=r[x];let C=0;for(let M=0;M<T.length;M+=4)T[M]===h[M]&&T[M+1]===h[M+1]&&T[M+2]===h[M+2]&&T[M+3]===h[M+3]&&(C+=1);p+=(l[x+2]-l[x+1])*(1-C/_)}return p}remove(){this._hash&&this._hash.remove();for(const r of this._controls)r.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),o.window!==void 0&&(o.window.removeEventListener("resize",this._onWindowResize,!1),o.window.removeEventListener("orientationchange",this._onWindowResize,!1),o.window.removeEventListener("webkitfullscreenchange",this._onWindowResize,!1),o.window.removeEventListener("online",this._onWindowOnline,!1),o.window.removeEventListener("visibilitychange",this._onVisibilityChange,!1));const h=this.painter.context.gl.getExtension("WEBGL_lose_context");h&&h.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),o.removeAuthState(this.painter.context.gl),this._removed=!0,this.fire(new o.Event("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(h){this._renderNextFrame=this._renderNextFrame||h,this.style&&!this._frame&&(this._frame=o.exported.frame(r=>{const l=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,l&&this._render(r)}))}_preloadTiles(h){const r=this.style?Object.values(this.style._sourceCaches):[];return o.asyncAll(r,(l,p)=>l._preloadTiles(h,p),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(h){this._trackResize&&this.resize({originalEvent:h})._update()}_onVisibilityChange(){o.window.document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(h){this._showTileBoundaries!==h&&(this._showTileBoundaries=h,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(h){this._showTerrainWireframe!==h&&(this._showTerrainWireframe=h,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(h){this._speedIndexTiming!==h&&(this._speedIndexTiming=h,this._update())}get showPadding(){return!!this._showPadding}set showPadding(h){this._showPadding!==h&&(this._showPadding=h,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(h){this._showCollisionBoxes!==h&&(this._showCollisionBoxes=h,h?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(h){this._showOverdrawInspector!==h&&(this._showOverdrawInspector=h,this._update())}get repaint(){return!!this._repaint}set repaint(h){this._repaint!==h&&(this._repaint=h,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(h){this._vertices=h,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(h){this._showTileAABBs!==h&&(this._showTileAABBs=h,h&&this._update())}_setCacheLimits(h,r){o.setCacheLimits(h,r)}get version(){return o.version}},NavigationControl:class{constructor(h){this.options=o.extend({},Vf,h),this._container=D("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",r=>r.preventDefault()),this.options.showZoom&&(o.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",r=>{this._map&&this._map.zoomIn({},{originalEvent:r})}),D("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",r=>{this._map&&this._map.zoomOut({},{originalEvent:r})}),D("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(o.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",r=>{const l=this._map;l&&(this.options.visualizePitch?l.resetNorthPitch({},{originalEvent:r}):l.resetNorth({},{originalEvent:r}))}),this._compassIcon=D("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const h=this._map;if(!h)return;const r=h.getZoom(),l=r===h.getMaxZoom(),p=r===h.getMinZoom();this._zoomInButton.disabled=l,this._zoomOutButton.disabled=p,this._zoomInButton.setAttribute("aria-disabled",l.toString()),this._zoomOutButton.setAttribute("aria-disabled",p.toString())}_rotateCompassArrow(){const h=this._map;if(!h)return;const r=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(h.transform.pitch*(Math.PI/180)),.5)}) rotateX(${h.transform.pitch}deg) rotateZ(${h.transform.angle*(180/Math.PI)}deg)`:`rotate(${h.transform.angle*(180/Math.PI)}deg)`;h._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=r)})}onAdd(h){return this._map=h,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),h.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&h.on("pitch",this._rotateCompassArrow),h.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Uf(h,this._compass,this.options.visualizePitch)),this._container}onRemove(){const h=this._map;h&&(this._container.remove(),this.options.showZoom&&h.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&h.off("pitch",this._rotateCompassArrow),h.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(h,r){const l=D("button",h,this._container);return l.type="button",l.addEventListener("click",r),l}_setButtonTitle(h,r){if(!this._map)return;const l=this._map._getUIString(`NavigationControl.${r}`);h.setAttribute("aria-label",l),h.firstElementChild&&h.firstElementChild.setAttribute("title",l)}},GeolocateControl:class extends o.Evented{constructor(h){super(),this.options=o.extend({geolocation:o.window.navigator.geolocation},Mh,h),o.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=yl(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(h){return this._map=h,this._container=D("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(h){const r=(l=!!this.options.geolocation)=>{this._supportsGeolocation=l,h(l)};this._supportsGeolocation!==void 0?h(this._supportsGeolocation):o.window.navigator.permissions!==void 0?o.window.navigator.permissions.query({name:"geolocation"}).then(l=>r(l.state!=="denied")).catch(()=>r()):r()}_isOutOfMapMaxBounds(h){const r=this._map.getMaxBounds(),l=h.coords;return!!r&&(l.longitude<r.getWest()||l.longitude>r.getEast()||l.latitude<r.getSouth()||l.latitude>r.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(h){if(this._map){if(this._isOutOfMapMaxBounds(h))return this._setErrorState(),this.fire(new o.Event("outofmaxbounds",h)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=h,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(h),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(h),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new o.Event("geolocate",h)),this._finish()}}_updateCamera(h){const r=new o.LngLat(h.coords.longitude,h.coords.latitude),l=h.coords.accuracy,p=this._map.getBearing(),_=o.extend({bearing:p},this.options.fitBoundsOptions);this._map.fitBounds(r.toBounds(l),_,{geolocateSource:!0})}_updateMarker(h){if(h){const r=new o.LngLat(h.coords.longitude,h.coords.latitude);this._accuracyCircleMarker.setLngLat(r).addTo(this._map),this._userLocationDotMarker.setLngLat(r).addTo(this._map),this._accuracy=h.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const h=this._map.transform,r=o.mercatorZfromAltitude(1,h._center.lat)*h.worldSize,l=Math.ceil(2*this._accuracy*r);this._circleElement.style.width=`${l}px`,this._circleElement.style.height=`${l}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._dotElement.classList.add("mapboxgl-user-location-show-heading")):(this._dotElement.classList.remove("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(h){if(this._map){if(this.options.trackUserLocation)if(h.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const r=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",r),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",r),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(h.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new o.Event("error",h)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(h){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",r=>r.preventDefault()),this._geolocateButton=D("button","mapboxgl-ctrl-geolocate",this._container),D("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",h===!1){o.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const r=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",r),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",r)}else{const r=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",r),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",r)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=D("div","mapboxgl-user-location"),this._dotElement.appendChild(D("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(D("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new El({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=D("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new El({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",r=>{r.geolocateSource||this._watchState!=="ACTIVE_LOCK"||r.originalEvent&&r.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new o.Event("trackuserlocationend")))})}}_onDeviceOrientation(h){this._userLocationDotMarker&&(h.webkitCompassHeading?this._heading=h.webkitCompassHeading:h.absolute===!0&&(this._heading=-1*h.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return o.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new o.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new o.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new o.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let h;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(h={maximumAge:6e5,timeout:0},this._noTimeout=!0):(h=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,h),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const h=()=>{o.window.addEventListener("ondeviceorientationabsolute"in o.window?"deviceorientationabsolute":"deviceorientation",this._onDeviceOrientation)};o.window.DeviceMotionEvent!==void 0&&typeof o.window.DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(r=>{r==="granted"&&h()}).catch(console.error):h()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),o.window.removeEventListener("deviceorientation",this._onDeviceOrientation),o.window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:Eh,ScaleControl:class{constructor(h){this.options=o.extend({},jf,h),function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"narrow",unit:"meter"}),!0}catch{return!1}}()||(this._setScale=qf.bind(this)),o.bindAll(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const h=this.options.maxWidth||100,r=this._map,l=r._containerHeight/2,p=r._containerWidth/2-h/2,_=r.unproject([p,l]),x=r.unproject([p+h,l]),T=_.distanceTo(x);if(this.options.unit==="imperial"){const C=3.2808*T;C>5280?this._setScale(h,C/5280,"mile"):this._setScale(h,C,"foot")}else this.options.unit==="nautical"?this._setScale(h,T/1852,"nautical-mile"):T>=1e3?this._setScale(h,T/1e3,"kilometer"):this._setScale(h,T,"meter")}_setScale(h,r,l){const p=Ih(r),_=p/r;this._map._requestDomTask(()=>{this._container.style.width=h*_+"px",this._container.innerHTML=l!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"narrow",unit:l}).format(p):`${p}&nbsp;nm`})}onAdd(h){return this._map=h,this._language=h.getLanguage(),this._container=D("div","mapboxgl-ctrl mapboxgl-ctrl-scale",h.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(h){this._language=h,this._update()}setUnit(h){this.options.unit=h,this._update()}},FullscreenControl:class{constructor(h){this._fullscreen=!1,h&&h.container&&(h.container instanceof o.window.HTMLElement?this._container=h.container:o.warnOnce("Full screen control 'container' must be a DOM element.")),o.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in o.window.document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in o.window.document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(h){return this._map=h,this._container||(this._container=this._map.getContainer()),this._controlContainer=D("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",o.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,o.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!o.window.document.fullscreenEnabled&&!o.window.document.webkitFullscreenEnabled)}_setupUI(){const h=this._fullscreenButton=D("button","mapboxgl-ctrl-fullscreen",this._controlContainer);D("span","mapboxgl-ctrl-icon",h).setAttribute("aria-hidden","true"),h.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),o.window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const h=this._getTitle();this._fullscreenButton.setAttribute("aria-label",h),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",h)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(o.window.document.fullscreenElement||o.window.document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?o.window.document.exitFullscreen?o.window.document.exitFullscreen():o.window.document.webkitCancelFullScreen&&o.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends o.Evented{constructor(h){super(),this.options=o.extend(Object.create(Nc),h),o.bindAll(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(h&&h.className?h.className.trim().split(/\s+/):[])}addTo(h){return this._map&&this.remove(),this._map=h,this.options.closeOnClick&&h.on("preclick",this._onClose),this.options.closeOnMove&&h.on("move",this._onClose),h.on("remove",this.remove),this._update(),h._addPopup(this),this._focusFirstElement(),this._trackPointer?(h.on("mousemove",this._onMouseEvent),h.on("mouseup",this._onMouseEvent),h._canvasContainer.classList.add("mapboxgl-track-pointer")):h.on("move",this._update),this.fire(new o.Event("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const h=this._map;return h&&(h.off("move",this._update),h.off("move",this._onClose),h.off("preclick",this._onClose),h.off("click",this._onClose),h.off("remove",this.remove),h.off("mousemove",this._onMouseEvent),h.off("mouseup",this._onMouseEvent),h.off("drag",this._onMouseEvent),h._canvasContainer&&h._canvasContainer.classList.remove("mapboxgl-track-pointer"),h._removePopup(this),this._map=void 0),this.fire(new o.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(h){this._lngLat=o.LngLat.convert(h),this._pos=null,this._trackPointer=!1,this._update();const r=this._map;return r&&(r.on("move",this._update),r.off("mousemove",this._onMouseEvent),r._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const h=this._map;return h&&(h.off("move",this._update),h.on("mousemove",this._onMouseEvent),h.on("drag",this._onMouseEvent),h._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(h){return this.setDOMContent(o.window.document.createTextNode(h))}setHTML(h){const r=o.window.document.createDocumentFragment(),l=o.window.document.createElement("body");let p;for(l.innerHTML=h;p=l.firstChild,p;)r.appendChild(p);return this.setDOMContent(r)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(h){return this.options.maxWidth=h,this._update(),this}setDOMContent(h){let r=this._content;if(r)for(;r.hasChildNodes();)r.firstChild&&r.removeChild(r.firstChild);else r=this._content=D("div","mapboxgl-popup-content",this._container||void 0);if(r.appendChild(h),this.options.closeButton){const l=this._closeButton=D("button","mapboxgl-popup-close-button",r);l.type="button",l.setAttribute("aria-label","Close popup"),l.setAttribute("aria-hidden","true"),l.innerHTML="&#215;",l.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(h){return this._classList.add(h),this._updateClassList(),this}removeClassName(h){return this._classList.delete(h),this._updateClassList(),this}setOffset(h){return this.options.offset=h,this._update(),this}toggleClassName(h){let r;return this._classList.delete(h)?r=!1:(this._classList.add(h),r=!0),this._updateClassList(),r}_onMouseEvent(h){this._update(h.point)}_getAnchor(h){if(this.options.anchor)return this.options.anchor;const r=this._map,l=this._container,p=this._pos;if(!r||!l||!p)return"bottom";const _=l.offsetWidth,x=l.offsetHeight,T=p.x<_/2,C=p.x>r.transform.width-_/2;if(p.y+h<x)return T?"top-left":C?"top-right":"top";if(p.y>r.transform.height-x){if(T)return"bottom-left";if(C)return"bottom-right"}return T?"left":C?"right":"bottom"}_updateClassList(){const h=this._container;if(!h)return;const r=[...this._classList];r.push("mapboxgl-popup"),this._anchor&&r.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&r.push("mapboxgl-popup-track-pointer"),h.className=r.join(" ")}_update(h){const r=this._map,l=this._content;if(!r||!this._lngLat&&!this._trackPointer||!l)return;let p=this._container;if(p||(p=this._container=D("div","mapboxgl-popup",r.getContainer()),this._tip=D("div","mapboxgl-popup-tip",p),p.appendChild(l)),this.options.maxWidth&&p.style.maxWidth!==this.options.maxWidth&&(p.style.maxWidth=this.options.maxWidth),r.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Ch(this._lngLat,this._pos,r.transform)),!this._trackPointer||h){const _=this._pos=this._trackPointer&&h?h:r.project(this._lngLat),x=Ah(this.options.offset),T=this._anchor=this._getAnchor(x.y),C=Ah(this.options.offset,T),M=_.add(C).round();r._requestDomTask(()=>{this._container&&T&&(this._container.style.transform=`${va[T]} translate(${M.x}px,${M.y}px)`)})}if(!this._marker&&r._showingGlobe()){const _=o.isLngLatBehindGlobe(r.transform,this._lngLat)?0:1;this._setOpacity(_)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const h=this._container.querySelector(Of);h&&h.focus()}_onClose(){this.remove()}_setOpacity(h){this._container&&(this._container.style.opacity=`${h}`),this._content&&(this._content.style.pointerEvents=h?"auto":"none")}},Marker:El,Style:rr,LngLat:o.LngLat,LngLatBounds:o.LngLatBounds,Point:o.pointGeometry,MercatorCoordinate:o.MercatorCoordinate,FreeCameraOptions:ph,Evented:o.Evented,config:o.config,prewarm:function(){fn().acquire(an)},clearPrewarmedResources:function(){const h=rn;h&&(h.isPreloaded()&&h.numActive()===1?(h.release(an),rn=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return o.config.ACCESS_TOKEN},set accessToken(h){o.config.ACCESS_TOKEN=h},get baseApiUrl(){return o.config.API_URL},set baseApiUrl(h){o.config.API_URL=h},get workerCount(){return on.workerCount},set workerCount(h){on.workerCount=h},get maxParallelImageRequests(){return o.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(h){o.config.MAX_PARALLEL_IMAGE_REQUESTS=h},clearStorage(h){o.clearTileCache(h)},workerUrl:"",workerClass:null,setNow:o.exported.setNow,restoreNow:o.exported.restoreNow};return Tl});var b=m;return b})})(OS);const ta=OS.exports;var qu=iD,nD=Object.prototype.hasOwnProperty;function iD(){for(var e={},s=0;s<arguments.length;s++){var u=arguments[s];for(var f in u)nD.call(u,f)&&(e[f]=u[f])}return e}var FS={exports:{}};(function(e,s){(function(){var u={};e.exports=u,u.simpleFilter=function(f,m){return m.filter(function(v){return u.test(f,v)})},u.test=function(f,m){return u.match(f,m)!==null},u.match=function(f,m,v){v=v||{};var b=0,o=[],S=m.length,k=0,I=0,L=v.pre||"",D=v.post||"",N=v.caseSensitive&&m||m.toLowerCase(),j;f=v.caseSensitive&&f||f.toLowerCase();for(var Z=0;Z<S;Z++)j=m[Z],N[Z]===f[b]?(j=L+j+D,b+=1,I+=1+I):I=0,k+=I,o[o.length]=j;return b===f.length?(k=N===f?1/0:k,{rendered:o.join(""),score:k}):null},u.filter=function(f,m,v){return!m||m.length===0?[]:typeof f!="string"?m:(v=v||{},m.reduce(function(b,o,S,k){var I=o;v.extract&&(I=v.extract(o));var L=u.match(f,I,v);return L!=null&&(b[b.length]={string:L.rendered,score:L.score,index:S,original:o}),b},[]).sort(function(b,o){var S=o.score-b.score;return S||b.index-o.index}))}})()})(FS);var oo=function(e){return this.component=e,this.items=[],this.active=0,this.wrapper=document.createElement("div"),this.wrapper.className="suggestions-wrapper",this.element=document.createElement("ul"),this.element.className="suggestions",this.wrapper.appendChild(this.element),this.selectingListItem=!1,e.el.parentNode.insertBefore(this.wrapper,e.el.nextSibling),this};oo.prototype.show=function(){this.element.style.display="block"};oo.prototype.hide=function(){this.element.style.display="none"};oo.prototype.add=function(e){this.items.push(e)};oo.prototype.clear=function(){this.items=[],this.active=0};oo.prototype.isEmpty=function(){return!this.items.length};oo.prototype.isVisible=function(){return this.element.style.display==="block"};oo.prototype.draw=function(){if(this.element.innerHTML="",this.items.length===0){this.hide();return}for(var e=0;e<this.items.length;e++)this.drawItem(this.items[e],this.active===e);this.show()};oo.prototype.drawItem=function(e,s){var u=document.createElement("li"),f=document.createElement("a");s&&(u.className+=" active"),f.innerHTML=e.string,u.appendChild(f),this.element.appendChild(u),u.addEventListener("mousedown",function(){this.selectingListItem=!0}.bind(this)),u.addEventListener("mouseup",function(){this.handleMouseUp.call(this,e)}.bind(this))};oo.prototype.handleMouseUp=function(e){this.selectingListItem=!1,this.component.value(e.original),this.clear(),this.draw()};oo.prototype.move=function(e){this.active=e,this.draw()};oo.prototype.previous=function(){this.move(this.active===0?this.items.length-1:this.active-1)};oo.prototype.next=function(){this.move(this.active===this.items.length-1?0:this.active+1)};oo.prototype.drawError=function(e){var s=document.createElement("li");s.innerHTML=e,this.element.appendChild(s),this.show()};var rD=oo,oD=qu,sD=FS.exports,aD=rD,jr=function(e,s,u){return u=u||{},this.options=oD({minLength:2,limit:5,filter:!0,hideOnBlur:!0},u),this.el=e,this.data=s||[],this.list=new aD(this),this.query="",this.selected=null,this.list.draw(),this.el.addEventListener("keyup",function(f){this.handleKeyUp(f.keyCode)}.bind(this),!1),this.el.addEventListener("keydown",function(f){this.handleKeyDown(f)}.bind(this)),this.el.addEventListener("focus",function(){this.handleFocus()}.bind(this)),this.el.addEventListener("blur",function(){this.handleBlur()}.bind(this)),this.el.addEventListener("paste",function(f){this.handlePaste(f)}.bind(this)),this.render=this.options.render?this.options.render.bind(this):this.render.bind(this),this.getItemValue=this.options.getItemValue?this.options.getItemValue.bind(this):this.getItemValue.bind(this),this};jr.prototype.handleKeyUp=function(e){e===40||e===38||e===27||e===13||e===9||this.handleInputChange(this.el.value)};jr.prototype.handleKeyDown=function(e){switch(e.keyCode){case 13:case 9:this.list.isEmpty()||(this.list.isVisible()&&e.preventDefault(),this.value(this.list.items[this.list.active].original),this.list.hide());break;case 27:this.list.isEmpty()||this.list.hide();break;case 38:this.list.previous();break;case 40:this.list.next();break}};jr.prototype.handleBlur=function(){!this.list.selectingListItem&&this.options.hideOnBlur&&this.list.hide()};jr.prototype.handlePaste=function(e){if(e.clipboardData)this.handleInputChange(e.clipboardData.getData("Text"));else{var s=this;setTimeout(function(){s.handleInputChange(e.target.value)},100)}};jr.prototype.handleInputChange=function(e){if(this.query=this.normalize(e),this.list.clear(),this.query.length<this.options.minLength){this.list.draw();return}this.getCandidates(function(s){for(var u=0;u<s.length&&(this.list.add(s[u]),u!==this.options.limit-1);u++);this.list.draw()}.bind(this))};jr.prototype.handleFocus=function(){this.list.isEmpty()||this.list.show(),this.list.selectingListItem=!1};jr.prototype.update=function(e){this.data=e,this.handleKeyUp()};jr.prototype.clear=function(){this.data=[],this.list.clear()};jr.prototype.normalize=function(e){return e=e.toLowerCase(),e};jr.prototype.match=function(e,s){return e.indexOf(s)>-1};jr.prototype.value=function(e){if(this.selected=e,this.el.value=this.getItemValue(e),document.createEvent){var s=document.createEvent("HTMLEvents");s.initEvent("change",!0,!1),this.el.dispatchEvent(s)}else this.el.fireEvent("onchange")};jr.prototype.getCandidates=function(e){var s={pre:"<strong>",post:"</strong>",extract:function(f){return this.getItemValue(f)}.bind(this)},u;this.options.filter?(u=sD.filter(this.query,this.data,s),u=u.map(function(f){return{original:f.original,string:this.render(f.original,f.string)}}.bind(this))):u=this.data.map(function(f){var m=this.render(f);return{original:f,string:m}}.bind(this)),e(u)};jr.prototype.getItemValue=function(e){return e};jr.prototype.render=function(e,s){if(s)return s;for(var u=e.original?this.getItemValue(e.original):this.getItemValue(e),f=this.normalize(u),m=f.lastIndexOf(this.query);m>-1;){var v=m+this.query.length;u=u.slice(0,m)+"<strong>"+u.slice(m,v)+"</strong>"+u.slice(v),m=f.slice(0,m).lastIndexOf(this.query)}return u};jr.prototype.renderError=function(e){this.list.drawError(e)};var lD=jr,NS=lD,cD=NS;typeof window<"u"&&(window.Suggestions=NS);var uD="Expected a function",bw=0/0,hD="[object Symbol]",dD=/^\s+|\s+$/g,fD=/^[-+]0x[0-9a-f]+$/i,pD=/^0b[01]+$/i,mD=/^0o[0-7]+$/i,gD=parseInt,_D=typeof Jo=="object"&&Jo&&Jo.Object===Object&&Jo,yD=typeof self=="object"&&self&&self.Object===Object&&self,vD=_D||yD||Function("return this")(),xD=Object.prototype,bD=xD.toString,wD=Math.max,ED=Math.min,ty=function(){return vD.Date.now()};function TD(e,s,u){var f,m,v,b,o,S,k=0,I=!1,L=!1,D=!0;if(typeof e!="function")throw new TypeError(uD);s=ww(s)||0,$y(u)&&(I=!!u.leading,L="maxWait"in u,v=L?wD(ww(u.maxWait)||0,s):v,D="trailing"in u?!!u.trailing:D);function N(pe){var Te=f,Me=m;return f=m=void 0,k=pe,b=e.apply(Me,Te),b}function j(pe){return k=pe,o=setTimeout(fe,s),I?N(pe):b}function Z(pe){var Te=pe-S,Me=pe-k,Ie=s-Te;return L?ED(Ie,v-Me):Ie}function K(pe){var Te=pe-S,Me=pe-k;return S===void 0||Te>=s||Te<0||L&&Me>=v}function fe(){var pe=ty();if(K(pe))return te(pe);o=setTimeout(fe,Z(pe))}function te(pe){return o=void 0,D&&f?N(pe):(f=m=void 0,b)}function ve(){o!==void 0&&clearTimeout(o),k=0,f=S=m=o=void 0}function Ce(){return o===void 0?b:te(ty())}function ce(){var pe=ty(),Te=K(pe);if(f=arguments,m=this,S=pe,Te){if(o===void 0)return j(S);if(L)return o=setTimeout(fe,s),N(S)}return o===void 0&&(o=setTimeout(fe,s)),b}return ce.cancel=ve,ce.flush=Ce,ce}function $y(e){var s=typeof e;return!!e&&(s=="object"||s=="function")}function SD(e){return!!e&&typeof e=="object"}function CD(e){return typeof e=="symbol"||SD(e)&&bD.call(e)==hD}function ww(e){if(typeof e=="number")return e;if(CD(e))return bw;if($y(e)){var s=typeof e.valueOf=="function"?e.valueOf():e;e=$y(s)?s+"":s}if(typeof e!="string")return e===0?e:+e;e=e.replace(dD,"");var u=pD.test(e);return u||mD.test(e)?gD(e.slice(2),u?2:8):fD.test(e)?bw:+e}var AD=TD,Gv={exports:{}},Eu=typeof Reflect=="object"?Reflect:null,Ew=Eu&&typeof Eu.apply=="function"?Eu.apply:function(s,u,f){return Function.prototype.apply.call(s,u,f)},im;Eu&&typeof Eu.ownKeys=="function"?im=Eu.ownKeys:Object.getOwnPropertySymbols?im=function(s){return Object.getOwnPropertyNames(s).concat(Object.getOwnPropertySymbols(s))}:im=function(s){return Object.getOwnPropertyNames(s)};function MD(e){console&&console.warn&&console.warn(e)}var VS=Number.isNaN||function(s){return s!==s};function wi(){wi.init.call(this)}Gv.exports=wi;Gv.exports.once=zD;wi.EventEmitter=wi;wi.prototype._events=void 0;wi.prototype._eventsCount=0;wi.prototype._maxListeners=void 0;var Tw=10;function ig(e){if(typeof e!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}Object.defineProperty(wi,"defaultMaxListeners",{enumerable:!0,get:function(){return Tw},set:function(e){if(typeof e!="number"||e<0||VS(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");Tw=e}});wi.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};wi.prototype.setMaxListeners=function(s){if(typeof s!="number"||s<0||VS(s))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+s+".");return this._maxListeners=s,this};function US(e){return e._maxListeners===void 0?wi.defaultMaxListeners:e._maxListeners}wi.prototype.getMaxListeners=function(){return US(this)};wi.prototype.emit=function(s){for(var u=[],f=1;f<arguments.length;f++)u.push(arguments[f]);var m=s==="error",v=this._events;if(v!==void 0)m=m&&v.error===void 0;else if(!m)return!1;if(m){var b;if(u.length>0&&(b=u[0]),b instanceof Error)throw b;var o=new Error("Unhandled error."+(b?" ("+b.message+")":""));throw o.context=b,o}var S=v[s];if(S===void 0)return!1;if(typeof S=="function")Ew(S,this,u);else for(var k=S.length,I=ZS(S,k),f=0;f<k;++f)Ew(I[f],this,u);return!0};function jS(e,s,u,f){var m,v,b;if(ig(u),v=e._events,v===void 0?(v=e._events=Object.create(null),e._eventsCount=0):(v.newListener!==void 0&&(e.emit("newListener",s,u.listener?u.listener:u),v=e._events),b=v[s]),b===void 0)b=v[s]=u,++e._eventsCount;else if(typeof b=="function"?b=v[s]=f?[u,b]:[b,u]:f?b.unshift(u):b.push(u),m=US(e),m>0&&b.length>m&&!b.warned){b.warned=!0;var o=new Error("Possible EventEmitter memory leak detected. "+b.length+" "+String(s)+" listeners added. Use emitter.setMaxListeners() to increase limit");o.name="MaxListenersExceededWarning",o.emitter=e,o.type=s,o.count=b.length,MD(o)}return e}wi.prototype.addListener=function(s,u){return jS(this,s,u,!1)};wi.prototype.on=wi.prototype.addListener;wi.prototype.prependListener=function(s,u){return jS(this,s,u,!0)};function ID(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function qS(e,s,u){var f={fired:!1,wrapFn:void 0,target:e,type:s,listener:u},m=ID.bind(f);return m.listener=u,f.wrapFn=m,m}wi.prototype.once=function(s,u){return ig(u),this.on(s,qS(this,s,u)),this};wi.prototype.prependOnceListener=function(s,u){return ig(u),this.prependListener(s,qS(this,s,u)),this};wi.prototype.removeListener=function(s,u){var f,m,v,b,o;if(ig(u),m=this._events,m===void 0)return this;if(f=m[s],f===void 0)return this;if(f===u||f.listener===u)--this._eventsCount===0?this._events=Object.create(null):(delete m[s],m.removeListener&&this.emit("removeListener",s,f.listener||u));else if(typeof f!="function"){for(v=-1,b=f.length-1;b>=0;b--)if(f[b]===u||f[b].listener===u){o=f[b].listener,v=b;break}if(v<0)return this;v===0?f.shift():kD(f,v),f.length===1&&(m[s]=f[0]),m.removeListener!==void 0&&this.emit("removeListener",s,o||u)}return this};wi.prototype.off=wi.prototype.removeListener;wi.prototype.removeAllListeners=function(s){var u,f,m;if(f=this._events,f===void 0)return this;if(f.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):f[s]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete f[s]),this;if(arguments.length===0){var v=Object.keys(f),b;for(m=0;m<v.length;++m)b=v[m],b!=="removeListener"&&this.removeAllListeners(b);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(u=f[s],typeof u=="function")this.removeListener(s,u);else if(u!==void 0)for(m=u.length-1;m>=0;m--)this.removeListener(s,u[m]);return this};function $S(e,s,u){var f=e._events;if(f===void 0)return[];var m=f[s];return m===void 0?[]:typeof m=="function"?u?[m.listener||m]:[m]:u?PD(m):ZS(m,m.length)}wi.prototype.listeners=function(s){return $S(this,s,!0)};wi.prototype.rawListeners=function(s){return $S(this,s,!1)};wi.listenerCount=function(e,s){return typeof e.listenerCount=="function"?e.listenerCount(s):GS.call(e,s)};wi.prototype.listenerCount=GS;function GS(e){var s=this._events;if(s!==void 0){var u=s[e];if(typeof u=="function")return 1;if(u!==void 0)return u.length}return 0}wi.prototype.eventNames=function(){return this._eventsCount>0?im(this._events):[]};function ZS(e,s){for(var u=new Array(s),f=0;f<s;++f)u[f]=e[f];return u}function kD(e,s){for(;s+1<e.length;s++)e[s]=e[s+1];e.pop()}function PD(e){for(var s=new Array(e.length),u=0;u<s.length;++u)s[u]=e[u].listener||e[u];return s}function zD(e,s){return new Promise(function(u,f){function m(b){e.removeListener(s,v),f(b)}function v(){typeof e.removeListener=="function"&&e.removeListener("error",m),u([].slice.call(arguments))}WS(e,s,v,{once:!0}),s!=="error"&&LD(e,m,{once:!0})})}function LD(e,s,u){typeof e.on=="function"&&WS(e,"error",s,u)}function WS(e,s,u,f){if(typeof e.on=="function")f.once?e.once(s,u):e.on(s,u);else if(typeof e.addEventListener=="function")e.addEventListener(s,function m(v){f.once&&e.removeEventListener(s,m),u(v)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof e)}var RD={fr:{name:"France",bbox:[[-4.59235,41.380007],[9.560016,51.148506]]},us:{name:"United States",bbox:[[-171.791111,18.91619],[-66.96466,71.357764]]},ru:{name:"Russia",bbox:[[19.66064,41.151416],[190.10042,81.2504]]},ca:{name:"Canada",bbox:[[-140.99778,41.675105],[-52.648099,83.23324]]}};function DD(e){var s=e.match(/\s*(.+)\s*=\s*"?([^"]+)"?/);return s?{key:s[1],value:s[2]}:null}function OD(e){var s=e.match(/<?([^>]*)>(.*)/);if(!s)return null;var u=s[1],f=s[2].split(";"),m=null,v=f.reduce(function(b,o){var S=DD(o);return S?S.key==="rel"?(m||(m=S.value),b):(b[S.key]=S.value,b):b},{});return m?{url:u,rel:m,params:v}:null}function BD(e){return e?e.split(/,\s*</).reduce(function(s,u){var f=OD(u);if(!f)return s;var m=f.rel.split(/\s+/);return m.forEach(function(v){s[v]||(s[v]={url:f.url,params:f.params})}),s},{}):{}}var FD=BD,ND=FD;function Zv(e,s){this.request=e,this.headers=s.headers,this.rawBody=s.body,this.statusCode=s.statusCode;try{this.body=JSON.parse(s.body||"{}")}catch{this.body=s.body}this.links=ND(this.headers.link)}Zv.prototype.hasNextPage=function(){return!!this.links.next};Zv.prototype.nextPage=function(){return this.hasNextPage()?this.request._extend({path:this.links.next.url}):null};var VD=Zv,rg={API_ORIGIN:"https://api.mapbox.com",EVENT_PROGRESS_DOWNLOAD:"downloadProgress",EVENT_PROGRESS_UPLOAD:"uploadProgress",EVENT_ERROR:"error",EVENT_RESPONSE:"response",ERROR_HTTP:"HttpError",ERROR_REQUEST_ABORTED:"RequestAbortedError"},Sw=rg;function UD(e){var s=e.type||Sw.ERROR_HTTP,u;if(e.body)try{u=JSON.parse(e.body)}catch{u=e.body}else u=null;var f=e.message||null;f||(typeof u=="string"?f=u:u&&typeof u.message=="string"?f=u.message:s===Sw.ERROR_REQUEST_ABORTED&&(f="Request aborted")),this.message=f,this.type=s,this.statusCode=e.statusCode||null,this.request=e.request,this.body=u}var jD=UD;function qD(e){var s=e.indexOf(":"),u=e.substring(0,s).trim().toLowerCase(),f=e.substring(s+1).trim();return{name:u,value:f}}function $D(e){var s={};return e&&e.trim().split(/[\r|\n]+/).forEach(function(u){var f=qD(u);s[f.name]=f.value}),s}var GD=$D,ZD=VD,Cw=jD,ny=rg,WD=GD,Em={};function HD(e){var s=Em[e.id];!s||(s.abort(),delete Em[e.id])}function XD(e,s){return new ZD(e,{body:s.response,headers:WD(s.getAllResponseHeaders()),statusCode:s.status})}function Aw(e){var s=e.total,u=e.loaded,f=100*u/s;return{total:s,transferred:u,percent:f}}function HS(e,s){return new Promise(function(u,f){s.onprogress=function(b){e.emitter.emit(ny.EVENT_PROGRESS_DOWNLOAD,Aw(b))};var m=e.file;m&&(s.upload.onprogress=function(b){e.emitter.emit(ny.EVENT_PROGRESS_UPLOAD,Aw(b))}),s.onerror=function(b){f(b)},s.onabort=function(){var b=new Cw({request:e,type:ny.ERROR_REQUEST_ABORTED});f(b)},s.onload=function(){if(delete Em[e.id],s.status<200||s.status>=400){var b=new Cw({request:e,body:s.response,statusCode:s.status});f(b);return}u(s)};var v=e.body;typeof v=="string"?s.send(v):v?s.send(JSON.stringify(v)):m?s.send(m):s.send(),Em[e.id]=s}).then(function(u){return XD(e,u)})}function XS(e,s){var u=e.url(s),f=new window.XMLHttpRequest;return f.open(e.method,u),Object.keys(e.headers).forEach(function(m){f.setRequestHeader(m,e.headers[m])}),f}function KD(e){return Promise.resolve().then(function(){var s=XS(e,e.client.accessToken);return HS(e,s)})}var YD={browserAbort:HD,sendRequestXhr:HS,browserSend:KD,createRequestXhr:XS},Gy={exports:{}};/*! http://mths.be/base64 v0.1.0 by @mathias | MIT license */(function(e,s){(function(u){var f=s,m=e&&e.exports==f&&e,v=typeof Jo=="object"&&Jo;(v.global===v||v.window===v)&&(u=v);var b=function(j){this.message=j};b.prototype=new Error,b.prototype.name="InvalidCharacterError";var o=function(j){throw new b(j)},S="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",k=/[\t\n\f\r ]/g,I=function(j){j=String(j).replace(k,"");var Z=j.length;Z%4==0&&(j=j.replace(/==?$/,""),Z=j.length),(Z%4==1||/[^+a-zA-Z0-9/]/.test(j))&&o("Invalid character: the string to be decoded is not correctly encoded.");for(var K=0,fe,te,ve="",Ce=-1;++Ce<Z;)te=S.indexOf(j.charAt(Ce)),fe=K%4?fe*64+te:te,K++%4&&(ve+=String.fromCharCode(255&fe>>(-2*K&6)));return ve},L=function(j){j=String(j),/[^\0-\xFF]/.test(j)&&o("The string to be encoded contains characters outside of the Latin1 range.");for(var Z=j.length%3,K="",fe=-1,te,ve,Ce,ce,pe=j.length-Z;++fe<pe;)te=j.charCodeAt(fe)<<16,ve=j.charCodeAt(++fe)<<8,Ce=j.charCodeAt(++fe),ce=te+ve+Ce,K+=S.charAt(ce>>18&63)+S.charAt(ce>>12&63)+S.charAt(ce>>6&63)+S.charAt(ce&63);return Z==2?(te=j.charCodeAt(fe)<<8,ve=j.charCodeAt(++fe),ce=te+ve,K+=S.charAt(ce>>10)+S.charAt(ce>>4&63)+S.charAt(ce<<2&63)+"="):Z==1&&(ce=j.charCodeAt(fe),K+=S.charAt(ce>>2)+S.charAt(ce<<4&63)+"=="),K},D={encode:L,decode:I,version:"0.1.0"};if(f&&!f.nodeType)if(m)m.exports=D;else for(var N in D)D.hasOwnProperty(N)&&(f[N]=D[N]);else u.base64=D})(Jo)})(Gy,Gy.exports);var QD=Gy.exports,iy={};function JD(e){if(iy[e])return iy[e];var s=e.split("."),u=s[0],f=s[1];if(!f)throw new Error("Invalid token");var m=eO(f),v={usage:u,user:m.u};return jl(m,"a")&&(v.authorization=m.a),jl(m,"exp")&&(v.expires=m.exp*1e3),jl(m,"iat")&&(v.created=m.iat*1e3),jl(m,"scopes")&&(v.scopes=m.scopes),jl(m,"client")&&(v.client=m.client),jl(m,"ll")&&(v.lastLogin=m.ll),jl(m,"iu")&&(v.impersonator=m.iu),iy[e]=v,v}function eO(e){try{return JSON.parse(QD.decode(e))}catch{throw new Error("Invalid token")}}function jl(e,s){return Object.prototype.hasOwnProperty.call(e,s)}var KS=JD,YS={exports:{}};(function(e){var s=Object.prototype.hasOwnProperty,u="~";function f(){}Object.create&&(f.prototype=Object.create(null),new f().__proto__||(u=!1));function m(S,k,I){this.fn=S,this.context=k,this.once=I||!1}function v(S,k,I,L,D){if(typeof I!="function")throw new TypeError("The listener must be a function");var N=new m(I,L||S,D),j=u?u+k:k;return S._events[j]?S._events[j].fn?S._events[j]=[S._events[j],N]:S._events[j].push(N):(S._events[j]=N,S._eventsCount++),S}function b(S,k){--S._eventsCount===0?S._events=new f:delete S._events[k]}function o(){this._events=new f,this._eventsCount=0}o.prototype.eventNames=function(){var k=[],I,L;if(this._eventsCount===0)return k;for(L in I=this._events)s.call(I,L)&&k.push(u?L.slice(1):L);return Object.getOwnPropertySymbols?k.concat(Object.getOwnPropertySymbols(I)):k},o.prototype.listeners=function(k){var I=u?u+k:k,L=this._events[I];if(!L)return[];if(L.fn)return[L.fn];for(var D=0,N=L.length,j=new Array(N);D<N;D++)j[D]=L[D].fn;return j},o.prototype.listenerCount=function(k){var I=u?u+k:k,L=this._events[I];return L?L.fn?1:L.length:0},o.prototype.emit=function(k,I,L,D,N,j){var Z=u?u+k:k;if(!this._events[Z])return!1;var K=this._events[Z],fe=arguments.length,te,ve;if(K.fn){switch(K.once&&this.removeListener(k,K.fn,void 0,!0),fe){case 1:return K.fn.call(K.context),!0;case 2:return K.fn.call(K.context,I),!0;case 3:return K.fn.call(K.context,I,L),!0;case 4:return K.fn.call(K.context,I,L,D),!0;case 5:return K.fn.call(K.context,I,L,D,N),!0;case 6:return K.fn.call(K.context,I,L,D,N,j),!0}for(ve=1,te=new Array(fe-1);ve<fe;ve++)te[ve-1]=arguments[ve];K.fn.apply(K.context,te)}else{var Ce=K.length,ce;for(ve=0;ve<Ce;ve++)switch(K[ve].once&&this.removeListener(k,K[ve].fn,void 0,!0),fe){case 1:K[ve].fn.call(K[ve].context);break;case 2:K[ve].fn.call(K[ve].context,I);break;case 3:K[ve].fn.call(K[ve].context,I,L);break;case 4:K[ve].fn.call(K[ve].context,I,L,D);break;default:if(!te)for(ce=1,te=new Array(fe-1);ce<fe;ce++)te[ce-1]=arguments[ce];K[ve].fn.apply(K[ve].context,te)}}return!0},o.prototype.on=function(k,I,L){return v(this,k,I,L,!1)},o.prototype.once=function(k,I,L){return v(this,k,I,L,!0)},o.prototype.removeListener=function(k,I,L,D){var N=u?u+k:k;if(!this._events[N])return this;if(!I)return b(this,N),this;var j=this._events[N];if(j.fn)j.fn===I&&(!D||j.once)&&(!L||j.context===L)&&b(this,N);else{for(var Z=0,K=[],fe=j.length;Z<fe;Z++)(j[Z].fn!==I||D&&!j[Z].once||L&&j[Z].context!==L)&&K.push(j[Z]);K.length?this._events[N]=K.length===1?K[0]:K:b(this,N)}return this},o.prototype.removeAllListeners=function(k){var I;return k?(I=u?u+k:k,this._events[I]&&b(this,I)):(this._events=new f,this._eventsCount=0),this},o.prototype.off=o.prototype.removeListener,o.prototype.addListener=o.prototype.on,o.prefixed=u,o.EventEmitter=o,e.exports=o})(YS);function tO(e){return e.map(encodeURIComponent).join(",")}function QS(e){return Array.isArray(e)?tO(e):encodeURIComponent(String(e))}function JS(e,s,u){if(u===!1||u===null)return e;var f=/\?/.test(e)?"&":"?",m=encodeURIComponent(s);return u!==void 0&&u!==""&&u!==!0&&(m+="="+QS(u)),""+e+f+m}function nO(e,s){if(!s)return e;var u=e;return Object.keys(s).forEach(function(f){var m=s[f];m!==void 0&&(Array.isArray(m)&&(m=m.filter(function(v){return v!=null}).join(",")),u=JS(u,f,m))}),u}function iO(e,s){if(!s||e.slice(0,4)==="http")return e;var u=e[0]==="/"?"":"/";return""+s.replace(/\/$/,"")+u+e}function rO(e,s){return s?e.replace(/\/:([a-zA-Z0-9]+)/g,function(u,f){var m=s[f];if(m===void 0)throw new Error("Unspecified route parameter "+f);var v=QS(m);return"/"+v}):e}var oO={appendQueryObject:nO,appendQueryParam:JS,prependOrigin:iO,interpolateRouteParams:rO},sO=KS,Wv=qu,aO=YS.exports,Fp=oO,Mw=rg,lO=1;function Xa(e,s){if(!e)throw new Error("MapiRequest requires a client");if(!s||!s.path||!s.method)throw new Error("MapiRequest requires an options object with path and method properties");var u={};s.body&&(u["content-type"]="application/json");var f=Wv(u,s.headers),m=Object.keys(f).reduce(function(v,b){return v[b.toLowerCase()]=f[b],v},{});this.id=lO++,this._options=s,this.emitter=new aO,this.client=e,this.response=null,this.error=null,this.sent=!1,this.aborted=!1,this.path=s.path,this.method=s.method,this.origin=s.origin||e.origin,this.query=s.query||{},this.params=s.params||{},this.body=s.body||null,this.file=s.file||null,this.encoding=s.encoding||"utf8",this.sendFileAs=s.sendFileAs||null,this.headers=m}Xa.prototype.url=function(s){var u=Fp.prependOrigin(this.path,this.origin);u=Fp.appendQueryObject(u,this.query);var f=this.params,m=s==null?this.client.accessToken:s;if(m){u=Fp.appendQueryParam(u,"access_token",m);var v=sO(m).user;f=Wv({ownerId:v},f)}return u=Fp.interpolateRouteParams(u,f),u};Xa.prototype.send=function(){var s=this;if(s.sent)throw new Error("This request has already been sent. Check the response and error properties. Create a new request with clone().");return s.sent=!0,s.client.sendRequest(s).then(function(u){return s.response=u,s.emitter.emit(Mw.EVENT_RESPONSE,u),u},function(u){throw s.error=u,s.emitter.emit(Mw.EVENT_ERROR,u),u})};Xa.prototype.abort=function(){this._nextPageRequest&&(this._nextPageRequest.abort(),delete this._nextPageRequest),!(this.response||this.error||this.aborted)&&(this.aborted=!0,this.client.abortRequest(this))};Xa.prototype.eachPage=function(s){var u=this;function f(b){function o(){delete u._nextPageRequest;var S=b.nextPage();S&&(u._nextPageRequest=S,v(S))}s(null,b,o)}function m(b){s(b,null,function(){})}function v(b){b.send().then(f,m)}v(this)};Xa.prototype.clone=function(){return this._extend()};Xa.prototype._extend=function(s){var u=Wv(this._options,s);return new Xa(this.client,u)};var cO=Xa,uO=KS,hO=cO,dO=rg;function e2(e){if(!e||!e.accessToken)throw new Error("Cannot create a client without an access token");uO(e.accessToken),this.accessToken=e.accessToken,this.origin=e.origin||dO.API_ORIGIN}e2.prototype.createRequest=function(s){return new hO(this,s)};var t2=e2,n2=YD,i2=t2;function Du(e){i2.call(this,e)}Du.prototype=Object.create(i2.prototype);Du.prototype.constructor=Du;Du.prototype.sendRequest=n2.browserSend;Du.prototype.abortRequest=n2.browserAbort;function fO(e){return new Du(e)}var r2=fO,pO=r2,mO=pO,gO=Object.prototype.toString,_O=function(e){var s;return gO.call(e)==="[object Object]"&&(s=Object.getPrototypeOf(e),s===null||s===Object.getPrototypeOf({}))},yO=_O,vO=qu,o2="value",ry=`
  `,Mi={};Mi.assert=function(e,s){return s=s||{},function(u){var f=Ka(e,u);if(!!f){var m=Hv(f,s);throw s.apiName&&(m=s.apiName+": "+m),new Error(m)}}};Mi.shape=function(s){var u=EO(s);return function(m){var v=Ka(Mi.plainObject,m);if(v)return v;for(var b,o,S=[],k=0;k<u.length;k++)b=u[k].key,o=u[k].value,v=Ka(o,m[b]),v&&S.push([b].concat(v));return S.length<2?S[0]:function(I){S=S.map(function(N){var j=N[0],Z=Hv(N,I).split(`
`).join(ry);return"- "+j+": "+Z});var L=I.path.join("."),D=L===o2?"":" of "+L;return"The following properties"+D+" have invalid values:"+ry+S.join(ry)}}};Mi.strictShape=function(s){var u=Mi.shape(s);return function(m){var v=u(m);if(v)return v;var b=Object.keys(m).reduce(function(o,S){return s[S]===void 0&&o.push(S),o},[]);if(b.length!==0)return function(){return"The following keys are invalid: "+b.join(", ")}}};Mi.arrayOf=function(s){return s2(s)};Mi.tuple=function(){var s=Array.isArray(arguments[0])?arguments[0]:Array.prototype.slice.call(arguments);return s2(s)};function s2(e){var s=Array.isArray(e),u=function(f){return s?e[f]:e};return function(m){var v=Ka(Mi.plainArray,m);if(v)return v;if(s&&m.length!==e.length)return"an array with "+e.length+" items";for(var b=0;b<m.length;b++)if(v=Ka(u(b),m[b]),v)return[b].concat(v)}}Mi.required=function(s){function u(f){return f==null?function(m){return a2(m,l2(m.path)?"cannot be undefined/null.":"is required.")}:s.apply(this,arguments)}return u.__required=!0,u};Mi.oneOfType=function(){var s=Array.isArray(arguments[0])?arguments[0]:Array.prototype.slice.call(arguments);return function(f){var m=s.map(function(v){return Ka(v,f)}).filter(Boolean);if(m.length===s.length)return m.every(function(v){return v.length===1&&typeof v[0]=="string"})?xO(m.map(function(v){return v[0]})):m.reduce(function(v,b){return b.length>v.length?b:v})}};Mi.equal=function(s){return function(f){if(f!==s)return JSON.stringify(s)}};Mi.oneOf=function(){var s=Array.isArray(arguments[0])?arguments[0]:Array.prototype.slice.call(arguments),u=s.map(function(f){return Mi.equal(f)});return Mi.oneOfType.apply(this,u)};Mi.range=function(s){var u=s[0],f=s[1];return function(v){var b=Ka(Mi.number,v);if(b||v<u||v>f)return"number between "+u+" & "+f+" (inclusive)"}};Mi.any=function(){};Mi.boolean=function(s){if(typeof s!="boolean")return"boolean"};Mi.number=function(s){if(typeof s!="number")return"number"};Mi.plainArray=function(s){if(!Array.isArray(s))return"array"};Mi.plainObject=function(s){if(!yO(s))return"object"};Mi.string=function(s){if(typeof s!="string")return"string"};Mi.func=function(s){if(typeof s!="function")return"function"};function Ka(e,s){if(!(s==null&&!e.hasOwnProperty("__required"))){var u=e(s);if(u)return Array.isArray(u)?u:[u]}}function Hv(e,s){var u=e.length,f=e[u-1],m=e.slice(0,u-1);return m.length===0&&(m=[o2]),s=vO(s,{path:m}),typeof f=="function"?f(s):a2(s,bO(f))}function xO(e){return e.length<2?e[0]:e.length===2?e.join(" or "):e.slice(0,-1).join(", ")+", or "+e.slice(-1)}function bO(e){return"must be "+wO(e)+"."}function wO(e){return/^an? /.test(e)?e:/^[aeiou]/i.test(e)?"an "+e:/^[a-z]/i.test(e)?"a "+e:e}function a2(e,s){var u=l2(e.path),f=e.path.join(".")+" "+s,m=u?"Item at position ":"";return m+f}function l2(e){return typeof e[e.length-1]=="number"||typeof e[0]=="number"}function EO(e){return Object.keys(e||{}).map(function(s){return{key:s,value:e[s]}})}Mi.validate=Ka;Mi.processMessage=Hv;var TO=Mi,SO=qu,Tu=TO;function CO(e){if(typeof window<"u")return e instanceof Jo.Blob||e instanceof Jo.ArrayBuffer?void 0:"Blob or ArrayBuffer";if(!(typeof e=="string"||e.pipe!==void 0))return"Filename or Readable stream"}function AO(e,s){return Tu.assert(Tu.strictShape(e),s)}function MO(e){var s="date";if(typeof e=="boolean")return s;try{var u=new Date(e);if(u.getTime&&isNaN(u.getTime()))return s}catch{return s}}function IO(e){return Tu.tuple(Tu.number,Tu.number)(e)}var kO=SO(Tu,{file:CO,date:MO,coordinates:IO,assertShape:AO});function PO(e,s){var u=function(f,m){return s.indexOf(f)!==-1&&m!==void 0};return typeof s=="function"&&(u=s),Object.keys(e).filter(function(f){return u(f,e[f])}).reduce(function(f,m){return f[m]=e[m],f},{})}var zO=PO;function LO(e,s){return Object.keys(e).reduce(function(u,f){return u[f]=s(f,e[f]),u},{})}var RO=LO,DO=RO;function OO(e){return DO(e,function(s,u){return typeof u=="boolean"?JSON.stringify(u):u})}var BO=OO,FO=t2,NO=r2;function VO(e){return function(s){var u;FO.prototype.isPrototypeOf(s)?u=s:u=NO(s);var f=Object.create(e);return f.client=u,f}}var UO=VO,c2=qu,Qn=kO,Tm=zO,u2=BO,jO=UO,Xv={},h2=["country","region","postcode","district","place","locality","neighborhood","address","poi","poi.landmark"];Xv.forwardGeocode=function(e){Qn.assertShape({query:Qn.required(Qn.string),mode:Qn.oneOf("mapbox.places","mapbox.places-permanent"),countries:Qn.arrayOf(Qn.string),proximity:Qn.oneOf(Qn.coordinates,"ip"),types:Qn.arrayOf(Qn.oneOf(h2)),autocomplete:Qn.boolean,bbox:Qn.arrayOf(Qn.number),limit:Qn.number,language:Qn.arrayOf(Qn.string),routing:Qn.boolean,fuzzyMatch:Qn.boolean,worldview:Qn.string})(e),e.mode=e.mode||"mapbox.places";var s=u2(c2({country:e.countries},Tm(e,["proximity","types","autocomplete","bbox","limit","language","routing","fuzzyMatch","worldview"])));return this.client.createRequest({method:"GET",path:"/geocoding/v5/:mode/:query.json",params:Tm(e,["mode","query"]),query:s})};Xv.reverseGeocode=function(e){Qn.assertShape({query:Qn.required(Qn.coordinates),mode:Qn.oneOf("mapbox.places","mapbox.places-permanent"),countries:Qn.arrayOf(Qn.string),types:Qn.arrayOf(Qn.oneOf(h2)),bbox:Qn.arrayOf(Qn.number),limit:Qn.number,language:Qn.arrayOf(Qn.string),reverseMode:Qn.oneOf("distance","score"),routing:Qn.boolean,worldview:Qn.string})(e),e.mode=e.mode||"mapbox.places";var s=u2(c2({country:e.countries},Tm(e,["country","types","bbox","limit","language","reverseMode","routing","worldview"])));return this.client.createRequest({method:"GET",path:"/geocoding/v5/:mode/:query.json",params:Tm(e,["mode","query"]),query:s})};var qO=jO(Xv);let $O="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict",d2=e=>crypto.getRandomValues(new Uint8Array(e)),f2=(e,s,u)=>{let f=(2<<Math.log(e.length-1)/Math.LN2)-1,m=-~(1.6*f*s/e.length);return(v=s)=>{let b="";for(;;){let o=u(m),S=m;for(;S--;)if(b+=e[o[S]&f]||"",b.length===v)return b}}},GO=(e,s=21)=>f2(e,s,d2),ZO=(e=21)=>crypto.getRandomValues(new Uint8Array(e)).reduce((s,u)=>(u&=63,u<36?s+=u.toString(36):u<62?s+=(u-26).toString(36).toUpperCase():u>62?s+="-":s+="_",s),"");const WO=Object.freeze(Object.defineProperty({__proto__:null,nanoid:ZO,customAlphabet:GO,customRandom:f2,urlAlphabet:$O,random:d2},Symbol.toStringTag,{value:"Module"})),HO=_R(WO);var XO=HO.nanoid;function p2(e){this.origin=e.origin||"https://api.mapbox.com",this.endpoint="events/v2",this.access_token=e.accessToken,this.version="0.2.0",this.sessionID=this.generateSessionID(),this.userAgent=this.getUserAgent(),this.options=e,this.send=this.send.bind(this),this.countries=e.countries?e.countries.split(","):null,this.types=e.types?e.types.split(","):null,this.bbox=e.bbox?e.bbox:null,this.language=e.language?e.language.split(","):null,this.limit=e.limit?+e.limit:null,this.locale=navigator.language||null,this.enableEventLogging=this.shouldEnableLogging(e),this.eventQueue=new Array,this.flushInterval=e.flushInterval||1e3,this.maxQueueSize=e.maxQueueSize||100,this.timer=this.flushInterval?setTimeout(this.flush.bind(this),this.flushInterval):null,this.lastSentInput="",this.lastSentIndex=0}p2.prototype={select:function(e,s){var u=this.getSelectedIndex(e,s),f=this.getEventPayload("search.select",s);if(f.resultIndex=u,f.resultPlaceName=e.place_name,f.resultId=e.id,!(u===this.lastSentIndex&&f.queryString===this.lastSentInput||u==-1)&&(this.lastSentIndex=u,this.lastSentInput=f.queryString,!!f.queryString))return this.push(f)},start:function(e){var s=this.getEventPayload("search.start",e);if(!!s.queryString)return this.push(s)},keyevent:function(e,s){if(!!e.key&&!(e.metaKey||[9,27,37,39,13,38,40].indexOf(e.keyCode)!==-1)){var u=this.getEventPayload("search.keystroke",s);if(u.lastAction=e.key,!!u.queryString)return this.push(u)}},send:function(e,s){if(!this.enableEventLogging)return s?s():void 0;var u=this.getRequestOptions(e);this.request(u,function(f){if(f)return this.handleError(f,s);if(s)return s()}.bind(this))},getRequestOptions:function(e){Array.isArray(e)||(e=[e]);var s={method:"POST",host:this.origin,path:this.endpoint+"?access_token="+this.access_token,headers:{"Content-Type":"application/json"},body:JSON.stringify(e)};return s},getEventPayload:function(e,s){var u;s.options.proximity?typeof s.options.proximity=="object"?u=[s.options.proximity.longitude,s.options.proximity.latitude]:s.options.proximity==="ip"?u=[999,999]:u=s.options.proximity:u=null;var f=s._map?s._map.getZoom():void 0,m={event:e,created:+new Date,sessionIdentifier:this.sessionID,country:this.countries,userAgent:this.userAgent,language:this.language,bbox:this.bbox,types:this.types,endpoint:"mapbox.places",autocomplete:s.options.autocomplete,fuzzyMatch:s.options.fuzzyMatch,proximity:u,limit:s.options.limit,routing:s.options.routing,worldview:s.options.worldview,mapZoom:f,keyboardLocale:this.locale};return e==="search.select"?m.queryString=s.inputString:e!="search.select"&&s._inputEl?m.queryString=s._inputEl.value:m.queryString=s.inputString,m},request:function(e,s){var u=new XMLHttpRequest;u.onreadystatechange=function(){if(this.readyState==4)return this.status==204?s(null):s(this.statusText)},u.open(e.method,e.host+"/"+e.path,!0);for(var f in e.headers){var m=e.headers[f];u.setRequestHeader(f,m)}u.send(e.body)},handleError:function(e,s){if(s)return s(e)},generateSessionID:function(){return XO()},getUserAgent:function(){return"mapbox-gl-geocoder."+this.version+"."+navigator.userAgent},getSelectedIndex:function(e,s){if(!!s._typeahead){var u=s._typeahead.data,f=e.id,m=u.map(function(b){return b.id}),v=m.indexOf(f);return v}},shouldEnableLogging:function(e){return!(e.enableEventLogging===!1||e.origin&&e.origin!=="https://api.mapbox.com"||e.localGeocoder||e.filter)},flush:function(){this.eventQueue.length>0&&(this.send(this.eventQueue),this.eventQueue=new Array),this.timer&&clearTimeout(this.timer),this.flushInterval&&(this.timer=setTimeout(this.flush.bind(this),this.flushInterval))},push:function(e,s){this.eventQueue.push(e),(this.eventQueue.length>=this.maxQueueSize||s)&&this.flush()},remove:function(){this.flush()}};var KO=p2,YO={de:"Suche",it:"Ricerca",en:"Search",nl:"Zoeken",fr:"Chercher",ca:"Cerca",he:"\u05DC\u05D7\u05E4\u05E9",ja:"\u30B5\u30FC\u30C1",lv:"Mekl\u0113t",pt:"Procurar",sr:"\u041F\u0440\u0435\u0442\u0440\u0430\u0433\u0430",zh:"\u641C\u7D22",cs:"Vyhled\xE1v\xE1n\xED",hu:"Keres\xE9s",ka:"\u10EB\u10D8\u10D4\u10D1\u10D0",nb:"S\xF8ke",sk:"Vyh\u013Ead\xE1vanie",th:"\u0E04\u0E49\u0E19\u0E2B\u0E32",fi:"Hae",is:"Leita",ko:"\uC218\uC0C9",pl:"Szukaj",sl:"Iskanje",fa:"\u062C\u0633\u062A\u062C\u0648",ru:"\u041F\u043E\u0438\u0441\u043A"},QO={placeholder:YO},m2={exports:{}};(function(e){(function(s,u,f){e.exports?e.exports=f():s[u]=f()})(Jo,"subtag",function(){var s="",u=/^([a-zA-Z]{2,3})(?:[_-]+([a-zA-Z]{3})(?=$|[_-]+))?(?:[_-]+([a-zA-Z]{4})(?=$|[_-]+))?(?:[_-]+([a-zA-Z]{2}|[0-9]{3})(?=$|[_-]+))?/;function f(S){return S.match(u)||[]}function m(S){return f(S).filter(function(k,I){return k&&I})}function v(S){return S=f(S),{language:S[1]||s,extlang:S[2]||s,script:S[3]||s,region:S[4]||s}}function b(S,k,I){Object.defineProperty(S,k,{value:I,enumerable:!0})}function o(S,k,I){function L(D){return f(D)[S]||s}b(L,"pattern",k),b(v,I,L)}return o(1,/^[a-zA-Z]{2,3}$/,"language"),o(2,/^[a-zA-Z]{3}$/,"extlang"),o(3,/^[a-zA-Z]{4}$/,"script"),o(4,/^[a-zA-Z]{2}$|^[0-9]{3}$/,"region"),b(v,"split",m),v})})(m2);function g2(){}g2.prototype={isSupport:function(){return Boolean(window.navigator.geolocation)},getCurrentPosition:function(){const e={enableHighAccuracy:!0};return new Promise(function(s,u){window.navigator.geolocation.getCurrentPosition(s,u,e)})}};var JO=g2;function eB(e,s){const u=_2(e),f=["address","street","place","country"];var m;if(typeof s=="function")return s(u);const v=f.indexOf(s);return v===-1?m=f:m=f.slice(v),m.reduce(function(b,o){return u[o]?(b!==""&&(b=b+", "),b+u[o]):b},"")}function _2(e){const s=e.address||"",u=e.text||"",f=e.place_name||"",v={address:f.split(",")[0],houseNumber:s,street:u,placeName:f};return e.context.forEach(function(b){const o=b.id.split(".")[0];v[o]=b.text}),v}const tB=/^[ ]*(-?\d{1,3}(\.\d{0,256})?)[, ]+(-?\d{1,3}(\.\d{0,256})?)[ ]*$/;var nB={transformFeatureToGeolocationText:eB,getAddressInfo:_2,REVERSE_GEOCODE_COORD_RGX:tB},iB=cD,rB=AD,$l=qu,oB=Gv.exports.EventEmitter,Iw=RD,oy=mO,sy=qO,sB=KO,aB=QO,lB=m2.exports,cB=JO,kw=nB;const Da={FORWARD:0,LOCAL:1,REVERSE:2};function uB(){var e=document.createElement("div");return e.className="mapboxgl-ctrl-geocoder--powered-by",e.innerHTML='<a href="https://www.mapbox.com/search-service" target="_blank">Powered by Mapbox</a>',e}function y2(e){this._eventEmitter=new oB,this.options=$l({},this.options,e),this.inputString="",this.fresh=!0,this.lastSelected=null,this.geolocation=new cB}y2.prototype={options:{zoom:16,flyTo:!0,trackProximity:!0,minLength:2,reverseGeocode:!1,flipCoordinates:!1,limit:5,origin:"https://api.mapbox.com",enableEventLogging:!0,marker:!0,mapboxgl:null,collapsed:!1,clearAndBlurOnEsc:!1,clearOnBlur:!1,enableGeolocation:!1,addressAccuracy:"street",getItemValue:function(e){return e.place_name},render:function(e){var s=e.place_name.split(",");return'<div class="mapboxgl-ctrl-geocoder--suggestion"><div class="mapboxgl-ctrl-geocoder--suggestion-title">'+s[0]+'</div><div class="mapboxgl-ctrl-geocoder--suggestion-address">'+s.splice(1,s.length).join(",")+"</div></div>"}},addTo:function(e){function s(u,f){if(!document.body.contains(f))throw new Error("Element provided to #addTo() exists, but is not in the DOM");const m=u.onAdd();f.appendChild(m)}if(e._controlContainer)e.addControl(this);else if(e instanceof HTMLElement)s(this,e);else if(typeof e=="string"){const u=document.querySelectorAll(e);if(u.length===0)throw new Error("Element ",e,"not found.");if(u.length>1)throw new Error("Geocoder can only be added to a single html element");s(this,u[0])}else throw new Error("Error: addTo must be a mapbox-gl-js map, an html element, or a CSS selector query for a single html element")},onAdd:function(e){if(e&&typeof e!="string"&&(this._map=e),this.setLanguage(),this.options.localGeocoderOnly||(this.geocoderService=sy(oy({accessToken:this.options.accessToken,origin:this.options.origin}))),this.options.localGeocoderOnly&&!this.options.localGeocoder)throw new Error("A localGeocoder function must be specified to use localGeocoderOnly mode");this.eventManager=new sB(this.options),this._onChange=this._onChange.bind(this),this._onKeyDown=this._onKeyDown.bind(this),this._onPaste=this._onPaste.bind(this),this._onBlur=this._onBlur.bind(this),this._showButton=this._showButton.bind(this),this._hideButton=this._hideButton.bind(this),this._onQueryResult=this._onQueryResult.bind(this),this.clear=this.clear.bind(this),this._updateProximity=this._updateProximity.bind(this),this._collapse=this._collapse.bind(this),this._unCollapse=this._unCollapse.bind(this),this._clear=this._clear.bind(this),this._clearOnBlur=this._clearOnBlur.bind(this),this._geolocateUser=this._geolocateUser.bind(this);var s=this.container=document.createElement("div");s.className="mapboxgl-ctrl-geocoder mapboxgl-ctrl";var u=this.createIcon("search",'<path d="M7.4 2.5c-2.7 0-4.9 2.2-4.9 4.9s2.2 4.9 4.9 4.9c1 0 1.8-.2 2.5-.8l3.7 3.7c.2.2.4.3.8.3.7 0 1.1-.4 1.1-1.1 0-.3-.1-.5-.3-.8L11.4 10c.4-.8.8-1.6.8-2.5.1-2.8-2.1-5-4.8-5zm0 1.6c1.8 0 3.2 1.4 3.2 3.2s-1.4 3.2-3.2 3.2-3.3-1.3-3.3-3.1 1.4-3.3 3.3-3.3z"/>');this._inputEl=document.createElement("input"),this._inputEl.type="text",this._inputEl.className="mapboxgl-ctrl-geocoder--input",this.setPlaceholder(),this.options.collapsed&&(this._collapse(),this.container.addEventListener("mouseenter",this._unCollapse),this.container.addEventListener("mouseleave",this._collapse),this._inputEl.addEventListener("focus",this._unCollapse)),(this.options.collapsed||this.options.clearOnBlur)&&this._inputEl.addEventListener("blur",this._onBlur),this._inputEl.addEventListener("keydown",rB(this._onKeyDown,200)),this._inputEl.addEventListener("paste",this._onPaste),this._inputEl.addEventListener("change",this._onChange),this.container.addEventListener("mouseenter",this._showButton),this.container.addEventListener("mouseleave",this._hideButton),this._inputEl.addEventListener("keyup",function(k){this.eventManager.keyevent(k,this)}.bind(this));var f=document.createElement("div");f.classList.add("mapboxgl-ctrl-geocoder--pin-right"),this._clearEl=document.createElement("button"),this._clearEl.setAttribute("aria-label","Clear"),this._clearEl.addEventListener("click",this.clear),this._clearEl.className="mapboxgl-ctrl-geocoder--button";var m=this.createIcon("close",'<path d="M3.8 2.5c-.6 0-1.3.7-1.3 1.3 0 .3.2.7.5.8L7.2 9 3 13.2c-.3.3-.5.7-.5 1 0 .6.7 1.3 1.3 1.3.3 0 .7-.2 1-.5L9 10.8l4.2 4.2c.2.3.7.3 1 .3.6 0 1.3-.7 1.3-1.3 0-.3-.2-.7-.3-1l-4.4-4L15 4.6c.3-.2.5-.5.5-.8 0-.7-.7-1.3-1.3-1.3-.3 0-.7.2-1 .3L9 7.1 4.8 2.8c-.3-.1-.7-.3-1-.3z"/>');if(this._clearEl.appendChild(m),this._loadingEl=this.createIcon("loading",'<path fill="#333" d="M4.4 4.4l.8.8c2.1-2.1 5.5-2.1 7.6 0l.8-.8c-2.5-2.5-6.7-2.5-9.2 0z"/><path opacity=".1" d="M12.8 12.9c-2.1 2.1-5.5 2.1-7.6 0-2.1-2.1-2.1-5.5 0-7.7l-.8-.8c-2.5 2.5-2.5 6.7 0 9.2s6.6 2.5 9.2 0 2.5-6.6 0-9.2l-.8.8c2.2 2.1 2.2 5.6 0 7.7z"/>'),f.appendChild(this._clearEl),f.appendChild(this._loadingEl),s.appendChild(u),s.appendChild(this._inputEl),s.appendChild(f),this.options.enableGeolocation&&this.geolocation.isSupport()){this._geolocateEl=document.createElement("button"),this._geolocateEl.setAttribute("aria-label","Geolocate"),this._geolocateEl.addEventListener("click",this._geolocateUser),this._geolocateEl.className="mapboxgl-ctrl-geocoder--button";var v=this.createIcon("geolocate",'<path d="M12.999 3.677L2.042 8.269c-.962.403-.747 1.823.29 1.912l5.032.431.431 5.033c.089 1.037 1.509 1.252 1.912.29l4.592-10.957c.345-.822-.477-1.644-1.299-1.299z" fill="#4264fb"/>');this._geolocateEl.appendChild(v),f.appendChild(this._geolocateEl),this._showGeolocateButton()}var b=this._typeahead=new iB(this._inputEl,[],{filter:!1,minLength:this.options.minLength,limit:this.options.limit});this.setRenderFunction(this.options.render),b.getItemValue=this.options.getItemValue;var o=b.list.draw,S=this._footerNode=uB();return b.list.draw=function(){o.call(this),S.addEventListener("mousedown",function(){this.selectingListItem=!0}.bind(this)),S.addEventListener("mouseup",function(){this.selectingListItem=!1}.bind(this)),this.element.appendChild(S)},this.mapMarker=null,this._handleMarker=this._handleMarker.bind(this),this._map&&(this.options.trackProximity&&(this._updateProximity(),this._map.on("moveend",this._updateProximity)),this._mapboxgl=this.options.mapboxgl,!this._mapboxgl&&this.options.marker&&(console.error("No mapboxgl detected in options. Map markers are disabled. Please set options.mapboxgl."),this.options.marker=!1)),s},_geolocateUser:function(){this._hideGeolocateButton(),this._showLoadingIcon(),this.geolocation.getCurrentPosition().then(function(e){this._hideLoadingIcon();const s={geometry:{type:"Point",coordinates:[e.coords.longitude,e.coords.latitude]}};this._handleMarker(s),this._fly(s),this._typeahead.clear(),this._typeahead.selected=!0,this.lastSelected=JSON.stringify(s),this._showClearButton(),this.fresh=!1;const u={limit:1,language:[this.options.language],query:s.geometry.coordinates,types:["address"]};if(this.options.localGeocoderOnly){const f=s.geometry.coordinates[0]+","+s.geometry.coordinates[1];this._setInputValue(f),this._eventEmitter.emit("result",{result:s})}else this.geocoderService.reverseGeocode(u).send().then(function(f){const m=f.body.features[0];if(m){const v=kw.transformFeatureToGeolocationText(m,this.options.addressAccuracy);this._setInputValue(v),m.user_coordinates=s.geometry.coordinates,this._eventEmitter.emit("result",{result:m})}else this._eventEmitter.emit("result",{result:{user_coordinates:s.geometry.coordinates}})}.bind(this))}.bind(this)).catch(function(e){e.code===1?this._renderUserDeniedGeolocationError():this._renderLocationError(),this._hideLoadingIcon(),this._showGeolocateButton(),this._hideAttribution()}.bind(this))},createIcon:function(e,s){var u=document.createElementNS("http://www.w3.org/2000/svg","svg");return u.setAttribute("class","mapboxgl-ctrl-geocoder--icon mapboxgl-ctrl-geocoder--icon-"+e),u.setAttribute("viewBox","0 0 18 18"),u.setAttribute("xml:space","preserve"),u.setAttribute("width",18),u.setAttribute("height",18),u.innerHTML=s,u},onRemove:function(){return this.container.parentNode.removeChild(this.container),this.options.trackProximity&&this._map&&this._map.off("moveend",this._updateProximity),this._removeMarker(),this._map=null,this},_setInputValue:function(e){this._inputEl.value=e,setTimeout(function(){this._inputEl.focus(),this._inputEl.scrollLeft=0,this._inputEl.setSelectionRange(0,0)}.bind(this),1)},_onPaste:function(e){var s=(e.clipboardData||window.clipboardData).getData("text");s.length>=this.options.minLength&&this._geocode(s)},_onKeyDown:function(e){var s=27,u=9;if(e.keyCode===s&&this.options.clearAndBlurOnEsc)return this._clear(e),this._inputEl.blur();var f=e.target&&e.target.shadowRoot?e.target.shadowRoot.activeElement:e.target,m=f?f.value:"";if(!m)return this.fresh=!0,e.keyCode!==u&&this.clear(e),this._showGeolocateButton(),this._hideClearButton();this._hideGeolocateButton(),!(e.metaKey||[u,s,37,39,13,38,40].indexOf(e.keyCode)!==-1)&&f.value.length>=this.options.minLength&&this._geocode(f.value)},_showButton:function(){this._typeahead.selected&&this._showClearButton()},_hideButton:function(){this._typeahead.selected&&this._hideClearButton()},_showClearButton:function(){this._clearEl.style.display="block"},_hideClearButton:function(){this._clearEl.style.display="none"},_showGeolocateButton:function(){this._geolocateEl&&this.geolocation.isSupport()&&(this._geolocateEl.style.display="block")},_hideGeolocateButton:function(){this._geolocateEl&&(this._geolocateEl.style.display="none")},_showLoadingIcon:function(){this._loadingEl.style.display="block"},_hideLoadingIcon:function(){this._loadingEl.style.display="none"},_showAttribution:function(){this._footerNode.style.display="block"},_hideAttribution:function(){this._footerNode.style.display="none"},_onBlur:function(e){this.options.clearOnBlur&&this._clearOnBlur(e),this.options.collapsed&&this._collapse()},_onChange:function(){var e=this._typeahead.selected;e&&JSON.stringify(e)!==this.lastSelected&&(this._hideClearButton(),this.options.flyTo&&this._fly(e),this.options.marker&&this._mapboxgl&&this._handleMarker(e),this._inputEl.focus(),this._inputEl.scrollLeft=0,this._inputEl.setSelectionRange(0,0),this.lastSelected=JSON.stringify(e),this._eventEmitter.emit("result",{result:e}),this.eventManager.select(e,this))},_fly:function(e){var s;if(e.properties&&Iw[e.properties.short_code])s=$l({},this.options.flyTo),this._map&&this._map.fitBounds(Iw[e.properties.short_code].bbox,s);else if(e.bbox){var u=e.bbox;s=$l({},this.options.flyTo),this._map&&this._map.fitBounds([[u[0],u[1]],[u[2],u[3]]],s)}else{var f={zoom:this.options.zoom};s=$l({},f,this.options.flyTo),e.center?s.center=e.center:e.geometry&&e.geometry.type&&e.geometry.type==="Point"&&e.geometry.coordinates&&(s.center=e.geometry.coordinates),this._map&&this._map.flyTo(s)}},_requestType:function(e,s){var u;return e.localGeocoderOnly?u=Da.LOCAL:e.reverseGeocode&&kw.REVERSE_GEOCODE_COORD_RGX.test(s)?u=Da.REVERSE:u=Da.FORWARD,u},_setupConfig:function(e,s){const u=["bbox","limit","proximity","countries","types","language","reverseMode","mode","autocomplete","fuzzyMatch","routing","worldview"],f=/[\s,]+/;var m=this,v=u.reduce(function(o,S){if(m.options[S]===void 0||m.options[S]===null)return o;["countries","types","language"].indexOf(S)>-1?o[S]=m.options[S].split(f):o[S]=m.options[S];const k=typeof m.options[S].longitude=="number"&&typeof m.options[S].latitude=="number";if(S==="proximity"&&k){const I=m.options[S].longitude,L=m.options[S].latitude;o[S]=[I,L]}return o},{});switch(e){case Da.REVERSE:{var b=s.split(f).map(function(o){return parseFloat(o,10)});m.options.flipCoordinates||b.reverse(),v.types&&v.types[0],v=$l(v,{query:b,limit:1}),["proximity","autocomplete","fuzzyMatch","bbox"].forEach(function(o){o in v&&delete v[o]})}break;case Da.FORWARD:{const o=s.trim();/^(-?\d{1,3}(\.\d{0,256})?)[, ]+(-?\d{1,3}(\.\d{0,256})?)?$/.test(o)&&(s=s.replace(/,/g," ")),v=$l(v,{query:s})}break}return v},_geocode:function(e){this.inputString=e,this._showLoadingIcon(),this._eventEmitter.emit("loading",{query:e});const s=this._requestType(this.options,e),u=this._setupConfig(s,e);var f;switch(s){case Da.LOCAL:f=Promise.resolve();break;case Da.FORWARD:f=this.geocoderService.forwardGeocode(u).send();break;case Da.REVERSE:f=this.geocoderService.reverseGeocode(u).send();break}var m=this.options.localGeocoder?this.options.localGeocoder(e)||[]:[],v=[],b=null;return f.catch(function(o){b=o}.bind(this)).then(function(o){this._hideLoadingIcon();var S={};return o?o.statusCode=="200"&&(S=o.body,S.request=o.request,S.headers=o.headers):S={type:"FeatureCollection",features:[]},S.config=u,this.fresh&&(this.eventManager.start(this),this.fresh=!1),S.features=S.features?m.concat(S.features):m,this.options.externalGeocoder?(v=this.options.externalGeocoder(e,S.features)||Promise.resolve([]),v.then(function(k){return S.features=S.features?k.concat(S.features):k,S},function(){return S})):S}.bind(this)).then(function(o){if(b)throw b;this.options.filter&&o.features.length&&(o.features=o.features.filter(this.options.filter)),o.features.length?(this._showClearButton(),this._hideGeolocateButton(),this._showAttribution(),this._eventEmitter.emit("results",o),this._typeahead.update(o.features)):(this._hideClearButton(),this._hideAttribution(),this._typeahead.selected=null,this._renderNoResults(),this._eventEmitter.emit("results",o))}.bind(this)).catch(function(o){this._hideLoadingIcon(),this._hideAttribution(),m.length&&this.options.localGeocoder||v.length&&this.options.externalGeocoder?(this._showClearButton(),this._hideGeolocateButton(),this._typeahead.update(m)):(this._hideClearButton(),this._typeahead.selected=null,this._renderError()),this._eventEmitter.emit("results",{features:m}),this._eventEmitter.emit("error",{error:o})}.bind(this)),f},_clear:function(e){e&&e.preventDefault(),this._inputEl.value="",this._typeahead.selected=null,this._typeahead.clear(),this._onChange(),this._hideClearButton(),this._showGeolocateButton(),this._removeMarker(),this.lastSelected=null,this._eventEmitter.emit("clear"),this.fresh=!0},clear:function(e){this._clear(e),this._inputEl.focus()},_clearOnBlur:function(e){var s=this;e.relatedTarget&&s._clear(e)},_onQueryResult:function(e){var s=e.body;if(!!s.features.length){var u=s.features[0];this._typeahead.selected=u,this._inputEl.value=u.place_name,this._onChange()}},_updateProximity:function(){if(!(!this._map||!this.options.trackProximity))if(this._map.getZoom()>9){var e=this._map.getCenter().wrap();this.setProximity({longitude:e.lng,latitude:e.lat},!1)}else this.setProximity(null,!1)},_collapse:function(){!this._inputEl.value&&this._inputEl!==document.activeElement&&this.container.classList.add("mapboxgl-ctrl-geocoder--collapsed")},_unCollapse:function(){this.container.classList.remove("mapboxgl-ctrl-geocoder--collapsed")},query:function(e){return this._geocode(e).then(this._onQueryResult),this},_renderError:function(){var e="<div class='mapbox-gl-geocoder--error'>There was an error reaching the server</div>";this._renderMessage(e)},_renderLocationError:function(){var e="<div class='mapbox-gl-geocoder--error'>A location error has occurred</div>";this._renderMessage(e)},_renderNoResults:function(){var e="<div class='mapbox-gl-geocoder--error mapbox-gl-geocoder--no-results'>No results found</div>";this._renderMessage(e)},_renderUserDeniedGeolocationError:function(){var e="<div class='mapbox-gl-geocoder--error'>Geolocation permission denied</div>";this._renderMessage(e)},_renderMessage:function(e){this._typeahead.update([]),this._typeahead.selected=null,this._typeahead.clear(),this._typeahead.renderError(e)},_getPlaceholderText:function(){if(this.options.placeholder)return this.options.placeholder;if(this.options.language){var e=this.options.language.split(",")[0],s=lB.language(e),u=aB.placeholder[s];if(u)return u}return"Search"},setInput:function(e){return this._inputEl.value=e,this._typeahead.selected=null,this._typeahead.clear(),e.length>=this.options.minLength&&this._geocode(e),this},setProximity:function(e,s=!0){return this.options.proximity=e,s&&(this.options.trackProximity=!1),this},getProximity:function(){return this.options.proximity},setRenderFunction:function(e){return e&&typeof e=="function"&&(this._typeahead.render=e),this},getRenderFunction:function(){return this._typeahead.render},setLanguage:function(e){var s=navigator.language||navigator.userLanguage||navigator.browserLanguage;return this.options.language=e||this.options.language||s,this},getLanguage:function(){return this.options.language},getZoom:function(){return this.options.zoom},setZoom:function(e){return this.options.zoom=e,this},getFlyTo:function(){return this.options.flyTo},setFlyTo:function(e){return this.options.flyTo=e,this},getPlaceholder:function(){return this.options.placeholder},setPlaceholder:function(e){return this.placeholder=e||this._getPlaceholderText(),this._inputEl.placeholder=this.placeholder,this._inputEl.setAttribute("aria-label",this.placeholder),this},getBbox:function(){return this.options.bbox},setBbox:function(e){return this.options.bbox=e,this},getCountries:function(){return this.options.countries},setCountries:function(e){return this.options.countries=e,this},getTypes:function(){return this.options.types},setTypes:function(e){return this.options.types=e,this},getMinLength:function(){return this.options.minLength},setMinLength:function(e){return this.options.minLength=e,this._typeahead&&(this._typeahead.options.minLength=e),this},getLimit:function(){return this.options.limit},setLimit:function(e){return this.options.limit=e,this._typeahead&&(this._typeahead.options.limit=e),this},getFilter:function(){return this.options.filter},setFilter:function(e){return this.options.filter=e,this},setOrigin:function(e){return this.options.origin=e,this.geocoderService=sy(oy({accessToken:this.options.accessToken,origin:this.options.origin})),this},getOrigin:function(){return this.options.origin},setAccessToken:function(e){return this.options.accessToken=e,this.geocoderService=sy(oy({accessToken:this.options.accessToken,origin:this.options.origin})),this},setAutocomplete:function(e){return this.options.autocomplete=e,this},getAutocomplete:function(){return this.options.autocomplete},setFuzzyMatch:function(e){return this.options.fuzzyMatch=e,this},getFuzzyMatch:function(){return this.options.fuzzyMatch},setRouting:function(e){return this.options.routing=e,this},getRouting:function(){return this.options.routing},setWorldview:function(e){return this.options.worldview=e,this},getWorldview:function(){return this.options.worldview},_handleMarker:function(e){if(!!this._map){this._removeMarker();var s={color:"#4668F2"},u=$l({},s,this.options.marker);return this.mapMarker=new this._mapboxgl.Marker(u),e.center?this.mapMarker.setLngLat(e.center).addTo(this._map):e.geometry&&e.geometry.type&&e.geometry.type==="Point"&&e.geometry.coordinates&&this.mapMarker.setLngLat(e.geometry.coordinates).addTo(this._map),this}},_removeMarker:function(){this.mapMarker&&(this.mapMarker.remove(),this.mapMarker=null)},on:function(e,s){return this._eventEmitter.on(e,s),this},off:function(e,s){return this._eventEmitter.removeListener(e,s),this.eventManager.remove(),this}};var hB=y2;function Kv(){return{map:Ur("mapbox-map")}}var ay=new Map,dB=/onMb([A-Z])(.+)/;function fB(e){return ay.has(e)||ay.set(e,e.replace(dB,(s,u,f)=>u.toLowerCase()+f)),ay.get(e)}function og(e,s,u=[],f=null){const m=uk(),v=se(()=>Object.entries(m).filter(([k,I])=>k.startsWith("on")&&typeof I=="function").map(([k])=>k)),b=new Map;function o(k){!Array.isArray(k)||k.forEach(I=>{const L=b.get(I);typeof L=="function"&&L()})}function S(k){!Array.isArray(k)||k.forEach(I=>{const L=fB(I);if(!u.includes(L))return;const D=(...N)=>{e(`mb-${L}`,...N)};f?(Bn(s).on(L,f,D),b.set(I,()=>{Bn(s).off(L,f,D)})):(Bn(s).on(L,D),b.set(I,()=>{Bn(s).off(L,D)}))})}Ht(v,(k,I)=>{const L=Array.isArray(k)?(I!=null?I:[]).filter(N=>!k.includes(N)):I!=null?I:[],D=Array.isArray(I)?(k!=null?k:[]).filter(N=>!I.includes(N)):k!=null?k:[];if(Bn(s))o(L),S(D);else{const N=Ht(s,j=>{j&&(o(L),S(D),N())})}},{immediate:!0})}function pB(e){return e.charAt(0).toUpperCase()+e.slice(1)}function sg(e,s,u){function f(m){Object.keys(e).filter(v=>e[v]!==void 0&&e[v]!==null).forEach(v=>{var b,o;const S=v==="mapStyle"?"setStyle":`set${pB(v)}`,k=typeof m[S]=="function",I=typeof u[v]>"u"||"bind"in u[v]?(o=(b=u[v])==null?void 0:b.bind)!=null?o:!1:!0;if(!k||!I)return;const{type:L}=e[v],D={deep:L===Object||Array.isArray(L)&&L.includes(Object)};Ht(()=>e[v],N=>{m[S](N)},D)})}if(Bn(s))f(Bn(s));else{const m=Ht(s,v=>{v&&(f(v),m())})}}function mB(e,{propsConfig:s,props:u,emit:f,events:m=[]}){const{map:v}=Kv(),b=xt();return Array.isArray(m)&&m.length&&og(f,b,m),typeof s<"u"&&sg(u,b,s),Ht(()=>u.position,o=>{Bn(v)&&Bn(v).removeControl(Bn(b)).addControl(Bn(b),o)}),Ui(async()=>{const o=new e(u);Bn(v)&&Bn(v).addControl(o,u.position),await ui(),b.value=o}),ia(()=>{Bn(b)&&Bn(v)&&Bn(v).removeControl(Bn(b))}),{control:b,map:v}}var ag=(e,s)=>{const u=e.__vccOpts||e;for(const[f,m]of s)u[f]=m;return u};if(!ta)throw new Error("mapboxgl is not installed.");if(!hB)throw new Error("MapboxGeocoder is not installed.");var gB={key:0},_B={key:1};if(!ta)throw new Error("mapboxgl is not installed.");var{LngLatBounds:Pw,LngLat:yB}=ta,zw={accessToken:{type:String,default:"no-token"},container:{type:[typeof HTMLElement<"u"&&HTMLElement,String],default:void 0},minZoom:{type:Number,default:0},maxZoom:{type:Number,default:22},minPitch:{type:Number,default:0},maxPitch:{type:Number,default:60},mapStyle:{type:[Object,String],required:!0},hash:{type:Boolean,default:!1},interactive:{type:Boolean,default:!0},bearingSnap:{type:Number,default:7},pitchWithRotate:{type:Boolean,default:!0},clickTolerance:{type:Number,default:3},attributionControl:{type:Boolean,default:!0},customAttribution:{type:[String,Array],default:null},logoPosition:{type:String,default:"bottom-left"},failIfMajorPerformanceCaveat:{type:Boolean,default:!1},preserveDrawingBuffer:{type:Boolean,default:!1},antialias:{type:Boolean,default:!1},refreshExpiredTiles:{type:Boolean,default:!0},maxBounds:{type:[Pw,Array],default:void 0},scrollZoom:{type:[Boolean,Object],default:!0},boxZoom:{type:Boolean,default:!0},dragRotate:{type:Boolean,default:!0},dragPan:{type:[Boolean,Object],default:!0},keyboard:{type:Boolean,default:!0},doubleClickZoom:{type:Boolean,default:!0},touchZoomRotate:{type:[Boolean,Object],default:!0},trackResize:{type:Boolean,default:!0},center:{type:[yB,Array,Object],default:()=>[0,0]},zoom:{type:Number,default:0},bearing:{type:Number,default:0},pitch:{type:Number,default:0},bounds:{type:[Pw,Array],default:void 0},fitBoundsOptions:{type:Object,default:null},renderWorldCopies:{type:Boolean,default:!0},maxTileCacheSize:{type:Number,default:null},localIdeographFontFamily:{type:String,default:"sans-serif"},transformRequest:{type:Function,default:null},collectResourceTiming:{type:Boolean,default:!1},fadeDuration:{type:Number,default:300},crossSourceCollisions:{type:Boolean,default:!0}},vB=["boxzoomcancel","boxzoomend","boxzoomstart","click","contextmenu","data","dataloading","dblclick","drag","dragend","dragstart","error","idle","load","mousedown","mouseenter","mouseleave","mousemove","mouseout","mouseover","mouseup","move","moveend","movestart","pitch","pitchend","pitchstart","remove","render","resize","rotate","rotateend","rotatestart","sourcedata","sourcedataloading","styledata","styledataloading","styleimagemissing","touchcancel","touchend","touchmove","touchstart","webglcontextlost","webglcontextrestored","wheel","zoom","zoomend","zoomstart"],xB={inheritAttrs:!1},bB=Object.assign(xB,{__name:"MapboxMap",props:zw,setup(e,{expose:s,emit:u}){const f=e,m=xt();Yl("mapbox-map",m);const v=xt(),b=xt(!1),o=se(()=>{const{accessToken:S,mapStyle:k,...I}=f;return!I.container&&v.value&&(I.container=v.value),{style:k,...I}});return og(u,m,vB),sg(f,m,zw),Ui(()=>{ta.accessToken=f.accessToken,m.value=new ta.Map(o.value),m.value.on("load",()=>{b.value=!0}),u("mb-created",m.value);const S=new ResizeObserver(()=>{m.value.resize()});S.observe(o.value.container),ia(()=>{S.disconnect(),m.value.remove()})}),s({map:m}),(S,k)=>(Yn(),no(Ki,null,[Ar("div",jm({ref_key:"root",ref:v},S.$attrs),null,16),b.value?(Yn(),no("div",gB,[Rd(S.$slots,"default")])):(Yn(),no("div",_B,[Rd(S.$slots,"loader")]))],64))}}),Zy=ag(bB,[["__file","/home/runner/work/vue-mapbox-gl/vue-mapbox-gl/packages/vue-mapbox-gl/components/MapboxMap.vue"]]);if(!ta)throw new Error("mapboxgl is not installed.");var{GeolocateControl:wB}=ta,Lw={positionOptions:{type:Object,default:()=>({enableHighAccuracy:!1,timeout:6e3})},fitBoundsOptions:{type:Object,default:()=>({maxZoom:15})},trackUserLocation:{type:Boolean,default:!1},showAccuracyCircle:{type:Boolean,default:!0},showUserLocation:{type:Boolean,default:!0},position:{type:String,default:"top-right",bind:!1}},EB=["trackuserlocationend","error","geolocate","outofmaxbounds","trackuserlocationstart"],TB={__name:"MapboxGeolocateControl",props:Lw,setup(e,{expose:s,emit:u}){const f=e,{control:m}=mB(wB,{propsConfig:Lw,events:EB,props:f,emit:u});return s({control:m}),(v,b)=>(Yn(),no("div"))}},SB=ag(TB,[["__file","/home/runner/work/vue-mapbox-gl/vue-mapbox-gl/packages/vue-mapbox-gl/components/MapboxGeolocateControl.vue"]]),{Popup:CB,Point:AB,LngLat:MB}=ta,Rw={lngLat:{type:[MB,Array,Object],required:!0},closeButton:{type:Boolean,default:!0},closeOnClick:{type:Boolean,default:!0},closeOnMove:{type:Boolean,default:!1},anchor:{type:String,default:null},offset:{type:[Number,AB,Array,Object],default:0},className:{type:String,default:null},maxWidth:{type:String,default:"240px"},renderless:{type:Boolean,default:!1,bind:!1}},IB=["open","close"],kB={__name:"MapboxPopup",props:Rw,setup(e,{expose:s,emit:u}){const f=e,m=xt(),v=xt(),b=se(()=>{const{lngLat:o,...S}=f;return S});return sg(f,m,Rw),og(u,m,IB),Ui(()=>{const{map:o}=Kv();m.value=new CB(b.value).setLngLat(f.lngLat).setDOMContent(v.value),f.renderless||m.value.addTo(o.value),u("mb-open",m.value)}),ia(()=>{m.value&&m.value.remove()}),s({popup:m}),(o,S)=>(Yn(),no("div",{ref_key:"root",ref:v},[Rd(o.$slots,"default")],512))}},PB=ag(kB,[["__file","/home/runner/work/vue-mapbox-gl/vue-mapbox-gl/packages/vue-mapbox-gl/components/MapboxPopup.vue"]]),{Marker:zB,Point:LB}=ta,Dw={lngLat:{type:Array,required:!0},popup:{type:[Object,Boolean],default:!1,bind:!1},element:{type:typeof HTMLElement<"u"?HTMLElement:Object,default:null},offset:{type:[LB,Array],default:null},anchor:{type:String,default:"center"},color:{type:String,default:null},scale:{type:Number,default:1},draggable:{type:Boolean,default:!1},rotation:{type:Number,default:0},pitchAlignment:{type:String,default:"auto"},rotationAlignment:{type:String,default:"auto"}},RB=["dragstart","drag","dragend"],DB={__name:"MapboxMarker",props:Dw,setup(e,{emit:s}){const u=e,f=ck(),m=xt(),v=xt(),b=xt(),o=se(()=>typeof f.popup<"u"),S=se(()=>o.value?b.value.popup:null),k=se(()=>({lngLat:u.lngLat,...u.popup?u.popup:{},renderless:!0})),I=se(()=>{const{lngLat:L,popup:D,...N}=u;return f.default&&(N.element=v.value),N});return sg(u,m,Dw),og(s,m,RB),Ui(()=>{const{map:L}=Kv();m.value=new zB(I.value).setLngLat(u.lngLat).addTo(L.value),o.value&&m.value.setPopup(S.value)}),ia(()=>{m.value&&m.value.remove()}),(L,D)=>(Yn(),no("div",null,[Ar("div",{ref_key:"contentRef",ref:v},[Rd(L.$slots,"default")],512),Bn(o)?(Yn(),Yi(PB,jm({key:0,ref_key:"popupRef",ref:b},Bn(k)),{default:vn(()=>[Rd(L.$slots,"popup")]),_:3},16)):Es("v-if",!0)]))}},Wy=ag(DB,[["__file","/home/runner/work/vue-mapbox-gl/vue-mapbox-gl/packages/vue-mapbox-gl/components/MapboxMarker.vue"]]);const Hy=Un({name:"QBar",props:{...io,dense:Boolean},setup(e,{slots:s}){const{proxy:{$q:u}}=In(),f=ro(e,u),m=se(()=>`q-bar row no-wrap items-center q-bar--${e.dense===!0?"dense":"standard"}  q-bar--${f.value===!0?"dark":"light"}`);return()=>me("div",{class:m.value,role:"toolbar"},bi(s.default))}}),Ws=Un({name:"QCardSection",props:{tag:{type:String,default:"div"},horizontal:Boolean},setup(e,{slots:s}){const u=se(()=>`q-card__section q-card__section--${e.horizontal===!0?"horiz row no-wrap":"vert"}`);return()=>me(e.tag,{class:u.value},bi(s.default))}}),ly=Un({name:"QCardActions",props:{...kT,vertical:Boolean},setup(e,{slots:s}){const u=PT(e),f=se(()=>`q-card__actions ${u.value} q-card__actions--${e.vertical===!0?"vert column":"horiz row"}`);return()=>me("div",{class:f.value},bi(s.default))}}),Md=Un({name:"QCard",props:{...io,tag:{type:String,default:"div"},square:Boolean,flat:Boolean,bordered:Boolean},setup(e,{slots:s}){const{proxy:{$q:u}}=In(),f=ro(e,u),m=se(()=>"q-card"+(f.value===!0?" q-card--dark q-dark":"")+(e.bordered===!0?" q-card--bordered":"")+(e.square===!0?" q-card--square no-border-radius":"")+(e.flat===!0?" q-card--flat no-shadow":""));return()=>me(e.tag,{class:m.value},bi(s.default))}});function OB(e){const s=[.06,6,50];return typeof e=="string"&&e.length&&e.split(":").forEach((u,f)=>{const m=parseFloat(u);m&&(s[f]=m)}),s}const BB=Hm({name:"touch-swipe",beforeMount(e,{value:s,arg:u,modifiers:f}){if(f.mouse!==!0&&hi.has.touch!==!0)return;const m=f.mouseCapture===!0?"Capture":"",v={handler:s,sensitivity:OB(u),direction:vm(f),noop:Cs,mouseStart(b){xm(b,v)&&fT(b)&&(Qo(v,"temp",[[document,"mousemove","move",`notPassive${m}`],[document,"mouseup","end","notPassiveCapture"]]),v.start(b,!0))},touchStart(b){if(xm(b,v)){const o=b.target;Qo(v,"temp",[[o,"touchmove","move","notPassiveCapture"],[o,"touchcancel","end","notPassiveCapture"],[o,"touchend","end","notPassiveCapture"]]),v.start(b)}},start(b,o){hi.is.firefox===!0&&bu(e,!0);const S=ic(b);v.event={x:S.left,y:S.top,time:Date.now(),mouse:o===!0,dir:!1}},move(b){if(v.event===void 0)return;if(v.event.dir!==!1){zi(b);return}const o=Date.now()-v.event.time;if(o===0)return;const S=ic(b),k=S.left-v.event.x,I=Math.abs(k),L=S.top-v.event.y,D=Math.abs(L);if(v.event.mouse!==!0){if(I<v.sensitivity[1]&&D<v.sensitivity[1]){v.end(b);return}}else if(I<v.sensitivity[2]&&D<v.sensitivity[2])return;const N=I/o,j=D/o;v.direction.vertical===!0&&I<D&&I<100&&j>v.sensitivity[0]&&(v.event.dir=L<0?"up":"down"),v.direction.horizontal===!0&&I>D&&D<100&&N>v.sensitivity[0]&&(v.event.dir=k<0?"left":"right"),v.direction.up===!0&&I<D&&L<0&&I<100&&j>v.sensitivity[0]&&(v.event.dir="up"),v.direction.down===!0&&I<D&&L>0&&I<100&&j>v.sensitivity[0]&&(v.event.dir="down"),v.direction.left===!0&&I>D&&k<0&&D<100&&N>v.sensitivity[0]&&(v.event.dir="left"),v.direction.right===!0&&I>D&&k>0&&D<100&&N>v.sensitivity[0]&&(v.event.dir="right"),v.event.dir!==!1?(zi(b),v.event.mouse===!0&&(document.body.classList.add("no-pointer-events--children"),document.body.classList.add("non-selectable"),kv(),v.styleCleanup=Z=>{v.styleCleanup=void 0,document.body.classList.remove("non-selectable");const K=()=>{document.body.classList.remove("no-pointer-events--children")};Z===!0?setTimeout(K,50):K()}),v.handler({evt:b,touch:v.event.mouse!==!0,mouse:v.event.mouse,direction:v.event.dir,duration:o,distance:{x:I,y:D}})):v.end(b)},end(b){v.event!==void 0&&(Ga(v,"temp"),hi.is.firefox===!0&&bu(e,!1),v.styleCleanup!==void 0&&v.styleCleanup(!0),b!==void 0&&v.event.dir!==!1&&zi(b),v.event=void 0)}};if(e.__qtouchswipe=v,f.mouse===!0){const b=f.mouseCapture===!0||f.mousecapture===!0?"Capture":"";Qo(v,"main",[[e,"mousedown","mouseStart",`passive${b}`]])}hi.has.touch===!0&&Qo(v,"main",[[e,"touchstart","touchStart",`passive${f.capture===!0?"Capture":""}`],[e,"touchmove","noop","notPassiveCapture"]])},updated(e,s){const u=e.__qtouchswipe;u!==void 0&&(s.oldValue!==s.value&&(typeof s.value!="function"&&u.end(),u.handler=s.value),u.direction=vm(s.modifiers))},beforeUnmount(e){const s=e.__qtouchswipe;s!==void 0&&(Ga(s,"main"),Ga(s,"temp"),hi.is.firefox===!0&&bu(e,!1),s.styleCleanup!==void 0&&s.styleCleanup(),delete e.__qtouchswipe)}});function FB(){const e=new Map;return{getCache:function(s,u){return e[s]===void 0?e[s]=u:e[s]},getCacheWithFn:function(s,u){return e[s]===void 0?e[s]=u():e[s]}}}const NB={name:{required:!0},disable:Boolean},Ow={setup(e,{slots:s}){return()=>me("div",{class:"q-panel scroll",role:"tabpanel"},bi(s.default))}},VB={modelValue:{required:!0},animated:Boolean,infinite:Boolean,swipeable:Boolean,vertical:Boolean,transitionPrev:String,transitionNext:String,transitionDuration:{type:[String,Number],default:300},keepAlive:Boolean,keepAliveInclude:[String,Array,RegExp],keepAliveExclude:[String,Array,RegExp],keepAliveMax:Number},UB=["update:modelValue","before-transition","transition"];function jB(){const{props:e,emit:s,proxy:u}=In(),{getCacheWithFn:f}=FB();let m,v;const b=xt(null),o=xt(null);function S(Ze){const Ye=e.vertical===!0?"up":"left";Te((u.$q.lang.rtl===!0?-1:1)*(Ze.direction===Ye?1:-1))}const k=se(()=>[[BB,S,void 0,{horizontal:e.vertical!==!0,vertical:e.vertical,mouse:!0}]]),I=se(()=>e.transitionPrev||`slide-${e.vertical===!0?"down":"right"}`),L=se(()=>e.transitionNext||`slide-${e.vertical===!0?"up":"left"}`),D=se(()=>`--q-transition-duration: ${e.transitionDuration}ms`),N=se(()=>typeof e.modelValue=="string"||typeof e.modelValue=="number"?e.modelValue:String(e.modelValue)),j=se(()=>({include:e.keepAliveInclude,exclude:e.keepAliveExclude,max:e.keepAliveMax})),Z=se(()=>e.keepAliveInclude!==void 0||e.keepAliveExclude!==void 0);Ht(()=>e.modelValue,(Ze,Ye)=>{const lt=ve(Ze)===!0?Ce(Ze):-1;v!==!0&&pe(lt===-1?0:lt<Ce(Ye)?-1:1),b.value!==lt&&(b.value=lt,s("before-transition",Ze,Ye),ui(()=>{s("transition",Ze,Ye)}))});function K(){Te(1)}function fe(){Te(-1)}function te(Ze){s("update:modelValue",Ze)}function ve(Ze){return Ze!=null&&Ze!==""}function Ce(Ze){return m.findIndex(Ye=>Ye.props.name===Ze&&Ye.props.disable!==""&&Ye.props.disable!==!0)}function ce(){return m.filter(Ze=>Ze.props.disable!==""&&Ze.props.disable!==!0)}function pe(Ze){const Ye=Ze!==0&&e.animated===!0&&b.value!==-1?"q-transition--"+(Ze===-1?I.value:L.value):null;o.value!==Ye&&(o.value=Ye)}function Te(Ze,Ye=b.value){let lt=Ye+Ze;for(;lt>-1&&lt<m.length;){const Xt=m[lt];if(Xt!==void 0&&Xt.props.disable!==""&&Xt.props.disable!==!0){pe(Ze),v=!0,s("update:modelValue",Xt.props.name),setTimeout(()=>{v=!1});return}lt+=Ze}e.infinite===!0&&m.length>0&&Ye!==-1&&Ye!==m.length&&Te(Ze,Ze===-1?m.length:-1)}function Me(){const Ze=Ce(e.modelValue);return b.value!==Ze&&(b.value=Ze),!0}function Ie(){const Ze=ve(e.modelValue)===!0&&Me()&&m[b.value];return e.keepAlive===!0?[me(TI,j.value,[me(Z.value===!0?f(N.value,()=>({...Ow,name:N.value})):Ow,{key:N.value,style:D.value},()=>Ze)])]:[me("div",{class:"q-panel scroll",style:D.value,key:N.value,role:"tabpanel"},[Ze])]}function ke(){if(m.length!==0)return e.animated===!0?[me(ea,{name:o.value},Ie)]:Ie()}function Be(Ze){return m=kP(bi(Ze.default,[])).filter(Ye=>Ye.props!==null&&Ye.props.slot===void 0&&ve(Ye.props.name)===!0),m.length}function Re(){return m}return Object.assign(u,{next:K,previous:fe,goTo:te}),{panelIndex:b,panelDirectives:k,updatePanelsList:Be,updatePanelIndex:Me,getPanelContent:ke,getEnabledPanels:ce,getPanels:Re,isValidPanelName:ve,keepAliveProps:j,needsUniqueKeepAliveWrapper:Z,goToPanelByOffset:Te,goToPanel:te,nextPanel:K,previousPanel:fe}}const Xy=Un({name:"QCarouselSlide",props:{...NB,imgSrc:String},setup(e,{slots:s}){const u=se(()=>e.imgSrc?{backgroundImage:`url("${e.imgSrc}")`}:{});return()=>me("div",{class:"q-carousel__slide",style:u.value},bi(s.default))}});let gd=0;const v2={fullscreen:Boolean,noRouteFullscreenExit:Boolean},x2=["update:fullscreen","fullscreen"];function b2(){const e=In(),{props:s,emit:u,proxy:f}=e;let m,v,b;const o=xt(!1);Mv(e)===!0&&Ht(()=>f.$route.fullPath,()=>{s.noRouteFullscreenExit!==!0&&I()}),Ht(()=>s.fullscreen,L=>{o.value!==L&&S()}),Ht(o,L=>{u("update:fullscreen",L),u("fullscreen",L)});function S(){o.value===!0?I():k()}function k(){o.value!==!0&&(o.value=!0,b=f.$el.parentNode,b.replaceChild(v,f.$el),document.body.appendChild(f.$el),gd++,gd===1&&document.body.classList.add("q-body--fullscreen-mixin"),m={handler:I},Nd.add(m))}function I(){o.value===!0&&(m!==void 0&&(Nd.remove(m),m=void 0),b.replaceChild(f.$el,v),o.value=!1,gd=Math.max(0,gd-1),gd===0&&(document.body.classList.remove("q-body--fullscreen-mixin"),f.$el.scrollIntoView!==void 0&&setTimeout(()=>{f.$el.scrollIntoView()})))}return Fm(()=>{v=document.createElement("span")}),Ui(()=>{s.fullscreen===!0&&k()}),Ii(I),Object.assign(f,{toggleFullscreen:S,setFullscreen:k,exitFullscreen:I}),{inFullscreen:o,toggleFullscreen:S}}const qB=["top","right","bottom","left"],$B=["regular","flat","outline","push","unelevated"],w2=Un({name:"QCarousel",props:{...io,...VB,...v2,transitionPrev:{type:String,default:"fade"},transitionNext:{type:String,default:"fade"},height:String,padding:Boolean,controlColor:String,controlTextColor:String,controlType:{type:String,validator:e=>$B.includes(e),default:"flat"},autoplay:[Number,Boolean],arrows:Boolean,prevIcon:String,nextIcon:String,navigation:Boolean,navigationPosition:{type:String,validator:e=>qB.includes(e)},navigationIcon:String,navigationActiveIcon:String,thumbnails:Boolean},emits:[...x2,...UB],setup(e,{slots:s}){const{proxy:{$q:u}}=In(),f=ro(e,u);let m,v;const{updatePanelsList:b,getPanelContent:o,panelDirectives:S,goToPanel:k,previousPanel:I,nextPanel:L,getEnabledPanels:D,panelIndex:N}=jB(),{inFullscreen:j}=b2(),Z=se(()=>j.value!==!0&&e.height!==void 0?{height:e.height}:{}),K=se(()=>e.vertical===!0?"vertical":"horizontal"),fe=se(()=>`q-carousel q-panel-parent q-carousel--with${e.padding===!0?"":"out"}-padding`+(j.value===!0?" fullscreen":"")+(f.value===!0?" q-carousel--dark q-dark":"")+(e.arrows===!0?` q-carousel--arrows-${K.value}`:"")+(e.navigation===!0?` q-carousel--navigation-${ce.value}`:"")),te=se(()=>{const ke=[e.prevIcon||u.iconSet.carousel[e.vertical===!0?"up":"left"],e.nextIcon||u.iconSet.carousel[e.vertical===!0?"down":"right"]];return e.vertical===!1&&u.lang.rtl===!0?ke.reverse():ke}),ve=se(()=>e.navigationIcon||u.iconSet.carousel.navigationIcon),Ce=se(()=>e.navigationActiveIcon||ve.value),ce=se(()=>e.navigationPosition||(e.vertical===!0?"right":"bottom")),pe=se(()=>({color:e.controlColor,textColor:e.controlTextColor,round:!0,[e.controlType]:!0,dense:!0}));Ht(()=>e.modelValue,()=>{e.autoplay&&(clearInterval(m),Te())}),Ht(()=>e.autoplay,ke=>{ke?Te():clearInterval(m)});function Te(){const ke=pm(e.autoplay)===!0?e.autoplay:5e3;m=setTimeout(ke>=0?L:I,Math.abs(ke))}Ui(()=>{e.autoplay&&Te()}),Ii(()=>{clearInterval(m)});function Me(ke,Be){return me("div",{class:`q-carousel__control q-carousel__navigation no-wrap absolute flex q-carousel__navigation--${ke} q-carousel__navigation--${ce.value}`+(e.controlColor!==void 0?` text-${e.controlColor}`:"")},[me("div",{class:"q-carousel__navigation-inner flex flex-center no-wrap"},D().map(Be))])}function Ie(){const ke=[];if(e.navigation===!0){const Be=s["navigation-icon"]!==void 0?s["navigation-icon"]:Ze=>me(Ci,{key:"nav"+Ze.name,class:`q-carousel__navigation-icon q-carousel__navigation-icon--${Ze.active===!0?"":"in"}active`,...Ze.btnProps,onClick:Ze.onClick}),Re=v-1;ke.push(Me("buttons",(Ze,Ye)=>{const lt=Ze.props.name,Xt=N.value===Ye;return Be({index:Ye,maxIndex:Re,name:lt,active:Xt,btnProps:{icon:Xt===!0?Ce.value:ve.value,size:"sm",...pe.value},onClick:()=>{k(lt)}})}))}else if(e.thumbnails===!0){const Be=e.controlColor!==void 0?` text-${e.controlColor}`:"";ke.push(Me("thumbnails",Re=>{const Ze=Re.props;return me("img",{key:"tmb#"+Ze.name,class:`q-carousel__thumbnail q-carousel__thumbnail--${Ze.name===e.modelValue?"":"in"}active`+Be,src:Ze.imgSrc||Ze["img-src"],onClick:()=>{k(Ze.name)}})}))}return e.arrows===!0&&N.value>=0&&((e.infinite===!0||N.value>0)&&ke.push(me("div",{key:"prev",class:`q-carousel__control q-carousel__arrow q-carousel__prev-arrow q-carousel__prev-arrow--${K.value} absolute flex flex-center`},[me(Ci,{icon:te.value[0],...pe.value,onClick:I})])),(e.infinite===!0||N.value<v-1)&&ke.push(me("div",{key:"next",class:`q-carousel__control q-carousel__arrow q-carousel__next-arrow q-carousel__next-arrow--${K.value} absolute flex flex-center`},[me(Ci,{icon:te.value[1],...pe.value,onClick:L})]))),Ro(s.control,ke)}return()=>(v=b(s),me("div",{class:fe.value,style:Z.value},[mm("div",{class:"q-carousel__slides-container"},o(),"sl-cont",e.swipeable,()=>S.value)].concat(Ie())))}}),GB={xs:8,sm:10,md:14,lg:20,xl:24},E2=Un({name:"QChip",props:{...io,...Vu,dense:Boolean,icon:String,iconRight:String,iconRemove:String,iconSelected:String,label:[String,Number],color:String,textColor:String,modelValue:{type:Boolean,default:!0},selected:{type:Boolean,default:null},square:Boolean,outline:Boolean,clickable:Boolean,removable:Boolean,removeAriaLabel:String,tabindex:[String,Number],disable:Boolean,ripple:{type:[Boolean,Object],default:!0}},emits:["update:modelValue","update:selected","remove","click"],setup(e,{slots:s,emit:u}){const{proxy:{$q:f}}=In(),m=ro(e,f),v=Uu(e,GB),b=se(()=>e.selected===!0||e.icon!==void 0),o=se(()=>e.selected===!0?e.iconSelected||f.iconSet.chip.selected:e.icon),S=se(()=>e.iconRemove||f.iconSet.chip.remove),k=se(()=>e.disable===!1&&(e.clickable===!0||e.selected!==null)),I=se(()=>{const K=e.outline===!0&&e.color||e.textColor;return"q-chip row inline no-wrap items-center"+(e.outline===!1&&e.color!==void 0?` bg-${e.color}`:"")+(K?` text-${K} q-chip--colored`:"")+(e.disable===!0?" disabled":"")+(e.dense===!0?" q-chip--dense":"")+(e.outline===!0?" q-chip--outline":"")+(e.selected===!0?" q-chip--selected":"")+(k.value===!0?" q-chip--clickable cursor-pointer non-selectable q-hoverable":"")+(e.square===!0?" q-chip--square":"")+(m.value===!0?" q-chip--dark q-dark":"")}),L=se(()=>{const K=e.disable===!0?{tabindex:-1,"aria-disabled":"true"}:{tabindex:e.tabindex||0},fe={...K,role:"button","aria-hidden":"false","aria-label":e.removeAriaLabel||f.lang.label.remove};return{chip:K,remove:fe}});function D(K){K.keyCode===13&&N(K)}function N(K){e.disable||(u("update:selected",!e.selected),u("click",K))}function j(K){(K.keyCode===void 0||K.keyCode===13)&&(zi(K),e.disable===!1&&(u("update:modelValue",!1),u("remove")))}function Z(){const K=[];k.value===!0&&K.push(me("div",{class:"q-focus-helper"})),b.value===!0&&K.push(me(Wr,{class:"q-chip__icon q-chip__icon--left",name:o.value}));const fe=e.label!==void 0?[me("div",{class:"ellipsis"},[e.label])]:void 0;return K.push(me("div",{class:"q-chip__content col row no-wrap items-center q-anchor--skip"},ET(s.default,fe))),e.iconRight&&K.push(me(Wr,{class:"q-chip__icon q-chip__icon--right",name:e.iconRight})),e.removable===!0&&K.push(me(Wr,{class:"q-chip__icon q-chip__icon--remove cursor-pointer",name:S.value,...L.value.remove,onClick:j,onKeyup:j})),K}return()=>{if(e.modelValue===!1)return;const K={class:I.value,style:v.value};return k.value===!0&&Object.assign(K,L.value.chip,{onClick:N,onKeyup:D}),mm("div",K,Z(),"ripple",e.ripple!==!1&&e.disable!==!0,()=>[[MT,e.ripple]])}}});function ZB({validate:e,resetValidation:s,requiresQForm:u}){const f=Ur(sP,!1);if(f!==!1){const{props:m,proxy:v}=In();Object.assign(v,{validate:e,resetValidation:s}),Ht(()=>m.disable,b=>{b===!0?(typeof s=="function"&&s(),f.unbindComponent(v)):f.bindComponent(v)}),Ui(()=>{m.disable!==!0&&f.bindComponent(v)}),Ii(()=>{m.disable!==!0&&f.unbindComponent(v)})}else u===!0&&console.error("Parent QForm not found on useFormChild()!")}const Bw=/^#[0-9a-fA-F]{3}([0-9a-fA-F]{3})?$/,Fw=/^#[0-9a-fA-F]{4}([0-9a-fA-F]{4})?$/,Nw=/^#([0-9a-fA-F]{3}|[0-9a-fA-F]{4}|[0-9a-fA-F]{6}|[0-9a-fA-F]{8})$/,Np=/^rgb\(((0|[1-9][\d]?|1[\d]{0,2}|2[\d]?|2[0-4][\d]|25[0-5]),){2}(0|[1-9][\d]?|1[\d]{0,2}|2[\d]?|2[0-4][\d]|25[0-5])\)$/,Vp=/^rgba\(((0|[1-9][\d]?|1[\d]{0,2}|2[\d]?|2[0-4][\d]|25[0-5]),){2}(0|[1-9][\d]?|1[\d]{0,2}|2[\d]?|2[0-4][\d]|25[0-5]),(0|0\.[0-9]+[1-9]|0\.[1-9]+|1)\)$/,cy={date:e=>/^-?[\d]+\/[0-1]\d\/[0-3]\d$/.test(e),time:e=>/^([0-1]?\d|2[0-3]):[0-5]\d$/.test(e),fulltime:e=>/^([0-1]?\d|2[0-3]):[0-5]\d:[0-5]\d$/.test(e),timeOrFulltime:e=>/^([0-1]?\d|2[0-3]):[0-5]\d(:[0-5]\d)?$/.test(e),email:e=>/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(e),hexColor:e=>Bw.test(e),hexaColor:e=>Fw.test(e),hexOrHexaColor:e=>Nw.test(e),rgbColor:e=>Np.test(e),rgbaColor:e=>Vp.test(e),rgbOrRgbaColor:e=>Np.test(e)||Vp.test(e),hexOrRgbColor:e=>Bw.test(e)||Np.test(e),hexaOrRgbaColor:e=>Fw.test(e)||Vp.test(e),anyColor:e=>Nw.test(e)||Np.test(e)||Vp.test(e)},WB=[!0,!1,"ondemand"],HB={modelValue:{},error:{type:Boolean,default:null},errorMessage:String,noErrorIcon:Boolean,rules:Array,reactiveRules:Boolean,lazyRules:{type:[Boolean,String],validator:e=>WB.includes(e)}};function XB(e,s){const{props:u,proxy:f}=In(),m=xt(!1),v=xt(null),b=xt(null);ZB({validate:j,resetValidation:N});let o=0,S;const k=se(()=>u.rules!==void 0&&u.rules!==null&&u.rules.length>0),I=se(()=>u.disable!==!0&&k.value===!0),L=se(()=>u.error===!0||m.value===!0),D=se(()=>typeof u.errorMessage=="string"&&u.errorMessage.length>0?u.errorMessage:v.value);Ht(()=>u.modelValue,()=>{Z()}),Ht(()=>u.reactiveRules,fe=>{fe===!0?S===void 0&&(S=Ht(()=>u.rules,()=>{Z(!0)})):S!==void 0&&(S(),S=void 0)},{immediate:!0}),Ht(e,fe=>{fe===!0?b.value===null&&(b.value=!1):b.value===!1&&(b.value=!0,I.value===!0&&u.lazyRules!=="ondemand"&&s.value===!1&&K())});function N(){o++,s.value=!1,b.value=null,m.value=!1,v.value=null,K.cancel()}function j(fe=u.modelValue){if(I.value!==!0)return!0;const te=++o,ve=s.value!==!0?()=>{b.value=!0}:()=>{},Ce=(pe,Te)=>{pe===!0&&ve(),m.value=pe,v.value=Te||null,s.value=!1},ce=[];for(let pe=0;pe<u.rules.length;pe++){const Te=u.rules[pe];let Me;if(typeof Te=="function"?Me=Te(fe,cy):typeof Te=="string"&&cy[Te]!==void 0&&(Me=cy[Te](fe)),Me===!1||typeof Me=="string")return Ce(!0,Me),!1;Me!==!0&&Me!==void 0&&ce.push(Me)}return ce.length===0?(Ce(!1),!0):(s.value=!0,Promise.all(ce).then(pe=>{if(pe===void 0||Array.isArray(pe)===!1||pe.length===0)return te===o&&Ce(!1),!0;const Te=pe.find(Me=>Me===!1||typeof Me=="string");return te===o&&Ce(Te!==void 0,Te),Te===void 0},pe=>(te===o&&(console.error(pe),Ce(!0)),!1)))}function Z(fe){I.value===!0&&u.lazyRules!=="ondemand"&&(b.value===!0||u.lazyRules!==!0&&fe!==!0)&&K()}const K=Tv(j,0);return Ii(()=>{S!==void 0&&S(),K.cancel()}),Object.assign(f,{resetValidation:N,validate:j}),bs(f,"hasError",()=>L.value),{isDirtyModel:b,hasRules:k,hasError:L,errorMessage:D,validate:j,resetValidation:N}}const Vw=/^on[A-Z]/;function KB(e,s){const u={listeners:xt({}),attributes:xt({})};function f(){const m={},v={};for(const b in e)b!=="class"&&b!=="style"&&Vw.test(b)===!1&&(m[b]=e[b]);for(const b in s.props)Vw.test(b)===!0&&(v[b]=s.props[b]);u.attributes.value=m,u.listeners.value=v}return Nm(f),f(),u}let uy,Up=0;const Tr=new Array(256);for(let e=0;e<256;e++)Tr[e]=(e+256).toString(16).substring(1);const YB=(()=>{const e=typeof crypto<"u"?crypto:typeof window<"u"?window.crypto||window.msCrypto:void 0;if(e!==void 0){if(e.randomBytes!==void 0)return e.randomBytes;if(e.getRandomValues!==void 0)return s=>{const u=new Uint8Array(s);return e.getRandomValues(u),u}}return s=>{const u=[];for(let f=s;f>0;f--)u.push(Math.floor(Math.random()*256));return u}})(),Uw=4096;function QB(){(uy===void 0||Up+16>Uw)&&(Up=0,uy=YB(Uw));const e=Array.prototype.slice.call(uy,Up,Up+=16);return e[6]=e[6]&15|64,e[8]=e[8]&63|128,Tr[e[0]]+Tr[e[1]]+Tr[e[2]]+Tr[e[3]]+"-"+Tr[e[4]]+Tr[e[5]]+"-"+Tr[e[6]]+Tr[e[7]]+"-"+Tr[e[8]]+Tr[e[9]]+"-"+Tr[e[10]]+Tr[e[11]]+Tr[e[12]]+Tr[e[13]]+Tr[e[14]]+Tr[e[15]]}function Ky(e){return e===void 0?`f_${QB()}`:e}function oc(e){return e!=null&&(""+e).length>0}const Gd={...io,...HB,label:String,stackLabel:Boolean,hint:String,hideHint:Boolean,prefix:String,suffix:String,labelColor:String,color:String,bgColor:String,filled:Boolean,outlined:Boolean,borderless:Boolean,standout:[Boolean,String],square:Boolean,loading:Boolean,labelSlot:Boolean,bottomSlots:Boolean,hideBottomSpace:Boolean,rounded:Boolean,dense:Boolean,itemAligned:Boolean,counter:Boolean,clearable:Boolean,clearIcon:String,disable:Boolean,readonly:Boolean,autofocus:Boolean,for:String,maxlength:[Number,String]},lg=["update:modelValue","clear","focus","blur","popup-show","popup-hide"];function cg(){const{props:e,attrs:s,proxy:u,vnode:f}=In();return{isDark:ro(e,u.$q),editable:se(()=>e.disable!==!0&&e.readonly!==!0),innerLoading:xt(!1),focused:xt(!1),hasPopupOpen:!1,splitAttrs:KB(s,f),targetUid:xt(Ky(e.for)),rootRef:xt(null),targetRef:xt(null),controlRef:xt(null)}}function ug(e){const{props:s,emit:u,slots:f,attrs:m,proxy:v}=In(),{$q:b}=v;let o;e.hasValue===void 0&&(e.hasValue=se(()=>oc(s.modelValue))),e.emitValue===void 0&&(e.emitValue=Ge=>{u("update:modelValue",Ge)}),e.controlEvents===void 0&&(e.controlEvents={onFocusin:Ie,onFocusout:ke}),Object.assign(e,{clearValue:Be,onControlFocusin:Ie,onControlFocusout:ke,focus:Te}),e.computedCounter===void 0&&(e.computedCounter=se(()=>{if(s.counter!==!1){const Ge=typeof s.modelValue=="string"||typeof s.modelValue=="number"?(""+s.modelValue).length:Array.isArray(s.modelValue)===!0?s.modelValue.length:0,At=s.maxlength!==void 0?s.maxlength:s.maxValues;return Ge+(At!==void 0?" / "+At:"")}}));const{isDirtyModel:S,hasRules:k,hasError:I,errorMessage:L,resetValidation:D}=XB(e.focused,e.innerLoading),N=e.floatingLabel!==void 0?se(()=>s.stackLabel===!0||e.focused.value===!0||e.floatingLabel.value===!0):se(()=>s.stackLabel===!0||e.focused.value===!0||e.hasValue.value===!0),j=se(()=>s.bottomSlots===!0||s.hint!==void 0||k.value===!0||s.counter===!0||s.error!==null),Z=se(()=>s.filled===!0?"filled":s.outlined===!0?"outlined":s.borderless===!0?"borderless":s.standout?"standout":"standard"),K=se(()=>`q-field row no-wrap items-start q-field--${Z.value}`+(e.fieldClass!==void 0?` ${e.fieldClass.value}`:"")+(s.rounded===!0?" q-field--rounded":"")+(s.square===!0?" q-field--square":"")+(N.value===!0?" q-field--float":"")+(te.value===!0?" q-field--labeled":"")+(s.dense===!0?" q-field--dense":"")+(s.itemAligned===!0?" q-field--item-aligned q-item-type":"")+(e.isDark.value===!0?" q-field--dark":"")+(e.getControl===void 0?" q-field--auto-height":"")+(e.focused.value===!0?" q-field--focused":"")+(I.value===!0?" q-field--error":"")+(I.value===!0||e.focused.value===!0?" q-field--highlighted":"")+(s.hideBottomSpace!==!0&&j.value===!0?" q-field--with-bottom":"")+(s.disable===!0?" q-field--disabled":s.readonly===!0?" q-field--readonly":"")),fe=se(()=>"q-field__control relative-position row no-wrap"+(s.bgColor!==void 0?` bg-${s.bgColor}`:"")+(I.value===!0?" text-negative":typeof s.standout=="string"&&s.standout.length>0&&e.focused.value===!0?` ${s.standout}`:s.color!==void 0?` text-${s.color}`:"")),te=se(()=>s.labelSlot===!0||s.label!==void 0),ve=se(()=>"q-field__label no-pointer-events absolute ellipsis"+(s.labelColor!==void 0&&I.value!==!0?` text-${s.labelColor}`:"")),Ce=se(()=>({id:e.targetUid.value,editable:e.editable.value,focused:e.focused.value,floatingLabel:N.value,modelValue:s.modelValue,emitValue:e.emitValue})),ce=se(()=>{const Ge={for:e.targetUid.value};return s.disable===!0?Ge["aria-disabled"]="true":s.readonly===!0&&(Ge["aria-readonly"]="true"),Ge});Ht(()=>s.for,Ge=>{e.targetUid.value=Ky(Ge)});function pe(){const Ge=document.activeElement;let At=e.targetRef!==void 0&&e.targetRef.value;At&&(Ge===null||Ge.id!==e.targetUid.value)&&(At.hasAttribute("tabindex")===!0||(At=At.querySelector("[tabindex]")),At&&At!==Ge&&At.focus({preventScroll:!0}))}function Te(){Km(pe)}function Me(){sz(pe);const Ge=document.activeElement;Ge!==null&&e.rootRef.value.contains(Ge)&&Ge.blur()}function Ie(Ge){clearTimeout(o),e.editable.value===!0&&e.focused.value===!1&&(e.focused.value=!0,u("focus",Ge))}function ke(Ge,At){clearTimeout(o),o=setTimeout(()=>{document.hasFocus()===!0&&(e.hasPopupOpen===!0||e.controlRef===void 0||e.controlRef.value===null||e.controlRef.value.contains(document.activeElement)!==!1)||(e.focused.value===!0&&(e.focused.value=!1,u("blur",Ge)),At!==void 0&&At())})}function Be(Ge){zi(Ge),b.platform.is.mobile!==!0?(e.targetRef!==void 0&&e.targetRef.value||e.rootRef.value).focus():e.rootRef.value.contains(document.activeElement)===!0&&document.activeElement.blur(),s.type==="file"&&(e.inputRef.value.value=null),u("update:modelValue",null),u("clear",s.modelValue),ui(()=>{D(),b.platform.is.mobile!==!0&&(S.value=!1)})}function Re(){const Ge=[];return f.prepend!==void 0&&Ge.push(me("div",{class:"q-field__prepend q-field__marginal row no-wrap items-center",key:"prepend",onClick:Nr},f.prepend())),Ge.push(me("div",{class:"q-field__control-container col relative-position row no-wrap q-anchor--skip"},Ze())),I.value===!0&&s.noErrorIcon===!1&&Ge.push(lt("error",[me(Wr,{name:b.iconSet.field.error,color:"negative"})])),s.loading===!0||e.innerLoading.value===!0?Ge.push(lt("inner-loading-append",f.loading!==void 0?f.loading():[me(Xm,{color:s.color})])):s.clearable===!0&&e.hasValue.value===!0&&e.editable.value===!0&&Ge.push(lt("inner-clearable-append",[me(Wr,{class:"q-field__focusable-action",tag:"button",name:s.clearIcon||b.iconSet.field.clear,tabindex:0,type:"button","aria-hidden":null,role:null,onClick:Be})])),f.append!==void 0&&Ge.push(me("div",{class:"q-field__append q-field__marginal row no-wrap items-center",key:"append",onClick:Nr},f.append())),e.getInnerAppend!==void 0&&Ge.push(lt("inner-append",e.getInnerAppend())),e.getControlChild!==void 0&&Ge.push(e.getControlChild()),Ge}function Ze(){const Ge=[];return s.prefix!==void 0&&s.prefix!==null&&Ge.push(me("div",{class:"q-field__prefix no-pointer-events row items-center"},s.prefix)),e.getShadowControl!==void 0&&e.hasShadow.value===!0&&Ge.push(e.getShadowControl()),e.getControl!==void 0?Ge.push(e.getControl()):f.rawControl!==void 0?Ge.push(f.rawControl()):f.control!==void 0&&Ge.push(me("div",{ref:e.targetRef,class:"q-field__native row",tabindex:-1,...e.splitAttrs.attributes.value,"data-autofocus":s.autofocus===!0||void 0},f.control(Ce.value))),te.value===!0&&Ge.push(me("div",{class:ve.value},bi(f.label,s.label))),s.suffix!==void 0&&s.suffix!==null&&Ge.push(me("div",{class:"q-field__suffix no-pointer-events row items-center"},s.suffix)),Ge.concat(bi(f.default))}function Ye(){let Ge,At;I.value===!0?L.value!==null?(Ge=[me("div",{role:"alert"},L.value)],At=`q--slot-error-${L.value}`):(Ge=bi(f.error),At="q--slot-error"):(s.hideHint!==!0||e.focused.value===!0)&&(s.hint!==void 0?(Ge=[me("div",s.hint)],At=`q--slot-hint-${s.hint}`):(Ge=bi(f.hint),At="q--slot-hint"));const tn=s.counter===!0||f.counter!==void 0;if(s.hideBottomSpace===!0&&tn===!1&&Ge===void 0)return;const Ve=me("div",{key:At,class:"q-field__messages col"},Ge);return me("div",{class:"q-field__bottom row items-start q-field__bottom--"+(s.hideBottomSpace!==!0?"animated":"stale"),onClick:Nr},[s.hideBottomSpace===!0?Ve:me(ea,{name:"q-transition--field-message"},()=>Ve),tn===!0?me("div",{class:"q-field__counter"},f.counter!==void 0?f.counter():e.computedCounter.value):null])}function lt(Ge,At){return At===null?null:me("div",{key:Ge,class:"q-field__append q-field__marginal row no-wrap items-center q-anchor--skip"},At)}let Xt=!1;return Nu(()=>{Xt=!0}),Om(()=>{Xt===!0&&s.autofocus===!0&&v.focus()}),Ui(()=>{Ss.value===!0&&s.for===void 0&&(e.targetUid.value=Ky()),s.autofocus===!0&&v.focus()}),Ii(()=>{clearTimeout(o)}),Object.assign(v,{focus:Te,blur:Me}),function(){const At=e.getControl===void 0&&f.control===void 0?{...e.splitAttrs.attributes.value,"data-autofocus":s.autofocus===!0||void 0,...ce.value}:ce.value;return me("label",{ref:e.rootRef,class:[K.value,m.class],style:m.style,...At},[f.before!==void 0?me("div",{class:"q-field__before q-field__marginal row no-wrap items-center",onClick:Nr},f.before()):null,me("div",{class:"q-field__inner relative-position col self-stretch"},[me("div",{ref:e.controlRef,class:fe.value,tabindex:-1,...e.controlEvents},Re()),j.value===!0?Ye():null]),f.after!==void 0?me("div",{class:"q-field__after q-field__marginal row no-wrap items-center",onClick:Nr},f.after()):null])}}const hg={name:String};function JB(e={}){return(s,u,f)=>{s[u](me("input",{class:"hidden"+(f||""),...e.value}))}}function Yv(e){return se(()=>e.name||e.for)}function pu(e,s,u,f){const m=[];return e.forEach(v=>{f(v)===!0?m.push(v):s.push({failedPropValidation:u,file:v})}),m}function jp(e){e&&e.dataTransfer&&(e.dataTransfer.dropEffect="copy"),zi(e)}const e3={multiple:Boolean,accept:String,capture:String,maxFileSize:[Number,String],maxTotalSize:[Number,String],maxFiles:[Number,String],filter:Function},t3=["rejected"];function n3({editable:e,dnd:s,getFileInput:u,addFilesToQueue:f}){const{props:m,emit:v,proxy:b}=In(),o=xt(null),S=se(()=>m.accept!==void 0?m.accept.split(",").map(te=>(te=te.trim(),te==="*"?"*/":(te.endsWith("/*")&&(te=te.slice(0,te.length-1)),te.toUpperCase()))):null),k=se(()=>parseInt(m.maxFiles,10)),I=se(()=>parseInt(m.maxTotalSize,10));function L(te){if(e.value)if(te!==Object(te)&&(te={target:null}),te.target!==null&&te.target.matches('input[type="file"]')===!0)te.clientX===0&&te.clientY===0&&to(te);else{const ve=u();ve&&ve!==te.target&&ve.click(te)}}function D(te){e.value&&te&&f(null,te)}function N(te,ve,Ce,ce){let pe=Array.from(ve||te.target.files);const Te=[],Me=()=>{Te.length>0&&v("rejected",Te)};if(m.accept!==void 0&&S.value.indexOf("*/")===-1&&(pe=pu(pe,Te,"accept",Ie=>S.value.some(ke=>Ie.type.toUpperCase().startsWith(ke)||Ie.name.toUpperCase().endsWith(ke))),pe.length===0))return Me();if(m.maxFileSize!==void 0){const Ie=parseInt(m.maxFileSize,10);if(pe=pu(pe,Te,"max-file-size",ke=>ke.size<=Ie),pe.length===0)return Me()}if(m.multiple!==!0&&pe.length>0&&(pe=[pe[0]]),pe.forEach(Ie=>{Ie.__key=Ie.webkitRelativePath+Ie.lastModified+Ie.name+Ie.size}),ce===!0){const Ie=Ce.map(ke=>ke.__key);pe=pu(pe,Te,"duplicate",ke=>Ie.includes(ke.__key)===!1)}if(pe.length===0)return Me();if(m.maxTotalSize!==void 0){let Ie=ce===!0?Ce.reduce((ke,Be)=>ke+Be.size,0):0;if(pe=pu(pe,Te,"max-total-size",ke=>(Ie+=ke.size,Ie<=I.value)),pe.length===0)return Me()}if(typeof m.filter=="function"){const Ie=m.filter(pe);pe=pu(pe,Te,"filter",ke=>Ie.includes(ke))}if(m.maxFiles!==void 0){let Ie=ce===!0?Ce.length:0;if(pe=pu(pe,Te,"max-files",()=>(Ie++,Ie<=k.value)),pe.length===0)return Me()}if(Me(),pe.length>0)return pe}function j(te){jp(te),s.value!==!0&&(s.value=!0)}function Z(te){zi(te),(te.relatedTarget!==null||hi.is.safari!==!0?te.relatedTarget!==o.value:document.elementsFromPoint(te.clientX,te.clientY).includes(o.value)===!1)===!0&&(s.value=!1)}function K(te){jp(te);const ve=te.dataTransfer.files;ve.length>0&&f(null,ve),s.value=!1}function fe(te){if(s.value===!0)return me("div",{ref:o,class:`q-${te}__dnd absolute-full`,onDragenter:jp,onDragover:jp,onDragleave:Z,onDrop:K})}return Object.assign(b,{pickFiles:L,addFiles:D}),{pickFiles:L,addFiles:D,onDragover:j,onDragleave:Z,processFiles:N,getDndNode:fe,maxFilesNumber:k,maxTotalSizeNumber:I}}function T2(e,s){function u(){const f=e.modelValue;try{const m="DataTransfer"in window?new DataTransfer:"ClipboardEvent"in window?new ClipboardEvent("").clipboardData:void 0;return Object(f)===f&&("length"in f?Array.from(f):[f]).forEach(v=>{m.items.add(v)}),{files:m.files}}catch{return{files:void 0}}}return se(s===!0?()=>{if(e.type==="file")return u()}:u)}const i3=Un({name:"QFile",inheritAttrs:!1,props:{...Gd,...hg,...e3,modelValue:[File,FileList,Array],append:Boolean,useChips:Boolean,displayValue:[String,Number],tabindex:{type:[String,Number],default:0},counterLabel:Function,inputClass:[Array,String,Object],inputStyle:[Array,String,Object]},emits:[...lg,...t3],setup(e,{slots:s,emit:u,attrs:f}){const{proxy:m}=In(),v=cg(),b=xt(null),o=xt(!1),S=Yv(e),{pickFiles:k,onDragover:I,onDragleave:L,processFiles:D,getDndNode:N}=n3({editable:v.editable,dnd:o,getFileInput:Re,addFilesToQueue:Ze}),j=T2(e),Z=se(()=>Object(e.modelValue)===e.modelValue?"length"in e.modelValue?Array.from(e.modelValue):[e.modelValue]:[]),K=se(()=>oc(Z.value)),fe=se(()=>Z.value.map(Ge=>Ge.name).join(", ")),te=se(()=>kz(Z.value.reduce((Ge,At)=>Ge+At.size,0))),ve=se(()=>({totalSize:te.value,filesNumber:Z.value.length,maxFiles:e.maxFiles})),Ce=se(()=>({tabindex:-1,type:"file",title:"",accept:e.accept,capture:e.capture,name:S.value,...f,id:v.targetUid.value,disabled:v.editable.value!==!0})),ce=se(()=>"q-file q-field--auto-height"+(o.value===!0?" q-file--dnd":"")),pe=se(()=>e.multiple===!0&&e.append===!0);function Te(Ge){const At=Z.value.slice();At.splice(Ge,1),Ie(At)}function Me(Ge){const At=Z.value.findIndex(Ge);At>-1&&Te(At)}function Ie(Ge){u("update:modelValue",e.multiple===!0?Ge:Ge[0])}function ke(Ge){Ge.keyCode===13&&Nr(Ge)}function Be(Ge){(Ge.keyCode===13||Ge.keyCode===32)&&k(Ge)}function Re(){return b.value}function Ze(Ge,At){const tn=D(Ge,At,Z.value,pe.value),Ve=Re();Ve!=null&&(Ve.value=""),tn!==void 0&&((e.multiple===!0?e.modelValue&&tn.every(mt=>Z.value.includes(mt)):e.modelValue===tn[0])||Ie(pe.value===!0?Z.value.concat(tn):tn))}function Ye(){return[me("input",{class:[e.inputClass,"q-file__filler"],style:e.inputStyle})]}function lt(){if(s.file!==void 0)return Z.value.length===0?Ye():Z.value.map((At,tn)=>s.file({index:tn,file:At,ref:this}));if(s.selected!==void 0)return Z.value.length===0?Ye():s.selected({files:Z.value,ref:this});if(e.useChips===!0)return Z.value.length===0?Ye():Z.value.map((At,tn)=>me(E2,{key:"file-"+tn,removable:v.editable.value,dense:!0,textColor:e.color,tabindex:e.tabindex,onRemove:()=>{Te(tn)}},()=>me("span",{class:"ellipsis",textContent:At.name})));const Ge=e.displayValue!==void 0?e.displayValue:fe.value;return Ge.length>0?[me("div",{class:e.inputClass,style:e.inputStyle,textContent:Ge})]:Ye()}function Xt(){const Ge={ref:b,...Ce.value,...j.value,class:"q-field__input fit absolute-full cursor-pointer",onChange:Ze};return e.multiple===!0&&(Ge.multiple=!0),me("input",Ge)}return Object.assign(v,{fieldClass:ce,emitValue:Ie,hasValue:K,inputRef:b,innerValue:Z,floatingLabel:se(()=>K.value===!0||oc(e.displayValue)),computedCounter:se(()=>{if(e.counterLabel!==void 0)return e.counterLabel(ve.value);const Ge=e.maxFiles;return`${Z.value.length}${Ge!==void 0?" / "+Ge:""} (${te.value})`}),getControlChild:()=>N("file"),getControl:()=>{const Ge={ref:v.targetRef,class:"q-field__native row items-center cursor-pointer",tabindex:e.tabindex};return v.editable.value===!0&&Object.assign(Ge,{onDragover:I,onDragleave:L,onKeydown:ke,onKeyup:Be}),me("div",Ge,[Xt()].concat(lt()))}}),Object.assign(m,{removeAtIndex:Te,removeFile:Me,getNativeElement:()=>b.value}),ug(v)}}),jw={date:"####/##/##",datetime:"####/##/## ##:##",time:"##:##",fulltime:"##:##:##",phone:"(###) ### - ####",card:"#### #### #### ####"},Sm={"#":{pattern:"[\\d]",negate:"[^\\d]"},S:{pattern:"[a-zA-Z]",negate:"[^a-zA-Z]"},N:{pattern:"[0-9a-zA-Z]",negate:"[^0-9a-zA-Z]"},A:{pattern:"[a-zA-Z]",negate:"[^a-zA-Z]",transform:e=>e.toLocaleUpperCase()},a:{pattern:"[a-zA-Z]",negate:"[^a-zA-Z]",transform:e=>e.toLocaleLowerCase()},X:{pattern:"[0-9a-zA-Z]",negate:"[^0-9a-zA-Z]",transform:e=>e.toLocaleUpperCase()},x:{pattern:"[0-9a-zA-Z]",negate:"[^0-9a-zA-Z]",transform:e=>e.toLocaleLowerCase()}},S2=Object.keys(Sm);S2.forEach(e=>{Sm[e].regex=new RegExp(Sm[e].pattern)});const r3=new RegExp("\\\\([^.*+?^${}()|([\\]])|([.*+?^${}()|[\\]])|(["+S2.join("")+"])|(.)","g"),qw=/[.*+?^${}()|[\]\\]/g,cr=String.fromCharCode(1),o3={mask:String,reverseFillMask:Boolean,fillMask:[Boolean,String],unmaskedValue:Boolean};function s3(e,s,u,f){let m,v,b,o;const S=xt(null),k=xt(L());function I(){return e.autogrow===!0||["textarea","text","search","url","tel","password"].includes(e.type)}Ht(()=>e.type+e.autogrow,N),Ht(()=>e.mask,pe=>{if(pe!==void 0)j(k.value,!0);else{const Te=Ce(k.value);N(),e.modelValue!==Te&&s("update:modelValue",Te)}}),Ht(()=>e.fillMask+e.reverseFillMask,()=>{S.value===!0&&j(k.value,!0)}),Ht(()=>e.unmaskedValue,()=>{S.value===!0&&j(k.value)});function L(){if(N(),S.value===!0){const pe=te(Ce(e.modelValue));return e.fillMask!==!1?ce(pe):pe}return e.modelValue}function D(pe){if(pe<m.length)return m.slice(-pe);let Te="",Me=m;const Ie=Me.indexOf(cr);if(Ie>-1){for(let ke=pe-Me.length;ke>0;ke--)Te+=cr;Me=Me.slice(0,Ie)+Te+Me.slice(Ie)}return Me}function N(){if(S.value=e.mask!==void 0&&e.mask.length>0&&I(),S.value===!1){o=void 0,m="",v="";return}const pe=jw[e.mask]===void 0?e.mask:jw[e.mask],Te=typeof e.fillMask=="string"&&e.fillMask.length>0?e.fillMask.slice(0,1):"_",Me=Te.replace(qw,"\\$&"),Ie=[],ke=[],Be=[];let Re=e.reverseFillMask===!0,Ze="",Ye="";pe.replace(r3,(At,tn,Ve,mt,Bt)=>{if(mt!==void 0){const jt=Sm[mt];Be.push(jt),Ye=jt.negate,Re===!0&&(ke.push("(?:"+Ye+"+)?("+jt.pattern+"+)?(?:"+Ye+"+)?("+jt.pattern+"+)?"),Re=!1),ke.push("(?:"+Ye+"+)?("+jt.pattern+")?")}else if(Ve!==void 0)Ze="\\"+(Ve==="\\"?"":Ve),Be.push(Ve),Ie.push("([^"+Ze+"]+)?"+Ze+"?");else{const jt=tn!==void 0?tn:Bt;Ze=jt==="\\"?"\\\\\\\\":jt.replace(qw,"\\\\$&"),Be.push(jt),Ie.push("([^"+Ze+"]+)?"+Ze+"?")}});const lt=new RegExp("^"+Ie.join("")+"("+(Ze===""?".":"[^"+Ze+"]")+"+)?"+(Ze===""?"":"["+Ze+"]*")+"$"),Xt=ke.length-1,Ge=ke.map((At,tn)=>tn===0&&e.reverseFillMask===!0?new RegExp("^"+Me+"*"+At):tn===Xt?new RegExp("^"+At+"("+(Ye===""?".":Ye)+"+)?"+(e.reverseFillMask===!0?"$":Me+"*")):new RegExp("^"+At));b=Be,o=At=>{const tn=lt.exec(At);tn!==null&&(At=tn.slice(1).join(""));const Ve=[],mt=Ge.length;for(let Bt=0,jt=At;Bt<mt;Bt++){const xn=Ge[Bt].exec(jt);if(xn===null)break;jt=jt.slice(xn.shift().length),Ve.push(...xn)}return Ve.length>0?Ve.join(""):At},m=Be.map(At=>typeof At=="string"?At:cr).join(""),v=m.split(cr).join(Te)}function j(pe,Te,Me){const Ie=f.value,ke=Ie.selectionEnd,Be=Ie.value.length-ke,Re=Ce(pe);Te===!0&&N();const Ze=te(Re),Ye=e.fillMask!==!1?ce(Ze):Ze,lt=k.value!==Ye;Ie.value!==Ye&&(Ie.value=Ye),lt===!0&&(k.value=Ye),document.activeElement===Ie&&ui(()=>{if(Ye===v){const Ge=e.reverseFillMask===!0?v.length:0;Ie.setSelectionRange(Ge,Ge,"forward");return}if(Me==="insertFromPaste"&&e.reverseFillMask!==!0){const Ge=ke-1;K.right(Ie,Ge,Ge);return}if(["deleteContentBackward","deleteContentForward"].indexOf(Me)>-1){const Ge=e.reverseFillMask===!0?ke===0?Ye.length>Ze.length?1:0:Math.max(0,Ye.length-(Ye===v?0:Math.min(Ze.length,Be)+1))+1:ke;Ie.setSelectionRange(Ge,Ge,"forward");return}if(e.reverseFillMask===!0)if(lt===!0){const Ge=Math.max(0,Ye.length-(Ye===v?0:Math.min(Ze.length,Be+1)));Ge===1&&ke===1?Ie.setSelectionRange(Ge,Ge,"forward"):K.rightReverse(Ie,Ge,Ge)}else{const Ge=Ye.length-Be;Ie.setSelectionRange(Ge,Ge,"backward")}else if(lt===!0){const Ge=Math.max(0,m.indexOf(cr),Math.min(Ze.length,ke)-1);K.right(Ie,Ge,Ge)}else{const Ge=ke-1;K.right(Ie,Ge,Ge)}});const Xt=e.unmaskedValue===!0?Ce(Ye):Ye;String(e.modelValue)!==Xt&&u(Xt,!0)}function Z(pe,Te,Me){const Ie=te(Ce(pe.value));Te=Math.max(0,m.indexOf(cr),Math.min(Ie.length,Te)),pe.setSelectionRange(Te,Me,"forward")}const K={left(pe,Te,Me,Ie){const ke=m.slice(Te-1).indexOf(cr)===-1;let Be=Math.max(0,Te-1);for(;Be>=0;Be--)if(m[Be]===cr){Te=Be,ke===!0&&Te++;break}if(Be<0&&m[Te]!==void 0&&m[Te]!==cr)return K.right(pe,0,0);Te>=0&&pe.setSelectionRange(Te,Ie===!0?Me:Te,"backward")},right(pe,Te,Me,Ie){const ke=pe.value.length;let Be=Math.min(ke,Me+1);for(;Be<=ke;Be++)if(m[Be]===cr){Me=Be;break}else m[Be-1]===cr&&(Me=Be);if(Be>ke&&m[Me-1]!==void 0&&m[Me-1]!==cr)return K.left(pe,ke,ke);pe.setSelectionRange(Ie?Te:Me,Me,"forward")},leftReverse(pe,Te,Me,Ie){const ke=D(pe.value.length);let Be=Math.max(0,Te-1);for(;Be>=0;Be--)if(ke[Be-1]===cr){Te=Be;break}else if(ke[Be]===cr&&(Te=Be,Be===0))break;if(Be<0&&ke[Te]!==void 0&&ke[Te]!==cr)return K.rightReverse(pe,0,0);Te>=0&&pe.setSelectionRange(Te,Ie===!0?Me:Te,"backward")},rightReverse(pe,Te,Me,Ie){const ke=pe.value.length,Be=D(ke),Re=Be.slice(0,Me+1).indexOf(cr)===-1;let Ze=Math.min(ke,Me+1);for(;Ze<=ke;Ze++)if(Be[Ze-1]===cr){Me=Ze,Me>0&&Re===!0&&Me--;break}if(Ze>ke&&Be[Me-1]!==void 0&&Be[Me-1]!==cr)return K.leftReverse(pe,ke,ke);pe.setSelectionRange(Ie===!0?Te:Me,Me,"forward")}};function fe(pe){if(Sv(pe)===!0)return;const Te=f.value,Me=Te.selectionStart,Ie=Te.selectionEnd;if(pe.keyCode===37||pe.keyCode===39){const ke=K[(pe.keyCode===39?"right":"left")+(e.reverseFillMask===!0?"Reverse":"")];pe.preventDefault(),ke(Te,Me,Ie,pe.shiftKey)}else pe.keyCode===8&&e.reverseFillMask!==!0&&Me===Ie?K.left(Te,Me,Ie,!0):pe.keyCode===46&&e.reverseFillMask===!0&&Me===Ie&&K.rightReverse(Te,Me,Ie,!0)}function te(pe){if(pe==null||pe==="")return"";if(e.reverseFillMask===!0)return ve(pe);const Te=b;let Me=0,Ie="";for(let ke=0;ke<Te.length;ke++){const Be=pe[Me],Re=Te[ke];if(typeof Re=="string")Ie+=Re,Be===Re&&Me++;else if(Be!==void 0&&Re.regex.test(Be))Ie+=Re.transform!==void 0?Re.transform(Be):Be,Me++;else return Ie}return Ie}function ve(pe){const Te=b,Me=m.indexOf(cr);let Ie=pe.length-1,ke="";for(let Be=Te.length-1;Be>=0&&Ie>-1;Be--){const Re=Te[Be];let Ze=pe[Ie];if(typeof Re=="string")ke=Re+ke,Ze===Re&&Ie--;else if(Ze!==void 0&&Re.regex.test(Ze))do ke=(Re.transform!==void 0?Re.transform(Ze):Ze)+ke,Ie--,Ze=pe[Ie];while(Me===Be&&Ze!==void 0&&Re.regex.test(Ze));else return ke}return ke}function Ce(pe){return typeof pe!="string"||o===void 0?typeof pe=="number"?o(""+pe):pe:o(pe)}function ce(pe){return v.length-pe.length<=0?pe:e.reverseFillMask===!0&&pe.length>0?v.slice(0,-pe.length)+pe:pe+v.slice(pe.length)}return{innerValue:k,hasMask:S,moveCursorForPaste:Z,updateMaskValue:j,onMaskedKeydown:fe}}const a3=/[\u3000-\u303f\u3040-\u309f\u30a0-\u30ff\uff00-\uff9f\u4e00-\u9faf\u3400-\u4dbf]/,l3=/[\u4e00-\u9fff\u3400-\u4dbf\u{20000}-\u{2a6df}\u{2a700}-\u{2b73f}\u{2b740}-\u{2b81f}\u{2b820}-\u{2ceaf}\uf900-\ufaff\u3300-\u33ff\ufe30-\ufe4f\uf900-\ufaff\u{2f800}-\u{2fa1f}]/u,c3=/[\u3131-\u314e\u314f-\u3163\uac00-\ud7a3]/,u3=/[a-z0-9_ -]$/i;function C2(e){return function(u){if(u.type==="compositionend"||u.type==="change"){if(u.target.qComposing!==!0)return;u.target.qComposing=!1,e(u)}else u.type==="compositionupdate"&&u.target.qComposing!==!0&&typeof u.data=="string"&&(hi.is.firefox===!0?u3.test(u.data)===!1:a3.test(u.data)===!0||l3.test(u.data)===!0||c3.test(u.data)===!0)===!0&&(u.target.qComposing=!0)}}const rm=Un({name:"QInput",inheritAttrs:!1,props:{...Gd,...o3,...hg,modelValue:{required:!1},shadowText:String,type:{type:String,default:"text"},debounce:[String,Number],autogrow:Boolean,inputClass:[Array,String,Object],inputStyle:[Array,String,Object]},emits:[...lg,"paste","change"],setup(e,{emit:s,attrs:u}){const{proxy:f}=In(),{$q:m}=f,v={};let b=NaN,o,S,k,I;const L=xt(null),D=Yv(e),{innerValue:N,hasMask:j,moveCursorForPaste:Z,updateMaskValue:K,onMaskedKeydown:fe}=s3(e,s,Ye,L),te=T2(e,!0),ve=se(()=>oc(N.value)),Ce=C2(Ze),ce=cg(),pe=se(()=>e.type==="textarea"||e.autogrow===!0),Te=se(()=>pe.value===!0||["text","search","url","tel","password"].includes(e.type)),Me=se(()=>{const Ve={...ce.splitAttrs.listeners.value,onInput:Ze,onPaste:Re,onChange:Xt,onBlur:Ge,onFocus:to};return Ve.onCompositionstart=Ve.onCompositionupdate=Ve.onCompositionend=Ce,j.value===!0&&(Ve.onKeydown=fe),e.autogrow===!0&&(Ve.onAnimationend=lt),Ve}),Ie=se(()=>{const Ve={tabindex:0,"data-autofocus":e.autofocus===!0||void 0,rows:e.type==="textarea"?6:void 0,"aria-label":e.label,name:D.value,...ce.splitAttrs.attributes.value,id:ce.targetUid.value,maxlength:e.maxlength,disabled:e.disable===!0,readonly:e.readonly===!0};return pe.value===!1&&(Ve.type=e.type),e.autogrow===!0&&(Ve.rows=1),Ve});Ht(()=>e.type,()=>{L.value&&(L.value.value=e.modelValue)}),Ht(()=>e.modelValue,Ve=>{if(j.value===!0){if(S===!0&&(S=!1,String(Ve)===b))return;K(Ve)}else N.value!==Ve&&(N.value=Ve,e.type==="number"&&v.hasOwnProperty("value")===!0&&(o===!0?o=!1:delete v.value));e.autogrow===!0&&ui(lt)}),Ht(()=>e.autogrow,Ve=>{Ve===!0?ui(lt):L.value!==null&&u.rows>0&&(L.value.style.height="auto")}),Ht(()=>e.dense,()=>{e.autogrow===!0&&ui(lt)});function ke(){Km(()=>{const Ve=document.activeElement;L.value!==null&&L.value!==Ve&&(Ve===null||Ve.id!==ce.targetUid.value)&&L.value.focus({preventScroll:!0})})}function Be(){L.value!==null&&L.value.select()}function Re(Ve){if(j.value===!0&&e.reverseFillMask!==!0){const mt=Ve.target;Z(mt,mt.selectionStart,mt.selectionEnd)}s("paste",Ve)}function Ze(Ve){if(!Ve||!Ve.target)return;if(e.type==="file"){s("update:modelValue",Ve.target.files);return}const mt=Ve.target.value;if(Ve.target.qComposing===!0){v.value=mt;return}if(j.value===!0)K(mt,!1,Ve.inputType);else if(Ye(mt),Te.value===!0&&Ve.target===document.activeElement){const{selectionStart:Bt,selectionEnd:jt}=Ve.target;Bt!==void 0&&jt!==void 0&&ui(()=>{Ve.target===document.activeElement&&mt.indexOf(Ve.target.value)===0&&Ve.target.setSelectionRange(Bt,jt)})}e.autogrow===!0&&lt()}function Ye(Ve,mt){I=()=>{e.type!=="number"&&v.hasOwnProperty("value")===!0&&delete v.value,e.modelValue!==Ve&&b!==Ve&&(b=Ve,mt===!0&&(S=!0),s("update:modelValue",Ve),ui(()=>{b===Ve&&(b=NaN)})),I=void 0},e.type==="number"&&(o=!0,v.value=Ve),e.debounce!==void 0?(clearTimeout(k),v.value=Ve,k=setTimeout(I,e.debounce)):I()}function lt(){requestAnimationFrame(()=>{const Ve=L.value;if(Ve!==null){const mt=Ve.parentNode.style,{overflow:Bt}=Ve.style;m.platform.is.firefox!==!0&&(Ve.style.overflow="hidden"),Ve.style.height="1px",mt.marginBottom=Ve.scrollHeight-1+"px",Ve.style.height=Ve.scrollHeight+"px",Ve.style.overflow=Bt,mt.marginBottom=""}})}function Xt(Ve){Ce(Ve),clearTimeout(k),I!==void 0&&I(),s("change",Ve.target.value)}function Ge(Ve){Ve!==void 0&&to(Ve),clearTimeout(k),I!==void 0&&I(),o=!1,S=!1,delete v.value,e.type!=="file"&&setTimeout(()=>{L.value!==null&&(L.value.value=N.value!==void 0?N.value:"")})}function At(){return v.hasOwnProperty("value")===!0?v.value:N.value!==void 0?N.value:""}Ii(()=>{Ge()}),Ui(()=>{e.autogrow===!0&&lt()}),Object.assign(ce,{innerValue:N,fieldClass:se(()=>`q-${pe.value===!0?"textarea":"input"}`+(e.autogrow===!0?" q-textarea--autogrow":"")),hasShadow:se(()=>e.type!=="file"&&typeof e.shadowText=="string"&&e.shadowText.length>0),inputRef:L,emitValue:Ye,hasValue:ve,floatingLabel:se(()=>ve.value===!0||oc(e.displayValue)),getControl:()=>me(pe.value===!0?"textarea":"input",{ref:L,class:["q-field__native q-placeholder",e.inputClass],style:e.inputStyle,...Ie.value,...Me.value,...e.type!=="file"?{value:At()}:te.value}),getShadowControl:()=>me("div",{class:"q-field__native q-field__shadow absolute-bottom no-pointer-events"+(pe.value===!0?"":" text-no-wrap")},[me("span",{class:"invisible"},At()),me("span",e.shadowText)])});const tn=ug(ce);return Object.assign(f,{focus:ke,select:Be,getNativeElement:()=>L.value}),tn}});let qp=0;const h3={standard:"fixed-full flex-center",top:"fixed-top justify-center",bottom:"fixed-bottom justify-center",right:"fixed-right items-center",left:"fixed-left items-center"},$w={standard:["scale","scale"],top:["slide-down","slide-up"],bottom:["slide-up","slide-down"],right:["slide-left","slide-right"],left:["slide-right","slide-left"]},Cm=Un({name:"QDialog",inheritAttrs:!1,props:{...Pv,...$T,transitionShow:String,transitionHide:String,persistent:Boolean,autoClose:Boolean,allowFocusOutside:Boolean,noEscDismiss:Boolean,noBackdropDismiss:Boolean,noRouteDismiss:Boolean,noRefocus:Boolean,noFocus:Boolean,noShake:Boolean,seamless:Boolean,maximized:Boolean,fullWidth:Boolean,fullHeight:Boolean,square:Boolean,position:{type:String,default:"standard",validator:e=>e==="standard"||["top","bottom","left","right"].includes(e)}},emits:[...zv,"shake","click","escape-key"],setup(e,{slots:s,emit:u,attrs:f}){const m=In(),v=xt(null),b=xt(!1),o=xt(!1),S=xt(!1);let k,I=null,L,D;const N=se(()=>e.persistent!==!0&&e.noRouteDismiss!==!0&&e.seamless!==!0),{preventBodyScroll:j}=iS(),{registerTimeout:Z}=Rv(),{registerTick:K,removeTick:fe}=GT(),{showPortal:te,hidePortal:ve,portalIsAccessible:Ce,renderPortal:ce}=qT(m,v,ot,!0),{hide:pe}=Lv({showing:b,hideOnRouteChange:N,handleShow:Ge,handleHide:At,processOnMount:!0}),{addToHistory:Te,removeFromHistory:Me}=nS(b,pe,N),Ie=se(()=>`q-dialog__inner flex no-pointer-events q-dialog__inner--${e.maximized===!0?"maximized":"minimized"} q-dialog__inner--${e.position} ${h3[e.position]}`+(S.value===!0?" q-dialog__inner--animating":"")+(e.fullWidth===!0?" q-dialog__inner--fullwidth":"")+(e.fullHeight===!0?" q-dialog__inner--fullheight":"")+(e.square===!0?" q-dialog__inner--square":"")),ke=se(()=>"q-transition--"+(e.transitionShow===void 0?$w[e.position][0]:e.transitionShow)),Be=se(()=>"q-transition--"+(e.transitionHide===void 0?$w[e.position][1]:e.transitionHide)),Re=se(()=>o.value===!0?Be.value:ke.value),Ze=se(()=>`--q-transition-duration: ${e.transitionDuration}ms`),Ye=se(()=>b.value===!0&&e.seamless!==!0),lt=se(()=>e.autoClose===!0?{onClick:xn}:{}),Xt=se(()=>[`q-dialog fullscreen no-pointer-events q-dialog--${Ye.value===!0?"modal":"seamless"}`,f.class]);Ht(b,_t=>{ui(()=>{o.value=_t})}),Ht(()=>e.maximized,_t=>{b.value===!0&&jt(_t)}),Ht(Ye,_t=>{j(_t),_t===!0?(YT(gt),XT(mt)):(Ry(gt),gm(mt))});function Ge(_t){Te(),I=e.noRefocus===!1&&document.activeElement!==null?document.activeElement:null,jt(e.maximized),te(),S.value=!0,e.noFocus!==!0?(document.activeElement!==null&&document.activeElement.blur(),K(tn)):fe(),Z(()=>{if(m.proxy.$q.platform.is.ios===!0){if(e.seamless!==!0&&document.activeElement){const{top:ft,bottom:sn}=document.activeElement.getBoundingClientRect(),{innerHeight:un}=window,oe=window.visualViewport!==void 0?window.visualViewport.height:un;ft>0&&sn>oe/2&&(document.scrollingElement.scrollTop=Math.min(document.scrollingElement.scrollHeight-oe,sn>=un?1/0:Math.ceil(document.scrollingElement.scrollTop+sn-oe/2))),document.activeElement.scrollIntoView()}D=!0,v.value.click(),D=!1}te(!0),S.value=!1,u("show",_t)},e.transitionDuration)}function At(_t){fe(),Me(),Bt(!0),S.value=!0,ve(),I!==null&&(I.focus(),I=null),Z(()=>{ve(!0),S.value=!1,u("hide",_t)},e.transitionDuration)}function tn(_t){Km(()=>{let ft=v.value;ft===null||ft.contains(document.activeElement)===!0||(ft=ft.querySelector(_t||"[autofocus], [data-autofocus]")||ft,ft.focus({preventScroll:!0}))})}function Ve(){tn(),u("shake");const _t=v.value;_t!==null&&(_t.classList.remove("q-animate--scale"),_t.classList.add("q-animate--scale"),clearTimeout(k),k=setTimeout(()=>{v.value!==null&&(_t.classList.remove("q-animate--scale"),tn())},170))}function mt(){e.seamless!==!0&&(e.persistent===!0||e.noEscDismiss===!0?e.maximized!==!0&&e.noShake!==!0&&Ve():(u("escape-key"),pe()))}function Bt(_t){clearTimeout(k),(_t===!0||b.value===!0)&&(jt(!1),e.seamless!==!0&&(j(!1),Ry(gt),gm(mt))),_t!==!0&&(I=null)}function jt(_t){_t===!0?L!==!0&&(qp<1&&document.body.classList.add("q-body--dialog"),qp++,L=!0):L===!0&&(qp<2&&document.body.classList.remove("q-body--dialog"),qp--,L=!1)}function xn(_t){D!==!0&&(pe(_t),u("click",_t))}function rt(_t){e.persistent!==!0&&e.noBackdropDismiss!==!0?pe(_t):e.noShake!==!0&&Ve()}function gt(_t){e.allowFocusOutside!==!0&&Ce.value===!0&&AT(v.value,_t.target)!==!0&&tn('[tabindex]:not([tabindex="-1"])')}Object.assign(m.proxy,{focus:tn,shake:Ve,__updateRefocusTarget(_t){I=_t||null}}),Ii(Bt);function ot(){return me("div",{role:"dialog","aria-modal":Ye.value===!0?"true":"false",...f,class:Xt.value},[me(ea,{name:"q-transition--fade",appear:!0},()=>Ye.value===!0?me("div",{class:"q-dialog__backdrop fixed-full",style:Ze.value,"aria-hidden":"true",onMousedown:rt}):null),me(ea,{name:Re.value,appear:!0},()=>b.value===!0?me("div",{ref:v,class:Ie.value,style:Ze.value,tabindex:-1,...lt.value},bi(s.default)):null)])}return ce}});function Gw(e){if(e===!1)return 0;if(e===!0||e===void 0)return 1;const s=parseInt(e,10);return isNaN(s)?0:s}const om=Hm({name:"close-popup",beforeMount(e,{value:s}){const u={depth:Gw(s),handler(f){u.depth!==0&&setTimeout(()=>{const m=az(e);m!==void 0&&lz(m,f,u.depth)})},handlerKey(f){Ha(f,13)===!0&&u.handler(f)}};e.__qclosepopup=u,e.addEventListener("click",u.handler),e.addEventListener("keyup",u.handlerKey)},updated(e,{value:s,oldValue:u}){s!==u&&(e.__qclosepopup.depth=Gw(s))},beforeUnmount(e){const s=e.__qclosepopup;e.removeEventListener("click",s.handler),e.removeEventListener("keyup",s.handlerKey),delete e.__qclosepopup}}),A2={__name:"ImageCarousel",props:{images:Array},setup(e){const s=e,u=xt(0);return(f,m)=>(Yn(),Yi(w2,{modelValue:u.value,"onUpdate:modelValue":m[0]||(m[0]=v=>u.value=v),"transition-prev":"slide","transition-next":"slide",swipeable:"",animated:"","control-color":"white",navigation:"",padding:"",arrows:"",height:"200px",class:"bg-primary text-white shadow-1 rounded-borders"},{default:vn(()=>[(Yn(!0),no(Ki,null,Mu(s.images,(v,b)=>(Yn(),Yi(Xy,{key:b,name:b,class:"column no-wrap flex-center","img-src":`/images/${v}`,"img-alt":"Images will show next time you are online!"},null,8,["name","img-src"]))),128))]),_:1},8,["modelValue"]))}};var Zw;const dg=typeof window<"u",d3=e=>typeof e<"u",f3=e=>typeof e=="function";dg&&((Zw=window==null?void 0:window.navigator)==null?void 0:Zw.userAgent)&&/iP(ad|hone|od)/.test(window.navigator.userAgent);function p3(e){return e}dg&&window.document;dg&&window.navigator;dg&&window.location;function m3(e){return JSON.parse(JSON.stringify(e))}const Yy=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},Qy="__vueuse_ssr_handlers__";Yy[Qy]=Yy[Qy]||{};Yy[Qy];var Ww;(function(e){e.UP="UP",e.RIGHT="RIGHT",e.DOWN="DOWN",e.LEFT="LEFT",e.NONE="NONE"})(Ww||(Ww={}));var g3=Object.defineProperty,Hw=Object.getOwnPropertySymbols,_3=Object.prototype.hasOwnProperty,y3=Object.prototype.propertyIsEnumerable,Xw=(e,s,u)=>s in e?g3(e,s,{enumerable:!0,configurable:!0,writable:!0,value:u}):e[s]=u,v3=(e,s)=>{for(var u in s||(s={}))_3.call(s,u)&&Xw(e,u,s[u]);if(Hw)for(var u of Hw(s))y3.call(s,u)&&Xw(e,u,s[u]);return e};const x3={easeInSine:[.12,0,.39,0],easeOutSine:[.61,1,.88,1],easeInOutSine:[.37,0,.63,1],easeInQuad:[.11,0,.5,0],easeOutQuad:[.5,1,.89,1],easeInOutQuad:[.45,0,.55,1],easeInCubic:[.32,0,.67,0],easeOutCubic:[.33,1,.68,1],easeInOutCubic:[.65,0,.35,1],easeInQuart:[.5,0,.75,0],easeOutQuart:[.25,1,.5,1],easeInOutQuart:[.76,0,.24,1],easeInQuint:[.64,0,.78,0],easeOutQuint:[.22,1,.36,1],easeInOutQuint:[.83,0,.17,1],easeInExpo:[.7,0,.84,0],easeOutExpo:[.16,1,.3,1],easeInOutExpo:[.87,0,.13,1],easeInCirc:[.55,0,1,.45],easeOutCirc:[0,.55,.45,1],easeInOutCirc:[.85,0,.15,1],easeInBack:[.36,0,.66,-.56],easeOutBack:[.34,1.56,.64,1],easeInOutBack:[.68,-.6,.32,1.6]};v3({linear:p3},x3);function M2(e,s,u,f={}){var m,v,b;const{clone:o=!1,passive:S=!1,eventName:k,deep:I=!1,defaultValue:L}=f,D=In(),N=u||(D==null?void 0:D.emit)||((m=D==null?void 0:D.$emit)==null?void 0:m.bind(D))||((b=(v=D==null?void 0:D.proxy)==null?void 0:v.$emit)==null?void 0:b.bind(D==null?void 0:D.proxy));let j=k;s||(s="modelValue"),j=k||j||`update:${s.toString()}`;const Z=fe=>o?f3(o)?o(fe):m3(fe):fe,K=()=>d3(e[s])?Z(e[s]):L;if(S){const fe=K(),te=xt(fe);return Ht(()=>e[s],ve=>te.value=Z(ve)),Ht(te,ve=>{(ve!==e[s]||I)&&N(j,ve)},{deep:I}),te}else return se({get(){return K()},set(fe){N(j,fe)}})}const b3=(e,s)=>s.some(u=>e instanceof u);let Kw,Yw;function w3(){return Kw||(Kw=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function E3(){return Yw||(Yw=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const I2=new WeakMap,Jy=new WeakMap,k2=new WeakMap,hy=new WeakMap,Qv=new WeakMap;function T3(e){const s=new Promise((u,f)=>{const m=()=>{e.removeEventListener("success",v),e.removeEventListener("error",b)},v=()=>{u(Za(e.result)),m()},b=()=>{f(e.error),m()};e.addEventListener("success",v),e.addEventListener("error",b)});return s.then(u=>{u instanceof IDBCursor&&I2.set(u,e)}).catch(()=>{}),Qv.set(s,e),s}function S3(e){if(Jy.has(e))return;const s=new Promise((u,f)=>{const m=()=>{e.removeEventListener("complete",v),e.removeEventListener("error",b),e.removeEventListener("abort",b)},v=()=>{u(),m()},b=()=>{f(e.error||new DOMException("AbortError","AbortError")),m()};e.addEventListener("complete",v),e.addEventListener("error",b),e.addEventListener("abort",b)});Jy.set(e,s)}let ev={get(e,s,u){if(e instanceof IDBTransaction){if(s==="done")return Jy.get(e);if(s==="objectStoreNames")return e.objectStoreNames||k2.get(e);if(s==="store")return u.objectStoreNames[1]?void 0:u.objectStore(u.objectStoreNames[0])}return Za(e[s])},set(e,s,u){return e[s]=u,!0},has(e,s){return e instanceof IDBTransaction&&(s==="done"||s==="store")?!0:s in e}};function C3(e){ev=e(ev)}function A3(e){return e===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(s,...u){const f=e.call(dy(this),s,...u);return k2.set(f,s.sort?s.sort():[s]),Za(f)}:E3().includes(e)?function(...s){return e.apply(dy(this),s),Za(I2.get(this))}:function(...s){return Za(e.apply(dy(this),s))}}function M3(e){return typeof e=="function"?A3(e):(e instanceof IDBTransaction&&S3(e),b3(e,w3())?new Proxy(e,ev):e)}function Za(e){if(e instanceof IDBRequest)return T3(e);if(hy.has(e))return hy.get(e);const s=M3(e);return s!==e&&(hy.set(e,s),Qv.set(s,e)),s}const dy=e=>Qv.get(e);function P2(e,s,{blocked:u,upgrade:f,blocking:m,terminated:v}={}){const b=indexedDB.open(e,s),o=Za(b);return f&&b.addEventListener("upgradeneeded",S=>{f(Za(b.result),S.oldVersion,S.newVersion,Za(b.transaction),S)}),u&&b.addEventListener("blocked",S=>u(S.oldVersion,S.newVersion,S)),o.then(S=>{v&&S.addEventListener("close",()=>v()),m&&S.addEventListener("versionchange",k=>m(k.oldVersion,k.newVersion,k))}).catch(()=>{}),o}const I3=["get","getKey","getAll","getAllKeys","count"],k3=["put","add","delete","clear"],fy=new Map;function Qw(e,s){if(!(e instanceof IDBDatabase&&!(s in e)&&typeof s=="string"))return;if(fy.get(s))return fy.get(s);const u=s.replace(/FromIndex$/,""),f=s!==u,m=k3.includes(u);if(!(u in(f?IDBIndex:IDBObjectStore).prototype)||!(m||I3.includes(u)))return;const v=async function(b,...o){const S=this.transaction(b,m?"readwrite":"readonly");let k=S.store;return f&&(k=k.index(o.shift())),(await Promise.all([k[u](...o),m&&S.done]))[0]};return fy.set(s,v),v}C3(e=>({...e,get:(s,u,f)=>Qw(s,u)||e.get(s,u,f),has:(s,u)=>!!Qw(s,u)||e.has(s,u)}));let Sr=null;const P3=async()=>{Sr=await P2("tagsDB",1,{upgrade(e){e.createObjectStore("tags",{keyPath:"_id"}),e.createObjectStore("addedImages",{keyPath:"id"})}})},Zd=Cv("tagStore",()=>{const e=xt([]);let s=!0;const u=se(()=>Tn(e.value));async function f(){if(!s){let j=await Sr.getAll("tags");e.value=j.filter(Z=>!Z.isDeleted);return}try{const{data:j}=await zo.get("/api/tag/");e.value=j,await Sr.clear("tags"),e.value.forEach(Z=>{Sr.put("tags",Tn(Z))})}catch(j){console.error(j),s=!1,f()}}async function m(j,Z){if(!s){const K=await Sr.get("tags",j._id);Z.title&&(K.title=Z.title),Z.description&&(K.description=Z.description),Z.images&&(K.images=JSON.parse(JSON.stringify(Z.images))),Z.coords&&(K.coords=JSON.parse(JSON.stringify(Z.coords))),K.edit=!0,await Sr.put("tags",Tn(K)),await f();return}try{const K=await zo.post(`/api/tag/upload/${j._id}`,{updatedFields:Z});console.log(K)}catch(K){console.error(K),s=!1,m(j,Z)}}async function v(j){if(!s){const K=(await Sr.getAll("addedImages")).length,fe=[];return await j.forEach((te,ve)=>{Sr.put("addedImages",{id:K+ve,blob:te}),fe.push({filename:K+ve})}),fe}try{const Z=new FormData;j.forEach(fe=>{Z.append("image",fe)});const{data:K}=await zo.post("/api/tag/image",Z,{headers:{"Content-Type":"multipart/form-data"}});return console.log(K),K}catch(Z){console.error(Z),s=!1,v(j)}}async function b(j){if(!s){const Z=await Sr.get("tags",j._id);Z.isDeleted=!0,await Sr.put("tags",Tn(Z)),e.value.splice(e.value.findIndex(K=>K._id==j._id),1);return}try{await zo.delete(`/api/tag/${j._id}`),e.value.splice(e.value.findIndex(Z=>Z._id==j._id),1)}catch(Z){console.error(Z),s=!1,b(j)}}async function o(j){if(!s){const Z=await Sr.get("tags",j._id);Z.favourite===void 0&&(Z.favourite=!1),Z.favourite=!Z.favourite,Z.edit=!0,await Sr.put("tags",Tn(Z)),e.value.find(K=>K._id===j._id).favourite=Z.favourite;return}try{await zo.post(`/api/tag/favourite/${j._id}`);const Z=e.value.find(K=>K._id===j._id);Z.favourite=!Z.favourite}catch(Z){console.error(Z),s=!1,o(j)}}async function S(j){if(!s){await Sr.put("tags",Tn({_id:e.value.length,title:j.title,description:j.description,images:j.images,coords:j.coords,new:!0})),f();return}try{await zo.post("/api/tag",{updatedFields:j}),f()}catch(Z){console.error(Z),s=!1,S(j)}}function k(j){s=j}async function I(){Sr||await P3()}async function L(j){const Z=await Sr.getAll("addedImages"),K=[];let fe;if(j.images.forEach(te=>{Z.find(ve=>ve.id===te)&&K.push(Z.find(ve=>ve.id===te))}),K.length!==0){const te=K.map(ve=>ve.blob);fe=await v(te),fe.forEach(()=>j.images.pop()),console.log(fe),fe.forEach(ve=>j.images.push(ve.filename)),console.log(fe)}delete j.new,delete j._id,delete j.edit,await S(j)}async function D(j){const Z=await Sr.getAll("addedImages"),K=[];let fe;if(j.images.forEach(ve=>{Z.find(Ce=>Ce.id===ve)&&K.push(Z.find(Ce=>Ce.id===ve))}),K.length!==0){const ve=K.map(Ce=>Ce.blob);fe=await v(ve),fe.forEach(()=>j.images.pop()),console.log(fe),fe.forEach(Ce=>j.images.push(Ce.filename)),console.log(fe)}const te=j;delete te.new,delete te.edit,await m(j,te)}async function N(){try{await(await Sr.getAll("tags")).forEach(Z=>{Z.isDeleted?b(Z):Z.new?L(Z):Z.edit&&D(Z)}),await f()}catch(j){console.error(j),s=!1;return}}return{getUserTags:f,updateTag:m,uploadAddedImages:v,deleteTag:b,favouriteTag:o,createTag:S,updateOnline:k,createDB:I,sync:N,tags:e,tagsGetter:u}},{persist:!0}),z3={class:"text-h3",style:{"font-family":"BlankRiver"}},L3=Ar("p",{class:"text-h5"},"Willst du diesen Tag wirklich l\xF6schen?",-1),R3={class:"text-subtitle1"},D3={style:{"font-family":"blankRiver"}},O3={__name:"BigCardPopUP",props:{toggle:Boolean,currentTag:Object},emits:["update:toggle"],setup(e,{emit:s}){const u=e,f=Zd(),m="pk.eyJ1IjoidG9iaXdhbmtpcm5vYmkiLCJhIjoiY2xlNXBuc2g1MGY4YzNxcWkxcWNtZ3N2ZCJ9.qWMZQd_uuqNnTDb9QcBtiQ",v=xt(),b=xt([]),o=[],S=xt(0),k=xt(!1),I=xt(""),L=xt(!1),D=xt(),N=xt([]),j=xt(),Z=xt([]),K=M2(u,"toggle",s),fe=()=>{D.value=u.currentTag.title,j.value=u.currentTag.description,N.value=JSON.parse(JSON.stringify(u.currentTag.images)),Z.value.longitude=u.currentTag.coords.longitude,Z.value.latitude=u.currentTag.coords.latitude,b.value.splice(0,b.value.length),o.splice(0,o.length)},te=()=>{fe(),L.value=!1},ve=()=>{fe(),L.value=!L.value},Ce=ke=>{console.log(ke.target.getLngLat());const{lng:Be,lat:Re}=ke.target.getLngLat();Z.value.longitude=Be,Z.value.latitude=Re},ce=async()=>{b.value.length>0&&(await f.uploadAddedImages(o)).forEach(Re=>N.value.push(Re.filename));const ke={};D.value!==u.currentTag.title&&(ke.title=D.value),j.value!==u.currentTag.description&&(ke.description=j.value),Z.value!==u.currentTag.coords&&(ke.coords={longitude:Z.value.longitude,latitude:Z.value.latitude}),N.value!==JSON.parse(JSON.stringify(u.currentTag.images))&&(ke.images=N.value),f.updateTag(u.currentTag,ke),f.getUserTags(),fe(),L.value=!L.value},pe=ke=>{console.log(ke),b.value.push(URL.createObjectURL(ke)),o.push(ke),console.log(ke),v.value=null},Te=ke=>{const Be=N.value.findIndex(Re=>Re===ke);N.value.splice(Be,1)},Me=ke=>{const Be=b.value.findIndex(Re=>Re===ke);b.value.splice(Be,1),o.splice(Be,1)},Ie=()=>{f.deleteTag(u.currentTag),f.getUserTags(),s("update:toggle",!1)};return(ke,Be)=>(Yn(),no(Ki,null,[Ut(Cm,{modelValue:Bn(K),"onUpdate:modelValue":Be[10]||(Be[10]=Re=>Vi(K)?K.value=Re:null),persistent:"",maximized:!0,"transition-show":"slide-up","transition-hide":"slide-down"},{default:vn(()=>[L.value?Es("",!0):(Yn(),Yi(Md,{key:0,class:"bg-white text-balck"},{default:vn(()=>[Ut(Hy,{class:"bg-primary text-white flex justify-center"},{default:vn(()=>[Ql(Ut(Ci,{dense:"",flat:"","font-size":"30px",icon:"expand_more"},null,512),[[om]])]),_:1}),Ut(A2,{images:e.currentTag.images},null,8,["images"]),Ut(Ws,null,{default:vn(()=>[Ar("p",z3,Hs(e.currentTag.title),1),Ar("p",null,Hs(e.currentTag.description),1)]),_:1}),Ut(Ws,null,{default:vn(()=>[Ut(Bn(Zy),{style:{height:"200px"},ref:"mapboxMap","access-token":Bn(m),"map-style":"mapbox://styles/tobiwankirnobi/cle5t3xjp001b01o4s7negt5k",center:[e.currentTag.coords.longitude,e.currentTag.coords.latitude],zoom:10},{default:vn(()=>[Ut(Bn(Wy),{"lng-lat":[e.currentTag.coords.longitude,e.currentTag.coords.latitude]},null,8,["lng-lat"])]),_:1},8,["access-token","center"])]),_:1}),Ut(Ws,{class:"q-pt-none"}),Ut(ly,{class:"fixed-bottom q-pa-md",align:"around"},{default:vn(()=>[Ut(Ci,{class:"bg-primary text-white",square:"",rouded:"",icon:"edit",onClick:Be[0]||(Be[0]=Re=>ve())}),Ut(Ci,{class:"bg-primary text-white",square:"",rouded:"",icon:"delete",onClick:Be[1]||(Be[1]=Re=>k.value=!0)})]),_:1})]),_:1})),L.value?(Yn(),Yi(Md,{key:1,class:"bg-white text-balck"},{default:vn(()=>[Ut(Hy,{class:"bg-primary text-white flex justify-center"},{default:vn(()=>[Ql(Ut(Ci,{dense:"",flat:"","font-size":"30px",icon:"expand_more"},null,512),[[om]])]),_:1}),Ut(w2,{modelValue:S.value,"onUpdate:modelValue":Be[2]||(Be[2]=Re=>S.value=Re),"transition-prev":"slide","transition-next":"slide",swipeable:"",animated:"","control-color":"white",navigation:"",padding:"",arrows:"",height:"35%",class:"bg-primary text-white shadow-1 rounded-borders"},{default:vn(()=>[(Yn(!0),no(Ki,null,Mu(N.value,(Re,Ze)=>(Yn(),Yi(Xy,{key:Ze,name:Ze,class:"column no-wrap flex-center","img-src":`/images/${Re}`},{default:vn(()=>[Ut(Ci,{class:"absolute-top-right rouded bg-primary q-ma-md",icon:"delete",style:{"z-index":"1"},onClick:Ye=>Te(Re)},null,8,["onClick"])]),_:2},1032,["name","img-src"]))),128)),(Yn(!0),no(Ki,null,Mu(b.value,(Re,Ze)=>(Yn(),Yi(Xy,{key:Ze,name:Ze+N.value.length,class:"column no-wrap flex-center","img-src":Re},{default:vn(()=>[Ut(Ci,{class:"absolute-top-right rouded bg-primary q-ma-md",icon:"delete",style:{"z-index":"1"},onClick:Ye=>Me(Re)},null,8,["onClick"])]),_:2},1032,["name","img-src"]))),128))]),_:1},8,["modelValue"]),Ut(Ws,null,{default:vn(()=>[Ut(i3,{standout:"",modelValue:v.value,"onUpdate:modelValue":[Be[3]||(Be[3]=Re=>v.value=Re),Be[4]||(Be[4]=Re=>pe(Re))],label:"Standout",lable:"Upload Image"},null,8,["modelValue"]),Ut(rm,{standout:"bg-primary text-white",modelValue:D.value,"onUpdate:modelValue":Be[5]||(Be[5]=Re=>D.value=Re),label:"Title"},null,8,["modelValue"]),Ut(rm,{standout:"bg-primary text-white",modelValue:j.value,"onUpdate:modelValue":Be[6]||(Be[6]=Re=>j.value=Re),label:"description"},null,8,["modelValue"])]),_:1}),Ut(Ws,{class:"q-pt-none"},{default:vn(()=>[Ut(Bn(Zy),{style:{height:"200px"},ref:"mapboxMap","access-token":Bn(m),"map-style":"mapbox://styles/tobiwankirnobi/cle5t3xjp001b01o4s7negt5k",center:[Z.value.longitude,Z.value.latitude],zoom:10},{default:vn(()=>[Ut(Bn(Wy),{"lng-lat":[Z.value.longitude,Z.value.latitude],draggable:"",onMbDragend:Be[7]||(Be[7]=Re=>Ce(Re))},null,8,["lng-lat"])]),_:1},8,["access-token","center"])]),_:1}),Ut(ly,{class:"fixed-bottom q-pa-md",align:"around"},{default:vn(()=>[Ut(Ci,{class:"bg-primary text-white",square:"",rouded:"",icon:"close",onClick:Be[8]||(Be[8]=Re=>te())}),Ut(Ci,{class:"bg-primary text-white",square:"",rouded:"",icon:"done",onClick:Be[9]||(Be[9]=Re=>ce())})]),_:1})]),_:1})):Es("",!0)]),_:1},8,["modelValue"]),Ut(Cm,{modelValue:k.value,"onUpdate:modelValue":Be[13]||(Be[13]=Re=>k.value=Re),persistent:""},{default:vn(()=>[Ut(Md,{calss:"q-ma-md"},{default:vn(()=>[Ut(Ws,null,{default:vn(()=>[L3,Ar("p",R3,[Bd("Titel: "),Ar("span",D3,Hs(e.currentTag.title),1)]),Ut(rm,{modelValue:I.value,"onUpdate:modelValue":Be[11]||(Be[11]=Re=>I.value=Re),label:"Gib den Namen des Tags ein um zu best\xE4tigen"},null,8,["modelValue"])]),_:1}),Ut(ly,{align:"center"},{default:vn(()=>[Ql(Ut(Ci,{class:"bg-primary text-white",icon:"close"},null,512),[[om]]),Ut(Ci,{class:"bg-negative text-white",disable:I.value!==e.currentTag.title,icon:"delete",onClick:Be[12]||(Be[12]=Re=>Ie())},null,8,["disable"])]),_:1})]),_:1})]),_:1},8,["modelValue"])],64))}},z2=Un({name:"QTh",props:{props:Object,autoWidth:Boolean},emits:["click"],setup(e,{slots:s,emit:u}){const f=In(),{proxy:{$q:m}}=f,v=b=>{u("click",b)};return()=>{if(e.props===void 0)return me("th",{class:e.autoWidth===!0?"q-table--col-auto-width":"",onClick:v},bi(s.default));let b,o;const S=f.vnode.key;if(S){if(b=e.props.colsMap[S],b===void 0)return}else b=e.props.col;if(b.sortable===!0){const I=b.align==="right"?"unshift":"push";o=Av(s.default,[]),o[I](me(Wr,{class:b.__iconClass,name:m.iconSet.table.arrowUp}))}else o=bi(s.default);const k={class:b.__thClass+(e.autoWidth===!0?" q-table--col-auto-width":""),style:b.headerStyle,onClick:I=>{b.sortable===!0&&e.props.sort(b),v(I)}};return me("th",k,o)}}}),B3=Un({name:"QTr",props:{props:Object,noHover:Boolean},setup(e,{slots:s}){const u=se(()=>"q-tr"+(e.props===void 0||e.props.header===!0?"":" "+e.props.__trClass)+(e.noHover===!0?" q-tr--no-hover":""));return()=>me("tr",{class:u.value},bi(s.default))}}),F3={ratio:[String,Number]};function N3(e,s){return se(()=>{const u=Number(e.ratio||(s!==void 0?s.value:void 0));return isNaN(u)!==!0&&u>0?{paddingBottom:`${100/u}%`}:null})}const V3=16/9,U3=Un({name:"QImg",props:{...F3,src:String,srcset:String,sizes:String,alt:String,crossorigin:String,decoding:String,referrerpolicy:String,draggable:Boolean,loading:{type:String,default:"lazy"},fetchpriority:{type:String,default:"auto"},width:String,height:String,initialRatio:{type:[Number,String],default:V3},placeholderSrc:String,fit:{type:String,default:"cover"},position:{type:String,default:"50% 50%"},imgClass:String,imgStyle:Object,noSpinner:Boolean,noNativeMenu:Boolean,noTransition:Boolean,spinnerColor:String,spinnerSize:String},emits:["load","error"],setup(e,{slots:s,emit:u}){const f=xt(e.initialRatio),m=N3(e,f);let v;const b=[xt(null),xt(e.placeholderSrc!==void 0?{src:e.placeholderSrc}:null)],o=xt(0),S=xt(!1),k=xt(!1),I=se(()=>`q-img q-img--${e.noNativeMenu===!0?"no-":""}menu`),L=se(()=>({width:e.width,height:e.height})),D=se(()=>`q-img__image ${e.imgClass!==void 0?e.imgClass+" ":""}q-img__image--with${e.noTransition===!0?"out":""}-transition`),N=se(()=>({...e.imgStyle,objectFit:e.fit,objectPosition:e.position}));Ht(()=>j(),Z);function j(){return e.src||e.srcset||e.sizes?{src:e.src,srcset:e.srcset,sizes:e.sizes}:null}function Z(Te){if(clearTimeout(v),k.value=!1,Te===null){S.value=!1,b[0].value=null,b[1].value=null;return}S.value=!0,b[o.value].value=Te}function K({target:Te}){v!==null&&(clearTimeout(v),f.value=Te.naturalHeight===0?.5:Te.naturalWidth/Te.naturalHeight,fe(Te,1))}function fe(Te,Me){v===null||Me===1e3||(Te.complete===!0?te(Te):v=setTimeout(()=>{fe(Te,Me+1)},50))}function te(Te){v!==null&&(o.value=o.value===1?0:1,b[o.value].value=null,S.value=!1,k.value=!1,u("load",Te.currentSrc||Te.src))}function ve(Te){clearTimeout(v),S.value=!1,k.value=!0,b[0].value=null,b[1].value=null,u("error",Te)}function Ce(Te,Me){return me("div",{class:"q-img__container absolute-full",key:Te},Me)}function ce(Te){const Me=b[Te].value,Ie={key:"img_"+Te,class:D.value,style:N.value,crossorigin:e.crossorigin,decoding:e.decoding,referrerpolicy:e.referrerpolicy,height:e.height,width:e.width,loading:e.loading,fetchpriority:e.fetchpriority,"aria-hidden":"true",draggable:e.draggable,...Me};return o.value===Te?(Ie.class+=" q-img__image--waiting",Object.assign(Ie,{onLoad:K,onError:ve})):Ie.class+=" q-img__image--loaded",Ce("img"+Te,me("img",Ie))}function pe(){return S.value!==!0?me("div",{key:"content",class:"q-img__content absolute-full q-anchor--skip"},bi(s[k.value===!0?"error":"default"])):me("div",{key:"loading",class:"q-img__loading absolute-full flex flex-center"},s.loading!==void 0?s.loading():e.noSpinner===!0?void 0:[me(Xm,{color:e.spinnerColor,size:e.spinnerSize})])}return Z(j()),Ii(()=>{clearTimeout(v),v=null}),()=>{const Te=[];return m.value!==null&&Te.push(me("div",{key:"filler",style:m.value})),k.value!==!0&&(b[0].value!==null&&Te.push(ce(0)),b[1].value!==null&&Te.push(ce(1))),Te.push(me(ea,{name:"q-transition--fade"},pe)),me("div",{class:I.value,style:L.value,role:"img","aria-label":e.alt},Te)}}}),j3=Un({name:"QTd",props:{props:Object,autoWidth:Boolean,noHover:Boolean},setup(e,{slots:s}){const u=In(),f=se(()=>"q-td"+(e.autoWidth===!0?" q-table--col-auto-width":"")+(e.noHover===!0?" q-td--no-hover":"")+" ");return()=>{if(e.props===void 0)return me("td",{class:f.value},bi(s.default));const m=u.vnode.key,v=(e.props.colsMap!==void 0?e.props.colsMap[m]:null)||e.props.col;if(v===void 0)return;const{row:b}=e.props;return me("td",{class:f.value+v.__tdClass(b),style:v.__tdStyle(b)},bi(s.default))}}}),q3={true:"inset",item:"item-inset","item-thumbnail":"item-thumbnail-inset"},py={xs:2,sm:4,md:8,lg:16,xl:24},L2=Un({name:"QSeparator",props:{...io,spaced:[Boolean,String],inset:[Boolean,String],vertical:Boolean,color:String,size:String},setup(e){const s=In(),u=ro(e,s.proxy.$q),f=se(()=>e.vertical===!0?"vertical":"horizontal"),m=se(()=>` q-separator--${f.value}`),v=se(()=>e.inset!==!1?`${m.value}-${q3[e.inset]}`:""),b=se(()=>`q-separator${m.value}${v.value}`+(e.color!==void 0?` bg-${e.color}`:"")+(u.value===!0?" q-separator--dark":"")),o=se(()=>{const S={};if(e.size!==void 0&&(S[e.vertical===!0?"width":"height"]=e.size),e.spaced!==!1){const k=e.spaced===!0?`${py.md}px`:e.spaced in py?`${py[e.spaced]}px`:e.spaced,I=e.vertical===!0?["Left","Right"]:["Top","Bottom"];S[`margin${I[0]}`]=S[`margin${I[1]}`]=k}return S});return()=>me("hr",{class:b.value,style:o.value,"aria-orientation":f.value})}}),$3=["horizontal","vertical","cell","none"],G3=Un({name:"QMarkupTable",props:{...io,dense:Boolean,flat:Boolean,bordered:Boolean,square:Boolean,wrapCells:Boolean,separator:{type:String,default:"horizontal",validator:e=>$3.includes(e)}},setup(e,{slots:s}){const u=In(),f=ro(e,u.proxy.$q),m=se(()=>`q-markup-table q-table__container q-table__card q-table--${e.separator}-separator`+(f.value===!0?" q-table--dark q-table__card--dark q-dark":"")+(e.dense===!0?" q-table--dense":"")+(e.flat===!0?" q-table--flat":"")+(e.bordered===!0?" q-table--bordered":"")+(e.square===!0?" q-table--square":"")+(e.wrapCells===!1?" q-table--no-wrap":""));return()=>me("div",{class:m.value},[me("table",{class:"q-table"},bi(s.default))])}});function R2(e,s){return me("div",e,[me("table",{class:"q-table"},s)])}let Am=!1;{const e=document.createElement("div");e.setAttribute("dir","rtl"),Object.assign(e.style,{width:"1px",height:"1px",overflow:"auto"});const s=document.createElement("div");Object.assign(s.style,{width:"1000px",height:"1px"}),document.body.appendChild(e),e.appendChild(s),e.scrollLeft=-1e3,Am=e.scrollLeft>=0,e.remove()}const Xo=1e3,Z3=["start","center","end","start-force","center-force","end-force"],D2=Array.prototype.filter,W3=window.getComputedStyle(document.body).overflowAnchor===void 0?Cs:function(e,s){e!==null&&(cancelAnimationFrame(e._qOverflowAnimationFrame),e._qOverflowAnimationFrame=requestAnimationFrame(()=>{if(e===null)return;const u=e.children||[];D2.call(u,m=>m.dataset&&m.dataset.qVsAnchor!==void 0).forEach(m=>{delete m.dataset.qVsAnchor});const f=u[s];f&&f.dataset&&(f.dataset.qVsAnchor="")}))};function Su(e,s){return e+s}function my(e,s,u,f,m,v,b,o){const S=e===window?document.scrollingElement||document.documentElement:e,k=m===!0?"offsetWidth":"offsetHeight",I={scrollStart:0,scrollViewSize:-b-o,scrollMaxSize:0,offsetStart:-b,offsetEnd:-o};if(m===!0?(e===window?(I.scrollStart=window.pageXOffset||window.scrollX||document.body.scrollLeft||0,I.scrollViewSize+=document.documentElement.clientWidth):(I.scrollStart=S.scrollLeft,I.scrollViewSize+=S.clientWidth),I.scrollMaxSize=S.scrollWidth,v===!0&&(I.scrollStart=(Am===!0?I.scrollMaxSize-I.scrollViewSize:0)-I.scrollStart)):(e===window?(I.scrollStart=window.pageYOffset||window.scrollY||document.body.scrollTop||0,I.scrollViewSize+=document.documentElement.clientHeight):(I.scrollStart=S.scrollTop,I.scrollViewSize+=S.clientHeight),I.scrollMaxSize=S.scrollHeight),u!==null)for(let L=u.previousElementSibling;L!==null;L=L.previousElementSibling)L.classList.contains("q-virtual-scroll--skip")===!1&&(I.offsetStart+=L[k]);if(f!==null)for(let L=f.nextElementSibling;L!==null;L=L.nextElementSibling)L.classList.contains("q-virtual-scroll--skip")===!1&&(I.offsetEnd+=L[k]);if(s!==e){const L=S.getBoundingClientRect(),D=s.getBoundingClientRect();m===!0?(I.offsetStart+=D.left-L.left,I.offsetEnd-=D.width):(I.offsetStart+=D.top-L.top,I.offsetEnd-=D.height),e!==window&&(I.offsetStart+=I.scrollStart),I.offsetEnd+=I.scrollMaxSize-I.offsetStart}return I}function Jw(e,s,u,f){s==="end"&&(s=(e===window?document.body:e)[u===!0?"scrollWidth":"scrollHeight"]),e===window?u===!0?(f===!0&&(s=(Am===!0?document.body.scrollWidth-document.documentElement.clientWidth:0)-s),window.scrollTo(s,window.pageYOffset||window.scrollY||document.body.scrollTop||0)):window.scrollTo(window.pageXOffset||window.scrollX||document.body.scrollLeft||0,s):u===!0?(f===!0&&(s=(Am===!0?e.scrollWidth-e.offsetWidth:0)-s),e.scrollLeft=s):e.scrollTop=s}function _d(e,s,u,f){if(u>=f)return 0;const m=s.length,v=Math.floor(u/Xo),b=Math.floor((f-1)/Xo)+1;let o=e.slice(v,b).reduce(Su,0);return u%Xo!==0&&(o-=s.slice(v*Xo,u).reduce(Su,0)),f%Xo!==0&&f!==m&&(o-=s.slice(f,b*Xo).reduce(Su,0)),o}const O2={virtualScrollSliceSize:{type:[Number,String],default:null},virtualScrollSliceRatioBefore:{type:[Number,String],default:1},virtualScrollSliceRatioAfter:{type:[Number,String],default:1},virtualScrollItemSize:{type:[Number,String],default:24},virtualScrollStickySizeStart:{type:[Number,String],default:0},virtualScrollStickySizeEnd:{type:[Number,String],default:0},tableColspan:[Number,String]},B2=Object.keys(O2),F2={virtualScrollHorizontal:Boolean,onVirtualScroll:Function,...O2};function N2({virtualScrollLength:e,getVirtualScrollTarget:s,getVirtualScrollEl:u,virtualScrollItemSizeComputed:f}){const m=In(),{props:v,emit:b,proxy:o}=m,{$q:S}=o;let k,I,L,D=[],N;const j=xt(0),Z=xt(0),K=xt({}),fe=xt(null),te=xt(null),ve=xt(null),Ce=xt({from:0,to:0}),ce=se(()=>v.tableColspan!==void 0?v.tableColspan:100);f===void 0&&(f=se(()=>v.virtualScrollItemSize));const pe=se(()=>f.value+";"+v.virtualScrollHorizontal),Te=se(()=>pe.value+";"+v.virtualScrollSliceRatioBefore+";"+v.virtualScrollSliceRatioAfter);Ht(Te,()=>{Xt()}),Ht(pe,Me);function Me(){lt(I,!0)}function Ie(mt){lt(mt===void 0?I:mt)}function ke(mt,Bt){const jt=s();if(jt==null||jt.nodeType===8)return;const xn=my(jt,u(),fe.value,te.value,v.virtualScrollHorizontal,S.lang.rtl,v.virtualScrollStickySizeStart,v.virtualScrollStickySizeEnd);L!==xn.scrollViewSize&&Xt(xn.scrollViewSize),Re(jt,xn,Math.min(e.value-1,Math.max(0,parseInt(mt,10)||0)),0,Z3.indexOf(Bt)>-1?Bt:I>-1&&mt>I?"end":"start")}function Be(){const mt=s();if(mt==null||mt.nodeType===8)return;const Bt=my(mt,u(),fe.value,te.value,v.virtualScrollHorizontal,S.lang.rtl,v.virtualScrollStickySizeStart,v.virtualScrollStickySizeEnd),jt=e.value-1,xn=Bt.scrollMaxSize-Bt.offsetStart-Bt.offsetEnd-Z.value;if(k===Bt.scrollStart)return;if(Bt.scrollMaxSize<=0){Re(mt,Bt,0,0);return}L!==Bt.scrollViewSize&&Xt(Bt.scrollViewSize),Ze(Ce.value.from);const rt=Math.floor(Bt.scrollMaxSize-Math.max(Bt.scrollViewSize,Bt.offsetEnd)-Math.min(N[jt],Bt.scrollViewSize/2));if(rt>0&&Math.ceil(Bt.scrollStart)>=rt){Re(mt,Bt,jt,Bt.scrollMaxSize-Bt.offsetEnd-D.reduce(Su,0));return}let gt=0,ot=Bt.scrollStart-Bt.offsetStart,_t=ot;if(ot<=xn&&ot+Bt.scrollViewSize>=j.value)ot-=j.value,gt=Ce.value.from,_t=ot;else for(let ft=0;ot>=D[ft]&&gt<jt;ft++)ot-=D[ft],gt+=Xo;for(;ot>0&&gt<jt;)ot-=N[gt],ot>-Bt.scrollViewSize?(gt++,_t=ot):_t=N[gt]+ot;Re(mt,Bt,gt,_t)}function Re(mt,Bt,jt,xn,rt){const gt=typeof rt=="string"&&rt.indexOf("-force")>-1,ot=gt===!0?rt.replace("-force",""):rt,_t=ot!==void 0?ot:"start";let ft=Math.max(0,jt-K.value[_t]),sn=ft+K.value.total;sn>e.value&&(sn=e.value,ft=Math.max(0,sn-K.value.total)),k=Bt.scrollStart;const un=ft!==Ce.value.from||sn!==Ce.value.to;if(un===!1&&ot===void 0){At(jt);return}const{activeElement:oe}=document,be=ve.value;un===!0&&be!==null&&be!==oe&&be.contains(oe)===!0&&(be.addEventListener("focusout",Ye),setTimeout(()=>{be!==null&&be.removeEventListener("focusout",Ye)})),W3(be,jt-ft);const Fe=ot!==void 0?N.slice(ft,jt).reduce(Su,0):0;if(un===!0){const nt=sn>=Ce.value.from&&ft<=Ce.value.to?Ce.value.to:sn;Ce.value={from:ft,to:nt},j.value=_d(D,N,0,ft),Z.value=_d(D,N,sn,e.value),requestAnimationFrame(()=>{Ce.value.to!==sn&&k===Bt.scrollStart&&(Ce.value={from:Ce.value.from,to:sn},Z.value=_d(D,N,sn,e.value))})}requestAnimationFrame(()=>{if(k!==Bt.scrollStart)return;un===!0&&Ze(ft);const nt=N.slice(ft,jt).reduce(Su,0),yt=nt+Bt.offsetStart+j.value,zt=yt+N[jt];let Nt=yt+xn;if(ot!==void 0){const kt=nt-Fe,bt=Bt.scrollStart+kt;Nt=gt!==!0&&bt<yt&&zt<bt+Bt.scrollViewSize?bt:ot==="end"?zt-Bt.scrollViewSize:yt-(ot==="start"?0:Math.round((Bt.scrollViewSize-N[jt])/2))}k=Nt,Jw(mt,Nt,v.virtualScrollHorizontal,S.lang.rtl),At(jt)})}function Ze(mt){const Bt=ve.value;if(Bt){const jt=D2.call(Bt.children,ft=>ft.classList&&ft.classList.contains("q-virtual-scroll--skip")===!1),xn=jt.length,rt=v.virtualScrollHorizontal===!0?ft=>ft.getBoundingClientRect().width:ft=>ft.offsetHeight;let gt=mt,ot,_t;for(let ft=0;ft<xn;){for(ot=rt(jt[ft]),ft++;ft<xn&&jt[ft].classList.contains("q-virtual-scroll--with-prev")===!0;)ot+=rt(jt[ft]),ft++;_t=ot-N[gt],_t!==0&&(N[gt]+=_t,D[Math.floor(gt/Xo)]+=_t),gt++}}}function Ye(){ve.value!==null&&ve.value!==void 0&&ve.value.focus()}function lt(mt,Bt){const jt=1*f.value;(Bt===!0||Array.isArray(N)===!1)&&(N=[]);const xn=N.length;N.length=e.value;for(let gt=e.value-1;gt>=xn;gt--)N[gt]=jt;const rt=Math.floor((e.value-1)/Xo);D=[];for(let gt=0;gt<=rt;gt++){let ot=0;const _t=Math.min((gt+1)*Xo,e.value);for(let ft=gt*Xo;ft<_t;ft++)ot+=N[ft];D.push(ot)}I=-1,k=void 0,j.value=_d(D,N,0,Ce.value.from),Z.value=_d(D,N,Ce.value.to,e.value),mt>=0?(Ze(Ce.value.from),ui(()=>{ke(mt)})):tn()}function Xt(mt){if(mt===void 0&&typeof window<"u"){const ot=s();ot!=null&&ot.nodeType!==8&&(mt=my(ot,u(),fe.value,te.value,v.virtualScrollHorizontal,S.lang.rtl,v.virtualScrollStickySizeStart,v.virtualScrollStickySizeEnd).scrollViewSize)}L=mt;const Bt=parseFloat(v.virtualScrollSliceRatioBefore)||0,jt=parseFloat(v.virtualScrollSliceRatioAfter)||0,xn=1+Bt+jt,rt=mt===void 0||mt<=0?1:Math.ceil(mt/f.value),gt=Math.max(1,rt,Math.ceil((v.virtualScrollSliceSize>0?v.virtualScrollSliceSize:10)/xn));K.value={total:Math.ceil(gt*xn),start:Math.ceil(gt*Bt),center:Math.ceil(gt*(.5+Bt)),end:Math.ceil(gt*(1+Bt)),view:rt}}function Ge(mt,Bt){const jt=v.virtualScrollHorizontal===!0?"width":"height",xn={["--q-virtual-scroll-item-"+jt]:f.value+"px"};return[mt==="tbody"?me(mt,{class:"q-virtual-scroll__padding",key:"before",ref:fe},[me("tr",[me("td",{style:{[jt]:`${j.value}px`,...xn},colspan:ce.value})])]):me(mt,{class:"q-virtual-scroll__padding",key:"before",ref:fe,style:{[jt]:`${j.value}px`,...xn}}),me(mt,{class:"q-virtual-scroll__content",key:"content",ref:ve,tabindex:-1},Bt.flat()),mt==="tbody"?me(mt,{class:"q-virtual-scroll__padding",key:"after",ref:te},[me("tr",[me("td",{style:{[jt]:`${Z.value}px`,...xn},colspan:ce.value})])]):me(mt,{class:"q-virtual-scroll__padding",key:"after",ref:te,style:{[jt]:`${Z.value}px`,...xn}})]}function At(mt){I!==mt&&(v.onVirtualScroll!==void 0&&b("virtual-scroll",{index:mt,from:Ce.value.from,to:Ce.value.to-1,direction:mt<I?"decrease":"increase",ref:o}),I=mt)}Xt();const tn=Tv(Be,S.platform.is.ios===!0?120:35);Fm(()=>{Xt()});let Ve=!1;return Nu(()=>{Ve=!0}),Om(()=>{if(Ve!==!0)return;const mt=s();k!==void 0&&mt!==void 0&&mt!==null&&mt.nodeType!==8?Jw(mt,k,v.virtualScrollHorizontal,S.lang.rtl):ke(I)}),Ii(()=>{tn.cancel()}),Object.assign(o,{scrollTo:ke,reset:Me,refresh:Ie}),{virtualScrollSliceRange:Ce,virtualScrollSliceSizeComputed:K,setVirtualScrollSize:Xt,onVirtualScrollEvt:tn,localResetVirtualScroll:lt,padVirtualScroll:Ge,scrollTo:ke,reset:Me,refresh:Ie}}const H3={list:VT,table:G3},X3=["list","table","__qtable"],K3=Un({name:"QVirtualScroll",props:{...F2,type:{type:String,default:"list",validator:e=>X3.includes(e)},items:{type:Array,default:()=>[]},itemsFn:Function,itemsSize:Number,scrollTarget:{default:void 0}},setup(e,{slots:s,attrs:u}){let f;const m=xt(null),v=se(()=>e.itemsSize>=0&&e.itemsFn!==void 0?parseInt(e.itemsSize,10):Array.isArray(e.items)?e.items.length:0),{virtualScrollSliceRange:b,localResetVirtualScroll:o,padVirtualScroll:S,onVirtualScrollEvt:k}=N2({virtualScrollLength:v,getVirtualScrollTarget:j,getVirtualScrollEl:N}),I=se(()=>{if(v.value===0)return[];const te=(ve,Ce)=>({index:b.value.from+Ce,item:ve});return e.itemsFn===void 0?e.items.slice(b.value.from,b.value.to).map(te):e.itemsFn(b.value.from,b.value.to-b.value.from).map(te)}),L=se(()=>"q-virtual-scroll q-virtual-scroll"+(e.virtualScrollHorizontal===!0?"--horizontal":"--vertical")+(e.scrollTarget!==void 0?"":" scroll")),D=se(()=>e.scrollTarget!==void 0?{}:{tabindex:0});Ht(v,()=>{o()}),Ht(()=>e.scrollTarget,()=>{K(),Z()});function N(){return m.value.$el||m.value}function j(){return f}function Z(){f=Dv(N(),e.scrollTarget),f.addEventListener("scroll",k,Xi.passive)}function K(){f!==void 0&&(f.removeEventListener("scroll",k,Xi.passive),f=void 0)}function fe(){let te=S(e.type==="list"?"div":"tbody",I.value.map(s.default));return s.before!==void 0&&(te=s.before().concat(te)),Ro(s.after,te)}return Fm(()=>{o()}),Ui(()=>{Z()}),Om(()=>{Z()}),Nu(()=>{K()}),Ii(()=>{K()}),()=>{if(s.default===void 0){console.error("QVirtualScroll: default scoped slot is required for rendering");return}return e.type==="__qtable"?R2({ref:m,class:"q-table__middle "+L.value},fe()):me(H3[e.type],{...u,ref:m,class:[u.class,L.value],...D.value},fe)}}}),Y3=Un({name:"QField",inheritAttrs:!1,props:Gd,emits:lg,setup(){return ug(cg())}}),eE=e=>["add","add-unique","toggle"].includes(e),Q3=".*+?^${}()|[]\\",J3=Object.keys(Gd),eF=Un({name:"QSelect",inheritAttrs:!1,props:{...F2,...hg,...Gd,modelValue:{required:!0},multiple:Boolean,displayValue:[String,Number],displayValueHtml:Boolean,dropdownIcon:String,options:{type:Array,default:()=>[]},optionValue:[Function,String],optionLabel:[Function,String],optionDisable:[Function,String],hideSelected:Boolean,hideDropdownIcon:Boolean,fillInput:Boolean,maxValues:[Number,String],optionsDense:Boolean,optionsDark:{type:Boolean,default:null},optionsSelectedClass:String,optionsHtml:Boolean,optionsCover:Boolean,menuShrink:Boolean,menuAnchor:String,menuSelf:String,menuOffset:Array,popupContentClass:String,popupContentStyle:[String,Array,Object],useInput:Boolean,useChips:Boolean,newValueMode:{type:String,validator:eE},mapOptions:Boolean,emitValue:Boolean,inputDebounce:{type:[Number,String],default:500},inputClass:[Array,String,Object],inputStyle:[Array,String,Object],tabindex:{type:[String,Number],default:0},autocomplete:String,transitionShow:String,transitionHide:String,transitionDuration:[String,Number],behavior:{type:String,validator:e=>["default","menu","dialog"].includes(e),default:"default"},virtualScrollItemSize:{type:[Number,String],default:void 0},onNewValue:Function,onFilter:Function},emits:[...lg,"add","remove","input-value","new-value","keyup","keypress","keydown","filter-abort"],setup(e,{slots:s,emit:u}){const{proxy:f}=In(),{$q:m}=f,v=xt(!1),b=xt(!1),o=xt(-1),S=xt(""),k=xt(!1),I=xt(!1);let L,D,N,j,Z,K,fe,te,ve;const Ce=xt(null),ce=xt(null),pe=xt(null),Te=xt(null),Me=xt(null),Ie=Yv(e),ke=C2(ao),Be=se(()=>Array.isArray(e.options)?e.options.length:0),Re=se(()=>e.virtualScrollItemSize===void 0?e.optionsDense===!0?24:48:e.virtualScrollItemSize),{virtualScrollSliceRange:Ze,virtualScrollSliceSizeComputed:Ye,localResetVirtualScroll:lt,padVirtualScroll:Xt,onVirtualScrollEvt:Ge,scrollTo:At,setVirtualScrollSize:tn}=N2({virtualScrollLength:Be,getVirtualScrollTarget:mo,getVirtualScrollEl:Ir,virtualScrollItemSizeComputed:Re}),Ve=cg(),mt=se(()=>{const ge=e.mapOptions===!0&&e.multiple!==!0,Lt=e.modelValue!==void 0&&(e.modelValue!==null||ge===!0)?e.multiple===!0&&Array.isArray(e.modelValue)?e.modelValue:[e.modelValue]:[];if(e.mapOptions===!0&&Array.isArray(e.options)===!0){const at=e.mapOptions===!0&&D!==void 0?D:[],Yt=Lt.map(yn=>Bi(yn,at));return e.modelValue===null&&ge===!0?Yt.filter(yn=>yn!==null):Yt}return Lt}),Bt=se(()=>{const ge={};return J3.forEach(Lt=>{const at=e[Lt];at!==void 0&&(ge[Lt]=at)}),ge}),jt=se(()=>e.optionsDark===null?Ve.isDark.value:e.optionsDark),xn=se(()=>oc(mt.value)),rt=se(()=>{let ge="q-field__input q-placeholder col";return e.hideSelected===!0||mt.value.length===0?[ge,e.inputClass]:(ge+=" q-field__input--padding",e.inputClass===void 0?ge:[ge,e.inputClass])}),gt=se(()=>(e.virtualScrollHorizontal===!0?"q-virtual-scroll--horizontal":"")+(e.popupContentClass?" "+e.popupContentClass:"")),ot=se(()=>Be.value===0),_t=se(()=>mt.value.map(ge=>bt.value(ge)).join(", ")),ft=se(()=>e.optionsHtml===!0?()=>!0:ge=>ge!=null&&ge.html===!0),sn=se(()=>e.displayValueHtml===!0||e.displayValue===void 0&&(e.optionsHtml===!0||mt.value.some(ft.value))),un=se(()=>Ve.focused.value===!0?e.tabindex:-1),oe=se(()=>({tabindex:e.tabindex,role:"combobox","aria-label":e.label,"aria-readonly":e.readonly===!0?"true":"false","aria-autocomplete":e.useInput===!0?"list":"none","aria-expanded":v.value===!0?"true":"false","aria-owns":`${Ve.targetUid.value}_lb`,"aria-controls":`${Ve.targetUid.value}_lb`})),be=se(()=>{const ge={id:`${Ve.targetUid.value}_lb`,role:"listbox","aria-multiselectable":e.multiple===!0?"true":"false"};return o.value>=0&&(ge["aria-activedescendant"]=`${Ve.targetUid.value}_${o.value}`),ge}),Fe=se(()=>mt.value.map((ge,Lt)=>({index:Lt,opt:ge,html:ft.value(ge),selected:!0,removeAtIndex:bn,toggleOption:An,tabindex:un.value}))),nt=se(()=>{if(Be.value===0)return[];const{from:ge,to:Lt}=Ze.value;return e.options.slice(ge,Lt).map((at,Yt)=>{const yn=Mt.value(at)===!0,Fn=ge+Yt,ai={clickable:!0,active:!1,activeClass:Nt.value,manualFocus:!0,focused:!1,disable:yn,tabindex:-1,dense:e.optionsDense,dark:jt.value,role:"option",id:`${Ve.targetUid.value}_${Fn}`,onClick:()=>{An(at)}};return yn!==!0&&(qi(at)===!0&&(ai.active=!0),o.value===Fn&&(ai.focused=!0),ai["aria-selected"]=ai.active===!0?"true":"false",m.platform.is.desktop===!0&&(ai.onMousemove=()=>{v.value===!0&&qn(Fn)})),{index:Fn,opt:at,html:ft.value(at),label:bt.value(at),selected:ai.active,focused:ai.focused,toggleOption:An,setOptionIndex:qn,itemProps:ai}})}),yt=se(()=>e.dropdownIcon!==void 0?e.dropdownIcon:m.iconSet.arrow.dropdown),zt=se(()=>e.optionsCover===!1&&e.outlined!==!0&&e.standout!==!0&&e.borderless!==!0&&e.rounded!==!0),Nt=se(()=>e.optionsSelectedClass!==void 0?e.optionsSelectedClass:e.color!==void 0?`text-${e.color}`:""),kt=se(()=>ji(e.optionValue,"value")),bt=se(()=>ji(e.optionLabel,"label")),Mt=se(()=>ji(e.optionDisable,"disable")),Wt=se(()=>mt.value.map(ge=>kt.value(ge))),et=se(()=>{const ge={onInput:ao,onChange:ke,onKeydown:Mr,onKeyup:$i,onKeypress:hr,onFocus:tr,onClick(Lt){N===!0&&to(Lt)}};return ge.onCompositionstart=ge.onCompositionupdate=ge.onCompositionend=ke,ge});Ht(mt,ge=>{D=ge,e.useInput===!0&&e.fillInput===!0&&e.multiple!==!0&&Ve.innerLoading.value!==!0&&(b.value!==!0&&v.value!==!0||xn.value!==!0)&&(j!==!0&&ht(),(b.value===!0||v.value===!0)&&hn(""))},{immediate:!0}),Ht(()=>e.fillInput,ht),Ht(v,Ft),Ht(Be,wt);function Rt(ge){return e.emitValue===!0?kt.value(ge):ge}function nn(ge){if(ge>-1&&ge<mt.value.length)if(e.multiple===!0){const Lt=e.modelValue.slice();u("remove",{index:ge,value:Lt.splice(ge,1)[0]}),u("update:modelValue",Lt)}else u("update:modelValue",null)}function bn(ge){nn(ge),Ve.focus()}function Ln(ge,Lt){const at=Rt(ge);if(e.multiple!==!0){e.fillInput===!0&&Kt(bt.value(ge),!0,!0),u("update:modelValue",at);return}if(mt.value.length===0){u("add",{index:0,value:at}),u("update:modelValue",e.multiple===!0?[at]:at);return}if(Lt===!0&&qi(ge)===!0||e.maxValues!==void 0&&e.modelValue.length>=e.maxValues)return;const Yt=e.modelValue.slice();u("add",{index:Yt.length,value:at}),Yt.push(at),u("update:modelValue",Yt)}function An(ge,Lt){if(Ve.editable.value!==!0||ge===void 0||Mt.value(ge)===!0)return;const at=kt.value(ge);if(e.multiple!==!0){Lt!==!0&&(Kt(e.fillInput===!0?bt.value(ge):"",!0,!0),Ne()),ce.value!==null&&ce.value.focus(),(mt.value.length===0||Ua(kt.value(mt.value[0]),at)!==!0)&&u("update:modelValue",e.emitValue===!0?at:ge);return}if((N!==!0||k.value===!0)&&Ve.focus(),tr(),mt.value.length===0){const Fn=e.emitValue===!0?at:ge;u("add",{index:0,value:Fn}),u("update:modelValue",e.multiple===!0?[Fn]:Fn);return}const Yt=e.modelValue.slice(),yn=Wt.value.findIndex(Fn=>Ua(Fn,at));if(yn>-1)u("remove",{index:yn,value:Yt.splice(yn,1)[0]});else{if(e.maxValues!==void 0&&Yt.length>=e.maxValues)return;const Fn=e.emitValue===!0?at:ge;u("add",{index:Yt.length,value:Fn}),Yt.push(Fn)}u("update:modelValue",Yt)}function qn(ge){if(m.platform.is.desktop!==!0)return;const Lt=ge>-1&&ge<Be.value?ge:-1;o.value!==Lt&&(o.value=Lt)}function Hn(ge=1,Lt){if(v.value===!0){let at=o.value;do at=G1(at+ge,-1,Be.value-1);while(at!==-1&&at!==o.value&&Mt.value(e.options[at])===!0);o.value!==at&&(qn(at),At(at),Lt!==!0&&e.useInput===!0&&e.fillInput===!0&&ct(at>=0?bt.value(e.options[at]):K))}}function Bi(ge,Lt){const at=Yt=>Ua(kt.value(Yt),ge);return e.options.find(at)||Lt.find(at)||ge}function ji(ge,Lt){const at=ge!==void 0?ge:Lt;return typeof at=="function"?at:Yt=>Yt!==null&&typeof Yt=="object"&&at in Yt?Yt[at]:Yt}function qi(ge){const Lt=kt.value(ge);return Wt.value.find(at=>Ua(at,Lt))!==void 0}function tr(ge){e.useInput===!0&&ce.value!==null&&(ge===void 0||ce.value===ge.target&&ge.target.value===_t.value)&&ce.value.select()}function Ei(ge){Ha(ge,27)===!0&&v.value===!0&&(to(ge),Ne(),ht()),u("keyup",ge)}function $i(ge){const{value:Lt}=ge.target;if(ge.keyCode!==void 0){Ei(ge);return}if(ge.target.value="",clearTimeout(L),ht(),typeof Lt=="string"&&Lt.length>0){const at=Lt.toLocaleLowerCase(),Yt=Fn=>{const ai=e.options.find(mi=>Fn.value(mi).toLocaleLowerCase()===at);return ai===void 0?!1:(mt.value.indexOf(ai)===-1?An(ai):Ne(),!0)},yn=Fn=>{Yt(kt)!==!0&&(Yt(bt)===!0||Fn===!0||hn(Lt,!0,()=>yn(!0)))};yn()}else Ve.clearValue(ge)}function hr(ge){u("keypress",ge)}function Mr(ge){if(u("keydown",ge),Sv(ge)===!0)return;const Lt=S.value.length>0&&(e.newValueMode!==void 0||e.onNewValue!==void 0),at=ge.shiftKey!==!0&&e.multiple!==!0&&(o.value>-1||Lt===!0);if(ge.keyCode===27){Nr(ge);return}if(ge.keyCode===9&&at===!1){ze();return}if(ge.target===void 0||ge.target.id!==Ve.targetUid.value)return;if(ge.keyCode===40&&Ve.innerLoading.value!==!0&&v.value===!1){zi(ge),Ae();return}if(ge.keyCode===8&&e.hideSelected!==!0&&S.value.length===0){e.multiple===!0&&Array.isArray(e.modelValue)===!0?nn(e.modelValue.length-1):e.multiple!==!0&&e.modelValue!==null&&u("update:modelValue",null);return}(ge.keyCode===35||ge.keyCode===36)&&(typeof S.value!="string"||S.value.length===0)&&(zi(ge),o.value=-1,Hn(ge.keyCode===36?1:-1,e.multiple)),(ge.keyCode===33||ge.keyCode===34)&&Ye.value!==void 0&&(zi(ge),o.value=Math.max(-1,Math.min(Be.value,o.value+(ge.keyCode===33?-1:1)*Ye.value.view)),Hn(ge.keyCode===33?1:-1,e.multiple)),(ge.keyCode===38||ge.keyCode===40)&&(zi(ge),Hn(ge.keyCode===38?-1:1,e.multiple));const Yt=Be.value;if((te===void 0||ve<Date.now())&&(te=""),Yt>0&&e.useInput!==!0&&ge.key!==void 0&&ge.key.length===1&&ge.altKey===ge.ctrlKey&&(ge.keyCode!==32||te.length>0)){v.value!==!0&&Ae(ge);const yn=ge.key.toLocaleLowerCase(),Fn=te.length===1&&te[0]===yn;ve=Date.now()+1500,Fn===!1&&(zi(ge),te+=yn);const ai=new RegExp("^"+te.split("").map(tt=>Q3.indexOf(tt)>-1?"\\"+tt:tt).join(".*"),"i");let mi=o.value;if(Fn===!0||mi<0||ai.test(bt.value(e.options[mi]))!==!0)do mi=G1(mi+1,-1,Yt-1);while(mi!==o.value&&(Mt.value(e.options[mi])===!0||ai.test(bt.value(e.options[mi]))!==!0));o.value!==mi&&ui(()=>{qn(mi),At(mi),mi>=0&&e.useInput===!0&&e.fillInput===!0&&ct(bt.value(e.options[mi]))});return}if(!(ge.keyCode!==13&&(ge.keyCode!==32||e.useInput===!0||te!=="")&&(ge.keyCode!==9||at===!1))){if(ge.keyCode!==9&&zi(ge),o.value>-1&&o.value<Yt){An(e.options[o.value]);return}if(Lt===!0){const yn=(Fn,ai)=>{if(ai){if(eE(ai)!==!0)return}else ai=e.newValueMode;if(Fn==null)return;Kt("",e.multiple!==!0,!0),(ai==="toggle"?An:Ln)(Fn,ai==="add-unique"),e.multiple!==!0&&(ce.value!==null&&ce.value.focus(),Ne())};if(e.onNewValue!==void 0?u("new-value",S.value,yn):yn(S.value),e.multiple!==!0)return}v.value===!0?ze():Ve.innerLoading.value!==!0&&Ae()}}function Ir(){return N===!0?Me.value:pe.value!==null&&pe.value.__qPortalInnerRef.value!==null?pe.value.__qPortalInnerRef.value:void 0}function mo(){return Ir()}function vr(){return e.hideSelected===!0?[]:s["selected-item"]!==void 0?Fe.value.map(ge=>s["selected-item"](ge)).slice():s.selected!==void 0?[].concat(s.selected()):e.useChips===!0?Fe.value.map((ge,Lt)=>me(E2,{key:"option-"+Lt,removable:Ve.editable.value===!0&&Mt.value(ge.opt)!==!0,dense:!0,textColor:e.color,tabindex:un.value,onRemove(){ge.removeAtIndex(Lt)}},()=>me("span",{class:"ellipsis",[ge.html===!0?"innerHTML":"textContent"]:bt.value(ge.opt)}))):[me("span",{[sn.value===!0?"innerHTML":"textContent"]:e.displayValue!==void 0?e.displayValue:_t.value})]}function so(){if(ot.value===!0)return s["no-option"]!==void 0?s["no-option"]({inputValue:S.value}):void 0;const ge=s.option!==void 0?s.option:at=>me(oS,{key:at.index,...at.itemProps},()=>me(Yp,()=>me(rS,()=>me("span",{[at.html===!0?"innerHTML":"textContent"]:at.label}))));let Lt=Xt("div",nt.value.map(ge));return s["before-options"]!==void 0&&(Lt=s["before-options"]().concat(Lt)),Ro(s["after-options"],Lt)}function ns(ge,Lt){const at=Lt===!0?{...oe.value,...Ve.splitAttrs.attributes.value}:void 0,Yt={ref:Lt===!0?ce:void 0,key:"i_t",class:rt.value,style:e.inputStyle,value:S.value!==void 0?S.value:"",type:"search",...at,id:Lt===!0?Ve.targetUid.value:void 0,maxlength:e.maxlength,autocomplete:e.autocomplete,"data-autofocus":ge!==!0&&e.autofocus===!0||void 0,disabled:e.disable===!0,readonly:e.readonly===!0,...et.value};return ge!==!0&&N===!0&&(Array.isArray(Yt.class)===!0?Yt.class=[...Yt.class,"no-pointer-events"]:Yt.class+=" no-pointer-events"),me("input",Yt)}function ao(ge){clearTimeout(L),!(ge&&ge.target&&ge.target.qComposing===!0)&&(ct(ge.target.value||""),j=!0,K=S.value,Ve.focused.value!==!0&&(N!==!0||k.value===!0)&&Ve.focus(),e.onFilter!==void 0&&(L=setTimeout(()=>{hn(S.value)},e.inputDebounce)))}function ct(ge){S.value!==ge&&(S.value=ge,u("input-value",ge))}function Kt(ge,Lt,at){j=at!==!0,e.useInput===!0&&(ct(ge),(Lt===!0||at!==!0)&&(K=ge),Lt!==!0&&hn(ge))}function hn(ge,Lt,at){if(e.onFilter===void 0||Lt!==!0&&Ve.focused.value!==!0)return;Ve.innerLoading.value===!0?u("filter-abort"):(Ve.innerLoading.value=!0,I.value=!0),ge!==""&&e.multiple!==!0&&mt.value.length>0&&j!==!0&&ge===bt.value(mt.value[0])&&(ge="");const Yt=setTimeout(()=>{v.value===!0&&(v.value=!1)},10);clearTimeout(Z),Z=Yt,u("filter",ge,(yn,Fn)=>{(Lt===!0||Ve.focused.value===!0)&&Z===Yt&&(clearTimeout(Z),typeof yn=="function"&&yn(),I.value=!1,ui(()=>{Ve.innerLoading.value=!1,Ve.editable.value===!0&&(Lt===!0?v.value===!0&&Ne():v.value===!0?Ft(!0):v.value=!0),typeof Fn=="function"&&ui(()=>{Fn(f)}),typeof at=="function"&&ui(()=>{at(f)})}))},()=>{Ve.focused.value===!0&&Z===Yt&&(clearTimeout(Z),Ve.innerLoading.value=!1,I.value=!1),v.value===!0&&(v.value=!1)})}function En(){return me(JT,{ref:pe,class:gt.value,style:e.popupContentStyle,modelValue:v.value,fit:e.menuShrink!==!0,cover:e.optionsCover===!0&&ot.value!==!0&&e.useInput!==!0,anchor:e.menuAnchor,self:e.menuSelf,offset:e.menuOffset,dark:jt.value,noParentEvent:!0,noRefocus:!0,noFocus:!0,square:zt.value,transitionShow:e.transitionShow,transitionHide:e.transitionHide,transitionDuration:e.transitionDuration,separateClosePopup:!0,...be.value,onScrollPassive:Ge,onBeforeShow:on,onBeforeHide:kn,onShow:Y},so)}function kn(ge){rn(ge),ze()}function Y(){tn()}function V(ge){to(ge),ce.value!==null&&ce.value.focus(),k.value=!0,window.scrollTo(window.pageXOffset||window.scrollX||document.body.scrollLeft||0,0)}function $(ge){to(ge),ui(()=>{k.value=!1})}function J(){const ge=[me(Y3,{class:`col-auto ${Ve.fieldClass.value}`,...Bt.value,for:Ve.targetUid.value,dark:jt.value,square:!0,loading:I.value,itemAligned:!1,filled:!0,stackLabel:S.value.length>0,...Ve.splitAttrs.listeners.value,onFocus:V,onBlur:$},{...s,rawControl:()=>Ve.getControl(!0),before:void 0,after:void 0})];return v.value===!0&&ge.push(me("div",{ref:Me,class:gt.value+" scroll",style:e.popupContentStyle,...be.value,onClick:Nr,onScrollPassive:Ge},so())),me(Cm,{ref:Te,modelValue:b.value,position:e.useInput===!0?"top":void 0,transitionShow:fe,transitionHide:e.transitionHide,transitionDuration:e.transitionDuration,onBeforeShow:on,onBeforeHide:ue,onHide:Se,onShow:Oe},()=>me("div",{class:"q-select__dialog"+(jt.value===!0?" q-select__dialog--dark q-dark":"")+(k.value===!0?" q-select__dialog--focused":"")},ge))}function ue(ge){rn(ge),Te.value!==null&&Te.value.__updateRefocusTarget(Ve.rootRef.value.querySelector(".q-field__native > [tabindex]:last-child")),Ve.focused.value=!1}function Se(ge){Ne(),Ve.focused.value===!1&&u("blur",ge),ht()}function Oe(){const ge=document.activeElement;(ge===null||ge.id!==Ve.targetUid.value)&&ce.value!==null&&ce.value!==ge&&ce.value.focus(),tn()}function ze(){b.value!==!0&&(o.value=-1,v.value===!0&&(v.value=!1),Ve.focused.value===!1&&(clearTimeout(Z),Z=void 0,Ve.innerLoading.value===!0&&(u("filter-abort"),Ve.innerLoading.value=!1,I.value=!1)))}function Ae(ge){Ve.editable.value===!0&&(N===!0?(Ve.onControlFocusin(ge),b.value=!0,ui(()=>{Ve.focus()})):Ve.focus(),e.onFilter!==void 0?hn(S.value):(ot.value!==!0||s["no-option"]!==void 0)&&(v.value=!0))}function Ne(){b.value=!1,ze()}function ht(){e.useInput===!0&&Kt(e.multiple!==!0&&e.fillInput===!0&&mt.value.length>0&&bt.value(mt.value[0])||"",!0,!0)}function Ft(ge){let Lt=-1;if(ge===!0){if(mt.value.length>0){const at=kt.value(mt.value[0]);Lt=e.options.findIndex(Yt=>Ua(kt.value(Yt),at))}lt(Lt)}qn(Lt)}function wt(ge,Lt){v.value===!0&&Ve.innerLoading.value===!1&&(lt(-1,!0),ui(()=>{v.value===!0&&Ve.innerLoading.value===!1&&(ge>Lt?lt():Ft(!0))}))}function an(){b.value===!1&&pe.value!==null&&pe.value.updatePosition()}function on(ge){ge!==void 0&&to(ge),u("popup-show",ge),Ve.hasPopupOpen=!0,Ve.onControlFocusin(ge)}function rn(ge){ge!==void 0&&to(ge),u("popup-hide",ge),Ve.hasPopupOpen=!1,Ve.onControlFocusout(ge)}function fn(){N=m.platform.is.mobile!==!0&&e.behavior!=="dialog"?!1:e.behavior!=="menu"&&(e.useInput===!0?s["no-option"]!==void 0||e.onFilter!==void 0||ot.value===!1:!0),fe=m.platform.is.ios===!0&&N===!0&&e.useInput===!0?"fade":e.transitionShow}return Nm(fn),Vm(an),fn(),Ii(()=>{clearTimeout(L)}),Object.assign(f,{showPopup:Ae,hidePopup:Ne,removeAtIndex:nn,add:Ln,toggleOption:An,getOptionIndex:()=>o.value,setOptionIndex:qn,moveOptionSelection:Hn,filter:hn,updateMenuPosition:an,updateInputValue:Kt,isOptionSelected:qi,getEmittingOptionValue:Rt,isOptionDisabled:(...ge)=>Mt.value.apply(null,ge)===!0,getOptionValue:(...ge)=>kt.value.apply(null,ge),getOptionLabel:(...ge)=>bt.value.apply(null,ge)}),Object.assign(Ve,{innerValue:mt,fieldClass:se(()=>`q-select q-field--auto-height q-select--with${e.useInput!==!0?"out":""}-input q-select--with${e.useChips!==!0?"out":""}-chips q-select--${e.multiple===!0?"multiple":"single"}`),inputRef:Ce,targetRef:ce,hasValue:xn,showPopup:Ae,floatingLabel:se(()=>e.hideSelected!==!0&&xn.value===!0||typeof S.value=="number"||S.value.length>0||oc(e.displayValue)),getControlChild:()=>{if(Ve.editable.value!==!1&&(b.value===!0||ot.value!==!0||s["no-option"]!==void 0))return N===!0?J():En();Ve.hasPopupOpen===!0&&(Ve.hasPopupOpen=!1)},controlEvents:{onFocusin(ge){Ve.onControlFocusin(ge)},onFocusout(ge){Ve.onControlFocusout(ge,()=>{ht(),ze()})},onClick(ge){if(Nr(ge),N!==!0&&v.value===!0){ze(),ce.value!==null&&ce.value.focus();return}Ae(ge)}},getControl:ge=>{const Lt=vr(),at=ge===!0||b.value!==!0||N!==!0;if(e.useInput===!0)Lt.push(ns(ge,at));else if(Ve.editable.value===!0){const yn=at===!0?oe.value:void 0;Lt.push(me("input",{ref:at===!0?ce:void 0,key:"d_t",class:"q-select__focus-target",id:at===!0?Ve.targetUid.value:void 0,readonly:!0,"data-autofocus":ge!==!0&&e.autofocus===!0||void 0,...yn,onKeydown:Mr,onKeyup:Ei,onKeypress:hr})),at===!0&&typeof e.autocomplete=="string"&&e.autocomplete.length>0&&Lt.push(me("input",{class:"q-select__autocomplete-input",autocomplete:e.autocomplete,tabindex:-1,onKeyup:$i}))}if(Ie.value!==void 0&&e.disable!==!0&&Wt.value.length>0){const yn=Wt.value.map(Fn=>me("option",{value:Fn,selected:!0}));Lt.push(me("select",{class:"hidden",name:Ie.value,multiple:e.multiple},yn))}const Yt=e.useInput===!0||at!==!0?void 0:Ve.splitAttrs.attributes.value;return me("div",{class:"q-field__native row items-center",...Yt},Lt)},getInnerAppend:()=>e.loading!==!0&&I.value!==!0&&e.hideDropdownIcon!==!0?[me(Wr,{class:"q-select__dropdown-icon"+(v.value===!0?" rotate-180":""),name:yt.value})]:null}),ug(Ve)}}),tF={xs:2,sm:4,md:6,lg:10,xl:14};function tE(e,s,u){return{transform:s===!0?`translateX(${u.lang.rtl===!0?"-":""}100%) scale3d(${-e},1,1)`:`scale3d(${e},1,1)`}}const nF=Un({name:"QLinearProgress",props:{...io,...Vu,value:{type:Number,default:0},buffer:Number,color:String,trackColor:String,reverse:Boolean,stripe:Boolean,indeterminate:Boolean,query:Boolean,rounded:Boolean,animationSpeed:{type:[String,Number],default:2100},instantFeedback:Boolean},setup(e,{slots:s}){const{proxy:u}=In(),f=ro(e,u.$q),m=Uu(e,tF),v=se(()=>e.indeterminate===!0||e.query===!0),b=se(()=>e.reverse!==e.query),o=se(()=>({...m.value!==null?m.value:{},"--q-linear-progress-speed":`${e.animationSpeed}ms`})),S=se(()=>"q-linear-progress"+(e.color!==void 0?` text-${e.color}`:"")+(e.reverse===!0||e.query===!0?" q-linear-progress--reverse":"")+(e.rounded===!0?" rounded-borders":"")),k=se(()=>tE(e.buffer!==void 0?e.buffer:1,b.value,u.$q)),I=se(()=>`q-linear-progress__track absolute-full q-linear-progress__track--with${e.instantFeedback===!0?"out":""}-transition q-linear-progress__track--${f.value===!0?"dark":"light"}`+(e.trackColor!==void 0?` bg-${e.trackColor}`:"")),L=se(()=>tE(v.value===!0?1:e.value,b.value,u.$q)),D=se(()=>`q-linear-progress__model absolute-full q-linear-progress__model--with${e.instantFeedback===!0?"out":""}-transition q-linear-progress__model--${v.value===!0?"in":""}determinate`),N=se(()=>({width:`${e.value*100}%`})),j=se(()=>`q-linear-progress__stripe absolute-${e.reverse===!0?"right":"left"}`);return()=>{const Z=[me("div",{class:I.value,style:k.value}),me("div",{class:D.value,style:L.value})];return e.stripe===!0&&v.value===!1&&Z.push(me("div",{class:j.value,style:N.value})),me("div",{class:S.value,style:o.value,role:"progressbar","aria-valuemin":0,"aria-valuemax":1,"aria-valuenow":e.indeterminate===!0?void 0:e.value},Ro(s.default,Z))}}});function iF(e,s){const u=xt(null),f=se(()=>e.disable===!0?null:me("span",{ref:u,class:"no-outline",tabindex:-1}));function m(v){const b=s.value;v!==void 0&&v.type.indexOf("key")===0?b!==null&&document.activeElement!==b&&b.contains(document.activeElement)===!0&&b.focus():u.value!==null&&(v===void 0||b!==null&&b.contains(v.target)===!0)&&u.value.focus()}return{refocusTargetEl:f,refocusTarget:m}}const rF={xs:30,sm:35,md:40,lg:50,xl:60},oF={...io,...Vu,...hg,modelValue:{required:!0,default:null},val:{},trueValue:{default:!0},falseValue:{default:!1},indeterminateValue:{default:null},checkedIcon:String,uncheckedIcon:String,indeterminateIcon:String,toggleOrder:{type:String,validator:e=>e==="tf"||e==="ft"},toggleIndeterminate:Boolean,label:String,leftLabel:Boolean,color:String,keepColor:Boolean,dense:Boolean,disable:Boolean,tabindex:[String,Number]},sF=["update:modelValue"];function aF(e,s){const{props:u,slots:f,emit:m,proxy:v}=In(),{$q:b}=v,o=ro(u,b),S=xt(null),{refocusTargetEl:k,refocusTarget:I}=iF(u,S),L=Uu(u,rF),D=se(()=>u.val!==void 0&&Array.isArray(u.modelValue)),N=se(()=>{const Re=Tn(u.val);return D.value===!0?u.modelValue.findIndex(Ze=>Tn(Ze)===Re):-1}),j=se(()=>D.value===!0?N.value>-1:Tn(u.modelValue)===Tn(u.trueValue)),Z=se(()=>D.value===!0?N.value===-1:Tn(u.modelValue)===Tn(u.falseValue)),K=se(()=>j.value===!1&&Z.value===!1),fe=se(()=>u.disable===!0?-1:u.tabindex||0),te=se(()=>`q-${e} cursor-pointer no-outline row inline no-wrap items-center`+(u.disable===!0?" disabled":"")+(o.value===!0?` q-${e}--dark`:"")+(u.dense===!0?` q-${e}--dense`:"")+(u.leftLabel===!0?" reverse":"")),ve=se(()=>{const Re=j.value===!0?"truthy":Z.value===!0?"falsy":"indet",Ze=u.color!==void 0&&(u.keepColor===!0||(e==="toggle"?j.value===!0:Z.value!==!0))?` text-${u.color}`:"";return`q-${e}__inner relative-position non-selectable q-${e}__inner--${Re}${Ze}`}),Ce=se(()=>{const Re={type:"checkbox"};return u.name!==void 0&&Object.assign(Re,{"^checked":j.value===!0?"checked":void 0,name:u.name,value:D.value===!0?u.val:u.trueValue}),Re}),ce=JB(Ce),pe=se(()=>{const Re={tabindex:fe.value,role:e==="toggle"?"switch":"checkbox","aria-label":u.label,"aria-checked":K.value===!0?"mixed":j.value===!0?"true":"false"};return u.disable===!0&&(Re["aria-disabled"]="true"),Re});function Te(Re){Re!==void 0&&(zi(Re),I(Re)),u.disable!==!0&&m("update:modelValue",Me(),Re)}function Me(){if(D.value===!0){if(j.value===!0){const Re=u.modelValue.slice();return Re.splice(N.value,1),Re}return u.modelValue.concat([u.val])}if(j.value===!0){if(u.toggleOrder!=="ft"||u.toggleIndeterminate===!1)return u.falseValue}else if(Z.value===!0){if(u.toggleOrder==="ft"||u.toggleIndeterminate===!1)return u.trueValue}else return u.toggleOrder!=="ft"?u.trueValue:u.falseValue;return u.indeterminateValue}function Ie(Re){(Re.keyCode===13||Re.keyCode===32)&&zi(Re)}function ke(Re){(Re.keyCode===13||Re.keyCode===32)&&Te(Re)}const Be=s(j,K);return Object.assign(v,{toggle:Te}),()=>{const Re=Be();u.disable!==!0&&ce(Re,"unshift",` q-${e}__native absolute q-ma-none q-pa-none`);const Ze=[me("div",{class:ve.value,style:L.value,"aria-hidden":"true"},Re)];k.value!==null&&Ze.push(k.value);const Ye=u.label!==void 0?Ro(f.default,[u.label]):bi(f.default);return Ye!==void 0&&Ze.push(me("div",{class:`q-${e}__label q-anchor--skip`},Ye)),me("div",{ref:S,class:te.value,...pe.value,onClick:Te,onKeydown:Ie,onKeyup:ke},Ze)}}const lF=me("div",{key:"svg",class:"q-checkbox__bg absolute"},[me("svg",{class:"q-checkbox__svg fit absolute-full",viewBox:"0 0 24 24"},[me("path",{class:"q-checkbox__truthy",fill:"none",d:"M1.73,12.91 8.1,19.28 22.79,4.59"}),me("path",{class:"q-checkbox__indet",d:"M4,14H20V10H4"})])]),gy=Un({name:"QCheckbox",props:oF,emits:sF,setup(e){function s(u,f){const m=se(()=>(u.value===!0?e.checkedIcon:f.value===!0?e.indeterminateIcon:e.uncheckedIcon)||null);return()=>m.value!==null?[me("div",{key:"icon",class:"q-checkbox__icon-container absolute-full flex flex-center no-wrap"},[me(Wr,{class:"q-checkbox__icon",name:m.value})])]:[lF]}return aF("checkbox",s)}});function cF(e,s){return new Date(e)-new Date(s)}const uF={sortMethod:Function,binaryStateSort:Boolean,columnSortOrder:{type:String,validator:e=>e==="ad"||e==="da",default:"ad"}};function hF(e,s,u,f){const m=se(()=>{const{sortBy:o}=s.value;return o&&u.value.find(S=>S.name===o)||null}),v=se(()=>e.sortMethod!==void 0?e.sortMethod:(o,S,k)=>{const I=u.value.find(N=>N.name===S);if(I===void 0||I.field===void 0)return o;const L=k===!0?-1:1,D=typeof I.field=="function"?N=>I.field(N):N=>N[I.field];return o.sort((N,j)=>{let Z=D(N),K=D(j);return Z==null?-1*L:K==null?1*L:I.sort!==void 0?I.sort(Z,K,N,j)*L:pm(Z)===!0&&pm(K)===!0?(Z-K)*L:m1(Z)===!0&&m1(K)===!0?cF(Z,K)*L:typeof Z=="boolean"&&typeof K=="boolean"?(Z-K)*L:([Z,K]=[Z,K].map(fe=>(fe+"").toLocaleString().toLowerCase()),Z<K?-1*L:Z===K?0:L)})});function b(o){let S=e.columnSortOrder;if(ku(o)===!0)o.sortOrder&&(S=o.sortOrder),o=o.name;else{const L=u.value.find(D=>D.name===o);L!==void 0&&L.sortOrder&&(S=L.sortOrder)}let{sortBy:k,descending:I}=s.value;k!==o?(k=o,I=S==="da"):e.binaryStateSort===!0?I=!I:I===!0?S==="ad"?k=null:I=!1:S==="ad"?I=!0:k=null,f({sortBy:k,descending:I,page:1})}return{columnToSort:m,computedSortMethod:v,sort:b}}const dF={filter:[String,Object],filterMethod:Function};function fF(e,s){const u=se(()=>e.filterMethod!==void 0?e.filterMethod:(f,m,v,b)=>{const o=m?m.toLowerCase():"";return f.filter(S=>v.some(k=>{const I=b(k,S)+"";return(I==="undefined"||I==="null"?"":I.toLowerCase()).indexOf(o)!==-1}))});return Ht(()=>e.filter,()=>{ui(()=>{s({page:1},!0)})},{deep:!0}),{computedFilterMethod:u}}function pF(e,s){for(const u in s)if(s[u]!==e[u])return!1;return!0}function nE(e){return e.page<1&&(e.page=1),e.rowsPerPage!==void 0&&e.rowsPerPage<1&&(e.rowsPerPage=0),e}const mF={pagination:Object,rowsPerPageOptions:{type:Array,default:()=>[5,7,10,15,20,25,50,0]},"onUpdate:pagination":[Function,Array]};function gF(e,s){const{props:u,emit:f}=e,m=xt(Object.assign({sortBy:null,descending:!1,page:1,rowsPerPage:u.rowsPerPageOptions.length>0?u.rowsPerPageOptions[0]:5},u.pagination)),v=se(()=>{const I=u["onUpdate:pagination"]!==void 0?{...m.value,...u.pagination}:m.value;return nE(I)}),b=se(()=>v.value.rowsNumber!==void 0);function o(I){S({pagination:I,filter:u.filter})}function S(I={}){ui(()=>{f("request",{pagination:I.pagination||v.value,filter:I.filter||u.filter,getCellValue:s})})}function k(I,L){const D=nE({...v.value,...I});if(pF(v.value,D)===!0){b.value===!0&&L===!0&&o(D);return}if(b.value===!0){o(D);return}u.pagination!==void 0&&u["onUpdate:pagination"]!==void 0?f("update:pagination",D):m.value=D}return{innerPagination:m,computedPagination:v,isServerSide:b,requestServerInteraction:S,setPagination:k}}function _F(e,s,u,f,m,v){const{props:b,emit:o,proxy:{$q:S}}=e,k=se(()=>f.value===!0?u.value.rowsNumber||0:v.value),I=se(()=>{const{page:Ce,rowsPerPage:ce}=u.value;return(Ce-1)*ce}),L=se(()=>{const{page:Ce,rowsPerPage:ce}=u.value;return Ce*ce}),D=se(()=>u.value.page===1),N=se(()=>u.value.rowsPerPage===0?1:Math.max(1,Math.ceil(k.value/u.value.rowsPerPage))),j=se(()=>L.value===0?!0:u.value.page>=N.value),Z=se(()=>(b.rowsPerPageOptions.includes(s.value.rowsPerPage)?b.rowsPerPageOptions:[s.value.rowsPerPage].concat(b.rowsPerPageOptions)).map(ce=>({label:ce===0?S.lang.table.allRows:""+ce,value:ce})));Ht(N,(Ce,ce)=>{if(Ce===ce)return;const pe=u.value.page;Ce&&!pe?m({page:1}):Ce<pe&&m({page:Ce})});function K(){m({page:1})}function fe(){const{page:Ce}=u.value;Ce>1&&m({page:Ce-1})}function te(){const{page:Ce,rowsPerPage:ce}=u.value;L.value>0&&Ce*ce<k.value&&m({page:Ce+1})}function ve(){m({page:N.value})}return b["onUpdate:pagination"]!==void 0&&o("update:pagination",{...u.value}),{firstRowIndex:I,lastRowIndex:L,isFirstPage:D,isLastPage:j,pagesNumber:N,computedRowsPerPageOptions:Z,computedRowsNumber:k,firstPage:K,prevPage:fe,nextPage:te,lastPage:ve}}const yF={selection:{type:String,default:"none",validator:e=>["single","multiple","none"].includes(e)},selected:{type:Array,default:()=>[]}},vF=["update:selected","selection"];function xF(e,s,u,f){const m=se(()=>{const j={};return e.selected.map(f.value).forEach(Z=>{j[Z]=!0}),j}),v=se(()=>e.selection!=="none"),b=se(()=>e.selection==="single"),o=se(()=>e.selection==="multiple"),S=se(()=>u.value.length>0&&u.value.every(j=>m.value[f.value(j)]===!0)),k=se(()=>S.value!==!0&&u.value.some(j=>m.value[f.value(j)]===!0)),I=se(()=>e.selected.length);function L(j){return m.value[j]===!0}function D(){s("update:selected",[])}function N(j,Z,K,fe){s("selection",{rows:Z,added:K,keys:j,evt:fe});const te=b.value===!0?K===!0?Z:[]:K===!0?e.selected.concat(Z):e.selected.filter(ve=>j.includes(f.value(ve))===!1);s("update:selected",te)}return{hasSelectionMode:v,singleSelection:b,multipleSelection:o,allRowsSelected:S,someRowsSelected:k,rowsSelectedNumber:I,isRowSelected:L,clearSelection:D,updateSelection:N}}function iE(e){return Array.isArray(e)?e.slice():[]}const bF={expanded:Array},wF=["update:expanded"];function EF(e,s){const u=xt(iE(e.expanded));Ht(()=>e.expanded,b=>{u.value=iE(b)});function f(b){return u.value.includes(b)}function m(b){e.expanded!==void 0?s("update:expanded",b):u.value=b}function v(b,o){const S=u.value.slice(),k=S.indexOf(b);o===!0?k===-1&&(S.push(b),m(S)):k!==-1&&(S.splice(k,1),m(S))}return{isRowExpanded:f,setExpanded:m,updateExpanded:v}}const TF={visibleColumns:Array};function SF(e,s,u){const f=se(()=>{if(e.columns!==void 0)return e.columns;const o=e.rows[0];return o!==void 0?Object.keys(o).map(S=>({name:S,label:S.toUpperCase(),field:S,align:pm(o[S])?"right":"left",sortable:!0})):[]}),m=se(()=>{const{sortBy:o,descending:S}=s.value;return(e.visibleColumns!==void 0?f.value.filter(I=>I.required===!0||e.visibleColumns.includes(I.name)===!0):f.value).map(I=>{const L=I.align||"right",D=`text-${L}`;return{...I,align:L,__iconClass:`q-table__sort-icon q-table__sort-icon--${L}`,__thClass:D+(I.headerClasses!==void 0?" "+I.headerClasses:"")+(I.sortable===!0?" sortable":"")+(I.name===o?` sorted ${S===!0?"sort-desc":""}`:""),__tdStyle:I.style!==void 0?typeof I.style!="function"?()=>I.style:I.style:()=>null,__tdClass:I.classes!==void 0?typeof I.classes!="function"?()=>D+" "+I.classes:N=>D+" "+I.classes(N):()=>D}})}),v=se(()=>{const o={};return m.value.forEach(S=>{o[S.name]=S}),o}),b=se(()=>e.tableColspan!==void 0?e.tableColspan:m.value.length+(u.value===!0?1:0));return{colList:f,computedCols:m,computedColsMap:v,computedColspan:b}}const $p="q-table__bottom row items-center",V2={};B2.forEach(e=>{V2[e]={}});const CF=Un({name:"QTable",props:{rows:{type:Array,default:()=>[]},rowKey:{type:[String,Function],default:"id"},columns:Array,loading:Boolean,iconFirstPage:String,iconPrevPage:String,iconNextPage:String,iconLastPage:String,title:String,hideHeader:Boolean,grid:Boolean,gridHeader:Boolean,dense:Boolean,flat:Boolean,bordered:Boolean,square:Boolean,separator:{type:String,default:"horizontal",validator:e=>["horizontal","vertical","cell","none"].includes(e)},wrapCells:Boolean,virtualScroll:Boolean,virtualScrollTarget:{default:void 0},...V2,noDataLabel:String,noResultsLabel:String,loadingLabel:String,selectedRowsLabel:Function,rowsPerPageLabel:String,paginationLabel:Function,color:{type:String,default:"grey-8"},titleClass:[String,Array,Object],tableStyle:[String,Array,Object],tableClass:[String,Array,Object],tableHeaderStyle:[String,Array,Object],tableHeaderClass:[String,Array,Object],cardContainerClass:[String,Array,Object],cardContainerStyle:[String,Array,Object],cardStyle:[String,Array,Object],cardClass:[String,Array,Object],hideBottom:Boolean,hideSelectedBanner:Boolean,hideNoData:Boolean,hidePagination:Boolean,onRowClick:Function,onRowDblclick:Function,onRowContextmenu:Function,...io,...v2,...TF,...dF,...mF,...bF,...yF,...uF},emits:["request","virtual-scroll",...x2,...wF,...vF],setup(e,{slots:s,emit:u}){const f=In(),{proxy:{$q:m}}=f,v=ro(e,m),{inFullscreen:b,toggleFullscreen:o}=b2(),S=se(()=>typeof e.rowKey=="function"?e.rowKey:ct=>ct[e.rowKey]),k=xt(null),I=xt(null),L=se(()=>e.grid!==!0&&e.virtualScroll===!0),D=se(()=>" q-table__card"+(v.value===!0?" q-table__card--dark q-dark":"")+(e.square===!0?" q-table--square":"")+(e.flat===!0?" q-table--flat":"")+(e.bordered===!0?" q-table--bordered":"")),N=se(()=>`q-table__container q-table--${e.separator}-separator column no-wrap`+(e.grid===!0?" q-table--grid":D.value)+(v.value===!0?" q-table--dark":"")+(e.dense===!0?" q-table--dense":"")+(e.wrapCells===!1?" q-table--no-wrap":"")+(b.value===!0?" fullscreen scroll":"")),j=se(()=>N.value+(e.loading===!0?" q-table--loading":""));Ht(()=>e.tableStyle+e.tableClass+e.tableHeaderStyle+e.tableHeaderClass+N.value,()=>{L.value===!0&&I.value!==null&&I.value.reset()});const{innerPagination:Z,computedPagination:K,isServerSide:fe,requestServerInteraction:te,setPagination:ve}=gF(f,Bi),{computedFilterMethod:Ce}=fF(e,ve),{isRowExpanded:ce,setExpanded:pe,updateExpanded:Te}=EF(e,u),Me=se(()=>{let ct=e.rows;if(fe.value===!0||ct.length===0)return ct;const{sortBy:Kt,descending:hn}=K.value;return e.filter&&(ct=Ce.value(ct,e.filter,mt.value,Bi)),xn.value!==null&&(ct=rt.value(e.rows===ct?ct.slice():ct,Kt,hn)),ct}),Ie=se(()=>Me.value.length),ke=se(()=>{let ct=Me.value;if(fe.value===!0)return ct;const{rowsPerPage:Kt}=K.value;return Kt!==0&&(ot.value===0&&e.rows!==ct?ct.length>_t.value&&(ct=ct.slice(0,_t.value)):ct=ct.slice(ot.value,_t.value)),ct}),{hasSelectionMode:Be,singleSelection:Re,multipleSelection:Ze,allRowsSelected:Ye,someRowsSelected:lt,rowsSelectedNumber:Xt,isRowSelected:Ge,clearSelection:At,updateSelection:tn}=xF(e,u,ke,S),{colList:Ve,computedCols:mt,computedColsMap:Bt,computedColspan:jt}=SF(e,K,Be),{columnToSort:xn,computedSortMethod:rt,sort:gt}=hF(e,K,Ve,ve),{firstRowIndex:ot,lastRowIndex:_t,isFirstPage:ft,isLastPage:sn,pagesNumber:un,computedRowsPerPageOptions:oe,computedRowsNumber:be,firstPage:Fe,prevPage:nt,nextPage:yt,lastPage:zt}=_F(f,Z,K,fe,ve,Ie),Nt=se(()=>ke.value.length===0),kt=se(()=>{const ct={};return B2.forEach(Kt=>{ct[Kt]=e[Kt]}),ct.virtualScrollItemSize===void 0&&(ct.virtualScrollItemSize=e.dense===!0?28:48),ct});function bt(){L.value===!0&&I.value.reset()}function Mt(){if(e.grid===!0)return ao();const ct=e.hideHeader!==!0?Ei:null;if(L.value===!0){const hn=s["top-row"],En=s["bottom-row"],kn={default:Y=>nn(Y.item,s.body,Y.index)};if(hn!==void 0){const Y=me("tbody",hn({cols:mt.value}));kn.before=ct===null?()=>Y:()=>[ct()].concat(Y)}else ct!==null&&(kn.before=ct);return En!==void 0&&(kn.after=()=>me("tbody",En({cols:mt.value}))),me(K3,{ref:I,class:e.tableClass,style:e.tableStyle,...kt.value,scrollTarget:e.virtualScrollTarget,items:ke.value,type:"__qtable",tableColspan:jt.value,onVirtualScroll:et},kn)}const Kt=[bn()];return ct!==null&&Kt.unshift(ct()),R2({class:["q-table__middle scroll",e.tableClass],style:e.tableStyle},Kt)}function Wt(ct,Kt){if(I.value!==null){I.value.scrollTo(ct,Kt);return}ct=parseInt(ct,10);const hn=k.value.querySelector(`tbody tr:nth-of-type(${ct+1})`);if(hn!==null){const En=k.value.querySelector(".q-table__middle.scroll"),kn=hn.offsetTop-e.virtualScrollStickySizeStart,Y=kn<En.scrollTop?"decrease":"increase";En.scrollTop=kn,u("virtual-scroll",{index:ct,from:0,to:Z.value.rowsPerPage-1,direction:Y})}}function et(ct){u("virtual-scroll",ct)}function Rt(){return[me(nF,{class:"q-table__linear-progress",color:e.color,dark:v.value,indeterminate:!0,trackColor:"transparent"})]}function nn(ct,Kt,hn){const En=S.value(ct),kn=Ge(En);if(Kt!==void 0)return Kt(Ln({key:En,row:ct,pageIndex:hn,__trClass:kn?"selected":""}));const Y=s["body-cell"],V=mt.value.map(J=>{const ue=s[`body-cell-${J.name}`],Se=ue!==void 0?ue:Y;return Se!==void 0?Se(An({key:En,row:ct,pageIndex:hn,col:J})):me("td",{class:J.__tdClass(ct),style:J.__tdStyle(ct)},Bi(J,ct))});if(Be.value===!0){const J=s["body-selection"],ue=J!==void 0?J(qn({key:En,row:ct,pageIndex:hn})):[me(gy,{modelValue:kn,color:e.color,dark:v.value,dense:e.dense,"onUpdate:modelValue":(Se,Oe)=>{tn([En],[ct],Se,Oe)}})];V.unshift(me("td",{class:"q-table--col-auto-width"},ue))}const $={key:En,class:{selected:kn}};return e.onRowClick!==void 0&&($.class["cursor-pointer"]=!0,$.onClick=J=>{u("RowClick",J,ct,hn)}),e.onRowDblclick!==void 0&&($.class["cursor-pointer"]=!0,$.onDblclick=J=>{u("RowDblclick",J,ct,hn)}),e.onRowContextmenu!==void 0&&($.class["cursor-pointer"]=!0,$.onContextmenu=J=>{u("RowContextmenu",J,ct,hn)}),me("tr",$,V)}function bn(){const ct=s.body,Kt=s["top-row"],hn=s["bottom-row"];let En=ke.value.map((kn,Y)=>nn(kn,ct,Y));return Kt!==void 0&&(En=Kt({cols:mt.value}).concat(En)),hn!==void 0&&(En=En.concat(hn({cols:mt.value}))),me("tbody",En)}function Ln(ct){return Hn(ct),ct.cols=ct.cols.map(Kt=>bs({...Kt},"value",()=>Bi(Kt,ct.row))),ct}function An(ct){return Hn(ct),bs(ct,"value",()=>Bi(ct.col,ct.row)),ct}function qn(ct){return Hn(ct),ct}function Hn(ct){Object.assign(ct,{cols:mt.value,colsMap:Bt.value,sort:gt,rowIndex:ot.value+ct.pageIndex,color:e.color,dark:v.value,dense:e.dense}),Be.value===!0&&bs(ct,"selected",()=>Ge(ct.key),(Kt,hn)=>{tn([ct.key],[ct.row],Kt,hn)}),bs(ct,"expand",()=>ce(ct.key),Kt=>{Te(ct.key,Kt)})}function Bi(ct,Kt){const hn=typeof ct.field=="function"?ct.field(Kt):Kt[ct.field];return ct.format!==void 0?ct.format(hn,Kt):hn}const ji=se(()=>({pagination:K.value,pagesNumber:un.value,isFirstPage:ft.value,isLastPage:sn.value,firstPage:Fe,prevPage:nt,nextPage:yt,lastPage:zt,inFullscreen:b.value,toggleFullscreen:o}));function qi(){const ct=s.top,Kt=s["top-left"],hn=s["top-right"],En=s["top-selection"],kn=Be.value===!0&&En!==void 0&&Xt.value>0,Y="q-table__top relative-position row items-center";if(ct!==void 0)return me("div",{class:Y},[ct(ji.value)]);let V;if(kn===!0?V=En(ji.value).slice():(V=[],Kt!==void 0?V.push(me("div",{class:"q-table-control"},[Kt(ji.value)])):e.title&&V.push(me("div",{class:"q-table__control"},[me("div",{class:["q-table__title",e.titleClass]},e.title)]))),hn!==void 0&&(V.push(me("div",{class:"q-table__separator col"})),V.push(me("div",{class:"q-table__control"},[hn(ji.value)]))),V.length!==0)return me("div",{class:Y},V)}const tr=se(()=>lt.value===!0?null:Ye.value);function Ei(){const ct=$i();return e.loading===!0&&s.loading===void 0&&ct.push(me("tr",{class:"q-table__progress"},[me("th",{class:"relative-position",colspan:jt.value},Rt())])),me("thead",ct)}function $i(){const ct=s.header,Kt=s["header-cell"];if(ct!==void 0)return ct(hr({header:!0})).slice();const hn=mt.value.map(En=>{const kn=s[`header-cell-${En.name}`],Y=kn!==void 0?kn:Kt,V=hr({col:En});return Y!==void 0?Y(V):me(z2,{key:En.name,props:V},()=>En.label)});if(Re.value===!0&&e.grid!==!0)hn.unshift(me("th",{class:"q-table--col-auto-width"}," "));else if(Ze.value===!0){const En=s["header-selection"],kn=En!==void 0?En(hr({})):[me(gy,{color:e.color,modelValue:tr.value,dark:v.value,dense:e.dense,"onUpdate:modelValue":Mr})];hn.unshift(me("th",{class:"q-table--col-auto-width"},kn))}return[me("tr",{class:e.tableHeaderClass,style:e.tableHeaderStyle},hn)]}function hr(ct){return Object.assign(ct,{cols:mt.value,sort:gt,colsMap:Bt.value,color:e.color,dark:v.value,dense:e.dense}),Ze.value===!0&&bs(ct,"selected",()=>tr.value,Mr),ct}function Mr(ct){lt.value===!0&&(ct=!1),tn(ke.value.map(S.value),ke.value,ct)}const Ir=se(()=>{const ct=[e.iconFirstPage||m.iconSet.table.firstPage,e.iconPrevPage||m.iconSet.table.prevPage,e.iconNextPage||m.iconSet.table.nextPage,e.iconLastPage||m.iconSet.table.lastPage];return m.lang.rtl===!0?ct.reverse():ct});function mo(){if(e.hideBottom===!0)return;if(Nt.value===!0){if(e.hideNoData===!0)return;const hn=e.loading===!0?e.loadingLabel||m.lang.table.loading:e.filter?e.noResultsLabel||m.lang.table.noResults:e.noDataLabel||m.lang.table.noData,En=s["no-data"],kn=En!==void 0?[En({message:hn,icon:m.iconSet.table.warning,filter:e.filter})]:[me(Wr,{class:"q-table__bottom-nodata-icon",name:m.iconSet.table.warning}),hn];return me("div",{class:$p+" q-table__bottom--nodata"},kn)}const ct=s.bottom;if(ct!==void 0)return me("div",{class:$p},[ct(ji.value)]);const Kt=e.hideSelectedBanner!==!0&&Be.value===!0&&Xt.value>0?[me("div",{class:"q-table__control"},[me("div",[(e.selectedRowsLabel||m.lang.table.selectedRecords)(Xt.value)])])]:[];if(e.hidePagination!==!0)return me("div",{class:$p+" justify-end"},so(Kt));if(Kt.length>0)return me("div",{class:$p},Kt)}function vr(ct){ve({page:1,rowsPerPage:ct.value})}function so(ct){let Kt;const{rowsPerPage:hn}=K.value,En=e.paginationLabel||m.lang.table.pagination,kn=s.pagination,Y=e.rowsPerPageOptions.length>1;if(ct.push(me("div",{class:"q-table__separator col"})),Y===!0&&ct.push(me("div",{class:"q-table__control"},[me("span",{class:"q-table__bottom-item"},[e.rowsPerPageLabel||m.lang.table.recordsPerPage]),me(eF,{class:"q-table__select inline q-table__bottom-item",color:e.color,modelValue:hn,options:oe.value,displayValue:hn===0?m.lang.table.allRows:hn,dark:v.value,borderless:!0,dense:!0,optionsDense:!0,optionsCover:!0,"onUpdate:modelValue":vr})])),kn!==void 0)Kt=kn(ji.value);else if(Kt=[me("span",hn!==0?{class:"q-table__bottom-item"}:{},[hn?En(ot.value+1,Math.min(_t.value,be.value),be.value):En(1,Ie.value,be.value)])],hn!==0&&un.value>1){const V={color:e.color,round:!0,dense:!0,flat:!0};e.dense===!0&&(V.size="sm"),un.value>2&&Kt.push(me(Ci,{key:"pgFirst",...V,icon:Ir.value[0],disable:ft.value,onClick:Fe})),Kt.push(me(Ci,{key:"pgPrev",...V,icon:Ir.value[1],disable:ft.value,onClick:nt}),me(Ci,{key:"pgNext",...V,icon:Ir.value[2],disable:sn.value,onClick:yt})),un.value>2&&Kt.push(me(Ci,{key:"pgLast",...V,icon:Ir.value[3],disable:sn.value,onClick:zt}))}return ct.push(me("div",{class:"q-table__control"},Kt)),ct}function ns(){const ct=e.gridHeader===!0?[me("table",{class:"q-table"},[Ei()])]:e.loading===!0&&s.loading===void 0?Rt():void 0;return me("div",{class:"q-table__middle"},ct)}function ao(){const ct=s.item!==void 0?s.item:Kt=>{const hn=Kt.cols.map(kn=>me("div",{class:"q-table__grid-item-row"},[me("div",{class:"q-table__grid-item-title"},[kn.label]),me("div",{class:"q-table__grid-item-value"},[kn.value])]));if(Be.value===!0){const kn=s["body-selection"],Y=kn!==void 0?kn(Kt):[me(gy,{modelValue:Kt.selected,color:e.color,dark:v.value,dense:e.dense,"onUpdate:modelValue":(V,$)=>{tn([Kt.key],[Kt.row],V,$)}})];hn.unshift(me("div",{class:"q-table__grid-item-row"},Y),me(L2,{dark:v.value}))}const En={class:["q-table__grid-item-card"+D.value,e.cardClass],style:e.cardStyle};return(e.onRowClick!==void 0||e.onRowDblclick!==void 0)&&(En.class[0]+=" cursor-pointer",e.onRowClick!==void 0&&(En.onClick=kn=>{u("RowClick",kn,Kt.row,Kt.pageIndex)}),e.onRowDblclick!==void 0&&(En.onDblclick=kn=>{u("RowDblclick",kn,Kt.row,Kt.pageIndex)})),me("div",{class:"q-table__grid-item col-xs-12 col-sm-6 col-md-4 col-lg-3"+(Kt.selected===!0?" q-table__grid-item--selected":"")},[me("div",En,hn)])};return me("div",{class:["q-table__grid-content row",e.cardContainerClass],style:e.cardContainerStyle},ke.value.map((Kt,hn)=>ct(Ln({key:S.value(Kt),row:Kt,pageIndex:hn}))))}return Object.assign(f.proxy,{requestServerInteraction:te,setPagination:ve,firstPage:Fe,prevPage:nt,nextPage:yt,lastPage:zt,isRowSelected:Ge,clearSelection:At,isRowExpanded:ce,setExpanded:pe,sort:gt,resetVirtualScroll:bt,scrollTo:Wt,getCellValue:Bi}),Uk(f.proxy,{filteredSortedRows:()=>Me.value,computedRows:()=>ke.value,computedRowsNumber:()=>be.value}),()=>{const ct=[qi()],Kt={ref:k,class:j.value};return e.grid===!0?ct.push(ns()):Object.assign(Kt,{class:[Kt.class,e.cardClass],style:e.cardStyle}),ct.push(Mt(),mo()),e.loading===!0&&s.loading!==void 0&&ct.push(s.loading()),me("div",Kt,ct)}}});function U2(){return Ur(_T)}const AF={class:"flex row justify-center",style:{width:"100%"}},MF={__name:"SearchPopUp",props:{toggle:Boolean},emits:["update:toggle","update:currentTag"],setup(e,{emit:s}){const u=e,f=U2(),m=Zd(),v=M2(u,"toggle",s),b=xt(),o=xt(""),S=se(()=>b.value.filter(L=>L.title.toLowerCase().includes(o.value.toLowerCase()))),k=[{name:"image",label:"Image",field:"image",align:"center"},{name:"title",label:"Title",field:"title",align:"center"},{name:"description",label:"Description",field:"descrition",align:"center"},{name:"favourite",label:"favourite",field:"favourite",align:"center"}],I=()=>{const L=["image","title"];return f.screen.gt.xs&&L.push("description"),f.screen.gt.sm&&L.push("favourite"),L};return Ui(()=>{S.value=m.tags}),Nm(()=>{b.value=m.tags}),(L,D)=>(Yn(),Yi(Cm,{modelValue:Bn(v),"onUpdate:modelValue":D[1]||(D[1]=N=>Vi(v)?v.value=N:null),persistent:"",maximized:!0,"transition-show":"slide-up","transition-hide":"slide-down"},{default:vn(()=>[Ut(Md,null,{default:vn(()=>[Ut(Hy,{class:"bg-white text-black flex justify-center"},{default:vn(()=>[Ql(Ut(Ci,{dense:"",flat:"","font-size":"30px",icon:"expand_more"},null,512),[[om]])]),_:1}),Ut(CF,{rows:Bn(S),columns:k,"row-key":"name","hide-bottom":"","rows-per-page-options":[20],"visible-columns":I(),style:{height:"80vh"}},{top:vn(()=>[Ar("div",AF,[Ut(rm,{rounded:"",outlined:"",debounce:"300",modelValue:o.value,"onUpdate:modelValue":D[0]||(D[0]=N=>o.value=N),placeholder:"Search"},{append:vn(()=>[Ut(Wr,{name:"search"})]),_:1},8,["modelValue"])])]),header:vn(N=>[Ut(B3,{props:N},{default:vn(()=>[(Yn(!0),no(Ki,null,Mu(N.cols,j=>(Yn(),Yi(z2,{key:j.name,props:N,class:"text-primary"},{default:vn(()=>[Bd(Hs(j.label),1)]),_:2},1032,["props"]))),128))]),_:2},1032,["props"])]),"body-cell-image":vn(N=>[Ut(j3,{props:N},{default:vn(()=>[Ar("div",null,[Ut(U3,{onClick:j=>s("update:currentTag",N.row),src:`/images/${N.row.images[0]}`},null,8,["onClick","src"])])]),_:2},1032,["props"])]),_:1},8,["rows","visible-columns"])]),_:1})]),_:1},8,["modelValue"]))}},IF={class:"text-h6"},kF={class:"text-subtitle2"},PF={__name:"MarkerCard",props:{tag:Object},emits:["update:currentTag","opendBigDailog"],setup(e,{emit:s}){const u=e,f=Zd(),m=()=>{s("update:currentTag",u.tag)};return(v,b)=>(Yn(),Yi(Md,{class:"my-card",style:{width:"250px"}},{default:vn(()=>[Ut(Ci,{class:"fixed-top-left q-mt-md","text-color":"primary",flat:"",icon:"open_in_full",onClick:b[0]||(b[0]=o=>m()),style:{"z-index":"1"}}),e.tag.favourite?Es("",!0):(Yn(),Yi(Ci,{key:0,class:"fixed-top-right q-mt-md","text-color":"primary",flat:"",icon:"star_outline",style:{"z-index":"1"},onClick:b[1]||(b[1]=o=>Bn(f).favouriteTag(e.tag))})),e.tag.favourite?(Yn(),Yi(Ci,{key:1,class:"fixed-top-right q-mt-md","text-color":"primary",flat:"",icon:"star",style:{"z-index":"1"},onClick:b[2]||(b[2]=o=>Bn(f).favouriteTag(e.tag))})):Es("",!0),Ut(A2,{images:u.tag.images},null,8,["images"]),Ut(Ws,null,{default:vn(()=>[Ar("div",IF,Hs(u.tag.title),1),Ar("div",kF,Hs(u.tag.description),1)]),_:1}),Ut(Ws,{class:"q-pt-none"}),Ut(L2),Ut(Ws,null,{default:vn(()=>[Ar("p",null,"Datum:"+Hs(u.tag.created),1)]),_:1})]),_:1}))}},zF={__name:"HomeView",setup(e){nm();const s=Zd(),u=UL(),f=xt(s.tags[0]),m=xt(!1),v=xt(!1),b=L=>{f.value=L,m.value=!0},o="pk.eyJ1IjoidG9iaXdhbmtpcm5vYmkiLCJhIjoiY2xlNXBuc2g1MGY4YzNxcWkxcWNtZ3N2ZCJ9.qWMZQd_uuqNnTDb9QcBtiQ",S=xt();let k=0;const I=setInterval(()=>{const L=document.querySelector(".mapboxgl-ctrl-geolocate");L&&(L.click(),clearInterval(I)),k>=8e3&&clearInterval(I),k+=500},500);return Ui(()=>{s.getUserTags()}),(L,D)=>(Yn(),no(Ki,null,[Ut(Bn(Zy),{style:{height:"100vh"},ref_key:"mapboxMap",ref:S,"access-token":Bn(o),"map-style":"mapbox://styles/tobiwankirnobi/cle5t3xjp001b01o4s7negt5k",center:[0,0],zoom:1},{default:vn(()=>[Ut(Bn(SB),{trackUserLocation:!0,showAccuracyCircle:!1}),(Yn(!0),no(Ki,null,Mu(Bn(s).tags,N=>(Yn(),Yi(Bn(Wy),{key:N.id,"lng-lat":[N.coords.longitude,N.coords.latitude],popup:{closeButton:!1,maxWidth:"300px"}},{popup:vn(()=>[Ut(PF,{tag:N,"onUpdate:currentTag":D[0]||(D[0]=j=>b(j))},null,8,["tag"])]),_:2},1032,["lng-lat"]))),128))]),_:1},8,["access-token"]),Ut(eS,{id:"footer-toolbar",class:"row justify-center q-gutter-md q-my-md fixed-bottom"},{default:vn(()=>[Ut(Ci,{size:"32px",color:"primary",flat:"",square:"",icon:"image",onClick:D[1]||(D[1]=N=>Bn(u).push({path:"albums"}))}),Ut(Ci,{size:"32px",color:"primary",flat:"",square:"",icon:"add",onClick:D[2]||(D[2]=N=>Bn(u).push({path:"add"}))}),Ut(Ci,{size:"32px",color:"primary",flat:"",square:"",icon:"search",onClick:D[3]||(D[3]=N=>v.value=!0)})]),_:1}),Ut(O3,{currentTag:f.value,toggle:m.value,"onUpdate:toggle":D[4]||(D[4]=N=>m.value=N)},null,8,["currentTag","toggle"]),Ut(MF,{toggle:v.value,"onUpdate:toggle":D[5]||(D[5]=N=>v.value=N),"onUpdate:currentTag":D[6]||(D[6]=N=>b(N))},null,8,["toggle"])],64))}},j2=NL({history:tL("/"),routes:[{path:"/",name:"home",component:zF,beforeEnter:(e,s,u)=>{nm().isAuthenticated?u():u({path:"/login"})}},{path:"/add",name:"Add Tag",component:()=>du(()=>import("./AddTagView.c2595b0f.js"),[])},{path:"/albums",name:"Albums",component:()=>du(()=>import("./AlbumsView.9c6c48e2.js"),[])},{path:"/login",name:"login",component:()=>du(()=>import("./LoginRegister.f3d82b4b.js"),[]),beforeEnter:(e,s,u)=>{nm().isAuthenticated?u({path:"/login"}):u()}},{path:"/logout",beforeEnter:(e,s,u)=>{nm().logout(),u({path:"/login"})}},{path:"/verify/",name:"verify",component:()=>du(()=>import("./VerifyRegestration.e0722468.js"),[])},{path:"/thankyou",name:"newRegistred",component:()=>du(()=>import("./NewRegistred.520a23c1.js"),["assets/NewRegistred.520a23c1.js","assets/_plugin-vue_export-helper.cdc0426e.js"])},{path:"/:catchAll(.*)*",component:()=>du(()=>import("./ErrorNotFound.31db2d8c.js"),["assets/ErrorNotFound.31db2d8c.js","assets/_plugin-vue_export-helper.cdc0426e.js"])}]}),LF={__name:"EssentialLinks",props:{title:{type:String,required:!0},link:{type:String,default:"#"},icon:{type:String,default:""},svg:{type:String,default:null}},setup(e){const s=e,u=()=>{j2.push(s.link)};return(f,m)=>(Yn(),Yi(oS,{clickable:"",tag:"a",target:"_blank",onClick:m[0]||(m[0]=v=>u())},{default:vn(()=>[e.icon?(Yn(),Yi(Yp,{key:0,avatar:""},{default:vn(()=>[Ut(Wr,{size:"30px",name:e.icon},null,8,["name"])]),_:1})):Es("",!0),e.svg?(Yn(),Yi(Yp,{key:1,avatar:""},{default:vn(()=>[Ut(Sd,{size:"30px",color:"primary","text-color":"white"},{default:vn(()=>[Bd(Hs(e.title[0]),1)]),_:1})]),_:1})):Es("",!0),Ut(Yp,null,{default:vn(()=>[Ut(rS,null,{default:vn(()=>[Bd(Hs(e.title),1)]),_:1})]),_:1})]),_:1}))}},rE=async()=>{try{return await fetch(window.location.origin,{method:"HEAD"}),!0}catch{return!1}};let fo=null;const RF=async()=>{fo=await P2("albumsDB",1,{upgrade(e){e.createObjectStore("albums",{keyPath:"_id"})}})},DF=Cv("albumStore",()=>{const e=xt([]);let s=!0;const u=se(()=>Tn(e.value));async function f(){if(!s){let L=await fo.getAll("albums");e.value=L.filter(D=>!D.isDeleted);return}try{const{data:L}=await zo.get("/api/album/");e.value=L,await fo.clear("albums"),e.value.forEach(D=>{fo.put("albums",Tn(D))})}catch(L){console.error(L),s=!1,f()}}async function m(L,D){if(!s){const N=await fo.get("albums",L._id);D.title&&(N.title=D.title),D.description&&(N.description=D.description),D.tags&&(N.tags=D.tags),await fo.put("albums",Tn(N)),await f();return}try{await zo.patch(`/api/album/${L._id}`,{updatedFields:D}),await f()}catch(N){console.error(N),s=!1,m(L,D)}}async function v(L){if(!s){const D=await fo.get("albums",L._id);D.isDeleted=!0,await fo.put("albums",Tn(D)),e.value.splice(e.value.findIndex(N=>N._id==L._id),1);return}try{await zo.delete(`/api/album/${L._id}`),e.value.splice(e.value.findIndex(D=>D._id==L._id),1)}catch(D){console.error(D),s=!1,v(L)}}async function b(L){if(!s){const D=await fo.get("albums",L._id);D.favourite===void 0&&(D.favourite=!1),D.favourite=!D.favourite,D.edit=!0,await fo.put("albums",Tn(D)),e.value.find(N=>N._id===L._id).favourite=D.favourite;return}try{await zo.post(`/api/album/favourite/${L._id}`);const D=e.value.find(N=>N._id===L._id);D.favourite=!D.favourite}catch(D){console.error(D),s=!1,b(L)}}async function o(L){if(console.log(L),!s){await fo.put("albums",Tn({_id:e.value.length,title:L.title,description:L.description,tags:L.tags,new:!0})),e.value.push({_id:e.value.length,title:L.title,description:L.description,tags:L.tags});return}try{await zo.post("/api/album",{updatedFields:L}),await f()}catch(D){console.error(D),s=!1,o(L)}}function S(L){s=L}async function k(){fo||await RF()}async function I(){try{await(await fo.getAll("albums")).forEach(D=>{if(D.isDeleted)v(D);else if(D.new)delete D.new,delete D._id,delete D.edit,o(D);else if(D.edit){const N=D;delete N.new,delete N.edit,m(D,N)}}),await f()}catch(L){console.error(L),s=!1;return}}return{getUserAlbums:f,updateAlbum:m,deleteAlbum:v,favouriteAlbum:b,createAlbum:o,updateOnline:S,createDB:k,sync:I,albums:e,albumsGetter:u}},{persist:!0});const OF=Ar("img",{src:"/Logos/Main.svg"},null,-1),BF=Ar("p",{class:"river"},"TagIt",-1),FF=Ar("img",{src:"/Logos/Main.svg"},null,-1),NF={__name:"App",setup(e){const s=U2(),u=Zd(),f=DF(),m=xt(!1),v=()=>m.value=!m.value,b=[{title:"Account",icon:"account_circle",link:"/"},{title:"Logout",icon:"logout",link:"/login"}],o=xt(!0),S=xt(!1),k=L=>{u.updateOnline(L),f.updateOnline(L)},I=async()=>{var D;o.value=await rE(),window.addEventListener("online",()=>o.value=!0),window.addEventListener("offline",()=>o.value=!1);const L=await navigator.serviceWorker.getRegistration();L&&((D=L.waiting)==null||D.postMessage({type:"SKIP_WAITING"})),window.location.reload()};return Ui(async()=>{window.indexedDB||alert("IndexedDB is not available!"),await f.createDB(),await u.createDB(),o.value=await rE(),window.addEventListener("online",async()=>{o.value=!0,k(!0),s.notify({color:"green-4",textColor:"white",icon:"wifi",message:"Online"}),await f.sync(),await u.sync()}),window.addEventListener("offline",()=>{o.value=!1,k(!1),s.notify({color:"red-4",textColor:"white",icon:"wifi_off",message:"Offline"})});const L=await navigator.serviceWorker.getRegistration();if(!L){console.log("registration failed!");return}L.addEventListener("updatefound",()=>{S.value=!0,s.notify({color:"blue-4",textColor:"white",icon:"refresh",message:"An Update is available!",position:"top-right"})}),L.waiting&&(S.value=!0),window.indexedDB||alert("IndexedDB is not available!")}),(L,D)=>{const N=kI("router-view");return Yn(),Yi(Dz,{view:"hHh lpr fFf"},{default:vn(()=>[Ut(Tz,{elevated:"",class:"bg-primary text-white","height-hint":"98"},{default:vn(()=>[Ut(eS,null,{default:vn(()=>[Ut(Ci,{dense:"",flat:"",round:"",icon:"menu",onClick:v}),Ut(tz,{class:"row justify-center"},{default:vn(()=>[Ut(Sd,null,{default:vn(()=>[OF]),_:1}),BF,Ut(Sd,null,{default:vn(()=>[FF]),_:1})]),_:1}),S.value?(Yn(),Yi(Ci,{key:0,flat:"",class:"text-white",onClick:I,size:"20px",icon:"refresh"})):Es("",!0),Ut(Sd,{"font-size":"40px","text-color":"white",icon:"account_circle"},{default:vn(()=>[Ut(JT,{"transition-show":"jump-down","transition-hide":"jump-up"},{default:vn(()=>[Ut(VT,{style:{"min-width":"100px"}},{default:vn(()=>[(Yn(),no(Ki,null,Mu(b,j=>Ut(LF,jm({key:j.title},j),null,16)),64))]),_:1})]),_:1}),o.value?Es("",!0):(Yn(),Yi(F1,{key:0,floating:"",color:"red",rounded:""})),o.value?(Yn(),Yi(F1,{key:1,floating:"",color:"green",rounded:""})):Es("",!0)]),_:1})]),_:1})]),_:1}),Ut(Pz,{modelValue:m.value,"onUpdate:modelValue":D[0]||(D[0]=j=>m.value=j),side:"left",bordered:""},null,8,["modelValue"]),Ut(zz,null,{default:vn(()=>[Ut(N)]),_:1})]),_:1})}}},fg=hT(NF),q2=fP();q2.use(ez);fg.use(q2);fg.use(j2);fg.use(hP,{plugins:{Notify:HP},iconSet:gT});fg.mount("#app");export{Om as $,Ql as A,Ur as B,om as C,Xs as D,VF as E,Ki as F,se as G,Ii as H,me as I,zi as J,Ha as K,Sv as L,Zy as M,Ro as N,In as O,Ua as P,Ci as Q,MT as R,QB as S,Un as T,GT as U,Rv as V,Cs as W,Am as X,Ht as Y,Yl as Z,Nu as _,Zd as a,Oy as a0,bi as a1,LT as a2,ui as a3,Km as a4,sP as a5,NB as a6,VB as a7,io as a8,UB as a9,ro as aa,jB as ab,mm as ac,U2 as ad,nm as ae,zo as af,j2 as ag,Yn as b,no as c,Ar as d,Mu as e,Ut as f,Cm as g,Md as h,Ws as i,rm as j,Bd as k,Bn as l,ly as m,Wy as n,Ui as o,DF as p,Yi as q,xt as r,Es as s,L2 as t,UL as u,Hs as v,vn as w,Wr as x,eF as y,Hy as z};
