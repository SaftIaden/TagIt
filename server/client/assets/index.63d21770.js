(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const m of document.querySelectorAll('link[rel="modulepreload"]'))f(m);new MutationObserver(m=>{for(const v of m)if(v.type==="childList")for(const w of v.addedNodes)w.tagName==="LINK"&&w.rel==="modulepreload"&&f(w)}).observe(document,{childList:!0,subtree:!0});function u(m){const v={};return m.integrity&&(v.integrity=m.integrity),m.referrerpolicy&&(v.referrerPolicy=m.referrerpolicy),m.crossorigin==="use-credentials"?v.credentials="include":m.crossorigin==="anonymous"?v.credentials="omit":v.credentials="same-origin",v}function f(m){if(m.ep)return;m.ep=!0;const v=u(m);fetch(m.href,v)}})();function Hy(t,s){const u=Object.create(null),f=t.split(",");for(let m=0;m<f.length;m++)u[f[m]]=!0;return s?m=>!!u[m.toLowerCase()]:m=>!!u[m]}const QA="itemscope,allowfullscreen,formnovalidate,ismap,nomodule,novalidate,readonly",JA=Hy(QA);function jw(t){return!!t||t===""}function Wy(t){if(Sn(t)){const s={};for(let u=0;u<t.length;u++){const f=t[u],m=er(f)?nM(f):Wy(f);if(m)for(const v in m)s[v]=m[v]}return s}else{if(er(t))return t;if(Li(t))return t}}const eM=/;(?![^(]*\))/g,tM=/:(.+)/;function nM(t){const s={};return t.split(eM).forEach(u=>{if(u){const f=u.split(tM);f.length>1&&(s[f[0].trim()]=f[1].trim())}}),s}function Xy(t){let s="";if(er(t))s=t;else if(Sn(t))for(let u=0;u<t.length;u++){const f=Xy(t[u]);f&&(s+=f+" ")}else if(Li(t))for(const u in t)t[u]&&(s+=u+" ");return s.trim()}const Gs=t=>er(t)?t:t==null?"":Sn(t)||Li(t)&&(t.toString===Hw||!Nn(t.toString))?JSON.stringify(t,$w,2):String(t),$w=(t,s)=>s&&s.__v_isRef?$w(t,s.value):mu(s)?{[`Map(${s.size})`]:[...s.entries()].reduce((u,[f,m])=>(u[`${f} =>`]=m,u),{})}:Gw(s)?{[`Set(${s.size})`]:[...s.values()]}:Li(s)&&!Sn(s)&&!Ww(s)?String(s):s,Ai={},pu=[],Yo=()=>{},iM=()=>!1,rM=/^on[^a-z]/,Tm=t=>rM.test(t),Ky=t=>t.startsWith("onUpdate:"),vr=Object.assign,Yy=(t,s)=>{const u=t.indexOf(s);u>-1&&t.splice(u,1)},oM=Object.prototype.hasOwnProperty,Jn=(t,s)=>oM.call(t,s),Sn=Array.isArray,mu=t=>Sm(t)==="[object Map]",Gw=t=>Sm(t)==="[object Set]",Nn=t=>typeof t=="function",er=t=>typeof t=="string",Qy=t=>typeof t=="symbol",Li=t=>t!==null&&typeof t=="object",Zw=t=>Li(t)&&Nn(t.then)&&Nn(t.catch),Hw=Object.prototype.toString,Sm=t=>Hw.call(t),sM=t=>Sm(t).slice(8,-1),Ww=t=>Sm(t)==="[object Object]",Jy=t=>er(t)&&t!=="NaN"&&t[0]!=="-"&&""+parseInt(t,10)===t,Up=Hy(",key,ref,ref_for,ref_key,onVnodeBeforeMount,onVnodeMounted,onVnodeBeforeUpdate,onVnodeUpdated,onVnodeBeforeUnmount,onVnodeUnmounted"),Cm=t=>{const s=Object.create(null);return u=>s[u]||(s[u]=t(u))},aM=/-(\w)/g,bs=Cm(t=>t.replace(aM,(s,u)=>u?u.toUpperCase():"")),lM=/\B([A-Z])/g,Ru=Cm(t=>t.replace(lM,"-$1").toLowerCase()),Am=Cm(t=>t.charAt(0).toUpperCase()+t.slice(1)),P_=Cm(t=>t?`on${Am(t)}`:""),Ad=(t,s)=>!Object.is(t,s),vd=(t,s)=>{for(let u=0;u<t.length;u++)t[u](s)},nm=(t,s,u)=>{Object.defineProperty(t,s,{configurable:!0,enumerable:!1,value:u})},Xw=t=>{const s=parseFloat(t);return isNaN(s)?t:s};let xb;const cM=()=>xb||(xb=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{});let ms;class Kw{constructor(s=!1){this.detached=s,this.active=!0,this.effects=[],this.cleanups=[],this.parent=ms,!s&&ms&&(this.index=(ms.scopes||(ms.scopes=[])).push(this)-1)}run(s){if(this.active){const u=ms;try{return ms=this,s()}finally{ms=u}}}on(){ms=this}off(){ms=this.parent}stop(s){if(this.active){let u,f;for(u=0,f=this.effects.length;u<f;u++)this.effects[u].stop();for(u=0,f=this.cleanups.length;u<f;u++)this.cleanups[u]();if(this.scopes)for(u=0,f=this.scopes.length;u<f;u++)this.scopes[u].stop(!0);if(!this.detached&&this.parent&&!s){const m=this.parent.scopes.pop();m&&m!==this&&(this.parent.scopes[this.index]=m,m.index=this.index)}this.parent=void 0,this.active=!1}}}function Yw(t){return new Kw(t)}function uM(t,s=ms){s&&s.active&&s.effects.push(t)}const ev=t=>{const s=new Set(t);return s.w=0,s.n=0,s},Qw=t=>(t.w&ja)>0,Jw=t=>(t.n&ja)>0,hM=({deps:t})=>{if(t.length)for(let s=0;s<t.length;s++)t[s].w|=ja},dM=t=>{const{deps:s}=t;if(s.length){let u=0;for(let f=0;f<s.length;f++){const m=s[f];Qw(m)&&!Jw(m)?m.delete(t):s[u++]=m,m.w&=~ja,m.n&=~ja}s.length=u}},hy=new WeakMap;let gd=0,ja=1;const dy=30;let Ho;const Hl=Symbol(""),fy=Symbol("");class tv{constructor(s,u=null,f){this.fn=s,this.scheduler=u,this.active=!0,this.deps=[],this.parent=void 0,uM(this,f)}run(){if(!this.active)return this.fn();let s=Ho,u=Na;for(;s;){if(s===this)return;s=s.parent}try{return this.parent=Ho,Ho=this,Na=!0,ja=1<<++gd,gd<=dy?hM(this):bb(this),this.fn()}finally{gd<=dy&&dM(this),ja=1<<--gd,Ho=this.parent,Na=u,this.parent=void 0,this.deferStop&&this.stop()}}stop(){Ho===this?this.deferStop=!0:this.active&&(bb(this),this.onStop&&this.onStop(),this.active=!1)}}function bb(t){const{deps:s}=t;if(s.length){for(let u=0;u<s.length;u++)s[u].delete(t);s.length=0}}let Na=!0;const eE=[];function Du(){eE.push(Na),Na=!1}function Ou(){const t=eE.pop();Na=t===void 0?!0:t}function ho(t,s,u){if(Na&&Ho){let f=hy.get(t);f||hy.set(t,f=new Map);let m=f.get(u);m||f.set(u,m=ev()),tE(m)}}function tE(t,s){let u=!1;gd<=dy?Jw(t)||(t.n|=ja,u=!Qw(t)):u=!t.has(Ho),u&&(t.add(Ho),Ho.deps.push(t))}function Ws(t,s,u,f,m,v){const w=hy.get(t);if(!w)return;let o=[];if(s==="clear")o=[...w.values()];else if(u==="length"&&Sn(t))w.forEach((S,k)=>{(k==="length"||k>=f)&&o.push(S)});else switch(u!==void 0&&o.push(w.get(u)),s){case"add":Sn(t)?Jy(u)&&o.push(w.get("length")):(o.push(w.get(Hl)),mu(t)&&o.push(w.get(fy)));break;case"delete":Sn(t)||(o.push(w.get(Hl)),mu(t)&&o.push(w.get(fy)));break;case"set":mu(t)&&o.push(w.get(Hl));break}if(o.length===1)o[0]&&py(o[0]);else{const S=[];for(const k of o)k&&S.push(...k);py(ev(S))}}function py(t,s){const u=Sn(t)?t:[...t];for(const f of u)f.computed&&wb(f);for(const f of u)f.computed||wb(f)}function wb(t,s){(t!==Ho||t.allowRecurse)&&(t.scheduler?t.scheduler():t.run())}const fM=Hy("__proto__,__v_isRef,__isVue"),nE=new Set(Object.getOwnPropertyNames(Symbol).filter(t=>t!=="arguments"&&t!=="caller").map(t=>Symbol[t]).filter(Qy)),pM=nv(),mM=nv(!1,!0),gM=nv(!0),Eb=_M();function _M(){const t={};return["includes","indexOf","lastIndexOf"].forEach(s=>{t[s]=function(...u){const f=Un(this);for(let v=0,w=this.length;v<w;v++)ho(f,"get",v+"");const m=f[s](...u);return m===-1||m===!1?f[s](...u.map(Un)):m}}),["push","pop","shift","unshift","splice"].forEach(s=>{t[s]=function(...u){Du();const f=Un(this)[s].apply(this,u);return Ou(),f}}),t}function nv(t=!1,s=!1){return function(f,m,v){if(m==="__v_isReactive")return!t;if(m==="__v_isReadonly")return t;if(m==="__v_isShallow")return s;if(m==="__v_raw"&&v===(t?s?LM:aE:s?sE:oE).get(f))return f;const w=Sn(f);if(!t&&w&&Jn(Eb,m))return Reflect.get(Eb,m,v);const o=Reflect.get(f,m,v);return(Qy(m)?nE.has(m):fM(m))||(t||ho(f,"get",m),s)?o:Vi(o)?w&&Jy(m)?o:o.value:Li(o)?t?lE(o):ko(o):o}}const yM=iE(),vM=iE(!0);function iE(t=!1){return function(u,f,m,v){let w=u[f];if(Eu(w)&&Vi(w)&&!Vi(m))return!1;if(!t&&(!im(m)&&!Eu(m)&&(w=Un(w),m=Un(m)),!Sn(u)&&Vi(w)&&!Vi(m)))return w.value=m,!0;const o=Sn(u)&&Jy(f)?Number(f)<u.length:Jn(u,f),S=Reflect.set(u,f,m,v);return u===Un(v)&&(o?Ad(m,w)&&Ws(u,"set",f,m):Ws(u,"add",f,m)),S}}function xM(t,s){const u=Jn(t,s);t[s];const f=Reflect.deleteProperty(t,s);return f&&u&&Ws(t,"delete",s,void 0),f}function bM(t,s){const u=Reflect.has(t,s);return(!Qy(s)||!nE.has(s))&&ho(t,"has",s),u}function wM(t){return ho(t,"iterate",Sn(t)?"length":Hl),Reflect.ownKeys(t)}const rE={get:pM,set:yM,deleteProperty:xM,has:bM,ownKeys:wM},EM={get:gM,set(t,s){return!0},deleteProperty(t,s){return!0}},TM=vr({},rE,{get:mM,set:vM}),iv=t=>t,Mm=t=>Reflect.getPrototypeOf(t);function Sp(t,s,u=!1,f=!1){t=t.__v_raw;const m=Un(t),v=Un(s);u||(s!==v&&ho(m,"get",s),ho(m,"get",v));const{has:w}=Mm(m),o=f?iv:u?sv:Md;if(w.call(m,s))return o(t.get(s));if(w.call(m,v))return o(t.get(v));t!==m&&t.get(s)}function Cp(t,s=!1){const u=this.__v_raw,f=Un(u),m=Un(t);return s||(t!==m&&ho(f,"has",t),ho(f,"has",m)),t===m?u.has(t):u.has(t)||u.has(m)}function Ap(t,s=!1){return t=t.__v_raw,!s&&ho(Un(t),"iterate",Hl),Reflect.get(t,"size",t)}function Tb(t){t=Un(t);const s=Un(this);return Mm(s).has.call(s,t)||(s.add(t),Ws(s,"add",t,t)),this}function Sb(t,s){s=Un(s);const u=Un(this),{has:f,get:m}=Mm(u);let v=f.call(u,t);v||(t=Un(t),v=f.call(u,t));const w=m.call(u,t);return u.set(t,s),v?Ad(s,w)&&Ws(u,"set",t,s):Ws(u,"add",t,s),this}function Cb(t){const s=Un(this),{has:u,get:f}=Mm(s);let m=u.call(s,t);m||(t=Un(t),m=u.call(s,t)),f&&f.call(s,t);const v=s.delete(t);return m&&Ws(s,"delete",t,void 0),v}function Ab(){const t=Un(this),s=t.size!==0,u=t.clear();return s&&Ws(t,"clear",void 0,void 0),u}function Mp(t,s){return function(f,m){const v=this,w=v.__v_raw,o=Un(w),S=s?iv:t?sv:Md;return!t&&ho(o,"iterate",Hl),w.forEach((k,I)=>f.call(m,S(k),S(I),v))}}function Ip(t,s,u){return function(...f){const m=this.__v_raw,v=Un(m),w=mu(v),o=t==="entries"||t===Symbol.iterator&&w,S=t==="keys"&&w,k=m[t](...f),I=u?iv:s?sv:Md;return!s&&ho(v,"iterate",S?fy:Hl),{next(){const{value:D,done:B}=k.next();return B?{value:D,done:B}:{value:o?[I(D[0]),I(D[1])]:I(D),done:B}},[Symbol.iterator](){return this}}}}function Ma(t){return function(...s){return t==="delete"?!1:this}}function SM(){const t={get(v){return Sp(this,v)},get size(){return Ap(this)},has:Cp,add:Tb,set:Sb,delete:Cb,clear:Ab,forEach:Mp(!1,!1)},s={get(v){return Sp(this,v,!1,!0)},get size(){return Ap(this)},has:Cp,add:Tb,set:Sb,delete:Cb,clear:Ab,forEach:Mp(!1,!0)},u={get(v){return Sp(this,v,!0)},get size(){return Ap(this,!0)},has(v){return Cp.call(this,v,!0)},add:Ma("add"),set:Ma("set"),delete:Ma("delete"),clear:Ma("clear"),forEach:Mp(!0,!1)},f={get(v){return Sp(this,v,!0,!0)},get size(){return Ap(this,!0)},has(v){return Cp.call(this,v,!0)},add:Ma("add"),set:Ma("set"),delete:Ma("delete"),clear:Ma("clear"),forEach:Mp(!0,!0)};return["keys","values","entries",Symbol.iterator].forEach(v=>{t[v]=Ip(v,!1,!1),u[v]=Ip(v,!0,!1),s[v]=Ip(v,!1,!0),f[v]=Ip(v,!0,!0)}),[t,u,s,f]}const[CM,AM,MM,IM]=SM();function rv(t,s){const u=s?t?IM:MM:t?AM:CM;return(f,m,v)=>m==="__v_isReactive"?!t:m==="__v_isReadonly"?t:m==="__v_raw"?f:Reflect.get(Jn(u,m)&&m in f?u:f,m,v)}const kM={get:rv(!1,!1)},PM={get:rv(!1,!0)},zM={get:rv(!0,!1)},oE=new WeakMap,sE=new WeakMap,aE=new WeakMap,LM=new WeakMap;function RM(t){switch(t){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}function DM(t){return t.__v_skip||!Object.isExtensible(t)?0:RM(sM(t))}function ko(t){return Eu(t)?t:ov(t,!1,rE,kM,oE)}function OM(t){return ov(t,!1,TM,PM,sE)}function lE(t){return ov(t,!0,EM,zM,aE)}function ov(t,s,u,f,m){if(!Li(t)||t.__v_raw&&!(s&&t.__v_isReactive))return t;const v=m.get(t);if(v)return v;const w=DM(t);if(w===0)return t;const o=new Proxy(t,w===2?f:u);return m.set(t,o),o}function Va(t){return Eu(t)?Va(t.__v_raw):!!(t&&t.__v_isReactive)}function Eu(t){return!!(t&&t.__v_isReadonly)}function im(t){return!!(t&&t.__v_isShallow)}function cE(t){return Va(t)||Eu(t)}function Un(t){const s=t&&t.__v_raw;return s?Un(s):t}function Xs(t){return nm(t,"__v_skip",!0),t}const Md=t=>Li(t)?ko(t):t,sv=t=>Li(t)?lE(t):t;function uE(t){Na&&Ho&&(t=Un(t),tE(t.dep||(t.dep=ev())))}function hE(t,s){t=Un(t),t.dep&&py(t.dep)}function Vi(t){return!!(t&&t.__v_isRef===!0)}function xt(t){return dE(t,!1)}function BM(t){return dE(t,!0)}function dE(t,s){return Vi(t)?t:new FM(t,s)}class FM{constructor(s,u){this.__v_isShallow=u,this.dep=void 0,this.__v_isRef=!0,this._rawValue=u?s:Un(s),this._value=u?s:Md(s)}get value(){return uE(this),this._value}set value(s){const u=this.__v_isShallow||im(s)||Eu(s);s=u?s:Un(s),Ad(s,this._rawValue)&&(this._rawValue=s,this._value=u?s:Md(s),hE(this))}}function On(t){return Vi(t)?t.value:t}const NM={get:(t,s,u)=>On(Reflect.get(t,s,u)),set:(t,s,u,f)=>{const m=t[s];return Vi(m)&&!Vi(u)?(m.value=u,!0):Reflect.set(t,s,u,f)}};function fE(t){return Va(t)?t:new Proxy(t,NM)}function VM(t){const s=Sn(t)?new Array(t.length):{};for(const u in t)s[u]=qM(t,u);return s}class UM{constructor(s,u,f){this._object=s,this._key=u,this._defaultValue=f,this.__v_isRef=!0}get value(){const s=this._object[this._key];return s===void 0?this._defaultValue:s}set value(s){this._object[this._key]=s}}function qM(t,s,u){const f=t[s];return Vi(f)?f:new UM(t,s,u)}var pE;class jM{constructor(s,u,f,m){this._setter=u,this.dep=void 0,this.__v_isRef=!0,this[pE]=!1,this._dirty=!0,this.effect=new tv(s,()=>{this._dirty||(this._dirty=!0,hE(this))}),this.effect.computed=this,this.effect.active=this._cacheable=!m,this.__v_isReadonly=f}get value(){const s=Un(this);return uE(s),(s._dirty||!s._cacheable)&&(s._dirty=!1,s._value=s.effect.run()),s._value}set value(s){this._setter(s)}}pE="__v_isReadonly";function $M(t,s,u=!1){let f,m;const v=Nn(t);return v?(f=t,m=Yo):(f=t.get,m=t.set),new jM(f,m,v||!m,u)}function Ua(t,s,u,f){let m;try{m=f?t(...f):t()}catch(v){Im(v,s,u)}return m}function zo(t,s,u,f){if(Nn(t)){const v=Ua(t,s,u,f);return v&&Zw(v)&&v.catch(w=>{Im(w,s,u)}),v}const m=[];for(let v=0;v<t.length;v++)m.push(zo(t[v],s,u,f));return m}function Im(t,s,u,f=!0){const m=s?s.vnode:null;if(s){let v=s.parent;const w=s.proxy,o=u;for(;v;){const k=v.ec;if(k){for(let I=0;I<k.length;I++)if(k[I](t,w,o)===!1)return}v=v.parent}const S=s.appContext.config.errorHandler;if(S){Ua(S,null,10,[t,w,o]);return}}GM(t,u,m,f)}function GM(t,s,u,f=!0){console.error(t)}let Id=!1,my=!1;const Br=[];let _s=0;const gu=[];let js=null,ql=0;const mE=Promise.resolve();let av=null;function ui(t){const s=av||mE;return t?s.then(this?t.bind(this):t):s}function ZM(t){let s=_s+1,u=Br.length;for(;s<u;){const f=s+u>>>1;kd(Br[f])<t?s=f+1:u=f}return s}function lv(t){(!Br.length||!Br.includes(t,Id&&t.allowRecurse?_s+1:_s))&&(t.id==null?Br.push(t):Br.splice(ZM(t.id),0,t),gE())}function gE(){!Id&&!my&&(my=!0,av=mE.then(yE))}function HM(t){const s=Br.indexOf(t);s>_s&&Br.splice(s,1)}function WM(t){Sn(t)?gu.push(...t):(!js||!js.includes(t,t.allowRecurse?ql+1:ql))&&gu.push(t),gE()}function Mb(t,s=Id?_s+1:0){for(;s<Br.length;s++){const u=Br[s];u&&u.pre&&(Br.splice(s,1),s--,u())}}function _E(t){if(gu.length){const s=[...new Set(gu)];if(gu.length=0,js){js.push(...s);return}for(js=s,js.sort((u,f)=>kd(u)-kd(f)),ql=0;ql<js.length;ql++)js[ql]();js=null,ql=0}}const kd=t=>t.id==null?1/0:t.id,XM=(t,s)=>{const u=kd(t)-kd(s);if(u===0){if(t.pre&&!s.pre)return-1;if(s.pre&&!t.pre)return 1}return u};function yE(t){my=!1,Id=!0,Br.sort(XM);const s=Yo;try{for(_s=0;_s<Br.length;_s++){const u=Br[_s];u&&u.active!==!1&&Ua(u,null,14)}}finally{_s=0,Br.length=0,_E(),Id=!1,av=null,(Br.length||gu.length)&&yE()}}function KM(t,s,...u){if(t.isUnmounted)return;const f=t.vnode.props||Ai;let m=u;const v=s.startsWith("update:"),w=v&&s.slice(7);if(w&&w in f){const I=`${w==="modelValue"?"model":w}Modifiers`,{number:D,trim:B}=f[I]||Ai;B&&(m=u.map(V=>V.trim())),D&&(m=u.map(Xw))}let o,S=f[o=P_(s)]||f[o=P_(bs(s))];!S&&v&&(S=f[o=P_(Ru(s))]),S&&zo(S,t,6,m);const k=f[o+"Once"];if(k){if(!t.emitted)t.emitted={};else if(t.emitted[o])return;t.emitted[o]=!0,zo(k,t,6,m)}}function vE(t,s,u=!1){const f=s.emitsCache,m=f.get(t);if(m!==void 0)return m;const v=t.emits;let w={},o=!1;if(!Nn(t)){const S=k=>{const I=vE(k,s,!0);I&&(o=!0,vr(w,I))};!u&&s.mixins.length&&s.mixins.forEach(S),t.extends&&S(t.extends),t.mixins&&t.mixins.forEach(S)}return!v&&!o?(Li(t)&&f.set(t,null),null):(Sn(v)?v.forEach(S=>w[S]=null):vr(w,v),Li(t)&&f.set(t,w),w)}function km(t,s){return!t||!Tm(s)?!1:(s=s.slice(2).replace(/Once$/,""),Jn(t,s[0].toLowerCase()+s.slice(1))||Jn(t,Ru(s))||Jn(t,s))}let Nr=null,xE=null;function rm(t){const s=Nr;return Nr=t,xE=t&&t.type.__scopeId||null,s}function vn(t,s=Nr,u){if(!s||t._n)return t;const f=(...m)=>{f._d&&Vb(-1);const v=rm(s);let w;try{w=t(...m)}finally{rm(v),f._d&&Vb(1)}return w};return f._n=!0,f._c=!0,f._d=!0,f}function z_(t){const{type:s,vnode:u,proxy:f,withProxy:m,props:v,propsOptions:[w],slots:o,attrs:S,emit:k,render:I,renderCache:D,data:B,setupState:V,ctx:$,inheritAttrs:ne}=t;let oe,ye;const te=rm(t);try{if(u.shapeFlag&4){const Ae=m||f;oe=gs(I.call(Ae,Ae,D,v,V,B,$)),ye=S}else{const Ae=s;oe=gs(Ae.length>1?Ae(v,{attrs:S,slots:o,emit:k}):Ae(v,null)),ye=s.props?S:YM(S)}}catch(Ae){bd.length=0,Im(Ae,t,1),oe=Nt(Lo)}let Se=oe;if(ye&&ne!==!1){const Ae=Object.keys(ye),{shapeFlag:ce}=Se;Ae.length&&ce&7&&(w&&Ae.some(Ky)&&(ye=QM(ye,w)),Se=Ks(Se,ye))}return u.dirs&&(Se=Ks(Se),Se.dirs=Se.dirs?Se.dirs.concat(u.dirs):u.dirs),u.transition&&(Se.transition=u.transition),oe=Se,rm(te),oe}const YM=t=>{let s;for(const u in t)(u==="class"||u==="style"||Tm(u))&&((s||(s={}))[u]=t[u]);return s},QM=(t,s)=>{const u={};for(const f in t)(!Ky(f)||!(f.slice(9)in s))&&(u[f]=t[f]);return u};function JM(t,s,u){const{props:f,children:m,component:v}=t,{props:w,children:o,patchFlag:S}=s,k=v.emitsOptions;if(s.dirs||s.transition)return!0;if(u&&S>=0){if(S&1024)return!0;if(S&16)return f?Ib(f,w,k):!!w;if(S&8){const I=s.dynamicProps;for(let D=0;D<I.length;D++){const B=I[D];if(w[B]!==f[B]&&!km(k,B))return!0}}}else return(m||o)&&(!o||!o.$stable)?!0:f===w?!1:f?w?Ib(f,w,k):!0:!!w;return!1}function Ib(t,s,u){const f=Object.keys(s);if(f.length!==Object.keys(t).length)return!0;for(let m=0;m<f.length;m++){const v=f[m];if(s[v]!==t[v]&&!km(u,v))return!0}return!1}function eI({vnode:t,parent:s},u){for(;s&&s.subTree===t;)(t=s.vnode).el=u,s=s.parent}const bE=t=>t.__isSuspense;function tI(t,s){s&&s.pendingBranch?Sn(t)?s.effects.push(...t):s.effects.push(t):WM(t)}function Wl(t,s){if(_r){let u=_r.provides;const f=_r.parent&&_r.parent.provides;f===u&&(u=_r.provides=Object.create(f)),u[t]=s}}function Vr(t,s,u=!1){const f=_r||Nr;if(f){const m=f.parent==null?f.vnode.appContext&&f.vnode.appContext.provides:f.parent.provides;if(m&&t in m)return m[t];if(arguments.length>1)return u&&Nn(s)?s.call(f.proxy):s}}const kb={};function Wt(t,s,u){return wE(t,s,u)}function wE(t,s,{immediate:u,deep:f,flush:m,onTrack:v,onTrigger:w}=Ai){const o=_r;let S,k=!1,I=!1;if(Vi(t)?(S=()=>t.value,k=im(t)):Va(t)?(S=()=>t,f=!0):Sn(t)?(I=!0,k=t.some(ye=>Va(ye)||im(ye)),S=()=>t.map(ye=>{if(Vi(ye))return ye.value;if(Va(ye))return Gl(ye);if(Nn(ye))return Ua(ye,o,2)})):Nn(t)?s?S=()=>Ua(t,o,2):S=()=>{if(!(o&&o.isUnmounted))return D&&D(),zo(t,o,3,[B])}:S=Yo,s&&f){const ye=S;S=()=>Gl(ye())}let D,B=ye=>{D=oe.onStop=()=>{Ua(ye,o,4)}};if(Dd)return B=Yo,s?u&&zo(s,o,3,[S(),I?[]:void 0,B]):S(),Yo;let V=I?[]:kb;const $=()=>{if(!!oe.active)if(s){const ye=oe.run();(f||k||(I?ye.some((te,Se)=>Ad(te,V[Se])):Ad(ye,V)))&&(D&&D(),zo(s,o,3,[ye,V===kb?void 0:V,B]),V=ye)}else oe.run()};$.allowRecurse=!!s;let ne;m==="sync"?ne=$:m==="post"?ne=()=>Cr($,o&&o.suspense):($.pre=!0,o&&($.id=o.uid),ne=()=>lv($));const oe=new tv(S,ne);return s?u?$():V=oe.run():m==="post"?Cr(oe.run.bind(oe),o&&o.suspense):oe.run(),()=>{oe.stop(),o&&o.scope&&Yy(o.scope.effects,oe)}}function nI(t,s,u){const f=this.proxy,m=er(t)?t.includes(".")?EE(f,t):()=>f[t]:t.bind(f,f);let v;Nn(s)?v=s:(v=s.handler,u=s);const w=_r;Au(this);const o=wE(m,v.bind(f),u);return w?Au(w):Kl(),o}function EE(t,s){const u=s.split(".");return()=>{let f=t;for(let m=0;m<u.length&&f;m++)f=f[u[m]];return f}}function Gl(t,s){if(!Li(t)||t.__v_skip||(s=s||new Set,s.has(t)))return t;if(s.add(t),Vi(t))Gl(t.value,s);else if(Sn(t))for(let u=0;u<t.length;u++)Gl(t[u],s);else if(Gw(t)||mu(t))t.forEach(u=>{Gl(u,s)});else if(Ww(t))for(const u in t)Gl(t[u],s);return t}function TE(){const t={isMounted:!1,isLeaving:!1,isUnmounting:!1,leavingVNodes:new Map};return Ui(()=>{t.isMounted=!0}),Ii(()=>{t.isUnmounting=!0}),t}const Ao=[Function,Array],iI={name:"BaseTransition",props:{mode:String,appear:Boolean,persisted:Boolean,onBeforeEnter:Ao,onEnter:Ao,onAfterEnter:Ao,onEnterCancelled:Ao,onBeforeLeave:Ao,onLeave:Ao,onAfterLeave:Ao,onLeaveCancelled:Ao,onBeforeAppear:Ao,onAppear:Ao,onAfterAppear:Ao,onAppearCancelled:Ao},setup(t,{slots:s}){const u=Mn(),f=TE();let m;return()=>{const v=s.default&&cv(s.default(),!0);if(!v||!v.length)return;let w=v[0];if(v.length>1){for(const ne of v)if(ne.type!==Lo){w=ne;break}}const o=Un(t),{mode:S}=o;if(f.isLeaving)return L_(w);const k=Pb(w);if(!k)return L_(w);const I=Pd(k,o,f,u);Tu(k,I);const D=u.subTree,B=D&&Pb(D);let V=!1;const{getTransitionKey:$}=k.type;if($){const ne=$();m===void 0?m=ne:ne!==m&&(m=ne,V=!0)}if(B&&B.type!==Lo&&(!jl(k,B)||V)){const ne=Pd(B,o,f,u);if(Tu(B,ne),S==="out-in")return f.isLeaving=!0,ne.afterLeave=()=>{f.isLeaving=!1,u.update()},L_(w);S==="in-out"&&k.type!==Lo&&(ne.delayLeave=(oe,ye,te)=>{const Se=CE(f,B);Se[String(B.key)]=B,oe._leaveCb=()=>{ye(),oe._leaveCb=void 0,delete I.delayedLeave},I.delayedLeave=te})}return w}}},SE=iI;function CE(t,s){const{leavingVNodes:u}=t;let f=u.get(s.type);return f||(f=Object.create(null),u.set(s.type,f)),f}function Pd(t,s,u,f){const{appear:m,mode:v,persisted:w=!1,onBeforeEnter:o,onEnter:S,onAfterEnter:k,onEnterCancelled:I,onBeforeLeave:D,onLeave:B,onAfterLeave:V,onLeaveCancelled:$,onBeforeAppear:ne,onAppear:oe,onAfterAppear:ye,onAppearCancelled:te}=s,Se=String(t.key),Ae=CE(u,t),ce=(Me,Ie)=>{Me&&zo(Me,f,9,Ie)},fe=(Me,Ie)=>{const ke=Ie[1];ce(Me,Ie),Sn(Me)?Me.every(Be=>Be.length<=1)&&ke():Me.length<=1&&ke()},Ee={mode:v,persisted:w,beforeEnter(Me){let Ie=o;if(!u.isMounted)if(m)Ie=ne||o;else return;Me._leaveCb&&Me._leaveCb(!0);const ke=Ae[Se];ke&&jl(t,ke)&&ke.el._leaveCb&&ke.el._leaveCb(),ce(Ie,[Me])},enter(Me){let Ie=S,ke=k,Be=I;if(!u.isMounted)if(m)Ie=oe||S,ke=ye||k,Be=te||I;else return;let Re=!1;const Ze=Me._enterCb=Ye=>{Re||(Re=!0,Ye?ce(Be,[Me]):ce(ke,[Me]),Ee.delayedLeave&&Ee.delayedLeave(),Me._enterCb=void 0)};Ie?fe(Ie,[Me,Ze]):Ze()},leave(Me,Ie){const ke=String(t.key);if(Me._enterCb&&Me._enterCb(!0),u.isUnmounting)return Ie();ce(D,[Me]);let Be=!1;const Re=Me._leaveCb=Ze=>{Be||(Be=!0,Ie(),Ze?ce($,[Me]):ce(V,[Me]),Me._leaveCb=void 0,Ae[ke]===t&&delete Ae[ke])};Ae[ke]=t,B?fe(B,[Me,Re]):Re()},clone(Me){return Pd(Me,s,u,f)}};return Ee}function L_(t){if(Pm(t))return t=Ks(t),t.children=null,t}function Pb(t){return Pm(t)?t.children?t.children[0]:void 0:t}function Tu(t,s){t.shapeFlag&6&&t.component?Tu(t.component.subTree,s):t.shapeFlag&128?(t.ssContent.transition=s.clone(t.ssContent),t.ssFallback.transition=s.clone(t.ssFallback)):t.transition=s}function cv(t,s=!1,u){let f=[],m=0;for(let v=0;v<t.length;v++){let w=t[v];const o=u==null?w.key:String(u)+String(w.key!=null?w.key:v);w.type===Ki?(w.patchFlag&128&&m++,f=f.concat(cv(w.children,s,o))):(s||w.type!==Lo)&&f.push(o!=null?Ks(w,{key:o}):w)}if(m>1)for(let v=0;v<f.length;v++)f[v].patchFlag=-2;return f}function uv(t){return Nn(t)?{setup:t,name:t.name}:t}const _u=t=>!!t.type.__asyncLoader,Pm=t=>t.type.__isKeepAlive,rI={name:"KeepAlive",__isKeepAlive:!0,props:{include:[String,RegExp,Array],exclude:[String,RegExp,Array],max:[String,Number]},setup(t,{slots:s}){const u=Mn(),f=u.ctx;if(!f.renderer)return()=>{const te=s.default&&s.default();return te&&te.length===1?te[0]:te};const m=new Map,v=new Set;let w=null;const o=u.suspense,{renderer:{p:S,m:k,um:I,o:{createElement:D}}}=f,B=D("div");f.activate=(te,Se,Ae,ce,fe)=>{const Ee=te.component;k(te,Se,Ae,0,o),S(Ee.vnode,te,Se,Ae,Ee,o,ce,te.slotScopeIds,fe),Cr(()=>{Ee.isDeactivated=!1,Ee.a&&vd(Ee.a);const Me=te.props&&te.props.onVnodeMounted;Me&&Io(Me,Ee.parent,te)},o)},f.deactivate=te=>{const Se=te.component;k(te,B,null,1,o),Cr(()=>{Se.da&&vd(Se.da);const Ae=te.props&&te.props.onVnodeUnmounted;Ae&&Io(Ae,Se.parent,te),Se.isDeactivated=!0},o)};function V(te){R_(te),I(te,u,o,!0)}function $(te){m.forEach((Se,Ae)=>{const ce=wy(Se.type);ce&&(!te||!te(ce))&&ne(Ae)})}function ne(te){const Se=m.get(te);!w||Se.type!==w.type?V(Se):w&&R_(w),m.delete(te),v.delete(te)}Wt(()=>[t.include,t.exclude],([te,Se])=>{te&&$(Ae=>_d(te,Ae)),Se&&$(Ae=>!_d(Se,Ae))},{flush:"post",deep:!0});let oe=null;const ye=()=>{oe!=null&&m.set(oe,D_(u.subTree))};return Ui(ye),Om(ye),Ii(()=>{m.forEach(te=>{const{subTree:Se,suspense:Ae}=u,ce=D_(Se);if(te.type===ce.type){R_(ce);const fe=ce.component.da;fe&&Cr(fe,Ae);return}V(te)})}),()=>{if(oe=null,!s.default)return null;const te=s.default(),Se=te[0];if(te.length>1)return w=null,te;if(!Rd(Se)||!(Se.shapeFlag&4)&&!(Se.shapeFlag&128))return w=null,Se;let Ae=D_(Se);const ce=Ae.type,fe=wy(_u(Ae)?Ae.type.__asyncResolved||{}:ce),{include:Ee,exclude:Me,max:Ie}=t;if(Ee&&(!fe||!_d(Ee,fe))||Me&&fe&&_d(Me,fe))return w=Ae,Se;const ke=Ae.key==null?ce:Ae.key,Be=m.get(ke);return Ae.el&&(Ae=Ks(Ae),Se.shapeFlag&128&&(Se.ssContent=Ae)),oe=ke,Be?(Ae.el=Be.el,Ae.component=Be.component,Ae.transition&&Tu(Ae,Ae.transition),Ae.shapeFlag|=512,v.delete(ke),v.add(ke)):(v.add(ke),Ie&&v.size>parseInt(Ie,10)&&ne(v.values().next().value)),Ae.shapeFlag|=256,w=Ae,bE(Se.type)?Se:Ae}}},oI=rI;function _d(t,s){return Sn(t)?t.some(u=>_d(u,s)):er(t)?t.split(",").includes(s):t.test?t.test(s):!1}function zm(t,s){AE(t,"a",s)}function Bu(t,s){AE(t,"da",s)}function AE(t,s,u=_r){const f=t.__wdc||(t.__wdc=()=>{let m=u;for(;m;){if(m.isDeactivated)return;m=m.parent}return t()});if(Lm(s,f,u),u){let m=u.parent;for(;m&&m.parent;)Pm(m.parent.vnode)&&sI(f,s,u,m),m=m.parent}}function sI(t,s,u,f){const m=Lm(s,t,f,!0);ea(()=>{Yy(f[s],m)},u)}function R_(t){let s=t.shapeFlag;s&256&&(s-=256),s&512&&(s-=512),t.shapeFlag=s}function D_(t){return t.shapeFlag&128?t.ssContent:t}function Lm(t,s,u=_r,f=!1){if(u){const m=u[t]||(u[t]=[]),v=s.__weh||(s.__weh=(...w)=>{if(u.isUnmounted)return;Du(),Au(u);const o=zo(s,u,t,w);return Kl(),Ou(),o});return f?m.unshift(v):m.push(v),v}}const Js=t=>(s,u=_r)=>(!Dd||t==="sp")&&Lm(t,(...f)=>s(...f),u),Rm=Js("bm"),Ui=Js("m"),Dm=Js("bu"),Om=Js("u"),Ii=Js("bum"),ea=Js("um"),aI=Js("sp"),lI=Js("rtg"),cI=Js("rtc");function uI(t,s=_r){Lm("ec",t,s)}function Xl(t,s){const u=Nr;if(u===null)return t;const f=Nm(u)||u.proxy,m=t.dirs||(t.dirs=[]);for(let v=0;v<s.length;v++){let[w,o,S,k=Ai]=s[v];Nn(w)&&(w={mounted:w,updated:w}),w.deep&&Gl(o),m.push({dir:w,instance:f,value:o,oldValue:void 0,arg:S,modifiers:k})}return t}function Dl(t,s,u,f){const m=t.dirs,v=s&&s.dirs;for(let w=0;w<m.length;w++){const o=m[w];v&&(o.oldValue=v[w].value);let S=o.dir[f];S&&(Du(),zo(S,u,8,[t.el,o,t,s]),Ou())}}const ME="components";function hI(t,s){return fI(ME,t,!0,s)||t}const dI=Symbol();function fI(t,s,u=!0,f=!1){const m=Nr||_r;if(m){const v=m.type;if(t===ME){const o=wy(v,!1);if(o&&(o===s||o===bs(s)||o===Am(bs(s))))return v}const w=zb(m[t]||v[t],s)||zb(m.appContext[t],s);return!w&&f?v:w}}function zb(t,s){return t&&(t[s]||t[bs(s)]||t[Am(bs(s))])}function Su(t,s,u,f){let m;const v=u&&u[f];if(Sn(t)||er(t)){m=new Array(t.length);for(let w=0,o=t.length;w<o;w++)m[w]=s(t[w],w,void 0,v&&v[w])}else if(typeof t=="number"){m=new Array(t);for(let w=0;w<t;w++)m[w]=s(w+1,w,void 0,v&&v[w])}else if(Li(t))if(t[Symbol.iterator])m=Array.from(t,(w,o)=>s(w,o,void 0,v&&v[o]));else{const w=Object.keys(t);m=new Array(w.length);for(let o=0,S=w.length;o<S;o++){const k=w[o];m[o]=s(t[k],k,o,v&&v[o])}}else m=[];return u&&(u[f]=m),m}function zd(t,s,u={},f,m){if(Nr.isCE||Nr.parent&&_u(Nr.parent)&&Nr.parent.isCE)return Nt("slot",s==="default"?null:{name:s},f&&f());let v=t[s];v&&v._c&&(v._d=!1),Yn();const w=v&&IE(v(u)),o=Qi(Ki,{key:u.key||w&&w.key||`_${s}`},w||(f?f():[]),w&&t._===1?64:-2);return!m&&o.scopeId&&(o.slotScopeIds=[o.scopeId+"-s"]),v&&v._c&&(v._d=!0),o}function IE(t){return t.some(s=>Rd(s)?!(s.type===Lo||s.type===Ki&&!IE(s.children)):!0)?t:null}const gy=t=>t?NE(t)?Nm(t)||t.proxy:gy(t.parent):null,om=vr(Object.create(null),{$:t=>t,$el:t=>t.vnode.el,$data:t=>t.data,$props:t=>t.props,$attrs:t=>t.attrs,$slots:t=>t.slots,$refs:t=>t.refs,$parent:t=>gy(t.parent),$root:t=>gy(t.root),$emit:t=>t.emit,$options:t=>hv(t),$forceUpdate:t=>t.f||(t.f=()=>lv(t.update)),$nextTick:t=>t.n||(t.n=ui.bind(t.proxy)),$watch:t=>nI.bind(t)}),pI={get({_:t},s){const{ctx:u,setupState:f,data:m,props:v,accessCache:w,type:o,appContext:S}=t;let k;if(s[0]!=="$"){const V=w[s];if(V!==void 0)switch(V){case 1:return f[s];case 2:return m[s];case 4:return u[s];case 3:return v[s]}else{if(f!==Ai&&Jn(f,s))return w[s]=1,f[s];if(m!==Ai&&Jn(m,s))return w[s]=2,m[s];if((k=t.propsOptions[0])&&Jn(k,s))return w[s]=3,v[s];if(u!==Ai&&Jn(u,s))return w[s]=4,u[s];_y&&(w[s]=0)}}const I=om[s];let D,B;if(I)return s==="$attrs"&&ho(t,"get",s),I(t);if((D=o.__cssModules)&&(D=D[s]))return D;if(u!==Ai&&Jn(u,s))return w[s]=4,u[s];if(B=S.config.globalProperties,Jn(B,s))return B[s]},set({_:t},s,u){const{data:f,setupState:m,ctx:v}=t;return m!==Ai&&Jn(m,s)?(m[s]=u,!0):f!==Ai&&Jn(f,s)?(f[s]=u,!0):Jn(t.props,s)||s[0]==="$"&&s.slice(1)in t?!1:(v[s]=u,!0)},has({_:{data:t,setupState:s,accessCache:u,ctx:f,appContext:m,propsOptions:v}},w){let o;return!!u[w]||t!==Ai&&Jn(t,w)||s!==Ai&&Jn(s,w)||(o=v[0])&&Jn(o,w)||Jn(f,w)||Jn(om,w)||Jn(m.config.globalProperties,w)},defineProperty(t,s,u){return u.get!=null?t._.accessCache[s]=0:Jn(u,"value")&&this.set(t,s,u.value,null),Reflect.defineProperty(t,s,u)}};let _y=!0;function mI(t){const s=hv(t),u=t.proxy,f=t.ctx;_y=!1,s.beforeCreate&&Lb(s.beforeCreate,t,"bc");const{data:m,computed:v,methods:w,watch:o,provide:S,inject:k,created:I,beforeMount:D,mounted:B,beforeUpdate:V,updated:$,activated:ne,deactivated:oe,beforeDestroy:ye,beforeUnmount:te,destroyed:Se,unmounted:Ae,render:ce,renderTracked:fe,renderTriggered:Ee,errorCaptured:Me,serverPrefetch:Ie,expose:ke,inheritAttrs:Be,components:Re,directives:Ze,filters:Ye}=s;if(k&&gI(k,f,null,t.appContext.config.unwrapInjectedRef),w)for(const Ge in w){const At=w[Ge];Nn(At)&&(f[Ge]=At.bind(u))}if(m){const Ge=m.call(u,u);Li(Ge)&&(t.data=ko(Ge))}if(_y=!0,v)for(const Ge in v){const At=v[Ge],tn=Nn(At)?At.bind(u,u):Nn(At.get)?At.get.bind(u,u):Yo,Ve=!Nn(At)&&Nn(At.set)?At.set.bind(u):Yo,mt=se({get:tn,set:Ve});Object.defineProperty(f,Ge,{enumerable:!0,configurable:!0,get:()=>mt.value,set:Bt=>mt.value=Bt})}if(o)for(const Ge in o)kE(o[Ge],f,u,Ge);if(S){const Ge=Nn(S)?S.call(u):S;Reflect.ownKeys(Ge).forEach(At=>{Wl(At,Ge[At])})}I&&Lb(I,t,"c");function Xt(Ge,At){Sn(At)?At.forEach(tn=>Ge(tn.bind(u))):At&&Ge(At.bind(u))}if(Xt(Rm,D),Xt(Ui,B),Xt(Dm,V),Xt(Om,$),Xt(zm,ne),Xt(Bu,oe),Xt(uI,Me),Xt(cI,fe),Xt(lI,Ee),Xt(Ii,te),Xt(ea,Ae),Xt(aI,Ie),Sn(ke))if(ke.length){const Ge=t.exposed||(t.exposed={});ke.forEach(At=>{Object.defineProperty(Ge,At,{get:()=>u[At],set:tn=>u[At]=tn})})}else t.exposed||(t.exposed={});ce&&t.render===Yo&&(t.render=ce),Be!=null&&(t.inheritAttrs=Be),Re&&(t.components=Re),Ze&&(t.directives=Ze)}function gI(t,s,u=Yo,f=!1){Sn(t)&&(t=yy(t));for(const m in t){const v=t[m];let w;Li(v)?"default"in v?w=Vr(v.from||m,v.default,!0):w=Vr(v.from||m):w=Vr(v),Vi(w)&&f?Object.defineProperty(s,m,{enumerable:!0,configurable:!0,get:()=>w.value,set:o=>w.value=o}):s[m]=w}}function Lb(t,s,u){zo(Sn(t)?t.map(f=>f.bind(s.proxy)):t.bind(s.proxy),s,u)}function kE(t,s,u,f){const m=f.includes(".")?EE(u,f):()=>u[f];if(er(t)){const v=s[t];Nn(v)&&Wt(m,v)}else if(Nn(t))Wt(m,t.bind(u));else if(Li(t))if(Sn(t))t.forEach(v=>kE(v,s,u,f));else{const v=Nn(t.handler)?t.handler.bind(u):s[t.handler];Nn(v)&&Wt(m,v,t)}}function hv(t){const s=t.type,{mixins:u,extends:f}=s,{mixins:m,optionsCache:v,config:{optionMergeStrategies:w}}=t.appContext,o=v.get(s);let S;return o?S=o:!m.length&&!u&&!f?S=s:(S={},m.length&&m.forEach(k=>sm(S,k,w,!0)),sm(S,s,w)),Li(s)&&v.set(s,S),S}function sm(t,s,u,f=!1){const{mixins:m,extends:v}=s;v&&sm(t,v,u,!0),m&&m.forEach(w=>sm(t,w,u,!0));for(const w in s)if(!(f&&w==="expose")){const o=_I[w]||u&&u[w];t[w]=o?o(t[w],s[w]):s[w]}return t}const _I={data:Rb,props:Nl,emits:Nl,methods:Nl,computed:Nl,beforeCreate:Gr,created:Gr,beforeMount:Gr,mounted:Gr,beforeUpdate:Gr,updated:Gr,beforeDestroy:Gr,beforeUnmount:Gr,destroyed:Gr,unmounted:Gr,activated:Gr,deactivated:Gr,errorCaptured:Gr,serverPrefetch:Gr,components:Nl,directives:Nl,watch:vI,provide:Rb,inject:yI};function Rb(t,s){return s?t?function(){return vr(Nn(t)?t.call(this,this):t,Nn(s)?s.call(this,this):s)}:s:t}function yI(t,s){return Nl(yy(t),yy(s))}function yy(t){if(Sn(t)){const s={};for(let u=0;u<t.length;u++)s[t[u]]=t[u];return s}return t}function Gr(t,s){return t?[...new Set([].concat(t,s))]:s}function Nl(t,s){return t?vr(vr(Object.create(null),t),s):s}function vI(t,s){if(!t)return s;if(!s)return t;const u=vr(Object.create(null),t);for(const f in s)u[f]=Gr(t[f],s[f]);return u}function xI(t,s,u,f=!1){const m={},v={};nm(v,Bm,1),t.propsDefaults=Object.create(null),PE(t,s,m,v);for(const w in t.propsOptions[0])w in m||(m[w]=void 0);u?t.props=f?m:OM(m):t.type.props?t.props=m:t.props=v,t.attrs=v}function bI(t,s,u,f){const{props:m,attrs:v,vnode:{patchFlag:w}}=t,o=Un(m),[S]=t.propsOptions;let k=!1;if((f||w>0)&&!(w&16)){if(w&8){const I=t.vnode.dynamicProps;for(let D=0;D<I.length;D++){let B=I[D];if(km(t.emitsOptions,B))continue;const V=s[B];if(S)if(Jn(v,B))V!==v[B]&&(v[B]=V,k=!0);else{const $=bs(B);m[$]=vy(S,o,$,V,t,!1)}else V!==v[B]&&(v[B]=V,k=!0)}}}else{PE(t,s,m,v)&&(k=!0);let I;for(const D in o)(!s||!Jn(s,D)&&((I=Ru(D))===D||!Jn(s,I)))&&(S?u&&(u[D]!==void 0||u[I]!==void 0)&&(m[D]=vy(S,o,D,void 0,t,!0)):delete m[D]);if(v!==o)for(const D in v)(!s||!Jn(s,D)&&!0)&&(delete v[D],k=!0)}k&&Ws(t,"set","$attrs")}function PE(t,s,u,f){const[m,v]=t.propsOptions;let w=!1,o;if(s)for(let S in s){if(Up(S))continue;const k=s[S];let I;m&&Jn(m,I=bs(S))?!v||!v.includes(I)?u[I]=k:(o||(o={}))[I]=k:km(t.emitsOptions,S)||(!(S in f)||k!==f[S])&&(f[S]=k,w=!0)}if(v){const S=Un(u),k=o||Ai;for(let I=0;I<v.length;I++){const D=v[I];u[D]=vy(m,S,D,k[D],t,!Jn(k,D))}}return w}function vy(t,s,u,f,m,v){const w=t[u];if(w!=null){const o=Jn(w,"default");if(o&&f===void 0){const S=w.default;if(w.type!==Function&&Nn(S)){const{propsDefaults:k}=m;u in k?f=k[u]:(Au(m),f=k[u]=S.call(null,s),Kl())}else f=S}w[0]&&(v&&!o?f=!1:w[1]&&(f===""||f===Ru(u))&&(f=!0))}return f}function zE(t,s,u=!1){const f=s.propsCache,m=f.get(t);if(m)return m;const v=t.props,w={},o=[];let S=!1;if(!Nn(t)){const I=D=>{S=!0;const[B,V]=zE(D,s,!0);vr(w,B),V&&o.push(...V)};!u&&s.mixins.length&&s.mixins.forEach(I),t.extends&&I(t.extends),t.mixins&&t.mixins.forEach(I)}if(!v&&!S)return Li(t)&&f.set(t,pu),pu;if(Sn(v))for(let I=0;I<v.length;I++){const D=bs(v[I]);Db(D)&&(w[D]=Ai)}else if(v)for(const I in v){const D=bs(I);if(Db(D)){const B=v[I],V=w[D]=Sn(B)||Nn(B)?{type:B}:B;if(V){const $=Fb(Boolean,V.type),ne=Fb(String,V.type);V[0]=$>-1,V[1]=ne<0||$<ne,($>-1||Jn(V,"default"))&&o.push(D)}}}const k=[w,o];return Li(t)&&f.set(t,k),k}function Db(t){return t[0]!=="$"}function Ob(t){const s=t&&t.toString().match(/^\s*function (\w+)/);return s?s[1]:t===null?"null":""}function Bb(t,s){return Ob(t)===Ob(s)}function Fb(t,s){return Sn(s)?s.findIndex(u=>Bb(u,t)):Nn(s)&&Bb(s,t)?0:-1}const LE=t=>t[0]==="_"||t==="$stable",dv=t=>Sn(t)?t.map(gs):[gs(t)],wI=(t,s,u)=>{if(s._n)return s;const f=vn((...m)=>dv(s(...m)),u);return f._c=!1,f},RE=(t,s,u)=>{const f=t._ctx;for(const m in t){if(LE(m))continue;const v=t[m];if(Nn(v))s[m]=wI(m,v,f);else if(v!=null){const w=dv(v);s[m]=()=>w}}},DE=(t,s)=>{const u=dv(s);t.slots.default=()=>u},EI=(t,s)=>{if(t.vnode.shapeFlag&32){const u=s._;u?(t.slots=Un(s),nm(s,"_",u)):RE(s,t.slots={})}else t.slots={},s&&DE(t,s);nm(t.slots,Bm,1)},TI=(t,s,u)=>{const{vnode:f,slots:m}=t;let v=!0,w=Ai;if(f.shapeFlag&32){const o=s._;o?u&&o===1?v=!1:(vr(m,s),!u&&o===1&&delete m._):(v=!s.$stable,RE(s,m)),w=s}else s&&(DE(t,s),w={default:1});if(v)for(const o in m)!LE(o)&&!(o in w)&&delete m[o]};function OE(){return{app:null,config:{isNativeTag:iM,performance:!1,globalProperties:{},optionMergeStrategies:{},errorHandler:void 0,warnHandler:void 0,compilerOptions:{}},mixins:[],components:{},directives:{},provides:Object.create(null),optionsCache:new WeakMap,propsCache:new WeakMap,emitsCache:new WeakMap}}let SI=0;function CI(t,s){return function(f,m=null){Nn(f)||(f=Object.assign({},f)),m!=null&&!Li(m)&&(m=null);const v=OE(),w=new Set;let o=!1;const S=v.app={_uid:SI++,_component:f,_props:m,_container:null,_context:v,_instance:null,version:ZI,get config(){return v.config},set config(k){},use(k,...I){return w.has(k)||(k&&Nn(k.install)?(w.add(k),k.install(S,...I)):Nn(k)&&(w.add(k),k(S,...I))),S},mixin(k){return v.mixins.includes(k)||v.mixins.push(k),S},component(k,I){return I?(v.components[k]=I,S):v.components[k]},directive(k,I){return I?(v.directives[k]=I,S):v.directives[k]},mount(k,I,D){if(!o){const B=Nt(f,m);return B.appContext=v,I&&s?s(B,k):t(B,k,D),o=!0,S._container=k,k.__vue_app__=S,Nm(B.component)||B.component.proxy}},unmount(){o&&(t(null,S._container),delete S._container.__vue_app__)},provide(k,I){return v.provides[k]=I,S}};return S}}function xy(t,s,u,f,m=!1){if(Sn(t)){t.forEach((B,V)=>xy(B,s&&(Sn(s)?s[V]:s),u,f,m));return}if(_u(f)&&!m)return;const v=f.shapeFlag&4?Nm(f.component)||f.component.proxy:f.el,w=m?null:v,{i:o,r:S}=t,k=s&&s.r,I=o.refs===Ai?o.refs={}:o.refs,D=o.setupState;if(k!=null&&k!==S&&(er(k)?(I[k]=null,Jn(D,k)&&(D[k]=null)):Vi(k)&&(k.value=null)),Nn(S))Ua(S,o,12,[w,I]);else{const B=er(S),V=Vi(S);if(B||V){const $=()=>{if(t.f){const ne=B?Jn(D,S)?D[S]:I[S]:S.value;m?Sn(ne)&&Yy(ne,v):Sn(ne)?ne.includes(v)||ne.push(v):B?(I[S]=[v],Jn(D,S)&&(D[S]=I[S])):(S.value=[v],t.k&&(I[t.k]=S.value))}else B?(I[S]=w,Jn(D,S)&&(D[S]=w)):V&&(S.value=w,t.k&&(I[t.k]=w))};w?($.id=-1,Cr($,u)):$()}}}const Cr=tI;function AI(t){return MI(t)}function MI(t,s){const u=cM();u.__VUE__=!0;const{insert:f,remove:m,patchProp:v,createElement:w,createText:o,createComment:S,setText:k,setElementText:I,parentNode:D,nextSibling:B,setScopeId:V=Yo,insertStaticContent:$}=t,ne=(re,xe,Fe,nt=null,yt=null,zt=null,Vt=!1,kt=null,bt=!!xe.dynamicChildren)=>{if(re===xe)return;re&&!jl(re,xe)&&(nt=ot(re),Bt(re,yt,zt,!0),re=null),xe.patchFlag===-2&&(bt=!1,xe.dynamicChildren=null);const{type:Mt,ref:Ht,shapeFlag:et}=xe;switch(Mt){case pv:oe(re,xe,Fe,nt);break;case Lo:ye(re,xe,Fe,nt);break;case O_:re==null&&te(xe,Fe,nt,Vt);break;case Ki:Re(re,xe,Fe,nt,yt,zt,Vt,kt,bt);break;default:et&1?ce(re,xe,Fe,nt,yt,zt,Vt,kt,bt):et&6?Ze(re,xe,Fe,nt,yt,zt,Vt,kt,bt):(et&64||et&128)&&Mt.process(re,xe,Fe,nt,yt,zt,Vt,kt,bt,ft)}Ht!=null&&yt&&xy(Ht,re&&re.ref,zt,xe||re,!xe)},oe=(re,xe,Fe,nt)=>{if(re==null)f(xe.el=o(xe.children),Fe,nt);else{const yt=xe.el=re.el;xe.children!==re.children&&k(yt,xe.children)}},ye=(re,xe,Fe,nt)=>{re==null?f(xe.el=S(xe.children||""),Fe,nt):xe.el=re.el},te=(re,xe,Fe,nt)=>{[re.el,re.anchor]=$(re.children,xe,Fe,nt,re.el,re.anchor)},Se=({el:re,anchor:xe},Fe,nt)=>{let yt;for(;re&&re!==xe;)yt=B(re),f(re,Fe,nt),re=yt;f(xe,Fe,nt)},Ae=({el:re,anchor:xe})=>{let Fe;for(;re&&re!==xe;)Fe=B(re),m(re),re=Fe;m(xe)},ce=(re,xe,Fe,nt,yt,zt,Vt,kt,bt)=>{Vt=Vt||xe.type==="svg",re==null?fe(xe,Fe,nt,yt,zt,Vt,kt,bt):Ie(re,xe,yt,zt,Vt,kt,bt)},fe=(re,xe,Fe,nt,yt,zt,Vt,kt)=>{let bt,Mt;const{type:Ht,props:et,shapeFlag:Rt,transition:nn,dirs:bn}=re;if(bt=re.el=w(re.type,zt,et&&et.is,et),Rt&8?I(bt,re.children):Rt&16&&Me(re.children,bt,null,nt,yt,zt&&Ht!=="foreignObject",Vt,kt),bn&&Dl(re,null,nt,"created"),et){for(const Cn in et)Cn!=="value"&&!Up(Cn)&&v(bt,Cn,null,et[Cn],zt,re.children,nt,yt,gt);"value"in et&&v(bt,"value",null,et.value),(Mt=et.onVnodeBeforeMount)&&Io(Mt,nt,re)}Ee(bt,re,re.scopeId,Vt,nt),bn&&Dl(re,null,nt,"beforeMount");const zn=(!yt||yt&&!yt.pendingBranch)&&nn&&!nn.persisted;zn&&nn.beforeEnter(bt),f(bt,xe,Fe),((Mt=et&&et.onVnodeMounted)||zn||bn)&&Cr(()=>{Mt&&Io(Mt,nt,re),zn&&nn.enter(bt),bn&&Dl(re,null,nt,"mounted")},yt)},Ee=(re,xe,Fe,nt,yt)=>{if(Fe&&V(re,Fe),nt)for(let zt=0;zt<nt.length;zt++)V(re,nt[zt]);if(yt){let zt=yt.subTree;if(xe===zt){const Vt=yt.vnode;Ee(re,Vt,Vt.scopeId,Vt.slotScopeIds,yt.parent)}}},Me=(re,xe,Fe,nt,yt,zt,Vt,kt,bt=0)=>{for(let Mt=bt;Mt<re.length;Mt++){const Ht=re[Mt]=kt?Ra(re[Mt]):gs(re[Mt]);ne(null,Ht,xe,Fe,nt,yt,zt,Vt,kt)}},Ie=(re,xe,Fe,nt,yt,zt,Vt)=>{const kt=xe.el=re.el;let{patchFlag:bt,dynamicChildren:Mt,dirs:Ht}=xe;bt|=re.patchFlag&16;const et=re.props||Ai,Rt=xe.props||Ai;let nn;Fe&&Ol(Fe,!1),(nn=Rt.onVnodeBeforeUpdate)&&Io(nn,Fe,xe,re),Ht&&Dl(xe,re,Fe,"beforeUpdate"),Fe&&Ol(Fe,!0);const bn=yt&&xe.type!=="foreignObject";if(Mt?ke(re.dynamicChildren,Mt,kt,Fe,nt,bn,zt):Vt||At(re,xe,kt,null,Fe,nt,bn,zt,!1),bt>0){if(bt&16)Be(kt,xe,et,Rt,Fe,nt,yt);else if(bt&2&&et.class!==Rt.class&&v(kt,"class",null,Rt.class,yt),bt&4&&v(kt,"style",et.style,Rt.style,yt),bt&8){const zn=xe.dynamicProps;for(let Cn=0;Cn<zn.length;Cn++){const jn=zn[Cn],Wn=et[jn],Bi=Rt[jn];(Bi!==Wn||jn==="value")&&v(kt,jn,Wn,Bi,yt,re.children,Fe,nt,gt)}}bt&1&&re.children!==xe.children&&I(kt,xe.children)}else!Vt&&Mt==null&&Be(kt,xe,et,Rt,Fe,nt,yt);((nn=Rt.onVnodeUpdated)||Ht)&&Cr(()=>{nn&&Io(nn,Fe,xe,re),Ht&&Dl(xe,re,Fe,"updated")},nt)},ke=(re,xe,Fe,nt,yt,zt,Vt)=>{for(let kt=0;kt<xe.length;kt++){const bt=re[kt],Mt=xe[kt],Ht=bt.el&&(bt.type===Ki||!jl(bt,Mt)||bt.shapeFlag&70)?D(bt.el):Fe;ne(bt,Mt,Ht,null,nt,yt,zt,Vt,!0)}},Be=(re,xe,Fe,nt,yt,zt,Vt)=>{if(Fe!==nt){if(Fe!==Ai)for(const kt in Fe)!Up(kt)&&!(kt in nt)&&v(re,kt,Fe[kt],null,Vt,xe.children,yt,zt,gt);for(const kt in nt){if(Up(kt))continue;const bt=nt[kt],Mt=Fe[kt];bt!==Mt&&kt!=="value"&&v(re,kt,Mt,bt,Vt,xe.children,yt,zt,gt)}"value"in nt&&v(re,"value",Fe.value,nt.value)}},Re=(re,xe,Fe,nt,yt,zt,Vt,kt,bt)=>{const Mt=xe.el=re?re.el:o(""),Ht=xe.anchor=re?re.anchor:o("");let{patchFlag:et,dynamicChildren:Rt,slotScopeIds:nn}=xe;nn&&(kt=kt?kt.concat(nn):nn),re==null?(f(Mt,Fe,nt),f(Ht,Fe,nt),Me(xe.children,Fe,Ht,yt,zt,Vt,kt,bt)):et>0&&et&64&&Rt&&re.dynamicChildren?(ke(re.dynamicChildren,Rt,Fe,yt,zt,Vt,kt),(xe.key!=null||yt&&xe===yt.subTree)&&fv(re,xe,!0)):At(re,xe,Fe,Ht,yt,zt,Vt,kt,bt)},Ze=(re,xe,Fe,nt,yt,zt,Vt,kt,bt)=>{xe.slotScopeIds=kt,re==null?xe.shapeFlag&512?yt.ctx.activate(xe,Fe,nt,Vt,bt):Ye(xe,Fe,nt,yt,zt,Vt,bt):lt(re,xe,bt)},Ye=(re,xe,Fe,nt,yt,zt,Vt)=>{const kt=re.component=NI(re,nt,yt);if(Pm(re)&&(kt.ctx.renderer=ft),VI(kt),kt.asyncDep){if(yt&&yt.registerDep(kt,Xt),!re.el){const bt=kt.subTree=Nt(Lo);ye(null,bt,xe,Fe)}return}Xt(kt,re,xe,Fe,yt,zt,Vt)},lt=(re,xe,Fe)=>{const nt=xe.component=re.component;if(JM(re,xe,Fe))if(nt.asyncDep&&!nt.asyncResolved){Ge(nt,xe,Fe);return}else nt.next=xe,HM(nt.update),nt.update();else xe.el=re.el,nt.vnode=xe},Xt=(re,xe,Fe,nt,yt,zt,Vt)=>{const kt=()=>{if(re.isMounted){let{next:Ht,bu:et,u:Rt,parent:nn,vnode:bn}=re,zn=Ht,Cn;Ol(re,!1),Ht?(Ht.el=bn.el,Ge(re,Ht,Vt)):Ht=bn,et&&vd(et),(Cn=Ht.props&&Ht.props.onVnodeBeforeUpdate)&&Io(Cn,nn,Ht,bn),Ol(re,!0);const jn=z_(re),Wn=re.subTree;re.subTree=jn,ne(Wn,jn,D(Wn.el),ot(Wn),re,yt,zt),Ht.el=jn.el,zn===null&&eI(re,jn.el),Rt&&Cr(Rt,yt),(Cn=Ht.props&&Ht.props.onVnodeUpdated)&&Cr(()=>Io(Cn,nn,Ht,bn),yt)}else{let Ht;const{el:et,props:Rt}=xe,{bm:nn,m:bn,parent:zn}=re,Cn=_u(xe);if(Ol(re,!1),nn&&vd(nn),!Cn&&(Ht=Rt&&Rt.onVnodeBeforeMount)&&Io(Ht,zn,xe),Ol(re,!0),et&&un){const jn=()=>{re.subTree=z_(re),un(et,re.subTree,re,yt,null)};Cn?xe.type.__asyncLoader().then(()=>!re.isUnmounted&&jn()):jn()}else{const jn=re.subTree=z_(re);ne(null,jn,Fe,nt,re,yt,zt),xe.el=jn.el}if(bn&&Cr(bn,yt),!Cn&&(Ht=Rt&&Rt.onVnodeMounted)){const jn=xe;Cr(()=>Io(Ht,zn,jn),yt)}(xe.shapeFlag&256||zn&&_u(zn.vnode)&&zn.vnode.shapeFlag&256)&&re.a&&Cr(re.a,yt),re.isMounted=!0,xe=Fe=nt=null}},bt=re.effect=new tv(kt,()=>lv(Mt),re.scope),Mt=re.update=()=>bt.run();Mt.id=re.uid,Ol(re,!0),Mt()},Ge=(re,xe,Fe)=>{xe.component=re;const nt=re.vnode.props;re.vnode=xe,re.next=null,bI(re,xe.props,nt,Fe),TI(re,xe.children,Fe),Du(),Mb(),Ou()},At=(re,xe,Fe,nt,yt,zt,Vt,kt,bt=!1)=>{const Mt=re&&re.children,Ht=re?re.shapeFlag:0,et=xe.children,{patchFlag:Rt,shapeFlag:nn}=xe;if(Rt>0){if(Rt&128){Ve(Mt,et,Fe,nt,yt,zt,Vt,kt,bt);return}else if(Rt&256){tn(Mt,et,Fe,nt,yt,zt,Vt,kt,bt);return}}nn&8?(Ht&16&&gt(Mt,yt,zt),et!==Mt&&I(Fe,et)):Ht&16?nn&16?Ve(Mt,et,Fe,nt,yt,zt,Vt,kt,bt):gt(Mt,yt,zt,!0):(Ht&8&&I(Fe,""),nn&16&&Me(et,Fe,nt,yt,zt,Vt,kt,bt))},tn=(re,xe,Fe,nt,yt,zt,Vt,kt,bt)=>{re=re||pu,xe=xe||pu;const Mt=re.length,Ht=xe.length,et=Math.min(Mt,Ht);let Rt;for(Rt=0;Rt<et;Rt++){const nn=xe[Rt]=bt?Ra(xe[Rt]):gs(xe[Rt]);ne(re[Rt],nn,Fe,null,yt,zt,Vt,kt,bt)}Mt>Ht?gt(re,yt,zt,!0,!1,et):Me(xe,Fe,nt,yt,zt,Vt,kt,bt,et)},Ve=(re,xe,Fe,nt,yt,zt,Vt,kt,bt)=>{let Mt=0;const Ht=xe.length;let et=re.length-1,Rt=Ht-1;for(;Mt<=et&&Mt<=Rt;){const nn=re[Mt],bn=xe[Mt]=bt?Ra(xe[Mt]):gs(xe[Mt]);if(jl(nn,bn))ne(nn,bn,Fe,null,yt,zt,Vt,kt,bt);else break;Mt++}for(;Mt<=et&&Mt<=Rt;){const nn=re[et],bn=xe[Rt]=bt?Ra(xe[Rt]):gs(xe[Rt]);if(jl(nn,bn))ne(nn,bn,Fe,null,yt,zt,Vt,kt,bt);else break;et--,Rt--}if(Mt>et){if(Mt<=Rt){const nn=Rt+1,bn=nn<Ht?xe[nn].el:nt;for(;Mt<=Rt;)ne(null,xe[Mt]=bt?Ra(xe[Mt]):gs(xe[Mt]),Fe,bn,yt,zt,Vt,kt,bt),Mt++}}else if(Mt>Rt)for(;Mt<=et;)Bt(re[Mt],yt,zt,!0),Mt++;else{const nn=Mt,bn=Mt,zn=new Map;for(Mt=bn;Mt<=Rt;Mt++){const Ei=xe[Mt]=bt?Ra(xe[Mt]):gs(xe[Mt]);Ei.key!=null&&zn.set(Ei.key,Mt)}let Cn,jn=0;const Wn=Rt-bn+1;let Bi=!1,qi=0;const ji=new Array(Wn);for(Mt=0;Mt<Wn;Mt++)ji[Mt]=0;for(Mt=nn;Mt<=et;Mt++){const Ei=re[Mt];if(jn>=Wn){Bt(Ei,yt,zt,!0);continue}let $i;if(Ei.key!=null)$i=zn.get(Ei.key);else for(Cn=bn;Cn<=Rt;Cn++)if(ji[Cn-bn]===0&&jl(Ei,xe[Cn])){$i=Cn;break}$i===void 0?Bt(Ei,yt,zt,!0):(ji[$i-bn]=Mt+1,$i>=qi?qi=$i:Bi=!0,ne(Ei,xe[$i],Fe,null,yt,zt,Vt,kt,bt),jn++)}const tr=Bi?II(ji):pu;for(Cn=tr.length-1,Mt=Wn-1;Mt>=0;Mt--){const Ei=bn+Mt,$i=xe[Ei],hr=Ei+1<Ht?xe[Ei+1].el:nt;ji[Mt]===0?ne(null,$i,Fe,hr,yt,zt,Vt,kt,bt):Bi&&(Cn<0||Mt!==tr[Cn]?mt($i,Fe,hr,2):Cn--)}}},mt=(re,xe,Fe,nt,yt=null)=>{const{el:zt,type:Vt,transition:kt,children:bt,shapeFlag:Mt}=re;if(Mt&6){mt(re.component.subTree,xe,Fe,nt);return}if(Mt&128){re.suspense.move(xe,Fe,nt);return}if(Mt&64){Vt.move(re,xe,Fe,ft);return}if(Vt===Ki){f(zt,xe,Fe);for(let et=0;et<bt.length;et++)mt(bt[et],xe,Fe,nt);f(re.anchor,xe,Fe);return}if(Vt===O_){Se(re,xe,Fe);return}if(nt!==2&&Mt&1&&kt)if(nt===0)kt.beforeEnter(zt),f(zt,xe,Fe),Cr(()=>kt.enter(zt),yt);else{const{leave:et,delayLeave:Rt,afterLeave:nn}=kt,bn=()=>f(zt,xe,Fe),zn=()=>{et(zt,()=>{bn(),nn&&nn()})};Rt?Rt(zt,bn,zn):zn()}else f(zt,xe,Fe)},Bt=(re,xe,Fe,nt=!1,yt=!1)=>{const{type:zt,props:Vt,ref:kt,children:bt,dynamicChildren:Mt,shapeFlag:Ht,patchFlag:et,dirs:Rt}=re;if(kt!=null&&xy(kt,null,Fe,re,!0),Ht&256){xe.ctx.deactivate(re);return}const nn=Ht&1&&Rt,bn=!_u(re);let zn;if(bn&&(zn=Vt&&Vt.onVnodeBeforeUnmount)&&Io(zn,xe,re),Ht&6)rt(re.component,Fe,nt);else{if(Ht&128){re.suspense.unmount(Fe,nt);return}nn&&Dl(re,null,xe,"beforeUnmount"),Ht&64?re.type.remove(re,xe,Fe,yt,ft,nt):Mt&&(zt!==Ki||et>0&&et&64)?gt(Mt,xe,Fe,!1,!0):(zt===Ki&&et&384||!yt&&Ht&16)&&gt(bt,xe,Fe),nt&&qt(re)}(bn&&(zn=Vt&&Vt.onVnodeUnmounted)||nn)&&Cr(()=>{zn&&Io(zn,xe,re),nn&&Dl(re,null,xe,"unmounted")},Fe)},qt=re=>{const{type:xe,el:Fe,anchor:nt,transition:yt}=re;if(xe===Ki){xn(Fe,nt);return}if(xe===O_){Ae(re);return}const zt=()=>{m(Fe),yt&&!yt.persisted&&yt.afterLeave&&yt.afterLeave()};if(re.shapeFlag&1&&yt&&!yt.persisted){const{leave:Vt,delayLeave:kt}=yt,bt=()=>Vt(Fe,zt);kt?kt(re.el,zt,bt):bt()}else zt()},xn=(re,xe)=>{let Fe;for(;re!==xe;)Fe=B(re),m(re),re=Fe;m(xe)},rt=(re,xe,Fe)=>{const{bum:nt,scope:yt,update:zt,subTree:Vt,um:kt}=re;nt&&vd(nt),yt.stop(),zt&&(zt.active=!1,Bt(Vt,re,xe,Fe)),kt&&Cr(kt,xe),Cr(()=>{re.isUnmounted=!0},xe),xe&&xe.pendingBranch&&!xe.isUnmounted&&re.asyncDep&&!re.asyncResolved&&re.suspenseId===xe.pendingId&&(xe.deps--,xe.deps===0&&xe.resolve())},gt=(re,xe,Fe,nt=!1,yt=!1,zt=0)=>{for(let Vt=zt;Vt<re.length;Vt++)Bt(re[Vt],xe,Fe,nt,yt)},ot=re=>re.shapeFlag&6?ot(re.component.subTree):re.shapeFlag&128?re.suspense.next():B(re.anchor||re.el),_t=(re,xe,Fe)=>{re==null?xe._vnode&&Bt(xe._vnode,null,null,!0):ne(xe._vnode||null,re,xe,null,null,null,Fe),Mb(),_E(),xe._vnode=re},ft={p:ne,um:Bt,m:mt,r:qt,mt:Ye,mc:Me,pc:At,pbc:ke,n:ot,o:t};let sn,un;return s&&([sn,un]=s(ft)),{render:_t,hydrate:sn,createApp:CI(_t,sn)}}function Ol({effect:t,update:s},u){t.allowRecurse=s.allowRecurse=u}function fv(t,s,u=!1){const f=t.children,m=s.children;if(Sn(f)&&Sn(m))for(let v=0;v<f.length;v++){const w=f[v];let o=m[v];o.shapeFlag&1&&!o.dynamicChildren&&((o.patchFlag<=0||o.patchFlag===32)&&(o=m[v]=Ra(m[v]),o.el=w.el),u||fv(w,o))}}function II(t){const s=t.slice(),u=[0];let f,m,v,w,o;const S=t.length;for(f=0;f<S;f++){const k=t[f];if(k!==0){if(m=u[u.length-1],t[m]<k){s[f]=m,u.push(f);continue}for(v=0,w=u.length-1;v<w;)o=v+w>>1,t[u[o]]<k?v=o+1:w=o;k<t[u[v]]&&(v>0&&(s[f]=u[v-1]),u[v]=f)}}for(v=u.length,w=u[v-1];v-- >0;)u[v]=w,w=s[w];return u}const kI=t=>t.__isTeleport,xd=t=>t&&(t.disabled||t.disabled===""),Nb=t=>typeof SVGElement<"u"&&t instanceof SVGElement,by=(t,s)=>{const u=t&&t.to;return er(u)?s?s(u):null:u},PI={__isTeleport:!0,process(t,s,u,f,m,v,w,o,S,k){const{mc:I,pc:D,pbc:B,o:{insert:V,querySelector:$,createText:ne,createComment:oe}}=k,ye=xd(s.props);let{shapeFlag:te,children:Se,dynamicChildren:Ae}=s;if(t==null){const ce=s.el=ne(""),fe=s.anchor=ne("");V(ce,u,f),V(fe,u,f);const Ee=s.target=by(s.props,$),Me=s.targetAnchor=ne("");Ee&&(V(Me,Ee),w=w||Nb(Ee));const Ie=(ke,Be)=>{te&16&&I(Se,ke,Be,m,v,w,o,S)};ye?Ie(u,fe):Ee&&Ie(Ee,Me)}else{s.el=t.el;const ce=s.anchor=t.anchor,fe=s.target=t.target,Ee=s.targetAnchor=t.targetAnchor,Me=xd(t.props),Ie=Me?u:fe,ke=Me?ce:Ee;if(w=w||Nb(fe),Ae?(B(t.dynamicChildren,Ae,Ie,m,v,w,o),fv(t,s,!0)):S||D(t,s,Ie,ke,m,v,w,o,!1),ye)Me||kp(s,u,ce,k,1);else if((s.props&&s.props.to)!==(t.props&&t.props.to)){const Be=s.target=by(s.props,$);Be&&kp(s,Be,null,k,0)}else Me&&kp(s,fe,Ee,k,1)}},remove(t,s,u,f,{um:m,o:{remove:v}},w){const{shapeFlag:o,children:S,anchor:k,targetAnchor:I,target:D,props:B}=t;if(D&&v(I),(w||!xd(B))&&(v(k),o&16))for(let V=0;V<S.length;V++){const $=S[V];m($,s,u,!0,!!$.dynamicChildren)}},move:kp,hydrate:zI};function kp(t,s,u,{o:{insert:f},m},v=2){v===0&&f(t.targetAnchor,s,u);const{el:w,anchor:o,shapeFlag:S,children:k,props:I}=t,D=v===2;if(D&&f(w,s,u),(!D||xd(I))&&S&16)for(let B=0;B<k.length;B++)m(k[B],s,u,2);D&&f(o,s,u)}function zI(t,s,u,f,m,v,{o:{nextSibling:w,parentNode:o,querySelector:S}},k){const I=s.target=by(s.props,S);if(I){const D=I._lpa||I.firstChild;if(s.shapeFlag&16)if(xd(s.props))s.anchor=k(w(t),s,o(t),u,f,m,v),s.targetAnchor=D;else{s.anchor=w(t);let B=D;for(;B;)if(B=w(B),B&&B.nodeType===8&&B.data==="teleport anchor"){s.targetAnchor=B,I._lpa=s.targetAnchor&&w(s.targetAnchor);break}k(D,s,I,u,f,m,v)}}return s.anchor&&w(s.anchor)}const LI=PI,Ki=Symbol(void 0),pv=Symbol(void 0),Lo=Symbol(void 0),O_=Symbol(void 0),bd=[];let Wo=null;function Yn(t=!1){bd.push(Wo=t?null:[])}function RI(){bd.pop(),Wo=bd[bd.length-1]||null}let Ld=1;function Vb(t){Ld+=t}function BE(t){return t.dynamicChildren=Ld>0?Wo||pu:null,RI(),Ld>0&&Wo&&Wo.push(t),t}function Zr(t,s,u,f,m,v){return BE(yr(t,s,u,f,m,v,!0))}function Qi(t,s,u,f,m){return BE(Nt(t,s,u,f,m,!0))}function Rd(t){return t?t.__v_isVNode===!0:!1}function jl(t,s){return t.type===s.type&&t.key===s.key}const Bm="__vInternal",FE=({key:t})=>t!=null?t:null,qp=({ref:t,ref_key:s,ref_for:u})=>t!=null?er(t)||Vi(t)||Nn(t)?{i:Nr,r:t,k:s,f:!!u}:t:null;function yr(t,s=null,u=null,f=0,m=null,v=t===Ki?0:1,w=!1,o=!1){const S={__v_isVNode:!0,__v_skip:!0,type:t,props:s,key:s&&FE(s),ref:s&&qp(s),scopeId:xE,slotScopeIds:null,children:u,component:null,suspense:null,ssContent:null,ssFallback:null,dirs:null,transition:null,el:null,anchor:null,target:null,targetAnchor:null,staticCount:0,shapeFlag:v,patchFlag:f,dynamicProps:m,dynamicChildren:null,appContext:null};return o?(mv(S,u),v&128&&t.normalize(S)):u&&(S.shapeFlag|=er(u)?8:16),Ld>0&&!w&&Wo&&(S.patchFlag>0||v&6)&&S.patchFlag!==32&&Wo.push(S),S}const Nt=DI;function DI(t,s=null,u=null,f=0,m=null,v=!1){if((!t||t===dI)&&(t=Lo),Rd(t)){const o=Ks(t,s,!0);return u&&mv(o,u),Ld>0&&!v&&Wo&&(o.shapeFlag&6?Wo[Wo.indexOf(t)]=o:Wo.push(o)),o.patchFlag|=-2,o}if(jI(t)&&(t=t.__vccOpts),s){s=OI(s);let{class:o,style:S}=s;o&&!er(o)&&(s.class=Xy(o)),Li(S)&&(cE(S)&&!Sn(S)&&(S=vr({},S)),s.style=Wy(S))}const w=er(t)?1:bE(t)?128:kI(t)?64:Li(t)?4:Nn(t)?2:0;return yr(t,s,u,f,m,w,v,!0)}function OI(t){return t?cE(t)||Bm in t?vr({},t):t:null}function Ks(t,s,u=!1){const{props:f,ref:m,patchFlag:v,children:w}=t,o=s?Fm(f||{},s):f;return{__v_isVNode:!0,__v_skip:!0,type:t.type,props:o,key:o&&FE(o),ref:s&&s.ref?u&&m?Sn(m)?m.concat(qp(s)):[m,qp(s)]:qp(s):m,scopeId:t.scopeId,slotScopeIds:t.slotScopeIds,children:w,target:t.target,targetAnchor:t.targetAnchor,staticCount:t.staticCount,shapeFlag:t.shapeFlag,patchFlag:s&&t.type!==Ki?v===-1?16:v|16:v,dynamicProps:t.dynamicProps,dynamicChildren:t.dynamicChildren,appContext:t.appContext,dirs:t.dirs,transition:t.transition,component:t.component,suspense:t.suspense,ssContent:t.ssContent&&Ks(t.ssContent),ssFallback:t.ssFallback&&Ks(t.ssFallback),el:t.el,anchor:t.anchor}}function Cu(t=" ",s=0){return Nt(pv,null,t,s)}function xs(t="",s=!1){return s?(Yn(),Qi(Lo,null,t)):Nt(Lo,null,t)}function gs(t){return t==null||typeof t=="boolean"?Nt(Lo):Sn(t)?Nt(Ki,null,t.slice()):typeof t=="object"?Ra(t):Nt(pv,null,String(t))}function Ra(t){return t.el===null&&t.patchFlag!==-1||t.memo?t:Ks(t)}function mv(t,s){let u=0;const{shapeFlag:f}=t;if(s==null)s=null;else if(Sn(s))u=16;else if(typeof s=="object")if(f&65){const m=s.default;m&&(m._c&&(m._d=!1),mv(t,m()),m._c&&(m._d=!0));return}else{u=32;const m=s._;!m&&!(Bm in s)?s._ctx=Nr:m===3&&Nr&&(Nr.slots._===1?s._=1:(s._=2,t.patchFlag|=1024))}else Nn(s)?(s={default:s,_ctx:Nr},u=32):(s=String(s),f&64?(u=16,s=[Cu(s)]):u=8);t.children=s,t.shapeFlag|=u}function Fm(...t){const s={};for(let u=0;u<t.length;u++){const f=t[u];for(const m in f)if(m==="class")s.class!==f.class&&(s.class=Xy([s.class,f.class]));else if(m==="style")s.style=Wy([s.style,f.style]);else if(Tm(m)){const v=s[m],w=f[m];w&&v!==w&&!(Sn(v)&&v.includes(w))&&(s[m]=v?[].concat(v,w):w)}else m!==""&&(s[m]=f[m])}return s}function Io(t,s,u,f=null){zo(t,s,7,[u,f])}const BI=OE();let FI=0;function NI(t,s,u){const f=t.type,m=(s?s.appContext:t.appContext)||BI,v={uid:FI++,vnode:t,type:f,parent:s,appContext:m,root:null,next:null,subTree:null,effect:null,update:null,scope:new Kw(!0),render:null,proxy:null,exposed:null,exposeProxy:null,withProxy:null,provides:s?s.provides:Object.create(m.provides),accessCache:null,renderCache:[],components:null,directives:null,propsOptions:zE(f,m),emitsOptions:vE(f,m),emit:null,emitted:null,propsDefaults:Ai,inheritAttrs:f.inheritAttrs,ctx:Ai,data:Ai,props:Ai,attrs:Ai,slots:Ai,refs:Ai,setupState:Ai,setupContext:null,suspense:u,suspenseId:u?u.pendingId:0,asyncDep:null,asyncResolved:!1,isMounted:!1,isUnmounted:!1,isDeactivated:!1,bc:null,c:null,bm:null,m:null,bu:null,u:null,um:null,bum:null,da:null,a:null,rtg:null,rtc:null,ec:null,sp:null};return v.ctx={_:v},v.root=s?s.root:v,v.emit=KM.bind(null,v),t.ce&&t.ce(v),v}let _r=null;const Mn=()=>_r||Nr,Au=t=>{_r=t,t.scope.on()},Kl=()=>{_r&&_r.scope.off(),_r=null};function NE(t){return t.vnode.shapeFlag&4}let Dd=!1;function VI(t,s=!1){Dd=s;const{props:u,children:f}=t.vnode,m=NE(t);xI(t,u,m,s),EI(t,f);const v=m?UI(t,s):void 0;return Dd=!1,v}function UI(t,s){const u=t.type;t.accessCache=Object.create(null),t.proxy=Xs(new Proxy(t.ctx,pI));const{setup:f}=u;if(f){const m=t.setupContext=f.length>1?UE(t):null;Au(t),Du();const v=Ua(f,t,0,[t.props,m]);if(Ou(),Kl(),Zw(v)){if(v.then(Kl,Kl),s)return v.then(w=>{Ub(t,w,s)}).catch(w=>{Im(w,t,0)});t.asyncDep=v}else Ub(t,v,s)}else VE(t,s)}function Ub(t,s,u){Nn(s)?t.type.__ssrInlineRender?t.ssrRender=s:t.render=s:Li(s)&&(t.setupState=fE(s)),VE(t,u)}let qb;function VE(t,s,u){const f=t.type;if(!t.render){if(!s&&qb&&!f.render){const m=f.template||hv(t).template;if(m){const{isCustomElement:v,compilerOptions:w}=t.appContext.config,{delimiters:o,compilerOptions:S}=f,k=vr(vr({isCustomElement:v,delimiters:o},w),S);f.render=qb(m,k)}}t.render=f.render||Yo}Au(t),Du(),mI(t),Ou(),Kl()}function qI(t){return new Proxy(t.attrs,{get(s,u){return ho(t,"get","$attrs"),s[u]}})}function UE(t){const s=f=>{t.exposed=f||{}};let u;return{get attrs(){return u||(u=qI(t))},slots:t.slots,emit:t.emit,expose:s}}function Nm(t){if(t.exposed)return t.exposeProxy||(t.exposeProxy=new Proxy(fE(Xs(t.exposed)),{get(s,u){if(u in s)return s[u];if(u in om)return om[u](t)}}))}function wy(t,s=!0){return Nn(t)?t.displayName||t.name:t.name||s&&t.__name}function jI(t){return Nn(t)&&"__vccOpts"in t}const se=(t,s)=>$M(t,s,Dd);function $I(){return qE().slots}function GI(){return qE().attrs}function qE(){const t=Mn();return t.setupContext||(t.setupContext=UE(t))}function pe(t,s,u){const f=arguments.length;return f===2?Li(s)&&!Sn(s)?Rd(s)?Nt(t,null,[s]):Nt(t,s):Nt(t,null,s):(f>3?u=Array.prototype.slice.call(arguments,2):f===3&&Rd(u)&&(u=[u]),Nt(t,s,u))}const ZI="3.2.41",HI="http://www.w3.org/2000/svg",$l=typeof document<"u"?document:null,jb=$l&&$l.createElement("template"),WI={insert:(t,s,u)=>{s.insertBefore(t,u||null)},remove:t=>{const s=t.parentNode;s&&s.removeChild(t)},createElement:(t,s,u,f)=>{const m=s?$l.createElementNS(HI,t):$l.createElement(t,u?{is:u}:void 0);return t==="select"&&f&&f.multiple!=null&&m.setAttribute("multiple",f.multiple),m},createText:t=>$l.createTextNode(t),createComment:t=>$l.createComment(t),setText:(t,s)=>{t.nodeValue=s},setElementText:(t,s)=>{t.textContent=s},parentNode:t=>t.parentNode,nextSibling:t=>t.nextSibling,querySelector:t=>$l.querySelector(t),setScopeId(t,s){t.setAttribute(s,"")},insertStaticContent(t,s,u,f,m,v){const w=u?u.previousSibling:s.lastChild;if(m&&(m===v||m.nextSibling))for(;s.insertBefore(m.cloneNode(!0),u),!(m===v||!(m=m.nextSibling)););else{jb.innerHTML=f?`<svg>${t}</svg>`:t;const o=jb.content;if(f){const S=o.firstChild;for(;S.firstChild;)o.appendChild(S.firstChild);o.removeChild(S)}s.insertBefore(o,u)}return[w?w.nextSibling:s.firstChild,u?u.previousSibling:s.lastChild]}};function XI(t,s,u){const f=t._vtc;f&&(s=(s?[s,...f]:[...f]).join(" ")),s==null?t.removeAttribute("class"):u?t.setAttribute("class",s):t.className=s}function KI(t,s,u){const f=t.style,m=er(u);if(u&&!m){for(const v in u)Ey(f,v,u[v]);if(s&&!er(s))for(const v in s)u[v]==null&&Ey(f,v,"")}else{const v=f.display;m?s!==u&&(f.cssText=u):s&&t.removeAttribute("style"),"_vod"in t&&(f.display=v)}}const $b=/\s*!important$/;function Ey(t,s,u){if(Sn(u))u.forEach(f=>Ey(t,s,f));else if(u==null&&(u=""),s.startsWith("--"))t.setProperty(s,u);else{const f=YI(t,s);$b.test(u)?t.setProperty(Ru(f),u.replace($b,""),"important"):t[f]=u}}const Gb=["Webkit","Moz","ms"],B_={};function YI(t,s){const u=B_[s];if(u)return u;let f=bs(s);if(f!=="filter"&&f in t)return B_[s]=f;f=Am(f);for(let m=0;m<Gb.length;m++){const v=Gb[m]+f;if(v in t)return B_[s]=v}return s}const Zb="http://www.w3.org/1999/xlink";function QI(t,s,u,f,m){if(f&&s.startsWith("xlink:"))u==null?t.removeAttributeNS(Zb,s.slice(6,s.length)):t.setAttributeNS(Zb,s,u);else{const v=JA(s);u==null||v&&!jw(u)?t.removeAttribute(s):t.setAttribute(s,v?"":u)}}function JI(t,s,u,f,m,v,w){if(s==="innerHTML"||s==="textContent"){f&&w(f,m,v),t[s]=u==null?"":u;return}if(s==="value"&&t.tagName!=="PROGRESS"&&!t.tagName.includes("-")){t._value=u;const S=u==null?"":u;(t.value!==S||t.tagName==="OPTION")&&(t.value=S),u==null&&t.removeAttribute(s);return}let o=!1;if(u===""||u==null){const S=typeof t[s];S==="boolean"?u=jw(u):u==null&&S==="string"?(u="",o=!0):S==="number"&&(u=0,o=!0)}try{t[s]=u}catch{}o&&t.removeAttribute(s)}function ek(t,s,u,f){t.addEventListener(s,u,f)}function tk(t,s,u,f){t.removeEventListener(s,u,f)}function nk(t,s,u,f,m=null){const v=t._vei||(t._vei={}),w=v[s];if(f&&w)w.value=f;else{const[o,S]=ik(s);if(f){const k=v[s]=sk(f,m);ek(t,o,k,S)}else w&&(tk(t,o,w,S),v[s]=void 0)}}const Hb=/(?:Once|Passive|Capture)$/;function ik(t){let s;if(Hb.test(t)){s={};let f;for(;f=t.match(Hb);)t=t.slice(0,t.length-f[0].length),s[f[0].toLowerCase()]=!0}return[t[2]===":"?t.slice(3):Ru(t.slice(2)),s]}let F_=0;const rk=Promise.resolve(),ok=()=>F_||(rk.then(()=>F_=0),F_=Date.now());function sk(t,s){const u=f=>{if(!f._vts)f._vts=Date.now();else if(f._vts<=u.attached)return;zo(ak(f,u.value),s,5,[f])};return u.value=t,u.attached=ok(),u}function ak(t,s){if(Sn(s)){const u=t.stopImmediatePropagation;return t.stopImmediatePropagation=()=>{u.call(t),t._stopped=!0},s.map(f=>m=>!m._stopped&&f&&f(m))}else return s}const Wb=/^on[a-z]/,lk=(t,s,u,f,m=!1,v,w,o,S)=>{s==="class"?XI(t,f,m):s==="style"?KI(t,u,f):Tm(s)?Ky(s)||nk(t,s,u,f,w):(s[0]==="."?(s=s.slice(1),!0):s[0]==="^"?(s=s.slice(1),!1):ck(t,s,f,m))?JI(t,s,f,v,w,o,S):(s==="true-value"?t._trueValue=f:s==="false-value"&&(t._falseValue=f),QI(t,s,f,m))};function ck(t,s,u,f){return f?!!(s==="innerHTML"||s==="textContent"||s in t&&Wb.test(s)&&Nn(u)):s==="spellcheck"||s==="draggable"||s==="translate"||s==="form"||s==="list"&&t.tagName==="INPUT"||s==="type"&&t.tagName==="TEXTAREA"||Wb.test(s)&&er(u)?!1:s in t}const Ia="transition",cd="animation",Ys=(t,{slots:s})=>pe(SE,$E(t),s);Ys.displayName="Transition";const jE={name:String,type:String,css:{type:Boolean,default:!0},duration:[String,Number,Object],enterFromClass:String,enterActiveClass:String,enterToClass:String,appearFromClass:String,appearActiveClass:String,appearToClass:String,leaveFromClass:String,leaveActiveClass:String,leaveToClass:String},uk=Ys.props=vr({},SE.props,jE),Bl=(t,s=[])=>{Sn(t)?t.forEach(u=>u(...s)):t&&t(...s)},Xb=t=>t?Sn(t)?t.some(s=>s.length>1):t.length>1:!1;function $E(t){const s={};for(const Re in t)Re in jE||(s[Re]=t[Re]);if(t.css===!1)return s;const{name:u="v",type:f,duration:m,enterFromClass:v=`${u}-enter-from`,enterActiveClass:w=`${u}-enter-active`,enterToClass:o=`${u}-enter-to`,appearFromClass:S=v,appearActiveClass:k=w,appearToClass:I=o,leaveFromClass:D=`${u}-leave-from`,leaveActiveClass:B=`${u}-leave-active`,leaveToClass:V=`${u}-leave-to`}=t,$=hk(m),ne=$&&$[0],oe=$&&$[1],{onBeforeEnter:ye,onEnter:te,onEnterCancelled:Se,onLeave:Ae,onLeaveCancelled:ce,onBeforeAppear:fe=ye,onAppear:Ee=te,onAppearCancelled:Me=Se}=s,Ie=(Re,Ze,Ye)=>{La(Re,Ze?I:o),La(Re,Ze?k:w),Ye&&Ye()},ke=(Re,Ze)=>{Re._isLeaving=!1,La(Re,D),La(Re,V),La(Re,B),Ze&&Ze()},Be=Re=>(Ze,Ye)=>{const lt=Re?Ee:te,Xt=()=>Ie(Ze,Re,Ye);Bl(lt,[Ze,Xt]),Kb(()=>{La(Ze,Re?S:v),qs(Ze,Re?I:o),Xb(lt)||Yb(Ze,f,ne,Xt)})};return vr(s,{onBeforeEnter(Re){Bl(ye,[Re]),qs(Re,v),qs(Re,w)},onBeforeAppear(Re){Bl(fe,[Re]),qs(Re,S),qs(Re,k)},onEnter:Be(!1),onAppear:Be(!0),onLeave(Re,Ze){Re._isLeaving=!0;const Ye=()=>ke(Re,Ze);qs(Re,D),ZE(),qs(Re,B),Kb(()=>{!Re._isLeaving||(La(Re,D),qs(Re,V),Xb(Ae)||Yb(Re,f,oe,Ye))}),Bl(Ae,[Re,Ye])},onEnterCancelled(Re){Ie(Re,!1),Bl(Se,[Re])},onAppearCancelled(Re){Ie(Re,!0),Bl(Me,[Re])},onLeaveCancelled(Re){ke(Re),Bl(ce,[Re])}})}function hk(t){if(t==null)return null;if(Li(t))return[N_(t.enter),N_(t.leave)];{const s=N_(t);return[s,s]}}function N_(t){return Xw(t)}function qs(t,s){s.split(/\s+/).forEach(u=>u&&t.classList.add(u)),(t._vtc||(t._vtc=new Set)).add(s)}function La(t,s){s.split(/\s+/).forEach(f=>f&&t.classList.remove(f));const{_vtc:u}=t;u&&(u.delete(s),u.size||(t._vtc=void 0))}function Kb(t){requestAnimationFrame(()=>{requestAnimationFrame(t)})}let dk=0;function Yb(t,s,u,f){const m=t._endId=++dk,v=()=>{m===t._endId&&f()};if(u)return setTimeout(v,u);const{type:w,timeout:o,propCount:S}=GE(t,s);if(!w)return f();const k=w+"end";let I=0;const D=()=>{t.removeEventListener(k,B),v()},B=V=>{V.target===t&&++I>=S&&D()};setTimeout(()=>{I<S&&D()},o+1),t.addEventListener(k,B)}function GE(t,s){const u=window.getComputedStyle(t),f=$=>(u[$]||"").split(", "),m=f(Ia+"Delay"),v=f(Ia+"Duration"),w=Qb(m,v),o=f(cd+"Delay"),S=f(cd+"Duration"),k=Qb(o,S);let I=null,D=0,B=0;s===Ia?w>0&&(I=Ia,D=w,B=v.length):s===cd?k>0&&(I=cd,D=k,B=S.length):(D=Math.max(w,k),I=D>0?w>k?Ia:cd:null,B=I?I===Ia?v.length:S.length:0);const V=I===Ia&&/\b(transform|all)(,|$)/.test(u[Ia+"Property"]);return{type:I,timeout:D,propCount:B,hasTransform:V}}function Qb(t,s){for(;t.length<s.length;)t=t.concat(t);return Math.max(...s.map((u,f)=>Jb(u)+Jb(t[f])))}function Jb(t){return Number(t.slice(0,-1).replace(",","."))*1e3}function ZE(){return document.body.offsetHeight}const HE=new WeakMap,WE=new WeakMap,fk={name:"TransitionGroup",props:vr({},uk,{tag:String,moveClass:String}),setup(t,{slots:s}){const u=Mn(),f=TE();let m,v;return Om(()=>{if(!m.length)return;const w=t.moveClass||`${t.name||"v"}-move`;if(!yk(m[0].el,u.vnode.el,w))return;m.forEach(mk),m.forEach(gk);const o=m.filter(_k);ZE(),o.forEach(S=>{const k=S.el,I=k.style;qs(k,w),I.transform=I.webkitTransform=I.transitionDuration="";const D=k._moveCb=B=>{B&&B.target!==k||(!B||/transform$/.test(B.propertyName))&&(k.removeEventListener("transitionend",D),k._moveCb=null,La(k,w))};k.addEventListener("transitionend",D)})}),()=>{const w=Un(t),o=$E(w);let S=w.tag||Ki;m=v,v=s.default?cv(s.default()):[];for(let k=0;k<v.length;k++){const I=v[k];I.key!=null&&Tu(I,Pd(I,o,f,u))}if(m)for(let k=0;k<m.length;k++){const I=m[k];Tu(I,Pd(I,o,f,u)),HE.set(I,I.el.getBoundingClientRect())}return Nt(S,null,v)}}},pk=fk;function mk(t){const s=t.el;s._moveCb&&s._moveCb(),s._enterCb&&s._enterCb()}function gk(t){WE.set(t,t.el.getBoundingClientRect())}function _k(t){const s=HE.get(t),u=WE.get(t),f=s.left-u.left,m=s.top-u.top;if(f||m){const v=t.el.style;return v.transform=v.webkitTransform=`translate(${f}px,${m}px)`,v.transitionDuration="0s",t}}function yk(t,s,u){const f=t.cloneNode();t._vtc&&t._vtc.forEach(w=>{w.split(/\s+/).forEach(o=>o&&f.classList.remove(o))}),u.split(/\s+/).forEach(w=>w&&f.classList.add(w)),f.style.display="none";const m=s.nodeType===1?s:s.parentNode;m.appendChild(f);const{hasTransform:v}=GE(f);return m.removeChild(f),v}const vk=vr({patchProp:lk},WI);let e1;function xk(){return e1||(e1=AI(vk))}const XE=(...t)=>{const s=xk().createApp(...t),{mount:u}=s;return s.mount=f=>{const m=bk(f);if(!m)return;const v=s._component;!Nn(v)&&!v.render&&!v.template&&(v.template=m.innerHTML),m.innerHTML="";const w=u(m,!1,m instanceof SVGElement);return m instanceof Element&&(m.removeAttribute("v-cloak"),m.setAttribute("data-v-app","")),w},s};function bk(t){return er(t)?document.querySelector(t):t}function ys(t,s,u,f){return Object.defineProperty(t,s,{get:u,set:f,enumerable:!0}),t}function wk(t,s){for(const u in s)ys(t,u,s[u]);return t}const ws=xt(!1);let Vm;function Ek(t,s){const u=/(edg|edge|edga|edgios)\/([\w.]+)/.exec(t)||/(opr)[\/]([\w.]+)/.exec(t)||/(vivaldi)[\/]([\w.]+)/.exec(t)||/(chrome|crios)[\/]([\w.]+)/.exec(t)||/(version)(applewebkit)[\/]([\w.]+).*(safari)[\/]([\w.]+)/.exec(t)||/(webkit)[\/]([\w.]+).*(version)[\/]([\w.]+).*(safari)[\/]([\w.]+)/.exec(t)||/(firefox|fxios)[\/]([\w.]+)/.exec(t)||/(webkit)[\/]([\w.]+)/.exec(t)||/(opera)(?:.*version|)[\/]([\w.]+)/.exec(t)||[];return{browser:u[5]||u[3]||u[1]||"",version:u[2]||u[4]||"0",versionNumber:u[4]||u[2]||"0",platform:s[0]||""}}function Tk(t){return/(ipad)/.exec(t)||/(ipod)/.exec(t)||/(windows phone)/.exec(t)||/(iphone)/.exec(t)||/(kindle)/.exec(t)||/(silk)/.exec(t)||/(android)/.exec(t)||/(win)/.exec(t)||/(mac)/.exec(t)||/(linux)/.exec(t)||/(cros)/.exec(t)||/(playbook)/.exec(t)||/(bb)/.exec(t)||/(blackberry)/.exec(t)||[]}const KE="ontouchstart"in window||window.navigator.maxTouchPoints>0;function Sk(t){Vm={is:{...t}},delete t.mac,delete t.desktop;const s=Math.min(window.innerHeight,window.innerWidth)>414?"ipad":"iphone";Object.assign(t,{mobile:!0,ios:!0,platform:s,[s]:!0})}function Ck(t){const s=t.toLowerCase(),u=Tk(s),f=Ek(s,u),m={};f.browser&&(m[f.browser]=!0,m.version=f.version,m.versionNumber=parseInt(f.versionNumber,10)),f.platform&&(m[f.platform]=!0);const v=m.android||m.ios||m.bb||m.blackberry||m.ipad||m.iphone||m.ipod||m.kindle||m.playbook||m.silk||m["windows phone"];return v===!0||s.indexOf("mobile")>-1?(m.mobile=!0,m.edga||m.edgios?(m.edge=!0,f.browser="edge"):m.crios?(m.chrome=!0,f.browser="chrome"):m.fxios&&(m.firefox=!0,f.browser="firefox")):m.desktop=!0,(m.ipod||m.ipad||m.iphone)&&(m.ios=!0),m["windows phone"]&&(m.winphone=!0,delete m["windows phone"]),(m.chrome||m.opr||m.safari||m.vivaldi||m.mobile===!0&&m.ios!==!0&&v!==!0)&&(m.webkit=!0),m.edg&&(f.browser="edgechromium",m.edgeChromium=!0),(m.safari&&m.blackberry||m.bb)&&(f.browser="blackberry",m.blackberry=!0),m.safari&&m.playbook&&(f.browser="playbook",m.playbook=!0),m.opr&&(f.browser="opera",m.opera=!0),m.safari&&m.android&&(f.browser="android",m.android=!0),m.safari&&m.kindle&&(f.browser="kindle",m.kindle=!0),m.safari&&m.silk&&(f.browser="silk",m.silk=!0),m.vivaldi&&(f.browser="vivaldi",m.vivaldi=!0),m.name=f.browser,m.platform=f.platform,s.indexOf("electron")>-1?m.electron=!0:document.location.href.indexOf("-extension://")>-1?m.bex=!0:(window.Capacitor!==void 0?(m.capacitor=!0,m.nativeMobile=!0,m.nativeMobileWrapper="capacitor"):(window._cordovaNative!==void 0||window.cordova!==void 0)&&(m.cordova=!0,m.nativeMobile=!0,m.nativeMobileWrapper="cordova"),KE===!0&&m.mac===!0&&(m.desktop===!0&&m.safari===!0||m.nativeMobile===!0&&m.android!==!0&&m.ios!==!0&&m.ipad!==!0)&&Sk(m)),m}const t1=navigator.userAgent||navigator.vendor||window.opera,Ak={has:{touch:!1,webStorage:!1},within:{iframe:!1}},hi={userAgent:t1,is:Ck(t1),has:{touch:KE},within:{iframe:window.self!==window.top}},am={install(t){const{$q:s}=t;ws.value===!0?(t.onSSRHydrated.push(()=>{ws.value=!1,Object.assign(s.platform,hi),Vm=void 0}),s.platform=ko(this)):s.platform=this}};{let t;ys(hi.has,"webStorage",()=>{if(t!==void 0)return t;try{if(window.localStorage)return t=!0,!0}catch{}return t=!1,!1}),hi.is.ios===!0&&window.navigator.vendor.toLowerCase().indexOf("apple"),ws.value===!0?Object.assign(am,hi,Vm,Ak):Object.assign(am,hi)}const Um=(t,s)=>{const u=ko(t);for(const f in t)ys(s,f,()=>u[f],m=>{u[f]=m});return s},Xi={hasPassive:!1,passiveCapture:!0,notPassiveCapture:!0};try{const t=Object.defineProperty({},"passive",{get(){Object.assign(Xi,{hasPassive:!0,passive:{passive:!0},notPassive:{passive:!1},passiveCapture:{passive:!0,capture:!0},notPassiveCapture:{passive:!1,capture:!0}})}});window.addEventListener("qtest",null,t),window.removeEventListener("qtest",null,t)}catch{}function Es(){}function YE(t){return t.button===0}function ec(t){return t.touches&&t.touches[0]?t=t.touches[0]:t.changedTouches&&t.changedTouches[0]?t=t.changedTouches[0]:t.targetTouches&&t.targetTouches[0]&&(t=t.targetTouches[0]),{top:t.clientY,left:t.clientX}}function Mk(t){if(t.path)return t.path;if(t.composedPath)return t.composedPath();const s=[];let u=t.target;for(;u;){if(s.push(u),u.tagName==="HTML")return s.push(document),s.push(window),s;u=u.parentElement}}function to(t){t.stopPropagation()}function Fr(t){t.cancelable!==!1&&t.preventDefault()}function zi(t){t.cancelable!==!1&&t.preventDefault(),t.stopPropagation()}function yu(t,s){if(t===void 0||s===!0&&t.__dragPrevented===!0)return;const u=s===!0?f=>{f.__dragPrevented=!0,f.addEventListener("dragstart",Fr,Xi.notPassiveCapture)}:f=>{delete f.__dragPrevented,f.removeEventListener("dragstart",Fr,Xi.notPassiveCapture)};t.querySelectorAll("a, img").forEach(u)}function Xo(t,s,u){const f=`__q_${s}_evt`;t[f]=t[f]!==void 0?t[f].concat(u):u,u.forEach(m=>{m[0].addEventListener(m[1],t[m[2]],Xi[m[3]])})}function qa(t,s){const u=`__q_${s}_evt`;t[u]!==void 0&&(t[u].forEach(f=>{f[0].removeEventListener(f[1],t[f[2]],Xi[f[3]])}),t[u]=void 0)}function gv(t,s=250,u){let f;function m(){const v=arguments,w=()=>{f=void 0,u!==!0&&t.apply(this,v)};clearTimeout(f),u===!0&&f===void 0&&t.apply(this,v),f=setTimeout(w,s)}return m.cancel=()=>{clearTimeout(f)},m}const V_=["sm","md","lg","xl"],{passive:n1}=Xi,Ik=Um({width:0,height:0,name:"xs",sizes:{sm:600,md:1024,lg:1440,xl:1920},lt:{sm:!0,md:!0,lg:!0,xl:!0},gt:{xs:!1,sm:!1,md:!1,lg:!1},xs:!0,sm:!1,md:!1,lg:!1,xl:!1},{setSizes:Es,setDebounce:Es,install({$q:t,onSSRHydrated:s}){if(t.screen=this,this.__installed===!0){t.config.screen!==void 0&&(t.config.screen.bodyClasses===!1?document.body.classList.remove(`screen--${this.name}`):this.__update(!0));return}const{visualViewport:u}=window,f=u||window,m=document.scrollingElement||document.documentElement,v=u===void 0||hi.is.mobile===!0?()=>[Math.max(window.innerWidth,m.clientWidth),Math.max(window.innerHeight,m.clientHeight)]:()=>[u.width*u.scale+window.innerWidth-m.clientWidth,u.height*u.scale+window.innerHeight-m.clientHeight],w=t.config.screen!==void 0&&t.config.screen.bodyClasses===!0;this.__update=D=>{const[B,V]=v();if(V!==this.height&&(this.height=V),B!==this.width)this.width=B;else if(D!==!0)return;let $=this.sizes;this.gt.xs=B>=$.sm,this.gt.sm=B>=$.md,this.gt.md=B>=$.lg,this.gt.lg=B>=$.xl,this.lt.sm=B<$.sm,this.lt.md=B<$.md,this.lt.lg=B<$.lg,this.lt.xl=B<$.xl,this.xs=this.lt.sm,this.sm=this.gt.xs===!0&&this.lt.md===!0,this.md=this.gt.sm===!0&&this.lt.lg===!0,this.lg=this.gt.md===!0&&this.lt.xl===!0,this.xl=this.gt.lg,$=this.xs===!0&&"xs"||this.sm===!0&&"sm"||this.md===!0&&"md"||this.lg===!0&&"lg"||"xl",$!==this.name&&(w===!0&&(document.body.classList.remove(`screen--${this.name}`),document.body.classList.add(`screen--${$}`)),this.name=$)};let o,S={},k=16;this.setSizes=D=>{V_.forEach(B=>{D[B]!==void 0&&(S[B]=D[B])})},this.setDebounce=D=>{k=D};const I=()=>{const D=getComputedStyle(document.body);D.getPropertyValue("--q-size-sm")&&V_.forEach(B=>{this.sizes[B]=parseInt(D.getPropertyValue(`--q-size-${B}`),10)}),this.setSizes=B=>{V_.forEach(V=>{B[V]&&(this.sizes[V]=B[V])}),this.__update(!0)},this.setDebounce=B=>{o!==void 0&&f.removeEventListener("resize",o,n1),o=B>0?gv(this.__update,B):this.__update,f.addEventListener("resize",o,n1)},this.setDebounce(k),Object.keys(S).length>0?(this.setSizes(S),S=void 0):this.__update(),w===!0&&this.name==="xs"&&document.body.classList.add("screen--xs")};ws.value===!0?s.push(I):I()}}),Or=Um({isActive:!1,mode:!1},{__media:void 0,set(t){Or.mode=t,t==="auto"?(Or.__media===void 0&&(Or.__media=window.matchMedia("(prefers-color-scheme: dark)"),Or.__updateMedia=()=>{Or.set("auto")},Or.__media.addListener(Or.__updateMedia)),t=Or.__media.matches):Or.__media!==void 0&&(Or.__media.removeListener(Or.__updateMedia),Or.__media=void 0),Or.isActive=t===!0,document.body.classList.remove(`body--${t===!0?"light":"dark"}`),document.body.classList.add(`body--${t===!0?"dark":"light"}`)},toggle(){Or.set(Or.isActive===!1)},install({$q:t,onSSRHydrated:s,ssrContext:u}){const{dark:f}=t.config;if(t.dark=this,this.__installed===!0&&f===void 0)return;this.isActive=f===!0;const m=f!==void 0?f:!1;if(ws.value===!0){const v=o=>{this.__fromSSR=o},w=this.set;this.set=v,v(m),s.push(()=>{this.set=w,this.set(this.__fromSSR)})}else this.set(m)}}),QE=()=>!0;function kk(t){return typeof t=="string"&&t!==""&&t!=="/"&&t!=="#/"}function Pk(t){return t.startsWith("#")===!0&&(t=t.substring(1)),t.startsWith("/")===!1&&(t="/"+t),t.endsWith("/")===!0&&(t=t.substring(0,t.length-1)),"#"+t}function zk(t){if(t.backButtonExit===!1)return()=>!1;if(t.backButtonExit==="*")return QE;const s=["#/"];return Array.isArray(t.backButtonExit)===!0&&s.push(...t.backButtonExit.filter(kk).map(Pk)),()=>s.includes(window.location.hash)}const Od={__history:[],add:Es,remove:Es,install({$q:t}){if(this.__installed===!0)return;const{cordova:s,capacitor:u}=hi.is;if(s!==!0&&u!==!0)return;const f=t.config[s===!0?"cordova":"capacitor"];if(f!==void 0&&f.backButton===!1||u===!0&&(window.Capacitor===void 0||window.Capacitor.Plugins.App===void 0))return;this.add=w=>{w.condition===void 0&&(w.condition=QE),this.__history.push(w)},this.remove=w=>{const o=this.__history.indexOf(w);o>=0&&this.__history.splice(o,1)};const m=zk(Object.assign({backButtonExit:!0},f)),v=()=>{if(this.__history.length){const w=this.__history[this.__history.length-1];w.condition()===!0&&(this.__history.pop(),w.handler())}else m()===!0?navigator.app.exitApp():window.history.back()};s===!0?document.addEventListener("deviceready",()=>{document.addEventListener("backbutton",v,!1)}):window.Capacitor.Plugins.App.addListener("backButton",v)}},i1={isoName:"en-US",nativeName:"English (US)",label:{clear:"Clear",ok:"OK",cancel:"Cancel",close:"Close",set:"Set",select:"Select",reset:"Reset",remove:"Remove",update:"Update",create:"Create",search:"Search",filter:"Filter",refresh:"Refresh",expand:t=>t?`Expand "${t}"`:"Expand",collapse:t=>t?`Collapse "${t}"`:"Collapse"},date:{days:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),daysShort:"Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),monthsShort:"Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_"),firstDayOfWeek:0,format24h:!1,pluralDay:"days"},table:{noData:"No data available",noResults:"No matching records found",loading:"Loading...",selectedRecords:t=>t===1?"1 record selected.":(t===0?"No":t)+" records selected.",recordsPerPage:"Records per page:",allRows:"All",pagination:(t,s,u)=>t+"-"+s+" of "+u,columns:"Columns"},editor:{url:"URL",bold:"Bold",italic:"Italic",strikethrough:"Strikethrough",underline:"Underline",unorderedList:"Unordered List",orderedList:"Ordered List",subscript:"Subscript",superscript:"Superscript",hyperlink:"Hyperlink",toggleFullscreen:"Toggle Fullscreen",quote:"Quote",left:"Left align",center:"Center align",right:"Right align",justify:"Justify align",print:"Print",outdent:"Decrease indentation",indent:"Increase indentation",removeFormat:"Remove formatting",formatting:"Formatting",fontSize:"Font Size",align:"Align",hr:"Insert Horizontal Rule",undo:"Undo",redo:"Redo",heading1:"Heading 1",heading2:"Heading 2",heading3:"Heading 3",heading4:"Heading 4",heading5:"Heading 5",heading6:"Heading 6",paragraph:"Paragraph",code:"Code",size1:"Very small",size2:"A bit small",size3:"Normal",size4:"Medium-large",size5:"Big",size6:"Very big",size7:"Maximum",defaultFont:"Default Font",viewSource:"View Source"},tree:{noNodes:"No nodes available",noResults:"No matching nodes found"}};function r1(){const t=Array.isArray(navigator.languages)===!0&&navigator.languages.length>0?navigator.languages[0]:navigator.language;if(typeof t=="string")return t.split(/[-_]/).map((s,u)=>u===0?s.toLowerCase():u>1||s.length<4?s.toUpperCase():s[0].toUpperCase()+s.slice(1).toLowerCase()).join("-")}const Da=Um({__langPack:{}},{getLocale:r1,set(t=i1,s){const u={...t,rtl:t.rtl===!0,getLocale:r1};{const f=document.documentElement;f.setAttribute("dir",u.rtl===!0?"rtl":"ltr"),f.setAttribute("lang",u.isoName),u.set=Da.set,Object.assign(Da.__langPack,u),Da.props=u,Da.isoName=u.isoName,Da.nativeName=u.nativeName}},install({$q:t,lang:s,ssrContext:u}){t.lang=Da.__langPack,this.__installed===!0?s!==void 0&&this.set(s):this.set(s||i1)}});function Lk(t,s,u=document.body){if(typeof t!="string")throw new TypeError("Expected a string as propName");if(typeof s!="string")throw new TypeError("Expected a string as value");if(!(u instanceof Element))throw new TypeError("Expected a DOM element");u.style.setProperty(`--q-${t}`,s)}let JE=!1;function Rk(t){JE=t.isComposing===!0}function _v(t){return JE===!0||t!==Object(t)||t.isComposing===!0||t.qKeyEvent===!0}function $a(t,s){return _v(t)===!0?!1:[].concat(s).includes(t.keyCode)}function Dk(t){if(t.ios===!0)return"ios";if(t.android===!0)return"android"}function Ok({is:t,has:s,within:u},f){const m=[t.desktop===!0?"desktop":"mobile",`${s.touch===!1?"no-":""}touch`];if(t.mobile===!0){const v=Dk(t);v!==void 0&&m.push("platform-"+v)}if(t.nativeMobile===!0){const v=t.nativeMobileWrapper;m.push(v),m.push("native-mobile"),t.ios===!0&&(f[v]===void 0||f[v].iosStatusBarPadding!==!1)&&m.push("q-ios-padding")}else t.electron===!0?m.push("electron"):t.bex===!0&&m.push("bex");return u.iframe===!0&&m.push("within-iframe"),m}function Bk(){const t=document.body.className;let s=t;Vm!==void 0&&(s=s.replace("desktop","platform-ios mobile")),hi.has.touch===!0&&(s=s.replace("no-touch","touch")),hi.within.iframe===!0&&(s+=" within-iframe"),t!==s&&(document.body.className=s)}function Fk(t){for(const s in t)Lk(s,t[s])}const Nk={install(t){if(this.__installed!==!0){if(ws.value===!0)Bk();else{const{$q:s}=t;s.config.brand!==void 0&&Fk(s.config.brand);const u=Ok(hi,s.config);document.body.classList.add.apply(document.body.classList,u)}hi.is.ios===!0&&document.body.addEventListener("touchstart",Es),window.addEventListener("keydown",Rk,!0)}}},eT={name:"material-icons",type:{positive:"check_circle",negative:"warning",info:"info",warning:"priority_high"},arrow:{up:"arrow_upward",right:"arrow_forward",down:"arrow_downward",left:"arrow_back",dropdown:"arrow_drop_down"},chevron:{left:"chevron_left",right:"chevron_right"},colorPicker:{spectrum:"gradient",tune:"tune",palette:"style"},pullToRefresh:{icon:"refresh"},carousel:{left:"chevron_left",right:"chevron_right",up:"keyboard_arrow_up",down:"keyboard_arrow_down",navigationIcon:"lens"},chip:{remove:"cancel",selected:"check"},datetime:{arrowLeft:"chevron_left",arrowRight:"chevron_right",now:"access_time",today:"today"},editor:{bold:"format_bold",italic:"format_italic",strikethrough:"strikethrough_s",underline:"format_underlined",unorderedList:"format_list_bulleted",orderedList:"format_list_numbered",subscript:"vertical_align_bottom",superscript:"vertical_align_top",hyperlink:"link",toggleFullscreen:"fullscreen",quote:"format_quote",left:"format_align_left",center:"format_align_center",right:"format_align_right",justify:"format_align_justify",print:"print",outdent:"format_indent_decrease",indent:"format_indent_increase",removeFormat:"format_clear",formatting:"text_format",fontSize:"format_size",align:"format_align_left",hr:"remove",undo:"undo",redo:"redo",heading:"format_size",code:"code",size:"format_size",font:"font_download",viewSource:"code"},expansionItem:{icon:"keyboard_arrow_down",denseIcon:"arrow_drop_down"},fab:{icon:"add",activeIcon:"close"},field:{clear:"cancel",error:"error"},pagination:{first:"first_page",prev:"keyboard_arrow_left",next:"keyboard_arrow_right",last:"last_page"},rating:{icon:"grade"},stepper:{done:"check",active:"edit",error:"warning"},tabs:{left:"chevron_left",right:"chevron_right",up:"keyboard_arrow_up",down:"keyboard_arrow_down"},table:{arrowUp:"arrow_upward",warning:"warning",firstPage:"first_page",prevPage:"chevron_left",nextPage:"chevron_right",lastPage:"last_page"},tree:{icon:"play_arrow"},uploader:{done:"done",clear:"clear",add:"add_box",upload:"cloud_upload",removeQueue:"clear_all",removeUploaded:"done_all"}},lm=Um({iconMapFn:null,__icons:{}},{set(t,s){const u={...t,rtl:t.rtl===!0};u.set=lm.set,Object.assign(lm.__icons,u)},install({$q:t,iconSet:s,ssrContext:u}){t.config.iconMapFn!==void 0&&(this.iconMapFn=t.config.iconMapFn),t.iconSet=this.__icons,ys(t,"iconMapFn",()=>this.iconMapFn,f=>{this.iconMapFn=f}),this.__installed===!0?s!==void 0&&this.set(s):this.set(s||eT)}}),tT="_q_",qm="_q_l_",Vk="_q_pc_",Uk="_q_fo_",rF="_q_tabs_",Zs=()=>{},cm={};let nT=!1;function qk(){nT=!0}function Fa(t,s){if(t===s)return!0;if(t!==null&&s!==null&&typeof t=="object"&&typeof s=="object"){if(t.constructor!==s.constructor)return!1;let u,f;if(t.constructor===Array){if(u=t.length,u!==s.length)return!1;for(f=u;f--!==0;)if(Fa(t[f],s[f])!==!0)return!1;return!0}if(t.constructor===Map){if(t.size!==s.size)return!1;for(f=t.entries().next();f.done!==!0;){if(s.has(f.value[0])!==!0)return!1;f=f.next()}for(f=t.entries().next();f.done!==!0;){if(Fa(f.value[1],s.get(f.value[0]))!==!0)return!1;f=f.next()}return!0}if(t.constructor===Set){if(t.size!==s.size)return!1;for(f=t.entries().next();f.done!==!0;){if(s.has(f.value[0])!==!0)return!1;f=f.next()}return!0}if(t.buffer!=null&&t.buffer.constructor===ArrayBuffer){if(u=t.length,u!==s.length)return!1;for(f=u;f--!==0;)if(t[f]!==s[f])return!1;return!0}if(t.constructor===RegExp)return t.source===s.source&&t.flags===s.flags;if(t.valueOf!==Object.prototype.valueOf)return t.valueOf()===s.valueOf();if(t.toString!==Object.prototype.toString)return t.toString()===s.toString();const m=Object.keys(t).filter(v=>t[v]!==void 0);if(u=m.length,u!==Object.keys(s).filter(v=>s[v]!==void 0).length)return!1;for(f=u;f--!==0;){const v=m[f];if(Fa(t[v],s[v])!==!0)return!1}return!0}return t!==t&&s!==s}function Mu(t){return t!==null&&typeof t=="object"&&Array.isArray(t)!==!0}function o1(t){return Object.prototype.toString.call(t)==="[object Date]"}function um(t){return typeof t=="number"&&isFinite(t)}const s1=[am,Nk,Or,Ik,Od,Da,lm];function jk(t,s){const u=XE(t);u.config.globalProperties=s.config.globalProperties;const{reload:f,...m}=s._context;return Object.assign(u._context,m),u}function a1(t,s){s.forEach(u=>{u.install(t),u.__installed=!0})}function $k(t,s,u){t.config.globalProperties.$q=u.$q,t.provide(tT,u.$q),a1(u,s1),s.components!==void 0&&Object.values(s.components).forEach(f=>{Mu(f)===!0&&f.name!==void 0&&t.component(f.name,f)}),s.directives!==void 0&&Object.values(s.directives).forEach(f=>{Mu(f)===!0&&f.name!==void 0&&t.directive(f.name,f)}),s.plugins!==void 0&&a1(u,Object.values(s.plugins).filter(f=>typeof f.install=="function"&&s1.includes(f)===!1)),ws.value===!0&&(u.$q.onSSRHydrated=()=>{u.onSSRHydrated.forEach(f=>{f()}),u.$q.onSSRHydrated=()=>{}})}const Gk=function(t,s={}){const u={version:"2.10.0"};nT===!1?(s.config!==void 0&&Object.assign(cm,s.config),u.config={...cm},qk()):u.config=s.config||{},$k(t,s,{parentApp:t,$q:u,lang:s.lang,iconSet:s.iconSet,onSSRHydrated:[]})},Zk={version:"2.10.0",install:Gk,lang:Da,iconSet:lm};var Hk=!1;/*!
  * pinia v2.0.23
  * (c) 2022 Eduardo San Martin Morote
  * @license MIT
  */let iT;const jm=t=>iT=t,rT=Symbol();function Ty(t){return t&&typeof t=="object"&&Object.prototype.toString.call(t)==="[object Object]"&&typeof t.toJSON!="function"}var wd;(function(t){t.direct="direct",t.patchObject="patch object",t.patchFunction="patch function"})(wd||(wd={}));function Wk(){const t=Yw(!0),s=t.run(()=>xt({}));let u=[],f=[];const m=Xs({install(v){jm(m),m._a=v,v.provide(rT,m),v.config.globalProperties.$pinia=m,f.forEach(w=>u.push(w)),f=[]},use(v){return!this._a&&!Hk?f.push(v):u.push(v),this},_p:u,_a:null,_e:t,_s:new Map,state:s});return m}const oT=()=>{};function l1(t,s,u,f=oT){t.push(s);const m=()=>{const v=t.indexOf(s);v>-1&&(t.splice(v,1),f())};return!u&&Mn()&&ea(m),m}function ru(t,...s){t.slice().forEach(u=>{u(...s)})}function Sy(t,s){t instanceof Map&&s instanceof Map&&s.forEach((u,f)=>t.set(f,u)),t instanceof Set&&s instanceof Set&&s.forEach(t.add,t);for(const u in s){if(!s.hasOwnProperty(u))continue;const f=s[u],m=t[u];Ty(m)&&Ty(f)&&t.hasOwnProperty(u)&&!Vi(f)&&!Va(f)?t[u]=Sy(m,f):t[u]=f}return t}const Xk=Symbol();function Kk(t){return!Ty(t)||!t.hasOwnProperty(Xk)}const{assign:Oa}=Object;function Yk(t){return!!(Vi(t)&&t.effect)}function Qk(t,s,u,f){const{state:m,actions:v,getters:w}=s,o=u.state.value[t];let S;function k(){o||(u.state.value[t]=m?m():{});const I=VM(u.state.value[t]);return Oa(I,v,Object.keys(w||{}).reduce((D,B)=>(D[B]=Xs(se(()=>{jm(u);const V=u._s.get(t);return w[B].call(V,V)})),D),{}))}return S=sT(t,k,s,u,f,!0),S.$reset=function(){const D=m?m():{};this.$patch(B=>{Oa(B,D)})},S}function sT(t,s,u={},f,m,v){let w;const o=Oa({actions:{}},u),S={deep:!0};let k,I,D=Xs([]),B=Xs([]),V;const $=f.state.value[t];!v&&!$&&(f.state.value[t]={}),xt({});let ne;function oe(Ee){let Me;k=I=!1,typeof Ee=="function"?(Ee(f.state.value[t]),Me={type:wd.patchFunction,storeId:t,events:V}):(Sy(f.state.value[t],Ee),Me={type:wd.patchObject,payload:Ee,storeId:t,events:V});const Ie=ne=Symbol();ui().then(()=>{ne===Ie&&(k=!0)}),I=!0,ru(D,Me,f.state.value[t])}const ye=oT;function te(){w.stop(),D=[],B=[],f._s.delete(t)}function Se(Ee,Me){return function(){jm(f);const Ie=Array.from(arguments),ke=[],Be=[];function Re(lt){ke.push(lt)}function Ze(lt){Be.push(lt)}ru(B,{args:Ie,name:Ee,store:ce,after:Re,onError:Ze});let Ye;try{Ye=Me.apply(this&&this.$id===t?this:ce,Ie)}catch(lt){throw ru(Be,lt),lt}return Ye instanceof Promise?Ye.then(lt=>(ru(ke,lt),lt)).catch(lt=>(ru(Be,lt),Promise.reject(lt))):(ru(ke,Ye),Ye)}}const Ae={_p:f,$id:t,$onAction:l1.bind(null,B),$patch:oe,$reset:ye,$subscribe(Ee,Me={}){const Ie=l1(D,Ee,Me.detached,()=>ke()),ke=w.run(()=>Wt(()=>f.state.value[t],Be=>{(Me.flush==="sync"?I:k)&&Ee({storeId:t,type:wd.direct,events:V},Be)},Oa({},S,Me)));return Ie},$dispose:te},ce=ko(Ae);f._s.set(t,ce);const fe=f._e.run(()=>(w=Yw(),w.run(()=>s())));for(const Ee in fe){const Me=fe[Ee];if(Vi(Me)&&!Yk(Me)||Va(Me))v||($&&Kk(Me)&&(Vi(Me)?Me.value=$[Ee]:Sy(Me,$[Ee])),f.state.value[t][Ee]=Me);else if(typeof Me=="function"){const Ie=Se(Ee,Me);fe[Ee]=Ie,o.actions[Ee]=Me}}return Oa(ce,fe),Oa(Un(ce),fe),Object.defineProperty(ce,"$state",{get:()=>f.state.value[t],set:Ee=>{oe(Me=>{Oa(Me,Ee)})}}),f._p.forEach(Ee=>{Oa(ce,w.run(()=>Ee({store:ce,app:f._a,pinia:f,options:o})))}),$&&v&&u.hydrate&&u.hydrate(ce.$state,$),k=!0,I=!0,ce}function aT(t,s,u){let f,m;const v=typeof s=="function";typeof t=="string"?(f=t,m=v?u:s):(m=t,f=t.id);function w(o,S){const k=Mn();return o=o||k&&Vr(rT),o&&jm(o),o=iT,o._s.has(f)||(v?sT(f,s,m,o):Qk(f,m,o)),o._s.get(f)}return w.$id=f,w}const Cy={xs:18,sm:24,md:32,lg:38,xl:46},Fu={size:String};function Nu(t,s=Cy){return se(()=>t.size!==void 0?{fontSize:t.size in s?`${s[t.size]}px`:t.size}:null)}const Vn=t=>Xs(uv(t)),$m=t=>Xs(t);function bi(t,s){return t!==void 0&&t()||s}function yv(t,s){if(t!==void 0){const u=t();if(u!=null)return u.slice()}return s}function Po(t,s){return t!==void 0?s.concat(t()):s}function lT(t,s){return t===void 0?s:s!==void 0?s.concat(t()):t()}function hm(t,s,u,f,m,v){s.key=f+m;const w=pe(t,s,u);return m===!0?Xl(w,v()):w}const c1="0 0 24 24",u1=t=>t,U_=t=>`ionicons ${t}`,cT={"mdi-":t=>`mdi ${t}`,"icon-":u1,"bt-":t=>`bt ${t}`,"eva-":t=>`eva ${t}`,"ion-md":U_,"ion-ios":U_,"ion-logo":U_,"iconfont ":u1,"ti-":t=>`themify-icon ${t}`,"bi-":t=>`bootstrap-icons ${t}`},uT={o_:"-outlined",r_:"-round",s_:"-sharp"},hT={sym_o_:"-outlined",sym_r_:"-rounded",sym_s_:"-sharp"},Jk=new RegExp("^("+Object.keys(cT).join("|")+")"),eP=new RegExp("^("+Object.keys(uT).join("|")+")"),h1=new RegExp("^("+Object.keys(hT).join("|")+")"),tP=/^[Mm]\s?[-+]?\.?\d/,nP=/^img:/,iP=/^svguse:/,rP=/^ion-/,oP=/^(fa-(solid|regular|light|brands|duotone|thin)|[lf]a[srlbdk]?) /,Hr=Vn({name:"QIcon",props:{...Fu,tag:{type:String,default:"i"},name:String,color:String,left:Boolean,right:Boolean},setup(t,{slots:s}){const{proxy:{$q:u}}=Mn(),f=Nu(t),m=se(()=>"q-icon"+(t.left===!0?" on-left":"")+(t.right===!0?" on-right":"")+(t.color!==void 0?` text-${t.color}`:"")),v=se(()=>{let w,o=t.name;if(o==="none"||!o)return{none:!0};if(u.iconMapFn!==null){const I=u.iconMapFn(o);if(I!==void 0)if(I.icon!==void 0){if(o=I.icon,o==="none"||!o)return{none:!0}}else return{cls:I.cls,content:I.content!==void 0?I.content:" "}}if(tP.test(o)===!0){const[I,D=c1]=o.split("|");return{svg:!0,viewBox:D,nodes:I.split("&&").map(B=>{const[V,$,ne]=B.split("@@");return pe("path",{style:$,d:V,transform:ne})})}}if(nP.test(o)===!0)return{img:!0,src:o.substring(4)};if(iP.test(o)===!0){const[I,D=c1]=o.split("|");return{svguse:!0,src:I.substring(7),viewBox:D}}let S=" ";const k=o.match(Jk);if(k!==null)w=cT[k[1]](o);else if(oP.test(o)===!0)w=o;else if(rP.test(o)===!0)w=`ionicons ion-${u.platform.is.ios===!0?"ios":"md"}${o.substring(3)}`;else if(h1.test(o)===!0){w="notranslate material-symbols";const I=o.match(h1);I!==null&&(o=o.substring(6),w+=hT[I[1]]),S=o}else{w="notranslate material-icons";const I=o.match(eP);I!==null&&(o=o.substring(2),w+=uT[I[1]]),S=o}return{cls:w,content:S}});return()=>{const w={class:m.value,style:f.value,"aria-hidden":"true",role:"presentation"};return v.value.none===!0?pe(t.tag,w,bi(s.default)):v.value.img===!0?pe("span",w,Po(s.default,[pe("img",{src:v.value.src})])):v.value.svg===!0?pe("span",w,Po(s.default,[pe("svg",{viewBox:v.value.viewBox||"0 0 24 24"},v.value.nodes)])):v.value.svguse===!0?pe("span",w,Po(s.default,[pe("svg",{viewBox:v.value.viewBox},[pe("use",{"xlink:href":v.value.src})])])):(v.value.cls!==void 0&&(w.class+=" "+v.value.cls),pe(t.tag,w,Po(s.default,[v.value.content])))}}}),Ed=Vn({name:"QAvatar",props:{...Fu,fontSize:String,color:String,textColor:String,icon:String,square:Boolean,rounded:Boolean},setup(t,{slots:s}){const u=Nu(t),f=se(()=>"q-avatar"+(t.color?` bg-${t.color}`:"")+(t.textColor?` text-${t.textColor} q-chip--colored`:"")+(t.square===!0?" q-avatar--square":t.rounded===!0?" rounded-borders":"")),m=se(()=>t.fontSize?{fontSize:t.fontSize}:null);return()=>{const v=t.icon!==void 0?[pe(Hr,{name:t.icon})]:void 0;return pe("div",{class:f.value,style:u.value},[pe("div",{class:"q-avatar__content row flex-center overflow-hidden",style:m.value},lT(s.default,v))])}}}),sP={size:{type:[Number,String],default:"1em"},color:String};function aP(t){return{cSize:se(()=>t.size in Cy?`${Cy[t.size]}px`:t.size),classes:se(()=>"q-spinner"+(t.color?` text-${t.color}`:""))}}const Gm=Vn({name:"QSpinner",props:{...sP,thickness:{type:Number,default:5}},setup(t){const{cSize:s,classes:u}=aP(t);return()=>pe("svg",{class:u.value+" q-spinner-mat",width:s.value,height:s.value,viewBox:"25 25 50 50"},[pe("circle",{class:"path",cx:"50",cy:"50",r:"20",fill:"none",stroke:"currentColor","stroke-width":t.thickness,"stroke-miterlimit":"10"})])}});function Ay(t,s){const u=t.style;for(const f in s)u[f]=s[f]}function lP(t){if(t==null)return;if(typeof t=="string")try{return document.querySelector(t)||void 0}catch{return}const s=On(t);if(s)return s.$el||s}function dT(t,s){if(t==null||t.contains(s)===!0)return!0;for(let u=t.nextElementSibling;u!==null;u=u.nextElementSibling)if(u.contains(s))return!0;return!1}function cP(t,s=250){let u=!1,f;return function(){return u===!1&&(u=!0,setTimeout(()=>{u=!1},s),f=t.apply(this,arguments)),f}}function d1(t,s,u,f){u.modifiers.stop===!0&&to(t);const m=u.modifiers.color;let v=u.modifiers.center;v=v===!0||f===!0;const w=document.createElement("span"),o=document.createElement("span"),S=ec(t),{left:k,top:I,width:D,height:B}=s.getBoundingClientRect(),V=Math.sqrt(D*D+B*B),$=V/2,ne=`${(D-V)/2}px`,oe=v?ne:`${S.left-k-$}px`,ye=`${(B-V)/2}px`,te=v?ye:`${S.top-I-$}px`;o.className="q-ripple__inner",Ay(o,{height:`${V}px`,width:`${V}px`,transform:`translate3d(${oe},${te},0) scale3d(.2,.2,1)`,opacity:0}),w.className=`q-ripple${m?" text-"+m:""}`,w.setAttribute("dir","ltr"),w.appendChild(o),s.appendChild(w);const Se=()=>{w.remove(),clearTimeout(Ae)};u.abort.push(Se);let Ae=setTimeout(()=>{o.classList.add("q-ripple__inner--enter"),o.style.transform=`translate3d(${ne},${ye},0) scale3d(1,1,1)`,o.style.opacity=.2,Ae=setTimeout(()=>{o.classList.remove("q-ripple__inner--enter"),o.classList.add("q-ripple__inner--leave"),o.style.opacity=0,Ae=setTimeout(()=>{w.remove(),u.abort.splice(u.abort.indexOf(Se),1)},275)},250)},50)}function f1(t,{modifiers:s,value:u,arg:f}){const m=Object.assign({},t.cfg.ripple,s,u);t.modifiers={early:m.early===!0,stop:m.stop===!0,center:m.center===!0,color:m.color||f,keyCodes:[].concat(m.keyCodes||13)}}const fT=$m({name:"ripple",beforeMount(t,s){const u=s.instance.$.appContext.config.globalProperties.$q.config||{};if(u.ripple===!1)return;const f={cfg:u,enabled:s.value!==!1,modifiers:{},abort:[],start(m){f.enabled===!0&&m.qSkipRipple!==!0&&m.type===(f.modifiers.early===!0?"pointerdown":"click")&&d1(m,t,f,m.qKeyEvent===!0)},keystart:cP(m=>{f.enabled===!0&&m.qSkipRipple!==!0&&$a(m,f.modifiers.keyCodes)===!0&&m.type===`key${f.modifiers.early===!0?"down":"up"}`&&d1(m,t,f,!0)},300)};f1(f,s),t.__qripple=f,Xo(f,"main",[[t,"pointerdown","start","passive"],[t,"click","start","passive"],[t,"keydown","keystart","passive"],[t,"keyup","keystart","passive"]])},updated(t,s){if(s.oldValue!==s.value){const u=t.__qripple;u!==void 0&&(u.enabled=s.value!==!1,u.enabled===!0&&Object(s.value)===s.value&&f1(u,s))}},beforeUnmount(t){const s=t.__qripple;s!==void 0&&(s.abort.forEach(u=>{u()}),qa(s,"main"),delete t._qripple)}}),pT={left:"start",center:"center",right:"end",between:"between",around:"around",evenly:"evenly",stretch:"stretch"},uP=Object.keys(pT),mT={align:{type:String,validator:t=>uP.includes(t)}};function gT(t){return se(()=>{const s=t.align===void 0?t.vertical===!0?"stretch":"left":t.align;return`${t.vertical===!0?"items":"justify"}-${pT[s]}`})}function jp(t){if(Object(t.$parent)===t.$parent)return t.$parent;let{parent:s}=t.$;for(;Object(s)===s;){if(Object(s.proxy)===s.proxy)return s.proxy;s=s.parent}}function _T(t,s){typeof s.type=="symbol"?Array.isArray(s.children)===!0&&s.children.forEach(u=>{_T(t,u)}):t.add(s)}function hP(t){const s=new Set;return t.forEach(u=>{_T(s,u)}),Array.from(s)}function vv(t){return t.appContext.config.globalProperties.$router!==void 0}function yT(t){return t.isUnmounted===!0||t.isDeactivated===!0}function p1(t){return t?t.aliasOf?t.aliasOf.path:t.path:""}function m1(t,s){return(t.aliasOf||t)===(s.aliasOf||s)}function dP(t,s){for(const u in s){const f=s[u],m=t[u];if(typeof f=="string"){if(f!==m)return!1}else if(Array.isArray(m)===!1||m.length!==f.length||f.some((v,w)=>v!==m[w]))return!1}return!0}function g1(t,s){return Array.isArray(s)===!0?t.length===s.length&&t.every((u,f)=>u===s[f]):t.length===1&&t[0]===s}function fP(t,s){return Array.isArray(t)===!0?g1(t,s):Array.isArray(s)===!0?g1(s,t):t===s}function pP(t,s){if(Object.keys(t).length!==Object.keys(s).length)return!1;for(const u in t)if(fP(t[u],s[u])===!1)return!1;return!0}const vT={to:[String,Object],replace:Boolean,exact:Boolean,activeClass:{type:String,default:"q-router-link--active"},exactActiveClass:{type:String,default:"q-router-link--exact-active"},href:String,target:String,disable:Boolean};function xT({fallbackTag:t,useDisableForRouterLinkProps:s=!0}={}){const u=Mn(),{props:f,proxy:m,emit:v}=u,w=vv(u),o=se(()=>f.disable!==!0&&f.href!==void 0),S=se(s===!0?()=>w===!0&&f.disable!==!0&&o.value!==!0&&f.to!==void 0&&f.to!==null&&f.to!=="":()=>w===!0&&o.value!==!0&&f.to!==void 0&&f.to!==null&&f.to!==""),k=se(()=>S.value===!0?te(f.to):null),I=se(()=>k.value!==null),D=se(()=>o.value===!0||I.value===!0),B=se(()=>f.type==="a"||D.value===!0?"a":f.tag||t||"div"),V=se(()=>o.value===!0?{href:f.href,target:f.target}:I.value===!0?{href:k.value.href,target:f.target}:{}),$=se(()=>{if(I.value===!1)return-1;const{matched:ce}=k.value,{length:fe}=ce,Ee=ce[fe-1];if(Ee===void 0)return-1;const Me=m.$route.matched;if(Me.length===0)return-1;const Ie=Me.findIndex(m1.bind(null,Ee));if(Ie>-1)return Ie;const ke=p1(ce[fe-2]);return fe>1&&p1(Ee)===ke&&Me[Me.length-1].path!==ke?Me.findIndex(m1.bind(null,ce[fe-2])):Ie}),ne=se(()=>I.value===!0&&$.value!==-1&&dP(m.$route.params,k.value.params)),oe=se(()=>ne.value===!0&&$.value===m.$route.matched.length-1&&pP(m.$route.params,k.value.params)),ye=se(()=>I.value===!0?oe.value===!0?` ${f.exactActiveClass} ${f.activeClass}`:f.exact===!0?"":ne.value===!0?` ${f.activeClass}`:"":"");function te(ce){try{return m.$router.resolve(ce)}catch{}return null}function Se(ce,{returnRouterError:fe,to:Ee=f.to,replace:Me=f.replace}={}){if(f.disable===!0)return ce.preventDefault(),Promise.resolve(!1);if(ce.metaKey||ce.altKey||ce.ctrlKey||ce.shiftKey||ce.button!==void 0&&ce.button!==0||f.target==="_blank")return Promise.resolve(!1);ce.preventDefault();const Ie=m.$router[Me===!0?"replace":"push"](Ee);return fe===!0?Ie:Ie.then(()=>{}).catch(()=>{})}function Ae(ce){if(I.value===!0){const fe=Ee=>Se(ce,Ee);v("click",ce,fe),ce.defaultPrevented!==!0&&fe()}else v("click",ce)}return{hasRouterLink:I,hasHrefLink:o,hasLink:D,linkTag:B,resolvedLink:k,linkIsActive:ne,linkIsExactActive:oe,linkClass:ye,linkAttrs:V,getLink:te,navigateToRouterLink:Se,navigateOnClick:Ae}}const _1={none:0,xs:4,sm:8,md:16,lg:24,xl:32},mP={xs:8,sm:10,md:14,lg:20,xl:24},gP=["button","submit","reset"],_P=/[^\s]\/[^\s]/,yP=["flat","outline","push","unelevated"],vP=(t,s)=>t.flat===!0?"flat":t.outline===!0?"outline":t.push===!0?"push":t.unelevated===!0?"unelevated":s,xP={...Fu,...vT,type:{type:String,default:"button"},label:[Number,String],icon:String,iconRight:String,...yP.reduce((t,s)=>(t[s]=Boolean)&&t,{}),square:Boolean,round:Boolean,rounded:Boolean,glossy:Boolean,size:String,fab:Boolean,fabMini:Boolean,padding:String,color:String,textColor:String,noCaps:Boolean,noWrap:Boolean,dense:Boolean,tabindex:[Number,String],ripple:{type:[Boolean,Object],default:!0},align:{...mT.align,default:"center"},stack:Boolean,stretch:Boolean,loading:{type:Boolean,default:null},disable:Boolean};function bP(t){const s=Nu(t,mP),u=gT(t),{hasRouterLink:f,hasLink:m,linkTag:v,linkAttrs:w,navigateOnClick:o}=xT({fallbackTag:"button"}),S=se(()=>{const oe=t.fab===!1&&t.fabMini===!1?s.value:{};return t.padding!==void 0?Object.assign({},oe,{padding:t.padding.split(/\s+/).map(ye=>ye in _1?_1[ye]+"px":ye).join(" "),minWidth:"0",minHeight:"0"}):oe}),k=se(()=>t.rounded===!0||t.fab===!0||t.fabMini===!0),I=se(()=>t.disable!==!0&&t.loading!==!0),D=se(()=>I.value===!0?t.tabindex||0:-1),B=se(()=>vP(t,"standard")),V=se(()=>{const oe={tabindex:D.value};return m.value===!0?Object.assign(oe,w.value):gP.includes(t.type)===!0&&(oe.type=t.type),v.value==="a"?(t.disable===!0?oe["aria-disabled"]="true":oe.href===void 0&&(oe.role="button"),f.value!==!0&&_P.test(t.type)===!0&&(oe.type=t.type)):t.disable===!0&&(oe.disabled="",oe["aria-disabled"]="true"),t.loading===!0&&t.percentage!==void 0&&Object.assign(oe,{role:"progressbar","aria-valuemin":0,"aria-valuemax":100,"aria-valuenow":t.percentage}),oe}),$=se(()=>{let oe;t.color!==void 0?t.flat===!0||t.outline===!0?oe=`text-${t.textColor||t.color}`:oe=`bg-${t.color} text-${t.textColor||"white"}`:t.textColor&&(oe=`text-${t.textColor}`);const ye=t.round===!0?"round":`rectangle${k.value===!0?" q-btn--rounded":t.square===!0?" q-btn--square":""}`;return`q-btn--${B.value} q-btn--${ye}`+(oe!==void 0?" "+oe:"")+(I.value===!0?" q-btn--actionable q-focusable q-hoverable":t.disable===!0?" disabled":"")+(t.fab===!0?" q-btn--fab":t.fabMini===!0?" q-btn--fab-mini":"")+(t.noCaps===!0?" q-btn--no-uppercase":"")+(t.dense===!0?" q-btn--dense":"")+(t.stretch===!0?" no-border-radius self-stretch":"")+(t.glossy===!0?" glossy":"")+(t.square?" q-btn--square":"")}),ne=se(()=>u.value+(t.stack===!0?" column":" row")+(t.noWrap===!0?" no-wrap text-no-wrap":"")+(t.loading===!0?" q-btn__content--hidden":""));return{classes:$,style:S,innerClasses:ne,attributes:V,hasLink:m,linkTag:v,navigateOnClick:o,isActionable:I}}const{passiveCapture:Mo}=Xi;let ou=null,su=null,au=null;const Ci=Vn({name:"QBtn",props:{...xP,percentage:Number,darkPercentage:Boolean,onTouchstart:[Function,Array]},emits:["click","keydown","mousedown","keyup"],setup(t,{slots:s,emit:u}){const{proxy:f}=Mn(),{classes:m,style:v,innerClasses:w,attributes:o,hasLink:S,linkTag:k,navigateOnClick:I,isActionable:D}=bP(t),B=xt(null),V=xt(null);let $=null,ne,oe;const ye=se(()=>t.label!==void 0&&t.label!==null&&t.label!==""),te=se(()=>t.disable===!0||t.ripple===!1?!1:{keyCodes:S.value===!0?[13,32]:[13],...t.ripple===!0?{}:t.ripple}),Se=se(()=>({center:t.round})),Ae=se(()=>{const Ye=Math.max(0,Math.min(100,t.percentage));return Ye>0?{transition:"transform 0.6s",transform:`translateX(${Ye-100}%)`}:{}}),ce=se(()=>{if(t.loading===!0)return{onMousedown:Ze,onTouchstart:Ze,onClick:Ze,onKeydown:Ze,onKeyup:Ze};if(D.value===!0){const Ye={onClick:Ee,onKeydown:Me,onMousedown:ke};if(f.$q.platform.has.touch===!0){const lt=t.onTouchstart!==void 0?"":"Passive";Ye[`onTouchstart${lt}`]=Ie}return Ye}return{onClick:zi}}),fe=se(()=>({ref:B,class:"q-btn q-btn-item non-selectable no-outline "+m.value,style:v.value,...o.value,...ce.value}));function Ee(Ye){if(B.value!==null){if(Ye!==void 0){if(Ye.defaultPrevented===!0)return;const lt=document.activeElement;if(t.type==="submit"&&lt!==document.body&&B.value.contains(lt)===!1&&lt.contains(B.value)===!1){B.value.focus();const Xt=()=>{document.removeEventListener("keydown",zi,!0),document.removeEventListener("keyup",Xt,Mo),B.value!==null&&B.value.removeEventListener("blur",Xt,Mo)};document.addEventListener("keydown",zi,!0),document.addEventListener("keyup",Xt,Mo),B.value.addEventListener("blur",Xt,Mo)}}I(Ye)}}function Me(Ye){B.value!==null&&(u("keydown",Ye),$a(Ye,[13,32])===!0&&su!==B.value&&(su!==null&&Re(),Ye.defaultPrevented!==!0&&(B.value.focus(),su=B.value,B.value.classList.add("q-btn--active"),document.addEventListener("keyup",Be,!0),B.value.addEventListener("blur",Be,Mo)),zi(Ye)))}function Ie(Ye){B.value!==null&&(u("touchstart",Ye),Ye.defaultPrevented!==!0&&(ou!==B.value&&(ou!==null&&Re(),ou=B.value,$=Ye.target,$.addEventListener("touchcancel",Be,Mo),$.addEventListener("touchend",Be,Mo)),ne=!0,clearTimeout(oe),oe=setTimeout(()=>{ne=!1},200)))}function ke(Ye){B.value!==null&&(Ye.qSkipRipple=ne===!0,u("mousedown",Ye),Ye.defaultPrevented!==!0&&au!==B.value&&(au!==null&&Re(),au=B.value,B.value.classList.add("q-btn--active"),document.addEventListener("mouseup",Be,Mo)))}function Be(Ye){if(B.value!==null&&!(Ye!==void 0&&Ye.type==="blur"&&document.activeElement===B.value)){if(Ye!==void 0&&Ye.type==="keyup"){if(su===B.value&&$a(Ye,[13,32])===!0){const lt=new MouseEvent("click",Ye);lt.qKeyEvent=!0,Ye.defaultPrevented===!0&&Fr(lt),Ye.cancelBubble===!0&&to(lt),B.value.dispatchEvent(lt),zi(Ye),Ye.qKeyEvent=!0}u("keyup",Ye)}Re()}}function Re(Ye){const lt=V.value;Ye!==!0&&(ou===B.value||au===B.value)&&lt!==null&&lt!==document.activeElement&&(lt.setAttribute("tabindex",-1),lt.focus()),ou===B.value&&($!==null&&($.removeEventListener("touchcancel",Be,Mo),$.removeEventListener("touchend",Be,Mo)),ou=$=null),au===B.value&&(document.removeEventListener("mouseup",Be,Mo),au=null),su===B.value&&(document.removeEventListener("keyup",Be,!0),B.value!==null&&B.value.removeEventListener("blur",Be,Mo),su=null),B.value!==null&&B.value.classList.remove("q-btn--active")}function Ze(Ye){zi(Ye),Ye.qSkipRipple=!0}return Ii(()=>{Re(!0)}),Object.assign(f,{click:Ee}),()=>{let Ye=[];t.icon!==void 0&&Ye.push(pe(Hr,{name:t.icon,left:t.stack===!1&&ye.value===!0,role:"img","aria-hidden":"true"})),ye.value===!0&&Ye.push(pe("span",{class:"block"},[t.label])),Ye=Po(s.default,Ye),t.iconRight!==void 0&&t.round===!1&&Ye.push(pe(Hr,{name:t.iconRight,right:t.stack===!1&&ye.value===!0,role:"img","aria-hidden":"true"}));const lt=[pe("span",{class:"q-focus-helper",ref:V})];return t.loading===!0&&t.percentage!==void 0&&lt.push(pe("span",{class:"q-btn__progress absolute-full overflow-hidden"+(t.darkPercentage===!0?" q-btn__progress--dark":"")},[pe("span",{class:"q-btn__progress-indicator fit block",style:Ae.value})])),lt.push(pe("span",{class:"q-btn__content text-center col items-center q-anchor--skip "+w.value},Ye)),t.loading!==null&&lt.push(pe(Ys,{name:"q-transition--fade"},()=>t.loading===!0?[pe("span",{key:"loading",class:"absolute-full flex flex-center"},s.loading!==void 0?s.loading():[pe(Gm)])]:null)),Xl(pe(k.value,fe.value,lt),[[fT,te.value,void 0,Se.value]])}}});let wP=document.body;function bT(t){const s=document.createElement("div");if(t!==void 0&&(s.id=t),cm.globalNodes!==void 0){const u=cm.globalNodes.class;u!==void 0&&(s.className=u)}return wP.appendChild(s),s}function EP(t){t.remove()}let TP=0;const $p={},Gp={},Go={},wT={},SP=/^\s*$/,ET=[],xv=["top-left","top-right","bottom-left","bottom-right","top","bottom","left","right","center"],CP=["top-left","top-right","bottom-left","bottom-right"],du={positive:{icon:t=>t.iconSet.type.positive,color:"positive"},negative:{icon:t=>t.iconSet.type.negative,color:"negative"},warning:{icon:t=>t.iconSet.type.warning,color:"warning",textColor:"dark"},info:{icon:t=>t.iconSet.type.info,color:"info"},ongoing:{group:!1,timeout:0,spinner:!0,color:"grey-8"}};function TT(t,s,u){if(!t)return ud("parameter required");let f;const m={textColor:"white"};if(t.ignoreDefaults!==!0&&Object.assign(m,$p),Mu(t)===!1&&(m.type&&Object.assign(m,du[m.type]),t={message:t}),Object.assign(m,du[t.type||m.type],t),typeof m.icon=="function"&&(m.icon=m.icon(s)),m.spinner?(m.spinner===!0&&(m.spinner=Gm),m.spinner=Xs(m.spinner)):m.spinner=!1,m.meta={hasMedia:Boolean(m.spinner!==!1||m.icon||m.avatar),hasText:y1(m.message)||y1(m.caption)},m.position){if(xv.includes(m.position)===!1)return ud("wrong position",t)}else m.position="bottom";if(m.timeout===void 0)m.timeout=5e3;else{const S=parseInt(m.timeout,10);if(isNaN(S)||S<0)return ud("wrong timeout",t);m.timeout=S}m.timeout===0?m.progress=!1:m.progress===!0&&(m.meta.progressClass="q-notification__progress"+(m.progressClass?` ${m.progressClass}`:""),m.meta.progressStyle={animationDuration:`${m.timeout+1e3}ms`});const v=(Array.isArray(t.actions)===!0?t.actions:[]).concat(t.ignoreDefaults!==!0&&Array.isArray($p.actions)===!0?$p.actions:[]).concat(du[t.type]!==void 0&&Array.isArray(du[t.type].actions)===!0?du[t.type].actions:[]),{closeBtn:w}=m;if(w&&v.push({label:typeof w=="string"?w:s.lang.label.close}),m.actions=v.map(({handler:S,noDismiss:k,...I})=>({flat:!0,...I,onClick:typeof S=="function"?()=>{S(),k!==!0&&o()}:()=>{o()}})),m.multiLine===void 0&&(m.multiLine=m.actions.length>1),Object.assign(m.meta,{class:`q-notification row items-stretch q-notification--${m.multiLine===!0?"multi-line":"standard"}`+(m.color!==void 0?` bg-${m.color}`:"")+(m.textColor!==void 0?` text-${m.textColor}`:"")+(m.classes!==void 0?` ${m.classes}`:""),wrapperClass:"q-notification__wrapper col relative-position border-radius-inherit "+(m.multiLine===!0?"column no-wrap justify-center":"row items-center"),contentClass:"q-notification__content row items-center"+(m.multiLine===!0?"":" col"),leftClass:m.meta.hasText===!0?"additional":"single",attrs:{role:"alert",...m.attrs}}),m.group===!1?(m.group=void 0,m.meta.group=void 0):((m.group===void 0||m.group===!0)&&(m.group=[m.message,m.caption,m.multiline].concat(m.actions.map(S=>`${S.label}*${S.icon}`)).join("|")),m.meta.group=m.group+"|"+m.position),m.actions.length===0?m.actions=void 0:m.meta.actionsClass="q-notification__actions row items-center "+(m.multiLine===!0?"justify-end":"col-auto")+(m.meta.hasMedia===!0?" q-notification__actions--with-media":""),u!==void 0){clearTimeout(u.notif.meta.timer),m.meta.uid=u.notif.meta.uid;const S=Go[m.position].value.indexOf(u.notif);Go[m.position].value[S]=m}else{const S=Gp[m.meta.group];if(S===void 0){if(m.meta.uid=TP++,m.meta.badge=1,["left","right","center"].indexOf(m.position)!==-1)Go[m.position].value.splice(Math.floor(Go[m.position].value.length/2),0,m);else{const k=m.position.indexOf("top")>-1?"unshift":"push";Go[m.position].value[k](m)}m.group!==void 0&&(Gp[m.meta.group]=m)}else{if(clearTimeout(S.meta.timer),m.badgePosition!==void 0){if(CP.includes(m.badgePosition)===!1)return ud("wrong badgePosition",t)}else m.badgePosition=`top-${m.position.indexOf("left")>-1?"right":"left"}`;m.meta.uid=S.meta.uid,m.meta.badge=S.meta.badge+1,m.meta.badgeClass=`q-notification__badge q-notification__badge--${m.badgePosition}`+(m.badgeColor!==void 0?` bg-${m.badgeColor}`:"")+(m.badgeTextColor!==void 0?` text-${m.badgeTextColor}`:"")+(m.badgeClass?` ${m.badgeClass}`:"");const k=Go[m.position].value.indexOf(S);Go[m.position].value[k]=Gp[m.meta.group]=m}}const o=()=>{AP(m),f=void 0};if(m.timeout>0&&(m.meta.timer=setTimeout(()=>{o()},m.timeout+1e3)),m.group!==void 0)return S=>{S!==void 0?ud("trying to update a grouped one which is forbidden",t):o()};if(f={dismiss:o,config:t,notif:m},u!==void 0){Object.assign(u,f);return}return S=>{if(f!==void 0)if(S===void 0)f.dismiss();else{const k=Object.assign({},f.config,S,{group:!1,position:m.position});TT(k,s,f)}}}function AP(t){clearTimeout(t.meta.timer);const s=Go[t.position].value.indexOf(t);if(s!==-1){t.group!==void 0&&delete Gp[t.meta.group];const u=ET[""+t.meta.uid];if(u){const{width:f,height:m}=getComputedStyle(u);u.style.left=`${u.offsetLeft}px`,u.style.width=f,u.style.height=m}Go[t.position].value.splice(s,1),typeof t.onDismiss=="function"&&t.onDismiss()}}function y1(t){return t!=null&&SP.test(t)!==!0}function ud(t,s){return console.error(`Notify: ${t}`,s),!1}function MP(){return Vn({name:"QNotifications",devtools:{hide:!0},setup(){return()=>pe("div",{class:"q-notifications"},xv.map(t=>pe(pk,{key:t,class:wT[t],tag:"div",name:`q-notification--${t}`},()=>Go[t].value.map(s=>{const u=s.meta,f=[];if(u.hasMedia===!0&&(s.spinner!==!1?f.push(pe(s.spinner,{class:"q-notification__spinner q-notification__spinner--"+u.leftClass,color:s.spinnerColor,size:s.spinnerSize})):s.icon?f.push(pe(Hr,{class:"q-notification__icon q-notification__icon--"+u.leftClass,name:s.icon,color:s.iconColor,size:s.iconSize,role:"img"})):s.avatar&&f.push(pe(Ed,{class:"q-notification__avatar q-notification__avatar--"+u.leftClass},()=>pe("img",{src:s.avatar,"aria-hidden":"true"})))),u.hasText===!0){let v;const w={class:"q-notification__message col"};if(s.html===!0)w.innerHTML=s.caption?`<div>${s.message}</div><div class="q-notification__caption">${s.caption}</div>`:s.message;else{const o=[s.message];v=s.caption?[pe("div",o),pe("div",{class:"q-notification__caption"},[s.caption])]:o}f.push(pe("div",w,v))}const m=[pe("div",{class:u.contentClass},f)];return s.progress===!0&&m.push(pe("div",{key:`${u.uid}|p|${u.badge}`,class:u.progressClass,style:u.progressStyle})),s.actions!==void 0&&m.push(pe("div",{class:u.actionsClass},s.actions.map(v=>pe(Ci,v)))),u.badge>1&&m.push(pe("div",{key:`${u.uid}|${u.badge}`,class:s.meta.badgeClass,style:s.badgeStyle},[u.badge])),pe("div",{ref:v=>{ET[""+u.uid]=v},key:u.uid,class:u.class,...u.attrs},[pe("div",{class:u.wrapperClass},m)])}))))}})}const IP={setDefaults(t){Mu(t)===!0&&Object.assign($p,t)},registerType(t,s){Mu(s)===!0&&(du[t]=s)},install({$q:t,parentApp:s}){if(t.notify=this.create=u=>TT(u,t),t.notify.setDefaults=this.setDefaults,t.notify.registerType=this.registerType,t.config.notify!==void 0&&this.setDefaults(t.config.notify),this.__installed!==!0){xv.forEach(f=>{Go[f]=xt([]);const m=["left","center","right"].includes(f)===!0?"center":f.indexOf("top")>-1?"top":"bottom",v=f.indexOf("left")>-1?"start":f.indexOf("right")>-1?"end":"center",w=["left","right"].includes(f)?`items-${f==="left"?"start":"end"} justify-center`:f==="center"?"flex-center":`items-${v}`;wT[f]=`q-notifications__list q-notifications__list--${m} fixed column no-wrap ${w}`});const u=bT("q-notify");jk(MP(),s).mount(u)}}};const kP=Vn({name:"QToolbarTitle",props:{shrink:Boolean},setup(t,{slots:s}){const u=se(()=>"q-toolbar__title ellipsis"+(t.shrink===!0?" col-shrink":""));return()=>pe("div",{class:u.value},bi(s.default))}}),no={dark:{type:Boolean,default:null}};function io(t,s){return se(()=>t.dark===null?s.dark.isActive:t.dark)}const ST=Vn({name:"QList",props:{...no,bordered:Boolean,dense:Boolean,separator:Boolean,padding:Boolean},setup(t,{slots:s}){const u=Mn(),f=io(t,u.proxy.$q),m=se(()=>"q-list"+(t.bordered===!0?" q-list--bordered":"")+(t.dense===!0?" q-list--dense":"")+(t.separator===!0?" q-list--separator":"")+(f.value===!0?" q-list--dark":"")+(t.padding===!0?" q-list--padding":""));return()=>pe("div",{class:m.value,role:"list"},bi(s.default))}});function bv(){if(window.getSelection!==void 0){const t=window.getSelection();t.empty!==void 0?t.empty():t.removeAllRanges!==void 0&&(t.removeAllRanges(),am.is.mobile!==!0&&t.addRange(document.createRange()))}else document.selection!==void 0&&document.selection.empty()}const PP={target:{default:!0},noParentEvent:Boolean,contextMenu:Boolean};function zP({showing:t,avoidEmit:s,configureAnchorEl:u}){const{props:f,proxy:m,emit:v}=Mn(),w=xt(null);let o;function S(V){return w.value===null?!1:V===void 0||V.touches===void 0||V.touches.length<=1}const k={};u===void 0&&(Object.assign(k,{hide(V){m.hide(V)},toggle(V){m.toggle(V),V.qAnchorHandled=!0},toggleKey(V){$a(V,13)===!0&&k.toggle(V)},contextClick(V){m.hide(V),Fr(V),ui(()=>{m.show(V),V.qAnchorHandled=!0})},prevent:Fr,mobileTouch(V){if(k.mobileCleanup(V),S(V)!==!0)return;m.hide(V),w.value.classList.add("non-selectable");const $=V.target;Xo(k,"anchor",[[$,"touchmove","mobileCleanup","passive"],[$,"touchend","mobileCleanup","passive"],[$,"touchcancel","mobileCleanup","passive"],[w.value,"contextmenu","prevent","notPassive"]]),o=setTimeout(()=>{m.show(V),V.qAnchorHandled=!0},300)},mobileCleanup(V){w.value.classList.remove("non-selectable"),clearTimeout(o),t.value===!0&&V!==void 0&&bv()}}),u=function(V=f.contextMenu){if(f.noParentEvent===!0||w.value===null)return;let $;V===!0?m.$q.platform.is.mobile===!0?$=[[w.value,"touchstart","mobileTouch","passive"]]:$=[[w.value,"mousedown","hide","passive"],[w.value,"contextmenu","contextClick","notPassive"]]:$=[[w.value,"click","toggle","passive"],[w.value,"keyup","toggleKey","passive"]],Xo(k,"anchor",$)});function I(){qa(k,"anchor")}function D(V){for(w.value=V;w.value.classList.contains("q-anchor--skip");)w.value=w.value.parentNode;u()}function B(){if(f.target===!1||f.target===""||m.$el.parentNode===null)w.value=null;else if(f.target===!0)D(m.$el.parentNode);else{let V=f.target;if(typeof f.target=="string")try{V=document.querySelector(f.target)}catch{V=void 0}V!=null?(w.value=V.$el||V,u()):(w.value=null,console.error(`Anchor: target "${f.target}" not found`))}}return Wt(()=>f.contextMenu,V=>{w.value!==null&&(I(),u(V))}),Wt(()=>f.target,()=>{w.value!==null&&I(),B()}),Wt(()=>f.noParentEvent,V=>{w.value!==null&&(V===!0?I():u())}),Ui(()=>{B(),s!==!0&&f.modelValue===!0&&w.value===null&&v("update:modelValue",!1)}),Ii(()=>{clearTimeout(o),I()}),{anchorEl:w,canShow:S,anchorEvents:k}}function LP(t,s){const u=xt(null);let f;function m(o,S){const k=`${S!==void 0?"add":"remove"}EventListener`,I=S!==void 0?S:f;o!==window&&o[k]("scroll",I,Xi.passive),window[k]("scroll",I,Xi.passive),f=S}function v(){u.value!==null&&(m(u.value),u.value=null)}const w=Wt(()=>t.noParentEvent,()=>{u.value!==null&&(v(),s())});return Ii(w),{localScrollTarget:u,unconfigureScrollTarget:v,changeScrollEvent:m}}const wv={modelValue:{type:Boolean,default:null},"onUpdate:modelValue":[Function,Array]},Ev=["before-show","show","before-hide","hide"];function Tv({showing:t,canShow:s,hideOnRouteChange:u,handleShow:f,handleHide:m,processOnMount:v}){const w=Mn(),{props:o,emit:S,proxy:k}=w;let I;function D(te){t.value===!0?$(te):B(te)}function B(te){if(o.disable===!0||te!==void 0&&te.qAnchorHandled===!0||s!==void 0&&s(te)!==!0)return;const Se=o["onUpdate:modelValue"]!==void 0;Se===!0&&(S("update:modelValue",!0),I=te,ui(()=>{I===te&&(I=void 0)})),(o.modelValue===null||Se===!1)&&V(te)}function V(te){t.value!==!0&&(t.value=!0,S("before-show",te),f!==void 0?f(te):S("show",te))}function $(te){if(o.disable===!0)return;const Se=o["onUpdate:modelValue"]!==void 0;Se===!0&&(S("update:modelValue",!1),I=te,ui(()=>{I===te&&(I=void 0)})),(o.modelValue===null||Se===!1)&&ne(te)}function ne(te){t.value!==!1&&(t.value=!1,S("before-hide",te),m!==void 0?m(te):S("hide",te))}function oe(te){o.disable===!0&&te===!0?o["onUpdate:modelValue"]!==void 0&&S("update:modelValue",!1):te===!0!==t.value&&(te===!0?V:ne)(I)}Wt(()=>o.modelValue,oe),u!==void 0&&vv(w)===!0&&Wt(()=>k.$route.fullPath,()=>{u.value===!0&&t.value===!0&&$()}),v===!0&&Ui(()=>{oe(o.modelValue)});const ye={show:B,hide:$,toggle:D};return Object.assign(k,ye),ye}let Zl=[],Bd=[];function CT(t){Bd=Bd.filter(s=>s!==t)}function RP(t){CT(t),Bd.push(t)}function v1(t){CT(t),Bd.length===0&&Zl.length>0&&(Zl[Zl.length-1](),Zl=[])}function Zm(t){Bd.length===0?t():Zl.push(t)}function DP(t){Zl=Zl.filter(s=>s!==t)}const vu=[];function OP(t){return vu.find(s=>s.__qPortalInnerRef.value!==null&&s.__qPortalInnerRef.value.contains(t))}function AT(t,s){do{if(t.$options.name==="QMenu"){if(t.hide(s),t.$props.separateClosePopup===!0)return jp(t)}else if(t.__qPortalInnerRef!==void 0){const u=jp(t);return u!==void 0&&u.$options.name==="QPopupProxy"?(t.hide(s),u):t}t=jp(t)}while(t!=null)}function BP(t,s,u){for(;u!==0&&t!==void 0&&t!==null;){if(t.__qPortalInnerRef!==void 0){if(u--,t.$options.name==="QMenu"){t=AT(t,s);continue}t.hide(s)}t=jp(t)}}function FP(t){for(t=t.parent;t!=null;){if(t.type.name==="QGlobalDialog")return!0;if(t.type.name==="QDialog"||t.type.name==="QMenu")return!1;t=t.parent}return!1}function MT(t,s,u,f){const m=xt(!1),v=xt(!1);let w=null;const o={},S=f===!0&&FP(t);function k(D){if(D===!0){v1(o),v.value=!0;return}v.value=!1,m.value===!1&&(S===!1&&w===null&&(w=bT()),m.value=!0,vu.push(t.proxy),RP(o))}function I(D){if(v.value=!1,D!==!0)return;v1(o),m.value=!1;const B=vu.indexOf(t.proxy);B!==-1&&vu.splice(B,1),w!==null&&(EP(w),w=null)}return ea(()=>{I(!0)}),t.proxy.__qPortalInnerRef=s,{showPortal:k,hidePortal:I,portalIsActive:m,portalIsAccessible:v,renderPortal:()=>S===!0?u():m.value===!0?[pe(LI,{to:w},u())]:void 0}}const IT={transitionShow:{type:String,default:"fade"},transitionHide:{type:String,default:"fade"},transitionDuration:{type:[String,Number],default:300}};function NP(t,s){const u=xt(s.value);return Wt(s,f=>{ui(()=>{u.value=f})}),{transition:se(()=>"q-transition--"+(u.value===!0?t.transitionHide:t.transitionShow)),transitionStyle:se(()=>`--q-transition-duration: ${t.transitionDuration}ms`)}}function kT(){let t;const s=Mn();function u(){t=void 0}return Bu(u),Ii(u),{removeTick:u,registerTick(f){t=f,ui(()=>{t===f&&(yT(s)===!1&&t(),t=void 0)})}}}function Sv(){let t;const s=Mn();function u(){clearTimeout(t)}return Bu(u),Ii(u),{removeTimeout:u,registerTimeout(f,m){clearTimeout(t),yT(s)===!1&&(t=setTimeout(f,m))}}}const VP=[null,document,document.body,document.scrollingElement,document.documentElement];function Cv(t,s){let u=lP(s);if(u===void 0){if(t==null)return window;u=t.closest(".scroll,.scroll-y,.overflow-auto")}return VP.includes(u)?window:u}function PT(t){return t===window?window.pageYOffset||window.scrollY||document.body.scrollTop||0:t.scrollTop}function zT(t){return t===window?window.pageXOffset||window.scrollX||document.body.scrollLeft||0:t.scrollLeft}let Pp;function Zp(){if(Pp!==void 0)return Pp;const t=document.createElement("p"),s=document.createElement("div");Ay(t,{width:"100%",height:"200px"}),Ay(s,{position:"absolute",top:"0px",left:"0px",visibility:"hidden",width:"200px",height:"150px",overflow:"hidden"}),s.appendChild(t),document.body.appendChild(s);const u=t.offsetWidth;s.style.overflow="scroll";let f=t.offsetWidth;return u===f&&(f=s.clientWidth),s.remove(),Pp=u-f,Pp}function UP(t,s=!0){return!t||t.nodeType!==Node.ELEMENT_NODE?!1:s?t.scrollHeight>t.clientHeight&&(t.classList.contains("scroll")||t.classList.contains("overflow-auto")||["auto","scroll"].includes(window.getComputedStyle(t)["overflow-y"])):t.scrollWidth>t.clientWidth&&(t.classList.contains("scroll")||t.classList.contains("overflow-auto")||["auto","scroll"].includes(window.getComputedStyle(t)["overflow-x"]))}const Yl=[];let Iu;function qP(t){Iu=t.keyCode===27}function jP(){Iu===!0&&(Iu=!1)}function $P(t){Iu===!0&&(Iu=!1,$a(t,27)===!0&&Yl[Yl.length-1](t))}function LT(t){window[t]("keydown",qP),window[t]("blur",jP),window[t]("keyup",$P),Iu=!1}function RT(t){hi.is.desktop===!0&&(Yl.push(t),Yl.length===1&&LT("addEventListener"))}function dm(t){const s=Yl.indexOf(t);s>-1&&(Yl.splice(s,1),Yl.length===0&&LT("removeEventListener"))}const Ql=[];function DT(t){Ql[Ql.length-1](t)}function OT(t){hi.is.desktop===!0&&(Ql.push(t),Ql.length===1&&document.body.addEventListener("focusin",DT))}function My(t){const s=Ql.indexOf(t);s>-1&&(Ql.splice(s,1),Ql.length===0&&document.body.removeEventListener("focusin",DT))}let BT;const{notPassiveCapture:fm}=Xi,Jl=[];function pm(t){clearTimeout(BT);const s=t.target;if(s===void 0||s.nodeType===8||s.classList.contains("no-pointer-events")===!0)return;let u=vu.length-1;for(;u>=0;){const f=vu[u].$;if(f.type.name!=="QDialog")break;if(f.props.seamless!==!0)return;u--}for(let f=Jl.length-1;f>=0;f--){const m=Jl[f];if((m.anchorEl.value===null||m.anchorEl.value.contains(s)===!1)&&(s===document.body||m.innerRef.value!==null&&m.innerRef.value.contains(s)===!1))t.qClickOutside=!0,m.onClickOutside(t);else return}}function GP(t){Jl.push(t),Jl.length===1&&(document.addEventListener("mousedown",pm,fm),document.addEventListener("touchstart",pm,fm))}function x1(t){const s=Jl.findIndex(u=>u===t);s>-1&&(Jl.splice(s,1),Jl.length===0&&(clearTimeout(BT),document.removeEventListener("mousedown",pm,fm),document.removeEventListener("touchstart",pm,fm)))}let b1,w1;function E1(t){const s=t.split(" ");return s.length!==2?!1:["top","center","bottom"].includes(s[0])!==!0?(console.error("Anchor/Self position must start with one of top/center/bottom"),!1):["left","middle","right","start","end"].includes(s[1])!==!0?(console.error("Anchor/Self position must end with one of left/middle/right/start/end"),!1):!0}function ZP(t){return t?!(t.length!==2||typeof t[0]!="number"||typeof t[1]!="number"):!0}const Iy={"start#ltr":"left","start#rtl":"right","end#ltr":"right","end#rtl":"left"};["left","middle","right"].forEach(t=>{Iy[`${t}#ltr`]=t,Iy[`${t}#rtl`]=t});function T1(t,s){const u=t.split(" ");return{vertical:u[0],horizontal:Iy[`${u[1]}#${s===!0?"rtl":"ltr"}`]}}function HP(t,s){let{top:u,left:f,right:m,bottom:v,width:w,height:o}=t.getBoundingClientRect();return s!==void 0&&(u-=s[1],f-=s[0],v+=s[1],m+=s[0],w+=s[0],o+=s[1]),{top:u,left:f,right:m,bottom:v,width:w,height:o,middle:f+(m-f)/2,center:u+(v-u)/2}}function WP(t){return{top:0,center:t.offsetHeight/2,bottom:t.offsetHeight,left:0,middle:t.offsetWidth/2,right:t.offsetWidth}}function XP(t){if(hi.is.ios===!0&&window.visualViewport!==void 0){const o=document.body.style,{offsetLeft:S,offsetTop:k}=window.visualViewport;S!==b1&&(o.setProperty("--q-pe-left",S+"px"),b1=S),k!==w1&&(o.setProperty("--q-pe-top",k+"px"),w1=k)}let s;const{scrollLeft:u,scrollTop:f}=t.el;if(t.absoluteOffset===void 0)s=HP(t.anchorEl,t.cover===!0?[0,0]:t.offset);else{const{top:o,left:S}=t.anchorEl.getBoundingClientRect(),k=o+t.absoluteOffset.top,I=S+t.absoluteOffset.left;s={top:k,left:I,width:1,height:1,right:I+1,center:k,middle:I,bottom:k+1}}let m={maxHeight:t.maxHeight,maxWidth:t.maxWidth,visibility:"visible"};(t.fit===!0||t.cover===!0)&&(m.minWidth=s.width+"px",t.cover===!0&&(m.minHeight=s.height+"px")),Object.assign(t.el.style,m);const v=WP(t.el),w={top:s[t.anchorOrigin.vertical]-v[t.selfOrigin.vertical],left:s[t.anchorOrigin.horizontal]-v[t.selfOrigin.horizontal]};KP(w,s,v,t.anchorOrigin,t.selfOrigin),m={top:w.top+"px",left:w.left+"px"},w.maxHeight!==void 0&&(m.maxHeight=w.maxHeight+"px",s.height>w.maxHeight&&(m.minHeight=m.maxHeight)),w.maxWidth!==void 0&&(m.maxWidth=w.maxWidth+"px",s.width>w.maxWidth&&(m.minWidth=m.maxWidth)),Object.assign(t.el.style,m),t.el.scrollTop!==f&&(t.el.scrollTop=f),t.el.scrollLeft!==u&&(t.el.scrollLeft=u)}function KP(t,s,u,f,m){const v=u.bottom,w=u.right,o=Zp(),S=window.innerHeight-o,k=document.body.clientWidth;if(t.top<0||t.top+v>S)if(m.vertical==="center")t.top=s[f.vertical]>S/2?Math.max(0,S-v):0,t.maxHeight=Math.min(v,S);else if(s[f.vertical]>S/2){const I=Math.min(S,f.vertical==="center"?s.center:f.vertical===m.vertical?s.bottom:s.top);t.maxHeight=Math.min(v,I),t.top=Math.max(0,I-v)}else t.top=Math.max(0,f.vertical==="center"?s.center:f.vertical===m.vertical?s.top:s.bottom),t.maxHeight=Math.min(v,S-t.top);if(t.left<0||t.left+w>k)if(t.maxWidth=Math.min(w,k),m.horizontal==="middle")t.left=s[f.horizontal]>k/2?Math.max(0,k-w):0;else if(s[f.horizontal]>k/2){const I=Math.min(k,f.horizontal==="middle"?s.middle:f.horizontal===m.horizontal?s.right:s.left);t.maxWidth=Math.min(w,I),t.left=Math.max(0,I-t.maxWidth)}else t.left=Math.max(0,f.horizontal==="middle"?s.middle:f.horizontal===m.horizontal?s.left:s.right),t.maxWidth=Math.min(w,k-t.left)}const FT=Vn({name:"QMenu",inheritAttrs:!1,props:{...PP,...wv,...no,...IT,persistent:Boolean,autoClose:Boolean,separateClosePopup:Boolean,noRouteDismiss:Boolean,noRefocus:Boolean,noFocus:Boolean,fit:Boolean,cover:Boolean,square:Boolean,anchor:{type:String,validator:E1},self:{type:String,validator:E1},offset:{type:Array,validator:ZP},scrollTarget:{default:void 0},touchPosition:Boolean,maxHeight:{type:String,default:null},maxWidth:{type:String,default:null}},emits:[...Ev,"click","escape-key"],setup(t,{slots:s,emit:u,attrs:f}){let m=null,v,w,o;const S=Mn(),{proxy:k}=S,{$q:I}=k,D=xt(null),B=xt(!1),V=se(()=>t.persistent!==!0&&t.noRouteDismiss!==!0),$=io(t,I),{registerTick:ne,removeTick:oe}=kT(),{registerTimeout:ye}=Sv(),{transition:te,transitionStyle:Se}=NP(t,B),{localScrollTarget:Ae,changeScrollEvent:ce,unconfigureScrollTarget:fe}=LP(t,qt),{anchorEl:Ee,canShow:Me}=zP({showing:B}),{hide:Ie}=Tv({showing:B,canShow:Me,handleShow:Ve,handleHide:mt,hideOnRouteChange:V,processOnMount:!0}),{showPortal:ke,hidePortal:Be,renderPortal:Re}=MT(S,D,_t),Ze={anchorEl:Ee,innerRef:D,onClickOutside(ft){if(t.persistent!==!0&&B.value===!0)return Ie(ft),(ft.type==="touchstart"||ft.target.classList.contains("q-dialog__backdrop"))&&zi(ft),!0}},Ye=se(()=>T1(t.anchor||(t.cover===!0?"center middle":"bottom start"),I.lang.rtl)),lt=se(()=>t.cover===!0?Ye.value:T1(t.self||"top start",I.lang.rtl)),Xt=se(()=>(t.square===!0?" q-menu--square":"")+($.value===!0?" q-menu--dark q-dark":"")),Ge=se(()=>t.autoClose===!0?{onClick:xn}:{}),At=se(()=>B.value===!0&&t.persistent!==!0);Wt(At,ft=>{ft===!0?(RT(gt),GP(Ze)):(dm(gt),x1(Ze))});function tn(){Zm(()=>{let ft=D.value;ft&&ft.contains(document.activeElement)!==!0&&(ft=ft.querySelector("[autofocus], [data-autofocus]")||ft,ft.focus({preventScroll:!0}))})}function Ve(ft){if(m=t.noRefocus===!1?document.activeElement:null,OT(rt),ke(),qt(),v=void 0,ft!==void 0&&(t.touchPosition||t.contextMenu)){const sn=ec(ft);if(sn.left!==void 0){const{top:un,left:re}=Ee.value.getBoundingClientRect();v={left:sn.left-re,top:sn.top-un}}}w===void 0&&(w=Wt(()=>I.screen.width+"|"+I.screen.height+"|"+t.self+"|"+t.anchor+"|"+I.lang.rtl,ot)),t.noFocus!==!0&&document.activeElement.blur(),ne(()=>{ot(),t.noFocus!==!0&&tn()}),ye(()=>{I.platform.is.ios===!0&&(o=t.autoClose,D.value.click()),ot(),ke(!0),u("show",ft)},t.transitionDuration)}function mt(ft){oe(),Be(),Bt(!0),m!==null&&(ft===void 0||ft.qClickOutside!==!0)&&(m.focus(),m=null),ye(()=>{Be(!0),u("hide",ft)},t.transitionDuration)}function Bt(ft){v=void 0,w!==void 0&&(w(),w=void 0),(ft===!0||B.value===!0)&&(My(rt),fe(),x1(Ze),dm(gt)),ft!==!0&&(m=null)}function qt(){(Ee.value!==null||t.scrollTarget!==void 0)&&(Ae.value=Cv(Ee.value,t.scrollTarget),ce(Ae.value,ot))}function xn(ft){o!==!0?(AT(k,ft),u("click",ft)):o=!1}function rt(ft){At.value===!0&&t.noFocus!==!0&&dT(D.value,ft.target)!==!0&&tn()}function gt(ft){u("escape-key"),Ie(ft)}function ot(){const ft=D.value;ft===null||Ee.value===null||XP({el:ft,offset:t.offset,anchorEl:Ee.value,anchorOrigin:Ye.value,selfOrigin:lt.value,absoluteOffset:v,fit:t.fit,cover:t.cover,maxHeight:t.maxHeight,maxWidth:t.maxWidth})}function _t(){return pe(Ys,{name:te.value,appear:!0},()=>B.value===!0?pe("div",{role:"menu",...f,ref:D,tabindex:-1,class:["q-menu q-position-engine scroll"+Xt.value,f.class],style:[f.style,Se.value],...Ge.value},bi(s.default)):null)}return Ii(Bt),Object.assign(k,{focus:tn,updatePosition:ot}),Re}}),YP=["top","middle","bottom"],S1=Vn({name:"QBadge",props:{color:String,textColor:String,floating:Boolean,transparent:Boolean,multiLine:Boolean,outline:Boolean,rounded:Boolean,label:[Number,String],align:{type:String,validator:t=>YP.includes(t)}},setup(t,{slots:s}){const u=se(()=>t.align!==void 0?{verticalAlign:t.align}:null),f=se(()=>{const m=t.outline===!0&&t.color||t.textColor;return`q-badge flex inline items-center no-wrap q-badge--${t.multiLine===!0?"multi":"single"}-line`+(t.outline===!0?" q-badge--outline":t.color!==void 0?` bg-${t.color}`:"")+(m!==void 0?` text-${m}`:"")+(t.floating===!0?" q-badge--floating":"")+(t.rounded===!0?" q-badge--rounded":"")+(t.transparent===!0?" q-badge--transparent":"")});return()=>pe("div",{class:f.value,style:u.value,role:"status","aria-label":t.label},Po(s.default,t.label!==void 0?[t.label]:[]))}}),NT=Vn({name:"QToolbar",props:{inset:Boolean},setup(t,{slots:s}){const u=se(()=>"q-toolbar row no-wrap items-center"+(t.inset===!0?" q-toolbar--inset":""));return()=>pe("div",{class:u.value,role:"toolbar"},bi(s.default))}});function QP(){const t=xt(!ws.value);return t.value===!1&&Ui(()=>{t.value=!0}),t}const VT=typeof ResizeObserver<"u",C1=VT===!0?{}:{style:"display:block;position:absolute;top:0;left:0;right:0;bottom:0;height:100%;width:100%;overflow:hidden;pointer-events:none;z-index:-1;",url:"about:blank"},ky=Vn({name:"QResizeObserver",props:{debounce:{type:[String,Number],default:100}},emits:["resize"],setup(t,{emit:s}){let u=null,f,m={width:-1,height:-1};function v(S){S===!0||t.debounce===0||t.debounce==="0"?w():u===null&&(u=setTimeout(w,t.debounce))}function w(){if(clearTimeout(u),u=null,f){const{offsetWidth:S,offsetHeight:k}=f;(S!==m.width||k!==m.height)&&(m={width:S,height:k},s("resize",m))}}const{proxy:o}=Mn();if(VT===!0){let S;const k=I=>{f=o.$el.parentNode,f?(S=new ResizeObserver(v),S.observe(f),w()):I!==!0&&ui(()=>{k(!0)})};return Ui(()=>{k()}),Ii(()=>{clearTimeout(u),S!==void 0&&(S.disconnect!==void 0?S.disconnect():f&&S.unobserve(f))}),Es}else{let I=function(){clearTimeout(u),k!==void 0&&(k.removeEventListener!==void 0&&k.removeEventListener("resize",v,Xi.passive),k=void 0)},D=function(){I(),f&&f.contentDocument&&(k=f.contentDocument.defaultView,k.addEventListener("resize",v,Xi.passive),w())};const S=QP();let k;return Ui(()=>{ui(()=>{f=o.$el,f&&D()})}),Ii(I),o.trigger=v,()=>{if(S.value===!0)return pe("object",{style:C1.style,tabindex:-1,type:"text/html",data:C1.url,"aria-hidden":"true",onLoad:D})}}}}),JP=Vn({name:"QHeader",props:{modelValue:{type:Boolean,default:!0},reveal:Boolean,revealOffset:{type:Number,default:250},bordered:Boolean,elevated:Boolean,heightHint:{type:[String,Number],default:50}},emits:["reveal","focusin"],setup(t,{slots:s,emit:u}){const{proxy:{$q:f}}=Mn(),m=Vr(qm,Zs);if(m===Zs)return console.error("QHeader needs to be child of QLayout"),Zs;const v=xt(parseInt(t.heightHint,10)),w=xt(!0),o=se(()=>t.reveal===!0||m.view.value.indexOf("H")>-1||f.platform.is.ios&&m.isContainer.value===!0),S=se(()=>{if(t.modelValue!==!0)return 0;if(o.value===!0)return w.value===!0?v.value:0;const te=v.value-m.scroll.value.position;return te>0?te:0}),k=se(()=>t.modelValue!==!0||o.value===!0&&w.value!==!0),I=se(()=>t.modelValue===!0&&k.value===!0&&t.reveal===!0),D=se(()=>"q-header q-layout__section--marginal "+(o.value===!0?"fixed":"absolute")+"-top"+(t.bordered===!0?" q-header--bordered":"")+(k.value===!0?" q-header--hidden":"")+(t.modelValue!==!0?" q-layout--prevent-focus":"")),B=se(()=>{const te=m.rows.value.top,Se={};return te[0]==="l"&&m.left.space===!0&&(Se[f.lang.rtl===!0?"right":"left"]=`${m.left.size}px`),te[2]==="r"&&m.right.space===!0&&(Se[f.lang.rtl===!0?"left":"right"]=`${m.right.size}px`),Se});function V(te,Se){m.update("header",te,Se)}function $(te,Se){te.value!==Se&&(te.value=Se)}function ne({height:te}){$(v,te),V("size",te)}function oe(te){I.value===!0&&$(w,!0),u("focusin",te)}Wt(()=>t.modelValue,te=>{V("space",te),$(w,!0),m.animate()}),Wt(S,te=>{V("offset",te)}),Wt(()=>t.reveal,te=>{te===!1&&$(w,t.modelValue)}),Wt(w,te=>{m.animate(),u("reveal",te)}),Wt(m.scroll,te=>{t.reveal===!0&&$(w,te.direction==="up"||te.position<=t.revealOffset||te.position-te.inflectionPoint<100)});const ye={};return m.instances.header=ye,t.modelValue===!0&&V("size",v.value),V("space",t.modelValue),V("offset",S.value),Ii(()=>{m.instances.header===ye&&(m.instances.header=void 0,V("size",0),V("offset",0),V("space",!1))}),()=>{const te=yv(s.default,[]);return t.elevated===!0&&te.push(pe("div",{class:"q-layout__shadow absolute-full overflow-hidden no-pointer-events"})),te.push(pe(ky,{debounce:0,onResize:ne})),pe("header",{class:D.value,style:B.value,onFocusin:oe},te)}}});function UT(t,s,u){let f;function m(){f!==void 0&&(Od.remove(f),f=void 0)}return Ii(()=>{t.value===!0&&m()}),{removeFromHistory:m,addToHistory(){f={condition:()=>u.value===!0,handler:s},Od.add(f)}}}let hd=0,q_,j_,yd,$_=!1,A1,M1,lu;function ez(t){tz(t)&&zi(t)}function tz(t){if(t.target===document.body||t.target.classList.contains("q-layout__backdrop"))return!0;const s=Mk(t),u=t.shiftKey&&!t.deltaX,f=!u&&Math.abs(t.deltaX)<=Math.abs(t.deltaY),m=u||f?t.deltaY:t.deltaX;for(let v=0;v<s.length;v++){const w=s[v];if(UP(w,f))return f?m<0&&w.scrollTop===0?!0:m>0&&w.scrollTop+w.clientHeight===w.scrollHeight:m<0&&w.scrollLeft===0?!0:m>0&&w.scrollLeft+w.clientWidth===w.scrollWidth}return!0}function I1(t){t.target===document&&(document.scrollingElement.scrollTop=document.scrollingElement.scrollTop)}function zp(t){$_!==!0&&($_=!0,requestAnimationFrame(()=>{$_=!1;const{height:s}=t.target,{clientHeight:u,scrollTop:f}=document.scrollingElement;(yd===void 0||s!==window.innerHeight)&&(yd=u-s,document.scrollingElement.scrollTop=f),f>yd&&(document.scrollingElement.scrollTop-=Math.ceil((f-yd)/8))}))}function k1(t){const s=document.body,u=window.visualViewport!==void 0;if(t==="add"){const{overflowY:f,overflowX:m}=window.getComputedStyle(s);q_=zT(window),j_=PT(window),A1=s.style.left,M1=s.style.top,s.style.left=`-${q_}px`,s.style.top=`-${j_}px`,m!=="hidden"&&(m==="scroll"||s.scrollWidth>window.innerWidth)&&s.classList.add("q-body--force-scrollbar-x"),f!=="hidden"&&(f==="scroll"||s.scrollHeight>window.innerHeight)&&s.classList.add("q-body--force-scrollbar-y"),s.classList.add("q-body--prevent-scroll"),document.qScrollPrevented=!0,hi.is.ios===!0&&(u===!0?(window.scrollTo(0,0),window.visualViewport.addEventListener("resize",zp,Xi.passiveCapture),window.visualViewport.addEventListener("scroll",zp,Xi.passiveCapture),window.scrollTo(0,0)):window.addEventListener("scroll",I1,Xi.passiveCapture))}hi.is.desktop===!0&&hi.is.mac===!0&&window[`${t}EventListener`]("wheel",ez,Xi.notPassive),t==="remove"&&(hi.is.ios===!0&&(u===!0?(window.visualViewport.removeEventListener("resize",zp,Xi.passiveCapture),window.visualViewport.removeEventListener("scroll",zp,Xi.passiveCapture)):window.removeEventListener("scroll",I1,Xi.passiveCapture)),s.classList.remove("q-body--prevent-scroll"),s.classList.remove("q-body--force-scrollbar-x"),s.classList.remove("q-body--force-scrollbar-y"),document.qScrollPrevented=!1,s.style.left=A1,s.style.top=M1,window.scrollTo(q_,j_),yd=void 0)}function nz(t){let s="add";if(t===!0){if(hd++,lu!==void 0){clearTimeout(lu),lu=void 0;return}if(hd>1)return}else{if(hd===0||(hd--,hd>0))return;if(s="remove",hi.is.ios===!0&&hi.is.nativeMobile===!0){clearTimeout(lu),lu=setTimeout(()=>{k1(s),lu=void 0},100);return}}k1(s)}function qT(){let t;return{preventBodyScroll(s){s!==t&&(t!==void 0||s===!0)&&(t=s,nz(s))}}}const Av={left:!0,right:!0,up:!0,down:!0,horizontal:!0,vertical:!0},iz=Object.keys(Av);Av.all=!0;function mm(t){const s={};for(const u of iz)t[u]===!0&&(s[u]=!0);return Object.keys(s).length===0?Av:(s.horizontal===!0?s.left=s.right=!0:s.left===!0&&s.right===!0&&(s.horizontal=!0),s.vertical===!0?s.up=s.down=!0:s.up===!0&&s.down===!0&&(s.vertical=!0),s.horizontal===!0&&s.vertical===!0&&(s.all=!0),s)}function gm(t,s){return s.event===void 0&&t.target!==void 0&&t.target.draggable!==!0&&typeof s.handler=="function"&&t.target.nodeName.toUpperCase()!=="INPUT"&&(t.qClonedBy===void 0||t.qClonedBy.indexOf(s.uid)===-1)}function G_(t,s,u){const f=ec(t);let m,v=f.left-s.event.x,w=f.top-s.event.y,o=Math.abs(v),S=Math.abs(w);const k=s.direction;k.horizontal===!0&&k.vertical!==!0?m=v<0?"left":"right":k.horizontal!==!0&&k.vertical===!0?m=w<0?"up":"down":k.up===!0&&w<0?(m="up",o>S&&(k.left===!0&&v<0?m="left":k.right===!0&&v>0&&(m="right"))):k.down===!0&&w>0?(m="down",o>S&&(k.left===!0&&v<0?m="left":k.right===!0&&v>0&&(m="right"))):k.left===!0&&v<0?(m="left",o<S&&(k.up===!0&&w<0?m="up":k.down===!0&&w>0&&(m="down"))):k.right===!0&&v>0&&(m="right",o<S&&(k.up===!0&&w<0?m="up":k.down===!0&&w>0&&(m="down")));let I=!1;if(m===void 0&&u===!1){if(s.event.isFirst===!0||s.event.lastDir===void 0)return{};m=s.event.lastDir,I=!0,m==="left"||m==="right"?(f.left-=v,o=0,v=0):(f.top-=w,S=0,w=0)}return{synthetic:I,payload:{evt:t,touch:s.event.mouse!==!0,mouse:s.event.mouse===!0,position:f,direction:m,isFirst:s.event.isFirst,isFinal:u===!0,duration:Date.now()-s.event.time,distance:{x:o,y:S},offset:{x:v,y:w},delta:{x:f.left-s.event.lastX,y:f.top-s.event.lastY}}}}let rz=0;const Z_=$m({name:"touch-pan",beforeMount(t,{value:s,modifiers:u}){if(u.mouse!==!0&&hi.has.touch!==!0)return;function f(v,w){u.mouse===!0&&w===!0?zi(v):(u.stop===!0&&to(v),u.prevent===!0&&Fr(v))}const m={uid:"qvtp_"+rz++,handler:s,modifiers:u,direction:mm(u),noop:Es,mouseStart(v){gm(v,m)&&YE(v)&&(Xo(m,"temp",[[document,"mousemove","move","notPassiveCapture"],[document,"mouseup","end","passiveCapture"]]),m.start(v,!0))},touchStart(v){if(gm(v,m)){const w=v.target;Xo(m,"temp",[[w,"touchmove","move","notPassiveCapture"],[w,"touchcancel","end","passiveCapture"],[w,"touchend","end","passiveCapture"]]),m.start(v)}},start(v,w){if(hi.is.firefox===!0&&yu(t,!0),m.lastEvt=v,w===!0||u.stop===!0){if(m.direction.all!==!0&&(w!==!0||m.modifiers.mouseAllDir!==!0&&m.modifiers.mousealldir!==!0)){const k=v.type.indexOf("mouse")>-1?new MouseEvent(v.type,v):new TouchEvent(v.type,v);v.defaultPrevented===!0&&Fr(k),v.cancelBubble===!0&&to(k),Object.assign(k,{qKeyEvent:v.qKeyEvent,qClickOutside:v.qClickOutside,qAnchorHandled:v.qAnchorHandled,qClonedBy:v.qClonedBy===void 0?[m.uid]:v.qClonedBy.concat(m.uid)}),m.initialEvent={target:v.target,event:k}}to(v)}const{left:o,top:S}=ec(v);m.event={x:o,y:S,time:Date.now(),mouse:w===!0,detected:!1,isFirst:!0,isFinal:!1,lastX:o,lastY:S}},move(v){if(m.event===void 0)return;const w=ec(v),o=w.left-m.event.x,S=w.top-m.event.y;if(o===0&&S===0)return;m.lastEvt=v;const k=m.event.mouse===!0,I=()=>{f(v,k);let V;u.preserveCursor!==!0&&u.preservecursor!==!0&&(V=document.documentElement.style.cursor||"",document.documentElement.style.cursor="grabbing"),k===!0&&document.body.classList.add("no-pointer-events--children"),document.body.classList.add("non-selectable"),bv(),m.styleCleanup=$=>{if(m.styleCleanup=void 0,V!==void 0&&(document.documentElement.style.cursor=V),document.body.classList.remove("non-selectable"),k===!0){const ne=()=>{document.body.classList.remove("no-pointer-events--children")};$!==void 0?setTimeout(()=>{ne(),$()},50):ne()}else $!==void 0&&$()}};if(m.event.detected===!0){m.event.isFirst!==!0&&f(v,m.event.mouse);const{payload:V,synthetic:$}=G_(v,m,!1);V!==void 0&&(m.handler(V)===!1?m.end(v):(m.styleCleanup===void 0&&m.event.isFirst===!0&&I(),m.event.lastX=V.position.left,m.event.lastY=V.position.top,m.event.lastDir=$===!0?void 0:V.direction,m.event.isFirst=!1));return}if(m.direction.all===!0||k===!0&&(m.modifiers.mouseAllDir===!0||m.modifiers.mousealldir===!0)){I(),m.event.detected=!0,m.move(v);return}const D=Math.abs(o),B=Math.abs(S);D!==B&&(m.direction.horizontal===!0&&D>B||m.direction.vertical===!0&&D<B||m.direction.up===!0&&D<B&&S<0||m.direction.down===!0&&D<B&&S>0||m.direction.left===!0&&D>B&&o<0||m.direction.right===!0&&D>B&&o>0?(m.event.detected=!0,m.move(v)):m.end(v,!0))},end(v,w){if(m.event!==void 0){if(qa(m,"temp"),hi.is.firefox===!0&&yu(t,!1),w===!0)m.styleCleanup!==void 0&&m.styleCleanup(),m.event.detected!==!0&&m.initialEvent!==void 0&&m.initialEvent.target.dispatchEvent(m.initialEvent.event);else if(m.event.detected===!0){m.event.isFirst===!0&&m.handler(G_(v===void 0?m.lastEvt:v,m).payload);const{payload:o}=G_(v===void 0?m.lastEvt:v,m,!0),S=()=>{m.handler(o)};m.styleCleanup!==void 0?m.styleCleanup(S):S()}m.event=void 0,m.initialEvent=void 0,m.lastEvt=void 0}}};if(t.__qtouchpan=m,u.mouse===!0){const v=u.mouseCapture===!0||u.mousecapture===!0?"Capture":"";Xo(m,"main",[[t,"mousedown","mouseStart",`passive${v}`]])}hi.has.touch===!0&&Xo(m,"main",[[t,"touchstart","touchStart",`passive${u.capture===!0?"Capture":""}`],[t,"touchmove","noop","notPassiveCapture"]])},updated(t,s){const u=t.__qtouchpan;u!==void 0&&(s.oldValue!==s.value&&(typeof value!="function"&&u.end(),u.handler=s.value),u.direction=mm(s.modifiers))},beforeUnmount(t){const s=t.__qtouchpan;s!==void 0&&(s.event!==void 0&&s.end(),qa(s,"main"),qa(s,"temp"),hi.is.firefox===!0&&yu(t,!1),s.styleCleanup!==void 0&&s.styleCleanup(),delete t.__qtouchpan)}}),P1=["B","KB","MB","GB","TB","PB"];function oz(t){let s=0;for(;parseInt(t,10)>=1024&&s<P1.length-1;)t/=1024,++s;return`${t.toFixed(1)}${P1[s]}`}function Lp(t,s,u){return u<=s?s:Math.min(u,Math.max(s,t))}function z1(t,s,u){if(u<=s)return s;const f=u-s+1;let m=s+(t-s)%f;return m<s&&(m=f+m),m===0?0:m}const L1=150,sz=Vn({name:"QDrawer",inheritAttrs:!1,props:{...wv,...no,side:{type:String,default:"left",validator:t=>["left","right"].includes(t)},width:{type:Number,default:300},mini:Boolean,miniToOverlay:Boolean,miniWidth:{type:Number,default:57},breakpoint:{type:Number,default:1023},showIfAbove:Boolean,behavior:{type:String,validator:t=>["default","desktop","mobile"].includes(t),default:"default"},bordered:Boolean,elevated:Boolean,overlay:Boolean,persistent:Boolean,noSwipeOpen:Boolean,noSwipeClose:Boolean,noSwipeBackdrop:Boolean},emits:[...Ev,"on-layout","mini-state"],setup(t,{slots:s,emit:u,attrs:f}){const m=Mn(),{proxy:{$q:v}}=m,w=io(t,v),{preventBodyScroll:o}=qT(),{registerTimeout:S,removeTimeout:k}=Sv(),I=Vr(qm,Zs);if(I===Zs)return console.error("QDrawer needs to be child of QLayout"),Zs;let D,B,V;const $=xt(t.behavior==="mobile"||t.behavior!=="desktop"&&I.totalWidth.value<=t.breakpoint),ne=se(()=>t.mini===!0&&$.value!==!0),oe=se(()=>ne.value===!0?t.miniWidth:t.width),ye=xt(t.showIfAbove===!0&&$.value===!1?!0:t.modelValue===!0),te=se(()=>t.persistent!==!0&&($.value===!0||Ve.value===!0));function Se(et,Rt){if(Ee(),et!==!1&&I.animate(),xe(0),$.value===!0){const nn=I.instances[Xt.value];nn!==void 0&&nn.belowBreakpoint===!0&&nn.hide(!1),Fe(1),I.isContainer.value!==!0&&o(!0)}else Fe(0),et!==!1&&nt(!1);S(()=>{et!==!1&&nt(!0),Rt!==!0&&u("show",et)},L1)}function Ae(et,Rt){Me(),et!==!1&&I.animate(),Fe(0),xe(Be.value*oe.value),kt(),Rt!==!0?S(()=>{u("hide",et)},L1):k()}const{show:ce,hide:fe}=Tv({showing:ye,hideOnRouteChange:te,handleShow:Se,handleHide:Ae}),{addToHistory:Ee,removeFromHistory:Me}=UT(ye,fe,te),Ie={belowBreakpoint:$,hide:fe},ke=se(()=>t.side==="right"),Be=se(()=>(v.lang.rtl===!0?-1:1)*(ke.value===!0?1:-1)),Re=xt(0),Ze=xt(!1),Ye=xt(!1),lt=xt(oe.value*Be.value),Xt=se(()=>ke.value===!0?"left":"right"),Ge=se(()=>ye.value===!0&&$.value===!1&&t.overlay===!1?t.miniToOverlay===!0?t.miniWidth:oe.value:0),At=se(()=>t.overlay===!0||t.miniToOverlay===!0||I.view.value.indexOf(ke.value?"R":"L")>-1||v.platform.is.ios===!0&&I.isContainer.value===!0),tn=se(()=>t.overlay===!1&&ye.value===!0&&$.value===!1),Ve=se(()=>t.overlay===!0&&ye.value===!0&&$.value===!1),mt=se(()=>"fullscreen q-drawer__backdrop"+(ye.value===!1&&Ze.value===!1?" hidden":"")),Bt=se(()=>({backgroundColor:`rgba(0,0,0,${Re.value*.4})`})),qt=se(()=>ke.value===!0?I.rows.value.top[2]==="r":I.rows.value.top[0]==="l"),xn=se(()=>ke.value===!0?I.rows.value.bottom[2]==="r":I.rows.value.bottom[0]==="l"),rt=se(()=>{const et={};return I.header.space===!0&&qt.value===!1&&(At.value===!0?et.top=`${I.header.offset}px`:I.header.space===!0&&(et.top=`${I.header.size}px`)),I.footer.space===!0&&xn.value===!1&&(At.value===!0?et.bottom=`${I.footer.offset}px`:I.footer.space===!0&&(et.bottom=`${I.footer.size}px`)),et}),gt=se(()=>{const et={width:`${oe.value}px`,transform:`translateX(${lt.value}px)`};return $.value===!0?et:Object.assign(et,rt.value)}),ot=se(()=>"q-drawer__content fit "+(I.isContainer.value!==!0?"scroll":"overflow-auto")),_t=se(()=>`q-drawer q-drawer--${t.side}`+(Ye.value===!0?" q-drawer--mini-animate":"")+(t.bordered===!0?" q-drawer--bordered":"")+(w.value===!0?" q-drawer--dark q-dark":"")+(Ze.value===!0?" no-transition":ye.value===!0?"":" q-layout--prevent-focus")+($.value===!0?" fixed q-drawer--on-top q-drawer--mobile q-drawer--top-padding":` q-drawer--${ne.value===!0?"mini":"standard"}`+(At.value===!0||tn.value!==!0?" fixed":"")+(t.overlay===!0||t.miniToOverlay===!0?" q-drawer--on-top":"")+(qt.value===!0?" q-drawer--top-padding":""))),ft=se(()=>{const et=v.lang.rtl===!0?t.side:Xt.value;return[[Z_,zt,void 0,{[et]:!0,mouse:!0}]]}),sn=se(()=>{const et=v.lang.rtl===!0?Xt.value:t.side;return[[Z_,Vt,void 0,{[et]:!0,mouse:!0}]]}),un=se(()=>{const et=v.lang.rtl===!0?Xt.value:t.side;return[[Z_,Vt,void 0,{[et]:!0,mouse:!0,mouseAllDir:!0}]]});function re(){Mt($,t.behavior==="mobile"||t.behavior!=="desktop"&&I.totalWidth.value<=t.breakpoint)}Wt($,et=>{et===!0?(D=ye.value,ye.value===!0&&fe(!1)):t.overlay===!1&&t.behavior!=="mobile"&&D!==!1&&(ye.value===!0?(xe(0),Fe(0),kt()):ce(!1))}),Wt(()=>t.side,(et,Rt)=>{I.instances[Rt]===Ie&&(I.instances[Rt]=void 0,I[Rt].space=!1,I[Rt].offset=0),I.instances[et]=Ie,I[et].size=oe.value,I[et].space=tn.value,I[et].offset=Ge.value}),Wt(I.totalWidth,()=>{(I.isContainer.value===!0||document.qScrollPrevented!==!0)&&re()}),Wt(()=>t.behavior+t.breakpoint,re),Wt(I.isContainer,et=>{ye.value===!0&&o(et!==!0),et===!0&&re()}),Wt(I.scrollbarWidth,()=>{xe(ye.value===!0?0:void 0)}),Wt(Ge,et=>{bt("offset",et)}),Wt(tn,et=>{u("on-layout",et),bt("space",et)}),Wt(ke,()=>{xe()}),Wt(oe,et=>{xe(),Ht(t.miniToOverlay,et)}),Wt(()=>t.miniToOverlay,et=>{Ht(et,oe.value)}),Wt(()=>v.lang.rtl,()=>{xe()}),Wt(()=>t.mini,()=>{t.modelValue===!0&&(yt(),I.animate())}),Wt(ne,et=>{u("mini-state",et)});function xe(et){et===void 0?ui(()=>{et=ye.value===!0?0:oe.value,xe(Be.value*et)}):(I.isContainer.value===!0&&ke.value===!0&&($.value===!0||Math.abs(et)===oe.value)&&(et+=Be.value*I.scrollbarWidth.value),lt.value=et)}function Fe(et){Re.value=et}function nt(et){const Rt=et===!0?"remove":I.isContainer.value!==!0?"add":"";Rt!==""&&document.body.classList[Rt]("q-body--drawer-toggle")}function yt(){clearTimeout(B),m.proxy&&m.proxy.$el&&m.proxy.$el.classList.add("q-drawer--mini-animate"),Ye.value=!0,B=setTimeout(()=>{Ye.value=!1,m&&m.proxy&&m.proxy.$el&&m.proxy.$el.classList.remove("q-drawer--mini-animate")},150)}function zt(et){if(ye.value!==!1)return;const Rt=oe.value,nn=Lp(et.distance.x,0,Rt);if(et.isFinal===!0){nn>=Math.min(75,Rt)===!0?ce():(I.animate(),Fe(0),xe(Be.value*Rt)),Ze.value=!1;return}xe((v.lang.rtl===!0?ke.value!==!0:ke.value)?Math.max(Rt-nn,0):Math.min(0,nn-Rt)),Fe(Lp(nn/Rt,0,1)),et.isFirst===!0&&(Ze.value=!0)}function Vt(et){if(ye.value!==!0)return;const Rt=oe.value,nn=et.direction===t.side,bn=(v.lang.rtl===!0?nn!==!0:nn)?Lp(et.distance.x,0,Rt):0;if(et.isFinal===!0){Math.abs(bn)<Math.min(75,Rt)===!0?(I.animate(),Fe(1),xe(0)):fe(),Ze.value=!1;return}xe(Be.value*bn),Fe(Lp(1-bn/Rt,0,1)),et.isFirst===!0&&(Ze.value=!0)}function kt(){o(!1),nt(!0)}function bt(et,Rt){I.update(t.side,et,Rt)}function Mt(et,Rt){et.value!==Rt&&(et.value=Rt)}function Ht(et,Rt){bt("size",et===!0?t.miniWidth:Rt)}return I.instances[t.side]=Ie,Ht(t.miniToOverlay,oe.value),bt("space",tn.value),bt("offset",Ge.value),t.showIfAbove===!0&&t.modelValue!==!0&&ye.value===!0&&t["onUpdate:modelValue"]!==void 0&&u("update:modelValue",!0),Ui(()=>{u("on-layout",tn.value),u("mini-state",ne.value),D=t.showIfAbove===!0;const et=()=>{(ye.value===!0?Se:Ae)(!1,!0)};if(I.totalWidth.value!==0){ui(et);return}V=Wt(I.totalWidth,()=>{V(),V=void 0,ye.value===!1&&t.showIfAbove===!0&&$.value===!1?ce(!1):et()})}),Ii(()=>{V!==void 0&&V(),clearTimeout(B),ye.value===!0&&kt(),I.instances[t.side]===Ie&&(I.instances[t.side]=void 0,bt("size",0),bt("offset",0),bt("space",!1))}),()=>{const et=[];$.value===!0&&(t.noSwipeOpen===!1&&et.push(Xl(pe("div",{key:"open",class:`q-drawer__opener fixed-${t.side}`,"aria-hidden":"true"}),ft.value)),et.push(hm("div",{ref:"backdrop",class:mt.value,style:Bt.value,"aria-hidden":"true",onClick:fe},void 0,"backdrop",t.noSwipeBackdrop!==!0&&ye.value===!0,()=>un.value)));const Rt=ne.value===!0&&s.mini!==void 0,nn=[pe("div",{...f,key:""+Rt,class:[ot.value,f.class]},Rt===!0?s.mini():bi(s.default))];return t.elevated===!0&&ye.value===!0&&nn.push(pe("div",{class:"q-layout__shadow absolute-full overflow-hidden no-pointer-events"})),et.push(hm("aside",{ref:"content",class:_t.value,style:gt.value},nn,"contentclose",t.noSwipeClose!==!0&&$.value===!0,()=>sn.value)),pe("div",{class:"q-drawer-container"},et)}}}),az=Vn({name:"QPageContainer",setup(t,{slots:s}){const{proxy:{$q:u}}=Mn(),f=Vr(qm,Zs);if(f===Zs)return console.error("QPageContainer needs to be child of QLayout"),Zs;Wl(Vk,!0);const m=se(()=>{const v={};return f.header.space===!0&&(v.paddingTop=`${f.header.size}px`),f.right.space===!0&&(v[`padding${u.lang.rtl===!0?"Left":"Right"}`]=`${f.right.size}px`),f.footer.space===!0&&(v.paddingBottom=`${f.footer.size}px`),f.left.space===!0&&(v[`padding${u.lang.rtl===!0?"Right":"Left"}`]=`${f.left.size}px`),v});return()=>pe("div",{class:"q-page-container",style:m.value},bi(s.default))}}),{passive:R1}=Xi,lz=["both","horizontal","vertical"],cz=Vn({name:"QScrollObserver",props:{axis:{type:String,validator:t=>lz.includes(t),default:"vertical"},debounce:[String,Number],scrollTarget:{default:void 0}},emits:["scroll"],setup(t,{emit:s}){const u={position:{top:0,left:0},direction:"down",directionChanged:!1,delta:{top:0,left:0},inflectionPoint:{top:0,left:0}};let f=null,m,v;Wt(()=>t.scrollTarget,()=>{S(),o()});function w(){f!==null&&f();const D=Math.max(0,PT(m)),B=zT(m),V={top:D-u.position.top,left:B-u.position.left};if(t.axis==="vertical"&&V.top===0||t.axis==="horizontal"&&V.left===0)return;const $=Math.abs(V.top)>=Math.abs(V.left)?V.top<0?"up":"down":V.left<0?"left":"right";u.position={top:D,left:B},u.directionChanged=u.direction!==$,u.delta=V,u.directionChanged===!0&&(u.direction=$,u.inflectionPoint=u.position),s("scroll",{...u})}function o(){m=Cv(v,t.scrollTarget),m.addEventListener("scroll",k,R1),k(!0)}function S(){m!==void 0&&(m.removeEventListener("scroll",k,R1),m=void 0)}function k(D){if(D===!0||t.debounce===0||t.debounce==="0")w();else if(f===null){const[B,V]=t.debounce?[setTimeout(w,t.debounce),clearTimeout]:[requestAnimationFrame(w),cancelAnimationFrame];f=()=>{V(B),f=null}}}const{proxy:I}=Mn();return Ui(()=>{v=I.$el.parentNode,o()}),Ii(()=>{f!==null&&f(),S()}),Object.assign(I,{trigger:k,getPosition:()=>u}),Es}}),uz=Vn({name:"QLayout",props:{container:Boolean,view:{type:String,default:"hhh lpr fff",validator:t=>/^(h|l)h(h|r) lpr (f|l)f(f|r)$/.test(t.toLowerCase())},onScroll:Function,onScrollHeight:Function,onResize:Function},setup(t,{slots:s,emit:u}){const{proxy:{$q:f}}=Mn(),m=xt(null),v=xt(f.screen.height),w=xt(t.container===!0?0:f.screen.width),o=xt({position:0,direction:"down",inflectionPoint:0}),S=xt(0),k=xt(ws.value===!0?0:Zp()),I=se(()=>"q-layout q-layout--"+(t.container===!0?"containerized":"standard")),D=se(()=>t.container===!1?{minHeight:f.screen.height+"px"}:null),B=se(()=>k.value!==0?{[f.lang.rtl===!0?"left":"right"]:`${k.value}px`}:null),V=se(()=>k.value!==0?{[f.lang.rtl===!0?"right":"left"]:0,[f.lang.rtl===!0?"left":"right"]:`-${k.value}px`,width:`calc(100% + ${k.value}px)`}:null);function $(Ae){if(t.container===!0||document.qScrollPrevented!==!0){const ce={position:Ae.position.top,direction:Ae.direction,directionChanged:Ae.directionChanged,inflectionPoint:Ae.inflectionPoint.top,delta:Ae.delta.top};o.value=ce,t.onScroll!==void 0&&u("scroll",ce)}}function ne(Ae){const{height:ce,width:fe}=Ae;let Ee=!1;v.value!==ce&&(Ee=!0,v.value=ce,t.onScrollHeight!==void 0&&u("scroll-height",ce),ye()),w.value!==fe&&(Ee=!0,w.value=fe),Ee===!0&&t.onResize!==void 0&&u("resize",Ae)}function oe({height:Ae}){S.value!==Ae&&(S.value=Ae,ye())}function ye(){if(t.container===!0){const Ae=v.value>S.value?Zp():0;k.value!==Ae&&(k.value=Ae)}}let te;const Se={instances:{},view:se(()=>t.view),isContainer:se(()=>t.container),rootRef:m,height:v,containerHeight:S,scrollbarWidth:k,totalWidth:se(()=>w.value+k.value),rows:se(()=>{const Ae=t.view.toLowerCase().split(" ");return{top:Ae[0].split(""),middle:Ae[1].split(""),bottom:Ae[2].split("")}}),header:ko({size:0,offset:0,space:!1}),right:ko({size:300,offset:0,space:!1}),footer:ko({size:0,offset:0,space:!1}),left:ko({size:300,offset:0,space:!1}),scroll:o,animate(){te!==void 0?clearTimeout(te):document.body.classList.add("q-body--layout-animate"),te=setTimeout(()=>{document.body.classList.remove("q-body--layout-animate"),te=void 0},155)},update(Ae,ce,fe){Se[Ae][ce]=fe}};if(Wl(qm,Se),Zp()>0){let fe=function(){Ae=null,ce.classList.remove("hide-scrollbar")},Ee=function(){if(Ae===null){if(ce.scrollHeight>f.screen.height)return;ce.classList.add("hide-scrollbar")}else clearTimeout(Ae);Ae=setTimeout(fe,300)},Me=function(Ie){Ae!==null&&Ie==="remove"&&(clearTimeout(Ae),fe()),window[`${Ie}EventListener`]("resize",Ee)},Ae=null;const ce=document.body;Wt(()=>t.container!==!0?"add":"remove",Me),t.container!==!0&&Me("add"),ea(()=>{Me("remove")})}return()=>{const Ae=Po(s.default,[pe(cz,{onScroll:$}),pe(ky,{onResize:ne})]),ce=pe("div",{class:I.value,style:D.value,ref:t.container===!0?void 0:m,tabindex:-1},Ae);return t.container===!0?pe("div",{class:"q-layout-container overflow-hidden",ref:m},[pe(ky,{onResize:oe}),pe("div",{class:"absolute-full",style:B.value},[pe("div",{class:"scroll",style:V.value},[ce])])]):ce}}}),Hp=Vn({name:"QItemSection",props:{avatar:Boolean,thumbnail:Boolean,side:Boolean,top:Boolean,noWrap:Boolean},setup(t,{slots:s}){const u=se(()=>`q-item__section column q-item__section--${t.avatar===!0||t.side===!0||t.thumbnail===!0?"side":"main"}`+(t.top===!0?" q-item__section--top justify-start":" justify-center")+(t.avatar===!0?" q-item__section--avatar":"")+(t.thumbnail===!0?" q-item__section--thumbnail":"")+(t.noWrap===!0?" q-item__section--nowrap":""));return()=>pe("div",{class:u.value},bi(s.default))}}),jT=Vn({name:"QItemLabel",props:{overline:Boolean,caption:Boolean,header:Boolean,lines:[Number,String]},setup(t,{slots:s}){const u=se(()=>parseInt(t.lines,10)),f=se(()=>"q-item__label"+(t.overline===!0?" q-item__label--overline text-overline":"")+(t.caption===!0?" q-item__label--caption text-caption":"")+(t.header===!0?" q-item__label--header":"")+(u.value===1?" ellipsis":"")),m=se(()=>t.lines!==void 0&&u.value>1?{overflow:"hidden",display:"-webkit-box","-webkit-box-orient":"vertical","-webkit-line-clamp":u.value}:null);return()=>pe("div",{style:m.value,class:f.value},bi(s.default))}}),$T=Vn({name:"QItem",props:{...no,...vT,tag:{type:String,default:"div"},active:{type:Boolean,default:null},clickable:Boolean,dense:Boolean,insetLevel:Number,tabindex:[String,Number],focused:Boolean,manualFocus:Boolean},emits:["click","keyup"],setup(t,{slots:s,emit:u}){const{proxy:{$q:f}}=Mn(),m=io(t,f),{hasLink:v,linkAttrs:w,linkClass:o,linkTag:S,navigateOnClick:k}=xT(),I=xt(null),D=xt(null),B=se(()=>t.clickable===!0||v.value===!0||t.tag==="label"),V=se(()=>t.disable!==!0&&B.value===!0),$=se(()=>"q-item q-item-type row no-wrap"+(t.dense===!0?" q-item--dense":"")+(m.value===!0?" q-item--dark":"")+(v.value===!0&&t.active===null?o.value:t.active===!0?` q-item--active${t.activeClass!==void 0?` ${t.activeClass}`:""}`:"")+(t.disable===!0?" disabled":"")+(V.value===!0?" q-item--clickable q-link cursor-pointer "+(t.manualFocus===!0?"q-manual-focusable":"q-focusable q-hoverable")+(t.focused===!0?" q-manual-focusable--focused":""):"")),ne=se(()=>t.insetLevel===void 0?null:{["padding"+(f.lang.rtl===!0?"Right":"Left")]:16+t.insetLevel*56+"px"});function oe(Se){V.value===!0&&(D.value!==null&&(Se.qKeyEvent!==!0&&document.activeElement===I.value?D.value.focus():document.activeElement===D.value&&I.value.focus()),k(Se))}function ye(Se){if(V.value===!0&&$a(Se,13)===!0){zi(Se),Se.qKeyEvent=!0;const Ae=new MouseEvent("click",Se);Ae.qKeyEvent=!0,I.value.dispatchEvent(Ae)}u("keyup",Se)}function te(){const Se=yv(s.default,[]);return V.value===!0&&Se.unshift(pe("div",{class:"q-focus-helper",tabindex:-1,ref:D})),Se}return()=>{const Se={ref:I,class:$.value,style:ne.value,role:"listitem",onClick:oe,onKeyup:ye};return V.value===!0?(Se.tabindex=t.tabindex||"0",Object.assign(Se,w.value)):B.value===!0&&(Se["aria-disabled"]="true"),pe(S.value,Se,te())}}}),hz="modulepreload",dz=function(t){return"/"+t},D1={},cu=function(s,u,f){return!u||u.length===0?s():Promise.all(u.map(m=>{if(m=dz(m),m in D1)return;D1[m]=!0;const v=m.endsWith(".css"),w=v?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${m}"]${w}`))return;const o=document.createElement("link");if(o.rel=v?"stylesheet":hz,v||(o.as="script",o.crossOrigin=""),o.href=m,document.head.appendChild(o),v)return new Promise((S,k)=>{o.addEventListener("load",S),o.addEventListener("error",()=>k(new Error(`Unable to preload CSS for ${m}`)))})})).then(()=>s())};/*!
  * vue-router v4.1.5
  * (c) 2022 Eduardo San Martin Morote
  * @license MIT
  */const fu=typeof window<"u";function fz(t){return t.__esModule||t[Symbol.toStringTag]==="Module"}const xi=Object.assign;function H_(t,s){const u={};for(const f in s){const m=s[f];u[f]=Qo(m)?m.map(t):t(m)}return u}const Td=()=>{},Qo=Array.isArray,pz=/\/$/,mz=t=>t.replace(pz,"");function W_(t,s,u="/"){let f,m={},v="",w="";const o=s.indexOf("#");let S=s.indexOf("?");return o<S&&o>=0&&(S=-1),S>-1&&(f=s.slice(0,S),v=s.slice(S+1,o>-1?o:s.length),m=t(v)),o>-1&&(f=f||s.slice(0,o),w=s.slice(o,s.length)),f=vz(f!=null?f:s,u),{fullPath:f+(v&&"?")+v+w,path:f,query:m,hash:w}}function gz(t,s){const u=s.query?t(s.query):"";return s.path+(u&&"?")+u+(s.hash||"")}function O1(t,s){return!s||!t.toLowerCase().startsWith(s.toLowerCase())?t:t.slice(s.length)||"/"}function _z(t,s,u){const f=s.matched.length-1,m=u.matched.length-1;return f>-1&&f===m&&ku(s.matched[f],u.matched[m])&&GT(s.params,u.params)&&t(s.query)===t(u.query)&&s.hash===u.hash}function ku(t,s){return(t.aliasOf||t)===(s.aliasOf||s)}function GT(t,s){if(Object.keys(t).length!==Object.keys(s).length)return!1;for(const u in t)if(!yz(t[u],s[u]))return!1;return!0}function yz(t,s){return Qo(t)?B1(t,s):Qo(s)?B1(s,t):t===s}function B1(t,s){return Qo(s)?t.length===s.length&&t.every((u,f)=>u===s[f]):t.length===1&&t[0]===s}function vz(t,s){if(t.startsWith("/"))return t;if(!t)return s;const u=s.split("/"),f=t.split("/");let m=u.length-1,v,w;for(v=0;v<f.length;v++)if(w=f[v],w!==".")if(w==="..")m>1&&m--;else break;return u.slice(0,m).join("/")+"/"+f.slice(v-(v===f.length?1:0)).join("/")}var Fd;(function(t){t.pop="pop",t.push="push"})(Fd||(Fd={}));var Sd;(function(t){t.back="back",t.forward="forward",t.unknown=""})(Sd||(Sd={}));function xz(t){if(!t)if(fu){const s=document.querySelector("base");t=s&&s.getAttribute("href")||"/",t=t.replace(/^\w+:\/\/[^\/]+/,"")}else t="/";return t[0]!=="/"&&t[0]!=="#"&&(t="/"+t),mz(t)}const bz=/^[^#]+#/;function wz(t,s){return t.replace(bz,"#")+s}function Ez(t,s){const u=document.documentElement.getBoundingClientRect(),f=t.getBoundingClientRect();return{behavior:s.behavior,left:f.left-u.left-(s.left||0),top:f.top-u.top-(s.top||0)}}const Hm=()=>({left:window.pageXOffset,top:window.pageYOffset});function Tz(t){let s;if("el"in t){const u=t.el,f=typeof u=="string"&&u.startsWith("#"),m=typeof u=="string"?f?document.getElementById(u.slice(1)):document.querySelector(u):u;if(!m)return;s=Ez(m,t)}else s=t;"scrollBehavior"in document.documentElement.style?window.scrollTo(s):window.scrollTo(s.left!=null?s.left:window.pageXOffset,s.top!=null?s.top:window.pageYOffset)}function F1(t,s){return(history.state?history.state.position-s:-1)+t}const Py=new Map;function Sz(t,s){Py.set(t,s)}function Cz(t){const s=Py.get(t);return Py.delete(t),s}let Az=()=>location.protocol+"//"+location.host;function ZT(t,s){const{pathname:u,search:f,hash:m}=s,v=t.indexOf("#");if(v>-1){let o=m.includes(t.slice(v))?t.slice(v).length:1,S=m.slice(o);return S[0]!=="/"&&(S="/"+S),O1(S,"")}return O1(u,t)+f+m}function Mz(t,s,u,f){let m=[],v=[],w=null;const o=({state:B})=>{const V=ZT(t,location),$=u.value,ne=s.value;let oe=0;if(B){if(u.value=V,s.value=B,w&&w===$){w=null;return}oe=ne?B.position-ne.position:0}else f(V);m.forEach(ye=>{ye(u.value,$,{delta:oe,type:Fd.pop,direction:oe?oe>0?Sd.forward:Sd.back:Sd.unknown})})};function S(){w=u.value}function k(B){m.push(B);const V=()=>{const $=m.indexOf(B);$>-1&&m.splice($,1)};return v.push(V),V}function I(){const{history:B}=window;!B.state||B.replaceState(xi({},B.state,{scroll:Hm()}),"")}function D(){for(const B of v)B();v=[],window.removeEventListener("popstate",o),window.removeEventListener("beforeunload",I)}return window.addEventListener("popstate",o),window.addEventListener("beforeunload",I),{pauseListeners:S,listen:k,destroy:D}}function N1(t,s,u,f=!1,m=!1){return{back:t,current:s,forward:u,replaced:f,position:window.history.length,scroll:m?Hm():null}}function Iz(t){const{history:s,location:u}=window,f={value:ZT(t,u)},m={value:s.state};m.value||v(f.value,{back:null,current:f.value,forward:null,position:s.length-1,replaced:!0,scroll:null},!0);function v(S,k,I){const D=t.indexOf("#"),B=D>-1?(u.host&&document.querySelector("base")?t:t.slice(D))+S:Az()+t+S;try{s[I?"replaceState":"pushState"](k,"",B),m.value=k}catch(V){console.error(V),u[I?"replace":"assign"](B)}}function w(S,k){const I=xi({},s.state,N1(m.value.back,S,m.value.forward,!0),k,{position:m.value.position});v(S,I,!0),f.value=S}function o(S,k){const I=xi({},m.value,s.state,{forward:S,scroll:Hm()});v(I.current,I,!0);const D=xi({},N1(f.value,S,null),{position:I.position+1},k);v(S,D,!1),f.value=S}return{location:f,state:m,push:o,replace:w}}function kz(t){t=xz(t);const s=Iz(t),u=Mz(t,s.state,s.location,s.replace);function f(v,w=!0){w||u.pauseListeners(),history.go(v)}const m=xi({location:"",base:t,go:f,createHref:wz.bind(null,t)},s,u);return Object.defineProperty(m,"location",{enumerable:!0,get:()=>s.location.value}),Object.defineProperty(m,"state",{enumerable:!0,get:()=>s.state.value}),m}function Pz(t){return typeof t=="string"||t&&typeof t=="object"}function HT(t){return typeof t=="string"||typeof t=="symbol"}const ka={path:"/",name:void 0,params:{},query:{},hash:"",fullPath:"/",matched:[],meta:{},redirectedFrom:void 0},WT=Symbol("");var V1;(function(t){t[t.aborted=4]="aborted",t[t.cancelled=8]="cancelled",t[t.duplicated=16]="duplicated"})(V1||(V1={}));function Pu(t,s){return xi(new Error,{type:t,[WT]:!0},s)}function Us(t,s){return t instanceof Error&&WT in t&&(s==null||!!(t.type&s))}const U1="[^/]+?",zz={sensitive:!1,strict:!1,start:!0,end:!0},Lz=/[.+*?^${}()[\]/\\]/g;function Rz(t,s){const u=xi({},zz,s),f=[];let m=u.start?"^":"";const v=[];for(const k of t){const I=k.length?[]:[90];u.strict&&!k.length&&(m+="/");for(let D=0;D<k.length;D++){const B=k[D];let V=40+(u.sensitive?.25:0);if(B.type===0)D||(m+="/"),m+=B.value.replace(Lz,"\\$&"),V+=40;else if(B.type===1){const{value:$,repeatable:ne,optional:oe,regexp:ye}=B;v.push({name:$,repeatable:ne,optional:oe});const te=ye||U1;if(te!==U1){V+=10;try{new RegExp(`(${te})`)}catch(Ae){throw new Error(`Invalid custom RegExp for param "${$}" (${te}): `+Ae.message)}}let Se=ne?`((?:${te})(?:/(?:${te}))*)`:`(${te})`;D||(Se=oe&&k.length<2?`(?:/${Se})`:"/"+Se),oe&&(Se+="?"),m+=Se,V+=20,oe&&(V+=-8),ne&&(V+=-20),te===".*"&&(V+=-50)}I.push(V)}f.push(I)}if(u.strict&&u.end){const k=f.length-1;f[k][f[k].length-1]+=.7000000000000001}u.strict||(m+="/?"),u.end?m+="$":u.strict&&(m+="(?:/|$)");const w=new RegExp(m,u.sensitive?"":"i");function o(k){const I=k.match(w),D={};if(!I)return null;for(let B=1;B<I.length;B++){const V=I[B]||"",$=v[B-1];D[$.name]=V&&$.repeatable?V.split("/"):V}return D}function S(k){let I="",D=!1;for(const B of t){(!D||!I.endsWith("/"))&&(I+="/"),D=!1;for(const V of B)if(V.type===0)I+=V.value;else if(V.type===1){const{value:$,repeatable:ne,optional:oe}=V,ye=$ in k?k[$]:"";if(Qo(ye)&&!ne)throw new Error(`Provided param "${$}" is an array but it is not repeatable (* or + modifiers)`);const te=Qo(ye)?ye.join("/"):ye;if(!te)if(oe)B.length<2&&(I.endsWith("/")?I=I.slice(0,-1):D=!0);else throw new Error(`Missing required param "${$}"`);I+=te}}return I||"/"}return{re:w,score:f,keys:v,parse:o,stringify:S}}function Dz(t,s){let u=0;for(;u<t.length&&u<s.length;){const f=s[u]-t[u];if(f)return f;u++}return t.length<s.length?t.length===1&&t[0]===40+40?-1:1:t.length>s.length?s.length===1&&s[0]===40+40?1:-1:0}function Oz(t,s){let u=0;const f=t.score,m=s.score;for(;u<f.length&&u<m.length;){const v=Dz(f[u],m[u]);if(v)return v;u++}if(Math.abs(m.length-f.length)===1){if(q1(f))return 1;if(q1(m))return-1}return m.length-f.length}function q1(t){const s=t[t.length-1];return t.length>0&&s[s.length-1]<0}const Bz={type:0,value:""},Fz=/[a-zA-Z0-9_]/;function Nz(t){if(!t)return[[]];if(t==="/")return[[Bz]];if(!t.startsWith("/"))throw new Error(`Invalid path "${t}"`);function s(V){throw new Error(`ERR (${u})/"${k}": ${V}`)}let u=0,f=u;const m=[];let v;function w(){v&&m.push(v),v=[]}let o=0,S,k="",I="";function D(){!k||(u===0?v.push({type:0,value:k}):u===1||u===2||u===3?(v.length>1&&(S==="*"||S==="+")&&s(`A repeatable param (${k}) must be alone in its segment. eg: '/:ids+.`),v.push({type:1,value:k,regexp:I,repeatable:S==="*"||S==="+",optional:S==="*"||S==="?"})):s("Invalid state to consume buffer"),k="")}function B(){k+=S}for(;o<t.length;){if(S=t[o++],S==="\\"&&u!==2){f=u,u=4;continue}switch(u){case 0:S==="/"?(k&&D(),w()):S===":"?(D(),u=1):B();break;case 4:B(),u=f;break;case 1:S==="("?u=2:Fz.test(S)?B():(D(),u=0,S!=="*"&&S!=="?"&&S!=="+"&&o--);break;case 2:S===")"?I[I.length-1]=="\\"?I=I.slice(0,-1)+S:u=3:I+=S;break;case 3:D(),u=0,S!=="*"&&S!=="?"&&S!=="+"&&o--,I="";break;default:s("Unknown state");break}}return u===2&&s(`Unfinished custom RegExp for param "${k}"`),D(),w(),m}function Vz(t,s,u){const f=Rz(Nz(t.path),u),m=xi(f,{record:t,parent:s,children:[],alias:[]});return s&&!m.record.aliasOf==!s.record.aliasOf&&s.children.push(m),m}function Uz(t,s){const u=[],f=new Map;s=G1({strict:!1,end:!0,sensitive:!1},s);function m(I){return f.get(I)}function v(I,D,B){const V=!B,$=qz(I);$.aliasOf=B&&B.record;const ne=G1(s,I),oe=[$];if("alias"in I){const Se=typeof I.alias=="string"?[I.alias]:I.alias;for(const Ae of Se)oe.push(xi({},$,{components:B?B.record.components:$.components,path:Ae,aliasOf:B?B.record:$}))}let ye,te;for(const Se of oe){const{path:Ae}=Se;if(D&&Ae[0]!=="/"){const ce=D.record.path,fe=ce[ce.length-1]==="/"?"":"/";Se.path=D.record.path+(Ae&&fe+Ae)}if(ye=Vz(Se,D,ne),B?B.alias.push(ye):(te=te||ye,te!==ye&&te.alias.push(ye),V&&I.name&&!$1(ye)&&w(I.name)),$.children){const ce=$.children;for(let fe=0;fe<ce.length;fe++)v(ce[fe],ye,B&&B.children[fe])}B=B||ye,S(ye)}return te?()=>{w(te)}:Td}function w(I){if(HT(I)){const D=f.get(I);D&&(f.delete(I),u.splice(u.indexOf(D),1),D.children.forEach(w),D.alias.forEach(w))}else{const D=u.indexOf(I);D>-1&&(u.splice(D,1),I.record.name&&f.delete(I.record.name),I.children.forEach(w),I.alias.forEach(w))}}function o(){return u}function S(I){let D=0;for(;D<u.length&&Oz(I,u[D])>=0&&(I.record.path!==u[D].record.path||!XT(I,u[D]));)D++;u.splice(D,0,I),I.record.name&&!$1(I)&&f.set(I.record.name,I)}function k(I,D){let B,V={},$,ne;if("name"in I&&I.name){if(B=f.get(I.name),!B)throw Pu(1,{location:I});ne=B.record.name,V=xi(j1(D.params,B.keys.filter(te=>!te.optional).map(te=>te.name)),I.params&&j1(I.params,B.keys.map(te=>te.name))),$=B.stringify(V)}else if("path"in I)$=I.path,B=u.find(te=>te.re.test($)),B&&(V=B.parse($),ne=B.record.name);else{if(B=D.name?f.get(D.name):u.find(te=>te.re.test(D.path)),!B)throw Pu(1,{location:I,currentLocation:D});ne=B.record.name,V=xi({},D.params,I.params),$=B.stringify(V)}const oe=[];let ye=B;for(;ye;)oe.unshift(ye.record),ye=ye.parent;return{name:ne,path:$,params:V,matched:oe,meta:$z(oe)}}return t.forEach(I=>v(I)),{addRoute:v,resolve:k,removeRoute:w,getRoutes:o,getRecordMatcher:m}}function j1(t,s){const u={};for(const f of s)f in t&&(u[f]=t[f]);return u}function qz(t){return{path:t.path,redirect:t.redirect,name:t.name,meta:t.meta||{},aliasOf:void 0,beforeEnter:t.beforeEnter,props:jz(t),children:t.children||[],instances:{},leaveGuards:new Set,updateGuards:new Set,enterCallbacks:{},components:"components"in t?t.components||null:t.component&&{default:t.component}}}function jz(t){const s={},u=t.props||!1;if("component"in t)s.default=u;else for(const f in t.components)s[f]=typeof u=="boolean"?u:u[f];return s}function $1(t){for(;t;){if(t.record.aliasOf)return!0;t=t.parent}return!1}function $z(t){return t.reduce((s,u)=>xi(s,u.meta),{})}function G1(t,s){const u={};for(const f in t)u[f]=f in s?s[f]:t[f];return u}function XT(t,s){return s.children.some(u=>u===t||XT(t,u))}const KT=/#/g,Gz=/&/g,Zz=/\//g,Hz=/=/g,Wz=/\?/g,YT=/\+/g,Xz=/%5B/g,Kz=/%5D/g,QT=/%5E/g,Yz=/%60/g,JT=/%7B/g,Qz=/%7C/g,eS=/%7D/g,Jz=/%20/g;function Mv(t){return encodeURI(""+t).replace(Qz,"|").replace(Xz,"[").replace(Kz,"]")}function eL(t){return Mv(t).replace(JT,"{").replace(eS,"}").replace(QT,"^")}function zy(t){return Mv(t).replace(YT,"%2B").replace(Jz,"+").replace(KT,"%23").replace(Gz,"%26").replace(Yz,"`").replace(JT,"{").replace(eS,"}").replace(QT,"^")}function tL(t){return zy(t).replace(Hz,"%3D")}function nL(t){return Mv(t).replace(KT,"%23").replace(Wz,"%3F")}function iL(t){return t==null?"":nL(t).replace(Zz,"%2F")}function _m(t){try{return decodeURIComponent(""+t)}catch{}return""+t}function rL(t){const s={};if(t===""||t==="?")return s;const f=(t[0]==="?"?t.slice(1):t).split("&");for(let m=0;m<f.length;++m){const v=f[m].replace(YT," "),w=v.indexOf("="),o=_m(w<0?v:v.slice(0,w)),S=w<0?null:_m(v.slice(w+1));if(o in s){let k=s[o];Qo(k)||(k=s[o]=[k]),k.push(S)}else s[o]=S}return s}function Z1(t){let s="";for(let u in t){const f=t[u];if(u=tL(u),f==null){f!==void 0&&(s+=(s.length?"&":"")+u);continue}(Qo(f)?f.map(v=>v&&zy(v)):[f&&zy(f)]).forEach(v=>{v!==void 0&&(s+=(s.length?"&":"")+u,v!=null&&(s+="="+v))})}return s}function oL(t){const s={};for(const u in t){const f=t[u];f!==void 0&&(s[u]=Qo(f)?f.map(m=>m==null?null:""+m):f==null?f:""+f)}return s}const sL=Symbol(""),H1=Symbol(""),Wm=Symbol(""),tS=Symbol(""),Ly=Symbol("");function dd(){let t=[];function s(f){return t.push(f),()=>{const m=t.indexOf(f);m>-1&&t.splice(m,1)}}function u(){t=[]}return{add:s,list:()=>t,reset:u}}function Ba(t,s,u,f,m){const v=f&&(f.enterCallbacks[m]=f.enterCallbacks[m]||[]);return()=>new Promise((w,o)=>{const S=D=>{D===!1?o(Pu(4,{from:u,to:s})):D instanceof Error?o(D):Pz(D)?o(Pu(2,{from:s,to:D})):(v&&f.enterCallbacks[m]===v&&typeof D=="function"&&v.push(D),w())},k=t.call(f&&f.instances[m],s,u,S);let I=Promise.resolve(k);t.length<3&&(I=I.then(S)),I.catch(D=>o(D))})}function X_(t,s,u,f){const m=[];for(const v of t)for(const w in v.components){let o=v.components[w];if(!(s!=="beforeRouteEnter"&&!v.instances[w]))if(aL(o)){const k=(o.__vccOpts||o)[s];k&&m.push(Ba(k,u,f,v,w))}else{let S=o();m.push(()=>S.then(k=>{if(!k)return Promise.reject(new Error(`Couldn't resolve component "${w}" at "${v.path}"`));const I=fz(k)?k.default:k;v.components[w]=I;const B=(I.__vccOpts||I)[s];return B&&Ba(B,u,f,v,w)()}))}}return m}function aL(t){return typeof t=="object"||"displayName"in t||"props"in t||"__vccOpts"in t}function W1(t){const s=Vr(Wm),u=Vr(tS),f=se(()=>s.resolve(On(t.to))),m=se(()=>{const{matched:S}=f.value,{length:k}=S,I=S[k-1],D=u.matched;if(!I||!D.length)return-1;const B=D.findIndex(ku.bind(null,I));if(B>-1)return B;const V=X1(S[k-2]);return k>1&&X1(I)===V&&D[D.length-1].path!==V?D.findIndex(ku.bind(null,S[k-2])):B}),v=se(()=>m.value>-1&&hL(u.params,f.value.params)),w=se(()=>m.value>-1&&m.value===u.matched.length-1&&GT(u.params,f.value.params));function o(S={}){return uL(S)?s[On(t.replace)?"replace":"push"](On(t.to)).catch(Td):Promise.resolve()}return{route:f,href:se(()=>f.value.href),isActive:v,isExactActive:w,navigate:o}}const lL=uv({name:"RouterLink",compatConfig:{MODE:3},props:{to:{type:[String,Object],required:!0},replace:Boolean,activeClass:String,exactActiveClass:String,custom:Boolean,ariaCurrentValue:{type:String,default:"page"}},useLink:W1,setup(t,{slots:s}){const u=ko(W1(t)),{options:f}=Vr(Wm),m=se(()=>({[K1(t.activeClass,f.linkActiveClass,"router-link-active")]:u.isActive,[K1(t.exactActiveClass,f.linkExactActiveClass,"router-link-exact-active")]:u.isExactActive}));return()=>{const v=s.default&&s.default(u);return t.custom?v:pe("a",{"aria-current":u.isExactActive?t.ariaCurrentValue:null,href:u.href,onClick:u.navigate,class:m.value},v)}}}),cL=lL;function uL(t){if(!(t.metaKey||t.altKey||t.ctrlKey||t.shiftKey)&&!t.defaultPrevented&&!(t.button!==void 0&&t.button!==0)){if(t.currentTarget&&t.currentTarget.getAttribute){const s=t.currentTarget.getAttribute("target");if(/\b_blank\b/i.test(s))return}return t.preventDefault&&t.preventDefault(),!0}}function hL(t,s){for(const u in s){const f=s[u],m=t[u];if(typeof f=="string"){if(f!==m)return!1}else if(!Qo(m)||m.length!==f.length||f.some((v,w)=>v!==m[w]))return!1}return!0}function X1(t){return t?t.aliasOf?t.aliasOf.path:t.path:""}const K1=(t,s,u)=>t!=null?t:s!=null?s:u,dL=uv({name:"RouterView",inheritAttrs:!1,props:{name:{type:String,default:"default"},route:Object},compatConfig:{MODE:3},setup(t,{attrs:s,slots:u}){const f=Vr(Ly),m=se(()=>t.route||f.value),v=Vr(H1,0),w=se(()=>{let k=On(v);const{matched:I}=m.value;let D;for(;(D=I[k])&&!D.components;)k++;return k}),o=se(()=>m.value.matched[w.value]);Wl(H1,se(()=>w.value+1)),Wl(sL,o),Wl(Ly,m);const S=xt();return Wt(()=>[S.value,o.value,t.name],([k,I,D],[B,V,$])=>{I&&(I.instances[D]=k,V&&V!==I&&k&&k===B&&(I.leaveGuards.size||(I.leaveGuards=V.leaveGuards),I.updateGuards.size||(I.updateGuards=V.updateGuards))),k&&I&&(!V||!ku(I,V)||!B)&&(I.enterCallbacks[D]||[]).forEach(ne=>ne(k))},{flush:"post"}),()=>{const k=m.value,I=t.name,D=o.value,B=D&&D.components[I];if(!B)return Y1(u.default,{Component:B,route:k});const V=D.props[I],$=V?V===!0?k.params:typeof V=="function"?V(k):V:null,oe=pe(B,xi({},$,s,{onVnodeUnmounted:ye=>{ye.component.isUnmounted&&(D.instances[I]=null)},ref:S}));return Y1(u.default,{Component:oe,route:k})||oe}}});function Y1(t,s){if(!t)return null;const u=t(s);return u.length===1?u[0]:u}const fL=dL;function pL(t){const s=Uz(t.routes,t),u=t.parseQuery||rL,f=t.stringifyQuery||Z1,m=t.history,v=dd(),w=dd(),o=dd(),S=BM(ka);let k=ka;fu&&t.scrollBehavior&&"scrollRestoration"in history&&(history.scrollRestoration="manual");const I=H_.bind(null,rt=>""+rt),D=H_.bind(null,iL),B=H_.bind(null,_m);function V(rt,gt){let ot,_t;return HT(rt)?(ot=s.getRecordMatcher(rt),_t=gt):_t=rt,s.addRoute(_t,ot)}function $(rt){const gt=s.getRecordMatcher(rt);gt&&s.removeRoute(gt)}function ne(){return s.getRoutes().map(rt=>rt.record)}function oe(rt){return!!s.getRecordMatcher(rt)}function ye(rt,gt){if(gt=xi({},gt||S.value),typeof rt=="string"){const re=W_(u,rt,gt.path),xe=s.resolve({path:re.path},gt),Fe=m.createHref(re.fullPath);return xi(re,xe,{params:B(xe.params),hash:_m(re.hash),redirectedFrom:void 0,href:Fe})}let ot;if("path"in rt)ot=xi({},rt,{path:W_(u,rt.path,gt.path).path});else{const re=xi({},rt.params);for(const xe in re)re[xe]==null&&delete re[xe];ot=xi({},rt,{params:D(rt.params)}),gt.params=D(gt.params)}const _t=s.resolve(ot,gt),ft=rt.hash||"";_t.params=I(B(_t.params));const sn=gz(f,xi({},rt,{hash:eL(ft),path:_t.path})),un=m.createHref(sn);return xi({fullPath:sn,hash:ft,query:f===Z1?oL(rt.query):rt.query||{}},_t,{redirectedFrom:void 0,href:un})}function te(rt){return typeof rt=="string"?W_(u,rt,S.value.path):xi({},rt)}function Se(rt,gt){if(k!==rt)return Pu(8,{from:gt,to:rt})}function Ae(rt){return Ee(rt)}function ce(rt){return Ae(xi(te(rt),{replace:!0}))}function fe(rt){const gt=rt.matched[rt.matched.length-1];if(gt&&gt.redirect){const{redirect:ot}=gt;let _t=typeof ot=="function"?ot(rt):ot;return typeof _t=="string"&&(_t=_t.includes("?")||_t.includes("#")?_t=te(_t):{path:_t},_t.params={}),xi({query:rt.query,hash:rt.hash,params:"path"in _t?{}:rt.params},_t)}}function Ee(rt,gt){const ot=k=ye(rt),_t=S.value,ft=rt.state,sn=rt.force,un=rt.replace===!0,re=fe(ot);if(re)return Ee(xi(te(re),{state:typeof re=="object"?xi({},ft,re.state):ft,force:sn,replace:un}),gt||ot);const xe=ot;xe.redirectedFrom=gt;let Fe;return!sn&&_z(f,_t,ot)&&(Fe=Pu(16,{to:xe,from:_t}),Ve(_t,_t,!0,!1)),(Fe?Promise.resolve(Fe):Ie(xe,_t)).catch(nt=>Us(nt)?Us(nt,2)?nt:tn(nt):Ge(nt,xe,_t)).then(nt=>{if(nt){if(Us(nt,2))return Ee(xi({replace:un},te(nt.to),{state:typeof nt.to=="object"?xi({},ft,nt.to.state):ft,force:sn}),gt||xe)}else nt=Be(xe,_t,!0,un,ft);return ke(xe,_t,nt),nt})}function Me(rt,gt){const ot=Se(rt,gt);return ot?Promise.reject(ot):Promise.resolve()}function Ie(rt,gt){let ot;const[_t,ft,sn]=mL(rt,gt);ot=X_(_t.reverse(),"beforeRouteLeave",rt,gt);for(const re of _t)re.leaveGuards.forEach(xe=>{ot.push(Ba(xe,rt,gt))});const un=Me.bind(null,rt,gt);return ot.push(un),uu(ot).then(()=>{ot=[];for(const re of v.list())ot.push(Ba(re,rt,gt));return ot.push(un),uu(ot)}).then(()=>{ot=X_(ft,"beforeRouteUpdate",rt,gt);for(const re of ft)re.updateGuards.forEach(xe=>{ot.push(Ba(xe,rt,gt))});return ot.push(un),uu(ot)}).then(()=>{ot=[];for(const re of rt.matched)if(re.beforeEnter&&!gt.matched.includes(re))if(Qo(re.beforeEnter))for(const xe of re.beforeEnter)ot.push(Ba(xe,rt,gt));else ot.push(Ba(re.beforeEnter,rt,gt));return ot.push(un),uu(ot)}).then(()=>(rt.matched.forEach(re=>re.enterCallbacks={}),ot=X_(sn,"beforeRouteEnter",rt,gt),ot.push(un),uu(ot))).then(()=>{ot=[];for(const re of w.list())ot.push(Ba(re,rt,gt));return ot.push(un),uu(ot)}).catch(re=>Us(re,8)?re:Promise.reject(re))}function ke(rt,gt,ot){for(const _t of o.list())_t(rt,gt,ot)}function Be(rt,gt,ot,_t,ft){const sn=Se(rt,gt);if(sn)return sn;const un=gt===ka,re=fu?history.state:{};ot&&(_t||un?m.replace(rt.fullPath,xi({scroll:un&&re&&re.scroll},ft)):m.push(rt.fullPath,ft)),S.value=rt,Ve(rt,gt,ot,un),tn()}let Re;function Ze(){Re||(Re=m.listen((rt,gt,ot)=>{if(!xn.listening)return;const _t=ye(rt),ft=fe(_t);if(ft){Ee(xi(ft,{replace:!0}),_t).catch(Td);return}k=_t;const sn=S.value;fu&&Sz(F1(sn.fullPath,ot.delta),Hm()),Ie(_t,sn).catch(un=>Us(un,12)?un:Us(un,2)?(Ee(un.to,_t).then(re=>{Us(re,20)&&!ot.delta&&ot.type===Fd.pop&&m.go(-1,!1)}).catch(Td),Promise.reject()):(ot.delta&&m.go(-ot.delta,!1),Ge(un,_t,sn))).then(un=>{un=un||Be(_t,sn,!1),un&&(ot.delta&&!Us(un,8)?m.go(-ot.delta,!1):ot.type===Fd.pop&&Us(un,20)&&m.go(-1,!1)),ke(_t,sn,un)}).catch(Td)}))}let Ye=dd(),lt=dd(),Xt;function Ge(rt,gt,ot){tn(rt);const _t=lt.list();return _t.length?_t.forEach(ft=>ft(rt,gt,ot)):console.error(rt),Promise.reject(rt)}function At(){return Xt&&S.value!==ka?Promise.resolve():new Promise((rt,gt)=>{Ye.add([rt,gt])})}function tn(rt){return Xt||(Xt=!rt,Ze(),Ye.list().forEach(([gt,ot])=>rt?ot(rt):gt()),Ye.reset()),rt}function Ve(rt,gt,ot,_t){const{scrollBehavior:ft}=t;if(!fu||!ft)return Promise.resolve();const sn=!ot&&Cz(F1(rt.fullPath,0))||(_t||!ot)&&history.state&&history.state.scroll||null;return ui().then(()=>ft(rt,gt,sn)).then(un=>un&&Tz(un)).catch(un=>Ge(un,rt,gt))}const mt=rt=>m.go(rt);let Bt;const qt=new Set,xn={currentRoute:S,listening:!0,addRoute:V,removeRoute:$,hasRoute:oe,getRoutes:ne,resolve:ye,options:t,push:Ae,replace:ce,go:mt,back:()=>mt(-1),forward:()=>mt(1),beforeEach:v.add,beforeResolve:w.add,afterEach:o.add,onError:lt.add,isReady:At,install(rt){const gt=this;rt.component("RouterLink",cL),rt.component("RouterView",fL),rt.config.globalProperties.$router=gt,Object.defineProperty(rt.config.globalProperties,"$route",{enumerable:!0,get:()=>On(S)}),fu&&!Bt&&S.value===ka&&(Bt=!0,Ae(m.location).catch(ft=>{}));const ot={};for(const ft in ka)ot[ft]=se(()=>S.value[ft]);rt.provide(Wm,gt),rt.provide(tS,ko(ot)),rt.provide(Ly,S);const _t=rt.unmount;qt.add(rt),rt.unmount=function(){qt.delete(rt),qt.size<1&&(k=ka,Re&&Re(),Re=null,S.value=ka,Bt=!1,Xt=!1),_t()}}};return xn}function uu(t){return t.reduce((s,u)=>s.then(()=>u()),Promise.resolve())}function mL(t,s){const u=[],f=[],m=[],v=Math.max(s.matched.length,t.matched.length);for(let w=0;w<v;w++){const o=s.matched[w];o&&(t.matched.find(k=>ku(k,o))?f.push(o):u.push(o));const S=t.matched[w];S&&(s.matched.find(k=>ku(k,S))||m.push(S))}return[u,f,m]}function gL(){return Vr(Wm)}function nS(t,s){return function(){return t.apply(s,arguments)}}const{toString:iS}=Object.prototype,{getPrototypeOf:Iv}=Object,kv=(t=>s=>{const u=iS.call(s);return t[u]||(t[u]=u.slice(8,-1).toLowerCase())})(Object.create(null)),ta=t=>(t=t.toLowerCase(),s=>kv(s)===t),Xm=t=>s=>typeof s===t,{isArray:Vu}=Array,Nd=Xm("undefined");function _L(t){return t!==null&&!Nd(t)&&t.constructor!==null&&!Nd(t.constructor)&&tc(t.constructor.isBuffer)&&t.constructor.isBuffer(t)}const rS=ta("ArrayBuffer");function yL(t){let s;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?s=ArrayBuffer.isView(t):s=t&&t.buffer&&rS(t.buffer),s}const vL=Xm("string"),tc=Xm("function"),oS=Xm("number"),Pv=t=>t!==null&&typeof t=="object",xL=t=>t===!0||t===!1,Wp=t=>{if(kv(t)!=="object")return!1;const s=Iv(t);return(s===null||s===Object.prototype||Object.getPrototypeOf(s)===null)&&!(Symbol.toStringTag in t)&&!(Symbol.iterator in t)},bL=ta("Date"),wL=ta("File"),EL=ta("Blob"),TL=ta("FileList"),SL=t=>Pv(t)&&tc(t.pipe),CL=t=>{const s="[object FormData]";return t&&(typeof FormData=="function"&&t instanceof FormData||iS.call(t)===s||tc(t.toString)&&t.toString()===s)},AL=ta("URLSearchParams"),ML=t=>t.trim?t.trim():t.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function Vd(t,s,{allOwnKeys:u=!1}={}){if(t===null||typeof t>"u")return;let f,m;if(typeof t!="object"&&(t=[t]),Vu(t))for(f=0,m=t.length;f<m;f++)s.call(null,t[f],f,t);else{const v=u?Object.getOwnPropertyNames(t):Object.keys(t),w=v.length;let o;for(f=0;f<w;f++)o=v[f],s.call(null,t[o],o,t)}}function sS(t,s){s=s.toLowerCase();const u=Object.keys(t);let f=u.length,m;for(;f-- >0;)if(m=u[f],s===m.toLowerCase())return m;return null}const aS=(()=>typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global)(),lS=t=>!Nd(t)&&t!==aS;function Ry(){const{caseless:t}=lS(this)&&this||{},s={},u=(f,m)=>{const v=t&&sS(s,m)||m;Wp(s[v])&&Wp(f)?s[v]=Ry(s[v],f):Wp(f)?s[v]=Ry({},f):Vu(f)?s[v]=f.slice():s[v]=f};for(let f=0,m=arguments.length;f<m;f++)arguments[f]&&Vd(arguments[f],u);return s}const IL=(t,s,u,{allOwnKeys:f}={})=>(Vd(s,(m,v)=>{u&&tc(m)?t[v]=nS(m,u):t[v]=m},{allOwnKeys:f}),t),kL=t=>(t.charCodeAt(0)===65279&&(t=t.slice(1)),t),PL=(t,s,u,f)=>{t.prototype=Object.create(s.prototype,f),t.prototype.constructor=t,Object.defineProperty(t,"super",{value:s.prototype}),u&&Object.assign(t.prototype,u)},zL=(t,s,u,f)=>{let m,v,w;const o={};if(s=s||{},t==null)return s;do{for(m=Object.getOwnPropertyNames(t),v=m.length;v-- >0;)w=m[v],(!f||f(w,t,s))&&!o[w]&&(s[w]=t[w],o[w]=!0);t=u!==!1&&Iv(t)}while(t&&(!u||u(t,s))&&t!==Object.prototype);return s},LL=(t,s,u)=>{t=String(t),(u===void 0||u>t.length)&&(u=t.length),u-=s.length;const f=t.indexOf(s,u);return f!==-1&&f===u},RL=t=>{if(!t)return null;if(Vu(t))return t;let s=t.length;if(!oS(s))return null;const u=new Array(s);for(;s-- >0;)u[s]=t[s];return u},DL=(t=>s=>t&&s instanceof t)(typeof Uint8Array<"u"&&Iv(Uint8Array)),OL=(t,s)=>{const f=(t&&t[Symbol.iterator]).call(t);let m;for(;(m=f.next())&&!m.done;){const v=m.value;s.call(t,v[0],v[1])}},BL=(t,s)=>{let u;const f=[];for(;(u=t.exec(s))!==null;)f.push(u);return f},FL=ta("HTMLFormElement"),NL=t=>t.toLowerCase().replace(/[_-\s]([a-z\d])(\w*)/g,function(u,f,m){return f.toUpperCase()+m}),Q1=(({hasOwnProperty:t})=>(s,u)=>t.call(s,u))(Object.prototype),VL=ta("RegExp"),cS=(t,s)=>{const u=Object.getOwnPropertyDescriptors(t),f={};Vd(u,(m,v)=>{s(m,v,t)!==!1&&(f[v]=m)}),Object.defineProperties(t,f)},UL=t=>{cS(t,(s,u)=>{if(tc(t)&&["arguments","caller","callee"].indexOf(u)!==-1)return!1;const f=t[u];if(!!tc(f)){if(s.enumerable=!1,"writable"in s){s.writable=!1;return}s.set||(s.set=()=>{throw Error("Can not rewrite read-only method '"+u+"'")})}})},qL=(t,s)=>{const u={},f=m=>{m.forEach(v=>{u[v]=!0})};return Vu(t)?f(t):f(String(t).split(s)),u},jL=()=>{},$L=(t,s)=>(t=+t,Number.isFinite(t)?t:s),GL=t=>{const s=new Array(10),u=(f,m)=>{if(Pv(f)){if(s.indexOf(f)>=0)return;if(!("toJSON"in f)){s[m]=f;const v=Vu(f)?[]:{};return Vd(f,(w,o)=>{const S=u(w,m+1);!Nd(S)&&(v[o]=S)}),s[m]=void 0,v}}return f};return u(t,0)},Tt={isArray:Vu,isArrayBuffer:rS,isBuffer:_L,isFormData:CL,isArrayBufferView:yL,isString:vL,isNumber:oS,isBoolean:xL,isObject:Pv,isPlainObject:Wp,isUndefined:Nd,isDate:bL,isFile:wL,isBlob:EL,isRegExp:VL,isFunction:tc,isStream:SL,isURLSearchParams:AL,isTypedArray:DL,isFileList:TL,forEach:Vd,merge:Ry,extend:IL,trim:ML,stripBOM:kL,inherits:PL,toFlatObject:zL,kindOf:kv,kindOfTest:ta,endsWith:LL,toArray:RL,forEachEntry:OL,matchAll:BL,isHTMLForm:FL,hasOwnProperty:Q1,hasOwnProp:Q1,reduceDescriptors:cS,freezeMethods:UL,toObjectSet:qL,toCamelCase:NL,noop:jL,toFiniteNumber:$L,findKey:sS,global:aS,isContextDefined:lS,toJSONObject:GL};function si(t,s,u,f,m){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=t,this.name="AxiosError",s&&(this.code=s),u&&(this.config=u),f&&(this.request=f),m&&(this.response=m)}Tt.inherits(si,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:Tt.toJSONObject(this.config),code:this.code,status:this.response&&this.response.status?this.response.status:null}}});const uS=si.prototype,hS={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(t=>{hS[t]={value:t}});Object.defineProperties(si,hS);Object.defineProperty(uS,"isAxiosError",{value:!0});si.from=(t,s,u,f,m,v)=>{const w=Object.create(uS);return Tt.toFlatObject(t,w,function(S){return S!==Error.prototype},o=>o!=="isAxiosError"),si.call(w,t.message,s,u,f,m),w.cause=t,w.name=t.name,v&&Object.assign(w,v),w};var Ko=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function ZL(t){var s=t.default;if(typeof s=="function"){var u=function(){return s.apply(this,arguments)};u.prototype=s.prototype}else u={};return Object.defineProperty(u,"__esModule",{value:!0}),Object.keys(t).forEach(function(f){var m=Object.getOwnPropertyDescriptor(t,f);Object.defineProperty(u,f,m.get?m:{enumerable:!0,get:function(){return t[f]}})}),u}var HL=typeof self=="object"?self.FormData:window.FormData;const WL=HL;function Dy(t){return Tt.isPlainObject(t)||Tt.isArray(t)}function dS(t){return Tt.endsWith(t,"[]")?t.slice(0,-2):t}function J1(t,s,u){return t?t.concat(s).map(function(m,v){return m=dS(m),!u&&v?"["+m+"]":m}).join(u?".":""):s}function XL(t){return Tt.isArray(t)&&!t.some(Dy)}const KL=Tt.toFlatObject(Tt,{},null,function(s){return/^is[A-Z]/.test(s)});function YL(t){return t&&Tt.isFunction(t.append)&&t[Symbol.toStringTag]==="FormData"&&t[Symbol.iterator]}function Km(t,s,u){if(!Tt.isObject(t))throw new TypeError("target must be an object");s=s||new(WL||FormData),u=Tt.toFlatObject(u,{metaTokens:!0,dots:!1,indexes:!1},!1,function(ne,oe){return!Tt.isUndefined(oe[ne])});const f=u.metaTokens,m=u.visitor||I,v=u.dots,w=u.indexes,S=(u.Blob||typeof Blob<"u"&&Blob)&&YL(s);if(!Tt.isFunction(m))throw new TypeError("visitor must be a function");function k($){if($===null)return"";if(Tt.isDate($))return $.toISOString();if(!S&&Tt.isBlob($))throw new si("Blob is not supported. Use a Buffer instead.");return Tt.isArrayBuffer($)||Tt.isTypedArray($)?S&&typeof Blob=="function"?new Blob([$]):Buffer.from($):$}function I($,ne,oe){let ye=$;if($&&!oe&&typeof $=="object"){if(Tt.endsWith(ne,"{}"))ne=f?ne:ne.slice(0,-2),$=JSON.stringify($);else if(Tt.isArray($)&&XL($)||Tt.isFileList($)||Tt.endsWith(ne,"[]")&&(ye=Tt.toArray($)))return ne=dS(ne),ye.forEach(function(Se,Ae){!(Tt.isUndefined(Se)||Se===null)&&s.append(w===!0?J1([ne],Ae,v):w===null?ne:ne+"[]",k(Se))}),!1}return Dy($)?!0:(s.append(J1(oe,ne,v),k($)),!1)}const D=[],B=Object.assign(KL,{defaultVisitor:I,convertValue:k,isVisitable:Dy});function V($,ne){if(!Tt.isUndefined($)){if(D.indexOf($)!==-1)throw Error("Circular reference detected in "+ne.join("."));D.push($),Tt.forEach($,function(ye,te){(!(Tt.isUndefined(ye)||ye===null)&&m.call(s,ye,Tt.isString(te)?te.trim():te,ne,B))===!0&&V(ye,ne?ne.concat(te):[te])}),D.pop()}}if(!Tt.isObject(t))throw new TypeError("data must be an object");return V(t),s}function ew(t){const s={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(t).replace(/[!'()~]|%20|%00/g,function(f){return s[f]})}function zv(t,s){this._pairs=[],t&&Km(t,this,s)}const fS=zv.prototype;fS.append=function(s,u){this._pairs.push([s,u])};fS.toString=function(s){const u=s?function(f){return s.call(this,f,ew)}:ew;return this._pairs.map(function(m){return u(m[0])+"="+u(m[1])},"").join("&")};function QL(t){return encodeURIComponent(t).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function pS(t,s,u){if(!s)return t;const f=u&&u.encode||QL,m=u&&u.serialize;let v;if(m?v=m(s,u):v=Tt.isURLSearchParams(s)?s.toString():new zv(s,u).toString(f),v){const w=t.indexOf("#");w!==-1&&(t=t.slice(0,w)),t+=(t.indexOf("?")===-1?"?":"&")+v}return t}class JL{constructor(){this.handlers=[]}use(s,u,f){return this.handlers.push({fulfilled:s,rejected:u,synchronous:f?f.synchronous:!1,runWhen:f?f.runWhen:null}),this.handlers.length-1}eject(s){this.handlers[s]&&(this.handlers[s]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(s){Tt.forEach(this.handlers,function(f){f!==null&&s(f)})}}const tw=JL,mS={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},eR=typeof URLSearchParams<"u"?URLSearchParams:zv,tR=FormData,nR=(()=>{let t;return typeof navigator<"u"&&((t=navigator.product)==="ReactNative"||t==="NativeScript"||t==="NS")?!1:typeof window<"u"&&typeof document<"u"})(),iR=(()=>typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function")(),vs={isBrowser:!0,classes:{URLSearchParams:eR,FormData:tR,Blob},isStandardBrowserEnv:nR,isStandardBrowserWebWorkerEnv:iR,protocols:["http","https","file","blob","url","data"]};function rR(t,s){return Km(t,new vs.classes.URLSearchParams,Object.assign({visitor:function(u,f,m,v){return vs.isNode&&Tt.isBuffer(u)?(this.append(f,u.toString("base64")),!1):v.defaultVisitor.apply(this,arguments)}},s))}function oR(t){return Tt.matchAll(/\w+|\[(\w*)]/g,t).map(s=>s[0]==="[]"?"":s[1]||s[0])}function sR(t){const s={},u=Object.keys(t);let f;const m=u.length;let v;for(f=0;f<m;f++)v=u[f],s[v]=t[v];return s}function gS(t){function s(u,f,m,v){let w=u[v++];const o=Number.isFinite(+w),S=v>=u.length;return w=!w&&Tt.isArray(m)?m.length:w,S?(Tt.hasOwnProp(m,w)?m[w]=[m[w],f]:m[w]=f,!o):((!m[w]||!Tt.isObject(m[w]))&&(m[w]=[]),s(u,f,m[w],v)&&Tt.isArray(m[w])&&(m[w]=sR(m[w])),!o)}if(Tt.isFormData(t)&&Tt.isFunction(t.entries)){const u={};return Tt.forEachEntry(t,(f,m)=>{s(oR(f),m,u,0)}),u}return null}const aR={"Content-Type":void 0};function lR(t,s,u){if(Tt.isString(t))try{return(s||JSON.parse)(t),Tt.trim(t)}catch(f){if(f.name!=="SyntaxError")throw f}return(u||JSON.stringify)(t)}const Ym={transitional:mS,adapter:["xhr","http"],transformRequest:[function(s,u){const f=u.getContentType()||"",m=f.indexOf("application/json")>-1,v=Tt.isObject(s);if(v&&Tt.isHTMLForm(s)&&(s=new FormData(s)),Tt.isFormData(s))return m&&m?JSON.stringify(gS(s)):s;if(Tt.isArrayBuffer(s)||Tt.isBuffer(s)||Tt.isStream(s)||Tt.isFile(s)||Tt.isBlob(s))return s;if(Tt.isArrayBufferView(s))return s.buffer;if(Tt.isURLSearchParams(s))return u.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),s.toString();let o;if(v){if(f.indexOf("application/x-www-form-urlencoded")>-1)return rR(s,this.formSerializer).toString();if((o=Tt.isFileList(s))||f.indexOf("multipart/form-data")>-1){const S=this.env&&this.env.FormData;return Km(o?{"files[]":s}:s,S&&new S,this.formSerializer)}}return v||m?(u.setContentType("application/json",!1),lR(s)):s}],transformResponse:[function(s){const u=this.transitional||Ym.transitional,f=u&&u.forcedJSONParsing,m=this.responseType==="json";if(s&&Tt.isString(s)&&(f&&!this.responseType||m)){const w=!(u&&u.silentJSONParsing)&&m;try{return JSON.parse(s)}catch(o){if(w)throw o.name==="SyntaxError"?si.from(o,si.ERR_BAD_RESPONSE,this,null,this.response):o}}return s}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:vs.classes.FormData,Blob:vs.classes.Blob},validateStatus:function(s){return s>=200&&s<300},headers:{common:{Accept:"application/json, text/plain, */*"}}};Tt.forEach(["delete","get","head"],function(s){Ym.headers[s]={}});Tt.forEach(["post","put","patch"],function(s){Ym.headers[s]=Tt.merge(aR)});const Lv=Ym,cR=Tt.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),uR=t=>{const s={};let u,f,m;return t&&t.split(`
`).forEach(function(w){m=w.indexOf(":"),u=w.substring(0,m).trim().toLowerCase(),f=w.substring(m+1).trim(),!(!u||s[u]&&cR[u])&&(u==="set-cookie"?s[u]?s[u].push(f):s[u]=[f]:s[u]=s[u]?s[u]+", "+f:f)}),s},nw=Symbol("internals");function fd(t){return t&&String(t).trim().toLowerCase()}function Xp(t){return t===!1||t==null?t:Tt.isArray(t)?t.map(Xp):String(t)}function hR(t){const s=Object.create(null),u=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let f;for(;f=u.exec(t);)s[f[1]]=f[2];return s}function dR(t){return/^[-_a-zA-Z]+$/.test(t.trim())}function iw(t,s,u,f){if(Tt.isFunction(f))return f.call(this,s,u);if(!!Tt.isString(s)){if(Tt.isString(f))return s.indexOf(f)!==-1;if(Tt.isRegExp(f))return f.test(s)}}function fR(t){return t.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(s,u,f)=>u.toUpperCase()+f)}function pR(t,s){const u=Tt.toCamelCase(" "+s);["get","set","has"].forEach(f=>{Object.defineProperty(t,f+u,{value:function(m,v,w){return this[f].call(this,s,m,v,w)},configurable:!0})})}class Qm{constructor(s){s&&this.set(s)}set(s,u,f){const m=this;function v(o,S,k){const I=fd(S);if(!I)throw new Error("header name must be a non-empty string");const D=Tt.findKey(m,I);(!D||m[D]===void 0||k===!0||k===void 0&&m[D]!==!1)&&(m[D||S]=Xp(o))}const w=(o,S)=>Tt.forEach(o,(k,I)=>v(k,I,S));return Tt.isPlainObject(s)||s instanceof this.constructor?w(s,u):Tt.isString(s)&&(s=s.trim())&&!dR(s)?w(uR(s),u):s!=null&&v(u,s,f),this}get(s,u){if(s=fd(s),s){const f=Tt.findKey(this,s);if(f){const m=this[f];if(!u)return m;if(u===!0)return hR(m);if(Tt.isFunction(u))return u.call(this,m,f);if(Tt.isRegExp(u))return u.exec(m);throw new TypeError("parser must be boolean|regexp|function")}}}has(s,u){if(s=fd(s),s){const f=Tt.findKey(this,s);return!!(f&&(!u||iw(this,this[f],f,u)))}return!1}delete(s,u){const f=this;let m=!1;function v(w){if(w=fd(w),w){const o=Tt.findKey(f,w);o&&(!u||iw(f,f[o],o,u))&&(delete f[o],m=!0)}}return Tt.isArray(s)?s.forEach(v):v(s),m}clear(){return Object.keys(this).forEach(this.delete.bind(this))}normalize(s){const u=this,f={};return Tt.forEach(this,(m,v)=>{const w=Tt.findKey(f,v);if(w){u[w]=Xp(m),delete u[v];return}const o=s?fR(v):String(v).trim();o!==v&&delete u[v],u[o]=Xp(m),f[o]=!0}),this}concat(...s){return this.constructor.concat(this,...s)}toJSON(s){const u=Object.create(null);return Tt.forEach(this,(f,m)=>{f!=null&&f!==!1&&(u[m]=s&&Tt.isArray(f)?f.join(", "):f)}),u}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([s,u])=>s+": "+u).join(`
`)}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(s){return s instanceof this?s:new this(s)}static concat(s,...u){const f=new this(s);return u.forEach(m=>f.set(m)),f}static accessor(s){const f=(this[nw]=this[nw]={accessors:{}}).accessors,m=this.prototype;function v(w){const o=fd(w);f[o]||(pR(m,w),f[o]=!0)}return Tt.isArray(s)?s.forEach(v):v(s),this}}Qm.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent"]);Tt.freezeMethods(Qm.prototype);Tt.freezeMethods(Qm);const Hs=Qm;function K_(t,s){const u=this||Lv,f=s||u,m=Hs.from(f.headers);let v=f.data;return Tt.forEach(t,function(o){v=o.call(u,v,m.normalize(),s?s.status:void 0)}),m.normalize(),v}function _S(t){return!!(t&&t.__CANCEL__)}function Ud(t,s,u){si.call(this,t==null?"canceled":t,si.ERR_CANCELED,s,u),this.name="CanceledError"}Tt.inherits(Ud,si,{__CANCEL__:!0});const mR=null;function gR(t,s,u){const f=u.config.validateStatus;!u.status||!f||f(u.status)?t(u):s(new si("Request failed with status code "+u.status,[si.ERR_BAD_REQUEST,si.ERR_BAD_RESPONSE][Math.floor(u.status/100)-4],u.config,u.request,u))}const _R=vs.isStandardBrowserEnv?function(){return{write:function(u,f,m,v,w,o){const S=[];S.push(u+"="+encodeURIComponent(f)),Tt.isNumber(m)&&S.push("expires="+new Date(m).toGMTString()),Tt.isString(v)&&S.push("path="+v),Tt.isString(w)&&S.push("domain="+w),o===!0&&S.push("secure"),document.cookie=S.join("; ")},read:function(u){const f=document.cookie.match(new RegExp("(^|;\\s*)("+u+")=([^;]*)"));return f?decodeURIComponent(f[3]):null},remove:function(u){this.write(u,"",Date.now()-864e5)}}}():function(){return{write:function(){},read:function(){return null},remove:function(){}}}();function yR(t){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(t)}function vR(t,s){return s?t.replace(/\/+$/,"")+"/"+s.replace(/^\/+/,""):t}function yS(t,s){return t&&!yR(s)?vR(t,s):s}const xR=vs.isStandardBrowserEnv?function(){const s=/(msie|trident)/i.test(navigator.userAgent),u=document.createElement("a");let f;function m(v){let w=v;return s&&(u.setAttribute("href",w),w=u.href),u.setAttribute("href",w),{href:u.href,protocol:u.protocol?u.protocol.replace(/:$/,""):"",host:u.host,search:u.search?u.search.replace(/^\?/,""):"",hash:u.hash?u.hash.replace(/^#/,""):"",hostname:u.hostname,port:u.port,pathname:u.pathname.charAt(0)==="/"?u.pathname:"/"+u.pathname}}return f=m(window.location.href),function(w){const o=Tt.isString(w)?m(w):w;return o.protocol===f.protocol&&o.host===f.host}}():function(){return function(){return!0}}();function bR(t){const s=/^([-+\w]{1,25})(:?\/\/|:)/.exec(t);return s&&s[1]||""}function wR(t,s){t=t||10;const u=new Array(t),f=new Array(t);let m=0,v=0,w;return s=s!==void 0?s:1e3,function(S){const k=Date.now(),I=f[v];w||(w=k),u[m]=S,f[m]=k;let D=v,B=0;for(;D!==m;)B+=u[D++],D=D%t;if(m=(m+1)%t,m===v&&(v=(v+1)%t),k-w<s)return;const V=I&&k-I;return V?Math.round(B*1e3/V):void 0}}function rw(t,s){let u=0;const f=wR(50,250);return m=>{const v=m.loaded,w=m.lengthComputable?m.total:void 0,o=v-u,S=f(o),k=v<=w;u=v;const I={loaded:v,total:w,progress:w?v/w:void 0,bytes:o,rate:S||void 0,estimated:S&&w&&k?(w-v)/S:void 0,event:m};I[s?"download":"upload"]=!0,t(I)}}const ER=typeof XMLHttpRequest<"u",TR=ER&&function(t){return new Promise(function(u,f){let m=t.data;const v=Hs.from(t.headers).normalize(),w=t.responseType;let o;function S(){t.cancelToken&&t.cancelToken.unsubscribe(o),t.signal&&t.signal.removeEventListener("abort",o)}Tt.isFormData(m)&&(vs.isStandardBrowserEnv||vs.isStandardBrowserWebWorkerEnv)&&v.setContentType(!1);let k=new XMLHttpRequest;if(t.auth){const V=t.auth.username||"",$=t.auth.password?unescape(encodeURIComponent(t.auth.password)):"";v.set("Authorization","Basic "+btoa(V+":"+$))}const I=yS(t.baseURL,t.url);k.open(t.method.toUpperCase(),pS(I,t.params,t.paramsSerializer),!0),k.timeout=t.timeout;function D(){if(!k)return;const V=Hs.from("getAllResponseHeaders"in k&&k.getAllResponseHeaders()),ne={data:!w||w==="text"||w==="json"?k.responseText:k.response,status:k.status,statusText:k.statusText,headers:V,config:t,request:k};gR(function(ye){u(ye),S()},function(ye){f(ye),S()},ne),k=null}if("onloadend"in k?k.onloadend=D:k.onreadystatechange=function(){!k||k.readyState!==4||k.status===0&&!(k.responseURL&&k.responseURL.indexOf("file:")===0)||setTimeout(D)},k.onabort=function(){!k||(f(new si("Request aborted",si.ECONNABORTED,t,k)),k=null)},k.onerror=function(){f(new si("Network Error",si.ERR_NETWORK,t,k)),k=null},k.ontimeout=function(){let $=t.timeout?"timeout of "+t.timeout+"ms exceeded":"timeout exceeded";const ne=t.transitional||mS;t.timeoutErrorMessage&&($=t.timeoutErrorMessage),f(new si($,ne.clarifyTimeoutError?si.ETIMEDOUT:si.ECONNABORTED,t,k)),k=null},vs.isStandardBrowserEnv){const V=(t.withCredentials||xR(I))&&t.xsrfCookieName&&_R.read(t.xsrfCookieName);V&&v.set(t.xsrfHeaderName,V)}m===void 0&&v.setContentType(null),"setRequestHeader"in k&&Tt.forEach(v.toJSON(),function($,ne){k.setRequestHeader(ne,$)}),Tt.isUndefined(t.withCredentials)||(k.withCredentials=!!t.withCredentials),w&&w!=="json"&&(k.responseType=t.responseType),typeof t.onDownloadProgress=="function"&&k.addEventListener("progress",rw(t.onDownloadProgress,!0)),typeof t.onUploadProgress=="function"&&k.upload&&k.upload.addEventListener("progress",rw(t.onUploadProgress)),(t.cancelToken||t.signal)&&(o=V=>{!k||(f(!V||V.type?new Ud(null,t,k):V),k.abort(),k=null)},t.cancelToken&&t.cancelToken.subscribe(o),t.signal&&(t.signal.aborted?o():t.signal.addEventListener("abort",o)));const B=bR(I);if(B&&vs.protocols.indexOf(B)===-1){f(new si("Unsupported protocol "+B+":",si.ERR_BAD_REQUEST,t));return}k.send(m||null)})},Kp={http:mR,xhr:TR};Tt.forEach(Kp,(t,s)=>{if(t){try{Object.defineProperty(t,"name",{value:s})}catch{}Object.defineProperty(t,"adapterName",{value:s})}});const SR={getAdapter:t=>{t=Tt.isArray(t)?t:[t];const{length:s}=t;let u,f;for(let m=0;m<s&&(u=t[m],!(f=Tt.isString(u)?Kp[u.toLowerCase()]:u));m++);if(!f)throw f===!1?new si(`Adapter ${u} is not supported by the environment`,"ERR_NOT_SUPPORT"):new Error(Tt.hasOwnProp(Kp,u)?`Adapter '${u}' is not available in the build`:`Unknown adapter '${u}'`);if(!Tt.isFunction(f))throw new TypeError("adapter is not a function");return f},adapters:Kp};function Y_(t){if(t.cancelToken&&t.cancelToken.throwIfRequested(),t.signal&&t.signal.aborted)throw new Ud(null,t)}function ow(t){return Y_(t),t.headers=Hs.from(t.headers),t.data=K_.call(t,t.transformRequest),["post","put","patch"].indexOf(t.method)!==-1&&t.headers.setContentType("application/x-www-form-urlencoded",!1),SR.getAdapter(t.adapter||Lv.adapter)(t).then(function(f){return Y_(t),f.data=K_.call(t,t.transformResponse,f),f.headers=Hs.from(f.headers),f},function(f){return _S(f)||(Y_(t),f&&f.response&&(f.response.data=K_.call(t,t.transformResponse,f.response),f.response.headers=Hs.from(f.response.headers))),Promise.reject(f)})}const sw=t=>t instanceof Hs?t.toJSON():t;function zu(t,s){s=s||{};const u={};function f(k,I,D){return Tt.isPlainObject(k)&&Tt.isPlainObject(I)?Tt.merge.call({caseless:D},k,I):Tt.isPlainObject(I)?Tt.merge({},I):Tt.isArray(I)?I.slice():I}function m(k,I,D){if(Tt.isUndefined(I)){if(!Tt.isUndefined(k))return f(void 0,k,D)}else return f(k,I,D)}function v(k,I){if(!Tt.isUndefined(I))return f(void 0,I)}function w(k,I){if(Tt.isUndefined(I)){if(!Tt.isUndefined(k))return f(void 0,k)}else return f(void 0,I)}function o(k,I,D){if(D in s)return f(k,I);if(D in t)return f(void 0,k)}const S={url:v,method:v,data:v,baseURL:w,transformRequest:w,transformResponse:w,paramsSerializer:w,timeout:w,timeoutMessage:w,withCredentials:w,adapter:w,responseType:w,xsrfCookieName:w,xsrfHeaderName:w,onUploadProgress:w,onDownloadProgress:w,decompress:w,maxContentLength:w,maxBodyLength:w,beforeRedirect:w,transport:w,httpAgent:w,httpsAgent:w,cancelToken:w,socketPath:w,responseEncoding:w,validateStatus:o,headers:(k,I)=>m(sw(k),sw(I),!0)};return Tt.forEach(Object.keys(t).concat(Object.keys(s)),function(I){const D=S[I]||m,B=D(t[I],s[I],I);Tt.isUndefined(B)&&D!==o||(u[I]=B)}),u}const vS="1.2.2",Rv={};["object","boolean","number","function","string","symbol"].forEach((t,s)=>{Rv[t]=function(f){return typeof f===t||"a"+(s<1?"n ":" ")+t}});const aw={};Rv.transitional=function(s,u,f){function m(v,w){return"[Axios v"+vS+"] Transitional option '"+v+"'"+w+(f?". "+f:"")}return(v,w,o)=>{if(s===!1)throw new si(m(w," has been removed"+(u?" in "+u:"")),si.ERR_DEPRECATED);return u&&!aw[w]&&(aw[w]=!0,console.warn(m(w," has been deprecated since v"+u+" and will be removed in the near future"))),s?s(v,w,o):!0}};function CR(t,s,u){if(typeof t!="object")throw new si("options must be an object",si.ERR_BAD_OPTION_VALUE);const f=Object.keys(t);let m=f.length;for(;m-- >0;){const v=f[m],w=s[v];if(w){const o=t[v],S=o===void 0||w(o,v,t);if(S!==!0)throw new si("option "+v+" must be "+S,si.ERR_BAD_OPTION_VALUE);continue}if(u!==!0)throw new si("Unknown option "+v,si.ERR_BAD_OPTION)}}const Oy={assertOptions:CR,validators:Rv},Pa=Oy.validators;class ym{constructor(s){this.defaults=s,this.interceptors={request:new tw,response:new tw}}request(s,u){typeof s=="string"?(u=u||{},u.url=s):u=s||{},u=zu(this.defaults,u);const{transitional:f,paramsSerializer:m,headers:v}=u;f!==void 0&&Oy.assertOptions(f,{silentJSONParsing:Pa.transitional(Pa.boolean),forcedJSONParsing:Pa.transitional(Pa.boolean),clarifyTimeoutError:Pa.transitional(Pa.boolean)},!1),m!==void 0&&Oy.assertOptions(m,{encode:Pa.function,serialize:Pa.function},!0),u.method=(u.method||this.defaults.method||"get").toLowerCase();let w;w=v&&Tt.merge(v.common,v[u.method]),w&&Tt.forEach(["delete","get","head","post","put","patch","common"],$=>{delete v[$]}),u.headers=Hs.concat(w,v);const o=[];let S=!0;this.interceptors.request.forEach(function(ne){typeof ne.runWhen=="function"&&ne.runWhen(u)===!1||(S=S&&ne.synchronous,o.unshift(ne.fulfilled,ne.rejected))});const k=[];this.interceptors.response.forEach(function(ne){k.push(ne.fulfilled,ne.rejected)});let I,D=0,B;if(!S){const $=[ow.bind(this),void 0];for($.unshift.apply($,o),$.push.apply($,k),B=$.length,I=Promise.resolve(u);D<B;)I=I.then($[D++],$[D++]);return I}B=o.length;let V=u;for(D=0;D<B;){const $=o[D++],ne=o[D++];try{V=$(V)}catch(oe){ne.call(this,oe);break}}try{I=ow.call(this,V)}catch($){return Promise.reject($)}for(D=0,B=k.length;D<B;)I=I.then(k[D++],k[D++]);return I}getUri(s){s=zu(this.defaults,s);const u=yS(s.baseURL,s.url);return pS(u,s.params,s.paramsSerializer)}}Tt.forEach(["delete","get","head","options"],function(s){ym.prototype[s]=function(u,f){return this.request(zu(f||{},{method:s,url:u,data:(f||{}).data}))}});Tt.forEach(["post","put","patch"],function(s){function u(f){return function(v,w,o){return this.request(zu(o||{},{method:s,headers:f?{"Content-Type":"multipart/form-data"}:{},url:v,data:w}))}}ym.prototype[s]=u(),ym.prototype[s+"Form"]=u(!0)});const Yp=ym;class Dv{constructor(s){if(typeof s!="function")throw new TypeError("executor must be a function.");let u;this.promise=new Promise(function(v){u=v});const f=this;this.promise.then(m=>{if(!f._listeners)return;let v=f._listeners.length;for(;v-- >0;)f._listeners[v](m);f._listeners=null}),this.promise.then=m=>{let v;const w=new Promise(o=>{f.subscribe(o),v=o}).then(m);return w.cancel=function(){f.unsubscribe(v)},w},s(function(v,w,o){f.reason||(f.reason=new Ud(v,w,o),u(f.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(s){if(this.reason){s(this.reason);return}this._listeners?this._listeners.push(s):this._listeners=[s]}unsubscribe(s){if(!this._listeners)return;const u=this._listeners.indexOf(s);u!==-1&&this._listeners.splice(u,1)}static source(){let s;return{token:new Dv(function(m){s=m}),cancel:s}}}const AR=Dv;function MR(t){return function(u){return t.apply(null,u)}}function IR(t){return Tt.isObject(t)&&t.isAxiosError===!0}const By={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(By).forEach(([t,s])=>{By[s]=t});const kR=By;function xS(t){const s=new Yp(t),u=nS(Yp.prototype.request,s);return Tt.extend(u,Yp.prototype,s,{allOwnKeys:!0}),Tt.extend(u,s,null,{allOwnKeys:!0}),u.create=function(m){return xS(zu(t,m))},u}const ur=xS(Lv);ur.Axios=Yp;ur.CanceledError=Ud;ur.CancelToken=AR;ur.isCancel=_S;ur.VERSION=vS;ur.toFormData=Km;ur.AxiosError=si;ur.Cancel=ur.CanceledError;ur.all=function(s){return Promise.all(s)};ur.spread=MR;ur.isAxiosError=IR;ur.mergeConfig=zu;ur.AxiosHeaders=Hs;ur.formToJSON=t=>gS(Tt.isHTMLForm(t)?new FormData(t):t);ur.HttpStatusCode=kR;ur.default=ur;const Vl=ur,Qp=aT("UserStore",()=>{const t=xt({uid:"",email:"",profilePic:""}),s=se(()=>t.value.uid!=="");function u(m,v,w){t.value.uid=m,t.value.email=v,t.value.profilePic=w}async function f(){await Vl.get("/api/logout"),t.value.uid="",t.value.email="",t.value.profilePic=""}return{user:t,isAuthenticated:s,saveUserData:u,logout:f}},{persist:!0});var bS={exports:{}};(function(t,s){(function(u,f){t.exports=f()})(Ko,function(){var u,f,m;function v(o,S){if(!u)u=S;else if(!f)f=S;else{var k="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+u+")(sharedChunk); ("+f+")(sharedChunk); self.onerror = null;",I={};u(I),m=S(I),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(m.workerUrl=window.URL.createObjectURL(new Blob([k],{type:"text/javascript"})))}}v(["exports"],function(o){var S=typeof self<"u"?self:{},k="2.12.1";let I;const D={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(I==null){const n=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{I=process.env.API_URL_REGEX!=null?new RegExp(process.env.API_URL_REGEX):n}catch{I=n}}return I},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){return this.API_URL?this.API_URL.indexOf("https://api.mapbox.cn")===0?"https://events.mapbox.cn/events/v2":this.API_URL.indexOf("https://api.mapbox.com")===0?"https://events.mapbox.com/events/v2":null:null},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},B={supported:!1,testSupport:function(n){!ne&&$&&(oe?ye(n):V=n)}};let V,$,ne=!1,oe=!1;function ye(n){const e=n.createTexture();n.bindTexture(n.TEXTURE_2D,e);try{if(n.texImage2D(n.TEXTURE_2D,0,n.RGBA,n.RGBA,n.UNSIGNED_BYTE,$),n.isContextLost())return;B.supported=!0}catch{}n.deleteTexture(e),ne=!0}S.document&&($=S.document.createElement("img"),$.onload=function(){V&&ye(V),V=null,oe=!0},$.onerror=function(){ne=!0,V=null},$.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const te="01";var Se=Ae;function Ae(n,e,i,a){this.cx=3*n,this.bx=3*(i-n)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(a-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=n,this.p1y=e,this.p2x=i,this.p2y=a}Ae.prototype={sampleCurveX:function(n){return((this.ax*n+this.bx)*n+this.cx)*n},sampleCurveY:function(n){return((this.ay*n+this.by)*n+this.cy)*n},sampleCurveDerivativeX:function(n){return(3*this.ax*n+2*this.bx)*n+this.cx},solveCurveX:function(n,e){if(e===void 0&&(e=1e-6),n<0)return 0;if(n>1)return 1;for(var i=n,a=0;a<8;a++){var c=this.sampleCurveX(i)-n;if(Math.abs(c)<e)return i;var d=this.sampleCurveDerivativeX(i);if(Math.abs(d)<1e-6)break;i-=c/d}var g=0,y=1;for(i=n,a=0;a<20&&(c=this.sampleCurveX(i),!(Math.abs(c-n)<e));a++)n>c?g=i:y=i,i=.5*(y-g)+g;return i},solve:function(n,e){return this.sampleCurveY(this.solveCurveX(n,e))}};var ce=fe;function fe(n,e){this.x=n,this.y=e}fe.prototype={clone:function(){return new fe(this.x,this.y)},add:function(n){return this.clone()._add(n)},sub:function(n){return this.clone()._sub(n)},multByPoint:function(n){return this.clone()._multByPoint(n)},divByPoint:function(n){return this.clone()._divByPoint(n)},mult:function(n){return this.clone()._mult(n)},div:function(n){return this.clone()._div(n)},rotate:function(n){return this.clone()._rotate(n)},rotateAround:function(n,e){return this.clone()._rotateAround(n,e)},matMult:function(n){return this.clone()._matMult(n)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(n){return this.x===n.x&&this.y===n.y},dist:function(n){return Math.sqrt(this.distSqr(n))},distSqr:function(n){var e=n.x-this.x,i=n.y-this.y;return e*e+i*i},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(n){return Math.atan2(this.y-n.y,this.x-n.x)},angleWith:function(n){return this.angleWithSep(n.x,n.y)},angleWithSep:function(n,e){return Math.atan2(this.x*e-this.y*n,this.x*n+this.y*e)},_matMult:function(n){var e=n[2]*this.x+n[3]*this.y;return this.x=n[0]*this.x+n[1]*this.y,this.y=e,this},_add:function(n){return this.x+=n.x,this.y+=n.y,this},_sub:function(n){return this.x-=n.x,this.y-=n.y,this},_mult:function(n){return this.x*=n,this.y*=n,this},_div:function(n){return this.x/=n,this.y/=n,this},_multByPoint:function(n){return this.x*=n.x,this.y*=n.y,this},_divByPoint:function(n){return this.x/=n.x,this.y/=n.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var n=this.y;return this.y=this.x,this.x=-n,this},_rotate:function(n){var e=Math.cos(n),i=Math.sin(n),a=i*this.x+e*this.y;return this.x=e*this.x-i*this.y,this.y=a,this},_rotateAround:function(n,e){var i=Math.cos(n),a=Math.sin(n),c=e.y+a*(this.x-e.x)+i*(this.y-e.y);return this.x=e.x+i*(this.x-e.x)-a*(this.y-e.y),this.y=c,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},fe.convert=function(n){return n instanceof fe?n:Array.isArray(n)?new fe(n[0],n[1]):n};const Ee=Math.PI/180,Me=180/Math.PI;function Ie(n){return n*Ee}function ke(n){return n*Me}const Be=[[0,0],[1,0],[1,1],[0,1]];function Re(n){if(n<=0)return 0;if(n>=1)return 1;const e=n*n,i=e*n;return 4*(n<.5?i:3*(n-e)+i-.75)}function Ze(n,e,i,a){const c=new Se(n,e,i,a);return function(d){return c.solve(d)}}const Ye=Ze(.25,.1,.25,1);function lt(n,e,i){return Math.min(i,Math.max(e,n))}function Xt(n,e,i){return(i=lt((i-n)/(e-n),0,1))*i*(3-2*i)}function Ge(n,e,i){const a=i-e,c=((n-e)%a+a)%a+e;return c===e?i:c}function At(n,e,i){if(!n.length)return i(null,[]);let a=n.length;const c=new Array(n.length);let d=null;n.forEach((g,y)=>{e(g,(b,E)=>{b&&(d=b),c[y]=E,--a==0&&i(d,c)})})}function tn(n){const e=[];for(const i in n)e.push(n[i]);return e}function Ve(n,...e){for(const i of e)for(const a in i)n[a]=i[a];return n}let mt=1;function Bt(){return mt++}function qt(){return function n(e){return e?(e^Math.random()*(16>>e/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,n)}()}function xn(n){return n<=1?1:Math.pow(2,Math.ceil(Math.log(n)/Math.LN2))}function rt(n){return!!n&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(n)}function gt(n,e){n.forEach(i=>{e[i]&&(e[i]=e[i].bind(e))})}function ot(n,e){return n.indexOf(e,n.length-e.length)!==-1}function _t(n,e,i){const a={};for(const c in n)a[c]=e.call(i||this,n[c],c,n);return a}function ft(n,e,i){const a={};for(const c in n)e.call(i||this,n[c],c,n)&&(a[c]=n[c]);return a}function sn(n){return Array.isArray(n)?n.map(sn):typeof n=="object"&&n?_t(n,sn):n}const un={};function re(n){un[n]||(typeof console<"u"&&console.warn(n),un[n]=!0)}function xe(n,e,i){return(i.y-n.y)*(e.x-n.x)>(e.y-n.y)*(i.x-n.x)}function Fe(n){let e=0;for(let i,a,c=0,d=n.length,g=d-1;c<d;g=c++)i=n[c],a=n[g],e+=(a.x-i.x)*(i.y+a.y);return e}function nt(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function yt(n){const e={};if(n.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(i,a,c,d)=>{const g=c||d;return e[a]=!g||g.toLowerCase(),""}),e["max-age"]){const i=parseInt(e["max-age"],10);isNaN(i)?delete e["max-age"]:e["max-age"]=i}return e}let zt=null;function Vt(n){if(zt==null){const e=n.navigator?n.navigator.userAgent:null;zt=!!n.safari||!(!e||!(/\b(iPad|iPhone|iPod)\b/.test(e)||e.match("Safari")&&!e.match("Chrome")))}return zt}function kt(n){try{const e=S[n];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch{return!1}}function bt(n,e){return[n[4*e],n[4*e+1],n[4*e+2],n[4*e+3]]}const Mt="mapbox-tiles";let Ht,et,Rt=500,nn=50;function bn(){try{return S.caches}catch{}}function zn(){bn()&&!Ht&&(Ht=S.caches.open(Mt))}function Cn(n){const e=n.indexOf("?");if(e<0)return n;const i=function(c){const d=c.indexOf("?");return d>0?c.slice(d+1).split("&"):[]}(n),a=i.filter(c=>{const d=c.split("=");return d[0]==="language"||d[0]==="worldview"});return a.length?`${n.slice(0,e)}?${a.join("&")}`:n.slice(0,e)}let jn=1/0;const Wn={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};typeof Object.freeze=="function"&&Object.freeze(Wn);class Bi extends Error{constructor(e,i,a){i===401&&oo(a)&&(e+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(e),this.status=i,this.url=a}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const qi=nt()?()=>self.worker&&self.worker.referrer:()=>(S.location.protocol==="blob:"?S.parent:S).location.href,ji=function(n,e){if(!(/^file:/.test(i=n.url)||/^file:/.test(qi())&&!/^\w+:/.test(i))){if(S.fetch&&S.Request&&S.AbortController&&S.Request.prototype.hasOwnProperty("signal"))return function(a,c){const d=new S.AbortController,g=new S.Request(a.url,{method:a.method||"GET",body:a.body,credentials:a.credentials,headers:a.headers,referrer:qi(),signal:d.signal});let y=!1,b=!1;const E=(A=g.url).indexOf("sku=")>0&&oo(A);var A;a.type==="json"&&g.headers.set("Accept","application/json");const P=(O,F,q)=>{if(b)return;if(O&&O.message!=="SecurityError"&&re(O),F&&q)return z(F);const Z=Date.now();S.fetch(g).then(le=>{if(le.ok){const ge=E?le.clone():null;return z(le,ge,Z)}return c(new Bi(le.statusText,le.status,a.url))}).catch(le=>{le.code!==20&&c(new Error(le.message))})},z=(O,F,q)=>{(a.type==="arrayBuffer"?O.arrayBuffer():a.type==="json"?O.json():O.text()).then(Z=>{b||(F&&q&&function(le,ge,ae){if(zn(),!Ht)return;const de={status:ge.status,statusText:ge.statusText,headers:new S.Headers};ge.headers.forEach(($e,je)=>de.headers.set(je,$e));const be=yt(ge.headers.get("Cache-Control")||"");if(be["no-store"])return;be["max-age"]&&de.headers.set("Expires",new Date(ae+1e3*be["max-age"]).toUTCString());const _e=de.headers.get("Expires");_e&&(new Date(_e).getTime()-ae<42e4||function($e,je){if(et===void 0)try{new Response(new ReadableStream),et=!0}catch{et=!1}et?je($e.body):$e.blob().then(je)}(ge,$e=>{const je=new S.Response($e,de);zn(),Ht&&Ht.then(it=>it.put(Cn(le.url),je)).catch(it=>re(it.message))}))}(g,F,q),y=!0,c(null,Z,O.headers.get("Cache-Control"),O.headers.get("Expires")))}).catch(Z=>{b||c(new Error(Z.message))})};return E?function(O,F){if(zn(),!Ht)return F(null);const q=Cn(O.url);Ht.then(Z=>{Z.match(q).then(le=>{const ge=function(ae){if(!ae)return!1;const de=new Date(ae.headers.get("Expires")||0),be=yt(ae.headers.get("Cache-Control")||"");return de>Date.now()&&!be["no-cache"]}(le);Z.delete(q),ge&&Z.put(q,le.clone()),F(null,le,ge)}).catch(F)}).catch(F)}(g,P):P(null,null),{cancel:()=>{b=!0,y||d.abort()}}}(n,e);if(nt()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",n,e,void 0,!0)}var i;return function(a,c){const d=new S.XMLHttpRequest;d.open(a.method||"GET",a.url,!0),a.type==="arrayBuffer"&&(d.responseType="arraybuffer");for(const g in a.headers)d.setRequestHeader(g,a.headers[g]);return a.type==="json"&&(d.responseType="text",d.setRequestHeader("Accept","application/json")),d.withCredentials=a.credentials==="include",d.onerror=()=>{c(new Error(d.statusText))},d.onload=()=>{if((d.status>=200&&d.status<300||d.status===0)&&d.response!==null){let g=d.response;if(a.type==="json")try{g=JSON.parse(d.response)}catch(y){return c(y)}c(null,g,d.getResponseHeader("Cache-Control"),d.getResponseHeader("Expires"))}else c(new Bi(d.statusText,d.status,a.url))},d.send(a.body),{cancel:()=>d.abort()}}(n,e)},tr=function(n,e){return ji(Ve(n,{type:"arrayBuffer"}),e)};function Ei(n){const e=S.document.createElement("a");return e.href=n,e.protocol===S.document.location.protocol&&e.host===S.document.location.host}const $i="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let hr,Ar;hr=[],Ar=0;const Mr=function(n,e){if(B.supported&&(n.headers||(n.headers={}),n.headers.accept="image/webp,*/*"),Ar>=D.MAX_PARALLEL_IMAGE_REQUESTS){const d={requestParameters:n,callback:e,cancelled:!1,cancel(){this.cancelled=!0}};return hr.push(d),d}Ar++;let i=!1;const a=()=>{if(!i)for(i=!0,Ar--;hr.length&&Ar<D.MAX_PARALLEL_IMAGE_REQUESTS;){const d=hr.shift(),{requestParameters:g,callback:y,cancelled:b}=d;b||(d.cancel=Mr(g,y).cancel)}},c=tr(n,(d,g,y,b)=>{a(),d?e(d):g&&(S.createImageBitmap?function(E,A){const P=new S.Blob([new Uint8Array(E)],{type:"image/png"});S.createImageBitmap(P).then(z=>{A(null,z)}).catch(z=>{A(new Error(`Could not load image because of ${z.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(g,(E,A)=>e(E,A,y,b)):function(E,A){const P=new S.Image,z=S.URL;P.onload=()=>{A(null,P),z.revokeObjectURL(P.src),P.onload=null,S.requestAnimationFrame(()=>{P.src=$i})},P.onerror=()=>A(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const O=new S.Blob([new Uint8Array(E)],{type:"image/png"});P.src=E.byteLength?z.createObjectURL(O):$i}(g,(E,A)=>e(E,A,y,b)))});return{cancel:()=>{c.cancel(),a()}}},fo="NO_ACCESS_TOKEN";function xr(n){return n.indexOf("mapbox:")===0}function oo(n){return D.API_URL_REGEX.test(n)}function Jo(n){return D.API_CDN_URL_REGEX.test(n)}function so(n){return D.API_STYLE_REGEX.test(n)&&!ct(n)}function ct(n){return D.API_SPRITE_REGEX.test(n)}const Kt=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function hn(n){const e=n.match(Kt);if(!e)throw new Error("Unable to parse URL object");return{protocol:e[1],authority:e[2],path:e[3]||"/",params:e[4]?e[4].split("&"):[]}}function En(n){const e=n.params.length?`?${n.params.join("&")}`:"";return`${n.protocol}://${n.authority}${n.path}${e}`}function In(n){if(!n)return null;const e=n.split(".");if(!e||e.length!==3)return null;try{return JSON.parse(decodeURIComponent(S.atob(e[1]).split("").map(i=>"%"+("00"+i.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch{return null}}class X{constructor(e){this.type=e,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(e){const i=In(D.ACCESS_TOKEN);let a="";return a=i&&i.u?S.btoa(encodeURIComponent(i.u).replace(/%([0-9A-F]{2})/g,(c,d)=>String.fromCharCode(Number("0x"+d)))):D.ACCESS_TOKEN||"",e?`mapbox.eventData.${e}:${a}`:`mapbox.eventData:${a}`}fetchEventData(){const e=kt("localStorage"),i=this.getStorageKey(),a=this.getStorageKey("uuid");if(e)try{const c=S.localStorage.getItem(i);c&&(this.eventData=JSON.parse(c));const d=S.localStorage.getItem(a);d&&(this.anonId=d)}catch{re("Unable to read from LocalStorage")}}saveEventData(){const e=kt("localStorage"),i=this.getStorageKey(),a=this.getStorageKey("uuid");if(e)try{S.localStorage.setItem(a,this.anonId),Object.keys(this.eventData).length>=1&&S.localStorage.setItem(i,JSON.stringify(this.eventData))}catch{re("Unable to write to LocalStorage")}}processRequests(e){}postEvent(e,i,a,c){if(!D.EVENTS_URL)return;const d=hn(D.EVENTS_URL);d.params.push(`access_token=${c||D.ACCESS_TOKEN||""}`);const g={event:this.type,created:new Date(e).toISOString()},y=i?Ve(g,i):g,b={url:En(d),headers:{"Content-Type":"text/plain"},body:JSON.stringify([y])};this.pendingRequest=function(E,A){return ji(Ve(E,{method:"POST"}),A)}(b,E=>{this.pendingRequest=null,a(E),this.saveEventData(),this.processRequests(c)})}queueRequest(e,i){this.queue.push(e),this.processRequests(i)}}const N=new class extends X{constructor(n){super("appUserTurnstile"),this._customAccessToken=n}postTurnstileEvent(n,e){D.EVENTS_URL&&D.ACCESS_TOKEN&&Array.isArray(n)&&n.some(i=>xr(i)||oo(i))&&this.queueRequest(Date.now(),e)}processRequests(n){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const e=In(D.ACCESS_TOKEN),i=e?e.u:D.ACCESS_TOKEN;let a=i!==this.eventData.tokenU;rt(this.anonId)||(this.anonId=qt(),a=!0);const c=this.queue.shift();if(this.eventData.lastSuccess){const d=new Date(this.eventData.lastSuccess),g=new Date(c),y=(c-this.eventData.lastSuccess)/864e5;a=a||y>=1||y<-1||d.getDate()!==g.getDate()}else a=!0;a?this.postEvent(c,{sdkIdentifier:"mapbox-gl-js",sdkVersion:k,skuId:te,"enabled.telemetry":!1,userId:this.anonId},d=>{d||(this.eventData.lastSuccess=c,this.eventData.tokenU=i)},n):this.processRequests()}},j=N.postTurnstileEvent.bind(N),Y=new class extends X{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(n,e,i,a){this.skuToken=e,this.errorCb=a,D.EVENTS_URL&&(i||D.ACCESS_TOKEN?this.queueRequest({id:n,timestamp:Date.now()},i):this.errorCb(new Error(fo)))}processRequests(n){if(this.pendingRequest||this.queue.length===0)return;const{id:e,timestamp:i}=this.queue.shift();e&&this.success[e]||(this.anonId||this.fetchEventData(),rt(this.anonId)||(this.anonId=qt()),this.postEvent(i,{sdkIdentifier:"mapbox-gl-js",sdkVersion:k,skuId:te,skuToken:this.skuToken,userId:this.anonId},a=>{a?this.errorCb(a):e&&(this.success[e]=!0)},n))}},ue=Y.postMapLoadEvent.bind(Y),Te=new class extends X{constructor(){super("gljs.performance")}postPerformanceEvent(n,e){D.EVENTS_URL&&(n||D.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:e},n)}processRequests(n){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:e,performanceData:i}=this.queue.shift(),a=function(c){const d=S.performance.getEntriesByType("resource"),g=S.performance.getEntriesByType("mark"),y=function(z){const O={};if(z){for(const F in z)if(F!=="other")for(const q of z[F]){const Z=`${F}ResolveRangeMin`,le=`${F}ResolveRangeMax`,ge=`${F}RequestCount`,ae=`${F}RequestCachedCount`;O[Z]=Math.min(O[Z]||1/0,q.startTime),O[le]=Math.max(O[le]||-1/0,q.responseEnd);const de=be=>{O[be]===void 0&&(O[be]=0),++O[be]};q.transferSize!==void 0&&q.transferSize===0&&de(ae),de(ge)}}return O}(function(z,O){const F={};if(z)for(const q of z){const Z=O(q);F[Z]===void 0&&(F[Z]=[]),F[Z].push(q)}return F}(d,wt)),b=S.devicePixelRatio,E=S.navigator.connection||S.navigator.mozConnection||S.navigator.webkitConnection,A={counters:[],metadata:[],attributes:[]},P=(z,O,F)=>{F!=null&&z.push({name:O,value:F.toString()})};for(const z in y)P(A.counters,z,y[z]);if(c.interactionRange[0]!==1/0&&c.interactionRange[1]!==-1/0&&(P(A.counters,"interactionRangeMin",c.interactionRange[0]),P(A.counters,"interactionRangeMax",c.interactionRange[1])),g)for(const z of Object.keys(ht)){const O=ht[z],F=g.find(q=>q.name===O);F&&P(A.counters,O,F.startTime)}return P(A.counters,"visibilityHidden",c.visibilityHidden),P(A.attributes,"style",function(z){if(z)for(const O of z){const F=O.name.split("?")[0];if(so(F)){const q=F.split("/").slice(-2);if(q.length===2)return`mapbox://styles/${q[0]}/${q[1]}`}}}(d)),P(A.attributes,"terrainEnabled",c.terrainEnabled?"true":"false"),P(A.attributes,"fogEnabled",c.fogEnabled?"true":"false"),P(A.attributes,"projection",c.projection),P(A.attributes,"zoom",c.zoom),P(A.metadata,"devicePixelRatio",b),P(A.metadata,"connectionEffectiveType",E?E.effectiveType:void 0),P(A.metadata,"navigatorUserAgent",S.navigator.userAgent),P(A.metadata,"screenWidth",S.screen.width),P(A.metadata,"screenHeight",S.screen.height),P(A.metadata,"windowWidth",S.innerWidth),P(A.metadata,"windowHeight",S.innerHeight),P(A.metadata,"mapWidth",c.width/b),P(A.metadata,"mapHeight",c.height/b),P(A.metadata,"webglRenderer",c.renderer),P(A.metadata,"webglVendor",c.vendor),P(A.metadata,"sdkVersion",k),P(A.metadata,"sdkIdentifier","mapbox-gl-js"),A}(i);for(const c of a.metadata);for(const c of a.counters);for(const c of a.attributes);this.postEvent(e,a,()=>{},n)}},Oe=Te.postPerformanceEvent.bind(Te),ze=new class extends X{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(n,e,i,a){if(!D.API_URL||!D.SESSION_PATH)return;const c=hn(D.API_URL+D.SESSION_PATH);c.params.push(`sku=${e||""}`),c.params.push(`access_token=${a||D.ACCESS_TOKEN||""}`);const d={url:En(c),headers:{"Content-Type":"text/plain"}};this.pendingRequest=function(g,y){return ji(Ve(g,{method:"GET"}),y)}(d,g=>{this.pendingRequest=null,i(g),this.saveEventData(),this.processRequests(a)})}getSessionAPI(n,e,i,a){this.skuToken=e,this.errorCb=a,D.SESSION_PATH&&D.API_URL&&(i||D.ACCESS_TOKEN?this.queueRequest({id:n,timestamp:Date.now()},i):this.errorCb(new Error(fo)))}processRequests(n){if(this.pendingRequest||this.queue.length===0)return;const{id:e,timestamp:i}=this.queue.shift();e&&this.success[e]||this.getSession(i,this.skuToken,a=>{a?this.errorCb(a):e&&(this.success[e]=!0)},n)}},Ce=ze.getSessionAPI.bind(ze),Ne=new Set,ht={create:"create",load:"load",fullLoad:"fullLoad"},Ft={mark(n){S.performance.mark(n)},measure(n,e,i){S.performance.measure(n,e,i)}};function wt(n){const e=n.name.split("?")[0];return Jo(e)&&e.includes("mapbox-gl.js")?"javascript":Jo(e)&&e.includes("mapbox-gl.css")?"css":function(i){return D.API_FONTS_REGEX.test(i)}(e)?"fontRange":ct(e)?"sprite":so(e)?"style":function(i){return D.API_TILEJSON_REGEX.test(i)}(e)?"tilejson":"other"}const an=S.performance;function on(n){const e=n?n.url.toString():void 0;return an.getEntriesByName(e)}let rn,fn,me,Lt;const at={now:()=>me!==void 0?me:S.performance.now(),setNow(n){me=n},restoreNow(){me=void 0},frame(n){const e=S.requestAnimationFrame(n);return{cancel:()=>S.cancelAnimationFrame(e)}},getImageData(n,e=0){const{width:i,height:a}=n;Lt||(Lt=S.document.createElement("canvas"));const c=Lt.getContext("2d",{willReadFrequently:!0});if(!c)throw new Error("failed to create canvas 2d context");return(i>Lt.width||a>Lt.height)&&(Lt.width=i,Lt.height=a),c.clearRect(-e,-e,i+2*e,a+2*e),c.drawImage(n,0,0,i,a),c.getImageData(-e,-e,i+2*e,a+2*e)},resolveURL:n=>(rn||(rn=S.document.createElement("a")),rn.href=n,rn.href),get devicePixelRatio(){return S.devicePixelRatio},get prefersReducedMotion(){return!!S.matchMedia&&(fn==null&&(fn=S.matchMedia("(prefers-reduced-motion: reduce)")),fn.matches)}};function Yt(n,e,i){i[n]&&i[n].indexOf(e)!==-1||(i[n]=i[n]||[],i[n].push(e))}function yn(n,e,i){if(i&&i[n]){const a=i[n].indexOf(e);a!==-1&&i[n].splice(a,1)}}class Bn{constructor(e,i={}){Ve(this,i),this.type=e}}class ai extends Bn{constructor(e,i={}){super("error",Ve({error:e},i))}}class mi{on(e,i){return this._listeners=this._listeners||{},Yt(e,i,this._listeners),this}off(e,i){return yn(e,i,this._listeners),yn(e,i,this._oneTimeListeners),this}once(e,i){return i?(this._oneTimeListeners=this._oneTimeListeners||{},Yt(e,i,this._oneTimeListeners),this):new Promise(a=>this.once(e,a))}fire(e,i){typeof e=="string"&&(e=new Bn(e,i||{}));const a=e.type;if(this.listens(a)){e.target=this;const c=this._listeners&&this._listeners[a]?this._listeners[a].slice():[];for(const y of c)y.call(this,e);const d=this._oneTimeListeners&&this._oneTimeListeners[a]?this._oneTimeListeners[a].slice():[];for(const y of d)yn(a,y,this._oneTimeListeners),y.call(this,e);const g=this._eventedParent;g&&(Ve(e,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),g.fire(e))}else e instanceof ai&&console.error(e.error);return this}listens(e){return!!(this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e))}setEventedParent(e,i){return this._eventedParent=e,this._eventedParentData=i,this}}var tt=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360,"units":"degrees"},"pitch":{"type":"number","default":0,"units":"degrees"},"light":{"type":"light"},"terrain":{"type":"terrain"},"fog":{"type":"fog"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":{},"mapbox":{}},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":{}}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":{}}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":{}}},"url":{"required":true,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"hillshade":{},"background":{},"sky":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky"],"layout_background":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","private":true,"default":0,"minimum":0,"maximum":1,"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":{},"round":{},"square":{}},"default":"butt","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":{},"round":{},"miter":{}},"default":"miter","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"requires":[{"line-join":"miter"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"requires":[{"line-join":"round"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":{},"line":{},"line-center":{}},"default":"point","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"units":"pixels","requires":[{"symbol-placement":"line"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":{},"viewport-y":{},"source":{}},"default":"auto","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"units":"factor of the original icon size","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":{},"width":{},"height":{},"both":{}},"default":"none","requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"units":"pixels","requires":["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"requires":["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"units":"ems","requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":{},"left":{},"center":{},"right":{}},"default":"center","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","units":"ems","default":0,"requires":["text-field"],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["text-field",{"!":"text-variable-anchor"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"units":"degrees","requires":["text-field",{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":{},"vertical":{}},"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"requires":["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":{},"uppercase":{},"lowercase":{}},"default":"none","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","units":"ems","length":2,"default":[0,0],"requires":["text-field",{"!":"text-radial-offset"}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"requires":["text-field","icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},"in":{},"!in":{},"all":{},"any":{},"none":{},"has":{},"!has":{},"within":{}}},"geometry_type":{"type":"enum","values":{"Point":{},"LineString":{},"Polygon":{}}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":{},"exponential":{},"interval":{},"categorical":{}},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":{},"lab":{},"hcl":{}},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":{},"viewport":{}},"property-type":"data-constant","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":{},"equalEarth":{},"equirectangular":{},"lambertConformalConic":{},"mercator":{},"naturalEarth":{},"winkelTripel":{},"globe":{}},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["source"]}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"requires":[{"!":"fill-pattern"},{"fill-antialias":true}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-extrusion-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-extrusion-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"requires":["fill-extrusion-height"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","private":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["fill-extrusion-edge-radius"]}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"line-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["line-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"transition":false,"units":"line widths","requires":[{"!":"line-pattern"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{"type":"color","transition":false,"requires":[{"!":"line-pattern"},{"source":"geojson","has":{"lineMetrics":true}}],"expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"transition":false,"requires":[{"source":"geojson","has":{"lineMetrics":true}}],"property-type":"constant"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["circle-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"transition":false,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"transition":false,"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["icon-image","icon-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["text-field","text-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"units":"degrees","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":{},"nearest":{}},"default":"linear","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"transition":false,"units":"milliseconds","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"transition":false,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"background-pattern"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":{},"atmosphere":{}},"default":"atmosphere","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"requires":[{"sky-type":"atmosphere"}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","requires":[{"sky-type":"atmosphere"}],"default":10,"minimum":0,"maximum":100,"transition":false,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","requires":[{"sky-type":"gradient"}],"value":"number","default":[0,0],"length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","requires":[{"sky-type":"gradient"}],"default":90,"minimum":0,"maximum":180,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"transition":false,"requires":[{"sky-type":"gradient"}],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0,"units":"milliseconds"},"delay":{"type":"number","default":0,"minimum":0,"units":"milliseconds"}},"property-type":{"data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function Ro(n,...e){for(const i of e)for(const a in i)n[a]=i[a];return n}function Gi(n){return n instanceof Number||n instanceof String||n instanceof Boolean?n.valueOf():n}function Do(n){if(Array.isArray(n))return n.map(Do);if(n instanceof Object&&!(n instanceof Number||n instanceof String||n instanceof Boolean)){const e={};for(const i in n)e[i]=Do(n[i]);return e}return Gi(n)}class hg extends Error{constructor(e,i){super(i),this.message=i,this.key=e}}var qr=hg;class ic{constructor(e,i=[]){this.parent=e,this.bindings={};for(const[a,c]of i)this.bindings[a]=c}concat(e){return new ic(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}var jd=ic;const br={kind:"null"},jt={kind:"number"},Fn={kind:"string"},Ln={kind:"boolean"},ao={kind:"color"},Ts={kind:"object"},kn={kind:"value"},Ha={kind:"collator"},na={kind:"formatted"},es={kind:"resolvedImage"};function nr(n,e){return{kind:"array",itemType:n,N:e}}function Ti(n){if(n.kind==="array"){const e=Ti(n.itemType);return typeof n.N=="number"?`array<${e}, ${n.N}>`:n.itemType.kind==="value"?"array":`array<${e}>`}return n.kind}const po=[br,jt,Fn,Ln,ao,na,Ts,nr(kn),es];function Wa(n,e){if(e.kind==="error")return null;if(n.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!Wa(n.itemType,e.itemType))&&(typeof n.N!="number"||n.N===e.N))return null}else{if(n.kind===e.kind)return null;if(n.kind==="value"){for(const i of po)if(!Wa(i,e))return null}}return`Expected ${Ti(n)} but found ${Ti(e)} instead.`}function Xa(n,e){return e.some(i=>i.kind===n.kind)}function Ka(n,e){return e.some(i=>i==="null"?n===null:i==="array"?Array.isArray(n):i==="object"?n&&!Array.isArray(n)&&typeof n=="object":i===typeof n)}var Ya,qu={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function ts(n){return(n=Math.round(n))<0?0:n>255?255:n}function Qa(n){return ts(n[n.length-1]==="%"?parseFloat(n)/100*255:parseInt(n))}function rc(n){return(e=n[n.length-1]==="%"?parseFloat(n)/100:parseFloat(n))<0?0:e>1?1:e;var e}function ju(n,e,i){return i<0?i+=1:i>1&&(i-=1),6*i<1?n+(e-n)*i*6:2*i<1?e:3*i<2?n+(e-n)*(2/3-i)*6:n}try{Ya={}.parseCSSColor=function(n){var e,i=n.replace(/ /g,"").toLowerCase();if(i in qu)return qu[i].slice();if(i[0]==="#")return i.length===4?(e=parseInt(i.substr(1),16))>=0&&e<=4095?[(3840&e)>>4|(3840&e)>>8,240&e|(240&e)>>4,15&e|(15&e)<<4,1]:null:i.length===7&&(e=parseInt(i.substr(1),16))>=0&&e<=16777215?[(16711680&e)>>16,(65280&e)>>8,255&e,1]:null;var a=i.indexOf("("),c=i.indexOf(")");if(a!==-1&&c+1===i.length){var d=i.substr(0,a),g=i.substr(a+1,c-(a+1)).split(","),y=1;switch(d){case"rgba":if(g.length!==4)return null;y=rc(g.pop());case"rgb":return g.length!==3?null:[Qa(g[0]),Qa(g[1]),Qa(g[2]),y];case"hsla":if(g.length!==4)return null;y=rc(g.pop());case"hsl":if(g.length!==3)return null;var b=(parseFloat(g[0])%360+360)%360/360,E=rc(g[1]),A=rc(g[2]),P=A<=.5?A*(E+1):A+E-A*E,z=2*A-P;return[ts(255*ju(z,P,b+1/3)),ts(255*ju(z,P,b)),ts(255*ju(z,P,b-1/3)),y];default:return null}}return null}}catch{}class Ir{constructor(e,i,a,c=1){this.r=e,this.g=i,this.b=a,this.a=c}static parse(e){if(!e)return;if(e instanceof Ir)return e;if(typeof e!="string")return;const i=Ya(e);return i?new Ir(i[0]/255*i[3],i[1]/255*i[3],i[2]/255*i[3],i[3]):void 0}toString(){const[e,i,a,c]=this.toArray();return`rgba(${Math.round(e)},${Math.round(i)},${Math.round(a)},${c})`}toArray(){const{r:e,g:i,b:a,a:c}=this;return c===0?[0,0,0,0]:[255*e/c,255*i/c,255*a/c,c]}toArray01(){const{r:e,g:i,b:a,a:c}=this;return c===0?[0,0,0,0]:[e/c,i/c,a/c,c]}toArray01PremultipliedAlpha(){const{r:e,g:i,b:a,a:c}=this;return[e,i,a,c]}}Ir.black=new Ir(0,0,0,1),Ir.white=new Ir(1,1,1,1),Ir.transparent=new Ir(0,0,0,0),Ir.red=new Ir(1,0,0,1),Ir.blue=new Ir(0,0,1,1);var ki=Ir;class Ja{constructor(e,i,a){this.sensitivity=e?i?"variant":"case":i?"accent":"base",this.locale=a,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,i){return this.collator.compare(e,i)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class $u{constructor(e,i,a,c,d){this.text=e.normalize?e.normalize():e,this.image=i,this.scale=a,this.fontStack=c,this.textColor=d}}class ir{constructor(e){this.sections=e}static fromString(e){return new ir([new $u(e,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(e=>e.text.length!==0||e.image&&e.image.name.length!==0)}static factory(e){return e instanceof ir?e:ir.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map(e=>e.text).join("")}serialize(){const e=["format"];for(const i of this.sections){if(i.image){e.push(["image",i.image.name]);continue}e.push(i.text);const a={};i.fontStack&&(a["text-font"]=["literal",i.fontStack.split(",")]),i.scale&&(a["font-scale"]=i.scale),i.textColor&&(a["text-color"]=["rgba"].concat(i.textColor.toArray())),e.push(a)}return e}}class Wr{constructor(e){this.name=e.name,this.available=e.available}toString(){return this.name}static fromString(e){return e?new Wr({name:e,available:!1}):null}serialize(){return["image",this.name]}}function $d(n,e,i,a){return typeof n=="number"&&n>=0&&n<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof i=="number"&&i>=0&&i<=255?a===void 0||typeof a=="number"&&a>=0&&a<=1?null:`Invalid rgba value [${[n,e,i,a].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof a=="number"?[n,e,i,a]:[n,e,i]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function oc(n){if(n===null||typeof n=="string"||typeof n=="boolean"||typeof n=="number"||n instanceof ki||n instanceof Ja||n instanceof ir||n instanceof Wr)return!0;if(Array.isArray(n)){for(const e of n)if(!oc(e))return!1;return!0}if(typeof n=="object"){for(const e in n)if(!oc(n[e]))return!1;return!0}return!1}function Zi(n){if(n===null)return br;if(typeof n=="string")return Fn;if(typeof n=="boolean")return Ln;if(typeof n=="number")return jt;if(n instanceof ki)return ao;if(n instanceof Ja)return Ha;if(n instanceof ir)return na;if(n instanceof Wr)return es;if(Array.isArray(n)){const e=n.length;let i;for(const a of n){const c=Zi(a);if(i){if(i===c)continue;i=kn;break}i=c}return nr(i||kn,e)}return Ts}function el(n){const e=typeof n;return n===null?"":e==="string"||e==="number"||e==="boolean"?String(n):n instanceof ki||n instanceof ir||n instanceof Wr?n.toString():JSON.stringify(n)}class Gu{constructor(e,i){this.type=e,this.value=i}static parse(e,i){if(e.length!==2)return i.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!oc(e[1]))return i.error("invalid value");const a=e[1];let c=Zi(a);const d=i.expectedType;return c.kind!=="array"||c.N!==0||!d||d.kind!=="array"||typeof d.N=="number"&&d.N!==0||(c=d),new Gu(c,a)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof ki?["rgba"].concat(this.value.toArray()):this.value instanceof ir?this.value.serialize():this.value}}var tl=Gu,Ji=class{constructor(n){this.name="ExpressionEvaluationError",this.message=n}toJSON(){return this.message}};const ia={string:Fn,number:jt,boolean:Ln,object:Ts};class Zu{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");let a,c=1;const d=e[0];if(d==="array"){let y,b;if(e.length>2){const E=e[1];if(typeof E!="string"||!(E in ia)||E==="object")return i.error('The item type argument of "array" must be one of string, number, boolean',1);y=ia[E],c++}else y=kn;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return i.error('The length argument to "array" must be a positive integer literal',2);b=e[2],c++}a=nr(y,b)}else a=ia[d];const g=[];for(;c<e.length;c++){const y=i.parse(e[c],c,kn);if(!y)return null;g.push(y)}return new Zu(a,g)}evaluate(e){for(let i=0;i<this.args.length;i++){const a=this.args[i].evaluate(e);if(!Wa(this.type,Zi(a)))return a;if(i===this.args.length-1)throw new Ji(`Expected value to be of type ${Ti(this.type)}, but found ${Ti(Zi(a))} instead.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=this.type,i=[e.kind];if(e.kind==="array"){const a=e.itemType;if(a.kind==="string"||a.kind==="number"||a.kind==="boolean"){i.push(a.kind);const c=e.N;(typeof c=="number"||this.args.length>1)&&i.push(c)}}return i.concat(this.args.map(a=>a.serialize()))}}var Oo=Zu;class nl{constructor(e){this.type=na,this.sections=e}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");const a=e[1];if(!Array.isArray(a)&&typeof a=="object")return i.error("First argument must be an image or text section.");const c=[];let d=!1;for(let g=1;g<=e.length-1;++g){const y=e[g];if(d&&typeof y=="object"&&!Array.isArray(y)){d=!1;let b=null;if(y["font-scale"]&&(b=i.parse(y["font-scale"],1,jt),!b))return null;let E=null;if(y["text-font"]&&(E=i.parse(y["text-font"],1,nr(Fn)),!E))return null;let A=null;if(y["text-color"]&&(A=i.parse(y["text-color"],1,ao),!A))return null;const P=c[c.length-1];P.scale=b,P.font=E,P.textColor=A}else{const b=i.parse(e[g],1,kn);if(!b)return null;const E=b.type.kind;if(E!=="string"&&E!=="value"&&E!=="null"&&E!=="resolvedImage")return i.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");d=!0,c.push({content:b,scale:null,font:null,textColor:null})}}return new nl(c)}evaluate(e){return new ir(this.sections.map(i=>{const a=i.content.evaluate(e);return Zi(a)===es?new $u("",a,null,null,null):new $u(el(a),null,i.scale?i.scale.evaluate(e):null,i.font?i.font.evaluate(e).join(","):null,i.textColor?i.textColor.evaluate(e):null)}))}eachChild(e){for(const i of this.sections)e(i.content),i.scale&&e(i.scale),i.font&&e(i.font),i.textColor&&e(i.textColor)}outputDefined(){return!1}serialize(){const e=["format"];for(const i of this.sections){e.push(i.content.serialize());const a={};i.scale&&(a["font-scale"]=i.scale.serialize()),i.font&&(a["text-font"]=i.font.serialize()),i.textColor&&(a["text-color"]=i.textColor.serialize()),e.push(a)}return e}}class sc{constructor(e){this.type=es,this.input=e}static parse(e,i){if(e.length!==2)return i.error("Expected two arguments.");const a=i.parse(e[1],1,Fn);return a?new sc(a):i.error("No image name provided.")}evaluate(e){const i=this.input.evaluate(e),a=Wr.fromString(i);return a&&e.availableImages&&(a.available=e.availableImages.indexOf(i)>-1),a}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}const dg={"to-boolean":Ln,"to-color":ao,"to-number":jt,"to-string":Fn};class Hu{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");const a=e[0];if((a==="to-boolean"||a==="to-string")&&e.length!==2)return i.error("Expected one argument.");const c=dg[a],d=[];for(let g=1;g<e.length;g++){const y=i.parse(e[g],g,kn);if(!y)return null;d.push(y)}return new Hu(c,d)}evaluate(e){if(this.type.kind==="boolean")return Boolean(this.args[0].evaluate(e));if(this.type.kind==="color"){let i,a;for(const c of this.args){if(i=c.evaluate(e),a=null,i instanceof ki)return i;if(typeof i=="string"){const d=e.parseColor(i);if(d)return d}else if(Array.isArray(i)&&(a=i.length<3||i.length>4?`Invalid rbga value ${JSON.stringify(i)}: expected an array containing either three or four numeric values.`:$d(i[0],i[1],i[2],i[3]),!a))return new ki(i[0]/255,i[1]/255,i[2]/255,i[3])}throw new Ji(a||`Could not parse color from value '${typeof i=="string"?i:String(JSON.stringify(i))}'`)}if(this.type.kind==="number"){let i=null;for(const a of this.args){if(i=a.evaluate(e),i===null)return 0;const c=Number(i);if(!isNaN(c))return c}throw new Ji(`Could not convert ${JSON.stringify(i)} to number.`)}return this.type.kind==="formatted"?ir.fromString(el(this.args[0].evaluate(e))):this.type.kind==="resolvedImage"?Wr.fromString(el(this.args[0].evaluate(e))):el(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){if(this.type.kind==="formatted")return new nl([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new sc(this.args[0]).serialize();const e=[`to-${this.type.kind}`];return this.eachChild(i=>{e.push(i.serialize())}),e}}var Ss=Hu;const ac=["Unknown","Point","LineString","Polygon"];var Gd=class{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?ac[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const n=this.featureDistanceData.center,e=this.featureDistanceData.scale,{x:i,y:a}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(i*e-n[0])+this.featureDistanceData.bearing[1]*(a*e-n[1])}return 0}parseColor(n){let e=this._parseColorCache[n];return e||(e=this._parseColorCache[n]=ki.parse(n)),e}};class ra{constructor(e,i,a,c){this.name=e,this.type=i,this._evaluate=a,this.args=c}evaluate(e){return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(e=>e.serialize()))}static parse(e,i){const a=e[0],c=ra.definitions[a];if(!c)return i.error(`Unknown expression "${a}". If you wanted a literal array, use ["literal", [...]].`,0);const d=Array.isArray(c)?c[0]:c.type,g=Array.isArray(c)?[[c[1],c[2]]]:c.overloads,y=g.filter(([E])=>!Array.isArray(E)||E.length===e.length-1);let b=null;for(const[E,A]of y){b=new As(i.registry,i.path,null,i.scope);const P=[];let z=!1;for(let O=1;O<e.length;O++){const F=e[O],q=Array.isArray(E)?E[O-1]:E.type,Z=b.parse(F,1+P.length,q);if(!Z){z=!0;break}P.push(Z)}if(!z)if(Array.isArray(E)&&E.length!==P.length)b.error(`Expected ${E.length} arguments, but found ${P.length} instead.`);else{for(let O=0;O<P.length;O++){const F=Array.isArray(E)?E[O]:E.type,q=P[O];b.concat(O+1).checkSubtype(F,q.type)}if(b.errors.length===0)return new ra(a,d,A,P)}}if(y.length===1)i.errors.push(...b.errors);else{const E=(y.length?y:g).map(([P])=>{return z=P,Array.isArray(z)?`(${z.map(Ti).join(", ")})`:`(${Ti(z.type)}...)`;var z}).join(" | "),A=[];for(let P=1;P<e.length;P++){const z=i.parse(e[P],1+A.length);if(!z)return null;A.push(Ti(z.type))}i.error(`Expected arguments of type ${E}, but found (${A.join(", ")}) instead.`)}return null}static register(e,i){ra.definitions=i;for(const a in i)e[a]=ra}}var ns=ra;class lc{constructor(e,i,a){this.type=Ha,this.locale=a,this.caseSensitive=e,this.diacriticSensitive=i}static parse(e,i){if(e.length!==2)return i.error("Expected one argument.");const a=e[1];if(typeof a!="object"||Array.isArray(a))return i.error("Collator options argument must be an object.");const c=i.parse(a["case-sensitive"]!==void 0&&a["case-sensitive"],1,Ln);if(!c)return null;const d=i.parse(a["diacritic-sensitive"]!==void 0&&a["diacritic-sensitive"],1,Ln);if(!d)return null;let g=null;return a.locale&&(g=i.parse(a.locale,1,Fn),!g)?null:new lc(c,d,g)}evaluate(e){return new Ja(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){const e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}const rr=8192;function cc(n,e){n[0]=Math.min(n[0],e[0]),n[1]=Math.min(n[1],e[1]),n[2]=Math.max(n[2],e[0]),n[3]=Math.max(n[3],e[1])}function il(n,e){return!(n[0]<=e[0]||n[2]>=e[2]||n[1]<=e[1]||n[3]>=e[3])}function Zd(n,e){const i=(180+n[0])/360,a=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+n[1]*Math.PI/360)))/360,c=Math.pow(2,e.z);return[Math.round(i*c*rr),Math.round(a*c*rr)]}function Hd(n,e,i){const a=n[0]-e[0],c=n[1]-e[1],d=n[0]-i[0],g=n[1]-i[1];return a*g-d*c==0&&a*d<=0&&c*g<=0}function uc(n,e){let i=!1;for(let g=0,y=e.length;g<y;g++){const b=e[g];for(let E=0,A=b.length;E<A-1;E++){if(Hd(n,b[E],b[E+1]))return!1;(c=b[E])[1]>(a=n)[1]!=(d=b[E+1])[1]>a[1]&&a[0]<(d[0]-c[0])*(a[1]-c[1])/(d[1]-c[1])+c[0]&&(i=!i)}}var a,c,d;return i}function Wd(n,e){for(let i=0;i<e.length;i++)if(uc(n,e[i]))return!0;return!1}function hc(n,e,i,a){const c=a[0]-i[0],d=a[1]-i[1],g=(n[0]-i[0])*d-c*(n[1]-i[1]),y=(e[0]-i[0])*d-c*(e[1]-i[1]);return g>0&&y<0||g<0&&y>0}function rl(n,e,i){for(const E of i)for(let A=0;A<E.length-1;++A)if((y=[(g=E[A+1])[0]-(d=E[A])[0],g[1]-d[1]])[0]*(b=[(c=e)[0]-(a=n)[0],c[1]-a[1]])[1]-y[1]*b[0]!=0&&hc(a,c,d,g)&&hc(d,g,a,c))return!0;var a,c,d,g,y,b;return!1}function Wu(n,e){for(let i=0;i<n.length;++i)if(!uc(n[i],e))return!1;for(let i=0;i<n.length-1;++i)if(rl(n[i],n[i+1],e))return!1;return!0}function Xd(n,e){for(let i=0;i<e.length;i++)if(Wu(n,e[i]))return!0;return!1}function ol(n,e,i){const a=[];for(let c=0;c<n.length;c++){const d=[];for(let g=0;g<n[c].length;g++){const y=Zd(n[c][g],i);cc(e,y),d.push(y)}a.push(d)}return a}function Xu(n,e,i){const a=[];for(let c=0;c<n.length;c++){const d=ol(n[c],e,i);a.push(d)}return a}function Cs(n,e,i,a){if(n[0]<i[0]||n[0]>i[2]){const c=.5*a;let d=n[0]-i[0]>c?-a:i[0]-n[0]>c?a:0;d===0&&(d=n[0]-i[2]>c?-a:i[2]-n[0]>c?a:0),n[0]+=d}cc(e,n)}function Xn(n,e,i,a){const c=Math.pow(2,a.z)*rr,d=[a.x*rr,a.y*rr],g=[];if(!n)return g;for(const y of n)for(const b of y){const E=[b.x+d[0],b.y+d[1]];Cs(E,e,i,c),g.push(E)}return g}function Kd(n,e,i,a){const c=Math.pow(2,a.z)*rr,d=[a.x*rr,a.y*rr],g=[];if(!n)return g;for(const b of n){const E=[];for(const A of b){const P=[A.x+d[0],A.y+d[1]];cc(e,P),E.push(P)}g.push(E)}if(e[2]-e[0]<=c/2){(y=e)[0]=y[1]=1/0,y[2]=y[3]=-1/0;for(const b of g)for(const E of b)Cs(E,e,i,c)}var y;return g}class sl{constructor(e,i){this.type=Ln,this.geojson=e,this.geometries=i}static parse(e,i){if(e.length!==2)return i.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(oc(e[1])){const a=e[1];if(a.type==="FeatureCollection")for(let c=0;c<a.features.length;++c){const d=a.features[c].geometry.type;if(d==="Polygon"||d==="MultiPolygon")return new sl(a,a.features[c].geometry)}else if(a.type==="Feature"){const c=a.geometry.type;if(c==="Polygon"||c==="MultiPolygon")return new sl(a,a.geometry)}else if(a.type==="Polygon"||a.type==="MultiPolygon")return new sl(a,a)}return i.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(i,a){const c=[1/0,1/0,-1/0,-1/0],d=[1/0,1/0,-1/0,-1/0],g=i.canonicalID();if(!g)return!1;if(a.type==="Polygon"){const y=ol(a.coordinates,d,g),b=Xn(i.geometry(),c,d,g);if(!il(c,d))return!1;for(const E of b)if(!uc(E,y))return!1}if(a.type==="MultiPolygon"){const y=Xu(a.coordinates,d,g),b=Xn(i.geometry(),c,d,g);if(!il(c,d))return!1;for(const E of b)if(!Wd(E,y))return!1}return!0}(e,this.geometries);if(e.geometryType()==="LineString")return function(i,a){const c=[1/0,1/0,-1/0,-1/0],d=[1/0,1/0,-1/0,-1/0],g=i.canonicalID();if(!g)return!1;if(a.type==="Polygon"){const y=ol(a.coordinates,d,g),b=Kd(i.geometry(),c,d,g);if(!il(c,d))return!1;for(const E of b)if(!Wu(E,y))return!1}if(a.type==="MultiPolygon"){const y=Xu(a.coordinates,d,g),b=Kd(i.geometry(),c,d,g);if(!il(c,d))return!1;for(const E of b)if(!Xd(E,y))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}var Ku=sl;function oa(n){if(n instanceof ns&&(n.name==="get"&&n.args.length===1||n.name==="feature-state"||n.name==="has"&&n.args.length===1||n.name==="properties"||n.name==="geometry-type"||n.name==="id"||/^filter-/.test(n.name))||n instanceof Ku)return!1;let e=!0;return n.eachChild(i=>{e&&!oa(i)&&(e=!1)}),e}function dc(n){if(n instanceof ns&&n.name==="feature-state")return!1;let e=!0;return n.eachChild(i=>{e&&!dc(i)&&(e=!1)}),e}function al(n,e){if(n instanceof ns&&e.indexOf(n.name)>=0)return!1;let i=!0;return n.eachChild(a=>{i&&!al(a,e)&&(i=!1)}),i}class fc{constructor(e,i){this.type=i.type,this.name=e,this.boundExpression=i}static parse(e,i){if(e.length!==2||typeof e[1]!="string")return i.error("'var' expression requires exactly one string literal argument.");const a=e[1];return i.scope.has(a)?new fc(a,i.scope.get(a)):i.error(`Unknown variable "${a}". Make sure "${a}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}var Yu=fc;class pc{constructor(e,i=[],a,c=new jd,d=[]){this.registry=e,this.path=i,this.key=i.map(g=>`[${g}]`).join(""),this.scope=c,this.errors=d,this.expectedType=a}parse(e,i,a,c,d={}){return i?this.concat(i,a,c)._parse(e,d):this._parse(e,d)}_parse(e,i){function a(c,d,g){return g==="assert"?new Oo(d,[c]):g==="coerce"?new Ss(d,[c]):c}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const c=e[0];if(typeof c!="string")return this.error(`Expression name must be a string, but found ${typeof c} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const d=this.registry[c];if(d){let g=d.parse(e,this);if(!g)return null;if(this.expectedType){const y=this.expectedType,b=g.type;if(y.kind!=="string"&&y.kind!=="number"&&y.kind!=="boolean"&&y.kind!=="object"&&y.kind!=="array"||b.kind!=="value")if(y.kind!=="color"&&y.kind!=="formatted"&&y.kind!=="resolvedImage"||b.kind!=="value"&&b.kind!=="string"){if(this.checkSubtype(y,b))return null}else g=a(g,y,i.typeAnnotation||"coerce");else g=a(g,y,i.typeAnnotation||"assert")}if(!(g instanceof tl)&&g.type.kind!=="resolvedImage"&&sa(g)){const y=new Gd;try{g=new tl(g.type,g.evaluate(y))}catch(b){return this.error(b.message),null}}return g}return this.error(`Unknown expression "${c}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,i,a){const c=typeof e=="number"?this.path.concat(e):this.path,d=a?this.scope.concat(a):this.scope;return new pc(this.registry,c,i||null,d,this.errors)}error(e,...i){const a=`${this.key}${i.map(c=>`[${c}]`).join("")}`;this.errors.push(new qr(a,e))}checkSubtype(e,i){const a=Wa(e,i);return a&&this.error(a),a}}var As=pc;function sa(n){if(n instanceof Yu)return sa(n.boundExpression);if(n instanceof ns&&n.name==="error"||n instanceof lc||n instanceof Ku)return!1;const e=n instanceof Ss||n instanceof Oo;let i=!0;return n.eachChild(a=>{i=e?i&&sa(a):i&&a instanceof tl}),!!i&&oa(n)&&al(n,["zoom","heatmap-density","line-progress","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center"])}function mc(n,e){const i=n.length-1;let a,c,d=0,g=i,y=0;for(;d<=g;)if(y=Math.floor((d+g)/2),a=n[y],c=n[y+1],a<=e){if(y===i||e<c)return y;d=y+1}else{if(!(a>e))throw new Ji("Input is not a number.");g=y-1}return 0}class ll{constructor(e,i,a){this.type=e,this.input=i,this.labels=[],this.outputs=[];for(const[c,d]of a)this.labels.push(c),this.outputs.push(d)}static parse(e,i){if(e.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return i.error("Expected an even number of arguments.");const a=i.parse(e[1],1,jt);if(!a)return null;const c=[];let d=null;i.expectedType&&i.expectedType.kind!=="value"&&(d=i.expectedType);for(let g=1;g<e.length;g+=2){const y=g===1?-1/0:e[g],b=e[g+1],E=g,A=g+1;if(typeof y!="number")return i.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',E);if(c.length&&c[c.length-1][0]>=y)return i.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',E);const P=i.parse(b,A,d);if(!P)return null;d=d||P.type,c.push([y,P])}return new ll(d,a,c)}evaluate(e){const i=this.labels,a=this.outputs;if(i.length===1)return a[0].evaluate(e);const c=this.input.evaluate(e);if(c<=i[0])return a[0].evaluate(e);const d=i.length;return c>=i[d-1]?a[d-1].evaluate(e):a[mc(i,c)].evaluate(e)}eachChild(e){e(this.input);for(const i of this.outputs)e(i)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){const e=["step",this.input.serialize()];for(let i=0;i<this.labels.length;i++)i>0&&e.push(this.labels[i]),e.push(this.outputs[i].serialize());return e}}var gc=ll;function $n(n,e,i){return n*(1-i)+e*i}var _c=Object.freeze({__proto__:null,number:$n,color:function(n,e,i){return new ki($n(n.r,e.r,i),$n(n.g,e.g,i),$n(n.b,e.b,i),$n(n.a,e.a,i))},array:function(n,e,i){return n.map((a,c)=>$n(a,e[c],i))}});const Qu=.95047,Yd=1.08883,Ju=4/29,yc=6/29,Qd=3*yc*yc,Jd=Math.PI/180,fg=180/Math.PI;function vc(n){return n>.008856451679035631?Math.pow(n,1/3):n/Qd+Ju}function xc(n){return n>yc?n*n*n:Qd*(n-Ju)}function eh(n){return 255*(n<=.0031308?12.92*n:1.055*Math.pow(n,1/2.4)-.055)}function th(n){return(n/=255)<=.04045?n/12.92:Math.pow((n+.055)/1.055,2.4)}function ef(n){const e=th(n.r),i=th(n.g),a=th(n.b),c=vc((.4124564*e+.3575761*i+.1804375*a)/Qu),d=vc((.2126729*e+.7151522*i+.072175*a)/1);return{l:116*d-16,a:500*(c-d),b:200*(d-vc((.0193339*e+.119192*i+.9503041*a)/Yd)),alpha:n.a}}function tf(n){let e=(n.l+16)/116,i=isNaN(n.a)?e:e+n.a/500,a=isNaN(n.b)?e:e-n.b/200;return e=1*xc(e),i=Qu*xc(i),a=Yd*xc(a),new ki(eh(3.2404542*i-1.5371385*e-.4985314*a),eh(-.969266*i+1.8760108*e+.041556*a),eh(.0556434*i-.2040259*e+1.0572252*a),n.alpha)}function pg(n,e,i){const a=e-n;return n+i*(a>180||a<-180?a-360*Math.round(a/360):a)}const cl={forward:ef,reverse:tf,interpolate:function(n,e,i){return{l:$n(n.l,e.l,i),a:$n(n.a,e.a,i),b:$n(n.b,e.b,i),alpha:$n(n.alpha,e.alpha,i)}}},aa={forward:function(n){const{l:e,a:i,b:a}=ef(n),c=Math.atan2(a,i)*fg;return{h:c<0?c+360:c,c:Math.sqrt(i*i+a*a),l:e,alpha:n.a}},reverse:function(n){const e=n.h*Jd,i=n.c;return tf({l:n.l,a:Math.cos(e)*i,b:Math.sin(e)*i,alpha:n.alpha})},interpolate:function(n,e,i){return{h:pg(n.h,e.h,i),c:$n(n.c,e.c,i),l:$n(n.l,e.l,i),alpha:$n(n.alpha,e.alpha,i)}}};var nf=Object.freeze({__proto__:null,lab:cl,hcl:aa});class bc{constructor(e,i,a,c,d){this.type=e,this.operator=i,this.interpolation=a,this.input=c,this.labels=[],this.outputs=[];for(const[g,y]of d)this.labels.push(g),this.outputs.push(y)}static interpolationFactor(e,i,a,c){let d=0;if(e.name==="exponential")d=nh(i,e.base,a,c);else if(e.name==="linear")d=nh(i,1,a,c);else if(e.name==="cubic-bezier"){const g=e.controlPoints;d=new Se(g[0],g[1],g[2],g[3]).solve(nh(i,1,a,c))}return d}static parse(e,i){let[a,c,d,...g]=e;if(!Array.isArray(c)||c.length===0)return i.error("Expected an interpolation type expression.",1);if(c[0]==="linear")c={name:"linear"};else if(c[0]==="exponential"){const E=c[1];if(typeof E!="number")return i.error("Exponential interpolation requires a numeric base.",1,1);c={name:"exponential",base:E}}else{if(c[0]!=="cubic-bezier")return i.error(`Unknown interpolation type ${String(c[0])}`,1,0);{const E=c.slice(1);if(E.length!==4||E.some(A=>typeof A!="number"||A<0||A>1))return i.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);c={name:"cubic-bezier",controlPoints:E}}}if(e.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return i.error("Expected an even number of arguments.");if(d=i.parse(d,2,jt),!d)return null;const y=[];let b=null;a==="interpolate-hcl"||a==="interpolate-lab"?b=ao:i.expectedType&&i.expectedType.kind!=="value"&&(b=i.expectedType);for(let E=0;E<g.length;E+=2){const A=g[E],P=g[E+1],z=E+3,O=E+4;if(typeof A!="number")return i.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',z);if(y.length&&y[y.length-1][0]>=A)return i.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',z);const F=i.parse(P,O,b);if(!F)return null;b=b||F.type,y.push([A,F])}return b.kind==="number"||b.kind==="color"||b.kind==="array"&&b.itemType.kind==="number"&&typeof b.N=="number"?new bc(b,a,c,d,y):i.error(`Type ${Ti(b)} is not interpolatable.`)}evaluate(e){const i=this.labels,a=this.outputs;if(i.length===1)return a[0].evaluate(e);const c=this.input.evaluate(e);if(c<=i[0])return a[0].evaluate(e);const d=i.length;if(c>=i[d-1])return a[d-1].evaluate(e);const g=mc(i,c),y=bc.interpolationFactor(this.interpolation,c,i[g],i[g+1]),b=a[g].evaluate(e),E=a[g+1].evaluate(e);return this.operator==="interpolate"?_c[this.type.kind.toLowerCase()](b,E,y):this.operator==="interpolate-hcl"?aa.reverse(aa.interpolate(aa.forward(b),aa.forward(E),y)):cl.reverse(cl.interpolate(cl.forward(b),cl.forward(E),y))}eachChild(e){e(this.input);for(const i of this.outputs)e(i)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e;e=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const i=[this.operator,e,this.input.serialize()];for(let a=0;a<this.labels.length;a++)i.push(this.labels[a],this.outputs[a].serialize());return i}}function nh(n,e,i,a){const c=a-i,d=n-i;return c===0?0:e===1?d/c:(Math.pow(e,d)-1)/(Math.pow(e,c)-1)}var mo=bc;class wc{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expectected at least one argument.");let a=null;const c=i.expectedType;c&&c.kind!=="value"&&(a=c);const d=[];for(const y of e.slice(1)){const b=i.parse(y,1+d.length,a,void 0,{typeAnnotation:"omit"});if(!b)return null;a=a||b.type,d.push(b)}const g=c&&d.some(y=>Wa(c,y.type));return new wc(g?kn:a,d)}evaluate(e){let i,a=null,c=0;for(const d of this.args){if(c++,a=d.evaluate(e),a&&a instanceof Wr&&!a.available&&(i||(i=a),a=null,c===this.args.length))return i;if(a!==null)break}return a}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=["coalesce"];return this.eachChild(i=>{e.push(i.serialize())}),e}}var ih=wc;class Ec{constructor(e,i){this.type=i.type,this.bindings=[].concat(e),this.result=i}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const i of this.bindings)e(i[1]);e(this.result)}static parse(e,i){if(e.length<4)return i.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const a=[];for(let d=1;d<e.length-1;d+=2){const g=e[d];if(typeof g!="string")return i.error(`Expected string, but found ${typeof g} instead.`,d);if(/[^a-zA-Z0-9_]/.test(g))return i.error("Variable names must contain only alphanumeric characters or '_'.",d);const y=i.parse(e[d+1],d+1);if(!y)return null;a.push([g,y])}const c=i.parse(e[e.length-1],e.length-1,i.expectedType,a);return c?new Ec(a,c):null}outputDefined(){return this.result.outputDefined()}serialize(){const e=["let"];for(const[i,a]of this.bindings)e.push(i,a.serialize());return e.push(this.result.serialize()),e}}var rf=Ec;class rh{constructor(e,i,a){this.type=e,this.index=i,this.input=a}static parse(e,i){if(e.length!==3)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const a=i.parse(e[1],1,jt),c=i.parse(e[2],2,nr(i.expectedType||kn));return a&&c?new rh(c.type.itemType,a,c):null}evaluate(e){const i=this.index.evaluate(e),a=this.input.evaluate(e);if(i<0)throw new Ji(`Array index out of bounds: ${i} < 0.`);if(i>=a.length)throw new Ji(`Array index out of bounds: ${i} > ${a.length-1}.`);if(i!==Math.floor(i))throw new Ji(`Array index must be an integer, but found ${i} instead.`);return a[i]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}var of=rh;class Tc{constructor(e,i){this.type=Ln,this.needle=e,this.haystack=i}static parse(e,i){if(e.length!==3)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const a=i.parse(e[1],1,kn),c=i.parse(e[2],2,kn);return a&&c?Xa(a.type,[Ln,Fn,jt,br,kn])?new Tc(a,c):i.error(`Expected first argument to be of type boolean, string, number or null, but found ${Ti(a.type)} instead`):null}evaluate(e){const i=this.needle.evaluate(e),a=this.haystack.evaluate(e);if(a==null)return!1;if(!Ka(i,["boolean","string","number","null"]))throw new Ji(`Expected first argument to be of type boolean, string, number or null, but found ${Ti(Zi(i))} instead.`);if(!Ka(a,["string","array"]))throw new Ji(`Expected second argument to be of type array or string, but found ${Ti(Zi(a))} instead.`);return a.indexOf(i)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}var sf=Tc;class Sc{constructor(e,i,a){this.type=jt,this.needle=e,this.haystack=i,this.fromIndex=a}static parse(e,i){if(e.length<=2||e.length>=5)return i.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const a=i.parse(e[1],1,kn),c=i.parse(e[2],2,kn);if(!a||!c)return null;if(!Xa(a.type,[Ln,Fn,jt,br,kn]))return i.error(`Expected first argument to be of type boolean, string, number or null, but found ${Ti(a.type)} instead`);if(e.length===4){const d=i.parse(e[3],3,jt);return d?new Sc(a,c,d):null}return new Sc(a,c)}evaluate(e){const i=this.needle.evaluate(e),a=this.haystack.evaluate(e);if(!Ka(i,["boolean","string","number","null"]))throw new Ji(`Expected first argument to be of type boolean, string, number or null, but found ${Ti(Zi(i))} instead.`);if(!Ka(a,["string","array"]))throw new Ji(`Expected second argument to be of type array or string, but found ${Ti(Zi(a))} instead.`);if(this.fromIndex){const c=this.fromIndex.evaluate(e);return a.indexOf(i,c)}return a.indexOf(i)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}var mg=Sc;class oh{constructor(e,i,a,c,d,g){this.inputType=e,this.type=i,this.input=a,this.cases=c,this.outputs=d,this.otherwise=g}static parse(e,i){if(e.length<5)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return i.error("Expected an even number of arguments.");let a,c;i.expectedType&&i.expectedType.kind!=="value"&&(c=i.expectedType);const d={},g=[];for(let E=2;E<e.length-1;E+=2){let A=e[E];const P=e[E+1];Array.isArray(A)||(A=[A]);const z=i.concat(E);if(A.length===0)return z.error("Expected at least one branch label.");for(const F of A){if(typeof F!="number"&&typeof F!="string")return z.error("Branch labels must be numbers or strings.");if(typeof F=="number"&&Math.abs(F)>Number.MAX_SAFE_INTEGER)return z.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof F=="number"&&Math.floor(F)!==F)return z.error("Numeric branch labels must be integer values.");if(a){if(z.checkSubtype(a,Zi(F)))return null}else a=Zi(F);if(d[String(F)]!==void 0)return z.error("Branch labels must be unique.");d[String(F)]=g.length}const O=i.parse(P,E,c);if(!O)return null;c=c||O.type,g.push(O)}const y=i.parse(e[1],1,kn);if(!y)return null;const b=i.parse(e[e.length-1],e.length-1,c);return b?y.type.kind!=="value"&&i.concat(1).checkSubtype(a,y.type)?null:new oh(a,c,y,d,g,b):null}evaluate(e){const i=this.input.evaluate(e);return(Zi(i)===this.inputType&&this.outputs[this.cases[i]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["match",this.input.serialize()],i=Object.keys(this.cases).sort(),a=[],c={};for(const g of i){const y=c[this.cases[g]];y===void 0?(c[this.cases[g]]=a.length,a.push([this.cases[g],[g]])):a[y][1].push(g)}const d=g=>this.inputType.kind==="number"?Number(g):g;for(const[g,y]of a)e.push(y.length===1?d(y[0]):y.map(d)),e.push(this.outputs[g].serialize());return e.push(this.otherwise.serialize()),e}}var gg=oh;class la{constructor(e,i,a){this.type=e,this.branches=i,this.otherwise=a}static parse(e,i){if(e.length<4)return i.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return i.error("Expected an odd number of arguments.");let a;i.expectedType&&i.expectedType.kind!=="value"&&(a=i.expectedType);const c=[];for(let g=1;g<e.length-1;g+=2){const y=i.parse(e[g],g,Ln);if(!y)return null;const b=i.parse(e[g+1],g+1,a);if(!b)return null;c.push([y,b]),a=a||b.type}const d=i.parse(e[e.length-1],e.length-1,a);return d?new la(a,c,d):null}evaluate(e){for(const[i,a]of this.branches)if(i.evaluate(e))return a.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[i,a]of this.branches)e(i),e(a);e(this.otherwise)}outputDefined(){return this.branches.every(([e,i])=>i.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["case"];return this.eachChild(i=>{e.push(i.serialize())}),e}}var af=la;class ul{constructor(e,i,a,c){this.type=e,this.input=i,this.beginIndex=a,this.endIndex=c}static parse(e,i){if(e.length<=2||e.length>=5)return i.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const a=i.parse(e[1],1,kn),c=i.parse(e[2],2,jt);if(!a||!c)return null;if(!Xa(a.type,[nr(kn),Fn,kn]))return i.error(`Expected first argument to be of type array or string, but found ${Ti(a.type)} instead`);if(e.length===4){const d=i.parse(e[3],3,jt);return d?new ul(a.type,a,c,d):null}return new ul(a.type,a,c)}evaluate(e){const i=this.input.evaluate(e),a=this.beginIndex.evaluate(e);if(!Ka(i,["string","array"]))throw new Ji(`Expected first argument to be of type array or string, but found ${Ti(Zi(i))} instead.`);if(this.endIndex){const c=this.endIndex.evaluate(e);return i.slice(a,c)}return i.slice(a)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}var _g=ul;function lf(n,e){return n==="=="||n==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function cf(n,e,i,a){return a.compare(e,i)===0}function Ms(n,e,i){const a=n!=="=="&&n!=="!=";return class wS{constructor(d,g,y){this.type=Ln,this.lhs=d,this.rhs=g,this.collator=y,this.hasUntypedArgument=d.type.kind==="value"||g.type.kind==="value"}static parse(d,g){if(d.length!==3&&d.length!==4)return g.error("Expected two or three arguments.");const y=d[0];let b=g.parse(d[1],1,kn);if(!b)return null;if(!lf(y,b.type))return g.concat(1).error(`"${y}" comparisons are not supported for type '${Ti(b.type)}'.`);let E=g.parse(d[2],2,kn);if(!E)return null;if(!lf(y,E.type))return g.concat(2).error(`"${y}" comparisons are not supported for type '${Ti(E.type)}'.`);if(b.type.kind!==E.type.kind&&b.type.kind!=="value"&&E.type.kind!=="value")return g.error(`Cannot compare types '${Ti(b.type)}' and '${Ti(E.type)}'.`);a&&(b.type.kind==="value"&&E.type.kind!=="value"?b=new Oo(E.type,[b]):b.type.kind!=="value"&&E.type.kind==="value"&&(E=new Oo(b.type,[E])));let A=null;if(d.length===4){if(b.type.kind!=="string"&&E.type.kind!=="string"&&b.type.kind!=="value"&&E.type.kind!=="value")return g.error("Cannot use collator to compare non-string types.");if(A=g.parse(d[3],3,Ha),!A)return null}return new wS(b,E,A)}evaluate(d){const g=this.lhs.evaluate(d),y=this.rhs.evaluate(d);if(a&&this.hasUntypedArgument){const b=Zi(g),E=Zi(y);if(b.kind!==E.kind||b.kind!=="string"&&b.kind!=="number")throw new Ji(`Expected arguments for "${n}" to be (string, string) or (number, number), but found (${b.kind}, ${E.kind}) instead.`)}if(this.collator&&!a&&this.hasUntypedArgument){const b=Zi(g),E=Zi(y);if(b.kind!=="string"||E.kind!=="string")return e(d,g,y)}return this.collator?i(d,g,y,this.collator.evaluate(d)):e(d,g,y)}eachChild(d){d(this.lhs),d(this.rhs),this.collator&&d(this.collator)}outputDefined(){return!0}serialize(){const d=[n];return this.eachChild(g=>{d.push(g.serialize())}),d}}}const uf=Ms("==",function(n,e,i){return e===i},cf),hf=Ms("!=",function(n,e,i){return e!==i},function(n,e,i,a){return!cf(0,e,i,a)}),sh=Ms("<",function(n,e,i){return e<i},function(n,e,i,a){return a.compare(e,i)<0}),yg=Ms(">",function(n,e,i){return e>i},function(n,e,i,a){return a.compare(e,i)>0}),vg=Ms("<=",function(n,e,i){return e<=i},function(n,e,i,a){return a.compare(e,i)<=0}),xg=Ms(">=",function(n,e,i){return e>=i},function(n,e,i,a){return a.compare(e,i)>=0});class ah{constructor(e,i,a,c,d,g){this.type=Fn,this.number=e,this.locale=i,this.currency=a,this.unit=c,this.minFractionDigits=d,this.maxFractionDigits=g}static parse(e,i){if(e.length!==3)return i.error("Expected two arguments.");const a=i.parse(e[1],1,jt);if(!a)return null;const c=e[2];if(typeof c!="object"||Array.isArray(c))return i.error("NumberFormat options argument must be an object.");let d=null;if(c.locale&&(d=i.parse(c.locale,1,Fn),!d))return null;let g=null;if(c.currency&&(g=i.parse(c.currency,1,Fn),!g))return null;let y=null;if(c.unit&&(y=i.parse(c.unit,1,Fn),!y))return null;let b=null;if(c["min-fraction-digits"]&&(b=i.parse(c["min-fraction-digits"],1,jt),!b))return null;let E=null;return c["max-fraction-digits"]&&(E=i.parse(c["max-fraction-digits"],1,jt),!E)?null:new ah(a,d,g,y,b,E)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(e):void 0,unit:this.unit?this.unit.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.unit&&e(this.unit),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.unit&&(e.unit=this.unit.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class lh{constructor(e){this.type=jt,this.input=e}static parse(e,i){if(e.length!==2)return i.error(`Expected 1 argument, but found ${e.length-1} instead.`);const a=i.parse(e[1],1);return a?a.type.kind!=="array"&&a.type.kind!=="string"&&a.type.kind!=="value"?i.error(`Expected argument of type string or array, but found ${Ti(a.type)} instead.`):new lh(a):null}evaluate(e){const i=this.input.evaluate(e);if(typeof i=="string"||Array.isArray(i))return i.length;throw new Ji(`Expected value to be of type string or array, but found ${Ti(Zi(i))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){const e=["length"];return this.eachChild(i=>{e.push(i.serialize())}),e}}const df={"==":uf,"!=":hf,">":yg,"<":sh,">=":xg,"<=":vg,array:Oo,at:of,boolean:Oo,case:af,coalesce:ih,collator:lc,format:nl,image:sc,in:sf,"index-of":mg,interpolate:mo,"interpolate-hcl":mo,"interpolate-lab":mo,length:lh,let:rf,literal:tl,match:gg,number:Oo,"number-format":ah,object:Oo,slice:_g,step:gc,string:Oo,"to-boolean":Ss,"to-color":Ss,"to-number":Ss,"to-string":Ss,var:Yu,within:Ku};function ff(n,[e,i,a,c]){e=e.evaluate(n),i=i.evaluate(n),a=a.evaluate(n);const d=c?c.evaluate(n):1,g=$d(e,i,a,d);if(g)throw new Ji(g);return new ki(e/255*d,i/255*d,a/255*d,d)}function ch(n,e){return n in e}function Cc(n,e){const i=e[n];return i===void 0?null:i}function go(n){return{type:n}}ns.register(df,{error:[{kind:"error"},[Fn],(n,[e])=>{throw new Ji(e.evaluate(n))}],typeof:[Fn,[kn],(n,[e])=>Ti(Zi(e.evaluate(n)))],"to-rgba":[nr(jt,4),[ao],(n,[e])=>e.evaluate(n).toArray()],rgb:[ao,[jt,jt,jt],ff],rgba:[ao,[jt,jt,jt,jt],ff],has:{type:Ln,overloads:[[[Fn],(n,[e])=>ch(e.evaluate(n),n.properties())],[[Fn,Ts],(n,[e,i])=>ch(e.evaluate(n),i.evaluate(n))]]},get:{type:kn,overloads:[[[Fn],(n,[e])=>Cc(e.evaluate(n),n.properties())],[[Fn,Ts],(n,[e,i])=>Cc(e.evaluate(n),i.evaluate(n))]]},"feature-state":[kn,[Fn],(n,[e])=>Cc(e.evaluate(n),n.featureState||{})],properties:[Ts,[],n=>n.properties()],"geometry-type":[Fn,[],n=>n.geometryType()],id:[kn,[],n=>n.id()],zoom:[jt,[],n=>n.globals.zoom],pitch:[jt,[],n=>n.globals.pitch||0],"distance-from-center":[jt,[],n=>n.distanceFromCenter()],"heatmap-density":[jt,[],n=>n.globals.heatmapDensity||0],"line-progress":[jt,[],n=>n.globals.lineProgress||0],"sky-radial-progress":[jt,[],n=>n.globals.skyRadialProgress||0],accumulated:[kn,[],n=>n.globals.accumulated===void 0?null:n.globals.accumulated],"+":[jt,go(jt),(n,e)=>{let i=0;for(const a of e)i+=a.evaluate(n);return i}],"*":[jt,go(jt),(n,e)=>{let i=1;for(const a of e)i*=a.evaluate(n);return i}],"-":{type:jt,overloads:[[[jt,jt],(n,[e,i])=>e.evaluate(n)-i.evaluate(n)],[[jt],(n,[e])=>-e.evaluate(n)]]},"/":[jt,[jt,jt],(n,[e,i])=>e.evaluate(n)/i.evaluate(n)],"%":[jt,[jt,jt],(n,[e,i])=>e.evaluate(n)%i.evaluate(n)],ln2:[jt,[],()=>Math.LN2],pi:[jt,[],()=>Math.PI],e:[jt,[],()=>Math.E],"^":[jt,[jt,jt],(n,[e,i])=>Math.pow(e.evaluate(n),i.evaluate(n))],sqrt:[jt,[jt],(n,[e])=>Math.sqrt(e.evaluate(n))],log10:[jt,[jt],(n,[e])=>Math.log(e.evaluate(n))/Math.LN10],ln:[jt,[jt],(n,[e])=>Math.log(e.evaluate(n))],log2:[jt,[jt],(n,[e])=>Math.log(e.evaluate(n))/Math.LN2],sin:[jt,[jt],(n,[e])=>Math.sin(e.evaluate(n))],cos:[jt,[jt],(n,[e])=>Math.cos(e.evaluate(n))],tan:[jt,[jt],(n,[e])=>Math.tan(e.evaluate(n))],asin:[jt,[jt],(n,[e])=>Math.asin(e.evaluate(n))],acos:[jt,[jt],(n,[e])=>Math.acos(e.evaluate(n))],atan:[jt,[jt],(n,[e])=>Math.atan(e.evaluate(n))],min:[jt,go(jt),(n,e)=>Math.min(...e.map(i=>i.evaluate(n)))],max:[jt,go(jt),(n,e)=>Math.max(...e.map(i=>i.evaluate(n)))],abs:[jt,[jt],(n,[e])=>Math.abs(e.evaluate(n))],round:[jt,[jt],(n,[e])=>{const i=e.evaluate(n);return i<0?-Math.round(-i):Math.round(i)}],floor:[jt,[jt],(n,[e])=>Math.floor(e.evaluate(n))],ceil:[jt,[jt],(n,[e])=>Math.ceil(e.evaluate(n))],"filter-==":[Ln,[Fn,kn],(n,[e,i])=>n.properties()[e.value]===i.value],"filter-id-==":[Ln,[kn],(n,[e])=>n.id()===e.value],"filter-type-==":[Ln,[Fn],(n,[e])=>n.geometryType()===e.value],"filter-<":[Ln,[Fn,kn],(n,[e,i])=>{const a=n.properties()[e.value],c=i.value;return typeof a==typeof c&&a<c}],"filter-id-<":[Ln,[kn],(n,[e])=>{const i=n.id(),a=e.value;return typeof i==typeof a&&i<a}],"filter->":[Ln,[Fn,kn],(n,[e,i])=>{const a=n.properties()[e.value],c=i.value;return typeof a==typeof c&&a>c}],"filter-id->":[Ln,[kn],(n,[e])=>{const i=n.id(),a=e.value;return typeof i==typeof a&&i>a}],"filter-<=":[Ln,[Fn,kn],(n,[e,i])=>{const a=n.properties()[e.value],c=i.value;return typeof a==typeof c&&a<=c}],"filter-id-<=":[Ln,[kn],(n,[e])=>{const i=n.id(),a=e.value;return typeof i==typeof a&&i<=a}],"filter->=":[Ln,[Fn,kn],(n,[e,i])=>{const a=n.properties()[e.value],c=i.value;return typeof a==typeof c&&a>=c}],"filter-id->=":[Ln,[kn],(n,[e])=>{const i=n.id(),a=e.value;return typeof i==typeof a&&i>=a}],"filter-has":[Ln,[kn],(n,[e])=>e.value in n.properties()],"filter-has-id":[Ln,[],n=>n.id()!==null&&n.id()!==void 0],"filter-type-in":[Ln,[nr(Fn)],(n,[e])=>e.value.indexOf(n.geometryType())>=0],"filter-id-in":[Ln,[nr(kn)],(n,[e])=>e.value.indexOf(n.id())>=0],"filter-in-small":[Ln,[Fn,nr(kn)],(n,[e,i])=>i.value.indexOf(n.properties()[e.value])>=0],"filter-in-large":[Ln,[Fn,nr(kn)],(n,[e,i])=>function(a,c,d,g){for(;d<=g;){const y=d+g>>1;if(c[y]===a)return!0;c[y]>a?g=y-1:d=y+1}return!1}(n.properties()[e.value],i.value,0,i.value.length-1)],all:{type:Ln,overloads:[[[Ln,Ln],(n,[e,i])=>e.evaluate(n)&&i.evaluate(n)],[go(Ln),(n,e)=>{for(const i of e)if(!i.evaluate(n))return!1;return!0}]]},any:{type:Ln,overloads:[[[Ln,Ln],(n,[e,i])=>e.evaluate(n)||i.evaluate(n)],[go(Ln),(n,e)=>{for(const i of e)if(i.evaluate(n))return!0;return!1}]]},"!":[Ln,[Ln],(n,[e])=>!e.evaluate(n)],"is-supported-script":[Ln,[Fn],(n,[e])=>{const i=n.globals&&n.globals.isSupportedScript;return!i||i(e.evaluate(n))}],upcase:[Fn,[Fn],(n,[e])=>e.evaluate(n).toUpperCase()],downcase:[Fn,[Fn],(n,[e])=>e.evaluate(n).toLowerCase()],concat:[Fn,go(kn),(n,e)=>e.map(i=>el(i.evaluate(n))).join("")],"resolved-locale":[Fn,[Ha],(n,[e])=>e.evaluate(n).resolvedLocale()]});var hl=df;function pf(n){return{result:"success",value:n}}function jr(n){return{result:"error",value:n}}function Is(n){return n["property-type"]==="data-driven"}function ks(n){return!!n.expression&&n.expression.parameters.indexOf("zoom")>-1}function uh(n){return!!n.expression&&n.expression.interpolated}function Kn(n){return n instanceof Number?"number":n instanceof String?"string":n instanceof Boolean?"boolean":Array.isArray(n)?"array":n===null?"null":typeof n}function dl(n){return typeof n=="object"&&n!==null&&!Array.isArray(n)}function bg(n){return n}function Ac(n,e){const i=e.type==="color",a=n.stops&&typeof n.stops[0][0]=="object",c=a||!(a||n.property!==void 0),d=n.type||(uh(e)?"exponential":"interval");if(i&&((n=Ro({},n)).stops&&(n.stops=n.stops.map(E=>[E[0],ki.parse(E[1])])),n.default=ki.parse(n.default?n.default:e.default)),n.colorSpace&&n.colorSpace!=="rgb"&&!nf[n.colorSpace])throw new Error(`Unknown color space: ${n.colorSpace}`);let g,y,b;if(d==="exponential")g=dh;else if(d==="interval")g=mf;else if(d==="categorical"){g=hh,y=Object.create(null);for(const E of n.stops)y[E[0]]=E[1];b=typeof n.stops[0][0]}else{if(d!=="identity")throw new Error(`Unknown function type "${d}"`);g=fh}if(a){const E={},A=[];for(let O=0;O<n.stops.length;O++){const F=n.stops[O],q=F[0].zoom;E[q]===void 0&&(E[q]={zoom:q,type:n.type,property:n.property,default:n.default,stops:[]},A.push(q)),E[q].stops.push([F[0].value,F[1]])}const P=[];for(const O of A)P.push([E[O].zoom,Ac(E[O],e)]);const z={name:"linear"};return{kind:"composite",interpolationType:z,interpolationFactor:mo.interpolationFactor.bind(void 0,z),zoomStops:P.map(O=>O[0]),evaluate:({zoom:O},F)=>dh({stops:P,base:n.base},e,O).evaluate(O,F)}}if(c){const E=d==="exponential"?{name:"exponential",base:n.base!==void 0?n.base:1}:null;return{kind:"camera",interpolationType:E,interpolationFactor:mo.interpolationFactor.bind(void 0,E),zoomStops:n.stops.map(A=>A[0]),evaluate:({zoom:A})=>g(n,e,A,y,b)}}return{kind:"source",evaluate(E,A){const P=A&&A.properties?A.properties[n.property]:void 0;return P===void 0?ca(n.default,e.default):g(n,e,P,y,b)}}}function ca(n,e,i){return n!==void 0?n:e!==void 0?e:i!==void 0?i:void 0}function hh(n,e,i,a,c){return ca(typeof i===c?a[i]:void 0,n.default,e.default)}function mf(n,e,i){if(Kn(i)!=="number")return ca(n.default,e.default);const a=n.stops.length;if(a===1||i<=n.stops[0][0])return n.stops[0][1];if(i>=n.stops[a-1][0])return n.stops[a-1][1];const c=mc(n.stops.map(d=>d[0]),i);return n.stops[c][1]}function dh(n,e,i){const a=n.base!==void 0?n.base:1;if(Kn(i)!=="number")return ca(n.default,e.default);const c=n.stops.length;if(c===1||i<=n.stops[0][0])return n.stops[0][1];if(i>=n.stops[c-1][0])return n.stops[c-1][1];const d=mc(n.stops.map(A=>A[0]),i),g=function(A,P,z,O){const F=O-z,q=A-z;return F===0?0:P===1?q/F:(Math.pow(P,q)-1)/(Math.pow(P,F)-1)}(i,a,n.stops[d][0],n.stops[d+1][0]),y=n.stops[d][1],b=n.stops[d+1][1];let E=_c[e.type]||bg;if(n.colorSpace&&n.colorSpace!=="rgb"){const A=nf[n.colorSpace];E=(P,z)=>A.reverse(A.interpolate(A.forward(P),A.forward(z),g))}return typeof y.evaluate=="function"?{evaluate(...A){const P=y.evaluate.apply(void 0,A),z=b.evaluate.apply(void 0,A);if(P!==void 0&&z!==void 0)return E(P,z,g)}}:E(y,b,g)}function fh(n,e,i){return e.type==="color"?i=ki.parse(i):e.type==="formatted"?i=ir.fromString(i.toString()):e.type==="resolvedImage"?i=Wr.fromString(i.toString()):Kn(i)===e.type||e.type==="enum"&&e.values[i]||(i=void 0),ca(i,n.default,e.default)}class Mc{constructor(e,i){this.expression=e,this._warningHistory={},this._evaluator=new Gd,this._defaultValue=i?function(a){return a.type==="color"&&(dl(a.default)||Array.isArray(a.default))?new ki(0,0,0,0):a.type==="color"?ki.parse(a.default)||null:a.default===void 0?null:a.default}(i):null,this._enumValues=i&&i.type==="enum"?i.values:null}evaluateWithoutErrorHandling(e,i,a,c,d,g,y,b){return this._evaluator.globals=e,this._evaluator.feature=i,this._evaluator.featureState=a,this._evaluator.canonical=c||null,this._evaluator.availableImages=d||null,this._evaluator.formattedSection=g,this._evaluator.featureTileCoord=y||null,this._evaluator.featureDistanceData=b||null,this.expression.evaluate(this._evaluator)}evaluate(e,i,a,c,d,g,y,b){this._evaluator.globals=e,this._evaluator.feature=i||null,this._evaluator.featureState=a||null,this._evaluator.canonical=c||null,this._evaluator.availableImages=d||null,this._evaluator.formattedSection=g||null,this._evaluator.featureTileCoord=y||null,this._evaluator.featureDistanceData=b||null;try{const E=this.expression.evaluate(this._evaluator);if(E==null||typeof E=="number"&&E!=E)return this._defaultValue;if(this._enumValues&&!(E in this._enumValues))throw new Ji(`Expected value to be one of ${Object.keys(this._enumValues).map(A=>JSON.stringify(A)).join(", ")}, but found ${JSON.stringify(E)} instead.`);return E}catch(E){return this._warningHistory[E.message]||(this._warningHistory[E.message]=!0,typeof console<"u"&&console.warn(E.message)),this._defaultValue}}}function fl(n){return Array.isArray(n)&&n.length>0&&typeof n[0]=="string"&&n[0]in hl}function is(n,e){const i=new As(hl,[],e?function(c){const d={color:ao,string:Fn,number:jt,enum:Fn,boolean:Ln,formatted:na,resolvedImage:es};return c.type==="array"?nr(d[c.value]||kn,c.length):d[c.type]}(e):void 0),a=i.parse(n,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return a?pf(new Mc(a,e)):jr(i.errors)}class rs{constructor(e,i){this.kind=e,this._styleExpression=i,this.isStateDependent=e!=="constant"&&!dc(i.expression)}evaluateWithoutErrorHandling(e,i,a,c,d,g){return this._styleExpression.evaluateWithoutErrorHandling(e,i,a,c,d,g)}evaluate(e,i,a,c,d,g){return this._styleExpression.evaluate(e,i,a,c,d,g)}}class Ic{constructor(e,i,a,c){this.kind=e,this.zoomStops=a,this._styleExpression=i,this.isStateDependent=e!=="camera"&&!dc(i.expression),this.interpolationType=c}evaluateWithoutErrorHandling(e,i,a,c,d,g){return this._styleExpression.evaluateWithoutErrorHandling(e,i,a,c,d,g)}evaluate(e,i,a,c,d,g){return this._styleExpression.evaluate(e,i,a,c,d,g)}interpolationFactor(e,i,a){return this.interpolationType?mo.interpolationFactor(this.interpolationType,e,i,a):0}}function ph(n,e){if((n=is(n,e)).result==="error")return n;const i=n.value.expression,a=oa(i);if(!a&&!Is(e))return jr([new qr("","data expressions not supported")]);const c=al(i,["zoom","pitch","distance-from-center"]);if(!c&&!ks(e))return jr([new qr("","zoom expressions not supported")]);const d=pl(i);return d||c?d instanceof qr?jr([d]):d instanceof mo&&!uh(e)?jr([new qr("",'"interpolate" expressions cannot be used with this property')]):pf(d?new Ic(a?"camera":"composite",n.value,d.labels,d instanceof mo?d.interpolation:void 0):new rs(a?"constant":"source",n.value)):jr([new qr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class ua{constructor(e,i){this._parameters=e,this._specification=i,Ro(this,Ac(this._parameters,this._specification))}static deserialize(e){return new ua(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function pl(n){let e=null;if(n instanceof rf)e=pl(n.result);else if(n instanceof ih){for(const i of n.args)if(e=pl(i),e)break}else(n instanceof gc||n instanceof mo)&&n.input instanceof ns&&n.input.name==="zoom"&&(e=n);return e instanceof qr||n.eachChild(i=>{const a=pl(i);a instanceof qr?e=a:!e&&a?e=new qr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):e&&a&&e!==a&&(e=new qr("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}class $t{constructor(e,i,a,c){this.message=(e?`${e}: `:"")+a,c&&(this.identifier=c),i!=null&&i.__line__&&(this.line=i.__line__)}}function Xr(n){const e=n.key,i=n.value,a=n.valueSpec||{},c=n.objectElementValidators||{},d=n.style,g=n.styleSpec;let y=[];const b=Kn(i);if(b!=="object")return[new $t(e,i,`object expected, ${b} found`)];for(const E in i){const A=E.split(".")[0],P=a[A]||a["*"];let z;c[A]?z=c[A]:a[A]?z=dr:c["*"]?z=c["*"]:a["*"]&&(z=dr),z?y=y.concat(z({key:(e&&`${e}.`)+E,value:i[E],valueSpec:P,style:d,styleSpec:g,object:i,objectKey:E},i)):y.push(new $t(e,i[E],`unknown property "${E}"`))}for(const E in a)c[E]||a[E].required&&a[E].default===void 0&&i[E]===void 0&&y.push(new $t(e,i,`missing required property "${E}"`));return y}function ml(n){const e=n.value,i=n.valueSpec,a=n.style,c=n.styleSpec,d=n.key,g=n.arrayElementValidator||dr;if(Kn(e)!=="array")return[new $t(d,e,`array expected, ${Kn(e)} found`)];if(i.length&&e.length!==i.length)return[new $t(d,e,`array length ${i.length} expected, length ${e.length} found`)];if(i["min-length"]&&e.length<i["min-length"])return[new $t(d,e,`array length at least ${i["min-length"]} expected, length ${e.length} found`)];let y={type:i.value,values:i.values,minimum:i.minimum,maximum:i.maximum,function:void 0};c.$version<7&&(y.function=i.function),Kn(i.value)==="object"&&(y=i.value);let b=[];for(let E=0;E<e.length;E++)b=b.concat(g({array:e,arrayIndex:E,value:e[E],valueSpec:y,style:a,styleSpec:c,key:`${d}[${E}]`}));return b}function gf(n){const e=n.key,i=n.value,a=n.valueSpec;let c=Kn(i);if(c==="number"&&i!=i&&(c="NaN"),c!=="number")return[new $t(e,i,`number expected, ${c} found`)];if("minimum"in a){let d=a.minimum;if(Kn(a.minimum)==="array"&&(d=a.minimum[n.arrayIndex]),i<d)return[new $t(e,i,`${i} is less than the minimum value ${d}`)]}if("maximum"in a){let d=a.maximum;if(Kn(a.maximum)==="array"&&(d=a.maximum[n.arrayIndex]),i>d)return[new $t(e,i,`${i} is greater than the maximum value ${d}`)]}return[]}function _f(n){const e=n.valueSpec,i=Gi(n.value.type);let a,c,d,g={};const y=i!=="categorical"&&n.value.property===void 0,b=!y,E=Kn(n.value.stops)==="array"&&Kn(n.value.stops[0])==="array"&&Kn(n.value.stops[0][0])==="object",A=Xr({key:n.key,value:n.value,valueSpec:n.styleSpec.function,style:n.style,styleSpec:n.styleSpec,objectElementValidators:{stops:function(O){if(i==="identity")return[new $t(O.key,O.value,'identity function may not have a "stops" property')];let F=[];const q=O.value;return F=F.concat(ml({key:O.key,value:q,valueSpec:O.valueSpec,style:O.style,styleSpec:O.styleSpec,arrayElementValidator:P})),Kn(q)==="array"&&q.length===0&&F.push(new $t(O.key,q,"array must have at least one stop")),F},default:function(O){return dr({key:O.key,value:O.value,valueSpec:e,style:O.style,styleSpec:O.styleSpec})}}});return i==="identity"&&y&&A.push(new $t(n.key,n.value,'missing required property "property"')),i==="identity"||n.value.stops||A.push(new $t(n.key,n.value,'missing required property "stops"')),i==="exponential"&&n.valueSpec.expression&&!uh(n.valueSpec)&&A.push(new $t(n.key,n.value,"exponential functions not supported")),n.styleSpec.$version>=8&&(b&&!Is(n.valueSpec)?A.push(new $t(n.key,n.value,"property functions not supported")):y&&!ks(n.valueSpec)&&A.push(new $t(n.key,n.value,"zoom functions not supported"))),i!=="categorical"&&!E||n.value.property!==void 0||A.push(new $t(n.key,n.value,'"property" property is required')),A;function P(O){let F=[];const q=O.value,Z=O.key;if(Kn(q)!=="array")return[new $t(Z,q,`array expected, ${Kn(q)} found`)];if(q.length!==2)return[new $t(Z,q,`array length 2 expected, length ${q.length} found`)];if(E){if(Kn(q[0])!=="object")return[new $t(Z,q,`object expected, ${Kn(q[0])} found`)];if(q[0].zoom===void 0)return[new $t(Z,q,"object stop key must have zoom")];if(q[0].value===void 0)return[new $t(Z,q,"object stop key must have value")];const le=Gi(q[0].zoom);if(typeof le!="number")return[new $t(Z,q[0].zoom,"stop zoom values must be numbers")];if(d&&d>le)return[new $t(Z,q[0].zoom,"stop zoom values must appear in ascending order")];le!==d&&(d=le,c=void 0,g={}),F=F.concat(Xr({key:`${Z}[0]`,value:q[0],valueSpec:{zoom:{}},style:O.style,styleSpec:O.styleSpec,objectElementValidators:{zoom:gf,value:z}}))}else F=F.concat(z({key:`${Z}[0]`,value:q[0],valueSpec:{},style:O.style,styleSpec:O.styleSpec},q));return fl(Do(q[1]))?F.concat([new $t(`${Z}[1]`,q[1],"expressions are not allowed in function stops.")]):F.concat(dr({key:`${Z}[1]`,value:q[1],valueSpec:e,style:O.style,styleSpec:O.styleSpec}))}function z(O,F){const q=Kn(O.value),Z=Gi(O.value),le=O.value!==null?O.value:F;if(a){if(q!==a)return[new $t(O.key,le,`${q} stop domain type must match previous stop domain type ${a}`)]}else a=q;if(q!=="number"&&q!=="string"&&q!=="boolean"&&typeof Z!="number"&&typeof Z!="string"&&typeof Z!="boolean")return[new $t(O.key,le,"stop domain value must be a number, string, or boolean")];if(q!=="number"&&i!=="categorical"){let ge=`number expected, ${q} found`;return Is(e)&&i===void 0&&(ge+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new $t(O.key,le,ge)]}return i!=="categorical"||q!=="number"||typeof Z=="number"&&isFinite(Z)&&Math.floor(Z)===Z?i!=="categorical"&&q==="number"&&typeof Z=="number"&&typeof c=="number"&&c!==void 0&&Z<c?[new $t(O.key,le,"stop domain values must appear in ascending order")]:(c=Z,i==="categorical"&&Z in g?[new $t(O.key,le,"stop domain values must be unique")]:(g[Z]=!0,[])):[new $t(O.key,le,`integer expected, found ${String(Z)}`)]}}function ha(n){const e=(n.expressionContext==="property"?ph:is)(Do(n.value),n.valueSpec);if(e.result==="error")return e.value.map(a=>new $t(`${n.key}${a.key}`,n.value,a.message));const i=e.value.expression||e.value._styleExpression.expression;if(n.expressionContext==="property"&&n.propertyKey==="text-font"&&!i.outputDefined())return[new $t(n.key,n.value,`Invalid data expression for "${n.propertyKey}". Output values must be contained as literals within the expression.`)];if(n.expressionContext==="property"&&n.propertyType==="layout"&&!dc(i))return[new $t(n.key,n.value,'"feature-state" data expressions are not supported with layout properties.')];if(n.expressionContext==="filter")return yf(i,n);if(n.expressionContext&&n.expressionContext.indexOf("cluster")===0){if(!al(i,["zoom","feature-state"]))return[new $t(n.key,n.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(n.expressionContext==="cluster-initial"&&!oa(i))return[new $t(n.key,n.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function yf(n,e){const i=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(e.valueSpec&&e.valueSpec.expression)for(const c of e.valueSpec.expression.parameters)i.delete(c);if(i.size===0)return[];const a=[];return n instanceof ns&&i.has(n.name)?[new $t(e.key,e.value,`["${n.name}"] expression is not supported in a filter for a ${e.object.type} layer with id: ${e.object.id}`)]:(n.eachChild(c=>{a.push(...yf(c,e))}),a)}function kc(n){const e=n.key,i=n.value,a=n.valueSpec,c=[];return Array.isArray(a.values)?a.values.indexOf(Gi(i))===-1&&c.push(new $t(e,i,`expected one of [${a.values.join(", ")}], ${JSON.stringify(i)} found`)):Object.keys(a.values).indexOf(Gi(i))===-1&&c.push(new $t(e,i,`expected one of [${Object.keys(a.values).join(", ")}], ${JSON.stringify(i)} found`)),c}function da(n){if(n===!0||n===!1)return!0;if(!Array.isArray(n)||n.length===0)return!1;switch(n[0]){case"has":return n.length>=2&&n[1]!=="$id"&&n[1]!=="$type";case"in":return n.length>=3&&(typeof n[1]!="string"||Array.isArray(n[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return n.length!==3||Array.isArray(n[1])||Array.isArray(n[2]);case"any":case"all":for(const e of n.slice(1))if(!da(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}function Ps(n,e="fill"){if(n==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};da(n)||(n=pa(n));const i=n;let a=!0;try{a=function(E){if(!fa(E))return E;let A=Do(E);return gl(A),A=kr(A),A}(i)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(i,null,2)}
        `)}const c=tt[`filter_${e}`],d=is(a,c);let g=null;if(d.result==="error")throw new Error(d.value.map(E=>`${E.key}: ${E.message}`).join(", "));g=(E,A,P)=>d.value.evaluate(E,A,{},P);let y=null,b=null;if(a!==i){const E=is(i,c);if(E.result==="error")throw new Error(E.value.map(A=>`${A.key}: ${A.message}`).join(", "));y=(A,P,z,O,F)=>E.value.evaluate(A,P,{},z,void 0,void 0,O,F),b=!oa(E.value.expression)}return{filter:g,dynamicFilter:y||void 0,needGeometry:vf(a),needFeature:!!b}}function kr(n){if(!Array.isArray(n))return n;const e=function(i){if(wg.has(i[0])){for(let a=1;a<i.length;a++)if(fa(i[a]))return!0}return i}(n);return e===!0?e:e.map(i=>kr(i))}function gl(n){let e=!1;const i=[];if(n[0]==="case"){for(let a=1;a<n.length-1;a+=2)e=e||fa(n[a]),i.push(n[a+1]);i.push(n[n.length-1])}else if(n[0]==="match"){e=e||fa(n[1]);for(let a=2;a<n.length-1;a+=2)i.push(n[a+1]);i.push(n[n.length-1])}else if(n[0]==="step"){e=e||fa(n[1]);for(let a=1;a<n.length-1;a+=2)i.push(n[a+1])}e&&(n.length=0,n.push("any",...i));for(let a=1;a<n.length;a++)gl(n[a])}function fa(n){if(!Array.isArray(n))return!1;if((e=n[0])==="pitch"||e==="distance-from-center")return!0;var e;for(let i=1;i<n.length;i++)if(fa(n[i]))return!0;return!1}const wg=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function Eg(n,e){return n<e?-1:n>e?1:0}function vf(n){if(!Array.isArray(n))return!1;if(n[0]==="within")return!0;for(let e=1;e<n.length;e++)if(vf(n[e]))return!0;return!1}function pa(n){if(!n)return!0;const e=n[0];return n.length<=1?e!=="any":e==="=="?mh(n[1],n[2],"=="):e==="!="?zc(mh(n[1],n[2],"==")):e==="<"||e===">"||e==="<="||e===">="?mh(n[1],n[2],e):e==="any"?(i=n.slice(1),["any"].concat(i.map(pa))):e==="all"?["all"].concat(n.slice(1).map(pa)):e==="none"?["all"].concat(n.slice(1).map(pa).map(zc)):e==="in"?Pc(n[1],n.slice(2)):e==="!in"?zc(Pc(n[1],n.slice(2))):e==="has"?xf(n[1]):e==="!has"?zc(xf(n[1])):e!=="within"||n;var i}function mh(n,e,i){switch(n){case"$type":return[`filter-type-${i}`,e];case"$id":return[`filter-id-${i}`,e];default:return[`filter-${i}`,n,e]}}function Pc(n,e){if(e.length===0)return!1;switch(n){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(i=>typeof i!=typeof e[0])?["filter-in-large",n,["literal",e.sort(Eg)]]:["filter-in-small",n,["literal",e]]}}function xf(n){switch(n){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",n]}}function zc(n){return["!",n]}function _l(n){return da(Do(n.value))?ha(Ro({},n,{expressionContext:"filter",valueSpec:n.styleSpec[`filter_${n.layerType||"fill"}`]})):bf(n)}function bf(n){const e=n.value,i=n.key;if(Kn(e)!=="array")return[new $t(i,e,`array expected, ${Kn(e)} found`)];const a=n.styleSpec;let c,d=[];if(e.length<1)return[new $t(i,e,"filter array must have at least 1 element")];switch(d=d.concat(kc({key:`${i}[0]`,value:e[0],valueSpec:a.filter_operator,style:n.style,styleSpec:n.styleSpec})),Gi(e[0])){case"<":case"<=":case">":case">=":e.length>=2&&Gi(e[1])==="$type"&&d.push(new $t(i,e,`"$type" cannot be use with operator "${e[0]}"`));case"==":case"!=":e.length!==3&&d.push(new $t(i,e,`filter array for operator "${e[0]}" must have 3 elements`));case"in":case"!in":e.length>=2&&(c=Kn(e[1]),c!=="string"&&d.push(new $t(`${i}[1]`,e[1],`string expected, ${c} found`)));for(let g=2;g<e.length;g++)c=Kn(e[g]),Gi(e[1])==="$type"?d=d.concat(kc({key:`${i}[${g}]`,value:e[g],valueSpec:a.geometry_type,style:n.style,styleSpec:n.styleSpec})):c!=="string"&&c!=="number"&&c!=="boolean"&&d.push(new $t(`${i}[${g}]`,e[g],`string, number, or boolean expected, ${c} found`));break;case"any":case"all":case"none":for(let g=1;g<e.length;g++)d=d.concat(bf({key:`${i}[${g}]`,value:e[g],style:n.style,styleSpec:n.styleSpec}));break;case"has":case"!has":c=Kn(e[1]),e.length!==2?d.push(new $t(i,e,`filter array for "${e[0]}" operator must have 2 elements`)):c!=="string"&&d.push(new $t(`${i}[1]`,e[1],`string expected, ${c} found`));break;case"within":c=Kn(e[1]),e.length!==2?d.push(new $t(i,e,`filter array for "${e[0]}" operator must have 2 elements`)):c!=="object"&&d.push(new $t(`${i}[1]`,e[1],`object expected, ${c} found`))}return d}function gh(n,e){const i=n.key,a=n.style,c=n.styleSpec,d=n.value,g=n.objectKey,y=c[`${e}_${n.layerType}`];if(!y)return[];const b=g.match(/^(.*)-transition$/);if(e==="paint"&&b&&y[b[1]]&&y[b[1]].transition)return dr({key:i,value:d,valueSpec:c.transition,style:a,styleSpec:c});const E=n.valueSpec||y[g];if(!E)return[new $t(i,d,`unknown property "${g}"`)];let A;if(Kn(d)==="string"&&Is(E)&&!E.tokens&&(A=/^{([^}]+)}$/.exec(d)))return[new $t(i,d,`"${g}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(A[1])} }\`.`)];const P=[];return n.layerType==="symbol"&&(g==="text-field"&&a&&!a.glyphs&&P.push(new $t(i,d,'use of "text-field" requires a style "glyphs" property')),g==="text-font"&&dl(Do(d))&&Gi(d.type)==="identity"&&P.push(new $t(i,d,'"text-font" does not support identity functions'))),P.concat(dr({key:n.key,value:d,valueSpec:E,style:a,styleSpec:c,expressionContext:"property",propertyType:e,propertyKey:g}))}function _h(n){return gh(n,"paint")}function wf(n){return gh(n,"layout")}function Lc(n){let e=[];const i=n.value,a=n.key,c=n.style,d=n.styleSpec;i.type||i.ref||e.push(new $t(a,i,'either "type" or "ref" is required'));let g=Gi(i.type);const y=Gi(i.ref);if(i.id){const b=Gi(i.id);for(let E=0;E<n.arrayIndex;E++){const A=c.layers[E];Gi(A.id)===b&&e.push(new $t(a,i.id,`duplicate layer id "${i.id}", previously used at line ${A.id.__line__}`))}}if("ref"in i){let b;["type","source","source-layer","filter","layout"].forEach(E=>{E in i&&e.push(new $t(a,i[E],`"${E}" is prohibited for ref layers`))}),c.layers.forEach(E=>{Gi(E.id)===y&&(b=E)}),b?b.ref?e.push(new $t(a,i.ref,"ref cannot reference another ref layer")):g=Gi(b.type):typeof y=="string"&&e.push(new $t(a,i.ref,`ref layer "${y}" not found`))}else if(g!=="background"&&g!=="sky")if(i.source){const b=c.sources&&c.sources[i.source],E=b&&Gi(b.type);b?E==="vector"&&g==="raster"?e.push(new $t(a,i.source,`layer "${i.id}" requires a raster source`)):E==="raster"&&g!=="raster"?e.push(new $t(a,i.source,`layer "${i.id}" requires a vector source`)):E!=="vector"||i["source-layer"]?E==="raster-dem"&&g!=="hillshade"?e.push(new $t(a,i.source,"raster-dem source can only be used with layer type 'hillshade'.")):g!=="line"||!i.paint||!i.paint["line-gradient"]&&!i.paint["line-trim-offset"]||E==="geojson"&&b.lineMetrics||e.push(new $t(a,i,`layer "${i.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):e.push(new $t(a,i,`layer "${i.id}" must specify a "source-layer"`)):e.push(new $t(a,i.source,`source "${i.source}" not found`))}else e.push(new $t(a,i,'missing required property "source"'));return e=e.concat(Xr({key:a,value:i,valueSpec:d.layer,style:n.style,styleSpec:n.styleSpec,objectElementValidators:{"*":()=>[],type:()=>dr({key:`${a}.type`,value:i.type,valueSpec:d.layer.type,style:n.style,styleSpec:n.styleSpec,object:i,objectKey:"type"}),filter:b=>_l(Ro({layerType:g},b)),layout:b=>Xr({layer:i,key:b.key,value:b.value,valueSpec:{},style:b.style,styleSpec:b.styleSpec,objectElementValidators:{"*":E=>wf(Ro({layerType:g},E))}}),paint:b=>Xr({layer:i,key:b.key,value:b.value,valueSpec:{},style:b.style,styleSpec:b.styleSpec,objectElementValidators:{"*":E=>_h(Ro({layerType:g},E))}})}})),e}function Bo(n){const e=n.value,i=n.key,a=Kn(e);return a!=="string"?[new $t(i,e,`string expected, ${a} found`)]:[]}const yh={promoteId:function({key:n,value:e}){if(Kn(e)==="string")return Bo({key:n,value:e});{const i=[];for(const a in e)i.push(...Bo({key:`${n}.${a}`,value:e[a]}));return i}}};function Ef(n){const e=n.value,i=n.key,a=n.styleSpec,c=n.style;if(!e.type)return[new $t(i,e,'"type" is required')];const d=Gi(e.type);let g;switch(d){case"vector":case"raster":case"raster-dem":return g=Xr({key:i,value:e,valueSpec:a[`source_${d.replace("-","_")}`],style:n.style,styleSpec:a,objectElementValidators:yh}),g;case"geojson":if(g=Xr({key:i,value:e,valueSpec:a.source_geojson,style:c,styleSpec:a,objectElementValidators:yh}),e.cluster)for(const y in e.clusterProperties){const[b,E]=e.clusterProperties[y],A=typeof b=="string"?[b,["accumulated"],["get",y]]:b;g.push(...ha({key:`${i}.${y}.map`,value:E,expressionContext:"cluster-map"})),g.push(...ha({key:`${i}.${y}.reduce`,value:A,expressionContext:"cluster-reduce"}))}return g;case"video":return Xr({key:i,value:e,valueSpec:a.source_video,style:c,styleSpec:a});case"image":return Xr({key:i,value:e,valueSpec:a.source_image,style:c,styleSpec:a});case"canvas":return[new $t(i,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return kc({key:`${i}.type`,value:e.type,valueSpec:{values:Tf(a)},style:c,styleSpec:a})}}function Tf(n){return n.source.reduce((e,i)=>{const a=n[i];return a.type.type==="enum"&&(e=e.concat(Object.keys(a.type.values))),e},[])}function Sf(n){const e=n.value,i=n.styleSpec,a=i.light,c=n.style;let d=[];const g=Kn(e);if(e===void 0)return d;if(g!=="object")return d=d.concat([new $t("light",e,`object expected, ${g} found`)]),d;for(const y in e){const b=y.match(/^(.*)-transition$/);d=d.concat(b&&a[b[1]]&&a[b[1]].transition?dr({key:y,value:e[y],valueSpec:i.transition,style:c,styleSpec:i}):a[y]?dr({key:y,value:e[y],valueSpec:a[y],style:c,styleSpec:i}):[new $t(y,e[y],`unknown property "${y}"`)])}return d}function Rc(n){const e=n.value,i=n.key,a=n.style,c=n.styleSpec,d=c.terrain;let g=[];const y=Kn(e);if(e===void 0)return g;if(y!=="object")return g=g.concat([new $t("terrain",e,`object expected, ${y} found`)]),g;for(const b in e){const E=b.match(/^(.*)-transition$/);g=g.concat(E&&d[E[1]]&&d[E[1]].transition?dr({key:b,value:e[b],valueSpec:c.transition,style:a,styleSpec:c}):d[b]?dr({key:b,value:e[b],valueSpec:d[b],style:a,styleSpec:c}):[new $t(b,e[b],`unknown property "${b}"`)])}if(e.source){const b=a.sources&&a.sources[e.source],E=b&&Gi(b.type);b?E!=="raster-dem"&&g.push(new $t(i,e.source,`terrain cannot be used with a source of type ${String(E)}, it only be used with a "raster-dem" source type`)):g.push(new $t(i,e.source,`source "${e.source}" not found`))}else g.push(new $t(i,e,'terrain is missing required property "source"'));return g}function Cf(n){const e=n.value,i=n.style,a=n.styleSpec,c=a.fog;let d=[];const g=Kn(e);if(e===void 0)return d;if(g!=="object")return d=d.concat([new $t("fog",e,`object expected, ${g} found`)]),d;for(const y in e){const b=y.match(/^(.*)-transition$/);d=d.concat(b&&c[b[1]]&&c[b[1]].transition?dr({key:y,value:e[y],valueSpec:a.transition,style:i,styleSpec:a}):c[y]?dr({key:y,value:e[y],valueSpec:c[y],style:i,styleSpec:a}):[new $t(y,e[y],`unknown property "${y}"`)])}return d}const Af={"*":()=>[],array:ml,boolean:function(n){const e=n.value,i=n.key,a=Kn(e);return a!=="boolean"?[new $t(i,e,`boolean expected, ${a} found`)]:[]},number:gf,color:function(n){const e=n.key,i=n.value,a=Kn(i);return a!=="string"?[new $t(e,i,`color expected, ${a} found`)]:Ya(i)===null?[new $t(e,i,`color expected, "${i}" found`)]:[]},enum:kc,filter:_l,function:_f,layer:Lc,object:Xr,source:Ef,light:Sf,terrain:Rc,fog:Cf,string:Bo,formatted:function(n){return Bo(n).length===0?[]:ha(n)},resolvedImage:function(n){return Bo(n).length===0?[]:ha(n)},projection:function(n){const e=n.value,i=n.styleSpec,a=i.projection,c=n.style;let d=[];const g=Kn(e);if(g==="object")for(const y in e)d=d.concat(dr({key:y,value:e[y],valueSpec:a[y],style:c,styleSpec:i}));else g!=="string"&&(d=d.concat([new $t("projection",e,`object or string expected, ${g} found`)]));return d}};function dr(n){const e=n.value,i=n.valueSpec,a=n.styleSpec;return i.expression&&dl(Gi(e))?_f(n):i.expression&&fl(Do(e))?ha(n):i.type&&Af[i.type]?Af[i.type](n):Xr(Ro({},n,{valueSpec:i.type?a[i.type]:i}))}function Tg(n){const e=n.value,i=n.key,a=Bo(n);return a.length||(e.indexOf("{fontstack}")===-1&&a.push(new $t(i,e,'"glyphs" url must include a "{fontstack}" token')),e.indexOf("{range}")===-1&&a.push(new $t(i,e,'"glyphs" url must include a "{range}" token'))),a}function vh(n,e=tt){return Fo(dr({key:"",value:n,valueSpec:e.$root,styleSpec:e,style:n,objectElementValidators:{glyphs:Tg,"*":()=>[]}}))}const Sg=n=>Fo(_h(n)),Cg=n=>Fo(wf(n));function Fo(n){return n.slice().sort((e,i)=>e.line&&i.line?e.line-i.line:0)}function Mf(n,e){let i=!1;if(e&&e.length)for(const a of e)n.fire(new ai(new Error(a.message))),i=!0;return i}var ma=_o;function _o(n,e,i){var a=this.cells=[];if(n instanceof ArrayBuffer){this.arrayBuffer=n;var c=new Int32Array(this.arrayBuffer);n=c[0],this.d=(e=c[1])+2*(i=c[2]);for(var d=0;d<this.d*this.d;d++){var g=c[3+d],y=c[3+d+1];a.push(g===y?null:c.subarray(g,y))}var b=c[3+a.length+1];this.keys=c.subarray(c[3+a.length],b),this.bboxes=c.subarray(b),this.insert=this._insertReadonly}else{this.d=e+2*i;for(var E=0;E<this.d*this.d;E++)a.push([]);this.keys=[],this.bboxes=[]}this.n=e,this.extent=n,this.padding=i,this.scale=e/n,this.uid=0;var A=i/e*n;this.min=-A,this.max=n+A}_o.prototype.insert=function(n,e,i,a,c){this._forEachCell(e,i,a,c,this._insertCell,this.uid++),this.keys.push(n),this.bboxes.push(e),this.bboxes.push(i),this.bboxes.push(a),this.bboxes.push(c)},_o.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},_o.prototype._insertCell=function(n,e,i,a,c,d){this.cells[c].push(d)},_o.prototype.query=function(n,e,i,a,c){var d=this.min,g=this.max;if(n<=d&&e<=d&&g<=i&&g<=a&&!c)return Array.prototype.slice.call(this.keys);var y=[];return this._forEachCell(n,e,i,a,this._queryCell,y,{},c),y},_o.prototype._queryCell=function(n,e,i,a,c,d,g,y){var b=this.cells[c];if(b!==null)for(var E=this.keys,A=this.bboxes,P=0;P<b.length;P++){var z=b[P];if(g[z]===void 0){var O=4*z;(y?y(A[O+0],A[O+1],A[O+2],A[O+3]):n<=A[O+2]&&e<=A[O+3]&&i>=A[O+0]&&a>=A[O+1])?(g[z]=!0,d.push(E[z])):g[z]=!1}}},_o.prototype._forEachCell=function(n,e,i,a,c,d,g,y){for(var b=this._convertToCellCoord(n),E=this._convertToCellCoord(e),A=this._convertToCellCoord(i),P=this._convertToCellCoord(a),z=b;z<=A;z++)for(var O=E;O<=P;O++){var F=this.d*O+z;if((!y||y(this._convertFromCellCoord(z),this._convertFromCellCoord(O),this._convertFromCellCoord(z+1),this._convertFromCellCoord(O+1)))&&c.call(this,n,e,i,a,F,d,g,y))return}},_o.prototype._convertFromCellCoord=function(n){return(n-this.padding)/this.scale},_o.prototype._convertToCellCoord=function(n){return Math.max(0,Math.min(this.d-1,Math.floor(n*this.scale)+this.padding))},_o.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var n=this.cells,e=3+this.cells.length+1+1,i=0,a=0;a<this.cells.length;a++)i+=this.cells[a].length;var c=new Int32Array(e+i+this.keys.length+this.bboxes.length);c[0]=this.extent,c[1]=this.n,c[2]=this.padding;for(var d=e,g=0;g<n.length;g++){var y=n[g];c[3+g]=d,c.set(y,d),d+=y.length}return c[3+n.length]=d,c.set(this.keys,d),c[3+n.length+1]=d+=this.keys.length,c.set(this.bboxes,d),d+=this.bboxes.length,c.buffer};const Dc={};function Zt(n,e,i={}){Object.defineProperty(n,"_classRegistryKey",{value:e,writeable:!1}),Dc[e]={klass:n,omit:i.omit||[]}}Zt(Object,"Object"),ma.serialize=function(n,e){const i=n.toArrayBuffer();return e&&e.push(i),{buffer:i}},ma.deserialize=function(n){return new ma(n.buffer)},Object.defineProperty(ma,"name",{value:"Grid"}),Zt(ma,"Grid"),Zt(ki,"Color"),Zt(Error,"Error"),Zt(Bi,"AJAXError"),Zt(Wr,"ResolvedImage"),Zt(ua,"StylePropertyFunction"),Zt(Mc,"StyleExpression",{omit:["_evaluator"]}),Zt(Ic,"ZoomDependentExpression"),Zt(rs,"ZoomConstantExpression"),Zt(ns,"CompoundExpression",{omit:["_evaluate"]});for(const n in hl)Dc[hl[n]._classRegistryKey]||Zt(hl[n],`Expression${n}`);function If(n){return n&&typeof ArrayBuffer<"u"&&(n instanceof ArrayBuffer||n.constructor&&n.constructor.name==="ArrayBuffer")}function kf(n){return S.ImageBitmap&&n instanceof S.ImageBitmap}function os(n,e){if(n==null||typeof n=="boolean"||typeof n=="number"||typeof n=="string"||n instanceof Boolean||n instanceof Number||n instanceof String||n instanceof Date||n instanceof RegExp)return n;if(If(n)||kf(n))return e&&e.push(n),n;if(ArrayBuffer.isView(n)){const i=n;return e&&e.push(i.buffer),i}if(n instanceof S.ImageData)return e&&e.push(n.data.buffer),n;if(Array.isArray(n)){const i=[];for(const a of n)i.push(os(a,e));return i}if(typeof n=="object"){const i=n.constructor,a=i._classRegistryKey;if(!a)throw new Error(`can't serialize object of unregistered class ${a}`);const c=i.serialize?i.serialize(n,e):{};if(!i.serialize){for(const d in n)n.hasOwnProperty(d)&&(Dc[a].omit.indexOf(d)>=0||(c[d]=os(n[d],e)));n instanceof Error&&(c.message=n.message)}if(c.$name)throw new Error("$name property is reserved for worker serialization logic.");return a!=="Object"&&(c.$name=a),c}throw new Error("can't serialize object of type "+typeof n)}function yl(n){if(n==null||typeof n=="boolean"||typeof n=="number"||typeof n=="string"||n instanceof Boolean||n instanceof Number||n instanceof String||n instanceof Date||n instanceof RegExp||If(n)||kf(n)||ArrayBuffer.isView(n)||n instanceof S.ImageData)return n;if(Array.isArray(n))return n.map(yl);if(typeof n=="object"){const e=n.$name||"Object",{klass:i}=Dc[e];if(!i)throw new Error(`can't deserialize unregistered class ${e}`);if(i.deserialize)return i.deserialize(n);const a=Object.create(i.prototype);for(const c of Object.keys(n))c!=="$name"&&(a[c]=yl(n[c]));return a}throw new Error("can't deserialize object of type "+typeof n)}const xh=n=>n>=1536&&n<=1791,Pf=n=>n>=1872&&n<=1919,bh=n=>n>=2208&&n<=2303,wh=n=>n>=11904&&n<=12031,Eh=n=>n>=12032&&n<=12255,Th=n=>n>=12272&&n<=12287,ga=n=>n>=12288&&n<=12351,vl=n=>n>=12352&&n<=12447,Oc=n=>n>=12448&&n<=12543,zf=n=>n>=12544&&n<=12591,Sh=n=>n>=12704&&n<=12735,Lf=n=>n>=12736&&n<=12783,Rf=n=>n>=12784&&n<=12799,Df=n=>n>=12800&&n<=13055,Of=n=>n>=13056&&n<=13311,Bf=n=>n>=13312&&n<=19903,Ch=n=>n>=19968&&n<=40959,Ff=n=>n>=40960&&n<=42127,Nf=n=>n>=42128&&n<=42191,Ah=n=>n>=44032&&n<=55215,xl=n=>n>=63744&&n<=64255,h=n=>n>=64336&&n<=65023,r=n=>n>=65040&&n<=65055,l=n=>n>=65072&&n<=65103,p=n=>n>=65104&&n<=65135,_=n=>n>=65136&&n<=65279,x=n=>n>=65280&&n<=65519;function T(n){for(const e of n)if(R(e.charCodeAt(0)))return!0;return!1}function C(n){for(const e of n)if(!M(e.charCodeAt(0)))return!1;return!0}function M(n){return!(xh(n)||Pf(n)||bh(n)||h(n)||_(n))}function R(n){return!(n!==746&&n!==747&&(n<4352||!(Sh(n)||zf(n)||l(n)&&!(n>=65097&&n<=65103)||xl(n)||Of(n)||wh(n)||Lf(n)||!(!ga(n)||n>=12296&&n<=12305||n>=12308&&n<=12319||n===12336)||Bf(n)||Ch(n)||Df(n)||(e=>e>=12592&&e<=12687)(n)||(e=>e>=43360&&e<=43391)(n)||(e=>e>=55216&&e<=55295)(n)||(e=>e>=4352&&e<=4607)(n)||Ah(n)||vl(n)||Th(n)||(e=>e>=12688&&e<=12703)(n)||Eh(n)||Rf(n)||Oc(n)&&n!==12540||!(!x(n)||n===65288||n===65289||n===65293||n>=65306&&n<=65310||n===65339||n===65341||n===65343||n>=65371&&n<=65503||n===65507||n>=65512&&n<=65519)||!(!p(n)||n>=65112&&n<=65118||n>=65123&&n<=65126)||(e=>e>=5120&&e<=5759)(n)||(e=>e>=6320&&e<=6399)(n)||r(n)||(e=>e>=19904&&e<=19967)(n)||Ff(n)||Nf(n))))}function L(n){return!(R(n)||function(e){return!!((i=>i>=128&&i<=255)(e)&&(e===167||e===169||e===174||e===177||e===188||e===189||e===190||e===215||e===247)||(i=>i>=8192&&i<=8303)(e)&&(e===8214||e===8224||e===8225||e===8240||e===8241||e===8251||e===8252||e===8258||e===8263||e===8264||e===8265||e===8273)||(i=>i>=8448&&i<=8527)(e)||(i=>i>=8528&&i<=8591)(e)||(i=>i>=8960&&i<=9215)(e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||e===9003||e>=9085&&e<=9114||e>=9150&&e<=9165||e===9167||e>=9169&&e<=9179||e>=9186&&e<=9215)||(i=>i>=9216&&i<=9279)(e)&&e!==9251||(i=>i>=9280&&i<=9311)(e)||(i=>i>=9312&&i<=9471)(e)||(i=>i>=9632&&i<=9727)(e)||(i=>i>=9728&&i<=9983)(e)&&!(e>=9754&&e<=9759)||(i=>i>=11008&&i<=11263)(e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||ga(e)||Oc(e)||(i=>i>=57344&&i<=63743)(e)||l(e)||p(e)||x(e)||e===8734||e===8756||e===8757||e>=9984&&e<=10087||e>=10102&&e<=10131||e===65532||e===65533)}(n))}function U(n){return n>=1424&&n<=2303||h(n)||_(n)}function G(n,e){return!(!e&&U(n)||n>=2304&&n<=3583||n>=3840&&n<=4255||(i=>i>=6016&&i<=6143)(n))}function Q(n){for(const e of n)if(U(e.charCodeAt(0)))return!0;return!1}const K="deferred",J="loading",H="loaded";let W=null,ie="unavailable",ee=null;const he=function(n){n&&typeof n=="string"&&n.indexOf("NetworkError")>-1&&(ie="error"),W&&W(n)};function we(){ve.fire(new Bn("pluginStateChange",{pluginStatus:ie,pluginURL:ee}))}const ve=new mi,Pe=function(){return ie},He=function(){if(ie!==K||!ee)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");ie=J,we(),ee&&tr({url:ee},n=>{n?he(n):(ie=H,we())})},qe={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>ie===H||qe.applyArabicShaping!=null,isLoading:()=>ie===J,setState(n){ie=n.pluginStatus,ee=n.pluginURL},isParsed:()=>qe.applyArabicShaping!=null&&qe.processBidirectionalText!=null&&qe.processStyledBidirectionalText!=null,getPluginURL:()=>ee};class Le{constructor(e,i){this.zoom=e,i?(this.now=i.now,this.fadeDuration=i.fadeDuration,this.transition=i.transition,this.pitch=i.pitch):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0)}isSupportedScript(e){return function(i,a){for(const c of i)if(!G(c.charCodeAt(0),a))return!1;return!0}(e,qe.isLoaded())}}class It{constructor(e,i){this.property=e,this.value=i,this.expression=function(a,c){if(dl(a))return new ua(a,c);if(fl(a)){const d=ph(a,c);if(d.result==="error")throw new Error(d.value.map(g=>`${g.key}: ${g.message}`).join(", "));return d.value}{let d=a;return typeof a=="string"&&c.type==="color"&&(d=ki.parse(a)),{kind:"constant",evaluate:()=>d}}}(i===void 0?e.specification.default:i,e.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(e,i,a){return this.property.possiblyEvaluate(this,e,i,a)}}class Ue{constructor(e){this.property=e,this.value=new It(e,void 0)}transitioned(e,i){return new Xe(this.property,this.value,i,Ve({},e.transition,this.transition),e.now)}untransitioned(){return new Xe(this.property,this.value,null,{},0)}}class st{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues)}getValue(e){return sn(this._values[e].value.value)}setValue(e,i){this._values.hasOwnProperty(e)||(this._values[e]=new Ue(this._values[e].property)),this._values[e].value=new It(this._values[e].property,i===null?void 0:sn(i))}getTransition(e){return sn(this._values[e].transition)}setTransition(e,i){this._values.hasOwnProperty(e)||(this._values[e]=new Ue(this._values[e].property)),this._values[e].transition=sn(i)||void 0}serialize(){const e={};for(const i of Object.keys(this._values)){const a=this.getValue(i);a!==void 0&&(e[i]=a);const c=this.getTransition(i);c!==void 0&&(e[`${i}-transition`]=c)}return e}transitioned(e,i){const a=new Et(this._properties);for(const c of Object.keys(this._values))a._values[c]=this._values[c].transitioned(e,i._values[c]);return a}untransitioned(){const e=new Et(this._properties);for(const i of Object.keys(this._values))e._values[i]=this._values[i].untransitioned();return e}}class Xe{constructor(e,i,a,c,d){const g=c.delay||0,y=c.duration||0;d=d||0,this.property=e,this.value=i,this.begin=d+g,this.end=this.begin+y,e.specification.transition&&(c.delay||c.duration)&&(this.prior=a)}possiblyEvaluate(e,i,a){const c=e.now||0,d=this.value.possiblyEvaluate(e,i,a),g=this.prior;if(g){if(c>this.end)return this.prior=null,d;if(this.value.isDataDriven())return this.prior=null,d;if(c<this.begin)return g.possiblyEvaluate(e,i,a);{const y=(c-this.begin)/(this.end-this.begin);return this.property.interpolate(g.possiblyEvaluate(e,i,a),d,Re(y))}}return d}}class Et{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,i,a){const c=new Pt(this._properties);for(const d of Object.keys(this._values))c._values[d]=this._values[d].possiblyEvaluate(e,i,a);return c}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class Je{constructor(e){this._properties=e,this._values=Object.create(e.defaultPropertyValues)}getValue(e){return sn(this._values[e].value)}setValue(e,i){this._values[e]=new It(this._values[e].property,i===null?void 0:sn(i))}serialize(){const e={};for(const i of Object.keys(this._values)){const a=this.getValue(i);a!==void 0&&(e[i]=a)}return e}possiblyEvaluate(e,i,a){const c=new Pt(this._properties);for(const d of Object.keys(this._values))c._values[d]=this._values[d].possiblyEvaluate(e,i,a);return c}}class pt{constructor(e,i,a){this.property=e,this.value=i,this.parameters=a}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,i,a,c){return this.property.evaluate(this.value,this.parameters,e,i,a,c)}}class Pt{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class De{constructor(e){this.specification=e}possiblyEvaluate(e,i){return e.expression.evaluate(i)}interpolate(e,i,a){const c=_c[this.specification.type];return c?c(e,i,a):e}}class We{constructor(e,i){this.specification=e,this.overrides=i}possiblyEvaluate(e,i,a,c){return new pt(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(i,null,{},a,c)}:e.expression,i)}interpolate(e,i,a){if(e.value.kind!=="constant"||i.value.kind!=="constant")return e;if(e.value.value===void 0||i.value.value===void 0)return new pt(this,{kind:"constant",value:void 0},e.parameters);const c=_c[this.specification.type];return c?new pt(this,{kind:"constant",value:c(e.value.value,i.value.value,a)},e.parameters):e}evaluate(e,i,a,c,d,g){return e.kind==="constant"?e.value:e.evaluate(i,a,c,d,g)}}class Qt{constructor(e){this.specification=e}possiblyEvaluate(e,i,a,c){return!!e.expression.evaluate(i,null,{},a,c)}interpolate(){return!1}}class ln{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const i=new Le(0,{});for(const a in e){const c=e[a];c.specification.overridable&&this.overridableProperties.push(a);const d=this.defaultPropertyValues[a]=new It(c,void 0),g=this.defaultTransitionablePropertyValues[a]=new Ue(c);this.defaultTransitioningPropertyValues[a]=g.untransitioned(),this.defaultPossiblyEvaluatedValues[a]=d.possiblyEvaluate(i)}}}function Jt(n,e){return 256*(n=lt(Math.floor(n),0,255))+lt(Math.floor(e),0,255)}Zt(We,"DataDrivenProperty"),Zt(De,"DataConstantProperty"),Zt(Qt,"ColorRampProperty");const mn={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Tn{constructor(e,i){this._structArray=e,this._pos1=i*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class cn{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,i){return e._trim(),i&&(e.isTransferred=!0,i.push(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const i=Object.create(this.prototype);return i.arrayBuffer=e.arrayBuffer,i.length=e.length,i.capacity=e.arrayBuffer.byteLength/i.bytesPerElement,i._refreshViews(),i}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const i=this.uint8;this._refreshViews(),i&&this.uint8.set(i)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function Gt(n,e=1){let i=0,a=0;return{members:n.map(c=>{const d=mn[c.type].BYTES_PER_ELEMENT,g=i=ei(i,Math.max(e,d)),y=c.components||1;return a=Math.max(a,d),i+=d*y,{name:c.name,type:c.type,components:y,offset:g}}),size:ei(i,Math.max(a,e)),alignment:e}}function ei(n,e){return Math.ceil(n/e)*e}class Hn extends cn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i){const a=this.length;return this.resize(a+1),this.emplace(a,e,i)}emplace(e,i,a){const c=2*e;return this.int16[c+0]=i,this.int16[c+1]=a,e}}Hn.prototype.bytesPerElement=4,Zt(Hn,"StructArrayLayout2i4");class li extends cn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,a){const c=this.length;return this.resize(c+1),this.emplace(c,e,i,a)}emplace(e,i,a,c){const d=3*e;return this.int16[d+0]=i,this.int16[d+1]=a,this.int16[d+2]=c,e}}li.prototype.bytesPerElement=6,Zt(li,"StructArrayLayout3i6");class ii extends cn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,a,c){const d=this.length;return this.resize(d+1),this.emplace(d,e,i,a,c)}emplace(e,i,a,c,d){const g=4*e;return this.int16[g+0]=i,this.int16[g+1]=a,this.int16[g+2]=c,this.int16[g+3]=d,e}}ii.prototype.bytesPerElement=8,Zt(ii,"StructArrayLayout4i8");class Pr extends cn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,a,c,d,g,y){const b=this.length;return this.resize(b+1),this.emplace(b,e,i,a,c,d,g,y)}emplace(e,i,a,c,d,g,y,b){const E=6*e,A=12*e,P=3*e;return this.int16[E+0]=i,this.int16[E+1]=a,this.uint8[A+4]=c,this.uint8[A+5]=d,this.uint8[A+6]=g,this.uint8[A+7]=y,this.float32[P+2]=b,e}}Pr.prototype.bytesPerElement=12,Zt(Pr,"StructArrayLayout2i4ub1f12");class $r extends cn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,a,c){const d=this.length;return this.resize(d+1),this.emplace(d,e,i,a,c)}emplace(e,i,a,c,d){const g=4*e;return this.float32[g+0]=i,this.float32[g+1]=a,this.float32[g+2]=c,this.float32[g+3]=d,e}}$r.prototype.bytesPerElement=16,Zt($r,"StructArrayLayout4f16");class wr extends cn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,a,c,d){const g=this.length;return this.resize(g+1),this.emplace(g,e,i,a,c,d)}emplace(e,i,a,c,d,g){const y=6*e,b=3*e;return this.uint16[y+0]=i,this.uint16[y+1]=a,this.uint16[y+2]=c,this.uint16[y+3]=d,this.float32[b+2]=g,e}}wr.prototype.bytesPerElement=12,Zt(wr,"StructArrayLayout4ui1f12");class yo extends cn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,a,c){const d=this.length;return this.resize(d+1),this.emplace(d,e,i,a,c)}emplace(e,i,a,c,d){const g=4*e;return this.uint16[g+0]=i,this.uint16[g+1]=a,this.uint16[g+2]=c,this.uint16[g+3]=d,e}}yo.prototype.bytesPerElement=8,Zt(yo,"StructArrayLayout4ui8");class gi extends cn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,a,c,d,g){const y=this.length;return this.resize(y+1),this.emplace(y,e,i,a,c,d,g)}emplace(e,i,a,c,d,g,y){const b=6*e;return this.int16[b+0]=i,this.int16[b+1]=a,this.int16[b+2]=c,this.int16[b+3]=d,this.int16[b+4]=g,this.int16[b+5]=y,e}}gi.prototype.bytesPerElement=12,Zt(gi,"StructArrayLayout6i12");class ci extends cn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,a,c,d,g,y,b,E,A,P,z){const O=this.length;return this.resize(O+1),this.emplace(O,e,i,a,c,d,g,y,b,E,A,P,z)}emplace(e,i,a,c,d,g,y,b,E,A,P,z,O){const F=12*e;return this.int16[F+0]=i,this.int16[F+1]=a,this.int16[F+2]=c,this.int16[F+3]=d,this.uint16[F+4]=g,this.uint16[F+5]=y,this.uint16[F+6]=b,this.uint16[F+7]=E,this.int16[F+8]=A,this.int16[F+9]=P,this.int16[F+10]=z,this.int16[F+11]=O,e}}ci.prototype.bytesPerElement=24,Zt(ci,"StructArrayLayout4i4ui4i24");class Gn extends cn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,a,c,d,g){const y=this.length;return this.resize(y+1),this.emplace(y,e,i,a,c,d,g)}emplace(e,i,a,c,d,g,y){const b=10*e,E=5*e;return this.int16[b+0]=i,this.int16[b+1]=a,this.int16[b+2]=c,this.float32[E+2]=d,this.float32[E+3]=g,this.float32[E+4]=y,e}}Gn.prototype.bytesPerElement=20,Zt(Gn,"StructArrayLayout3i3f20");class Ri extends cn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint32[1*e+0]=i,e}}Ri.prototype.bytesPerElement=4,Zt(Ri,"StructArrayLayout1ul4");class fr extends cn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,a,c,d,g,y,b,E,A,P,z,O){const F=this.length;return this.resize(F+1),this.emplace(F,e,i,a,c,d,g,y,b,E,A,P,z,O)}emplace(e,i,a,c,d,g,y,b,E,A,P,z,O,F){const q=20*e,Z=10*e;return this.int16[q+0]=i,this.int16[q+1]=a,this.int16[q+2]=c,this.int16[q+3]=d,this.int16[q+4]=g,this.float32[Z+3]=y,this.float32[Z+4]=b,this.float32[Z+5]=E,this.float32[Z+6]=A,this.int16[q+14]=P,this.uint32[Z+8]=z,this.uint16[q+18]=O,this.uint16[q+19]=F,e}}fr.prototype.bytesPerElement=40,Zt(fr,"StructArrayLayout5i4f1i1ul2ui40");class di extends cn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,a,c,d,g,y){const b=this.length;return this.resize(b+1),this.emplace(b,e,i,a,c,d,g,y)}emplace(e,i,a,c,d,g,y,b){const E=8*e;return this.int16[E+0]=i,this.int16[E+1]=a,this.int16[E+2]=c,this.int16[E+4]=d,this.int16[E+5]=g,this.int16[E+6]=y,this.int16[E+7]=b,e}}di.prototype.bytesPerElement=16,Zt(di,"StructArrayLayout3i2i2i16");class Er extends cn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,a,c,d){const g=this.length;return this.resize(g+1),this.emplace(g,e,i,a,c,d)}emplace(e,i,a,c,d,g){const y=4*e,b=8*e;return this.float32[y+0]=i,this.float32[y+1]=a,this.float32[y+2]=c,this.int16[b+6]=d,this.int16[b+7]=g,e}}Er.prototype.bytesPerElement=16,Zt(Er,"StructArrayLayout2f1f2i16");class bl extends cn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,a,c){const d=this.length;return this.resize(d+1),this.emplace(d,e,i,a,c)}emplace(e,i,a,c,d){const g=12*e,y=3*e;return this.uint8[g+0]=i,this.uint8[g+1]=a,this.float32[y+1]=c,this.float32[y+2]=d,e}}bl.prototype.bytesPerElement=12,Zt(bl,"StructArrayLayout2ub2f12");class No extends cn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,a){const c=this.length;return this.resize(c+1),this.emplace(c,e,i,a)}emplace(e,i,a,c){const d=3*e;return this.float32[d+0]=i,this.float32[d+1]=a,this.float32[d+2]=c,e}}No.prototype.bytesPerElement=12,Zt(No,"StructArrayLayout3f12");class pr extends cn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,a){const c=this.length;return this.resize(c+1),this.emplace(c,e,i,a)}emplace(e,i,a,c){const d=3*e;return this.uint16[d+0]=i,this.uint16[d+1]=a,this.uint16[d+2]=c,e}}pr.prototype.bytesPerElement=6,Zt(pr,"StructArrayLayout3ui6");class Kr extends cn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,i,a,c,d,g,y,b,E,A,P,z,O,F,q,Z,le,ge,ae,de,be){const _e=this.length;return this.resize(_e+1),this.emplace(_e,e,i,a,c,d,g,y,b,E,A,P,z,O,F,q,Z,le,ge,ae,de,be)}emplace(e,i,a,c,d,g,y,b,E,A,P,z,O,F,q,Z,le,ge,ae,de,be,_e){const $e=30*e,je=15*e,it=60*e;return this.int16[$e+0]=i,this.int16[$e+1]=a,this.int16[$e+2]=c,this.float32[je+2]=d,this.float32[je+3]=g,this.uint16[$e+8]=y,this.uint16[$e+9]=b,this.uint32[je+5]=E,this.uint32[je+6]=A,this.uint32[je+7]=P,this.uint16[$e+16]=z,this.uint16[$e+17]=O,this.uint16[$e+18]=F,this.float32[je+10]=q,this.float32[je+11]=Z,this.uint8[it+48]=le,this.uint8[it+49]=ge,this.uint8[it+50]=ae,this.uint32[je+13]=de,this.int16[$e+28]=be,this.uint8[it+58]=_e,e}}Kr.prototype.bytesPerElement=60,Zt(Kr,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class vo extends cn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,i,a,c,d,g,y,b,E,A,P,z,O,F,q,Z,le,ge,ae,de,be,_e,$e,je,it,St,Ke,ut,dt,vt){const Ct=this.length;return this.resize(Ct+1),this.emplace(Ct,e,i,a,c,d,g,y,b,E,A,P,z,O,F,q,Z,le,ge,ae,de,be,_e,$e,je,it,St,Ke,ut,dt,vt)}emplace(e,i,a,c,d,g,y,b,E,A,P,z,O,F,q,Z,le,ge,ae,de,be,_e,$e,je,it,St,Ke,ut,dt,vt,Ct){const Qe=38*e,Dt=19*e;return this.int16[Qe+0]=i,this.int16[Qe+1]=a,this.int16[Qe+2]=c,this.float32[Dt+2]=d,this.float32[Dt+3]=g,this.int16[Qe+8]=y,this.int16[Qe+9]=b,this.int16[Qe+10]=E,this.int16[Qe+11]=A,this.int16[Qe+12]=P,this.int16[Qe+13]=z,this.uint16[Qe+14]=O,this.uint16[Qe+15]=F,this.uint16[Qe+16]=q,this.uint16[Qe+17]=Z,this.uint16[Qe+18]=le,this.uint16[Qe+19]=ge,this.uint16[Qe+20]=ae,this.uint16[Qe+21]=de,this.uint16[Qe+22]=be,this.uint16[Qe+23]=_e,this.uint16[Qe+24]=$e,this.uint16[Qe+25]=je,this.uint16[Qe+26]=it,this.uint16[Qe+27]=St,this.uint16[Qe+28]=Ke,this.uint32[Dt+15]=ut,this.float32[Dt+16]=dt,this.float32[Dt+17]=vt,this.float32[Dt+18]=Ct,e}}vo.prototype.bytesPerElement=76,Zt(vo,"StructArrayLayout3i2f6i15ui1ul3f76");class xo extends cn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.float32[1*e+0]=i,e}}xo.prototype.bytesPerElement=4,Zt(xo,"StructArrayLayout1f4");class wl extends cn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,a,c,d){const g=this.length;return this.resize(g+1),this.emplace(g,e,i,a,c,d)}emplace(e,i,a,c,d,g){const y=5*e;return this.float32[y+0]=i,this.float32[y+1]=a,this.float32[y+2]=c,this.float32[y+3]=d,this.float32[y+4]=g,e}}wl.prototype.bytesPerElement=20,Zt(wl,"StructArrayLayout5f20");class _a extends cn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,a,c){const d=this.length;return this.resize(d+1),this.emplace(d,e,i,a,c)}emplace(e,i,a,c,d){const g=6*e;return this.uint32[3*e+0]=i,this.uint16[g+2]=a,this.uint16[g+3]=c,this.uint16[g+4]=d,e}}_a.prototype.bytesPerElement=12,Zt(_a,"StructArrayLayout1ul3ui12");class bo extends cn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i){const a=this.length;return this.resize(a+1),this.emplace(a,e,i)}emplace(e,i,a){const c=2*e;return this.uint16[c+0]=i,this.uint16[c+1]=a,e}}bo.prototype.bytesPerElement=4,Zt(bo,"StructArrayLayout2ui4");class Mh extends cn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint16[1*e+0]=i,e}}Mh.prototype.bytesPerElement=2,Zt(Mh,"StructArrayLayout1ui2");class Vf extends cn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i){const a=this.length;return this.resize(a+1),this.emplace(a,e,i)}emplace(e,i,a){const c=2*e;return this.float32[c+0]=i,this.float32[c+1]=a,e}}Vf.prototype.bytesPerElement=8,Zt(Vf,"StructArrayLayout2f8");class jv extends Tn{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}jv.prototype.size=40;class Ag extends fr{get(e){return new jv(this,e)}}Zt(Ag,"CollisionBoxArray");class $v extends Tn{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(e){this._structArray.uint8[this._pos1+49]=e}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(e){this._structArray.uint8[this._pos1+50]=e}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(e){this._structArray.uint32[this._pos4+13]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(e){this._structArray.uint8[this._pos1+58]=e}}$v.prototype.size=60;class Gv extends Kr{get(e){return new $v(this,e)}}Zt(Gv,"PlacedSymbolArray");class Zv extends Tn{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+11]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+13]}get key(){return this._structArray.uint16[this._pos2+14]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+17]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+19]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+21]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+22]}get featureIndex(){return this._structArray.uint16[this._pos2+23]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+25]}get numIconVertices(){return this._structArray.uint16[this._pos2+26]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+27]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+28]}get crossTileID(){return this._structArray.uint32[this._pos4+15]}set crossTileID(e){this._structArray.uint32[this._pos4+15]=e}get textOffset0(){return this._structArray.float32[this._pos4+16]}get textOffset1(){return this._structArray.float32[this._pos4+17]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+18]}}Zv.prototype.size=76;class Hv extends vo{get(e){return new Zv(this,e)}}Zt(Hv,"SymbolInstanceArray");class Wv extends xo{getoffsetX(e){return this.float32[1*e+0]}}Zt(Wv,"GlyphOffsetArray");class Xv extends Hn{getx(e){return this.int16[2*e+0]}gety(e){return this.int16[2*e+1]}}Zt(Xv,"SymbolLineVertexArray");class Kv extends Tn{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}Kv.prototype.size=12;class Yv extends _a{get(e){return new Kv(this,e)}}Zt(Yv,"FeatureIndexArray");class Qv extends bo{geta_centroid_pos0(e){return this.uint16[2*e+0]}geta_centroid_pos1(e){return this.uint16[2*e+1]}}Zt(Qv,"FillExtrusionCentroidArray");const S2=Gt([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),C2=Gt([{name:"a_dash",components:4,type:"Uint16"}]);var Bc={exports:{}},Jv={exports:{}};Jv.exports=function(n,e){var i,a,c,d,g,y,b,E;for(a=n.length-(i=3&n.length),c=e,g=3432918353,y=461845907,E=0;E<a;)b=255&n.charCodeAt(E)|(255&n.charCodeAt(++E))<<8|(255&n.charCodeAt(++E))<<16|(255&n.charCodeAt(++E))<<24,++E,c=27492+(65535&(d=5*(65535&(c=(c^=b=(65535&(b=(b=(65535&b)*g+(((b>>>16)*g&65535)<<16)&4294967295)<<15|b>>>17))*y+(((b>>>16)*y&65535)<<16)&4294967295)<<13|c>>>19))+((5*(c>>>16)&65535)<<16)&4294967295))+((58964+(d>>>16)&65535)<<16);switch(b=0,i){case 3:b^=(255&n.charCodeAt(E+2))<<16;case 2:b^=(255&n.charCodeAt(E+1))<<8;case 1:c^=b=(65535&(b=(b=(65535&(b^=255&n.charCodeAt(E)))*g+(((b>>>16)*g&65535)<<16)&4294967295)<<15|b>>>17))*y+(((b>>>16)*y&65535)<<16)&4294967295}return c^=n.length,c=2246822507*(65535&(c^=c>>>16))+((2246822507*(c>>>16)&65535)<<16)&4294967295,c=3266489909*(65535&(c^=c>>>13))+((3266489909*(c>>>16)&65535)<<16)&4294967295,(c^=c>>>16)>>>0};var e0={exports:{}};e0.exports=function(n,e){for(var i,a=n.length,c=e^a,d=0;a>=4;)i=1540483477*(65535&(i=255&n.charCodeAt(d)|(255&n.charCodeAt(++d))<<8|(255&n.charCodeAt(++d))<<16|(255&n.charCodeAt(++d))<<24))+((1540483477*(i>>>16)&65535)<<16),c=1540483477*(65535&c)+((1540483477*(c>>>16)&65535)<<16)^(i=1540483477*(65535&(i^=i>>>24))+((1540483477*(i>>>16)&65535)<<16)),a-=4,++d;switch(a){case 3:c^=(255&n.charCodeAt(d+2))<<16;case 2:c^=(255&n.charCodeAt(d+1))<<8;case 1:c=1540483477*(65535&(c^=255&n.charCodeAt(d)))+((1540483477*(c>>>16)&65535)<<16)}return c=1540483477*(65535&(c^=c>>>13))+((1540483477*(c>>>16)&65535)<<16),(c^=c>>>15)>>>0};var t0=Jv.exports,A2=e0.exports;Bc.exports=t0,Bc.exports.murmur3=t0,Bc.exports.murmur2=A2;class Uf{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(e,i,a,c){this.ids.push(n0(e)),this.positions.push(i,a,c)}getPositions(e){const i=n0(e);let a=0,c=this.ids.length-1;for(;a<c;){const g=a+c>>1;this.ids[g]>=i?c=g:a=g+1}const d=[];for(;this.ids[a]===i;)d.push({index:this.positions[3*a],start:this.positions[3*a+1],end:this.positions[3*a+2]}),a++;return d}static serialize(e,i){const a=new Float64Array(e.ids),c=new Uint32Array(e.positions);return Mg(a,c,0,a.length-1),i&&i.push(a.buffer,c.buffer),{ids:a,positions:c}}static deserialize(e){const i=new Uf;return i.ids=e.ids,i.positions=e.positions,i.indexed=!0,i}}function n0(n){const e=+n;return!isNaN(e)&&Number.MIN_SAFE_INTEGER<=e&&e<=Number.MAX_SAFE_INTEGER?e:Bc.exports(String(n))}function Mg(n,e,i,a){for(;i<a;){const c=n[i+a>>1];let d=i-1,g=a+1;for(;;){do d++;while(n[d]<c);do g--;while(n[g]>c);if(d>=g)break;qf(n,d,g),qf(e,3*d,3*g),qf(e,3*d+1,3*g+1),qf(e,3*d+2,3*g+2)}g-i<a-g?(Mg(n,e,i,g),i=g+1):(Mg(n,e,g+1,a),a=g)}}function qf(n,e,i){const a=n[e];n[e]=n[i],n[i]=a}Zt(Uf,"FeaturePositionMap");class zs{constructor(e){this.gl=e.gl,this.initialized=!1}fetchUniformLocation(e,i){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(e,i),this.initialized=!0),!!this.location}}class jf extends zs{constructor(e){super(e),this.current=0}set(e,i,a){this.fetchUniformLocation(e,i)&&this.current!==a&&(this.current=a,this.gl.uniform1f(this.location,a))}}class i0 extends zs{constructor(e){super(e),this.current=[0,0,0,0]}set(e,i,a){this.fetchUniformLocation(e,i)&&(a[0]===this.current[0]&&a[1]===this.current[1]&&a[2]===this.current[2]&&a[3]===this.current[3]||(this.current=a,this.gl.uniform4f(this.location,a[0],a[1],a[2],a[3])))}}class r0 extends zs{constructor(e){super(e),this.current=ki.transparent}set(e,i,a){this.fetchUniformLocation(e,i)&&(a.r===this.current.r&&a.g===this.current.g&&a.b===this.current.b&&a.a===this.current.a||(this.current=a,this.gl.uniform4f(this.location,a.r,a.g,a.b,a.a)))}}const M2=new Float32Array(16),I2=new Float32Array(9),k2=new Float32Array(4);function Ig(n){return[Jt(255*n.r,255*n.g),Jt(255*n.b,255*n.a)]}class Ih{constructor(e,i,a){this.value=e,this.uniformNames=i.map(c=>`u_${c}`),this.type=a}setUniform(e,i,a,c,d){i.set(e,d,c.constantOr(this.value))}getBinding(e,i){return this.type==="color"?new r0(e):new jf(e)}}class Fc{constructor(e,i){this.uniformNames=i.map(a=>`u_${a}`),this.pattern=null,this.pixelRatio=1}setConstantPatternPositions(e){this.pixelRatio=e.pixelRatio||1,this.pattern=e.tl.concat(e.br)}setUniform(e,i,a,c,d){const g=d==="u_pattern"||d==="u_dash"?this.pattern:d==="u_pixel_ratio"?this.pixelRatio:null;g&&i.set(e,d,g)}getBinding(e,i){return i==="u_pattern"||i==="u_dash"?new i0(e):new jf(e)}}class Ls{constructor(e,i,a,c){this.expression=e,this.type=a,this.maxValue=0,this.paintVertexAttributes=i.map(d=>({name:`a_${d}`,type:"Float32",components:a==="color"?2:1,offset:0})),this.paintVertexArray=new c}populatePaintArray(e,i,a,c,d,g){const y=this.paintVertexArray.length,b=this.expression.evaluate(new Le(0),i,{},d,c,g);this.paintVertexArray.resize(e),this._setPaintValue(y,e,b)}updatePaintArray(e,i,a,c,d){const g=this.expression.evaluate({zoom:0},a,c,void 0,d);this._setPaintValue(e,i,g)}_setPaintValue(e,i,a){if(this.type==="color"){const c=Ig(a);for(let d=e;d<i;d++)this.paintVertexArray.emplace(d,c[0],c[1])}else{for(let c=e;c<i;c++)this.paintVertexArray.emplace(c,a);this.maxValue=Math.max(this.maxValue,Math.abs(a))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Vo{constructor(e,i,a,c,d,g){this.expression=e,this.uniformNames=i.map(y=>`u_${y}_t`),this.type=a,this.useIntegerZoom=c,this.zoom=d,this.maxValue=0,this.paintVertexAttributes=i.map(y=>({name:`a_${y}`,type:"Float32",components:a==="color"?4:2,offset:0})),this.paintVertexArray=new g}populatePaintArray(e,i,a,c,d,g){const y=this.expression.evaluate(new Le(this.zoom),i,{},d,c,g),b=this.expression.evaluate(new Le(this.zoom+1),i,{},d,c,g),E=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(E,e,y,b)}updatePaintArray(e,i,a,c,d){const g=this.expression.evaluate({zoom:this.zoom},a,c,void 0,d),y=this.expression.evaluate({zoom:this.zoom+1},a,c,void 0,d);this._setPaintValue(e,i,g,y)}_setPaintValue(e,i,a,c){if(this.type==="color"){const d=Ig(a),g=Ig(c);for(let y=e;y<i;y++)this.paintVertexArray.emplace(y,d[0],d[1],g[0],g[1])}else{for(let d=e;d<i;d++)this.paintVertexArray.emplace(d,a,c);this.maxValue=Math.max(this.maxValue,Math.abs(a),Math.abs(c))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,i,a,c,d){const g=this.useIntegerZoom?Math.floor(a.zoom):a.zoom,y=lt(this.expression.interpolationFactor(g,this.zoom,this.zoom+1),0,1);i.set(e,d,y)}getBinding(e,i){return new jf(e)}}class ya{constructor(e,i,a,c,d){this.expression=e,this.layerId=d,this.paintVertexAttributes=(a==="array"?C2:S2).members;for(let g=0;g<i.length;++g);this.paintVertexArray=new c}populatePaintArray(e,i,a){const c=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValues(c,e,i.patterns&&i.patterns[this.layerId],a)}updatePaintArray(e,i,a,c,d,g){this._setPaintValues(e,i,a.patterns&&a.patterns[this.layerId],g)}_setPaintValues(e,i,a,c){if(!c||!a)return;const d=c[a];if(!d)return;const{tl:g,br:y,pixelRatio:b}=d;for(let E=e;E<i;E++)this.paintVertexArray.emplace(E,g[0],g[1],y[0],y[1],b)}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class va{constructor(e,i,a=()=>!0){this.binders={},this._buffers=[];const c=[];for(const d in e.paint._values){if(!a(d))continue;const g=e.paint.get(d);if(!(g instanceof pt&&Is(g.property.specification)))continue;const y=z2(d,e.type),b=g.value,E=g.property.specification.type,A=g.property.useIntegerZoom,P=d==="line-dasharray"||d.endsWith("pattern"),z=d==="line-dasharray"&&e.layout.get("line-cap").value.kind!=="constant";if(b.kind!=="constant"||z)if(b.kind==="source"||z||P){const O=o0(d,E,"source");this.binders[d]=P?new ya(b,y,E,O,e.id):new Ls(b,y,E,O),c.push(`/a_${d}`)}else{const O=o0(d,E,"composite");this.binders[d]=new Vo(b,y,E,A,i,O),c.push(`/z_${d}`)}else this.binders[d]=P?new Fc(b.value,y):new Ih(b.value,y,E),c.push(`/u_${d}`)}this.cacheKey=c.sort().join("")}getMaxValue(e){const i=this.binders[e];return i instanceof Ls||i instanceof Vo?i.maxValue:0}populatePaintArrays(e,i,a,c,d,g){for(const y in this.binders){const b=this.binders[y];(b instanceof Ls||b instanceof Vo||b instanceof ya)&&b.populatePaintArray(e,i,a,c,d,g)}}setConstantPatternPositions(e){for(const i in this.binders){const a=this.binders[i];a instanceof Fc&&a.setConstantPatternPositions(e)}}updatePaintArrays(e,i,a,c,d,g){let y=!1;for(const b in e){const E=i.getPositions(b);for(const A of E){const P=a.feature(A.index);for(const z in this.binders){const O=this.binders[z];if((O instanceof Ls||O instanceof Vo||O instanceof ya)&&O.expression.isStateDependent===!0){const F=c.paint.get(z);O.expression=F.value,O.updatePaintArray(A.start,A.end,P,e[b],d,g),y=!0}}}}return y}defines(){const e=[];for(const i in this.binders){const a=this.binders[i];(a instanceof Ih||a instanceof Fc)&&e.push(...a.uniformNames.map(c=>`#define HAS_UNIFORM_${c}`))}return e}getBinderAttributes(){const e=[];for(const i in this.binders){const a=this.binders[i];if(a instanceof Ls||a instanceof Vo||a instanceof ya)for(let c=0;c<a.paintVertexAttributes.length;c++)e.push(a.paintVertexAttributes[c].name)}return e}getBinderUniforms(){const e=[];for(const i in this.binders){const a=this.binders[i];if(a instanceof Ih||a instanceof Fc||a instanceof Vo)for(const c of a.uniformNames)e.push(c)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e){const i=[];for(const a in this.binders){const c=this.binders[a];if(c instanceof Ih||c instanceof Fc||c instanceof Vo)for(const d of c.uniformNames)i.push({name:d,property:a,binding:c.getBinding(e,d)})}return i}setUniforms(e,i,a,c,d){for(const{name:g,property:y,binding:b}of a)this.binders[y].setUniform(e,b,d,c.get(y),g)}updatePaintBuffers(){this._buffers=[];for(const e in this.binders){const i=this.binders[e];(i instanceof Ls||i instanceof Vo||i instanceof ya)&&i.paintVertexBuffer&&this._buffers.push(i.paintVertexBuffer)}}upload(e){for(const i in this.binders){const a=this.binders[i];(a instanceof Ls||a instanceof Vo||a instanceof ya)&&a.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const i=this.binders[e];(i instanceof Ls||i instanceof Vo||i instanceof ya)&&i.destroy()}}}class El{constructor(e,i,a=()=>!0){this.programConfigurations={};for(const c of e)this.programConfigurations[c.id]=new va(c,i,a);this.needsUpload=!1,this._featureMap=new Uf,this._bufferOffset=0}populatePaintArrays(e,i,a,c,d,g,y){for(const b in this.programConfigurations)this.programConfigurations[b].populatePaintArrays(e,i,c,d,g,y);i.id!==void 0&&this._featureMap.add(i.id,a,this._bufferOffset,e),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,i,a,c,d){for(const g of a)this.needsUpload=this.programConfigurations[g.id].updatePaintArrays(e,this._featureMap,i,g,c,d)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const i in this.programConfigurations)this.programConfigurations[i].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}const P2={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]};function z2(n,e){return P2[n]||[n.replace(`${e}-`,"").replace(/-/g,"_")]}const L2={"line-pattern":{source:wr,composite:wr},"fill-pattern":{source:wr,composite:wr},"fill-extrusion-pattern":{source:wr,composite:wr},"line-dasharray":{source:yo,composite:yo}},R2={color:{source:Vf,composite:$r},number:{source:xo,composite:Vf}};function o0(n,e,i){const a=L2[n];return a&&a[i]||R2[e][i]}Zt(Ih,"ConstantBinder"),Zt(Fc,"PatternConstantBinder"),Zt(Ls,"SourceExpressionBinder"),Zt(ya,"PatternCompositeBinder"),Zt(Vo,"CompositeExpressionBinder"),Zt(va,"ProgramConfiguration",{omit:["_buffers"]}),Zt(El,"ProgramConfigurationSet");const $f="-transition";class Uo extends mi{constructor(e,i){if(super(),this.id=e.id,this.type=e.type,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,e.type!=="custom"&&(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type!=="background"&&e.type!=="sky"&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),i.layout&&(this._unevaluatedLayout=new Je(i.layout)),i.paint)){this._transitionablePaint=new st(i.paint);for(const a in e.paint)this.setPaintProperty(a,e.paint[a],{validate:!1});for(const a in e.layout)this.setLayoutProperty(a,e.layout[a],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Pt(i.paint)}}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,i,a={}){i!=null&&this._validate(Cg,`layers.${this.id}.layout.${e}`,e,i,a)||(e!=="visibility"?this._unevaluatedLayout.setValue(e,i):this.visibility=i)}getPaintProperty(e){return ot(e,$f)?this._transitionablePaint.getTransition(e.slice(0,-$f.length)):this._transitionablePaint.getValue(e)}setPaintProperty(e,i,a={}){if(i!=null&&this._validate(Sg,`layers.${this.id}.paint.${e}`,e,i,a))return!1;if(ot(e,$f))return this._transitionablePaint.setTransition(e.slice(0,-$f.length),i||void 0),!1;{const c=this._transitionablePaint._values[e],d=c.value.isDataDriven(),g=c.value;this._transitionablePaint.setValue(e,i),this._handleSpecialPaintPropertyUpdate(e);const y=this._transitionablePaint._values[e].value,b=y.isDataDriven(),E=ot(e,"pattern")||e==="line-dasharray";return b||d||E||this._handleOverridablePaintPropertyUpdate(e,g,y)}}_handleSpecialPaintPropertyUpdate(e){}getProgramIds(){return null}getProgramConfiguration(e){return null}_handleOverridablePaintPropertyUpdate(e,i,a){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||this.visibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,i){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,i)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,i)}serialize(){const e={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(e.layout=e.layout||{},e.layout.visibility=this.visibility),ft(e,(i,a)=>!(i===void 0||a==="layout"&&!Object.keys(i).length||a==="paint"&&!Object.keys(i).length))}_validate(e,i,a,c,d={}){return(!d||d.validate!==!1)&&Mf(this,e.call(vh,{key:i,layerType:this.type,objectKey:a,value:c,styleSpec:tt,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const e in this.paint._values){const i=this.paint.get(e);if(i instanceof pt&&Is(i.property.specification)&&(i.value.kind==="source"||i.value.kind==="composite")&&i.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=Ps(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}}const D2=Gt([{name:"a_pos",components:2,type:"Int16"}],4),O2=Gt([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class Hi{constructor(e=[]){this.segments=e}prepareSegment(e,i,a,c){let d=this.segments[this.segments.length-1];return e>Hi.MAX_VERTEX_ARRAY_LENGTH&&re(`Max vertices per segment is ${Hi.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!d||d.vertexLength+e>Hi.MAX_VERTEX_ARRAY_LENGTH||d.sortKey!==c)&&(d={vertexOffset:i.length,primitiveOffset:a.length,vertexLength:0,primitiveLength:0},c!==void 0&&(d.sortKey=c),this.segments.push(d)),d}get(){return this.segments}destroy(){for(const e of this.segments)for(const i in e.vaos)e.vaos[i].destroy()}static simpleSegment(e,i,a,c){return new Hi([{vertexOffset:e,primitiveOffset:i,vertexLength:a,primitiveLength:c,vaos:{},sortKey:0}])}}Hi.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Zt(Hi,"SegmentVector");var _n=8192;class xa{constructor(e,i){e&&(i?this.setSouthWest(e).setNorthEast(i):e.length===4?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1]))}setNorthEast(e){return this._ne=e instanceof qn?new qn(e.lng,e.lat):qn.convert(e),this}setSouthWest(e){return this._sw=e instanceof qn?new qn(e.lng,e.lat):qn.convert(e),this}extend(e){const i=this._sw,a=this._ne;let c,d;if(e instanceof qn)c=e,d=e;else{if(!(e instanceof xa))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(xa.convert(e)):this.extend(qn.convert(e)):typeof e=="object"&&e!==null&&e.hasOwnProperty("lat")&&e.hasOwnProperty("lon")?this.extend(qn.convert(e)):this;if(c=e._sw,d=e._ne,!c||!d)return this}return i||a?(i.lng=Math.min(c.lng,i.lng),i.lat=Math.min(c.lat,i.lat),a.lng=Math.max(d.lng,a.lng),a.lat=Math.max(d.lat,a.lat)):(this._sw=new qn(c.lng,c.lat),this._ne=new qn(d.lng,d.lat)),this}getCenter(){return new qn((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new qn(this.getWest(),this.getNorth())}getSouthEast(){return new qn(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:i,lat:a}=qn.convert(e);let c=this._sw.lng<=i&&i<=this._ne.lng;return this._sw.lng>this._ne.lng&&(c=this._sw.lng>=i&&i>=this._ne.lng),this._sw.lat<=a&&a<=this._ne.lat&&c}static convert(e){return!e||e instanceof xa?e:new xa(e)}}const Gf=63710088e-1;class qn{constructor(e,i){if(isNaN(e)||isNaN(i))throw new Error(`Invalid LngLat object: (${e}, ${i})`);if(this.lng=+e,this.lat=+i,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new qn(Ge(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const i=Math.PI/180,a=this.lat*i,c=e.lat*i,d=Math.sin(a)*Math.sin(c)+Math.cos(a)*Math.cos(c)*Math.cos((e.lng-this.lng)*i);return Gf*Math.acos(Math.min(d,1))}toBounds(e=0){const i=360*e/40075017,a=i/Math.cos(Math.PI/180*this.lat);return new xa(new qn(this.lng-a,this.lat-i),new qn(this.lng+a,this.lat+i))}static convert(e){if(e instanceof qn)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new qn(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new qn(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const s0=2*Math.PI*Gf;function kg(n){return s0*Math.cos(n*Math.PI/180)}function ss(n){return(180+n)/360}function as(n){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+n*Math.PI/360)))/360}function wo(n,e){return n/kg(e)}function lo(n){return 360*n-180}function mr(n){return 360/Math.PI*Math.atan(Math.exp((180-360*n)*Math.PI/180))-90}function a0(n,e){return n*kg(mr(e))}const ls=85.051129;function l0(n){return 1/Math.cos(n*Math.PI/180)}class Nc{constructor(e,i,a=0){this.x=+e,this.y=+i,this.z=+a}static fromLngLat(e,i=0){const a=qn.convert(e);return new Nc(ss(a.lng),as(a.lat),wo(i,a.lat))}toLngLat(){return new qn(lo(this.x),mr(this.y))}toAltitude(){return a0(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/s0*l0(mr(this.y))}}function Pg(n,e,i,a,c,d,g,y,b){const E=(e+a)/2,A=(i+c)/2,P=new ce(E,A);y(P),function(z,O,F,q,Z,le){const ge=F-Z,ae=q-le;return Math.abs((q-O)*ge-(F-z)*ae)/Math.hypot(ge,ae)}(P.x,P.y,d.x,d.y,g.x,g.y)>=b?(Pg(n,e,i,E,A,d,P,y,b),Pg(n,E,A,a,c,P,g,y,b)):n.push(g)}function c0(n,e,i){let a=n[0],c=a.x,d=a.y;e(a);const g=[a];for(let y=1;y<n.length;y++){const b=n[y],{x:E,y:A}=b;e(b),Pg(g,c,d,E,A,a,b,e,i),c=E,d=A,a=b}return g}function zg(n,e,i,a){if(a(e,i)){const c=e.add(i)._mult(.5);zg(n,e,c,a),zg(n,c,i,a)}else n.push(i)}function B2(n,e){let i=n[0];const a=[i];for(let c=1;c<n.length;c++){const d=n[c];zg(a,i,d,e),i=d}return a}const Lg=Math.pow(2,14)-1,u0=-Lg-1;function F2(n,e){const i=Math.round(n.x*e),a=Math.round(n.y*e);return n.x=lt(i,u0,Lg),n.y=lt(a,u0,Lg),(i<n.x||i>n.x+1||a<n.y||a>n.y+1)&&re("Geometry exceeds allowed extent, reduce your vector tile buffer size"),n}function Rs(n,e,i){const a=n.loadGeometry(),c=n.extent,d=_n/c;if(e&&i&&i.projection.isReprojectedInTileSpace){const g=1<<e.z,{scale:y,x:b,y:E,projection:A}=i,P=z=>{const O=lo((e.x+z.x/c)/g),F=mr((e.y+z.y/c)/g),q=A.project(O,F);z.x=(q.x*y-b)*c,z.y=(q.y*y-E)*c};for(let z=0;z<a.length;z++)if(n.type!==1)a[z]=c0(a[z],P,1);else{const O=[];for(const F of a[z])F.x<0||F.x>=c||F.y<0||F.y>=c||(P(F),O.push(F));a[z]=O}}for(const g of a)for(const y of g)F2(y,d);return a}function Tl(n,e){return{type:n.type,id:n.id,properties:n.properties,geometry:e?Rs(n):[]}}function Zf(n,e,i,a,c){n.emplaceBack(2*e+(a+1)/2,2*i+(c+1)/2)}function Hf(n,e,i){n.emplaceBack(e.x,e.y,e.z,i[0]*16384,i[1]*16384,i[2]*16384)}class Rg{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.id),this.index=e.index,this.hasPattern=!1,this.projection=e.projection,this.layoutVertexArray=new Hn,this.indexArray=new pr,this.segments=new Hi,this.programConfigurations=new El(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id)}populate(e,i,a,c){const d=this.layers[0],g=[];let y=null;d.type==="circle"&&(y=d.layout.get("circle-sort-key"));for(const{feature:E,id:A,index:P,sourceLayerIndex:z}of e){const O=this.layers[0]._featureFilter.needGeometry,F=Tl(E,O);if(!this.layers[0]._featureFilter.filter(new Le(this.zoom),F,a))continue;const q=y?y.evaluate(F,{},a):void 0,Z={id:A,properties:E.properties,type:E.type,sourceLayerIndex:z,index:P,geometry:O?F.geometry:Rs(E,a,c),patterns:{},sortKey:q};g.push(Z)}y&&g.sort((E,A)=>E.sortKey-A.sortKey);let b=null;c.projection.name==="globe"&&(this.globeExtVertexArray=new gi,b=c.projection);for(const E of g){const{geometry:A,index:P,sourceLayerIndex:z}=E,O=e[P].feature;this.addFeature(E,A,P,i.availableImages,a,b),i.featureIndex.insert(O,A,P,z,this.index)}}update(e,i,a,c){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,i,this.stateDependentLayers,a,c)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,D2.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,O2.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(e,i,a,c,d,g){for(const y of i)for(const b of y){const E=b.x,A=b.y;if(E<0||E>=_n||A<0||A>=_n)continue;if(g){const O=g.projectTilePoint(E,A,d),F=g.upVector(d,E,A),q=this.globeExtVertexArray;Hf(q,O,F),Hf(q,O,F),Hf(q,O,F),Hf(q,O,F)}const P=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),z=P.vertexLength;Zf(this.layoutVertexArray,E,A,-1,-1),Zf(this.layoutVertexArray,E,A,1,-1),Zf(this.layoutVertexArray,E,A,1,1),Zf(this.layoutVertexArray,E,A,-1,1),this.indexArray.emplaceBack(z,z+1,z+2),this.indexArray.emplaceBack(z,z+2,z+3),P.vertexLength+=4,P.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,a,{},c,d)}}function h0(n,e){for(let i=0;i<n.length;i++)if(Sl(e,n[i]))return!0;for(let i=0;i<e.length;i++)if(Sl(n,e[i]))return!0;return!!Dg(n,e)}function N2(n,e,i){return!!Sl(n,e)||!!Og(e,n,i)}function d0(n,e){if(n.length===1)return p0(e,n[0]);for(let i=0;i<e.length;i++){const a=e[i];for(let c=0;c<a.length;c++)if(Sl(n,a[c]))return!0}for(let i=0;i<n.length;i++)if(p0(e,n[i]))return!0;for(let i=0;i<e.length;i++)if(Dg(n,e[i]))return!0;return!1}function V2(n,e,i){if(n.length>1){if(Dg(n,e))return!0;for(let a=0;a<e.length;a++)if(Og(e[a],n,i))return!0}for(let a=0;a<n.length;a++)if(Og(n[a],e,i))return!0;return!1}function Dg(n,e){if(n.length===0||e.length===0)return!1;for(let i=0;i<n.length-1;i++){const a=n[i],c=n[i+1];for(let d=0;d<e.length-1;d++)if(U2(a,c,e[d],e[d+1]))return!0}return!1}function U2(n,e,i,a){return xe(n,i,a)!==xe(e,i,a)&&xe(n,e,i)!==xe(n,e,a)}function Og(n,e,i){const a=i*i;if(e.length===1)return n.distSqr(e[0])<a;for(let c=1;c<e.length;c++)if(f0(n,e[c-1],e[c])<a)return!0;return!1}function f0(n,e,i){const a=e.distSqr(i);if(a===0)return n.distSqr(e);const c=((n.x-e.x)*(i.x-e.x)+(n.y-e.y)*(i.y-e.y))/a;return n.distSqr(c<0?e:c>1?i:i.sub(e)._mult(c)._add(e))}function p0(n,e){let i,a,c,d=!1;for(let g=0;g<n.length;g++){i=n[g];for(let y=0,b=i.length-1;y<i.length;b=y++)a=i[y],c=i[b],a.y>e.y!=c.y>e.y&&e.x<(c.x-a.x)*(e.y-a.y)/(c.y-a.y)+a.x&&(d=!d)}return d}function Sl(n,e){let i=!1;for(let a=0,c=n.length-1;a<n.length;c=a++){const d=n[a],g=n[c];d.y>e.y!=g.y>e.y&&e.x<(g.x-d.x)*(e.y-d.y)/(g.y-d.y)+d.x&&(i=!i)}return i}function m0(n,e,i,a,c){for(const g of n)if(e<=g.x&&i<=g.y&&a>=g.x&&c>=g.y)return!0;const d=[new ce(e,i),new ce(e,c),new ce(a,c),new ce(a,i)];if(n.length>2){for(const g of d)if(Sl(n,g))return!0}for(let g=0;g<n.length-1;g++)if(q2(n[g],n[g+1],d))return!0;return!1}function q2(n,e,i){const a=i[0],c=i[2];if(n.x<a.x&&e.x<a.x||n.x>c.x&&e.x>c.x||n.y<a.y&&e.y<a.y||n.y>c.y&&e.y>c.y)return!1;const d=xe(n,e,i[0]);return d!==xe(n,e,i[1])||d!==xe(n,e,i[2])||d!==xe(n,e,i[3])}function Vc(n,e,i){const a=e.paint.get(n).value;return a.kind==="constant"?a.value:i.programConfigurations.get(e.id).getMaxValue(n)}function Wf(n){return Math.sqrt(n[0]*n[0]+n[1]*n[1])}function g0(n,e,i,a,c){if(!e[0]&&!e[1])return n;const d=ce.convert(e)._mult(c);i==="viewport"&&d._rotate(-a);const g=[];for(let y=0;y<n.length;y++)g.push(n[y].sub(d));return g}function _0(n,e,i,a){const c=ce.convert(n)._mult(a);return e==="viewport"&&c._rotate(-i),c}Zt(Rg,"CircleBucket",{omit:["layers"]});const j2=new ln({"circle-sort-key":new We(tt.layout_circle["circle-sort-key"])});var $2={paint:new ln({"circle-radius":new We(tt.paint_circle["circle-radius"]),"circle-color":new We(tt.paint_circle["circle-color"]),"circle-blur":new We(tt.paint_circle["circle-blur"]),"circle-opacity":new We(tt.paint_circle["circle-opacity"]),"circle-translate":new De(tt.paint_circle["circle-translate"]),"circle-translate-anchor":new De(tt.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new De(tt.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new De(tt.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new We(tt.paint_circle["circle-stroke-width"]),"circle-stroke-color":new We(tt.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new We(tt.paint_circle["circle-stroke-opacity"])}),layout:j2},Xf=1e-6,Yr=typeof Float32Array<"u"?Float32Array:Array;function y0(){var n=new Yr(9);return Yr!=Float32Array&&(n[1]=0,n[2]=0,n[3]=0,n[5]=0,n[6]=0,n[7]=0),n[0]=1,n[4]=1,n[8]=1,n}function v0(n,e,i){var a=e[0],c=e[1],d=e[2],g=e[3],y=e[4],b=e[5],E=e[6],A=e[7],P=e[8],z=i[0],O=i[1],F=i[2],q=i[3],Z=i[4],le=i[5],ge=i[6],ae=i[7],de=i[8];return n[0]=z*a+O*g+F*E,n[1]=z*c+O*y+F*A,n[2]=z*d+O*b+F*P,n[3]=q*a+Z*g+le*E,n[4]=q*c+Z*y+le*A,n[5]=q*d+Z*b+le*P,n[6]=ge*a+ae*g+de*E,n[7]=ge*c+ae*y+de*A,n[8]=ge*d+ae*b+de*P,n}function qo(n){return n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function Bg(n,e){var i=e[0],a=e[1],c=e[2],d=e[3],g=e[4],y=e[5],b=e[6],E=e[7],A=e[8],P=e[9],z=e[10],O=e[11],F=e[12],q=e[13],Z=e[14],le=e[15],ge=i*y-a*g,ae=i*b-c*g,de=i*E-d*g,be=a*b-c*y,_e=a*E-d*y,$e=c*E-d*b,je=A*q-P*F,it=A*Z-z*F,St=A*le-O*F,Ke=P*Z-z*q,ut=P*le-O*q,dt=z*le-O*Z,vt=ge*dt-ae*ut+de*Ke+be*St-_e*it+$e*je;return vt?(n[0]=(y*dt-b*ut+E*Ke)*(vt=1/vt),n[1]=(c*ut-a*dt-d*Ke)*vt,n[2]=(q*$e-Z*_e+le*be)*vt,n[3]=(z*_e-P*$e-O*be)*vt,n[4]=(b*St-g*dt-E*it)*vt,n[5]=(i*dt-c*St+d*it)*vt,n[6]=(Z*de-F*$e-le*ae)*vt,n[7]=(A*$e-z*de+O*ae)*vt,n[8]=(g*ut-y*St+E*je)*vt,n[9]=(a*St-i*ut-d*je)*vt,n[10]=(F*_e-q*de+le*ge)*vt,n[11]=(P*de-A*_e-O*ge)*vt,n[12]=(y*it-g*Ke-b*je)*vt,n[13]=(i*Ke-a*it+c*je)*vt,n[14]=(q*ae-F*be-Z*ge)*vt,n[15]=(A*be-P*ae+z*ge)*vt,n):null}function Cl(n,e,i){var a=e[0],c=e[1],d=e[2],g=e[3],y=e[4],b=e[5],E=e[6],A=e[7],P=e[8],z=e[9],O=e[10],F=e[11],q=e[12],Z=e[13],le=e[14],ge=e[15],ae=i[0],de=i[1],be=i[2],_e=i[3];return n[0]=ae*a+de*y+be*P+_e*q,n[1]=ae*c+de*b+be*z+_e*Z,n[2]=ae*d+de*E+be*O+_e*le,n[3]=ae*g+de*A+be*F+_e*ge,n[4]=(ae=i[4])*a+(de=i[5])*y+(be=i[6])*P+(_e=i[7])*q,n[5]=ae*c+de*b+be*z+_e*Z,n[6]=ae*d+de*E+be*O+_e*le,n[7]=ae*g+de*A+be*F+_e*ge,n[8]=(ae=i[8])*a+(de=i[9])*y+(be=i[10])*P+(_e=i[11])*q,n[9]=ae*c+de*b+be*z+_e*Z,n[10]=ae*d+de*E+be*O+_e*le,n[11]=ae*g+de*A+be*F+_e*ge,n[12]=(ae=i[12])*a+(de=i[13])*y+(be=i[14])*P+(_e=i[15])*q,n[13]=ae*c+de*b+be*z+_e*Z,n[14]=ae*d+de*E+be*O+_e*le,n[15]=ae*g+de*A+be*F+_e*ge,n}function kh(n,e,i){var a,c,d,g,y,b,E,A,P,z,O,F,q=i[0],Z=i[1],le=i[2];return e===n?(n[12]=e[0]*q+e[4]*Z+e[8]*le+e[12],n[13]=e[1]*q+e[5]*Z+e[9]*le+e[13],n[14]=e[2]*q+e[6]*Z+e[10]*le+e[14],n[15]=e[3]*q+e[7]*Z+e[11]*le+e[15]):(c=e[1],d=e[2],g=e[3],y=e[4],b=e[5],E=e[6],A=e[7],P=e[8],z=e[9],O=e[10],F=e[11],n[0]=a=e[0],n[1]=c,n[2]=d,n[3]=g,n[4]=y,n[5]=b,n[6]=E,n[7]=A,n[8]=P,n[9]=z,n[10]=O,n[11]=F,n[12]=a*q+y*Z+P*le+e[12],n[13]=c*q+b*Z+z*le+e[13],n[14]=d*q+E*Z+O*le+e[14],n[15]=g*q+A*Z+F*le+e[15]),n}function Al(n,e,i){var a=i[0],c=i[1],d=i[2];return n[0]=e[0]*a,n[1]=e[1]*a,n[2]=e[2]*a,n[3]=e[3]*a,n[4]=e[4]*c,n[5]=e[5]*c,n[6]=e[6]*c,n[7]=e[7]*c,n[8]=e[8]*d,n[9]=e[9]*d,n[10]=e[10]*d,n[11]=e[11]*d,n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15],n}function Fg(n,e,i){var a=Math.sin(i),c=Math.cos(i),d=e[4],g=e[5],y=e[6],b=e[7],E=e[8],A=e[9],P=e[10],z=e[11];return e!==n&&(n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[3],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n[4]=d*c+E*a,n[5]=g*c+A*a,n[6]=y*c+P*a,n[7]=b*c+z*a,n[8]=E*c-d*a,n[9]=A*c-g*a,n[10]=P*c-y*a,n[11]=z*c-b*a,n}function Kf(n,e,i){var a=Math.sin(i),c=Math.cos(i),d=e[0],g=e[1],y=e[2],b=e[3],E=e[8],A=e[9],P=e[10],z=e[11];return e!==n&&(n[4]=e[4],n[5]=e[5],n[6]=e[6],n[7]=e[7],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n[0]=d*c-E*a,n[1]=g*c-A*a,n[2]=y*c-P*a,n[3]=b*c-z*a,n[8]=d*a+E*c,n[9]=g*a+A*c,n[10]=y*a+P*c,n[11]=b*a+z*c,n}function x0(n,e){return n[0]=e[0],n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=e[1],n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=e[2],n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function b0(n,e,i){var a,c,d,g=i[0],y=i[1],b=i[2],E=Math.hypot(g,y,b);return E<Xf?null:(g*=E=1/E,y*=E,b*=E,a=Math.sin(e),c=Math.cos(e),n[0]=g*g*(d=1-c)+c,n[1]=y*g*d+b*a,n[2]=b*g*d-y*a,n[3]=0,n[4]=g*y*d-b*a,n[5]=y*y*d+c,n[6]=b*y*d+g*a,n[7]=0,n[8]=g*b*d+y*a,n[9]=y*b*d-g*a,n[10]=b*b*d+c,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n)}Math.hypot||(Math.hypot=function(){for(var n=0,e=arguments.length;e--;)n+=arguments[e]*arguments[e];return Math.sqrt(n)});var G2=Cl;function Ng(){var n=new Yr(3);return Yr!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0),n}function w0(n){var e=new Yr(3);return e[0]=n[0],e[1]=n[1],e[2]=n[2],e}function Ph(n){return Math.hypot(n[0],n[1],n[2])}function Uc(n,e,i){var a=new Yr(3);return a[0]=n,a[1]=e,a[2]=i,a}function Ds(n,e,i){return n[0]=e[0]+i[0],n[1]=e[1]+i[1],n[2]=e[2]+i[2],n}function Vg(n,e,i){return n[0]=e[0]-i[0],n[1]=e[1]-i[1],n[2]=e[2]-i[2],n}function E0(n,e,i){return n[0]=e[0]*i[0],n[1]=e[1]*i[1],n[2]=e[2]*i[2],n}function zh(n,e,i){return n[0]=Math.min(e[0],i[0]),n[1]=Math.min(e[1],i[1]),n[2]=Math.min(e[2],i[2]),n}function Lh(n,e,i){return n[0]=Math.max(e[0],i[0]),n[1]=Math.max(e[1],i[1]),n[2]=Math.max(e[2],i[2]),n}function co(n,e,i){return n[0]=e[0]*i,n[1]=e[1]*i,n[2]=e[2]*i,n}function Rh(n,e,i,a){return n[0]=e[0]+i[0]*a,n[1]=e[1]+i[1]*a,n[2]=e[2]+i[2]*a,n}function zr(n,e){var i=e[0],a=e[1],c=e[2],d=i*i+a*a+c*c;return d>0&&(d=1/Math.sqrt(d)),n[0]=e[0]*d,n[1]=e[1]*d,n[2]=e[2]*d,n}function Eo(n,e){return n[0]*e[0]+n[1]*e[1]+n[2]*e[2]}function Ug(n,e,i){var a=e[0],c=e[1],d=e[2],g=i[0],y=i[1],b=i[2];return n[0]=c*b-d*y,n[1]=d*g-a*b,n[2]=a*y-c*g,n}function Di(n,e,i){var a=e[0],c=e[1],d=e[2],g=i[3]*a+i[7]*c+i[11]*d+i[15];return n[0]=(i[0]*a+i[4]*c+i[8]*d+i[12])/(g=g||1),n[1]=(i[1]*a+i[5]*c+i[9]*d+i[13])/g,n[2]=(i[2]*a+i[6]*c+i[10]*d+i[14])/g,n}function T0(n,e,i){var a=i[0],c=i[1],d=i[2],g=e[0],y=e[1],b=e[2],E=c*b-d*y,A=d*g-a*b,P=a*y-c*g,z=c*P-d*A,O=d*E-a*P,F=a*A-c*E,q=2*i[3];return A*=q,P*=q,O*=2,F*=2,n[0]=g+(E*=q)+(z*=2),n[1]=y+A+O,n[2]=b+P+F,n}var Dh,jo=Vg,Z2=E0,H2=Ph;function S0(n,e,i){return n[0]=e[0]*i,n[1]=e[1]*i,n[2]=e[2]*i,n[3]=e[3]*i,n}function C0(n,e){var i=e[0],a=e[1],c=e[2],d=e[3],g=i*i+a*a+c*c+d*d;return g>0&&(g=1/Math.sqrt(g)),n[0]=i*g,n[1]=a*g,n[2]=c*g,n[3]=d*g,n}function Ml(n,e,i){var a=e[0],c=e[1],d=e[2],g=e[3];return n[0]=i[0]*a+i[4]*c+i[8]*d+i[12]*g,n[1]=i[1]*a+i[5]*c+i[9]*d+i[13]*g,n[2]=i[2]*a+i[6]*c+i[10]*d+i[14]*g,n[3]=i[3]*a+i[7]*c+i[11]*d+i[15]*g,n}function A0(){var n=new Yr(4);return Yr!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0),n[3]=1,n}function M0(n){return n[0]=0,n[1]=0,n[2]=0,n[3]=1,n}function I0(n,e,i){i*=.5;var a=e[0],c=e[1],d=e[2],g=e[3],y=Math.sin(i),b=Math.cos(i);return n[0]=a*b+g*y,n[1]=c*b+d*y,n[2]=d*b-c*y,n[3]=g*b-a*y,n}function k0(n,e,i){i*=.5;var a=e[0],c=e[1],d=e[2],g=e[3],y=Math.sin(i),b=Math.cos(i);return n[0]=a*b-d*y,n[1]=c*b+g*y,n[2]=d*b+a*y,n[3]=g*b-c*y,n}Ng(),Dh=new Yr(4),Yr!=Float32Array&&(Dh[0]=0,Dh[1]=0,Dh[2]=0,Dh[3]=0);var W2=C0;Ng(),Uc(1,0,0),Uc(0,1,0),A0(),A0(),y0();class qg{constructor(e,i){this.pos=e,this.dir=i}intersectsPlane(e,i,a){const c=Eo(i,this.dir);if(Math.abs(c)<1e-6)return!1;const d=((e[0]-this.pos[0])*i[0]+(e[1]-this.pos[1])*i[1]+(e[2]-this.pos[2])*i[2])/c;return a[0]=this.pos[0]+this.dir[0]*d,a[1]=this.pos[1]+this.dir[1]*d,a[2]=this.pos[2]+this.dir[2]*d,!0}closestPointOnSphere(e,i,a){if(function(O,F){var q=O[0],Z=O[1],le=O[2],ge=F[0],ae=F[1],de=F[2];return Math.abs(q-ge)<=Xf*Math.max(1,Math.abs(q),Math.abs(ge))&&Math.abs(Z-ae)<=Xf*Math.max(1,Math.abs(Z),Math.abs(ae))&&Math.abs(le-de)<=Xf*Math.max(1,Math.abs(le),Math.abs(de))}(this.pos,e)||i===0)return a[0]=a[1]=a[2]=0,!1;const[c,d,g]=this.dir,y=this.pos[0]-e[0],b=this.pos[1]-e[1],E=this.pos[2]-e[2],A=c*c+d*d+g*g,P=2*(y*c+b*d+E*g),z=P*P-4*A*(y*y+b*b+E*E-i*i);if(z<0){const O=Math.max(-P/2,0),F=y+c*O,q=b+d*O,Z=E+g*O,le=Math.hypot(F,q,Z);return a[0]=F*i/le,a[1]=q*i/le,a[2]=Z*i/le,!1}{const O=(-P-Math.sqrt(z))/(2*A);if(O<0){const F=Math.hypot(y,b,E);return a[0]=y*i/F,a[1]=b*i/F,a[2]=E*i/F,!1}return a[0]=y+c*O,a[1]=b+d*O,a[2]=E+g*O,!0}}}class jg{constructor(e,i,a,c,d){this.TL=e,this.TR=i,this.BR=a,this.BL=c,this.horizon=d}static fromInvProjectionMatrix(e,i,a){const c=[-1,1,1],d=[1,1,1],g=[1,-1,1],y=[-1,-1,1],b=Di(c,c,e),E=Di(d,d,e),A=Di(g,g,e),P=Di(y,y,e);return new jg(b,E,A,P,i/a)}}class $g{constructor(e,i){this.points=e,this.planes=i}static fromInvProjectionMatrix(e,i,a,c){const d=Math.pow(2,a),g=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(b=>{const E=Ml([],b,e),A=1/E[3]/i*d;return function(P,z,O){return P[0]=z[0]*O[0],P[1]=z[1]*O[1],P[2]=z[2]*O[2],P[3]=z[3]*O[3],P}(E,E,[A,A,c?1/E[3]:A,A])}),y=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(b=>{const E=zr([],Ug([],jo([],g[b[0]],g[b[1]]),jo([],g[b[2]],g[b[1]]))),A=-Eo(E,g[b[1]]);return E.concat(A)});return new $g(g,y)}}class Lr{static fromPoints(e){const i=[1/0,1/0,1/0],a=[-1/0,-1/0,-1/0];for(const c of e)zh(i,i,c),Lh(a,a,c);return new Lr(i,a)}static applyTransform(e,i){const a=e.getCorners();for(let c=0;c<a.length;++c)Di(a[c],a[c],i);return Lr.fromPoints(a)}constructor(e,i){this.min=e,this.max=i,this.center=co([],Ds([],this.min,this.max),.5)}quadrant(e){const i=[e%2==0,e<2],a=w0(this.min),c=w0(this.max);for(let d=0;d<i.length;d++)a[d]=i[d]?this.min[d]:this.center[d],c[d]=i[d]?this.center[d]:this.max[d];return c[2]=this.max[2],new Lr(a,c)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}distanceZ(e){return Math.max(Math.min(this.max[2],e[2]),this.min[2])-e[2]}getCorners(){const e=this.min,i=this.max;return[[e[0],e[1],e[2]],[i[0],e[1],e[2]],[i[0],i[1],e[2]],[e[0],i[1],e[2]],[e[0],e[1],i[2]],[i[0],e[1],i[2]],[i[0],i[1],i[2]],[e[0],i[1],i[2]]]}intersects(e){const i=this.getCorners();let a=!0;for(let c=0;c<e.planes.length;c++){const d=e.planes[c];let g=0;for(let y=0;y<i.length;y++)g+=Eo(d,i[y])+d[3]>=0;if(g===0)return 0;g!==i.length&&(a=!1)}if(a)return 2;for(let c=0;c<3;c++){let d=Number.MAX_VALUE,g=-Number.MAX_VALUE;for(let y=0;y<e.points.length;y++){const b=e.points[y][c]-this.min[c];d=Math.min(d,b),g=Math.max(g,b)}if(g<0||d>this.max[c]-this.min[c])return 0}return 1}}function P0(n,e,i,a,c,d,g,y,b){if(d&&n.queryGeometry.isAboveHorizon)return!1;d&&(b*=n.pixelToTileUnitsFactor);const E=n.tileID.canonical,A=i.projection.upVectorScale(E,i.center.lat,i.worldSize).metersToTile;for(const P of e)for(const z of P){const O=z.add(y),F=c&&i.elevation?i.elevation.exaggeration()*c.getElevationAt(O.x,O.y,!0):0,q=i.projection.projectTilePoint(O.x,O.y,E);if(F>0){const ae=i.projection.upVector(E,O.x,O.y);q.x+=ae[0]*A*F,q.y+=ae[1]*A*F,q.z+=ae[2]*A*F}const Z=d?O:X2(q.x,q.y,q.z,a),le=d?n.tilespaceRays.map(ae=>Y2(ae,F)):n.queryGeometry.screenGeometry,ge=Ml([],[q.x,q.y,q.z,1],a);if(!g&&d?b*=ge[3]/i.cameraToCenterDistance:g&&!d&&(b*=i.cameraToCenterDistance/ge[3]),d){const ae=mr((z.y/_n+E.y)/(1<<E.z));b/=i.projection.pixelsPerMeter(ae,1)/wo(1,ae)}if(N2(le,Z,b))return!0}return!1}function X2(n,e,i,a){const c=Ml([],[n,e,i,1],a);return new ce(c[0]/c[3],c[1]/c[3])}const z0=Uc(0,0,0),K2=Uc(0,0,1);function Y2(n,e){const i=Ng();return z0[2]=e,n.intersectsPlane(z0,K2,i),new ce(i[0],i[1])}class L0 extends Rg{}function R0(n,{width:e,height:i},a,c){if(c){if(c instanceof Uint8ClampedArray)c=new Uint8Array(c.buffer);else if(c.length!==e*i*a)throw new RangeError("mismatched image size")}else c=new Uint8Array(e*i*a);return n.width=e,n.height=i,n.data=c,n}function D0(n,e,i){const{width:a,height:c}=e;a===n.width&&c===n.height||(Gg(n,e,{x:0,y:0},{x:0,y:0},{width:Math.min(n.width,a),height:Math.min(n.height,c)},i),n.width=a,n.height=c,n.data=e.data)}function Gg(n,e,i,a,c,d){if(c.width===0||c.height===0)return e;if(c.width>n.width||c.height>n.height||i.x>n.width-c.width||i.y>n.height-c.height)throw new RangeError("out of range source coordinates for image copy");if(c.width>e.width||c.height>e.height||a.x>e.width-c.width||a.y>e.height-c.height)throw new RangeError("out of range destination coordinates for image copy");const g=n.data,y=e.data;for(let b=0;b<c.height;b++){const E=((i.y+b)*n.width+i.x)*d,A=((a.y+b)*e.width+a.x)*d;for(let P=0;P<c.width*d;P++)y[A+P]=g[E+P]}return e}Zt(L0,"HeatmapBucket",{omit:["layers"]});class Os{constructor(e,i){R0(this,e,1,i)}resize(e){D0(this,new Os(e),1)}clone(){return new Os({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,i,a,c,d){Gg(e,i,a,c,d,1)}}class Qr{constructor(e,i){R0(this,e,4,i)}resize(e){D0(this,new Qr(e),4)}replace(e,i){i?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new Qr({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,i,a,c,d){Gg(e,i,a,c,d,4)}}Zt(Os,"AlphaImage"),Zt(Qr,"RGBAImage");var Q2={paint:new ln({"heatmap-radius":new We(tt.paint_heatmap["heatmap-radius"]),"heatmap-weight":new We(tt.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new De(tt.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Qt(tt.paint_heatmap["heatmap-color"]),"heatmap-opacity":new De(tt.paint_heatmap["heatmap-opacity"])})};function Zg(n){const e={},i=n.resolution||256,a=n.clips?n.clips.length:1,c=n.image||new Qr({width:i,height:a}),d=(g,y,b)=>{e[n.evaluationKey]=b;const E=n.expression.evaluate(e);c.data[g+y+0]=Math.floor(255*E.r/E.a),c.data[g+y+1]=Math.floor(255*E.g/E.a),c.data[g+y+2]=Math.floor(255*E.b/E.a),c.data[g+y+3]=Math.floor(255*E.a)};if(n.clips)for(let g=0,y=0;g<a;++g,y+=4*i)for(let b=0,E=0;b<i;b++,E+=4){const A=b/(i-1),{start:P,end:z}=n.clips[g];d(y,E,P*(1-A)+z*A)}else for(let g=0,y=0;g<i;g++,y+=4)d(0,y,g/(i-1));return c}var J2={paint:new ln({"hillshade-illumination-direction":new De(tt.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new De(tt.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new De(tt.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new De(tt.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new De(tt.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new De(tt.paint_hillshade["hillshade-accent-color"])})};const eC=Gt([{name:"a_pos",components:2,type:"Int16"}],4),{members:tC}=eC;var Oh={exports:{}};function Yf(n,e,i){i=i||2;var a,c,d,g,y,b,E,A=e&&e.length,P=A?e[0]*i:n.length,z=O0(n,0,P,i,!0),O=[];if(!z||z.next===z.prev)return O;if(A&&(z=function(q,Z,le,ge){var ae,de,be,_e=[];for(ae=0,de=Z.length;ae<de;ae++)(be=O0(q,Z[ae]*ge,ae<de-1?Z[ae+1]*ge:q.length,ge,!1))===be.next&&(be.steiner=!0),_e.push(cC(be));for(_e.sort(sC),ae=0;ae<_e.length;ae++)le=aC(_e[ae],le);return le}(n,e,z,i)),n.length>80*i){a=d=n[0],c=g=n[1];for(var F=i;F<P;F+=i)(y=n[F])<a&&(a=y),(b=n[F+1])<c&&(c=b),y>d&&(d=y),b>g&&(g=b);E=(E=Math.max(d-a,g-c))!==0?32767/E:0}return Bh(z,O,i,a,c,E,0),O}function O0(n,e,i,a,c){var d,g;if(c===Xg(n,e,i,a)>0)for(d=e;d<i;d+=a)g=N0(d,n[d],n[d+1],g);else for(d=i-a;d>=e;d-=a)g=N0(d,n[d],n[d+1],g);return g&&Qf(g,g.next)&&(Nh(g),g=g.next),g}function Il(n,e){if(!n)return n;e||(e=n);var i,a=n;do if(i=!1,a.steiner||!Qf(a,a.next)&&Fi(a.prev,a,a.next)!==0)a=a.next;else{if(Nh(a),(a=e=a.prev)===a.next)break;i=!0}while(i||a!==e);return e}function Bh(n,e,i,a,c,d,g){if(n){!g&&d&&function(A,P,z,O){var F=A;do F.z===0&&(F.z=Hg(F.x,F.y,P,z,O)),F.prevZ=F.prev,F.nextZ=F.next,F=F.next;while(F!==A);F.prevZ.nextZ=null,F.prevZ=null,function(q){var Z,le,ge,ae,de,be,_e,$e,je=1;do{for(le=q,q=null,de=null,be=0;le;){for(be++,ge=le,_e=0,Z=0;Z<je&&(_e++,ge=ge.nextZ);Z++);for($e=je;_e>0||$e>0&&ge;)_e!==0&&($e===0||!ge||le.z<=ge.z)?(ae=le,le=le.nextZ,_e--):(ae=ge,ge=ge.nextZ,$e--),de?de.nextZ=ae:q=ae,ae.prevZ=de,de=ae;le=ge}de.nextZ=null,je*=2}while(be>1)}(F)}(n,a,c,d);for(var y,b,E=n;n.prev!==n.next;)if(y=n.prev,b=n.next,d?iC(n,a,c,d):nC(n))e.push(y.i/i|0),e.push(n.i/i|0),e.push(b.i/i|0),Nh(n),n=b.next,E=b.next;else if((n=b)===E){g?g===1?Bh(n=rC(Il(n),e,i),e,i,a,c,d,2):g===2&&oC(n,e,i,a,c,d):Bh(Il(n),e,i,a,c,d,1);break}}}function nC(n){var e=n.prev,i=n,a=n.next;if(Fi(e,i,a)>=0)return!1;for(var c=e.x,d=i.x,g=a.x,y=e.y,b=i.y,E=a.y,A=c<d?c<g?c:g:d<g?d:g,P=y<b?y<E?y:E:b<E?b:E,z=c>d?c>g?c:g:d>g?d:g,O=y>b?y>E?y:E:b>E?b:E,F=a.next;F!==e;){if(F.x>=A&&F.x<=z&&F.y>=P&&F.y<=O&&qc(c,y,d,b,g,E,F.x,F.y)&&Fi(F.prev,F,F.next)>=0)return!1;F=F.next}return!0}function iC(n,e,i,a){var c=n.prev,d=n,g=n.next;if(Fi(c,d,g)>=0)return!1;for(var y=c.x,b=d.x,E=g.x,A=c.y,P=d.y,z=g.y,O=y<b?y<E?y:E:b<E?b:E,F=A<P?A<z?A:z:P<z?P:z,q=y>b?y>E?y:E:b>E?b:E,Z=A>P?A>z?A:z:P>z?P:z,le=Hg(O,F,e,i,a),ge=Hg(q,Z,e,i,a),ae=n.prevZ,de=n.nextZ;ae&&ae.z>=le&&de&&de.z<=ge;){if(ae.x>=O&&ae.x<=q&&ae.y>=F&&ae.y<=Z&&ae!==c&&ae!==g&&qc(y,A,b,P,E,z,ae.x,ae.y)&&Fi(ae.prev,ae,ae.next)>=0||(ae=ae.prevZ,de.x>=O&&de.x<=q&&de.y>=F&&de.y<=Z&&de!==c&&de!==g&&qc(y,A,b,P,E,z,de.x,de.y)&&Fi(de.prev,de,de.next)>=0))return!1;de=de.nextZ}for(;ae&&ae.z>=le;){if(ae.x>=O&&ae.x<=q&&ae.y>=F&&ae.y<=Z&&ae!==c&&ae!==g&&qc(y,A,b,P,E,z,ae.x,ae.y)&&Fi(ae.prev,ae,ae.next)>=0)return!1;ae=ae.prevZ}for(;de&&de.z<=ge;){if(de.x>=O&&de.x<=q&&de.y>=F&&de.y<=Z&&de!==c&&de!==g&&qc(y,A,b,P,E,z,de.x,de.y)&&Fi(de.prev,de,de.next)>=0)return!1;de=de.nextZ}return!0}function rC(n,e,i){var a=n;do{var c=a.prev,d=a.next.next;!Qf(c,d)&&B0(c,a,a.next,d)&&Fh(c,d)&&Fh(d,c)&&(e.push(c.i/i|0),e.push(a.i/i|0),e.push(d.i/i|0),Nh(a),Nh(a.next),a=n=d),a=a.next}while(a!==n);return Il(a)}function oC(n,e,i,a,c,d){var g=n;do{for(var y=g.next.next;y!==g.prev;){if(g.i!==y.i&&uC(g,y)){var b=F0(g,y);return g=Il(g,g.next),b=Il(b,b.next),Bh(g,e,i,a,c,d,0),void Bh(b,e,i,a,c,d,0)}y=y.next}g=g.next}while(g!==n)}function sC(n,e){return n.x-e.x}function aC(n,e){var i=function(c,d){var g,y=d,b=c.x,E=c.y,A=-1/0;do{if(E<=y.y&&E>=y.next.y&&y.next.y!==y.y){var P=y.x+(E-y.y)*(y.next.x-y.x)/(y.next.y-y.y);if(P<=b&&P>A&&(A=P,g=y.x<y.next.x?y:y.next,P===b))return g}y=y.next}while(y!==d);if(!g)return null;var z,O=g,F=g.x,q=g.y,Z=1/0;y=g;do b>=y.x&&y.x>=F&&b!==y.x&&qc(E<q?b:A,E,F,q,E<q?A:b,E,y.x,y.y)&&(z=Math.abs(E-y.y)/(b-y.x),Fh(y,c)&&(z<Z||z===Z&&(y.x>g.x||y.x===g.x&&lC(g,y)))&&(g=y,Z=z)),y=y.next;while(y!==O);return g}(n,e);if(!i)return e;var a=F0(i,n);return Il(a,a.next),Il(i,i.next)}function lC(n,e){return Fi(n.prev,n,e.prev)<0&&Fi(e.next,n,n.next)<0}function Hg(n,e,i,a,c){return(n=1431655765&((n=858993459&((n=252645135&((n=16711935&((n=(n-i)*c|0)|n<<8))|n<<4))|n<<2))|n<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-a)*c|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function cC(n){var e=n,i=n;do(e.x<i.x||e.x===i.x&&e.y<i.y)&&(i=e),e=e.next;while(e!==n);return i}function qc(n,e,i,a,c,d,g,y){return(c-g)*(e-y)>=(n-g)*(d-y)&&(n-g)*(a-y)>=(i-g)*(e-y)&&(i-g)*(d-y)>=(c-g)*(a-y)}function uC(n,e){return n.next.i!==e.i&&n.prev.i!==e.i&&!function(i,a){var c=i;do{if(c.i!==i.i&&c.next.i!==i.i&&c.i!==a.i&&c.next.i!==a.i&&B0(c,c.next,i,a))return!0;c=c.next}while(c!==i);return!1}(n,e)&&(Fh(n,e)&&Fh(e,n)&&function(i,a){var c=i,d=!1,g=(i.x+a.x)/2,y=(i.y+a.y)/2;do c.y>y!=c.next.y>y&&c.next.y!==c.y&&g<(c.next.x-c.x)*(y-c.y)/(c.next.y-c.y)+c.x&&(d=!d),c=c.next;while(c!==i);return d}(n,e)&&(Fi(n.prev,n,e.prev)||Fi(n,e.prev,e))||Qf(n,e)&&Fi(n.prev,n,n.next)>0&&Fi(e.prev,e,e.next)>0)}function Fi(n,e,i){return(e.y-n.y)*(i.x-e.x)-(e.x-n.x)*(i.y-e.y)}function Qf(n,e){return n.x===e.x&&n.y===e.y}function B0(n,e,i,a){var c=ep(Fi(n,e,i)),d=ep(Fi(n,e,a)),g=ep(Fi(i,a,n)),y=ep(Fi(i,a,e));return c!==d&&g!==y||!(c!==0||!Jf(n,i,e))||!(d!==0||!Jf(n,a,e))||!(g!==0||!Jf(i,n,a))||!(y!==0||!Jf(i,e,a))}function Jf(n,e,i){return e.x<=Math.max(n.x,i.x)&&e.x>=Math.min(n.x,i.x)&&e.y<=Math.max(n.y,i.y)&&e.y>=Math.min(n.y,i.y)}function ep(n){return n>0?1:n<0?-1:0}function Fh(n,e){return Fi(n.prev,n,n.next)<0?Fi(n,e,n.next)>=0&&Fi(n,n.prev,e)>=0:Fi(n,e,n.prev)<0||Fi(n,n.next,e)<0}function F0(n,e){var i=new Wg(n.i,n.x,n.y),a=new Wg(e.i,e.x,e.y),c=n.next,d=e.prev;return n.next=e,e.prev=n,i.next=c,c.prev=i,a.next=i,i.prev=a,d.next=a,a.prev=d,a}function N0(n,e,i,a){var c=new Wg(n,e,i);return a?(c.next=a.next,c.prev=a,a.next.prev=c,a.next=c):(c.prev=c,c.next=c),c}function Nh(n){n.next.prev=n.prev,n.prev.next=n.next,n.prevZ&&(n.prevZ.nextZ=n.nextZ),n.nextZ&&(n.nextZ.prevZ=n.prevZ)}function Wg(n,e,i){this.i=n,this.x=e,this.y=i,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Xg(n,e,i,a){for(var c=0,d=e,g=i-a;d<i;d+=a)c+=(n[g]-n[d])*(n[d+1]+n[g+1]),g=d;return c}function hC(n,e,i,a,c){V0(n,e,i||0,a||n.length-1,c||dC)}function V0(n,e,i,a,c){for(;a>i;){if(a-i>600){var d=a-i+1,g=e-i+1,y=Math.log(d),b=.5*Math.exp(2*y/3),E=.5*Math.sqrt(y*b*(d-b)/d)*(g-d/2<0?-1:1);V0(n,e,Math.max(i,Math.floor(e-g*b/d+E)),Math.min(a,Math.floor(e+(d-g)*b/d+E)),c)}var A=n[e],P=i,z=a;for(Vh(n,i,e),c(n[a],A)>0&&Vh(n,i,a);P<z;){for(Vh(n,P,z),P++,z--;c(n[P],A)<0;)P++;for(;c(n[z],A)>0;)z--}c(n[i],A)===0?Vh(n,i,z):Vh(n,++z,a),z<=e&&(i=z+1),e<=z&&(a=z-1)}}function Vh(n,e,i){var a=n[e];n[e]=n[i],n[i]=a}function dC(n,e){return n<e?-1:n>e?1:0}function Kg(n,e){const i=n.length;if(i<=1)return[n];const a=[];let c,d;for(let g=0;g<i;g++){const y=Fe(n[g]);y!==0&&(n[g].area=Math.abs(y),d===void 0&&(d=y<0),d===y<0?(c&&a.push(c),c=[n[g]]):c.push(n[g]))}if(c&&a.push(c),e>1)for(let g=0;g<a.length;g++)a[g].length<=e||(hC(a[g],e,1,a[g].length-1,fC),a[g]=a[g].slice(0,e));return a}function fC(n,e){return e.area-n.area}function Yg(n,e,i){const a=i.patternDependencies;let c=!1;for(const d of e){const g=d.paint.get(`${n}-pattern`);g.isConstant()||(c=!0);const y=g.constantOr(null);y&&(c=!0,a[y]=!0)}return c}function Qg(n,e,i,a,c){const d=c.patternDependencies;for(const g of e){const y=g.paint.get(`${n}-pattern`).value;if(y.kind!=="constant"){let b=y.evaluate({zoom:a},i,{},c.availableImages);b=b&&b.name?b.name:b,d[b]=!0,i.patterns[g.id]=b}}return i}Oh.exports=Yf,Oh.exports.default=Yf,Yf.deviation=function(n,e,i,a){var c=e&&e.length,d=Math.abs(Xg(n,0,c?e[0]*i:n.length,i));if(c)for(var g=0,y=e.length;g<y;g++)d-=Math.abs(Xg(n,e[g]*i,g<y-1?e[g+1]*i:n.length,i));var b=0;for(g=0;g<a.length;g+=3){var E=a[g]*i,A=a[g+1]*i,P=a[g+2]*i;b+=Math.abs((n[E]-n[P])*(n[A+1]-n[E+1])-(n[E]-n[A])*(n[P+1]-n[E+1]))}return d===0&&b===0?0:Math.abs((b-d)/d)},Yf.flatten=function(n){for(var e=n[0][0].length,i={vertices:[],holes:[],dimensions:e},a=0,c=0;c<n.length;c++){for(var d=0;d<n[c].length;d++)for(var g=0;g<e;g++)i.vertices.push(n[c][d][g]);c>0&&i.holes.push(a+=n[c-1].length)}return i};class tp{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Hn,this.indexArray=new pr,this.indexArray2=new bo,this.programConfigurations=new El(e.layers,e.zoom),this.segments=new Hi,this.segments2=new Hi,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.projection=e.projection}populate(e,i,a,c){this.hasPattern=Yg("fill",this.layers,i);const d=this.layers[0].layout.get("fill-sort-key"),g=[];for(const{feature:y,id:b,index:E,sourceLayerIndex:A}of e){const P=this.layers[0]._featureFilter.needGeometry,z=Tl(y,P);if(!this.layers[0]._featureFilter.filter(new Le(this.zoom),z,a))continue;const O=d?d.evaluate(z,{},a,i.availableImages):void 0,F={id:b,properties:y.properties,type:y.type,sourceLayerIndex:A,index:E,geometry:P?z.geometry:Rs(y,a,c),patterns:{},sortKey:O};g.push(F)}d&&g.sort((y,b)=>y.sortKey-b.sortKey);for(const y of g){const{geometry:b,index:E,sourceLayerIndex:A}=y;if(this.hasPattern){const P=Qg("fill",this.layers,y,this.zoom,i);this.patternFeatures.push(P)}else this.addFeature(y,b,E,a,{},i.availableImages);i.featureIndex.insert(e[E].feature,b,E,A,this.index)}}update(e,i,a,c){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,i,this.stateDependentLayers,a,c)}addFeatures(e,i,a,c,d){for(const g of this.patternFeatures)this.addFeature(g,g.geometry,g.index,i,a,c)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,tC),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,i,a,c,d,g=[]){for(const y of Kg(i,500)){let b=0;for(const F of y)b+=F.length;const E=this.segments.prepareSegment(b,this.layoutVertexArray,this.indexArray),A=E.vertexLength,P=[],z=[];for(const F of y){if(F.length===0)continue;F!==y[0]&&z.push(P.length/2);const q=this.segments2.prepareSegment(F.length,this.layoutVertexArray,this.indexArray2),Z=q.vertexLength;this.layoutVertexArray.emplaceBack(F[0].x,F[0].y),this.indexArray2.emplaceBack(Z+F.length-1,Z),P.push(F[0].x),P.push(F[0].y);for(let le=1;le<F.length;le++)this.layoutVertexArray.emplaceBack(F[le].x,F[le].y),this.indexArray2.emplaceBack(Z+le-1,Z+le),P.push(F[le].x),P.push(F[le].y);q.vertexLength+=F.length,q.primitiveLength+=F.length}const O=Oh.exports(P,z);for(let F=0;F<O.length;F+=3)this.indexArray.emplaceBack(A+O[F],A+O[F+1],A+O[F+2]);E.vertexLength+=b,E.primitiveLength+=O.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,a,d,g,c)}}Zt(tp,"FillBucket",{omit:["layers","patternFeatures"]});const pC=new ln({"fill-sort-key":new We(tt.layout_fill["fill-sort-key"])});var mC={paint:new ln({"fill-antialias":new De(tt.paint_fill["fill-antialias"]),"fill-opacity":new We(tt.paint_fill["fill-opacity"]),"fill-color":new We(tt.paint_fill["fill-color"]),"fill-outline-color":new We(tt.paint_fill["fill-outline-color"]),"fill-translate":new De(tt.paint_fill["fill-translate"]),"fill-translate-anchor":new De(tt.paint_fill["fill-translate-anchor"]),"fill-pattern":new We(tt.paint_fill["fill-pattern"])}),layout:pC};const gC=Gt([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),_C=Gt([{name:"a_centroid_pos",components:2,type:"Uint16"}]),yC=Gt([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:vC}=gC;var np={},xC=ce,U0=jc;function jc(n,e,i,a,c){this.properties={},this.extent=i,this.type=0,this._pbf=n,this._geometry=-1,this._keys=a,this._values=c,n.readFields(bC,this,e)}function bC(n,e,i){n==1?e.id=i.readVarint():n==2?function(a,c){for(var d=a.readVarint()+a.pos;a.pos<d;){var g=c._keys[a.readVarint()],y=c._values[a.readVarint()];c.properties[g]=y}}(i,e):n==3?e.type=i.readVarint():n==4&&(e._geometry=i.pos)}function wC(n){for(var e,i,a=0,c=0,d=n.length,g=d-1;c<d;g=c++)a+=((i=n[g]).x-(e=n[c]).x)*(e.y+i.y);return a}jc.types=["Unknown","Point","LineString","Polygon"],jc.prototype.loadGeometry=function(){var n=this._pbf;n.pos=this._geometry;for(var e,i=n.readVarint()+n.pos,a=1,c=0,d=0,g=0,y=[];n.pos<i;){if(c<=0){var b=n.readVarint();a=7&b,c=b>>3}if(c--,a===1||a===2)d+=n.readSVarint(),g+=n.readSVarint(),a===1&&(e&&y.push(e),e=[]),e.push(new xC(d,g));else{if(a!==7)throw new Error("unknown command "+a);e&&e.push(e[0].clone())}}return e&&y.push(e),y},jc.prototype.bbox=function(){var n=this._pbf;n.pos=this._geometry;for(var e=n.readVarint()+n.pos,i=1,a=0,c=0,d=0,g=1/0,y=-1/0,b=1/0,E=-1/0;n.pos<e;){if(a<=0){var A=n.readVarint();i=7&A,a=A>>3}if(a--,i===1||i===2)(c+=n.readSVarint())<g&&(g=c),c>y&&(y=c),(d+=n.readSVarint())<b&&(b=d),d>E&&(E=d);else if(i!==7)throw new Error("unknown command "+i)}return[g,b,y,E]},jc.prototype.toGeoJSON=function(n,e,i){var a,c,d=this.extent*Math.pow(2,i),g=this.extent*n,y=this.extent*e,b=this.loadGeometry(),E=jc.types[this.type];function A(O){for(var F=0;F<O.length;F++){var q=O[F];O[F]=[360*(q.x+g)/d-180,360/Math.PI*Math.atan(Math.exp((180-360*(q.y+y)/d)*Math.PI/180))-90]}}switch(this.type){case 1:var P=[];for(a=0;a<b.length;a++)P[a]=b[a][0];A(b=P);break;case 2:for(a=0;a<b.length;a++)A(b[a]);break;case 3:for(b=function(O){var F=O.length;if(F<=1)return[O];for(var q,Z,le=[],ge=0;ge<F;ge++){var ae=wC(O[ge]);ae!==0&&(Z===void 0&&(Z=ae<0),Z===ae<0?(q&&le.push(q),q=[O[ge]]):q.push(O[ge]))}return q&&le.push(q),le}(b),a=0;a<b.length;a++)for(c=0;c<b[a].length;c++)A(b[a][c])}b.length===1?b=b[0]:E="Multi"+E;var z={type:"Feature",geometry:{type:E,coordinates:b},properties:this.properties};return"id"in this&&(z.id=this.id),z};var EC=U0,q0=j0;function j0(n,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=n,this._keys=[],this._values=[],this._features=[],n.readFields(TC,this,e),this.length=this._features.length}function TC(n,e,i){n===15?e.version=i.readVarint():n===1?e.name=i.readString():n===5?e.extent=i.readVarint():n===2?e._features.push(i.pos):n===3?e._keys.push(i.readString()):n===4&&e._values.push(function(a){for(var c=null,d=a.readVarint()+a.pos;a.pos<d;){var g=a.readVarint()>>3;c=g===1?a.readString():g===2?a.readFloat():g===3?a.readDouble():g===4?a.readVarint64():g===5?a.readVarint():g===6?a.readSVarint():g===7?a.readBoolean():null}return c}(i))}j0.prototype.feature=function(n){if(n<0||n>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[n];var e=this._pbf.readVarint()+this._pbf.pos;return new EC(this._pbf,e,this.extent,this._keys,this._values)};var SC=q0;function CC(n,e,i){if(n===3){var a=new SC(i,i.readVarint()+i.pos);a.length&&(e[a.name]=a)}}var Jg=np.VectorTile=function(n,e){this.layers=n.readFields(CC,{},e)},ip=np.VectorTileFeature=U0;function rp(n,e,i,a){const c=[],d=a===0?(g,y,b,E,A,P)=>{g.push(new ce(P,b+(P-y)/(E-y)*(A-b)))}:(g,y,b,E,A,P)=>{g.push(new ce(y+(P-b)/(A-b)*(E-y),P))};for(const g of n){const y=[];for(const b of g){if(b.length<=2)continue;const E=[];for(let z=0;z<b.length-1;z++){const O=b[z].x,F=b[z].y,q=b[z+1].x,Z=b[z+1].y,le=a===0?O:F,ge=a===0?q:Z;le<e?ge>e&&d(E,O,F,q,Z,e):le>i?ge<i&&d(E,O,F,q,Z,i):E.push(b[z]),ge<e&&le>=e&&d(E,O,F,q,Z,e),ge>i&&le<=i&&d(E,O,F,q,Z,i)}let A=b[b.length-1];const P=a===0?A.x:A.y;P>=e&&P<=i&&E.push(A),E.length&&(A=E[E.length-1],E[0].x===A.x&&E[0].y===A.y||E.push(E[0]),y.push(E))}y.length&&c.push(y)}return c}np.VectorTileLayer=q0;const AC=ip.types,MC=Math.pow(2,13);function Uh(n,e,i,a,c,d,g,y){n.emplaceBack((e<<1)+g,(i<<1)+d,(Math.floor(a*MC)<<1)+c,Math.round(y))}function qh(n,e,i){n.emplaceBack(e.x,e.y,e.z,i[0]*16384,i[1]*16384,i[2]*16384)}class $0{constructor(){this.acc=new ce(0,0),this.polyCount=[]}startRing(e){this.currentPolyCount={edges:0,top:0},this.polyCount.push(this.currentPolyCount),this.min||(this.min=new ce(e.x,e.y),this.max=new ce(e.x,e.y))}append(e,i){this.currentPolyCount.edges++,this.acc._add(e);const a=this.min,c=this.max;e.x<a.x?a.x=e.x:e.x>c.x&&(c.x=e.x),e.y<a.y?a.y=e.y:e.y>c.y&&(c.y=e.y),((e.x===0||e.x===_n)&&e.x===i.x)!=((e.y===0||e.y===_n)&&e.y===i.y)&&this.processBorderOverlap(e,i),i.x<0!=e.x<0&&this.addBorderIntersection(0,$n(i.y,e.y,(0-i.x)/(e.x-i.x))),i.x>_n!=e.x>_n&&this.addBorderIntersection(1,$n(i.y,e.y,(_n-i.x)/(e.x-i.x))),i.y<0!=e.y<0&&this.addBorderIntersection(2,$n(i.x,e.x,(0-i.y)/(e.y-i.y))),i.y>_n!=e.y>_n&&this.addBorderIntersection(3,$n(i.x,e.x,(_n-i.y)/(e.y-i.y)))}addBorderIntersection(e,i){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const a=this.borders[e];i<a[0]&&(a[0]=i),i>a[1]&&(a[1]=i)}processBorderOverlap(e,i){if(e.x===i.x){if(e.y===i.y)return;const a=e.x===0?0:1;this.addBorderIntersection(a,i.y),this.addBorderIntersection(a,e.y)}else{const a=e.y===0?2:3;this.addBorderIntersection(a,i.x),this.addBorderIntersection(a,e.x)}}centroid(){const e=this.polyCount.reduce((i,a)=>i+a.edges,0);return e!==0?this.acc.div(e)._round():new ce(0,0)}span(){return new ce(this.max.x-this.min.x,this.max.y-this.min.y)}intersectsCount(){return this.borders.reduce((e,i)=>e+ +(i[0]!==Number.MAX_VALUE),0)}}class jh{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.id),this.index=e.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=e.projection,this.layoutVertexArray=new ii,this.centroidVertexArray=new Qv,this.indexArray=new pr,this.programConfigurations=new El(e.layers,e.zoom),this.segments=new Hi,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.enableTerrain=e.enableTerrain}populate(e,i,a,c){this.features=[],this.hasPattern=Yg("fill-extrusion",this.layers,i),this.featuresOnBorder=[],this.borders=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=function(d){const g=Math.exp(Math.PI*(1-d.y/(1<<d.z)*2));return 80150034*g/(g*g+1)/_n/(1<<d.z)}(a),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter;for(const{feature:d,id:g,index:y,sourceLayerIndex:b}of e){const E=this.layers[0]._featureFilter.needGeometry,A=Tl(d,E);if(!this.layers[0]._featureFilter.filter(new Le(this.zoom),A,a))continue;const P={id:g,sourceLayerIndex:b,index:y,geometry:E?A.geometry:Rs(d,a,c),properties:d.properties,type:d.type,patterns:{}},z=this.layoutVertexArray.length;this.hasPattern?this.features.push(Qg("fill-extrusion",this.layers,P,this.zoom,i)):this.addFeature(P,P.geometry,y,a,{},i.availableImages,c),i.featureIndex.insert(d,P.geometry,y,b,this.index,z)}this.sortBorders()}addFeatures(e,i,a,c,d){for(const g of this.features){const{geometry:y}=g;this.addFeature(g,y,g.index,i,a,c,d)}this.sortBorders()}update(e,i,a,c){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,i,this.stateDependentLayers,a,c)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,vC),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=e.createVertexBuffer(this.layoutVertexExtArray,yC.members,!0))),this.programConfigurations.upload(e),this.uploaded=!0}uploadCentroid(e){this.centroidVertexArray.length!==0&&(this.centroidVertexBuffer?this.needsCentroidUpdate&&this.centroidVertexBuffer.updateData(this.centroidVertexArray):this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,_C.members,!0),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,i,a,c,d,g,y){const b=[new ce(0,0),new ce(_n,_n)],E=y.projection,A=E.name==="globe",P=this.enableTerrain&&!A?new $0:null,z=AC[e.type]==="Polygon";A&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new gi);const O=Kg(i,500);for(let le=O.length-1;le>=0;le--){const ge=O[le];(ge.length===0||(F=ge[0]).every(ae=>ae.x<=0)||F.every(ae=>ae.x>=_n)||F.every(ae=>ae.y<=0)||F.every(ae=>ae.y>=_n))&&O.splice(le,1)}var F;let q;if(A)q=Y0(O,b,c);else{q=[];for(const le of O)q.push({polygon:le,bounds:b})}const Z=z?this.edgeRadius:0;for(const{polygon:le,bounds:ge}of q){let ae=0,de=0;for(const _e of le)z&&!_e[0].equals(_e[_e.length-1])&&_e.push(_e[0]),de+=z?_e.length-1:_e.length;const be=this.segments.prepareSegment((z?5:4)*de,this.layoutVertexArray,this.indexArray);if(z){const _e=[],$e=[];ae=be.vertexLength;for(const it of le){let St,Ke;it.length&&it!==le[0]&&$e.push(_e.length/2),St=it[1].sub(it[0])._perp()._unit();for(let ut=1;ut<it.length;ut++){const dt=it[ut],vt=it[ut===it.length-1?1:ut+1];let{x:Ct,y:Qe}=dt;if(Z){Ke=vt.sub(dt)._perp()._unit();const Dt=St.add(Ke)._unit(),dn=Z*Math.min(4,1/(St.x*Dt.x+St.y*Dt.y));Ct+=dn*Dt.x,Qe+=dn*Dt.y,St=Ke}Uh(this.layoutVertexArray,Ct,Qe,0,0,1,1,0),be.vertexLength++,_e.push(dt.x,dt.y),A&&qh(this.layoutVertexExtArray,E.projectTilePoint(Ct,Qe,c),E.upVector(c,Ct,Qe))}}const je=Oh.exports(_e,$e);for(let it=0;it<je.length;it+=3)this.indexArray.emplaceBack(ae+je[it],ae+je[it+2],ae+je[it+1]),be.primitiveLength++}for(const _e of le){P&&_e.length&&P.startRing(_e[0]);let $e,je,it,St=_e.length>4&&W0(_e[_e.length-2],_e[0],_e[1]),Ke=Z?IC(_e[_e.length-2],_e[0],_e[1],Z):0;je=_e[1].sub(_e[0])._perp()._unit();let ut=!0;for(let dt=1,vt=0;dt<_e.length;dt++){let Ct=_e[dt-1],Qe=_e[dt];const Dt=_e[dt===_e.length-1?1:dt+1];if(P&&z&&P.currentPolyCount.top++,H0(Qe,Ct,ge)){Z&&(je=Dt.sub(Qe)._perp()._unit(),ut=!ut);continue}P&&P.append(Qe,Ct);const dn=Qe.sub(Ct)._perp(),Ut=dn.x/(Math.abs(dn.x)+Math.abs(dn.y)),en=dn.y>0?1:0,Ot=Ct.dist(Qe);if(vt+Ot>32768&&(vt=0),Z){it=Dt.sub(Qe)._perp()._unit();let An=Z0(Ct,Qe,Dt,G0(je,it),Z);isNaN(An)&&(An=0);const gn=Qe.sub(Ct)._unit();Ct=Ct.add(gn.mult(Ke))._round(),Qe=Qe.add(gn.mult(-An))._round(),Ke=An,je=it}const pn=be.vertexLength,Rn=_e.length>4&&W0(Ct,Qe,Dt);let Pn=X0(vt,St,ut);if(Uh(this.layoutVertexArray,Ct.x,Ct.y,Ut,en,0,0,Pn),Uh(this.layoutVertexArray,Ct.x,Ct.y,Ut,en,0,1,Pn),vt+=Ot,Pn=X0(vt,Rn,!ut),St=Rn,Uh(this.layoutVertexArray,Qe.x,Qe.y,Ut,en,0,0,Pn),Uh(this.layoutVertexArray,Qe.x,Qe.y,Ut,en,0,1,Pn),be.vertexLength+=4,this.indexArray.emplaceBack(pn+0,pn+1,pn+2),this.indexArray.emplaceBack(pn+1,pn+3,pn+2),be.primitiveLength+=2,Z){const An=ae+(dt===1?_e.length-2:dt-2),gn=dt===1?ae:An+1;if(this.indexArray.emplaceBack(pn+1,An,pn+3),this.indexArray.emplaceBack(An,gn,pn+3),be.primitiveLength+=2,$e===void 0&&($e=pn),!H0(Dt,_e[dt],ge)){const ti=dt===_e.length-1?$e:be.vertexLength;this.indexArray.emplaceBack(pn+2,pn+3,ti),this.indexArray.emplaceBack(pn+3,ti+1,ti),this.indexArray.emplaceBack(pn+3,gn,ti+1),be.primitiveLength+=3}ut=!ut}if(A){const An=this.layoutVertexExtArray,gn=E.projectTilePoint(Ct.x,Ct.y,c),ti=E.projectTilePoint(Qe.x,Qe.y,c),wn=E.upVector(c,Ct.x,Ct.y),Dn=E.upVector(c,Qe.x,Qe.y);qh(An,gn,wn),qh(An,gn,wn),qh(An,ti,Dn),qh(An,ti,Dn)}}z&&(ae+=_e.length-1)}}if(P&&P.polyCount.length>0){if(P.borders){P.vertexArrayOffset=this.centroidVertexArray.length;const le=P.borders,ge=this.featuresOnBorder.push(P)-1;for(let ae=0;ae<4;ae++)le[ae][0]!==Number.MAX_VALUE&&this.borders[ae].push(ge)}this.encodeCentroid(P.borders?void 0:P.centroid(),P)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,a,d,g,c)}sortBorders(){for(let e=0;e<4;e++)this.borders[e].sort((i,a)=>this.featuresOnBorder[i].borders[e][0]-this.featuresOnBorder[a].borders[e][0])}encodeCentroid(e,i,a=!0){let c,d;if(e)if(e.y!==0){const y=i.span()._mult(this.tileToMeter);c=(Math.max(e.x,1)<<3)+Math.min(7,Math.round(y.x/10)),d=(Math.max(e.y,1)<<3)+Math.min(7,Math.round(y.y/10))}else c=Math.ceil(7*(e.x+450)),d=0;else c=0,d=+a;let g=a?this.centroidVertexArray.length:i.vertexArrayOffset;for(const y of i.polyCount){a&&this.centroidVertexArray.resize(this.centroidVertexArray.length+4*y.edges+y.top);for(let b=0;b<y.top;b++)this.centroidVertexArray.emplace(g++,c,d);for(let b=0;b<2*y.edges;b++)this.centroidVertexArray.emplace(g++,0,d),this.centroidVertexArray.emplace(g++,c,d)}}}function G0(n,e){const i=n.add(e)._unit();return n.x*i.x+n.y*i.y}function IC(n,e,i,a){const c=e.sub(n)._perp()._unit(),d=i.sub(e)._perp()._unit();return Z0(n,e,i,G0(c,d),a)}function Z0(n,e,i,a,c){const d=Math.sqrt(1-a*a);return Math.min(n.dist(e)/3,e.dist(i)/3,c*d/a)}function H0(n,e,i){return n.x<i[0].x&&e.x<i[0].x||n.x>i[1].x&&e.x>i[1].x||n.y<i[0].y&&e.y<i[0].y||n.y>i[1].y&&e.y>i[1].y}function W0(n,e,i){if(n.x<0||n.x>=_n||e.x<0||e.x>=_n||i.x<0||i.x>=_n)return!1;const a=i.sub(e),c=a.perp(),d=n.sub(e);return(a.x*d.x+a.y*d.y)/Math.sqrt((a.x*a.x+a.y*a.y)*(d.x*d.x+d.y*d.y))>-.866&&c.x*d.x+c.y*d.y<0}function X0(n,e,i){const a=e?2|n:-3&n;return i?1|a:-2&a}function K0(){const n=Math.PI/32,e=Math.tan(n),i=Gf;return i*Math.sqrt(1+2*e*e)-i}function Y0(n,e,i){const a=1<<i.z,c=lo(i.x/a),d=lo((i.x+1)/a),g=mr(i.y/a),y=mr((i.y+1)/a);return function(b,E,A,P,z=0,O){const F=[];if(!b.length||!A||!P)return F;const q=(_e,$e)=>{for(const je of _e)F.push({polygon:je,bounds:$e})},Z=Math.ceil(Math.log2(A)),le=Math.ceil(Math.log2(P)),ge=Z-le,ae=[];for(let _e=0;_e<Math.abs(ge);_e++)ae.push(ge>0?0:1);for(let _e=0;_e<Math.min(Z,le);_e++)ae.push(0),ae.push(1);let de=b;if(de=rp(de,E[0].y-z,E[1].y+z,1),de=rp(de,E[0].x-z,E[1].x+z,0),!de.length)return F;const be=[];for(ae.length?be.push({polygons:de,bounds:E,depth:0}):q(de,E);be.length;){const _e=be.pop(),$e=_e.depth,je=ae[$e],it=_e.bounds[0],St=_e.bounds[1],Ke=je===0?it.x:it.y,ut=je===0?St.x:St.y,dt=O?O(je,Ke,ut):.5*(Ke+ut),vt=rp(_e.polygons,Ke-z,dt+z,je),Ct=rp(_e.polygons,dt-z,ut+z,je);if(vt.length){const Qe=[it,new ce(je===0?dt:St.x,je===1?dt:St.y)];ae.length>$e+1?be.push({polygons:vt,bounds:Qe,depth:$e+1}):q(vt,Qe)}if(Ct.length){const Qe=[new ce(je===0?dt:it.x,je===1?dt:it.y),St];ae.length>$e+1?be.push({polygons:Ct,bounds:Qe,depth:$e+1}):q(Ct,Qe)}}return F}(n,e,Math.ceil((d-c)/11.25),Math.ceil((g-y)/11.25),1,(b,E,A)=>{if(b===0)return .5*(E+A);{const P=mr((i.y+E/_n)/a);return(as(.5*(mr((i.y+A/_n)/a)+P))*a-i.y)*_n}})}Zt(jh,"FillExtrusionBucket",{omit:["layers","features"]}),Zt($0,"PartMetadata");const kC=new ln({"fill-extrusion-edge-radius":new De(tt["layout_fill-extrusion"]["fill-extrusion-edge-radius"])});var PC={paint:new ln({"fill-extrusion-opacity":new De(tt["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new We(tt["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new De(tt["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new De(tt["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new We(tt["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new We(tt["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new We(tt["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new De(tt["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new De(tt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new De(tt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"])}),layout:kC};function Q0(n,e,i){var a=2*Math.PI*6378137/256/Math.pow(2,i);return[n*a-2*Math.PI*6378137/2,e*a-2*Math.PI*6378137/2]}class op{constructor(e,i,a){this.z=e,this.x=i,this.y=a,this.key=$h(0,e,e,i,a)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,i){const a=function(d,g,y){var b=Q0(256*d,256*(g=Math.pow(2,y)-g-1),y),E=Q0(256*(d+1),256*(g+1),y);return b[0]+","+b[1]+","+E[0]+","+E[1]}(this.x,this.y,this.z),c=function(d,g,y){let b,E="";for(let A=d;A>0;A--)b=1<<A-1,E+=(g&b?1:0)+(y&b?2:0);return E}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(i==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",c).replace("{bbox-epsg-3857}",a)}toString(){return`${this.z}/${this.x}/${this.y}`}}class J0{constructor(e,i){this.wrap=e,this.canonical=i,this.key=$h(e,i.z,i.z,i.x,i.y)}}class Rr{constructor(e,i,a,c,d){this.overscaledZ=e,this.wrap=i,this.canonical=new op(a,+c,+d),this.key=i===0&&e===a?this.canonical.key:$h(i,e,a,c,d)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){const i=this.canonical.z-e;return e>this.canonical.z?new Rr(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Rr(e,this.wrap,e,this.canonical.x>>i,this.canonical.y>>i)}calculateScaledKey(e,i=!0){if(this.overscaledZ===e&&i)return this.key;if(e>this.canonical.z)return $h(this.wrap*+i,e,this.canonical.z,this.canonical.x,this.canonical.y);{const a=this.canonical.z-e;return $h(this.wrap*+i,e,e,this.canonical.x>>a,this.canonical.y>>a)}}isChildOf(e){if(e.wrap!==this.wrap)return!1;const i=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.x===this.canonical.x>>i&&e.canonical.y===this.canonical.y>>i}children(e){if(this.overscaledZ>=e)return[new Rr(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const i=this.canonical.z+1,a=2*this.canonical.x,c=2*this.canonical.y;return[new Rr(i,this.wrap,i,a,c),new Rr(i,this.wrap,i,a+1,c),new Rr(i,this.wrap,i,a,c+1),new Rr(i,this.wrap,i,a+1,c+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new Rr(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new Rr(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new J0(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function $h(n,e,i,a,c){const d=1<<Math.min(i,22);let g=d*(c%d)+a%d;return n&&i<22&&(g+=d*d*((n<0?-2*n-1:2*n)%(1<<2*(22-i)))),16*(32*g+i)+(e-i)}Zt(op,"CanonicalTileID"),Zt(Rr,"OverscaledTileID",{omit:["projMatrix"]});class $c extends ce{constructor(e,i,a){super(e,i),this.z=a}}function Gh(n,e){return n.x*e.x+n.y*e.y}function ex(n,e){if(n.length===1){let i=0;const a=e[i++];let c;for(;!c||a.equals(c);)if(c=e[i++],!c)return 1/0;for(;i<e.length;i++){const d=e[i],g=n[0],y=c.sub(a),b=d.sub(a),E=g.sub(a),A=Gh(y,y),P=Gh(y,b),z=Gh(b,b),O=Gh(E,y),F=Gh(E,b),q=A*z-P*P,Z=(z*O-P*F)/q,le=(A*F-P*O)/q,ge=a.z*(1-Z-le)+c.z*Z+d.z*le;if(isFinite(ge))return ge}return 1/0}{let i=1/0;for(const a of e)i=Math.min(i,a.z);return i}}function tx(n,e,i,a,c,d,g,y){const b=g*c.getElevationAt(n,e,!0,!0),E=d[0]!==0,A=E?d[1]===0?g*(d[0]/7-450):g*function(P,z,O){const F=Math.floor(z[0]/8),q=Math.floor(z[1]/8),Z=10*(z[0]-8*F),le=10*(z[1]-8*q),ge=P.getElevationAt(F,q,!0,!0),ae=P.getMeterToDEM(O),de=Math.floor(.5*(Z*ae-1)),be=Math.floor(.5*(le*ae-1)),_e=P.tileCoordToPixel(F,q),$e=2*de+1,je=2*be+1,it=function(Ct,Qe,Dt,dn,Ut){return[Ct.getElevationAtPixel(Qe,Dt,!0),Ct.getElevationAtPixel(Qe+Ut,Dt,!0),Ct.getElevationAtPixel(Qe,Dt+Ut,!0),Ct.getElevationAtPixel(Qe+dn,Dt+Ut,!0)]}(P,_e.x-de,_e.y-be,$e,je),St=Math.abs(it[0]-it[1]),Ke=Math.abs(it[2]-it[3]),ut=Math.abs(it[0]-it[2])+Math.abs(it[1]-it[3]),dt=Math.min(.25,.5*ae*(St+Ke)/$e),vt=Math.min(.25,.5*ae*ut/je);return ge+Math.max(dt*Z,vt*le)}(c,d,y):b;return{base:b+(i===0)?-1:i,top:E?Math.max(A+a,b+i+2):b+a}}const zC=Gt([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:LC}=zC,RC=Gt([{name:"a_packed",components:4,type:"Float32"}]),{members:DC}=RC,OC=ip.types,BC=Math.cos(Math.PI/180*37.5);class sp{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.id),this.index=e.index,this.projection=e.projection,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(i=>{this.gradients[i.id]={}}),this.layoutVertexArray=new Pr,this.layoutVertexArray2=new $r,this.indexArray=new pr,this.programConfigurations=new El(e.layers,e.zoom),this.segments=new Hi,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id)}populate(e,i,a,c){this.hasPattern=Yg("line",this.layers,i);const d=this.layers[0].layout.get("line-sort-key"),g=[];for(const{feature:A,id:P,index:z,sourceLayerIndex:O}of e){const F=this.layers[0]._featureFilter.needGeometry,q=Tl(A,F);if(!this.layers[0]._featureFilter.filter(new Le(this.zoom),q,a))continue;const Z=d?d.evaluate(q,{},a):void 0,le={id:P,properties:A.properties,type:A.type,sourceLayerIndex:O,index:z,geometry:F?q.geometry:Rs(A,a,c),patterns:{},sortKey:Z};g.push(le)}d&&g.sort((A,P)=>A.sortKey-P.sortKey);const{lineAtlas:y,featureIndex:b}=i,E=this.addConstantDashes(y);for(const A of g){const{geometry:P,index:z,sourceLayerIndex:O}=A;if(E&&this.addFeatureDashes(A,y),this.hasPattern){const F=Qg("line",this.layers,A,this.zoom,i);this.patternFeatures.push(F)}else this.addFeature(A,P,z,a,y.positions,i.availableImages);b.insert(e[z].feature,P,z,O,this.index)}}addConstantDashes(e){let i=!1;for(const a of this.layers){const c=a.paint.get("line-dasharray").value,d=a.layout.get("line-cap").value;if(c.kind!=="constant"||d.kind!=="constant")i=!0;else{const g=d.value,y=c.value;if(!y)continue;e.addDash(y,g)}}return i}addFeatureDashes(e,i){const a=this.zoom;for(const c of this.layers){const d=c.paint.get("line-dasharray").value,g=c.layout.get("line-cap").value;if(d.kind==="constant"&&g.kind==="constant")continue;let y,b;if(d.kind==="constant"){if(y=d.value,!y)continue}else y=d.evaluate({zoom:a},e);b=g.kind==="constant"?g.value:g.evaluate({zoom:a},e),i.addDash(y,b),e.patterns[c.id]=i.getKey(y,b)}}update(e,i,a,c){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,i,this.stateDependentLayers,a,c)}addFeatures(e,i,a,c,d){for(const g of this.patternFeatures)this.addFeature(g,g.geometry,g.index,i,a,c)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,DC)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,LC),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&e.properties.hasOwnProperty("mapbox_clip_start")&&e.properties.hasOwnProperty("mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,i,a,c,d,g){const y=this.layers[0].layout,b=y.get("line-join").evaluate(e,{}),E=y.get("line-cap").evaluate(e,{}),A=y.get("line-miter-limit"),P=y.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(const z of i)this.addLine(z,e,b,E,A,P);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,a,d,g,c)}addLine(e,i,a,c,d,g){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let le=0;le<e.length-1;le++)this.totalDistance+=e[le].dist(e[le+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const y=OC[i.type]==="Polygon";let b=e.length;for(;b>=2&&e[b-1].equals(e[b-2]);)b--;let E=0;for(;E<b-1&&e[E].equals(e[E+1]);)E++;if(b<(y?3:2))return;a==="bevel"&&(d=1.05);const A=this.overscaling<=16?122880/(512*this.overscaling):0,P=this.segments.prepareSegment(10*b,this.layoutVertexArray,this.indexArray);let z,O,F,q,Z;this.e1=this.e2=-1,y&&(z=e[b-2],Z=e[E].sub(z)._unit()._perp());for(let le=E;le<b;le++){if(F=le===b-1?y?e[E+1]:void 0:e[le+1],F&&e[le].equals(F))continue;Z&&(q=Z),z&&(O=z),z=e[le],Z=F?F.sub(z)._unit()._perp():q,q=q||Z;let ge=q.add(Z);ge.x===0&&ge.y===0||ge._unit();const ae=q.x*Z.x+q.y*Z.y,de=ge.x*Z.x+ge.y*Z.y,be=de!==0?1/de:1/0,_e=2*Math.sqrt(2-2*de),$e=de<BC&&O&&F,je=q.x*Z.y-q.y*Z.x>0;if($e&&le>E){const Ke=z.dist(O);if(Ke>2*A){const ut=z.sub(z.sub(O)._mult(A/Ke)._round());this.updateDistance(O,ut),this.addCurrentVertex(ut,q,0,0,P),O=ut}}const it=O&&F;let St=it?a:y?"butt":c;if(it&&St==="round"&&(be<g?St="miter":be<=2&&(St="fakeround")),St==="miter"&&be>d&&(St="bevel"),St==="bevel"&&(be>2&&(St="flipbevel"),be<d&&(St="miter")),O&&this.updateDistance(O,z),St==="miter")ge._mult(be),this.addCurrentVertex(z,ge,0,0,P);else if(St==="flipbevel"){if(be>100)ge=Z.mult(-1);else{const Ke=be*q.add(Z).mag()/q.sub(Z).mag();ge._perp()._mult(Ke*(je?-1:1))}this.addCurrentVertex(z,ge,0,0,P),this.addCurrentVertex(z,ge.mult(-1),0,0,P)}else if(St==="bevel"||St==="fakeround"){const Ke=-Math.sqrt(be*be-1),ut=je?Ke:0,dt=je?0:Ke;if(O&&this.addCurrentVertex(z,q,ut,dt,P),St==="fakeround"){const vt=Math.round(180*_e/Math.PI/20);for(let Ct=1;Ct<vt;Ct++){let Qe=Ct/vt;if(Qe!==.5){const dn=Qe-.5;Qe+=Qe*dn*(Qe-1)*((1.0904+ae*(ae*(3.55645-1.43519*ae)-3.2452))*dn*dn+(.848013+ae*(.215638*ae-1.06021)))}const Dt=Z.sub(q)._mult(Qe)._add(q)._unit()._mult(je?-1:1);this.addHalfVertex(z,Dt.x,Dt.y,!1,je,0,P)}}F&&this.addCurrentVertex(z,Z,-ut,-dt,P)}else if(St==="butt")this.addCurrentVertex(z,ge,0,0,P);else if(St==="square"){const Ke=O?1:-1;O||this.addCurrentVertex(z,ge,Ke,Ke,P),this.addCurrentVertex(z,ge,0,0,P),O&&this.addCurrentVertex(z,ge,Ke,Ke,P)}else St==="round"&&(O&&(this.addCurrentVertex(z,q,0,0,P),this.addCurrentVertex(z,q,1,1,P,!0)),F&&(this.addCurrentVertex(z,Z,-1,-1,P,!0),this.addCurrentVertex(z,Z,0,0,P)));if($e&&le<b-1){const Ke=z.dist(F);if(Ke>2*A){const ut=z.add(F.sub(z)._mult(A/Ke)._round());this.updateDistance(z,ut),this.addCurrentVertex(ut,Z,0,0,P),z=ut}}}}addCurrentVertex(e,i,a,c,d,g=!1){const y=i.y*c-i.x,b=-i.y-i.x*c;this.addHalfVertex(e,i.x+i.y*a,i.y-i.x*a,g,!1,a,d),this.addHalfVertex(e,y,b,g,!0,-c,d)}addHalfVertex({x:e,y:i},a,c,d,g,y,b){this.layoutVertexArray.emplaceBack((e<<1)+(d?1:0),(i<<1)+(g?1:0),Math.round(63*a)+128,Math.round(63*c)+128,1+(y===0?0:y<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);const E=b.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,E),b.primitiveLength++),g?this.e2=E:this.e1=E}updateScaledDistance(){if(this.lineClips){const e=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=e*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(e,i){this.distance+=e.dist(i),this.updateScaledDistance()}}Zt(sp,"LineBucket",{omit:["layers","patternFeatures"]});const FC=new ln({"line-cap":new We(tt.layout_line["line-cap"]),"line-join":new We(tt.layout_line["line-join"]),"line-miter-limit":new De(tt.layout_line["line-miter-limit"]),"line-round-limit":new De(tt.layout_line["line-round-limit"]),"line-sort-key":new We(tt.layout_line["line-sort-key"])});var nx={paint:new ln({"line-opacity":new We(tt.paint_line["line-opacity"]),"line-color":new We(tt.paint_line["line-color"]),"line-translate":new De(tt.paint_line["line-translate"]),"line-translate-anchor":new De(tt.paint_line["line-translate-anchor"]),"line-width":new We(tt.paint_line["line-width"]),"line-gap-width":new We(tt.paint_line["line-gap-width"]),"line-offset":new We(tt.paint_line["line-offset"]),"line-blur":new We(tt.paint_line["line-blur"]),"line-dasharray":new We(tt.paint_line["line-dasharray"]),"line-pattern":new We(tt.paint_line["line-pattern"]),"line-gradient":new Qt(tt.paint_line["line-gradient"]),"line-trim-offset":new De(tt.paint_line["line-trim-offset"])}),layout:FC};const ix=new class extends We{possiblyEvaluate(n,e){return e=new Le(Math.floor(e.zoom),{now:e.now,fadeDuration:e.fadeDuration,transition:e.transition}),super.possiblyEvaluate(n,e)}evaluate(n,e,i,a){return e=Ve({},e,{zoom:Math.floor(e.zoom)}),super.evaluate(n,e,i,a)}}(nx.paint.properties["line-width"].specification);function rx(n,e){return e>0?e+2*n:n}ix.useIntegerZoom=!0;const NC=Gt([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),VC=Gt([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),UC=Gt([{name:"a_projected_pos",components:4,type:"Float32"}],4);Gt([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const qC=Gt([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),jC=Gt([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"}]);Gt([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const ox=Gt([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),$C=Gt([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);Gt([{name:"triangle",components:3,type:"Uint16"}]),Gt([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),Gt([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),Gt([{type:"Float32",name:"offsetX"}]),Gt([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var gr=24;const cs=128;function e_(n,e){const{expression:i}=e;if(i.kind==="constant")return{kind:"constant",layoutSize:i.evaluate(new Le(n+1))};if(i.kind==="source")return{kind:"source"};{const{zoomStops:a,interpolationType:c}=i;let d=0;for(;d<a.length&&a[d]<=n;)d++;d=Math.max(0,d-1);let g=d;for(;g<a.length&&a[g]<n+1;)g++;g=Math.min(a.length-1,g);const y=a[d],b=a[g];return i.kind==="composite"?{kind:"composite",minZoom:y,maxZoom:b,interpolationType:c}:{kind:"camera",minZoom:y,maxZoom:b,minSize:i.evaluate(new Le(y)),maxSize:i.evaluate(new Le(b)),interpolationType:c}}}function ap(n,{uSize:e,uSizeT:i},{lowerSize:a,upperSize:c}){return n.kind==="source"?a/cs:n.kind==="composite"?$n(a/cs,c/cs,i):e}function Gc(n,e){let i=0,a=0;if(n.kind==="constant")a=n.layoutSize;else if(n.kind!=="source"){const{interpolationType:c,minZoom:d,maxZoom:g}=n,y=c?lt(mo.interpolationFactor(c,e,d,g),0,1):0;n.kind==="camera"?a=$n(n.minSize,n.maxSize,y):i=y}return{uSizeT:i,uSize:a}}var GC=Object.freeze({__proto__:null,getSizeData:e_,evaluateSizeForFeature:ap,evaluateSizeForZoom:Gc,SIZE_PACK_FACTOR:cs});function ZC(n,e,i){return n.sections.forEach(a=>{a.text=function(c,d,g){const y=d.layout.get("text-transform").evaluate(g,{});return y==="uppercase"?c=c.toLocaleUpperCase():y==="lowercase"&&(c=c.toLocaleLowerCase()),qe.applyArabicShaping&&(c=qe.applyArabicShaping(c)),c}(a.text,e,i)}),n}const Zh={"!":"\uFE15","#":"\uFF03",$:"\uFF04","%":"\uFF05","&":"\uFF06","(":"\uFE35",")":"\uFE36","*":"\uFF0A","+":"\uFF0B",",":"\uFE10","-":"\uFE32",".":"\u30FB","/":"\uFF0F",":":"\uFE13",";":"\uFE14","<":"\uFE3F","=":"\uFF1D",">":"\uFE40","?":"\uFE16","@":"\uFF20","[":"\uFE47","\\":"\uFF3C","]":"\uFE48","^":"\uFF3E",_:"\uFE33","`":"\uFF40","{":"\uFE37","|":"\u2015","}":"\uFE38","~":"\uFF5E","\xA2":"\uFFE0","\xA3":"\uFFE1","\xA5":"\uFFE5","\xA6":"\uFFE4","\xAC":"\uFFE2","\xAF":"\uFFE3","\u2013":"\uFE32","\u2014":"\uFE31","\u2018":"\uFE43","\u2019":"\uFE44","\u201C":"\uFE41","\u201D":"\uFE42","\u2026":"\uFE19","\u2027":"\u30FB","\u20A9":"\uFFE6","\u3001":"\uFE11","\u3002":"\uFE12","\u3008":"\uFE3F","\u3009":"\uFE40","\u300A":"\uFE3D","\u300B":"\uFE3E","\u300C":"\uFE41","\u300D":"\uFE42","\u300E":"\uFE43","\u300F":"\uFE44","\u3010":"\uFE3B","\u3011":"\uFE3C","\u3014":"\uFE39","\u3015":"\uFE3A","\u3016":"\uFE17","\u3017":"\uFE18","\uFF01":"\uFE15","\uFF08":"\uFE35","\uFF09":"\uFE36","\uFF0C":"\uFE10","\uFF0D":"\uFE32","\uFF0E":"\u30FB","\uFF1A":"\uFE13","\uFF1B":"\uFE14","\uFF1C":"\uFE3F","\uFF1E":"\uFE40","\uFF1F":"\uFE16","\uFF3B":"\uFE47","\uFF3D":"\uFE48","\uFF3F":"\uFE33","\uFF5B":"\uFE37","\uFF5C":"\u2015","\uFF5D":"\uFE38","\uFF5F":"\uFE35","\uFF60":"\uFE36","\uFF61":"\uFE12","\uFF62":"\uFE41","\uFF63":"\uFE42"};function HC(n){return n==="\uFE36"||n==="\uFE48"||n==="\uFE38"||n==="\uFE44"||n==="\uFE42"||n==="\uFE3E"||n==="\uFE3C"||n==="\uFE3A"||n==="\uFE18"||n==="\uFE40"||n==="\uFE10"||n==="\uFE13"||n==="\uFE14"||n==="\uFF40"||n==="\uFFE3"||n==="\uFE11"||n==="\uFE12"}function WC(n){return n==="\uFE35"||n==="\uFE47"||n==="\uFE37"||n==="\uFE43"||n==="\uFE41"||n==="\uFE3D"||n==="\uFE3B"||n==="\uFE39"||n==="\uFE17"||n==="\uFE3F"}var Hh=fi,sx=function(n,e,i,a,c){var d,g,y=8*c-a-1,b=(1<<y)-1,E=b>>1,A=-7,P=i?c-1:0,z=i?-1:1,O=n[e+P];for(P+=z,d=O&(1<<-A)-1,O>>=-A,A+=y;A>0;d=256*d+n[e+P],P+=z,A-=8);for(g=d&(1<<-A)-1,d>>=-A,A+=a;A>0;g=256*g+n[e+P],P+=z,A-=8);if(d===0)d=1-E;else{if(d===b)return g?NaN:1/0*(O?-1:1);g+=Math.pow(2,a),d-=E}return(O?-1:1)*g*Math.pow(2,d-a)},ax=function(n,e,i,a,c,d){var g,y,b,E=8*d-c-1,A=(1<<E)-1,P=A>>1,z=c===23?Math.pow(2,-24)-Math.pow(2,-77):0,O=a?0:d-1,F=a?1:-1,q=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(y=isNaN(e)?1:0,g=A):(g=Math.floor(Math.log(e)/Math.LN2),e*(b=Math.pow(2,-g))<1&&(g--,b*=2),(e+=g+P>=1?z/b:z*Math.pow(2,1-P))*b>=2&&(g++,b/=2),g+P>=A?(y=0,g=A):g+P>=1?(y=(e*b-1)*Math.pow(2,c),g+=P):(y=e*Math.pow(2,P-1)*Math.pow(2,c),g=0));c>=8;n[i+O]=255&y,O+=F,y/=256,c-=8);for(g=g<<c|y,E+=c;E>0;n[i+O]=255&g,O+=F,g/=256,E-=8);n[i+O-F]|=128*q};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */function fi(n){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(n)?n:new Uint8Array(n||0),this.pos=0,this.type=0,this.length=this.buf.length}fi.Varint=0,fi.Fixed64=1,fi.Bytes=2,fi.Fixed32=5;var t_=4294967296,lx=1/t_,cx=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function Bs(n){return n.type===fi.Bytes?n.readVarint()+n.pos:n.pos+1}function Zc(n,e,i){return i?4294967296*e+(n>>>0):4294967296*(e>>>0)+(n>>>0)}function ux(n,e,i){var a=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));i.realloc(a);for(var c=i.pos-1;c>=n;c--)i.buf[c+a]=i.buf[c]}function XC(n,e){for(var i=0;i<n.length;i++)e.writeVarint(n[i])}function KC(n,e){for(var i=0;i<n.length;i++)e.writeSVarint(n[i])}function YC(n,e){for(var i=0;i<n.length;i++)e.writeFloat(n[i])}function QC(n,e){for(var i=0;i<n.length;i++)e.writeDouble(n[i])}function JC(n,e){for(var i=0;i<n.length;i++)e.writeBoolean(n[i])}function eA(n,e){for(var i=0;i<n.length;i++)e.writeFixed32(n[i])}function tA(n,e){for(var i=0;i<n.length;i++)e.writeSFixed32(n[i])}function nA(n,e){for(var i=0;i<n.length;i++)e.writeFixed64(n[i])}function iA(n,e){for(var i=0;i<n.length;i++)e.writeSFixed64(n[i])}function lp(n,e){return(n[e]|n[e+1]<<8|n[e+2]<<16)+16777216*n[e+3]}function Hc(n,e,i){n[i]=e,n[i+1]=e>>>8,n[i+2]=e>>>16,n[i+3]=e>>>24}function hx(n,e){return(n[e]|n[e+1]<<8|n[e+2]<<16)+(n[e+3]<<24)}function rA(n,e,i){e.glyphs=[],n===1&&i.readMessage(oA,e)}function oA(n,e,i){if(n===3){const{id:a,bitmap:c,width:d,height:g,left:y,top:b,advance:E}=i.readMessage(sA,{});e.glyphs.push({id:a,bitmap:new Os({width:d+6,height:g+6},c),metrics:{width:d,height:g,left:y,top:b,advance:E}})}else n===4?e.ascender=i.readSVarint():n===5&&(e.descender=i.readSVarint())}function sA(n,e,i){n===1?e.id=i.readVarint():n===2?e.bitmap=i.readBytes():n===3?e.width=i.readVarint():n===4?e.height=i.readVarint():n===5?e.left=i.readSVarint():n===6?e.top=i.readSVarint():n===7&&(e.advance=i.readVarint())}function n_(n){let e=0,i=0;for(const g of n)e+=g.w*g.h,i=Math.max(i,g.w);n.sort((g,y)=>y.h-g.h);const a=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),i),h:1/0}];let c=0,d=0;for(const g of n)for(let y=a.length-1;y>=0;y--){const b=a[y];if(!(g.w>b.w||g.h>b.h)){if(g.x=b.x,g.y=b.y,d=Math.max(d,g.y+g.h),c=Math.max(c,g.x+g.w),g.w===b.w&&g.h===b.h){const E=a.pop();y<a.length&&(a[y]=E)}else g.h===b.h?(b.x+=g.w,b.w-=g.w):g.w===b.w?(b.y+=g.h,b.h-=g.h):(a.push({x:b.x+g.w,y:b.y,w:b.w-g.w,h:g.h}),b.y+=g.h,b.h-=g.h);break}}return{w:c,h:d,fill:e/(c*d)||0}}fi.prototype={destroy:function(){this.buf=null},readFields:function(n,e,i){for(i=i||this.length;this.pos<i;){var a=this.readVarint(),c=a>>3,d=this.pos;this.type=7&a,n(c,e,this),this.pos===d&&this.skip(a)}return e},readMessage:function(n,e){return this.readFields(n,e,this.readVarint()+this.pos)},readFixed32:function(){var n=lp(this.buf,this.pos);return this.pos+=4,n},readSFixed32:function(){var n=hx(this.buf,this.pos);return this.pos+=4,n},readFixed64:function(){var n=lp(this.buf,this.pos)+lp(this.buf,this.pos+4)*t_;return this.pos+=8,n},readSFixed64:function(){var n=lp(this.buf,this.pos)+hx(this.buf,this.pos+4)*t_;return this.pos+=8,n},readFloat:function(){var n=sx(this.buf,this.pos,!0,23,4);return this.pos+=4,n},readDouble:function(){var n=sx(this.buf,this.pos,!0,52,8);return this.pos+=8,n},readVarint:function(n){var e,i,a=this.buf;return e=127&(i=a[this.pos++]),i<128?e:(e|=(127&(i=a[this.pos++]))<<7,i<128?e:(e|=(127&(i=a[this.pos++]))<<14,i<128?e:(e|=(127&(i=a[this.pos++]))<<21,i<128?e:function(c,d,g){var y,b,E=g.buf;if(y=(112&(b=E[g.pos++]))>>4,b<128||(y|=(127&(b=E[g.pos++]))<<3,b<128)||(y|=(127&(b=E[g.pos++]))<<10,b<128)||(y|=(127&(b=E[g.pos++]))<<17,b<128)||(y|=(127&(b=E[g.pos++]))<<24,b<128)||(y|=(1&(b=E[g.pos++]))<<31,b<128))return Zc(c,y,d);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(i=a[this.pos]))<<28,n,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var n=this.readVarint();return n%2==1?(n+1)/-2:n/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var n=this.readVarint()+this.pos,e=this.pos;return this.pos=n,n-e>=12&&cx?function(i,a,c){return cx.decode(i.subarray(a,c))}(this.buf,e,n):function(i,a,c){for(var d="",g=a;g<c;){var y,b,E,A=i[g],P=null,z=A>239?4:A>223?3:A>191?2:1;if(g+z>c)break;z===1?A<128&&(P=A):z===2?(192&(y=i[g+1]))==128&&(P=(31&A)<<6|63&y)<=127&&(P=null):z===3?(b=i[g+2],(192&(y=i[g+1]))==128&&(192&b)==128&&((P=(15&A)<<12|(63&y)<<6|63&b)<=2047||P>=55296&&P<=57343)&&(P=null)):z===4&&(b=i[g+2],E=i[g+3],(192&(y=i[g+1]))==128&&(192&b)==128&&(192&E)==128&&((P=(15&A)<<18|(63&y)<<12|(63&b)<<6|63&E)<=65535||P>=1114112)&&(P=null)),P===null?(P=65533,z=1):P>65535&&(P-=65536,d+=String.fromCharCode(P>>>10&1023|55296),P=56320|1023&P),d+=String.fromCharCode(P),g+=z}return d}(this.buf,e,n)},readBytes:function(){var n=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,n);return this.pos=n,e},readPackedVarint:function(n,e){if(this.type!==fi.Bytes)return n.push(this.readVarint(e));var i=Bs(this);for(n=n||[];this.pos<i;)n.push(this.readVarint(e));return n},readPackedSVarint:function(n){if(this.type!==fi.Bytes)return n.push(this.readSVarint());var e=Bs(this);for(n=n||[];this.pos<e;)n.push(this.readSVarint());return n},readPackedBoolean:function(n){if(this.type!==fi.Bytes)return n.push(this.readBoolean());var e=Bs(this);for(n=n||[];this.pos<e;)n.push(this.readBoolean());return n},readPackedFloat:function(n){if(this.type!==fi.Bytes)return n.push(this.readFloat());var e=Bs(this);for(n=n||[];this.pos<e;)n.push(this.readFloat());return n},readPackedDouble:function(n){if(this.type!==fi.Bytes)return n.push(this.readDouble());var e=Bs(this);for(n=n||[];this.pos<e;)n.push(this.readDouble());return n},readPackedFixed32:function(n){if(this.type!==fi.Bytes)return n.push(this.readFixed32());var e=Bs(this);for(n=n||[];this.pos<e;)n.push(this.readFixed32());return n},readPackedSFixed32:function(n){if(this.type!==fi.Bytes)return n.push(this.readSFixed32());var e=Bs(this);for(n=n||[];this.pos<e;)n.push(this.readSFixed32());return n},readPackedFixed64:function(n){if(this.type!==fi.Bytes)return n.push(this.readFixed64());var e=Bs(this);for(n=n||[];this.pos<e;)n.push(this.readFixed64());return n},readPackedSFixed64:function(n){if(this.type!==fi.Bytes)return n.push(this.readSFixed64());var e=Bs(this);for(n=n||[];this.pos<e;)n.push(this.readSFixed64());return n},skip:function(n){var e=7&n;if(e===fi.Varint)for(;this.buf[this.pos++]>127;);else if(e===fi.Bytes)this.pos=this.readVarint()+this.pos;else if(e===fi.Fixed32)this.pos+=4;else{if(e!==fi.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(n,e){this.writeVarint(n<<3|e)},realloc:function(n){for(var e=this.length||16;e<this.pos+n;)e*=2;if(e!==this.length){var i=new Uint8Array(e);i.set(this.buf),this.buf=i,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(n){this.realloc(4),Hc(this.buf,n,this.pos),this.pos+=4},writeSFixed32:function(n){this.realloc(4),Hc(this.buf,n,this.pos),this.pos+=4},writeFixed64:function(n){this.realloc(8),Hc(this.buf,-1&n,this.pos),Hc(this.buf,Math.floor(n*lx),this.pos+4),this.pos+=8},writeSFixed64:function(n){this.realloc(8),Hc(this.buf,-1&n,this.pos),Hc(this.buf,Math.floor(n*lx),this.pos+4),this.pos+=8},writeVarint:function(n){(n=+n||0)>268435455||n<0?function(e,i){var a,c;if(e>=0?(a=e%4294967296|0,c=e/4294967296|0):(c=~(-e/4294967296),4294967295^(a=~(-e%4294967296))?a=a+1|0:(a=0,c=c+1|0)),e>=18446744073709552e3||e<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");i.realloc(10),function(d,g,y){y.buf[y.pos++]=127&d|128,d>>>=7,y.buf[y.pos++]=127&d|128,d>>>=7,y.buf[y.pos++]=127&d|128,d>>>=7,y.buf[y.pos++]=127&d|128,y.buf[y.pos]=127&(d>>>=7)}(a,0,i),function(d,g){var y=(7&d)<<4;g.buf[g.pos++]|=y|((d>>>=3)?128:0),d&&(g.buf[g.pos++]=127&d|((d>>>=7)?128:0),d&&(g.buf[g.pos++]=127&d|((d>>>=7)?128:0),d&&(g.buf[g.pos++]=127&d|((d>>>=7)?128:0),d&&(g.buf[g.pos++]=127&d|((d>>>=7)?128:0),d&&(g.buf[g.pos++]=127&d)))))}(c,i)}(n,this):(this.realloc(4),this.buf[this.pos++]=127&n|(n>127?128:0),n<=127||(this.buf[this.pos++]=127&(n>>>=7)|(n>127?128:0),n<=127||(this.buf[this.pos++]=127&(n>>>=7)|(n>127?128:0),n<=127||(this.buf[this.pos++]=n>>>7&127))))},writeSVarint:function(n){this.writeVarint(n<0?2*-n-1:2*n)},writeBoolean:function(n){this.writeVarint(Boolean(n))},writeString:function(n){n=String(n),this.realloc(4*n.length),this.pos++;var e=this.pos;this.pos=function(a,c,d){for(var g,y,b=0;b<c.length;b++){if((g=c.charCodeAt(b))>55295&&g<57344){if(!y){g>56319||b+1===c.length?(a[d++]=239,a[d++]=191,a[d++]=189):y=g;continue}if(g<56320){a[d++]=239,a[d++]=191,a[d++]=189,y=g;continue}g=y-55296<<10|g-56320|65536,y=null}else y&&(a[d++]=239,a[d++]=191,a[d++]=189,y=null);g<128?a[d++]=g:(g<2048?a[d++]=g>>6|192:(g<65536?a[d++]=g>>12|224:(a[d++]=g>>18|240,a[d++]=g>>12&63|128),a[d++]=g>>6&63|128),a[d++]=63&g|128)}return d}(this.buf,n,this.pos);var i=this.pos-e;i>=128&&ux(e,i,this),this.pos=e-1,this.writeVarint(i),this.pos+=i},writeFloat:function(n){this.realloc(4),ax(this.buf,n,this.pos,!0,23,4),this.pos+=4},writeDouble:function(n){this.realloc(8),ax(this.buf,n,this.pos,!0,52,8),this.pos+=8},writeBytes:function(n){var e=n.length;this.writeVarint(e),this.realloc(e);for(var i=0;i<e;i++)this.buf[this.pos++]=n[i]},writeRawMessage:function(n,e){this.pos++;var i=this.pos;n(e,this);var a=this.pos-i;a>=128&&ux(i,a,this),this.pos=i-1,this.writeVarint(a),this.pos+=a},writeMessage:function(n,e,i){this.writeTag(n,fi.Bytes),this.writeRawMessage(e,i)},writePackedVarint:function(n,e){e.length&&this.writeMessage(n,XC,e)},writePackedSVarint:function(n,e){e.length&&this.writeMessage(n,KC,e)},writePackedBoolean:function(n,e){e.length&&this.writeMessage(n,JC,e)},writePackedFloat:function(n,e){e.length&&this.writeMessage(n,YC,e)},writePackedDouble:function(n,e){e.length&&this.writeMessage(n,QC,e)},writePackedFixed32:function(n,e){e.length&&this.writeMessage(n,eA,e)},writePackedSFixed32:function(n,e){e.length&&this.writeMessage(n,tA,e)},writePackedFixed64:function(n,e){e.length&&this.writeMessage(n,nA,e)},writePackedSFixed64:function(n,e){e.length&&this.writeMessage(n,iA,e)},writeBytesField:function(n,e){this.writeTag(n,fi.Bytes),this.writeBytes(e)},writeFixed32Field:function(n,e){this.writeTag(n,fi.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(n,e){this.writeTag(n,fi.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(n,e){this.writeTag(n,fi.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(n,e){this.writeTag(n,fi.Fixed64),this.writeSFixed64(e)},writeVarintField:function(n,e){this.writeTag(n,fi.Varint),this.writeVarint(e)},writeSVarintField:function(n,e){this.writeTag(n,fi.Varint),this.writeSVarint(e)},writeStringField:function(n,e){this.writeTag(n,fi.Bytes),this.writeString(e)},writeFloatField:function(n,e){this.writeTag(n,fi.Fixed32),this.writeFloat(e)},writeDoubleField:function(n,e){this.writeTag(n,fi.Fixed64),this.writeDouble(e)},writeBooleanField:function(n,e){this.writeVarintField(n,Boolean(e))}};class i_{constructor(e,{pixelRatio:i,version:a,stretchX:c,stretchY:d,content:g}){this.paddedRect=e,this.pixelRatio=i,this.stretchX=c,this.stretchY=d,this.content=g,this.version=a}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class dx{constructor(e,i){const a={},c={};this.haveRenderCallbacks=[];const d=[];this.addImages(e,a,d),this.addImages(i,c,d);const{w:g,h:y}=n_(d),b=new Qr({width:g||1,height:y||1});for(const E in e){const A=e[E],P=a[E].paddedRect;Qr.copy(A.data,b,{x:0,y:0},{x:P.x+1,y:P.y+1},A.data)}for(const E in i){const A=i[E],P=c[E].paddedRect,z=P.x+1,O=P.y+1,F=A.data.width,q=A.data.height;Qr.copy(A.data,b,{x:0,y:0},{x:z,y:O},A.data),Qr.copy(A.data,b,{x:0,y:q-1},{x:z,y:O-1},{width:F,height:1}),Qr.copy(A.data,b,{x:0,y:0},{x:z,y:O+q},{width:F,height:1}),Qr.copy(A.data,b,{x:F-1,y:0},{x:z-1,y:O},{width:1,height:q}),Qr.copy(A.data,b,{x:0,y:0},{x:z+F,y:O},{width:1,height:q})}this.image=b,this.iconPositions=a,this.patternPositions=c}addImages(e,i,a){for(const c in e){const d=e[c],g={x:0,y:0,w:d.data.width+2,h:d.data.height+2};a.push(g),i[c]=new i_(g,d),d.hasRenderCallback&&this.haveRenderCallbacks.push(c)}}patchUpdatedImages(e,i){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(a=>e.hasImage(a)),e.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const a in e.updatedImages)this.patchUpdatedImage(this.iconPositions[a],e.getImage(a),i),this.patchUpdatedImage(this.patternPositions[a],e.getImage(a),i)}patchUpdatedImage(e,i,a){if(!e||!i||e.version===i.version)return;e.version=i.version;const[c,d]=e.tl;a.update(i.data,void 0,{x:c,y:d})}}Zt(i_,"ImagePosition"),Zt(dx,"ImageAtlas");const uo={horizontal:1,vertical:2,horizontalOnly:3};class Wh{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(e,i){const a=new Wh;return a.scale=e||1,a.fontStack=i,a}static forImage(e){const i=new Wh;return i.imageName=e,i}}class Wc{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,i){const a=new Wc;for(let c=0;c<e.sections.length;c++){const d=e.sections[c];d.image?a.addImageSection(d):a.addTextSection(d,i)}return a}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSections(){return this.sections}getSectionIndex(e){return this.sectionIndex[e]}getCharCode(e){return this.text.charCodeAt(e)}verticalizePunctuation(e){this.text=function(i,a){let c="";for(let d=0;d<i.length;d++){const g=i.charCodeAt(d+1)||null,y=i.charCodeAt(d-1)||null;c+=!a&&(g&&L(g)&&!Zh[i[d+1]]||y&&L(y)&&!Zh[i[d-1]])||!Zh[i[d]]?i[d]:Zh[i[d]]}return c}(this.text,e)}trim(){let e=0;for(let a=0;a<this.text.length&&cp[this.text.charCodeAt(a)];a++)e++;let i=this.text.length;for(let a=this.text.length-1;a>=0&&a>=e&&cp[this.text.charCodeAt(a)];a--)i--;this.text=this.text.substring(e,i),this.sectionIndex=this.sectionIndex.slice(e,i)}substring(e,i){const a=new Wc;return a.text=this.text.substring(e,i),a.sectionIndex=this.sectionIndex.slice(e,i),a.sections=this.sections,a}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,i)=>Math.max(e,this.sections[i].scale),0)}addTextSection(e,i){this.text+=e.text,this.sections.push(Wh.forText(e.scale,e.fontStack||i));const a=this.sections.length-1;for(let c=0;c<e.text.length;++c)this.sectionIndex.push(a)}addImageSection(e){const i=e.image?e.image.name:"";if(i.length===0)return void re("Can't add FormattedSection with an empty image.");const a=this.getNextImageSectionCharCode();a?(this.text+=String.fromCharCode(a),this.sections.push(Wh.forImage(i)),this.sectionIndex.push(this.sections.length-1)):re("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function r_(n,e,i,a,c,d,g,y,b,E,A,P,z,O,F){const q=Wc.fromFeature(n,c);P===uo.vertical&&q.verticalizePunctuation(z);let Z=[];const le=function(_e,$e,je,it,St,Ke){if(!_e)return[];const ut=[],dt=function(Dt,dn,Ut,en,Ot,pn){let Rn=0;for(let Pn=0;Pn<Dt.length();Pn++){const An=Dt.getSection(Pn);Rn+=fx(Dt.getCharCode(Pn),An,en,Ot,dn,pn)}return Rn/Math.max(1,Math.ceil(Rn/Ut))}(_e,$e,je,it,St,Ke),vt=_e.text.indexOf("\u200B")>=0;let Ct=0;for(let Dt=0;Dt<_e.length();Dt++){const dn=_e.getSection(Dt),Ut=_e.getCharCode(Dt);if(cp[Ut]||(Ct+=fx(Ut,dn,it,St,$e,Ke)),Dt<_e.length()-1){const en=!((Qe=Ut)<11904||!(Sh(Qe)||zf(Qe)||l(Qe)||xl(Qe)||Of(Qe)||wh(Qe)||Lf(Qe)||ga(Qe)||Bf(Qe)||Ch(Qe)||Df(Qe)||x(Qe)||vl(Qe)||Th(Qe)||Eh(Qe)||Rf(Qe)||Oc(Qe)||r(Qe)||Nf(Qe)||Ff(Qe)));(aA[Ut]||en||dn.imageName)&&ut.push(mx(Dt+1,Ct,dt,ut,lA(Ut,_e.getCharCode(Dt+1),en&&vt),!1))}}var Qe;return gx(mx(_e.length(),Ct,dt,ut,0,!0))}(q,E,d,e,a,O),{processBidirectionalText:ge,processStyledBidirectionalText:ae}=qe;if(ge&&q.sections.length===1){const _e=ge(q.toString(),le);for(const $e of _e){const je=new Wc;je.text=$e,je.sections=q.sections;for(let it=0;it<$e.length;it++)je.sectionIndex.push(0);Z.push(je)}}else if(ae){const _e=ae(q.text,q.sectionIndex,le);for(const $e of _e){const je=new Wc;je.text=$e[0],je.sectionIndex=$e[1],je.sections=q.sections,Z.push(je)}}else Z=function(_e,$e){const je=[],it=_e.text;let St=0;for(const Ke of $e)je.push(_e.substring(St,Ke)),St=Ke;return St<it.length&&je.push(_e.substring(St,it.length)),je}(q,le);const de=[],be={positionedLines:de,text:q.toString(),top:A[1],bottom:A[1],left:A[0],right:A[0],writingMode:P,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(_e,$e,je,it,St,Ke,ut,dt,vt,Ct,Qe,Dt){let dn=0,Ut=0,en=0;const Ot=dt==="right"?1:dt==="left"?0:.5;let pn=!1;for(const wn of St){const Dn=wn.getSections();for(const ri of Dn){if(ri.imageName)continue;const _i=$e[ri.fontStack];if(_i&&(pn=_i.ascender!==void 0&&_i.descender!==void 0,!pn))break}if(!pn)break}let Rn=0;for(const wn of St){wn.trim();const Dn=wn.getMaxScale(),ri=(Dn-1)*gr,_i={positionedGlyphs:[],lineOffset:0};_e.positionedLines[Rn]=_i;const pi=_i.positionedGlyphs;let yi=0;if(!wn.length()){Ut+=Ke,++Rn;continue}let vi=0,Pi=0;for(let ni=0;ni<wn.length();ni++){const Wi=wn.getSection(ni),Ni=wn.getSectionIndex(ni),Zn=wn.getCharCode(ni);let Si=Wi.scale,Yi=null,oi=null,Oi=null,Tr=gr,sr=0;const ar=!(vt===uo.horizontal||!Qe&&!R(Zn)||Qe&&(cp[Zn]||(Pn=Zn,xh(Pn)||Pf(Pn)||bh(Pn)||h(Pn)||_(Pn))));if(Wi.imageName){const Dr=it[Wi.imageName];if(!Dr)continue;Oi=Wi.imageName,_e.iconsInText=_e.iconsInText||!0,oi=Dr.paddedRect;const lr=Dr.displaySize;Si=Si*gr/Dt,Yi={width:lr[0],height:lr[1],left:1,top:-3,advance:ar?lr[1]:lr[0],localGlyph:!1},sr=pn?-Yi.height*Si:Dn*gr-17-lr[1]*Si,Tr=Yi.advance;const Vs=(ar?lr[0]:lr[1])*Si-gr*Dn;Vs>0&&Vs>yi&&(yi=Vs)}else{const Dr=je[Wi.fontStack];if(!Dr)continue;Dr[Zn]&&(oi=Dr[Zn]);const lr=$e[Wi.fontStack];if(!lr)continue;const Vs=lr.glyphs[Zn];if(!Vs)continue;if(Yi=Vs.metrics,Tr=Zn!==8203?gr:0,pn){const iu=lr.ascender!==void 0?Math.abs(lr.ascender):0,sd=lr.descender!==void 0?Math.abs(lr.descender):0,ad=(iu+sd)*Si;vi<ad&&(vi=ad,Pi=(iu-sd)/2*Si),sr=-iu*Si}else sr=(Dn-Si)*gr-17}ar?(_e.verticalizable=!0,pi.push({glyph:Zn,imageName:Oi,x:dn,y:Ut+sr,vertical:ar,scale:Si,localGlyph:Yi.localGlyph,fontStack:Wi.fontStack,sectionIndex:Ni,metrics:Yi,rect:oi}),dn+=Tr*Si+Ct):(pi.push({glyph:Zn,imageName:Oi,x:dn,y:Ut+sr,vertical:ar,scale:Si,localGlyph:Yi.localGlyph,fontStack:Wi.fontStack,sectionIndex:Ni,metrics:Yi,rect:oi}),dn+=Yi.advance*Si+Ct)}pi.length!==0&&(en=Math.max(dn-Ct,en),pn?_x(pi,Ot,yi,Pi,Ke*Dn/2):_x(pi,Ot,yi,0,Ke/2)),dn=0;const or=Ke*Dn+yi;_i.lineOffset=Math.max(yi,ri),Ut+=or,++Rn}var Pn;const An=Ut,{horizontalAlign:gn,verticalAlign:ti}=o_(ut);(function(wn,Dn,ri,_i,pi,yi){const vi=(Dn-ri)*pi,Pi=-yi*_i;for(const or of wn)for(const ni of or.positionedGlyphs)ni.x+=vi,ni.y+=Pi})(_e.positionedLines,Ot,gn,ti,en,An),_e.top+=-ti*An,_e.bottom=_e.top+An,_e.left+=-gn*en,_e.right=_e.left+en,_e.hasBaseline=pn}(be,e,i,a,Z,g,y,b,P,E,z,F),!function(_e){for(const $e of _e)if($e.positionedGlyphs.length!==0)return!1;return!0}(de)&&be}const cp={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},aA={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function fx(n,e,i,a,c,d){if(e.imageName){const g=a[e.imageName];return g?g.displaySize[0]*e.scale*gr/d+c:0}{const g=i[e.fontStack],y=g&&g.glyphs[n];return y?y.metrics.advance*e.scale+c:0}}function px(n,e,i,a){const c=Math.pow(n-e,2);return a?n<e?c/2:2*c:c+Math.abs(i)*i}function lA(n,e,i){let a=0;return n===10&&(a-=1e4),i&&(a+=150),n!==40&&n!==65288||(a+=50),e!==41&&e!==65289||(a+=50),a}function mx(n,e,i,a,c,d){let g=null,y=px(e,i,c,d);for(const b of a){const E=px(e-b.x,i,c,d)+b.badness;E<=y&&(g=b,y=E)}return{index:n,x:e,priorBreak:g,badness:y}}function gx(n){return n?gx(n.priorBreak).concat(n.index):[]}function o_(n){let e=.5,i=.5;switch(n){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(n){case"bottom":case"bottom-right":case"bottom-left":i=1;break;case"top":case"top-right":case"top-left":i=0}return{horizontalAlign:e,verticalAlign:i}}function _x(n,e,i,a,c){if(!(e||i||a||c))return;const d=n.length-1,g=n[d],y=(g.x+g.metrics.advance*g.scale)*e;for(let b=0;b<=d;b++)n[b].x-=y,n[b].y+=i+a+c}function cA(n,e,i){const{horizontalAlign:a,verticalAlign:c}=o_(i),d=e[0]-n.displaySize[0]*a,g=e[1]-n.displaySize[1]*c;return{image:n,top:g,bottom:g+n.displaySize[1],left:d,right:d+n.displaySize[0]}}function yx(n,e,i,a,c,d){const g=n.image;let y;if(g.content){const Z=g.content,le=g.pixelRatio||1;y=[Z[0]/le,Z[1]/le,g.displaySize[0]-Z[2]/le,g.displaySize[1]-Z[3]/le]}const b=e.left*d,E=e.right*d;let A,P,z,O;i==="width"||i==="both"?(O=c[0]+b-a[3],P=c[0]+E+a[1]):(O=c[0]+(b+E-g.displaySize[0])/2,P=O+g.displaySize[0]);const F=e.top*d,q=e.bottom*d;return i==="height"||i==="both"?(A=c[1]+F-a[0],z=c[1]+q+a[2]):(A=c[1]+(F+q-g.displaySize[1])/2,z=A+g.displaySize[1]),{image:g,top:A,right:P,bottom:z,left:O,collisionPadding:y}}class Fs extends ce{constructor(e,i,a,c,d){super(e,i),this.angle=c,this.z=a,d!==void 0&&(this.segment=d)}clone(){return new Fs(this.x,this.y,this.z,this.angle,this.segment)}}function vx(n,e,i,a,c){if(e.segment===void 0)return!0;let d=e,g=e.segment+1,y=0;for(;y>-i/2;){if(g--,g<0)return!1;y-=n[g].dist(d),d=n[g]}y+=n[g].dist(n[g+1]),g++;const b=[];let E=0;for(;y<i/2;){const A=n[g],P=n[g+1];if(!P)return!1;let z=n[g-1].angleTo(A)-A.angleTo(P);for(z=Math.abs((z+3*Math.PI)%(2*Math.PI)-Math.PI),b.push({distance:y,angleDelta:z}),E+=z;y-b[0].distance>a;)E-=b.shift().angleDelta;if(E>c)return!1;g++,y+=A.dist(P)}return!0}function xx(n){let e=0;for(let i=0;i<n.length-1;i++)e+=n[i].dist(n[i+1]);return e}function bx(n,e,i){return n?.6*e*i:0}function wx(n,e){return Math.max(n?n.right-n.left:0,e?e.right-e.left:0)}function uA(n,e,i,a,c,d){const g=bx(i,c,d),y=wx(i,a)*d;let b=0;const E=xx(n)/2;for(let A=0;A<n.length-1;A++){const P=n[A],z=n[A+1],O=P.dist(z);if(b+O>E){const F=(E-b)/O,q=$n(P.x,z.x,F),Z=$n(P.y,z.y,F),le=new Fs(q,Z,0,z.angleTo(P),A);return!g||vx(n,le,y,g,e)?le:void 0}b+=O}}function hA(n,e,i,a,c,d,g,y,b){const E=bx(a,d,g),A=wx(a,c),P=A*g,z=n[0].x===0||n[0].x===b||n[0].y===0||n[0].y===b;return e-P<e/4&&(e=P+e/4),Ex(n,z?e/2*y%e:(A/2+2*d)*g*y%e,e,E,i,P,z,!1,b)}function Ex(n,e,i,a,c,d,g,y,b){const E=d/2,A=xx(n);let P=0,z=e-i,O=[];for(let F=0;F<n.length-1;F++){const q=n[F],Z=n[F+1],le=q.dist(Z),ge=Z.angleTo(q);for(;z+i<P+le;){z+=i;const ae=(z-P)/le,de=$n(q.x,Z.x,ae),be=$n(q.y,Z.y,ae);if(de>=0&&de<b&&be>=0&&be<b&&z-E>=0&&z+E<=A){const _e=new Fs(de,be,0,ge,F);_e._round(),a&&!vx(n,_e,d,a,c)||O.push(_e)}}P+=le}return y||O.length||g||(O=Ex(n,P/2,i,a,c,d,g,!0,b)),O}function Tx(n,e,i,a,c){const d=[];for(let g=0;g<n.length;g++){const y=n[g];let b;for(let E=0;E<y.length-1;E++){let A=y[E],P=y[E+1];A.x<e&&P.x<e||(A.x<e?A=new ce(e,A.y+(e-A.x)/(P.x-A.x)*(P.y-A.y))._round():P.x<e&&(P=new ce(e,A.y+(e-A.x)/(P.x-A.x)*(P.y-A.y))._round()),A.y<i&&P.y<i||(A.y<i?A=new ce(A.x+(i-A.y)/(P.y-A.y)*(P.x-A.x),i)._round():P.y<i&&(P=new ce(A.x+(i-A.y)/(P.y-A.y)*(P.x-A.x),i)._round()),A.x>=a&&P.x>=a||(A.x>=a?A=new ce(a,A.y+(a-A.x)/(P.x-A.x)*(P.y-A.y))._round():P.x>=a&&(P=new ce(a,A.y+(a-A.x)/(P.x-A.x)*(P.y-A.y))._round()),A.y>=c&&P.y>=c||(A.y>=c?A=new ce(A.x+(c-A.y)/(P.y-A.y)*(P.x-A.x),c)._round():P.y>=c&&(P=new ce(A.x+(c-A.y)/(P.y-A.y)*(P.x-A.x),c)._round()),b&&A.equals(b[b.length-1])||(b=[A],d.push(b)),b.push(P)))))}}return d}Zt(Fs,"Anchor");const Xh=1e20;function Sx(n,e,i,a,c,d,g,y,b){for(let E=e;E<e+a;E++)Cx(n,i*d+E,d,c,g,y,b);for(let E=i;E<i+c;E++)Cx(n,E*d+e,1,a,g,y,b)}function Cx(n,e,i,a,c,d,g){d[0]=0,g[0]=-Xh,g[1]=Xh,c[0]=n[e];for(let y=1,b=0,E=0;y<a;y++){c[y]=n[e+y*i];const A=y*y;do{const P=d[b];E=(c[y]-c[P]+A-P*P)/(y-P)/2}while(E<=g[b]&&--b>-1);b++,d[b]=y,g[b]=E,g[b+1]=Xh}for(let y=0,b=0;y<a;y++){for(;g[b+1]<y;)b++;const E=d[b],A=y-E;n[e+y*i]=c[E]+A*A}}const s_={none:0,ideographs:1,all:2};class Xc{constructor(e,i,a){this.requestManager=e,this.localGlyphMode=i,this.localFontFamily=a,this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(e){this.url=e}getGlyphs(e,i){const a=[];for(const c in e)for(const d of e[c])a.push({stack:c,id:d});At(a,({stack:c,id:d},g)=>{let y=this.entries[c];y||(y=this.entries[c]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let b=y.glyphs[d];if(b!==void 0)return void g(null,{stack:c,id:d,glyph:b});if(b=this._tinySDF(y,c,d),b)return y.glyphs[d]=b,void g(null,{stack:c,id:d,glyph:b});const E=Math.floor(d/256);if(256*E>65535)return void g(new Error("glyphs > 65535 not supported"));if(y.ranges[E])return void g(null,{stack:c,id:d,glyph:b});let A=y.requests[E];A||(A=y.requests[E]=[],Xc.loadGlyphRange(c,E,this.url,this.requestManager,(P,z)=>{if(z){y.ascender=z.ascender,y.descender=z.descender;for(const O in z.glyphs)this._doesCharSupportLocalGlyph(+O)||(y.glyphs[+O]=z.glyphs[+O]);y.ranges[E]=!0}for(const O of A)O(P,z);delete y.requests[E]})),A.push((P,z)=>{P?g(P):z&&g(null,{stack:c,id:d,glyph:z.glyphs[d]||null})})},(c,d)=>{if(c)i(c);else if(d){const g={};for(const{stack:y,id:b,glyph:E}of d)g[y]===void 0&&(g[y]={}),g[y].glyphs===void 0&&(g[y].glyphs={}),g[y].glyphs[b]=E&&{id:E.id,bitmap:E.bitmap.clone(),metrics:E.metrics},g[y].ascender=this.entries[y].ascender,g[y].descender=this.entries[y].descender;i(null,g)}})}_doesCharSupportLocalGlyph(e){return this.localGlyphMode!==s_.none&&(this.localGlyphMode===s_.all?!!this.localFontFamily:!!this.localFontFamily&&(Ch(e)||Ah(e)||vl(e)||Oc(e)||ga(e)))}_tinySDF(e,i,a){const c=this.localFontFamily;if(!c||!this._doesCharSupportLocalGlyph(a))return;let d=e.tinySDF;if(!d){let q="400";/bold/i.test(i)?q="900":/medium/i.test(i)?q="500":/light/i.test(i)&&(q="200"),d=e.tinySDF=new Xc.TinySDF({fontFamily:c,fontWeight:q,fontSize:48,buffer:6,radius:16}),d.fontWeight=q}if(this.localGlyphs[d.fontWeight][a])return this.localGlyphs[d.fontWeight][a];const g=String.fromCharCode(a),{data:y,width:b,height:E,glyphWidth:A,glyphHeight:P,glyphLeft:z,glyphTop:O,glyphAdvance:F}=d.draw(g);return this.localGlyphs[d.fontWeight][a]={id:a,bitmap:new Os({width:b,height:E},y),metrics:{width:A/2,height:P/2,left:z/2,top:O/2-27,advance:F/2,localGlyph:!0}}}}function Ax(n,e,i,a){const c=[],d=n.image,g=d.pixelRatio,y=d.paddedRect.w-2,b=d.paddedRect.h-2,E=n.right-n.left,A=n.bottom-n.top,P=d.stretchX||[[0,y]],z=d.stretchY||[[0,b]],O=(Ke,ut)=>Ke+ut[1]-ut[0],F=P.reduce(O,0),q=z.reduce(O,0),Z=y-F,le=b-q;let ge=0,ae=F,de=0,be=q,_e=0,$e=Z,je=0,it=le;if(d.content&&a){const Ke=d.content;ge=up(P,0,Ke[0]),de=up(z,0,Ke[1]),ae=up(P,Ke[0],Ke[2]),be=up(z,Ke[1],Ke[3]),_e=Ke[0]-ge,je=Ke[1]-de,$e=Ke[2]-Ke[0]-ae,it=Ke[3]-Ke[1]-be}const St=(Ke,ut,dt,vt)=>{const Ct=hp(Ke.stretch-ge,ae,E,n.left),Qe=dp(Ke.fixed-_e,$e,Ke.stretch,F),Dt=hp(ut.stretch-de,be,A,n.top),dn=dp(ut.fixed-je,it,ut.stretch,q),Ut=hp(dt.stretch-ge,ae,E,n.left),en=dp(dt.fixed-_e,$e,dt.stretch,F),Ot=hp(vt.stretch-de,be,A,n.top),pn=dp(vt.fixed-je,it,vt.stretch,q),Rn=new ce(Ct,Dt),Pn=new ce(Ut,Dt),An=new ce(Ut,Ot),gn=new ce(Ct,Ot),ti=new ce(Qe/g,dn/g),wn=new ce(en/g,pn/g),Dn=e*Math.PI/180;if(Dn){const pi=Math.sin(Dn),yi=Math.cos(Dn),vi=[yi,-pi,pi,yi];Rn._matMult(vi),Pn._matMult(vi),gn._matMult(vi),An._matMult(vi)}const ri=Ke.stretch+Ke.fixed,_i=ut.stretch+ut.fixed;return{tl:Rn,tr:Pn,bl:gn,br:An,tex:{x:d.paddedRect.x+1+ri,y:d.paddedRect.y+1+_i,w:dt.stretch+dt.fixed-ri,h:vt.stretch+vt.fixed-_i},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:ti,pixelOffsetBR:wn,minFontScaleX:$e/g/E,minFontScaleY:it/g/A,isSDF:i}};if(a&&(d.stretchX||d.stretchY)){const Ke=Mx(P,Z,F),ut=Mx(z,le,q);for(let dt=0;dt<Ke.length-1;dt++){const vt=Ke[dt],Ct=Ke[dt+1];for(let Qe=0;Qe<ut.length-1;Qe++)c.push(St(vt,ut[Qe],Ct,ut[Qe+1]))}}else c.push(St({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:y+1},{fixed:0,stretch:b+1}));return c}function up(n,e,i){let a=0;for(const c of n)a+=Math.max(e,Math.min(i,c[1]))-Math.max(e,Math.min(i,c[0]));return a}function Mx(n,e,i){const a=[{fixed:-1,stretch:0}];for(const[c,d]of n){const g=a[a.length-1];a.push({fixed:c-g.stretch,stretch:g.stretch}),a.push({fixed:c-g.stretch,stretch:g.stretch+(d-c)})}return a.push({fixed:e+1,stretch:i}),a}function hp(n,e,i,a){return n/e*i+a}function dp(n,e,i,a){return n-e*i/a}function dA(n,e,i,a){const c=e+n.positionedLines[a].lineOffset;return a===0?i+c/2:i+(c+(e+n.positionedLines[a-1].lineOffset))/2}Xc.loadGlyphRange=function(n,e,i,a,c){const d=256*e,g=d+255,y=a.transformRequest(a.normalizeGlyphsURL(i).replace("{fontstack}",n).replace("{range}",`${d}-${g}`),Wn.Glyphs);tr(y,(b,E)=>{if(b)c(b);else if(E){const A={},P=function(z){return new Hh(z).readFields(rA,{})}(E);for(const z of P.glyphs)A[z.id]=z;c(null,{glyphs:A,ascender:P.ascender,descender:P.descender})}})},Xc.TinySDF=class{constructor({fontSize:n=24,buffer:e=3,radius:i=8,cutoff:a=.25,fontFamily:c="sans-serif",fontWeight:d="normal",fontStyle:g="normal"}={}){this.buffer=e,this.cutoff=a,this.radius=i;const y=this.size=n+4*e,b=this._createCanvas(y),E=this.ctx=b.getContext("2d",{willReadFrequently:!0});E.font=`${g} ${d} ${n}px ${c}`,E.textBaseline="alphabetic",E.textAlign="left",E.fillStyle="black",this.gridOuter=new Float64Array(y*y),this.gridInner=new Float64Array(y*y),this.f=new Float64Array(y),this.z=new Float64Array(y+1),this.v=new Uint16Array(y)}_createCanvas(n){const e=document.createElement("canvas");return e.width=e.height=n,e}draw(n){const{width:e,actualBoundingBoxAscent:i,actualBoundingBoxDescent:a,actualBoundingBoxLeft:c,actualBoundingBoxRight:d}=this.ctx.measureText(n),g=Math.ceil(i),y=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(d-c))),b=Math.min(this.size-this.buffer,g+Math.ceil(a)),E=y+2*this.buffer,A=b+2*this.buffer,P=Math.max(E*A,0),z=new Uint8ClampedArray(P),O={data:z,width:E,height:A,glyphWidth:y,glyphHeight:b,glyphTop:g,glyphLeft:0,glyphAdvance:e};if(y===0||b===0)return O;const{ctx:F,buffer:q,gridInner:Z,gridOuter:le}=this;F.clearRect(q,q,y,b),F.fillText(n,q,q+g);const ge=F.getImageData(q,q,y,b);le.fill(Xh,0,P),Z.fill(0,0,P);for(let ae=0;ae<b;ae++)for(let de=0;de<y;de++){const be=ge.data[4*(ae*y+de)+3]/255;if(be===0)continue;const _e=(ae+q)*E+de+q;if(be===1)le[_e]=0,Z[_e]=Xh;else{const $e=.5-be;le[_e]=$e>0?$e*$e:0,Z[_e]=$e<0?$e*$e:0}}Sx(le,0,0,E,A,E,this.f,this.v,this.z),Sx(Z,q,q,y,b,E,this.f,this.v,this.z);for(let ae=0;ae<P;ae++){const de=Math.sqrt(le[ae])-Math.sqrt(Z[ae]);z[ae]=Math.round(255-255*(de/this.radius+this.cutoff))}return O}};class fA{constructor(e=[],i=pA){if(this.data=e,this.length=this.data.length,this.compare=i,this.length>0)for(let a=(this.length>>1)-1;a>=0;a--)this._down(a)}push(e){this.data.push(e),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const e=this.data[0],i=this.data.pop();return this.length--,this.length>0&&(this.data[0]=i,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:i,compare:a}=this,c=i[e];for(;e>0;){const d=e-1>>1,g=i[d];if(a(c,g)>=0)break;i[e]=g,e=d}i[e]=c}_down(e){const{data:i,compare:a}=this,c=this.length>>1,d=i[e];for(;e<c;){let g=1+(e<<1),y=i[g];const b=g+1;if(b<this.length&&a(i[b],y)<0&&(g=b,y=i[b]),a(y,d)>=0)break;i[e]=y,e=g}i[e]=d}}function pA(n,e){return n<e?-1:n>e?1:0}function mA(n,e=1,i=!1){let a=1/0,c=1/0,d=-1/0,g=-1/0;const y=n[0];for(let O=0;O<y.length;O++){const F=y[O];(!O||F.x<a)&&(a=F.x),(!O||F.y<c)&&(c=F.y),(!O||F.x>d)&&(d=F.x),(!O||F.y>g)&&(g=F.y)}const b=Math.min(d-a,g-c);let E=b/2;const A=new fA([],gA);if(b===0)return new ce(a,c);for(let O=a;O<d;O+=b)for(let F=c;F<g;F+=b)A.push(new Kc(O+E,F+E,E,n));let P=function(O){let F=0,q=0,Z=0;const le=O[0];for(let ge=0,ae=le.length,de=ae-1;ge<ae;de=ge++){const be=le[ge],_e=le[de],$e=be.x*_e.y-_e.x*be.y;q+=(be.x+_e.x)*$e,Z+=(be.y+_e.y)*$e,F+=3*$e}return new Kc(q/F,Z/F,0,O)}(n),z=A.length;for(;A.length;){const O=A.pop();(O.d>P.d||!P.d)&&(P=O,i&&console.log("found best %d after %d probes",Math.round(1e4*O.d)/1e4,z)),O.max-P.d<=e||(E=O.h/2,A.push(new Kc(O.p.x-E,O.p.y-E,E,n)),A.push(new Kc(O.p.x+E,O.p.y-E,E,n)),A.push(new Kc(O.p.x-E,O.p.y+E,E,n)),A.push(new Kc(O.p.x+E,O.p.y+E,E,n)),z+=4)}return i&&(console.log(`num probes: ${z}`),console.log(`best distance: ${P.d}`)),P.p}function gA(n,e){return e.max-n.max}function Kc(n,e,i,a){this.p=new ce(n,e),this.h=i,this.d=function(c,d){let g=!1,y=1/0;for(let b=0;b<d.length;b++){const E=d[b];for(let A=0,P=E.length,z=P-1;A<P;z=A++){const O=E[A],F=E[z];O.y>c.y!=F.y>c.y&&c.x<(F.x-O.x)*(c.y-O.y)/(F.y-O.y)+O.x&&(g=!g),y=Math.min(y,f0(c,O,F))}}return(g?1:-1)*Math.sqrt(y)}(this.p,a),this.max=this.d+this.h*Math.SQRT2}const a_=Number.POSITIVE_INFINITY,_A=Math.sqrt(2);function Ix(n,[e,i]){let a=0,c=0;if(i===a_){e<0&&(e=0);const d=e/_A;switch(n){case"top-right":case"top-left":c=d-7;break;case"bottom-right":case"bottom-left":c=7-d;break;case"bottom":c=7-e;break;case"top":c=e-7}switch(n){case"top-right":case"bottom-right":a=-d;break;case"top-left":case"bottom-left":a=d;break;case"left":a=e;break;case"right":a=-e}}else{switch(e=Math.abs(e),i=Math.abs(i),n){case"top-right":case"top-left":case"top":c=i-7;break;case"bottom-right":case"bottom-left":case"bottom":c=7-i}switch(n){case"top-right":case"bottom-right":case"right":a=-e;break;case"top-left":case"bottom-left":case"left":a=e}}return[a,c]}function yA(n,e,i,a,c,d,g,y,b,E){n.createArrays(),n.tilePixelRatio=_n/(512*n.overscaling),n.compareText={},n.iconsNeedLinear=!1;const A=n.layers[0].layout,P=n.layers[0]._unevaluatedLayout._values,z={};if(n.textSizeData.kind==="composite"){const{minZoom:q,maxZoom:Z}=n.textSizeData;z.compositeTextSizes=[P["text-size"].possiblyEvaluate(new Le(q),y),P["text-size"].possiblyEvaluate(new Le(Z),y)]}if(n.iconSizeData.kind==="composite"){const{minZoom:q,maxZoom:Z}=n.iconSizeData;z.compositeIconSizes=[P["icon-size"].possiblyEvaluate(new Le(q),y),P["icon-size"].possiblyEvaluate(new Le(Z),y)]}z.layoutTextSize=P["text-size"].possiblyEvaluate(new Le(b+1),y),z.layoutIconSize=P["icon-size"].possiblyEvaluate(new Le(b+1),y),z.textMaxSize=P["text-size"].possiblyEvaluate(new Le(18),y);const O=A.get("text-rotation-alignment")==="map"&&A.get("symbol-placement")!=="point",F=A.get("text-size");for(const q of n.features){const Z=A.get("text-font").evaluate(q,{},y).join(","),le=F.evaluate(q,{},y),ge=z.layoutTextSize.evaluate(q,{},y),ae=(z.layoutIconSize.evaluate(q,{},y),{horizontal:{},vertical:void 0}),de=q.text;let be,_e=[0,0];if(de){const it=de.toString(),St=A.get("text-letter-spacing").evaluate(q,{},y)*gr,Ke=A.get("text-line-height").evaluate(q,{},y)*gr,ut=C(it)?St:0,dt=A.get("text-anchor").evaluate(q,{},y),vt=A.get("text-variable-anchor");if(!vt){const Ut=A.get("text-radial-offset").evaluate(q,{},y);_e=Ut?Ix(dt,[Ut*gr,a_]):A.get("text-offset").evaluate(q,{},y).map(en=>en*gr)}let Ct=O?"center":A.get("text-justify").evaluate(q,{},y);const Qe=A.get("symbol-placement")==="point",Dt=Qe?A.get("text-max-width").evaluate(q,{},y)*gr:1/0,dn=Ut=>{n.allowVerticalPlacement&&T(it)&&(ae.vertical=r_(de,e,i,c,Z,Dt,Ke,dt,Ut,ut,_e,uo.vertical,!0,ge,le))};if(!O&&vt){const Ut=Ct==="auto"?vt.map(Ot=>l_(Ot)):[Ct];let en=!1;for(let Ot=0;Ot<Ut.length;Ot++){const pn=Ut[Ot];if(!ae.horizontal[pn])if(en)ae.horizontal[pn]=ae.horizontal[0];else{const Rn=r_(de,e,i,c,Z,Dt,Ke,"center",pn,ut,_e,uo.horizontal,!1,ge,le);Rn&&(ae.horizontal[pn]=Rn,en=Rn.positionedLines.length===1)}}dn("left")}else{if(Ct==="auto"&&(Ct=l_(dt)),Qe||A.get("text-writing-mode").indexOf("horizontal")>=0||!T(it)){const Ut=r_(de,e,i,c,Z,Dt,Ke,dt,Ct,ut,_e,uo.horizontal,!1,ge,le);Ut&&(ae.horizontal[Ct]=Ut)}dn(Qe?"left":Ct)}}let $e=!1;if(q.icon&&q.icon.name){const it=a[q.icon.name];it&&(be=cA(c[q.icon.name],A.get("icon-offset").evaluate(q,{},y),A.get("icon-anchor").evaluate(q,{},y)),$e=it.sdf,n.sdfIcons===void 0?n.sdfIcons=it.sdf:n.sdfIcons!==it.sdf&&re("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(it.pixelRatio!==n.pixelRatio||A.get("icon-rotate").constantOr(1)!==0)&&(n.iconsNeedLinear=!0))}const je=Px(ae.horizontal)||ae.vertical;n.iconsInText||(n.iconsInText=!!je&&je.iconsInText),(je||be)&&vA(n,q,ae,be,a,z,ge,0,_e,$e,g,y,E)}d&&n.generateCollisionDebugBuffers(b,n.collisionBoxArray)}function l_(n){switch(n){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function vA(n,e,i,a,c,d,g,y,b,E,A,P,z){let O=d.textMaxSize.evaluate(e,{},P);O===void 0&&(O=g);const F=n.layers[0].layout,q=F.get("icon-offset").evaluate(e,{},P),Z=Px(i.horizontal)||i.vertical,le=z.name==="globe",ge=g/24,ae=n.tilePixelRatio*O/24,de=(ut=n.overscaling,n.zoom>18&&ut>2&&(ut>>=1),Math.max(_n/(512*ut),1)*F.get("symbol-spacing")),be=F.get("text-padding")*n.tilePixelRatio,_e=F.get("icon-padding")*n.tilePixelRatio,$e=Ie(F.get("text-max-angle")),je=F.get("text-rotation-alignment")==="map"&&F.get("symbol-placement")!=="point",it=F.get("icon-rotation-alignment")==="map"&&F.get("symbol-placement")!=="point",St=F.get("symbol-placement"),Ke=de/2;var ut;const dt=F.get("icon-text-fit");let vt;a&&dt!=="none"&&(n.allowVerticalPlacement&&i.vertical&&(vt=yx(a,i.vertical,dt,F.get("icon-text-fit-padding"),q,ge)),Z&&(a=yx(a,Z,dt,F.get("icon-text-fit-padding"),q,ge)));const Ct=(Qe,Dt,dn)=>{if(Dt.x<0||Dt.x>=_n||Dt.y<0||Dt.y>=_n)return;let Ut=null;if(le){const{x:en,y:Ot,z:pn}=z.projectTilePoint(Dt.x,Dt.y,dn);Ut={anchor:new Fs(en,Ot,pn,0,void 0),up:z.upVector(dn,Dt.x,Dt.y)}}(function(en,Ot,pn,Rn,Pn,An,gn,ti,wn,Dn,ri,_i,pi,yi,vi,Pi,or,ni,Wi,Ni,Zn,Si,Yi,oi,Oi){const Tr=en.addToLineVertexArray(Ot,Rn);let sr,ar,Dr,lr,Vs,iu,sd,ad=0,mb=0,gb=0,_b=0,S_=-1,C_=-1;const ps={};let yb=Bc.exports("");const Ll=pn?pn.anchor:Ot;let A_=0,M_=0;if(wn._unevaluatedLayout.getValue("text-radial-offset")===void 0?[A_,M_]=wn.layout.get("text-offset").evaluate(Zn,{},Oi).map(Jr=>Jr*gr):(A_=wn.layout.get("text-radial-offset").evaluate(Zn,{},Oi)*gr,M_=a_),en.allowVerticalPlacement&&Pn.vertical){const Jr=Pn.vertical;if(vi)iu=c_(Jr),ti&&(sd=c_(ti));else{const eo=wn.layout.get("text-rotate").evaluate(Zn,{},Oi)+90;Dr=fp(Dn,Ll,Ot,ri,_i,pi,Jr,yi,eo,Pi),ti&&(lr=fp(Dn,Ll,Ot,ri,_i,pi,ti,ni,eo))}}if(An){const Jr=wn.layout.get("icon-rotate").evaluate(Zn,{},Oi),eo=wn.layout.get("icon-text-fit")!=="none",ld=Ax(An,Jr,Yi,eo),k_=ti?Ax(ti,Jr,Yi,eo):void 0;ar=fp(Dn,Ll,Ot,ri,_i,pi,An,ni,Jr),ad=4*ld.length;const vb=en.iconSizeData;let Rl=null;vb.kind==="source"?(Rl=[cs*wn.layout.get("icon-size").evaluate(Zn,{},Oi)],Rl[0]>ba&&re(`${en.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):vb.kind==="composite"&&(Rl=[cs*Si.compositeIconSizes[0].evaluate(Zn,{},Oi),cs*Si.compositeIconSizes[1].evaluate(Zn,{},Oi)],(Rl[0]>ba||Rl[1]>ba)&&re(`${en.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),en.addSymbols(en.icon,ld,Rl,Ni,Wi,Zn,!1,pn,Ot,Tr.lineStartIndex,Tr.lineLength,-1,oi,Oi),S_=en.icon.placedSymbolArray.length-1,k_&&(mb=4*k_.length,en.addSymbols(en.icon,k_,Rl,Ni,Wi,Zn,uo.vertical,pn,Ot,Tr.lineStartIndex,Tr.lineLength,-1,oi,Oi),C_=en.icon.placedSymbolArray.length-1)}for(const Jr in Pn.horizontal){const eo=Pn.horizontal[Jr];sr||(yb=Bc.exports(eo.text),vi?Vs=c_(eo):sr=fp(Dn,Ll,Ot,ri,_i,pi,eo,yi,wn.layout.get("text-rotate").evaluate(Zn,{},Oi),Pi));const ld=eo.positionedLines.length===1;if(gb+=kx(en,pn,Ot,eo,gn,wn,vi,Zn,Pi,Tr,Pn.vertical?uo.horizontal:uo.horizontalOnly,ld?Object.keys(Pn.horizontal):[Jr],ps,S_,Si,oi,Oi),ld)break}Pn.vertical&&(_b+=kx(en,pn,Ot,Pn.vertical,gn,wn,vi,Zn,Pi,Tr,uo.vertical,["vertical"],ps,C_,Si,oi,Oi));let Aa=-1;const I_=(Jr,eo)=>Jr?Math.max(Jr,eo):eo;Aa=I_(Vs,Aa),Aa=I_(iu,Aa),Aa=I_(sd,Aa);const YA=Aa>-1?1:0;en.glyphOffsetArray.length>=Ea.MAX_GLYPHS&&re("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Zn.sortKey!==void 0&&en.addToSortKeyRanges(en.symbolInstances.length,Zn.sortKey),en.symbolInstances.emplaceBack(Ll.x,Ll.y,Ll.z,Ot.x,Ot.y,ps.right>=0?ps.right:-1,ps.center>=0?ps.center:-1,ps.left>=0?ps.left:-1,ps.vertical>=0?ps.vertical:-1,S_,C_,yb,sr!==void 0?sr:en.collisionBoxArray.length,sr!==void 0?sr+1:en.collisionBoxArray.length,Dr!==void 0?Dr:en.collisionBoxArray.length,Dr!==void 0?Dr+1:en.collisionBoxArray.length,ar!==void 0?ar:en.collisionBoxArray.length,ar!==void 0?ar+1:en.collisionBoxArray.length,lr||en.collisionBoxArray.length,lr?lr+1:en.collisionBoxArray.length,ri,gb,_b,ad,mb,YA,0,A_,M_,Aa)})(n,Dt,Ut,Qe,i,a,c,vt,n.layers[0],n.collisionBoxArray,e.index,e.sourceLayerIndex,n.index,be,je,b,0,_e,it,q,e,d,E,A,P)};if(St==="line")for(const Qe of Tx(e.geometry,0,0,_n,_n)){const Dt=hA(Qe,de,$e,i.vertical||Z,a,24,ae,n.overscaling,_n);for(const dn of Dt){const Ut=Z;Ut&&xA(n,Ut.text,Ke,dn)||Ct(Qe,dn,P)}}else if(St==="line-center"){for(const Qe of e.geometry)if(Qe.length>1){const Dt=uA(Qe,$e,i.vertical||Z,a,24,ae);Dt&&Ct(Qe,Dt,P)}}else if(e.type==="Polygon")for(const Qe of Kg(e.geometry,0)){const Dt=mA(Qe,16);Ct(Qe[0],new Fs(Dt.x,Dt.y,0,0,void 0),P)}else if(e.type==="LineString")for(const Qe of e.geometry)Ct(Qe,new Fs(Qe[0].x,Qe[0].y,0,0,void 0),P);else if(e.type==="Point")for(const Qe of e.geometry)for(const Dt of Qe)Ct([Dt],new Fs(Dt.x,Dt.y,0,0,void 0),P)}const ba=32640;function kx(n,e,i,a,c,d,g,y,b,E,A,P,z,O,F,q,Z){const le=function(de,be,_e,$e,je,it,St,Ke){const ut=[];if(be.positionedLines.length===0)return ut;const dt=$e.layout.get("text-rotate").evaluate(it,{})*Math.PI/180,vt=function(Ut){const en=Ut[0],Ot=Ut[1],pn=en*Ot;return pn>0?[en,-Ot]:pn<0?[-en,Ot]:en===0?[Ot,en]:[Ot,-en]}(_e);let Ct=Math.abs(be.top-be.bottom);for(const Ut of be.positionedLines)Ct-=Ut.lineOffset;const Qe=be.positionedLines.length,Dt=Ct/Qe;let dn=be.top-_e[1];for(let Ut=0;Ut<Qe;++Ut){const en=be.positionedLines[Ut];dn=dA(be,Dt,dn,Ut);for(const Ot of en.positionedGlyphs){if(!Ot.rect)continue;const pn=Ot.rect||{};let Rn=4,Pn=!0,An=1,gn=0;if(Ot.imageName){const oi=St[Ot.imageName];if(!oi)continue;if(oi.sdf){re("SDF images are not supported in formatted text and will be ignored.");continue}Pn=!1,An=oi.pixelRatio,Rn=1/An}const ti=(je||Ke)&&Ot.vertical,wn=Ot.metrics.advance*Ot.scale/2,Dn=Ot.metrics,ri=Ot.rect;if(ri===null)continue;Ke&&be.verticalizable&&(gn=Ot.imageName?wn-Ot.metrics.width*Ot.scale/2:0);const _i=je?[Ot.x+wn,Ot.y]:[0,0];let pi=[0,0],yi=[0,0],vi=!1;je||(ti?(yi=[Ot.x+wn+vt[0],Ot.y+vt[1]-gn],vi=!0):pi=[Ot.x+wn+_e[0],Ot.y+_e[1]-gn]);const Pi=ri.w*Ot.scale/(An*(Ot.localGlyph?2:1)),or=ri.h*Ot.scale/(An*(Ot.localGlyph?2:1));let ni,Wi,Ni,Zn;if(ti){const oi=Ot.y-dn,Oi=new ce(-wn,wn-oi),Tr=-Math.PI/2,sr=new ce(...yi);ni=new ce(-wn+pi[0],pi[1]),ni._rotateAround(Tr,Oi)._add(sr),ni.x+=-oi+wn,ni.y-=(Dn.left-Rn)*Ot.scale;const ar=Ot.imageName?Dn.advance*Ot.scale:gr*Ot.scale,Dr=String.fromCharCode(Ot.glyph);HC(Dr)?ni.x+=(1-Rn)*Ot.scale:WC(Dr)?ni.x+=ar-Dn.height*Ot.scale+(-Rn-1)*Ot.scale:ni.x+=Ot.imageName||Dn.width+2*Rn===ri.w&&Dn.height+2*Rn===ri.h?(ar-or)/2:(ar-(Dn.height+2*Rn)*Ot.scale)/2,Wi=new ce(ni.x,ni.y-Pi),Ni=new ce(ni.x+or,ni.y),Zn=new ce(ni.x+or,ni.y-Pi)}else{const oi=(Dn.left-Rn)*Ot.scale-wn+pi[0],Oi=(-Dn.top-Rn)*Ot.scale+pi[1],Tr=oi+Pi,sr=Oi+or;ni=new ce(oi,Oi),Wi=new ce(Tr,Oi),Ni=new ce(oi,sr),Zn=new ce(Tr,sr)}if(dt){let oi;oi=je?new ce(0,0):vi?new ce(vt[0],vt[1]):new ce(_e[0],_e[1]),ni._rotateAround(dt,oi),Wi._rotateAround(dt,oi),Ni._rotateAround(dt,oi),Zn._rotateAround(dt,oi)}const Si=new ce(0,0),Yi=new ce(0,0);ut.push({tl:ni,tr:Wi,bl:Ni,br:Zn,tex:pn,writingMode:be.writingMode,glyphOffset:_i,sectionIndex:Ot.sectionIndex,isSDF:Pn,pixelOffsetTL:Si,pixelOffsetBR:Yi,minFontScaleX:0,minFontScaleY:0})}}return ut}(0,a,b,d,g,y,c,n.allowVerticalPlacement),ge=n.textSizeData;let ae=null;ge.kind==="source"?(ae=[cs*d.layout.get("text-size").evaluate(y,{},Z)],ae[0]>ba&&re(`${n.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):ge.kind==="composite"&&(ae=[cs*F.compositeTextSizes[0].evaluate(y,{},Z),cs*F.compositeTextSizes[1].evaluate(y,{},Z)],(ae[0]>ba||ae[1]>ba)&&re(`${n.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),n.addSymbols(n.text,le,ae,b,g,y,A,e,i,E.lineStartIndex,E.lineLength,O,q,Z);for(const de of P)z[de]=n.text.placedSymbolArray.length-1;return 4*le.length}function Px(n){for(const e in n)return n[e];return null}function fp(n,e,i,a,c,d,g,y,b,E){let A=g.top,P=g.bottom,z=g.left,O=g.right;const F=g.collisionPadding;if(F&&(z-=F[0],A-=F[1],O+=F[2],P+=F[3]),b){const q=new ce(z,A),Z=new ce(O,A),le=new ce(z,P),ge=new ce(O,P),ae=Ie(b);let de=new ce(0,0);E&&(de=new ce(E[0],E[1])),q._rotateAround(ae,de),Z._rotateAround(ae,de),le._rotateAround(ae,de),ge._rotateAround(ae,de),z=Math.min(q.x,Z.x,le.x,ge.x),O=Math.max(q.x,Z.x,le.x,ge.x),A=Math.min(q.y,Z.y,le.y,ge.y),P=Math.max(q.y,Z.y,le.y,ge.y)}return n.emplaceBack(e.x,e.y,e.z,i.x,i.y,z,A,O,P,y,a,c,d),n.length-1}function c_(n){n.collisionPadding&&(n.top-=n.collisionPadding[1],n.bottom+=n.collisionPadding[3]);const e=n.bottom-n.top;return e>0?Math.max(10,e):null}function xA(n,e,i,a){const c=n.compareText;if(e in c){const d=c[e];for(let g=d.length-1;g>=0;g--)if(a.dist(d[g])<i)return!0}else c[e]=[];return c[e].push(a),!1}const bA=Gt([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:zx}=bA,Lx=Gt([{name:"a_pos_3",components:3,type:"Int16"}]);var Kh=Gt([{name:"a_pos",type:"Int16",components:2}]);const Ns=_n/Math.PI/2,u_=2*wo(1,0)*Ns*Math.PI,Yc=64,Qc=[Yc,32,16],To=-Ns,So=Ns,wA=[new Lr([To,To,To],[So,So,So]),new Lr([To,To,To],[0,0,So]),new Lr([0,To,To],[So,0,So]),new Lr([To,0,To],[0,So,So]),new Lr([0,0,To],[So,So,So])];function Rx(n,e,i,a=!0){const c=co([],n._camera.position,n.worldSize),d=[e,i,1,1];Ml(d,d,n.pixelMatrixInverse),S0(d,d,1/d[3]);const g=zr([],jo([],d,c)),y=n.globeMatrix,b=[y[12],y[13],y[14]],E=jo([],b,c),A=Ph(E),P=zr([],E),z=n.worldSize/(2*Math.PI),O=Eo(P,g),F=Math.asin(z/A);if(F<Math.acos(O)){if(!a)return null;const St=[],Ke=[];co(St,g,A/O),zr(Ke,jo(Ke,St,E)),zr(g,Ds(g,E,co(g,Ke,Math.tan(F)*A)))}const q=[];new qg(c,g).closestPointOnSphere(b,z,q);const Z=zr([],bt(y,0)),le=zr([],bt(y,1)),ge=zr([],bt(y,2)),ae=Eo(Z,q),de=Eo(le,q),be=Eo(ge,q),_e=ke(Math.asin(-de/z));let $e=ke(Math.atan2(ae,be));$e=n.center.lng+function(St,Ke){const ut=(Ke-St+180)%360-180;return ut<-180?ut+360:ut}(n.center.lng,$e);const je=ss($e),it=lt(as(_e),0,1);return new Nc(je,it)}class EA{constructor(e,i,a){this.a=jo([],e,a),this.b=jo([],i,a),this.center=a;const c=zr([],this.a),d=zr([],this.b);this.angle=Math.acos(Eo(c,d))}}function h_(n,e){if(n.angle===0)return null;let i;return i=n.a[e]===0?1/n.angle*.5*Math.PI:1/n.angle*Math.atan(n.b[e]/n.a[e]/Math.sin(n.angle)-1/Math.tan(n.angle)),i<0||i>1?null:function(a,c,d,g){const y=Math.sin(d);return a*(Math.sin((1-g)*d)/y)+c*(Math.sin(g*d)/y)}(n.a[e],n.b[e],n.angle,lt(i,0,1))+n.center[e]}function us(n){if(n.z<=1)return wA[n.z+2*n.y+n.x];const e=d_(pp(n));return Lr.fromPoints(e)}function kl(n,e,i){return co(n,n,1-i),Rh(n,n,e,i)}function Dx(n,e){const i=eu(e.zoom);if(i===0)return us(n);const a=pp(n),c=d_(a),d=ss(a.getWest())*e.worldSize,g=ss(a.getEast())*e.worldSize,y=as(a.getNorth())*e.worldSize,b=as(a.getSouth())*e.worldSize,E=[d,y,0],A=[g,y,0],P=[d,b,0],z=[g,b,0],O=Bg([],e.globeMatrix);return Di(E,E,O),Di(A,A,O),Di(P,P,O),Di(z,z,O),c[0]=kl(c[0],P,i),c[1]=kl(c[1],z,i),c[2]=kl(c[2],A,i),c[3]=kl(c[3],E,i),Lr.fromPoints(c)}function Ox(n,e,i){for(const a of n)Di(a,a,e),co(a,a,i)}function TA(n,e,i){const a=e/n.worldSize,c=n.globeMatrix;if(i.z<=1){const je=us(i).getCorners();return Ox(je,c,a),Lr.fromPoints(je)}const d=pp(i),g=d_(d);Ox(g,c,a);const y=Number.MAX_VALUE,b=[-y,-y,-y],E=[y,y,y];if(d.contains(n.center)){for(const St of g)zh(E,E,St),Lh(b,b,St);b[2]=0;const je=n.point,it=[je.x*a,je.y*a,0];return zh(E,E,it),Lh(b,b,it),new Lr(E,b)}const A=[c[12]*a,c[13]*a,c[14]*a],P=d.getCenter(),z=lt(n.center.lat,-85.051129,ls),O=lt(P.lat,-85.051129,ls),F=ss(n.center.lng),q=as(z);let Z=F-ss(P.lng);const le=q-as(O);Z>.5?Z-=1:Z<-.5&&(Z+=1);let ge=0;Math.abs(Z)>Math.abs(le)?ge=Z>=0?1:3:(ge=le>=0?0:2,Rh(A,A,[c[4]*a,c[5]*a,c[6]*a],-Math.sin(Ie(le>=0?d.getSouth():d.getNorth()))*Ns));const ae=g[ge],de=g[(ge+1)%4],be=new EA(ae,de,A),_e=[h_(be,0)||ae[0],h_(be,1)||ae[1],h_(be,2)||ae[2]],$e=eu(n.zoom);if($e>0){const je=function({x:St,y:Ke,z:ut},dt,vt,Ct,Qe){const Dt=1/(1<<ut);let dn=St*Dt,Ut=dn+Dt,en=Ke*Dt,Ot=en+Dt,pn=0;const Rn=(dn+Ut)/2-Ct;return Rn>.5?pn=-1:Rn<-.5&&(pn=1),dn=((dn+pn)*dt-(Ct*=dt))*vt+Ct,Ut=((Ut+pn)*dt-Ct)*vt+Ct,en=(en*dt-(Qe*=dt))*vt+Qe,Ot=(Ot*dt-Qe)*vt+Qe,[[dn,Ot,0],[Ut,Ot,0],[Ut,en,0],[dn,en,0]]}(i,e,n._pixelsPerMercatorPixel,F,q);for(let St=0;St<g.length;St++)kl(g[St],je[St],$e);const it=Ds([],je[ge],je[(ge+1)%4]);co(it,it,.5),kl(_e,it,$e)}for(const je of g)zh(E,E,je),Lh(b,b,je);return E[2]=Math.min(ae[2],de[2]),zh(E,E,_e),Lh(b,b,_e),new Lr(E,b)}function pp({x:n,y:e,z:i}){const a=1/(1<<i),c=new qn(lo(n*a),mr((e+1)*a)),d=new qn(lo((n+1)*a),mr(e*a));return new xa(c,d)}function d_(n){const e=Ie(n.getNorth()),i=Ie(n.getSouth()),a=Math.cos(e),c=Math.cos(i),d=Math.sin(e),g=Math.sin(i),y=n.getWest(),b=n.getEast();return[Jc(c,g,y),Jc(c,g,b),Jc(a,d,b),Jc(a,d,y)]}function Jc(n,e,i,a=Ns){return i=Ie(i),[n*Math.sin(i)*a,-e*a,n*Math.cos(i)*a]}function Yh(n,e,i){return Jc(Math.cos(Ie(n)),Math.sin(Ie(n)),e,i)}function Qh(n,e,i,a){const c=1<<i.z,d=(n/_n+i.x)/c;return Yh(mr((e/_n+i.y)/c),lo(d),a)}function mp({min:n,max:e}){return 16383/Math.max(e[0]-n[0],e[1]-n[1],e[2]-n[2])}const Bx=new Float64Array(16);function Jh(n){const e=mp(n),i=x0(Bx,[e,e,e]);return kh(i,i,((a=[])[0]=-(c=n.min)[0],a[1]=-c[1],a[2]=-c[2],a));var a,c}function f_(n){const e=(a=n.min,(i=Bx)[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=a[0],i[13]=a[1],i[14]=a[2],i[15]=1,i);var i,a;const c=1/mp(n);return Al(e,e,[c,c,c])}function Fx(n,e,i,a,c){const d=function(b){const E=_n/(2*Math.PI);return b/(2*Math.PI)/E}(i),g=[n,e,-i/(2*Math.PI)],y=qo(new Float64Array(16));return kh(y,y,g),Al(y,y,[d,d,d]),Fg(y,y,Ie(-c)),Kf(y,y,Ie(-a)),y}function eu(n){return Xt(5,6,n)}function Nx(n,e){const i=Yh(e.lat,e.lng),a=function(F){const q=Yh(F._center.lat,F._center.lng);let Z=Ug([],Uc(0,1,0),q);const le=b0([],-F.angle,q);Z=Di(Z,Z,le),b0(le,-F._pitch,Z);const ge=zr([],q);return co(ge,ge,F.cameraToCenterDistance/F.pixelsPerMeter*u_),Di(ge,ge,le),Ds([],q,ge)}(n);return g=(c=Vg([],a,i))[0],y=c[1],b=c[2],E=(d=i)[0],A=d[1],P=d[2],O=(z=Math.sqrt(g*g+y*y+b*b)*Math.sqrt(E*E+A*A+P*P))&&Eo(c,d)/z,Math.acos(Math.min(Math.max(O,-1),1));var c,d,g,y,b,E,A,P,z,O}function p_(n,e){return Nx(n,e)>Math.PI/2*1.01}const Vx=Ie(85),SA=Math.cos(Vx),CA=Math.sin(Vx);function Ux(n,e){const i=n.fovAboveCenter,a=n.elevation?n.elevation.getMinElevationBelowMSL()*e:0,c=(n._camera.position[2]*n.worldSize-a)/Math.cos(n._pitch),d=Math.sin(i)*c/Math.sin(Math.max(Math.PI/2-n._pitch-i,.01)),g=Math.sin(n._pitch)*d+c;return Math.min(1.01*g,c*(1/n._horizonShift))}function Pl(n,e){if(!e.isReprojectedInTileSpace)return{scale:1<<n.z,x:n.x,y:n.y,x2:n.x+1,y2:n.y+1,projection:e};const i=Math.pow(2,-n.z),a=n.x*i,c=(n.x+1)*i,d=n.y*i,g=(n.y+1)*i,y=lo(a),b=lo(c),E=mr(d),A=mr(g),P=e.project(y,E),z=e.project(b,E),O=e.project(b,A),F=e.project(y,A);let q=Math.min(P.x,z.x,O.x,F.x),Z=Math.min(P.y,z.y,O.y,F.y),le=Math.max(P.x,z.x,O.x,F.x),ge=Math.max(P.y,z.y,O.y,F.y);const ae=i/16;function de(_e,$e,je,it,St,Ke){const ut=(je+St)/2,dt=(it+Ke)/2,vt=e.project(lo(ut),mr(dt)),Ct=Math.max(0,q-vt.x,Z-vt.y,vt.x-le,vt.y-ge);q=Math.min(q,vt.x),le=Math.max(le,vt.x),Z=Math.min(Z,vt.y),ge=Math.max(ge,vt.y),Ct>ae&&(de(_e,vt,je,it,ut,dt),de(vt,$e,ut,dt,St,Ke))}de(P,z,a,d,c,d),de(z,O,c,d,c,g),de(O,F,c,g,a,g),de(F,P,a,g,a,d),q-=ae,Z-=ae,le+=ae,ge+=ae;const be=1/Math.max(le-q,ge-Z);return{scale:be,x:q*be,y:Z*be,x2:le*be,y2:ge*be,projection:e}}const AA=qo(new Float32Array(16));class wa{constructor(e){this.spec=e,this.name=e.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(e,i){return{x:0,y:0,z:0}}unproject(e,i){return new qn(0,0)}projectTilePoint(e,i,a){return{x:e,y:i,z:0}}locationPoint(e,i,a=!0){return e._coordinatePoint(e.locationCoordinate(i),a)}pixelsPerMeter(e,i){return wo(1,e)*i}pixelSpaceConversion(e,i,a){return 1}farthestPixelDistance(e){return Ux(e,e.pixelsPerMeter)}pointCoordinate(e,i,a,c){const d=e.horizonLineFromTop(!1),g=new ce(i,Math.max(d,a));return e.rayIntersectionCoordinate(e.pointRayIntersection(g,c))}pointCoordinate3D(e,i,a){const c=new ce(i,a);if(e.elevation)return e.elevation.pointCoordinate(c);{const d=this.pointCoordinate(e,c.x,c.y,0);return[d.x,d.y,d.z]}}isPointAboveHorizon(e,i){if(e.elevation)return!this.pointCoordinate3D(e,i.x,i.y);const a=e.horizonLineFromTop();return i.y<a}createInversionMatrix(e,i){return AA}createTileMatrix(e,i,a){let c,d,g;const y=a.canonical,b=qo(new Float64Array(16));if(this.isReprojectedInTileSpace){const E=Pl(y,this);c=1,d=E.x+a.wrap*E.scale,g=E.y,Al(b,b,[c/E.scale,c/E.scale,e.pixelsPerMeter/i])}else c=i/e.zoomScale(y.z),d=(y.x+Math.pow(2,y.z)*a.wrap)*c,g=y.y*c;return kh(b,b,[d,g,0]),Al(b,b,[c/_n,c/_n,1]),b}upVector(e,i,a){return[0,0,1]}upVectorScale(e,i,a){return{metersToTile:1}}}class MA extends wa{constructor(e){super(e),this.range=[4,7],this.center=e.center||[-96,37.5];const[i,a]=this.parallels=e.parallels||[29.5,45.5],c=Math.sin(Ie(i));this.n=(c+Math.sin(Ie(a)))/2,this.c=1+c*(2*this.n-c),this.r0=Math.sqrt(this.c)/this.n}project(e,i){const{n:a,c,r0:d}=this,g=Ie(e-this.center[0]),y=Ie(i),b=Math.sqrt(c-2*a*Math.sin(y))/a;return{x:b*Math.sin(g*a),y:b*Math.cos(g*a)-d,z:0}}unproject(e,i){const{n:a,c,r0:d}=this,g=d+i;let y=Math.atan2(e,Math.abs(g))*Math.sign(g);g*a<0&&(y-=Math.PI*Math.sign(e)*Math.sign(g));const b=Ie(this.center[0])*a;y=Ge(y,-Math.PI-b,Math.PI-b);const E=lt(ke(y/a)+this.center[0],-180,180),A=Math.asin(lt((c-(e*e+g*g)*a*a)/(2*a),-1,1)),P=lt(ke(A),-85.051129,ls);return new qn(E,P)}}const ed=1.340264,td=-.081106,nd=893e-6,id=.003796,gp=Math.sqrt(3)/2;class IA extends wa{project(e,i){i=i/180*Math.PI,e=e/180*Math.PI;const a=Math.asin(gp*Math.sin(i)),c=a*a,d=c*c*c;return{x:.5*(e*Math.cos(a)/(gp*(ed+3*td*c+d*(7*nd+9*id*c)))/Math.PI+.5),y:1-.5*(a*(ed+td*c+d*(nd+id*c))/Math.PI+1),z:0}}unproject(e,i){e=(2*e-.5)*Math.PI;let a=i=(2*(1-i)-1)*Math.PI,c=a*a,d=c*c*c;for(let A,P,z,O=0;O<12&&(P=a*(ed+td*c+d*(nd+id*c))-i,z=ed+3*td*c+d*(7*nd+9*id*c),A=P/z,a=lt(a-A,-Math.PI/3,Math.PI/3),c=a*a,d=c*c*c,!(Math.abs(A)<1e-12));++O);const g=gp*e*(ed+3*td*c+d*(7*nd+9*id*c))/Math.cos(a),y=Math.asin(Math.sin(a)/gp),b=lt(180*g/Math.PI,-180,180),E=lt(180*y/Math.PI,-85.051129,ls);return new qn(b,E)}}class kA extends wa{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0}project(e,i){return{x:.5+e/360,y:.5-i/360,z:0}}unproject(e,i){const a=360*(e-.5),c=lt(360*(.5-i),-85.051129,ls);return new qn(a,c)}}const tu=Math.PI/2;function _p(n){return Math.tan((tu+n)/2)}class PA extends wa{constructor(e){super(e),this.center=e.center||[0,30];const[i,a]=this.parallels=e.parallels||[30,30];let c=Ie(i),d=Ie(a);this.southernCenter=c+d<0,this.southernCenter&&(c=-c,d=-d);const g=Math.cos(c),y=_p(c);this.n=c===d?Math.sin(c):Math.log(g/Math.cos(d))/Math.log(_p(d)/y),this.f=g*Math.pow(_p(c),this.n)/this.n}project(e,i){i=Ie(i),this.southernCenter&&(i=-i),e=Ie(e-this.center[0]);const a=1e-6,{n:c,f:d}=this;d>0?i<-tu+a&&(i=-tu+a):i>tu-a&&(i=tu-a);const g=d/Math.pow(_p(i),c);let y=g*Math.sin(c*e),b=d-g*Math.cos(c*e);return y=.5*(y/Math.PI+.5),b=.5*(b/Math.PI+.5),{x:y,y:this.southernCenter?b:1-b,z:0}}unproject(e,i){e=(2*e-.5)*Math.PI,this.southernCenter&&(i=1-i),i=(2*(1-i)-.5)*Math.PI;const{n:a,f:c}=this,d=c-i,g=Math.sign(d),y=Math.sign(a)*Math.sqrt(e*e+d*d);let b=Math.atan2(e,Math.abs(d))*g;d*a<0&&(b-=Math.PI*Math.sign(e)*g);const E=lt(ke(b/a)+this.center[0],-180,180),A=lt(ke(2*Math.atan(Math.pow(c/y,1/a))-tu),-85.051129,ls);return new qn(E,this.southernCenter?-A:A)}}class qx extends wa{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(e,i){return{x:ss(e),y:as(i),z:0}}unproject(e,i){const a=lo(e),c=mr(i);return new qn(a,c)}}const jx=Ie(ls);class zA extends wa{project(e,i){const a=(i=Ie(i))*i,c=a*a;return{x:.5*((e=Ie(e))*(.8707-.131979*a+c*(c*(.003971*a-.001529*c)-.013791))/Math.PI+.5),y:1-.5*(i*(1.007226+a*(.015085+c*(.028874*a-.044475-.005916*c)))/Math.PI+1),z:0}}unproject(e,i){e=(2*e-.5)*Math.PI;let a=i=(2*(1-i)-1)*Math.PI,c=25,d=0,g=a*a;do{g=a*a;const E=g*g;d=(a*(1.007226+g*(.015085+E*(.028874*g-.044475-.005916*E)))-i)/(1.007226+g*(.045255+E*(.259866*g-.311325-.005916*11*E))),a=lt(a-d,-jx,jx)}while(Math.abs(d)>1e-6&&--c>0);g=a*a;const y=lt(ke(e/(.8707+g*(g*(g*g*g*(.003971-.001529*g)-.013791)-.131979))),-180,180),b=ke(a);return new qn(y,b)}}const $x=Ie(ls);class LA extends wa{project(e,i){i=Ie(i),e=Ie(e);const a=Math.cos(i),c=2/Math.PI,d=Math.acos(a*Math.cos(e/2)),g=Math.sin(d)/d,y=.5*(e*c+2*a*Math.sin(e/2)/g)||0,b=.5*(i+Math.sin(i)/g)||0;return{x:.5*(y/Math.PI+.5),y:1-.5*(b/Math.PI+1),z:0}}unproject(e,i){let a=e=(2*e-.5)*Math.PI,c=i=(2*(1-i)-1)*Math.PI,d=25;const g=1e-6;let y=0,b=0;do{const E=Math.cos(c),A=Math.sin(c),P=2*A*E,z=A*A,O=E*E,F=Math.cos(a/2),q=Math.sin(a/2),Z=2*F*q,le=q*q,ge=1-O*F*F,ae=ge?1/ge:0,de=ge?Math.acos(E*F)*Math.sqrt(1/ge):0,be=.5*(2*de*E*q+2*a/Math.PI)-e,_e=.5*(de*A+c)-i,$e=.5*ae*(O*le+de*E*F*z)+1/Math.PI,je=ae*(Z*P/4-de*A*q),it=.125*ae*(P*q-de*A*O*Z),St=.5*ae*(z*F+de*le*E)+.5,Ke=je*it-St*$e;y=(_e*je-be*St)/Ke,b=(be*it-_e*$e)/Ke,a=lt(a-y,-Math.PI,Math.PI),c=lt(c-b,-$x,$x)}while((Math.abs(y)>g||Math.abs(b)>g)&&--d>0);return new qn(ke(a),ke(c))}}class Gx extends wa{constructor(e){super(e),this.center=e.center||[0,0],this.parallels=e.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(Ie(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(e,i){const{scale:a,cosPhi:c}=this;return{x:Ie(e)*c*a+.5,y:-Math.sin(Ie(i))/c*a+.5,z:0}}unproject(e,i){const{scale:a,cosPhi:c}=this,d=-(i-.5)/a,g=lt(ke((e-.5)/a)/c,-180,180),y=Math.asin(lt(d*c,-1,1)),b=lt(ke(y),-85.051129,ls);return new qn(g,b)}}class RA extends qx{constructor(e){super(e),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug","custom"],this.range=[3,5]}projectTilePoint(e,i,a){const c=Qh(e,i,a);return Di(c,c,Jh(us(a))),{x:c[0],y:c[1],z:c[2]}}locationPoint(e,i){const a=Yh(i.lat,i.lng),c=zr([],a),d=e.elevation?e.elevation.getAtPointOrZero(e.locationCoordinate(i),e._centerAltitude):e._centerAltitude;Rh(a,a,c,wo(1,0)*_n*d);const g=qo(new Float64Array(16));return Cl(g,e.pixelMatrix,e.globeMatrix),Di(a,a,g),new ce(a[0],a[1])}pixelsPerMeter(e,i){return wo(1,0)*i}pixelSpaceConversion(e,i,a){const c=wo(1,e)*i,d=$n(wo(1,45)*i,c,a);return this.pixelsPerMeter(e,i)/d}createTileMatrix(e,i,a){const c=f_(us(a.canonical));return Cl(new Float64Array(16),e.globeMatrix,c)}createInversionMatrix(e,i){const{center:a}=e,c=Jh(us(i));return Kf(c,c,Ie(a.lng)),Fg(c,c,Ie(a.lat)),Al(c,c,[e._pixelsPerMercatorPixel,e._pixelsPerMercatorPixel,1]),Float32Array.from(c)}pointCoordinate(e,i,a,c){return Rx(e,i,a,!0)||new Nc(0,0)}pointCoordinate3D(e,i,a){const c=this.pointCoordinate(e,i,a,0);return[c.x,c.y,c.z]}isPointAboveHorizon(e,i){return!Rx(e,i.x,i.y,!1)}farthestPixelDistance(e){const i=function(c,d){const g=c.cameraToCenterDistance,y=c._centerAltitude*d,b=c._camera,E=c._camera.forward(),A=Ds([],co([],E,-g),[0,0,y]),P=c.worldSize/(2*Math.PI),z=[0,0,-P],O=c.width/c.height,F=Math.tan(c.fovAboveCenter),q=co([],b.up(),F),Z=co([],b.right(),F*O),le=zr([],Ds([],Ds([],E,q),Z)),ge=[];let ae;if(new qg(A,le).closestPointOnSphere(z,P,ge)){const de=Ds([],ge,z),be=jo([],de,A);ae=Math.cos(c.fovAboveCenter)*Ph(be)}else{const de=jo([],A,z),be=jo([],z,A);zr(be,be);const _e=Ph(de)-P;ae=Math.sqrt(_e*(_e+2*P));const $e=Math.acos(ae/(P+_e))-Math.acos(Eo(E,be));ae*=Math.cos($e)}return 1.01*ae}(e,this.pixelsPerMeter(e.center.lat,e.worldSize)),a=eu(e.zoom);if(a>0){const c=Ux(e,wo(1,e.center.lat)*e.worldSize),d=e.worldSize/(2*Math.PI),g=Math.max(e.width,e.height)/e.worldSize*Math.PI;return $n(i,c+d*(1-Math.cos(g)),Math.pow(a,10))}return i}upVector(e,i,a){return Qh(i,a,e,1)}upVectorScale(e){return{metersToTile:u_*mp(us(e))}}}function Zx(n){const e=n.parallels,i=!!e&&Math.abs(e[0]+e[1])<.01;switch(n.name){case"mercator":return new qx(n);case"equirectangular":return new kA(n);case"naturalEarth":return new zA(n);case"equalEarth":return new IA(n);case"winkelTripel":return new LA(n);case"albers":return i?new Gx(n):new MA(n);case"lambertConformalConic":return i?new Gx(n):new PA(n);case"globe":return new RA(n)}throw new Error(`Invalid projection name: ${n.name}`)}const DA=ip.types,OA=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function yp(n,e,i,a,c,d,g,y,b,E,A,P,z){const O=y?Math.min(ba,Math.round(y[0])):0,F=y?Math.min(ba,Math.round(y[1])):0;n.emplaceBack(e,i,Math.round(32*a),Math.round(32*c),d,g,(O<<1)+(b?1:0),F,16*E,16*A,256*P,256*z)}function vp(n,e,i,a,c,d,g){n.emplaceBack(e,i,a,c,d,g)}function xp(n,e,i,a,c){n.emplaceBack(e,i,a,c),n.emplaceBack(e,i,a,c),n.emplaceBack(e,i,a,c),n.emplaceBack(e,i,a,c)}function BA(n){for(const e of n.sections)if(Q(e.text))return!0;return!1}class m_{constructor(e){this.layoutVertexArray=new ci,this.indexArray=new pr,this.programConfigurations=e,this.segments=new Hi,this.dynamicLayoutVertexArray=new $r,this.opacityVertexArray=new Ri,this.placedSymbolArray=new Gv,this.globeExtVertexArray=new Gn}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(e,i,a,c){this.isEmpty()||(a&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,NC.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,i),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,UC.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,OA,!0),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,VC.members,!0)),this.opacityVertexBuffer.itemSize=1),(a||c)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}}Zt(m_,"SymbolBuffers");class g_{constructor(e,i,a){this.layoutVertexArray=new e,this.layoutAttributes=i,this.indexArray=new a,this.segments=new Hi,this.collisionVertexArray=new bl,this.collisionVertexArrayExt=new No}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,qC.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,jC.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}Zt(g_,"CollisionBuffers");class Ea{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(g=>g.id),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=qo([]),this.placementViewportMatrix=qo([]);const i=this.layers[0]._unevaluatedLayout._values;this.textSizeData=e_(this.zoom,i["text-size"]),this.iconSizeData=e_(this.zoom,i["icon-size"]);const a=this.layers[0].layout,c=a.get("symbol-sort-key"),d=a.get("symbol-z-order");this.canOverlap=a.get("text-allow-overlap")||a.get("icon-allow-overlap")||a.get("text-ignore-placement")||a.get("icon-ignore-placement"),this.sortFeaturesByKey=d!=="viewport-y"&&c.constantOr(1)!==void 0,this.sortFeaturesByY=(d==="viewport-y"||d==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=a.get("text-writing-mode").map(g=>uo[g]),this.stateDependentLayerIds=this.layers.filter(g=>g.isStateDependent()).map(g=>g.id),this.sourceID=e.sourceID,this.projection=e.projection}createArrays(){this.text=new m_(new El(this.layers,this.zoom,e=>/^text/.test(e))),this.icon=new m_(new El(this.layers,this.zoom,e=>/^icon/.test(e))),this.glyphOffsetArray=new Wv,this.lineVertexArray=new Xv,this.symbolInstances=new Hv}calculateGlyphDependencies(e,i,a,c,d){for(let g=0;g<e.length;g++)if(i[e.charCodeAt(g)]=!0,c&&d){const y=Zh[e.charAt(g)];y&&(i[y.charCodeAt(0)]=!0)}}populate(e,i,a,c){const d=this.layers[0],g=d.layout,y=this.projection.name==="globe",b=g.get("text-font"),E=g.get("text-field"),A=g.get("icon-image"),P=(E.value.kind!=="constant"||E.value.value instanceof ir&&!E.value.value.isEmpty()||E.value.value.toString().length>0)&&(b.value.kind!=="constant"||b.value.value.length>0),z=A.value.kind!=="constant"||!!A.value.value||Object.keys(A.parameters).length>0,O=g.get("symbol-sort-key");if(this.features=[],!P&&!z)return;const F=i.iconDependencies,q=i.glyphDependencies,Z=i.availableImages,le=new Le(this.zoom);for(const{feature:ge,id:ae,index:de,sourceLayerIndex:be}of e){const _e=d._featureFilter.needGeometry,$e=Tl(ge,_e);if(!d._featureFilter.filter(le,$e,a))continue;if(_e||($e.geometry=Rs(ge,a,c)),y&&ge.type!==1&&a.z<=5){const Ke=$e.geometry,ut=.98078528056,dt=(vt,Ct)=>Eo(Qh(vt.x,vt.y,a,1),Qh(Ct.x,Ct.y,a,1))<ut;for(let vt=0;vt<Ke.length;vt++)Ke[vt]=B2(Ke[vt],dt)}let je,it;if(P){const Ke=d.getValueAndResolveTokens("text-field",$e,a,Z),ut=ir.factory(Ke);BA(ut)&&(this.hasRTLText=!0),(!this.hasRTLText||Pe()==="unavailable"||this.hasRTLText&&qe.isParsed())&&(je=ZC(ut,d,$e))}if(z){const Ke=d.getValueAndResolveTokens("icon-image",$e,a,Z);it=Ke instanceof Wr?Ke:Wr.fromString(Ke)}if(!je&&!it)continue;const St=this.sortFeaturesByKey?O.evaluate($e,{},a):void 0;if(this.features.push({id:ae,text:je,icon:it,index:de,sourceLayerIndex:be,geometry:$e.geometry,properties:ge.properties,type:DA[ge.type],sortKey:St}),it&&(F[it.name]=!0),je){const Ke=b.evaluate($e,{},a).join(","),ut=g.get("text-rotation-alignment")==="map"&&g.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(uo.vertical)>=0;for(const dt of je.sections)if(dt.image)F[dt.image.name]=!0;else{const vt=T(je.toString()),Ct=dt.fontStack||Ke,Qe=q[Ct]=q[Ct]||{};this.calculateGlyphDependencies(dt.text,Qe,ut,this.allowVerticalPlacement,vt)}}}g.get("symbol-placement")==="line"&&(this.features=function(ge){const ae={},de={},be=[];let _e=0;function $e(Ke){be.push(ge[Ke]),_e++}function je(Ke,ut,dt){const vt=de[Ke];return delete de[Ke],de[ut]=vt,be[vt].geometry[0].pop(),be[vt].geometry[0]=be[vt].geometry[0].concat(dt[0]),vt}function it(Ke,ut,dt){const vt=ae[ut];return delete ae[ut],ae[Ke]=vt,be[vt].geometry[0].shift(),be[vt].geometry[0]=dt[0].concat(be[vt].geometry[0]),vt}function St(Ke,ut,dt){const vt=dt?ut[0][ut[0].length-1]:ut[0][0];return`${Ke}:${vt.x}:${vt.y}`}for(let Ke=0;Ke<ge.length;Ke++){const ut=ge[Ke],dt=ut.geometry,vt=ut.text?ut.text.toString():null;if(!vt){$e(Ke);continue}const Ct=St(vt,dt),Qe=St(vt,dt,!0);if(Ct in de&&Qe in ae&&de[Ct]!==ae[Qe]){const Dt=it(Ct,Qe,dt),dn=je(Ct,Qe,be[Dt].geometry);delete ae[Ct],delete de[Qe],de[St(vt,be[dn].geometry,!0)]=dn,be[Dt].geometry=null}else Ct in de?je(Ct,Qe,dt):Qe in ae?it(Ct,Qe,dt):($e(Ke),ae[Ct]=_e-1,de[Qe]=_e-1)}return be.filter(Ke=>Ke.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((ge,ae)=>ge.sortKey-ae.sortKey)}update(e,i,a,c){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(e,i,this.layers,a,c),this.icon.programConfigurations.updatePaintArrays(e,i,this.layers,a,c))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=Zx(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,i){const a=this.lineVertexArray.length;if(e.segment!==void 0)for(const{x:c,y:d}of i)this.lineVertexArray.emplaceBack(c,d);return{lineStartIndex:a,lineLength:this.lineVertexArray.length-a}}addSymbols(e,i,a,c,d,g,y,b,E,A,P,z,O,F){const q=e.indexArray,Z=e.layoutVertexArray,le=e.globeExtVertexArray,ge=e.segments.prepareSegment(4*i.length,Z,q,this.canOverlap?g.sortKey:void 0),ae=this.glyphOffsetArray.length,de=ge.vertexLength,be=this.allowVerticalPlacement&&y===uo.vertical?Math.PI/2:0,_e=g.text&&g.text.sections;for(let je=0;je<i.length;je++){const{tl:it,tr:St,bl:Ke,br:ut,tex:dt,pixelOffsetTL:vt,pixelOffsetBR:Ct,minFontScaleX:Qe,minFontScaleY:Dt,glyphOffset:dn,isSDF:Ut,sectionIndex:en}=i[je],Ot=ge.vertexLength,pn=dn[1];if(yp(Z,E.x,E.y,it.x,pn+it.y,dt.x,dt.y,a,Ut,vt.x,vt.y,Qe,Dt),yp(Z,E.x,E.y,St.x,pn+St.y,dt.x+dt.w,dt.y,a,Ut,Ct.x,vt.y,Qe,Dt),yp(Z,E.x,E.y,Ke.x,pn+Ke.y,dt.x,dt.y+dt.h,a,Ut,vt.x,Ct.y,Qe,Dt),yp(Z,E.x,E.y,ut.x,pn+ut.y,dt.x+dt.w,dt.y+dt.h,a,Ut,Ct.x,Ct.y,Qe,Dt),b){const{x:Rn,y:Pn,z:An}=b.anchor,[gn,ti,wn]=b.up;vp(le,Rn,Pn,An,gn,ti,wn),vp(le,Rn,Pn,An,gn,ti,wn),vp(le,Rn,Pn,An,gn,ti,wn),vp(le,Rn,Pn,An,gn,ti,wn),xp(e.dynamicLayoutVertexArray,Rn,Pn,An,be)}else xp(e.dynamicLayoutVertexArray,E.x,E.y,E.z,be);q.emplaceBack(Ot,Ot+1,Ot+2),q.emplaceBack(Ot+1,Ot+2,Ot+3),ge.vertexLength+=4,ge.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(dn[0]),je!==i.length-1&&en===i[je+1].sectionIndex||e.programConfigurations.populatePaintArrays(Z.length,g,g.index,{},O,F,_e&&_e[en])}const $e=b?b.anchor:E;e.placedSymbolArray.emplaceBack($e.x,$e.y,$e.z,E.x,E.y,ae,this.glyphOffsetArray.length-ae,de,A,P,E.segment,a?a[0]:0,a?a[1]:0,c[0],c[1],y,0,!1,0,z,0)}_commitLayoutVertex(e,i,a,c,d,g,y){e.emplaceBack(i,a,c,d,g,Math.round(y.x),Math.round(y.y))}_addCollisionDebugVertices(e,i,a,c,d,g,y){const b=a.segments.prepareSegment(4,a.layoutVertexArray,a.indexArray),E=b.vertexLength,A=y.tileAnchorX,P=y.tileAnchorY;for(let O=0;O<4;O++)a.collisionVertexArray.emplaceBack(0,0,0,0);a.collisionVertexArrayExt.emplaceBack(i,-e.padding,-e.padding),a.collisionVertexArrayExt.emplaceBack(i,e.padding,-e.padding),a.collisionVertexArrayExt.emplaceBack(i,e.padding,e.padding),a.collisionVertexArrayExt.emplaceBack(i,-e.padding,e.padding),this._commitLayoutVertex(a.layoutVertexArray,c,d,g,A,P,new ce(e.x1,e.y1)),this._commitLayoutVertex(a.layoutVertexArray,c,d,g,A,P,new ce(e.x2,e.y1)),this._commitLayoutVertex(a.layoutVertexArray,c,d,g,A,P,new ce(e.x2,e.y2)),this._commitLayoutVertex(a.layoutVertexArray,c,d,g,A,P,new ce(e.x1,e.y2)),b.vertexLength+=4;const z=a.indexArray;z.emplaceBack(E,E+1),z.emplaceBack(E+1,E+2),z.emplaceBack(E+2,E+3),z.emplaceBack(E+3,E),b.primitiveLength+=4}_addTextDebugCollisionBoxes(e,i,a,c,d,g){for(let y=c;y<d;y++){const b=a.get(y),E=this.getSymbolInstanceTextSize(e,g,i,y);this._addCollisionDebugVertices(b,E,this.textCollisionBox,b.projectedAnchorX,b.projectedAnchorY,b.projectedAnchorZ,g)}}_addIconDebugCollisionBoxes(e,i,a,c,d,g){for(let y=c;y<d;y++){const b=a.get(y),E=this.getSymbolInstanceIconSize(e,i,g.placedIconSymbolIndex);this._addCollisionDebugVertices(b,E,this.iconCollisionBox,b.projectedAnchorX,b.projectedAnchorY,b.projectedAnchorZ,g)}}generateCollisionDebugBuffers(e,i){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new g_(di,ox.members,bo),this.iconCollisionBox=new g_(di,ox.members,bo);const a=Gc(this.iconSizeData,e),c=Gc(this.textSizeData,e);for(let d=0;d<this.symbolInstances.length;d++){const g=this.symbolInstances.get(d);this._addTextDebugCollisionBoxes(c,e,i,g.textBoxStartIndex,g.textBoxEndIndex,g),this._addTextDebugCollisionBoxes(c,e,i,g.verticalTextBoxStartIndex,g.verticalTextBoxEndIndex,g),this._addIconDebugCollisionBoxes(a,e,i,g.iconBoxStartIndex,g.iconBoxEndIndex,g),this._addIconDebugCollisionBoxes(a,e,i,g.verticalIconBoxStartIndex,g.verticalIconBoxEndIndex,g)}}getSymbolInstanceTextSize(e,i,a,c){const d=this.text.placedSymbolArray.get(i.rightJustifiedTextSymbolIndex>=0?i.rightJustifiedTextSymbolIndex:i.centerJustifiedTextSymbolIndex>=0?i.centerJustifiedTextSymbolIndex:i.leftJustifiedTextSymbolIndex>=0?i.leftJustifiedTextSymbolIndex:i.verticalPlacedTextSymbolIndex>=0?i.verticalPlacedTextSymbolIndex:c),g=ap(this.textSizeData,e,d)/gr;return this.tilePixelRatio*g}getSymbolInstanceIconSize(e,i,a){const c=this.icon.placedSymbolArray.get(a),d=ap(this.iconSizeData,e,c);return this.tilePixelRatio*d}_commitDebugCollisionVertexUpdate(e,i,a){e.emplaceBack(i,-a,-a),e.emplaceBack(i,a,-a),e.emplaceBack(i,a,a),e.emplaceBack(i,-a,a)}_updateTextDebugCollisionBoxes(e,i,a,c,d,g){for(let y=c;y<d;y++){const b=a.get(y),E=this.getSymbolInstanceTextSize(e,g,i,y);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,E,b.padding)}}_updateIconDebugCollisionBoxes(e,i,a,c,d,g){for(let y=c;y<d;y++){const b=a.get(y),E=this.getSymbolInstanceIconSize(e,i,g);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,E,b.padding)}}updateCollisionDebugBuffers(e,i){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const a=Gc(this.iconSizeData,e),c=Gc(this.textSizeData,e);for(let d=0;d<this.symbolInstances.length;d++){const g=this.symbolInstances.get(d);this._updateTextDebugCollisionBoxes(c,e,i,g.textBoxStartIndex,g.textBoxEndIndex,g),this._updateTextDebugCollisionBoxes(c,e,i,g.verticalTextBoxStartIndex,g.verticalTextBoxEndIndex,g),this._updateIconDebugCollisionBoxes(a,e,i,g.iconBoxStartIndex,g.iconBoxEndIndex,g.placedIconSymbolIndex),this._updateIconDebugCollisionBoxes(a,e,i,g.verticalIconBoxStartIndex,g.verticalIconBoxEndIndex,g.placedIconSymbolIndex)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(e,i,a,c,d,g,y,b,E){const A={};if(i<a){const{x1:P,y1:z,x2:O,y2:F,padding:q,projectedAnchorX:Z,projectedAnchorY:le,projectedAnchorZ:ge,tileAnchorX:ae,tileAnchorY:de,featureIndex:be}=e.get(i);A.textBox={x1:P,y1:z,x2:O,y2:F,padding:q,projectedAnchorX:Z,projectedAnchorY:le,projectedAnchorZ:ge,tileAnchorX:ae,tileAnchorY:de},A.textFeatureIndex=be}if(c<d){const{x1:P,y1:z,x2:O,y2:F,padding:q,projectedAnchorX:Z,projectedAnchorY:le,projectedAnchorZ:ge,tileAnchorX:ae,tileAnchorY:de,featureIndex:be}=e.get(c);A.verticalTextBox={x1:P,y1:z,x2:O,y2:F,padding:q,projectedAnchorX:Z,projectedAnchorY:le,projectedAnchorZ:ge,tileAnchorX:ae,tileAnchorY:de},A.verticalTextFeatureIndex=be}if(g<y){const{x1:P,y1:z,x2:O,y2:F,padding:q,projectedAnchorX:Z,projectedAnchorY:le,projectedAnchorZ:ge,tileAnchorX:ae,tileAnchorY:de,featureIndex:be}=e.get(g);A.iconBox={x1:P,y1:z,x2:O,y2:F,padding:q,projectedAnchorX:Z,projectedAnchorY:le,projectedAnchorZ:ge,tileAnchorX:ae,tileAnchorY:de},A.iconFeatureIndex=be}if(b<E){const{x1:P,y1:z,x2:O,y2:F,padding:q,projectedAnchorX:Z,projectedAnchorY:le,projectedAnchorZ:ge,tileAnchorX:ae,tileAnchorY:de,featureIndex:be}=e.get(b);A.verticalIconBox={x1:P,y1:z,x2:O,y2:F,padding:q,projectedAnchorX:Z,projectedAnchorY:le,projectedAnchorZ:ge,tileAnchorX:ae,tileAnchorY:de},A.verticalIconFeatureIndex=be}return A}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let i=0;i<this.symbolInstances.length;i++){const a=this.symbolInstances.get(i);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,a.textBoxStartIndex,a.textBoxEndIndex,a.verticalTextBoxStartIndex,a.verticalTextBoxEndIndex,a.iconBoxStartIndex,a.iconBoxEndIndex,a.verticalIconBoxStartIndex,a.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(e,i){const a=e.placedSymbolArray.get(i),c=a.vertexStartIndex+4*a.numGlyphs;for(let d=a.vertexStartIndex;d<c;d+=4)e.indexArray.emplaceBack(d,d+1,d+2),e.indexArray.emplaceBack(d+1,d+2,d+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const i=Math.sin(e),a=Math.cos(e),c=[],d=[],g=[];for(let y=0;y<this.symbolInstances.length;++y){g.push(y);const b=this.symbolInstances.get(y);c.push(0|Math.round(i*b.tileAnchorX+a*b.tileAnchorY)),d.push(b.featureIndex)}return g.sort((y,b)=>c[y]-c[b]||d[b]-d[y]),g}addToSortKeyRanges(e,i){const a=this.sortKeyRanges[this.sortKeyRanges.length-1];a&&a.sortKey===i?a.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:i,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const i of this.symbolInstanceIndexes){const a=this.symbolInstances.get(i);this.featureSortOrder.push(a.featureIndex);const{rightJustifiedTextSymbolIndex:c,centerJustifiedTextSymbolIndex:d,leftJustifiedTextSymbolIndex:g,verticalPlacedTextSymbolIndex:y,placedIconSymbolIndex:b,verticalPlacedIconSymbolIndex:E}=a;c>=0&&this.addIndicesForPlacedSymbol(this.text,c),d>=0&&d!==c&&this.addIndicesForPlacedSymbol(this.text,d),g>=0&&g!==d&&g!==c&&this.addIndicesForPlacedSymbol(this.text,g),y>=0&&this.addIndicesForPlacedSymbol(this.text,y),b>=0&&this.addIndicesForPlacedSymbol(this.icon,b),E>=0&&this.addIndicesForPlacedSymbol(this.icon,E)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}Zt(Ea,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),Ea.MAX_GLYPHS=65535,Ea.addDynamicAttributes=xp;const FA=new ln({"symbol-placement":new De(tt.layout_symbol["symbol-placement"]),"symbol-spacing":new De(tt.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new De(tt.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new We(tt.layout_symbol["symbol-sort-key"]),"symbol-z-order":new De(tt.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new De(tt.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new De(tt.layout_symbol["icon-ignore-placement"]),"icon-optional":new De(tt.layout_symbol["icon-optional"]),"icon-rotation-alignment":new De(tt.layout_symbol["icon-rotation-alignment"]),"icon-size":new We(tt.layout_symbol["icon-size"]),"icon-text-fit":new De(tt.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new De(tt.layout_symbol["icon-text-fit-padding"]),"icon-image":new We(tt.layout_symbol["icon-image"]),"icon-rotate":new We(tt.layout_symbol["icon-rotate"]),"icon-padding":new De(tt.layout_symbol["icon-padding"]),"icon-keep-upright":new De(tt.layout_symbol["icon-keep-upright"]),"icon-offset":new We(tt.layout_symbol["icon-offset"]),"icon-anchor":new We(tt.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new De(tt.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new De(tt.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new De(tt.layout_symbol["text-rotation-alignment"]),"text-field":new We(tt.layout_symbol["text-field"]),"text-font":new We(tt.layout_symbol["text-font"]),"text-size":new We(tt.layout_symbol["text-size"]),"text-max-width":new We(tt.layout_symbol["text-max-width"]),"text-line-height":new We(tt.layout_symbol["text-line-height"]),"text-letter-spacing":new We(tt.layout_symbol["text-letter-spacing"]),"text-justify":new We(tt.layout_symbol["text-justify"]),"text-radial-offset":new We(tt.layout_symbol["text-radial-offset"]),"text-variable-anchor":new De(tt.layout_symbol["text-variable-anchor"]),"text-anchor":new We(tt.layout_symbol["text-anchor"]),"text-max-angle":new De(tt.layout_symbol["text-max-angle"]),"text-writing-mode":new De(tt.layout_symbol["text-writing-mode"]),"text-rotate":new We(tt.layout_symbol["text-rotate"]),"text-padding":new De(tt.layout_symbol["text-padding"]),"text-keep-upright":new De(tt.layout_symbol["text-keep-upright"]),"text-transform":new We(tt.layout_symbol["text-transform"]),"text-offset":new We(tt.layout_symbol["text-offset"]),"text-allow-overlap":new De(tt.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new De(tt.layout_symbol["text-ignore-placement"]),"text-optional":new De(tt.layout_symbol["text-optional"])});var __={paint:new ln({"icon-opacity":new We(tt.paint_symbol["icon-opacity"]),"icon-color":new We(tt.paint_symbol["icon-color"]),"icon-halo-color":new We(tt.paint_symbol["icon-halo-color"]),"icon-halo-width":new We(tt.paint_symbol["icon-halo-width"]),"icon-halo-blur":new We(tt.paint_symbol["icon-halo-blur"]),"icon-translate":new De(tt.paint_symbol["icon-translate"]),"icon-translate-anchor":new De(tt.paint_symbol["icon-translate-anchor"]),"text-opacity":new We(tt.paint_symbol["text-opacity"]),"text-color":new We(tt.paint_symbol["text-color"],{runtimeType:ao,getOverride:n=>n.textColor,hasOverride:n=>!!n.textColor}),"text-halo-color":new We(tt.paint_symbol["text-halo-color"]),"text-halo-width":new We(tt.paint_symbol["text-halo-width"]),"text-halo-blur":new We(tt.paint_symbol["text-halo-blur"]),"text-translate":new De(tt.paint_symbol["text-translate"]),"text-translate-anchor":new De(tt.paint_symbol["text-translate-anchor"])}),layout:FA};class Hx{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:br,this.defaultValue=e}evaluate(e){if(e.formattedSection){const i=this.defaultValue.property.overrides;if(i&&i.hasOverride(e.formattedSection))return i.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Zt(Hx,"FormatSectionOverride",{omit:["defaultValue"]});class bp extends Uo{constructor(e){super(e,__)}recalculate(e,i){super.recalculate(e,i),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const a=this.layout.get("text-writing-mode");if(a){const c=[];for(const d of a)c.indexOf(d)<0&&c.push(d);this.layout._values["text-writing-mode"]=c}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(e,i,a,c){const d=this.layout.get(e).evaluate(i,{},a,c),g=this._unevaluatedLayout._values[e];return g.isDataDriven()||fl(g.value)||!d?d:function(y,b){return b.replace(/{([^{}]+)}/g,(E,A)=>A in y?String(y[A]):"")}(i.properties,d)}createBucket(e){return new Ea(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const e of __.paint.overridableProperties){if(!bp.hasPaintOverride(this.layout,e))continue;const i=this.paint.get(e),a=new Hx(i),c=new Mc(a,i.property.specification);let d=null;d=i.value.kind==="constant"||i.value.kind==="source"?new rs("source",c):new Ic("composite",c,i.value.zoomStops,i.value._interpolationType),this.paint._values[e]=new pt(i.property,d,i.parameters)}}_handleOverridablePaintPropertyUpdate(e,i,a){return!(!this.layout||i.isDataDriven()||a.isDataDriven())&&bp.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,i){const a=e.get("text-field"),c=__.paint.properties[i];let d=!1;const g=y=>{for(const b of y)if(c.overrides&&c.overrides.hasOverride(b))return void(d=!0)};if(a.value.kind==="constant"&&a.value.value instanceof ir)g(a.value.value.sections);else if(a.value.kind==="source"){const y=E=>{d||(E instanceof tl&&Zi(E.value)===na?g(E.value.sections):E instanceof nl?g(E.sections):E.eachChild(y))},b=a.value;b._styleExpression&&y(b._styleExpression.expression)}return d}getProgramConfiguration(e){return new va(this,e)}}var NA={paint:new ln({"background-color":new De(tt.paint_background["background-color"]),"background-pattern":new De(tt.paint_background["background-pattern"]),"background-opacity":new De(tt.paint_background["background-opacity"])})},VA={paint:new ln({"raster-opacity":new De(tt.paint_raster["raster-opacity"]),"raster-hue-rotate":new De(tt.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new De(tt.paint_raster["raster-brightness-min"]),"raster-brightness-max":new De(tt.paint_raster["raster-brightness-max"]),"raster-saturation":new De(tt.paint_raster["raster-saturation"]),"raster-contrast":new De(tt.paint_raster["raster-contrast"]),"raster-resampling":new De(tt.paint_raster["raster-resampling"]),"raster-fade-duration":new De(tt.paint_raster["raster-fade-duration"])})};class UA extends Uo{constructor(e){super(e,{}),this.implementation=e}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}var qA={paint:new ln({"sky-type":new De(tt.paint_sky["sky-type"]),"sky-atmosphere-sun":new De(tt.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new De(tt.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new De(tt.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new De(tt.paint_sky["sky-gradient-radius"]),"sky-gradient":new Qt(tt.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new De(tt.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new De(tt.paint_sky["sky-atmosphere-color"]),"sky-opacity":new De(tt.paint_sky["sky-opacity"])})};function y_(n,e,i){const a=[0,0,1],c=M0([]);return k0(c,c,i?-Ie(n)+Math.PI:Ie(n)),I0(c,c,-Ie(e)),T0(a,a,c),zr(a,a)}const jA={circle:class extends Uo{constructor(n){super(n,$2)}createBucket(n){return new Rg(n)}queryRadius(n){const e=n;return Vc("circle-radius",this,e)+Vc("circle-stroke-width",this,e)+Wf(this.paint.get("circle-translate"))}queryIntersectsFeature(n,e,i,a,c,d,g,y){const b=_0(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),d.angle,n.pixelToTileUnitsFactor),E=this.paint.get("circle-radius").evaluate(e,i)+this.paint.get("circle-stroke-width").evaluate(e,i);return P0(n,a,d,g,y,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",b,E)}getProgramIds(){return["circle"]}getProgramConfiguration(n){return new va(this,n)}},heatmap:class extends Uo{createBucket(n){return new L0(n)}constructor(n){super(n,Q2),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(n){n==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Zg({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(n){return Vc("heatmap-radius",this,n)}queryIntersectsFeature(n,e,i,a,c,d,g,y){const b=this.paint.get("heatmap-radius").evaluate(e,i);return P0(n,a,d,g,y,!0,!0,new ce(0,0),b)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getProgramConfiguration(n){return new va(this,n)}},hillshade:class extends Uo{constructor(n){super(n,J2)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}},fill:class extends Uo{constructor(n){super(n,mC)}getProgramIds(){const n=this.paint.get("fill-pattern"),e=n&&n.constantOr(1),i=[e?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&i.push(e&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),i}getProgramConfiguration(n){return new va(this,n)}recalculate(n,e){super.recalculate(n,e);const i=this.paint._values["fill-outline-color"];i.value.kind==="constant"&&i.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(n){return new tp(n)}queryRadius(){return Wf(this.paint.get("fill-translate"))}queryIntersectsFeature(n,e,i,a,c,d){return!n.queryGeometry.isAboveHorizon&&d0(g0(n.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),d.angle,n.pixelToTileUnitsFactor),a)}isTileClipped(){return!0}},"fill-extrusion":class extends Uo{constructor(n){super(n,PC)}createBucket(n){return new jh(n)}queryRadius(){return Wf(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}getProgramConfiguration(n){return new va(this,n)}queryIntersectsFeature(n,e,i,a,c,d,g,y,b){const E=_0(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),d.angle,n.pixelToTileUnitsFactor),A=this.paint.get("fill-extrusion-height").evaluate(e,i),P=this.paint.get("fill-extrusion-base").evaluate(e,i),z=[0,0],O=y&&d.elevation,F=d.elevation?d.elevation.exaggeration():1,q=n.tile.getBucket(this);if(O&&q instanceof jh){const de=q.centroidVertexArray,be=b+1;be<de.length&&(z[0]=de.geta_centroid_pos0(be),z[1]=de.geta_centroid_pos1(be))}if(z[0]===0&&z[1]===1)return!1;d.projection.name==="globe"&&(a=Y0([a],[new ce(0,0),new ce(_n,_n)],n.tileID.canonical).map(de=>de.polygon).flat());const Z=O?y:null,[le,ge]=function(de,be,_e,$e,je,it,St,Ke,ut,dt,vt){return de.projection.name==="globe"?function(Ct,Qe,Dt,dn,Ut,en,Ot,pn,Rn,Pn,An){const gn=[],ti=[],wn=Ct.projection.upVectorScale(An,Ct.center.lat,Ct.worldSize).metersToTile,Dn=[0,0,0,1],ri=[0,0,0,1],_i=(yi,vi,Pi,or)=>{yi[0]=vi,yi[1]=Pi,yi[2]=or,yi[3]=1},pi=K0();Dt>0&&(Dt+=pi),dn+=pi;for(const yi of Qe){const vi=[],Pi=[];for(const or of yi){const ni=or.x+Ut.x,Wi=or.y+Ut.y,Ni=Ct.projection.projectTilePoint(ni,Wi,An),Zn=Ct.projection.upVector(An,or.x,or.y);let Si=Dt,Yi=dn;if(Ot){const oi=tx(ni,Wi,Dt,dn,Ot,pn,Rn,Pn);Si+=oi.base,Yi+=oi.top}Dt!==0?_i(Dn,Ni.x+Zn[0]*wn*Si,Ni.y+Zn[1]*wn*Si,Ni.z+Zn[2]*wn*Si):_i(Dn,Ni.x,Ni.y,Ni.z),_i(ri,Ni.x+Zn[0]*wn*Yi,Ni.y+Zn[1]*wn*Yi,Ni.z+Zn[2]*wn*Yi),Di(Dn,Dn,en),Di(ri,ri,en),vi.push(new $c(Dn[0],Dn[1],Dn[2])),Pi.push(new $c(ri[0],ri[1],ri[2]))}gn.push(vi),ti.push(Pi)}return[gn,ti]}(de,be,_e,$e,je,it,St,Ke,ut,dt,vt):St?function(Ct,Qe,Dt,dn,Ut,en,Ot,pn,Rn){const Pn=[],An=[],gn=[0,0,0,1];for(const ti of Ct){const wn=[],Dn=[];for(const ri of ti){const _i=ri.x+dn.x,pi=ri.y+dn.y,yi=tx(_i,pi,Qe,Dt,en,Ot,pn,Rn);gn[0]=_i,gn[1]=pi,gn[2]=yi.base,gn[3]=1,Ml(gn,gn,Ut),gn[3]=Math.max(gn[3],1e-5);const vi=new $c(gn[0]/gn[3],gn[1]/gn[3],gn[2]/gn[3]);gn[0]=_i,gn[1]=pi,gn[2]=yi.top,gn[3]=1,Ml(gn,gn,Ut),gn[3]=Math.max(gn[3],1e-5);const Pi=new $c(gn[0]/gn[3],gn[1]/gn[3],gn[2]/gn[3]);wn.push(vi),Dn.push(Pi)}Pn.push(wn),An.push(Dn)}return[Pn,An]}(be,_e,$e,je,it,St,Ke,ut,dt):function(Ct,Qe,Dt,dn,Ut){const en=[],Ot=[],pn=Ut[8]*Qe,Rn=Ut[9]*Qe,Pn=Ut[10]*Qe,An=Ut[11]*Qe,gn=Ut[8]*Dt,ti=Ut[9]*Dt,wn=Ut[10]*Dt,Dn=Ut[11]*Dt;for(const ri of Ct){const _i=[],pi=[];for(const yi of ri){const vi=yi.x+dn.x,Pi=yi.y+dn.y,or=Ut[0]*vi+Ut[4]*Pi+Ut[12],ni=Ut[1]*vi+Ut[5]*Pi+Ut[13],Wi=Ut[2]*vi+Ut[6]*Pi+Ut[14],Ni=Ut[3]*vi+Ut[7]*Pi+Ut[15],Zn=or+pn,Si=ni+Rn,Yi=Wi+Pn,oi=Math.max(Ni+An,1e-5),Oi=or+gn,Tr=ni+ti,sr=Wi+wn,ar=Math.max(Ni+Dn,1e-5);_i.push(new $c(Zn/oi,Si/oi,Yi/oi)),pi.push(new $c(Oi/ar,Tr/ar,sr/ar))}en.push(_i),Ot.push(pi)}return[en,Ot]}(be,_e,$e,je,it)}(d,a,P,A,E,g,Z,z,F,d.center.lat,n.tileID.canonical),ae=n.queryGeometry;return function(de,be,_e){let $e=1/0;d0(_e,be)&&($e=ex(_e,be[0]));for(let je=0;je<be.length;je++){const it=be[je],St=de[je];for(let Ke=0;Ke<it.length-1;Ke++){const ut=it[Ke],dt=[ut,it[Ke+1],St[Ke+1],St[Ke],ut];h0(_e,dt)&&($e=Math.min($e,ex(_e,dt)))}}return $e!==1/0&&$e}(le,ge,ae.isPointQuery()?ae.screenBounds:ae.screenGeometry)}},line:class extends Uo{constructor(n){super(n,nx),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(n){if(n==="line-gradient"){const e=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=e._styleExpression&&e._styleExpression.expression instanceof gc,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(n,e){super.recalculate(n,e),this.paint._values["line-floorwidth"]=ix.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,n)}createBucket(n){return new sp(n)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getProgramConfiguration(n){return new va(this,n)}queryRadius(n){const e=n,i=rx(Vc("line-width",this,e),Vc("line-gap-width",this,e)),a=Vc("line-offset",this,e);return i/2+Math.abs(a)+Wf(this.paint.get("line-translate"))}queryIntersectsFeature(n,e,i,a,c,d){if(n.queryGeometry.isAboveHorizon)return!1;const g=g0(n.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),d.angle,n.pixelToTileUnitsFactor),y=n.pixelToTileUnitsFactor/2*rx(this.paint.get("line-width").evaluate(e,i),this.paint.get("line-gap-width").evaluate(e,i)),b=this.paint.get("line-offset").evaluate(e,i);return b&&(a=function(E,A){const P=[],z=new ce(0,0);for(let O=0;O<E.length;O++){const F=E[O],q=[];for(let Z=0;Z<F.length;Z++){const le=F[Z-1],ge=F[Z],ae=F[Z+1],de=Z===0?z:ge.sub(le)._unit()._perp(),be=Z===F.length-1?z:ae.sub(ge)._unit()._perp(),_e=de._add(be)._unit();_e._mult(1/(_e.x*be.x+_e.y*be.y)),q.push(_e._mult(A)._add(ge))}P.push(q)}return P}(a,b*n.pixelToTileUnitsFactor)),function(E,A,P){for(let z=0;z<A.length;z++){const O=A[z];if(E.length>=3){for(let F=0;F<O.length;F++)if(Sl(E,O[F]))return!0}if(V2(E,O,P))return!0}return!1}(g,a,y)}isTileClipped(){return!0}},symbol:bp,background:class extends Uo{constructor(n){super(n,NA)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}},raster:class extends Uo{constructor(n){super(n,VA)}getProgramIds(){return["raster"]}},sky:class extends Uo{constructor(n){super(n,qA),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(n){n==="sky-gradient"?this._updateColorRamp():n!=="sky-atmosphere-sun"&&n!=="sky-atmosphere-halo-color"&&n!=="sky-atmosphere-color"&&n!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=Zg({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(n){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const e=n.style.light.properties.get("position");return this._lightPosition.azimuthal!==e.azimuthal||this._lightPosition.polar!==e.polar}return!1}getCenter(n,e){if(this.paint.get("sky-type")==="atmosphere"){const a=this.paint.get("sky-atmosphere-sun"),c=!a,d=n.style.light,g=d.properties.get("position");return c&&d.properties.get("anchor")==="viewport"&&re("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),c?y_(g.azimuthal,90-g.polar,e):y_(a[0],90-a[1],e)}const i=this.paint.get("sky-gradient-center");return y_(i[0],90-i[1],e)}is3D(){return!1}isSky(){return!0}markSkyboxValid(n){this._skyboxInvalidated=!1,this._lightPosition=n.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const n=this.paint.get("sky-type");return n==="atmosphere"?["skyboxCapture","skybox"]:n==="gradient"?["skyboxGradient"]:null}}};class rd{constructor(e,i,a,c){this.context=e,this.format=a,this.texture=e.gl.createTexture(),this.update(i,c)}update(e,i,a){const{width:c,height:d}=e,{context:g}=this,{gl:y}=g,{HTMLImageElement:b,HTMLCanvasElement:E,HTMLVideoElement:A,ImageData:P,ImageBitmap:z}=S;if(y.bindTexture(y.TEXTURE_2D,this.texture),g.pixelStoreUnpackFlipY.set(!1),g.pixelStoreUnpack.set(1),g.pixelStoreUnpackPremultiplyAlpha.set(this.format===y.RGBA&&(!i||i.premultiply!==!1)),a||this.size&&this.size[0]===c&&this.size[1]===d){const{x:O,y:F}=a||{x:0,y:0};e instanceof b||e instanceof E||e instanceof A||e instanceof P||z&&e instanceof z?y.texSubImage2D(y.TEXTURE_2D,0,O,F,y.RGBA,y.UNSIGNED_BYTE,e):y.texSubImage2D(y.TEXTURE_2D,0,O,F,c,d,y.RGBA,y.UNSIGNED_BYTE,e.data)}else this.size=[c,d],e instanceof b||e instanceof E||e instanceof A||e instanceof P||z&&e instanceof z?y.texImage2D(y.TEXTURE_2D,0,this.format,this.format,y.UNSIGNED_BYTE,e):y.texImage2D(y.TEXTURE_2D,0,this.format,c,d,0,this.format,y.UNSIGNED_BYTE,e.data);this.useMipmap=Boolean(i&&i.useMipmap&&this.isSizePowerOfTwo()),this.useMipmap&&y.generateMipmap(y.TEXTURE_2D)}bind(e,i){const{context:a}=this,{gl:c}=a;c.bindTexture(c.TEXTURE_2D,this.texture),e!==this.filter&&(c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MAG_FILTER,e),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER,this.useMipmap?e===c.NEAREST?c.NEAREST_MIPMAP_NEAREST:c.LINEAR_MIPMAP_NEAREST:e),this.filter=e),i!==this.wrap&&(c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_S,i),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_T,i),this.wrap=i)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class $A{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class GA{constructor(){this.tasks={},this.taskQueue=[],gt(["process"],this),this.invoker=new $A(this.process),this.nextId=0}add(e,i){const a=this.nextId++,c=function({type:d,isSymbolTile:g,zoom:y}){return y=y||0,d==="message"?0:d!=="maybePrepare"||g?d!=="parseTile"||g?d==="parseTile"&&g?300-y:d==="maybePrepare"&&g?400-y:500:200-y:100-y}(i);if(c===0){nt();try{e()}finally{}return{cancel:()=>{}}}return this.tasks[a]={fn:e,metadata:i,priority:c,id:a},this.taskQueue.push(a),this.invoker.trigger(),{cancel:()=>{delete this.tasks[a]}}}process(){nt();try{if(this.taskQueue=this.taskQueue.filter(a=>!!this.tasks[a]),!this.taskQueue.length)return;const e=this.pick();if(e===null)return;const i=this.tasks[e];if(delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),!i)return;i.fn()}finally{}}pick(){let e=null,i=1/0;for(let c=0;c<this.taskQueue.length;c++){const d=this.tasks[this.taskQueue[c]];d.priority<i&&(i=d.priority,e=c)}if(e===null)return null;const a=this.taskQueue[e];return this.taskQueue.splice(e,1),a}remove(){this.invoker.remove()}}class Wx{constructor(e){this._stringToNumber={},this._numberToString=[];for(let i=0;i<e.length;i++){const a=e[i];this._stringToNumber[a]=i,this._numberToString[i]=a}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}const ZA=["tile","layer","source","sourceLayer","state"];class Xx{constructor(e,i,a,c,d){this.type="Feature",this._vectorTileFeature=e,this._z=i,this._x=a,this._y=c,this.properties=e.properties,this.id=d}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={type:"Feature",geometry:this.geometry,properties:this.properties};this.id!==void 0&&(e.id=this.id);for(const i of ZA)this[i]!==void 0&&(e[i]=this[i]);return e}}const Co=32,hs=33,Ta=new Uint16Array(8184);for(let n=0;n<2046;n++){let e=n+2,i=0,a=0,c=0,d=0,g=0,y=0;for(1&e?c=d=g=Co:i=a=y=Co;(e>>=1)>1;){const E=i+c>>1,A=a+d>>1;1&e?(c=i,d=a,i=g,a=y):(i=c,a=d,c=g,d=y),g=E,y=A}const b=4*n;Ta[b+0]=i,Ta[b+1]=a,Ta[b+2]=c,Ta[b+3]=d}const ds=new Uint16Array(2178),Sa=new Uint8Array(1089),wp=new Uint16Array(1089);function Kx(n){return n===0?-.03125:n===32?.03125:0}var Yx=Gt([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);const Qx={type:2,extent:_n,loadGeometry:()=>[[new ce(0,0),new ce(8193,0),new ce(8193,8193),new ce(0,8193),new ce(0,0)]]};class v_{constructor(e,i,a,c,d){this.tileID=e,this.uid=Bt(),this.uses=0,this.tileSize=i,this.tileZoom=a,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=d,this.expiredRequestCount=0,this.state="loading",c&&c.transform&&(this.projection=c.transform.projection)}registerFadeDuration(e){const i=e+this.timeAdded;i<at.now()||this.fadeEndTime&&i<this.fadeEndTime||(this.fadeEndTime=i)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=Pl(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(e,i,a){if(this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(c,d){const g={};if(!d)return g;for(const y of c){const b=y.layerIds.map(E=>d.getLayer(E)).filter(Boolean);if(b.length!==0){y.layers=b,y.stateDependentLayerIds&&(y.stateDependentLayers=y.stateDependentLayerIds.map(E=>b.filter(A=>A.id===E)[0]));for(const E of b)g[E.id]=y}}return g}(e.buckets,i.style),this.hasSymbolBuckets=!1;for(const c in this.buckets){const d=this.buckets[c];if(d instanceof Ea){if(this.hasSymbolBuckets=!0,!a)break;d.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const c in this.buckets){const d=this.buckets[c];if(d instanceof Ea&&d.hasRTLText){this.hasRTLText=!0,qe.isLoading()||qe.isLoaded()||Pe()!=="deferred"||He();break}}this.queryPadding=0;for(const c in this.buckets){const d=this.buckets[c];this.queryPadding=Math.max(this.queryPadding,i.style.getLayer(c).queryRadius(d))}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage),e.lineAtlas&&(this.lineAtlas=e.lineAtlas)}else this.collisionBoxArray=new Ag}unloadVectorData(){if(this.hasData()){for(const e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(e){return this.buckets[e.id]}upload(e){for(const a in this.buckets){const c=this.buckets[a];c.uploadPending()&&c.upload(e)}const i=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new rd(e,this.imageAtlas.image,i.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new rd(e,this.glyphAtlasImage,i.ALPHA),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new rd(e,this.lineAtlas.image,i.ALPHA),this.lineAtlas.uploaded=!0)}prepare(e){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture)}queryRenderedFeatures(e,i,a,c,d,g,y,b){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({tileResult:c,pixelPosMatrix:y,transform:g,params:d,tileTransform:this.tileTransform},e,i,a):{}}querySourceFeatures(e,i){const a=this.latestFeatureIndex;if(!a||!a.rawTileData)return;const c=a.loadVTLayers(),d=i?i.sourceLayer:"",g=c._geojsonTileLayer||c[d];if(!g)return;const y=Ps(i&&i.filter),{z:b,x:E,y:A}=this.tileID.canonical,P={z:b,x:E,y:A};for(let z=0;z<g.length;z++){const O=g.feature(z);if(y.needGeometry){const Z=Tl(O,!0);if(!y.filter(new Le(this.tileID.overscaledZ),Z,this.tileID.canonical))continue}else if(!y.filter(new Le(this.tileID.overscaledZ),O))continue;const F=a.getId(O,d),q=new Xx(O,b,E,A,F);q.tile=P,e.push(q)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){const i=this.expirationTime;if(e.cacheControl){const a=yt(e.cacheControl);a["max-age"]&&(this.expirationTime=Date.now()+1e3*a["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){const a=Date.now();let c=!1;if(this.expirationTime>a)c=!1;else if(i)if(this.expirationTime<i)c=!0;else{const d=this.expirationTime-i;d?this.expirationTime=a+Math.max(d,3e4):c=!0}else c=!0;c?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(e,i){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(e).length===0||!i)return;const a=this.latestFeatureIndex.loadVTLayers(),c=i.style.listImages();for(const d in this.buckets){if(!i.style.hasLayer(d))continue;const g=this.buckets[d],y=g.layers[0].sourceLayer||"_geojsonTileLayer",b=a[y],E=e[y];if(!b||!E||Object.keys(E).length===0)continue;if(g.update(E,b,c,this.imageAtlas&&this.imageAtlas.patternPositions||{}),g instanceof sp||g instanceof tp){const P=i.style._getSourceCache(g.layers[0].source);i._terrain&&i._terrain.enabled&&P&&g.programConfigurations.needsUpload&&i._terrain._clearRenderCacheForTile(P.id,this.tileID)}const A=i&&i.style&&i.style.getLayer(d);A&&(this.queryPadding=Math.max(this.queryPadding,A.queryRadius(g)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<at.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(e){this.symbolFadeHoldUntil=at.now()+e}setTexture(e,i){const a=i.context,c=a.gl;this.texture=this.texture||i.getTileTexture(e.width),this.texture?this.texture.update(e,{useMipmap:!0}):(this.texture=new rd(a,e,c.RGBA,{useMipmap:!0}),this.texture.bind(c.LINEAR,c.CLAMP_TO_EDGE),a.extTextureFilterAnisotropic&&c.texParameterf(c.TEXTURE_2D,a.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,a.extTextureFilterAnisotropicMax))}setDependencies(e,i){const a={};for(const c of i)a[c]=!0;this.dependencies[e]=a}hasDependency(e,i){for(const a of e){const c=this.dependencies[a];if(c){for(const d of i)if(c[d])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(e,i){if(!i||i.name==="mercator"||this._tileDebugBuffer)return;const a=Rs(Qx,this.tileID.canonical,this.tileTransform)[0],c=new Hn,d=new Mh;for(let g=0;g<a.length;g++){const{x:y,y:b}=a[g];c.emplaceBack(y,b),d.emplaceBack(g)}d.emplaceBack(0),this._tileDebugIndexBuffer=e.createIndexBuffer(d),this._tileDebugBuffer=e.createVertexBuffer(c,Kh.members),this._tileDebugSegments=Hi.simpleSegment(0,0,c.length,d.length)}_makeTileBoundsBuffers(e,i){if(this._tileBoundsBuffer||!i||i.name==="mercator")return;const a=Rs(Qx,this.tileID.canonical,this.tileTransform)[0];let c,d;if(this.isRaster){const g=function(y,b){const E=Pl(y,b),A=Math.pow(2,y.z);for(let Z=0;Z<hs;Z++)for(let le=0;le<hs;le++){const ge=lo((y.x+(le+Kx(le))/Co)/A),ae=mr((y.y+(Z+Kx(Z))/Co)/A),de=b.project(ge,ae),be=Z*hs+le;ds[2*be+0]=Math.round((de.x*E.scale-E.x)*_n),ds[2*be+1]=Math.round((de.y*E.scale-E.y)*_n)}Sa.fill(0),wp.fill(0);for(let Z=2045;Z>=0;Z--){const le=4*Z,ge=Ta[le+0],ae=Ta[le+1],de=Ta[le+2],be=Ta[le+3],_e=ge+de>>1,$e=ae+be>>1,je=_e+$e-ae,it=$e+ge-_e,St=ae*hs+ge,Ke=be*hs+de,ut=$e*hs+_e,dt=Math.hypot((ds[2*St+0]+ds[2*Ke+0])/2-ds[2*ut+0],(ds[2*St+1]+ds[2*Ke+1])/2-ds[2*ut+1])>=16;if(Sa[ut]=Sa[ut]||(dt?1:0),Z<1022){const vt=(ae+it>>1)*hs+(ge+je>>1),Ct=(be+it>>1)*hs+(de+je>>1);Sa[ut]=Sa[ut]||Sa[vt]||Sa[Ct]}}const P=new ii,z=new pr;let O=0;function F(Z,le){const ge=le*hs+Z;return wp[ge]===0&&(P.emplaceBack(ds[2*ge+0],ds[2*ge+1],Z*_n/Co,le*_n/Co),wp[ge]=++O),wp[ge]-1}function q(Z,le,ge,ae,de,be){const _e=Z+ge>>1,$e=le+ae>>1;if(Math.abs(Z-de)+Math.abs(le-be)>1&&Sa[$e*hs+_e])q(de,be,Z,le,_e,$e),q(ge,ae,de,be,_e,$e);else{const je=F(Z,le),it=F(ge,ae),St=F(de,be);z.emplaceBack(je,it,St)}}return q(0,0,Co,Co,Co,0),q(Co,Co,0,0,0,Co),{vertices:P,indices:z}}(this.tileID.canonical,i);c=g.vertices,d=g.indices}else{c=new ii,d=new pr;for(const{x:y,y:b}of a)c.emplaceBack(y,b,0,0);const g=Oh.exports(c.int16,void 0,4);for(let y=0;y<g.length;y+=3)d.emplaceBack(g[y],g[y+1],g[y+2])}this._tileBoundsBuffer=e.createVertexBuffer(c,Yx.members),this._tileBoundsIndexBuffer=e.createIndexBuffer(d),this._tileBoundsSegments=Hi.simpleSegment(0,0,c.length,d.length)}_makeGlobeTileDebugBuffers(e,i){const a=i.projection;if(!a||a.name!=="globe"||i.freezeTileCoverage)return;const c=this.tileID.canonical,d=Jh(Dx(c,i)),g=eu(i.zoom);let y;g>0&&(y=Bg(new Float64Array(16),i.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(e,c,i,d,y,g),this._makeGlobeTileDebugTextBuffer(e,c,i,d,y,g)}_globePoint(e,i,a,c,d,g,y){let b=Qh(e,i,a);if(g){const E=1<<a.z,A=ss(c.center.lng),P=as(c.center.lat),z=(a.x+.5)/E-A;let O=0;z>.5?O=-1:z<-.5&&(O=1);let F=(e/_n+a.x)/E+O,q=(i/_n+a.y)/E;F=(F-A)*c._pixelsPerMercatorPixel+A,q=(q-P)*c._pixelsPerMercatorPixel+P;const Z=[F*c.worldSize,q*c.worldSize,0];Di(Z,Z,g),b=kl(b,Z,y)}return Di(b,b,d)}_makeGlobeTileDebugBorderBuffer(e,i,a,c,d,g){const y=new Hn,b=new Mh,E=new li,A=(z,O,F,q,Z)=>{const le=(F-z)/(Z-1),ge=(q-O)/(Z-1),ae=y.length;for(let de=0;de<Z;de++){const be=z+de*le,_e=O+de*ge;y.emplaceBack(be,_e);const $e=this._globePoint(be,_e,i,a,c,d,g);E.emplaceBack($e[0],$e[1],$e[2]),b.emplaceBack(ae+de)}},P=_n;A(0,0,P,0,16),A(P,0,P,P,16),A(P,P,0,P,16),A(0,P,0,0,16),this._tileDebugIndexBuffer=e.createIndexBuffer(b),this._tileDebugBuffer=e.createVertexBuffer(y,Kh.members),this._globeTileDebugBorderBuffer=e.createVertexBuffer(E,Lx.members),this._tileDebugSegments=Hi.simpleSegment(0,0,y.length,b.length)}_makeGlobeTileDebugTextBuffer(e,i,a,c,d,g){const y=new Hn,b=new pr,E=new li,A=25;b.reserve(32),y.reserve(A),E.reserve(A);const P=(z,O)=>A*z+O;for(let z=0;z<A;z++){const O=2048*z;for(let F=0;F<A;F++){const q=2048*F;y.emplaceBack(q,O);const Z=this._globePoint(q,O,i,a,c,d,g);E.emplaceBack(Z[0],Z[1],Z[2])}}for(let z=0;z<4;z++)for(let O=0;O<4;O++){const F=P(z,O),q=P(z,O+1),Z=P(z+1,O),le=P(z+1,O+1);b.emplaceBack(F,q,Z),b.emplaceBack(Z,q,le)}this._tileDebugTextIndexBuffer=e.createIndexBuffer(b),this._tileDebugTextBuffer=e.createVertexBuffer(y,Kh.members),this._globeTileDebugTextBuffer=e.createVertexBuffer(E,Lx.members),this._tileDebugTextSegments=Hi.simpleSegment(0,0,A,32)}}class HA{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,i,a){const c=String(i);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][c]=this.stateChanges[e][c]||{},Ve(this.stateChanges[e][c],a),this.deletedStates[e]===null){this.deletedStates[e]={};for(const d in this.state[e])d!==c&&(this.deletedStates[e][d]=null)}else if(this.deletedStates[e]&&this.deletedStates[e][c]===null){this.deletedStates[e][c]={};for(const d in this.state[e][c])a[d]||(this.deletedStates[e][c][d]=null)}else for(const d in a)this.deletedStates[e]&&this.deletedStates[e][c]&&this.deletedStates[e][c][d]===null&&delete this.deletedStates[e][c][d]}removeFeatureState(e,i,a){if(this.deletedStates[e]===null)return;const c=String(i);if(this.deletedStates[e]=this.deletedStates[e]||{},a&&i!==void 0)this.deletedStates[e][c]!==null&&(this.deletedStates[e][c]=this.deletedStates[e][c]||{},this.deletedStates[e][c][a]=null);else if(i!==void 0)if(this.stateChanges[e]&&this.stateChanges[e][c])for(a in this.deletedStates[e][c]={},this.stateChanges[e][c])this.deletedStates[e][c][a]=null;else this.deletedStates[e][c]=null;else this.deletedStates[e]=null}getState(e,i){const a=String(i),c=Ve({},(this.state[e]||{})[a],(this.stateChanges[e]||{})[a]);if(this.deletedStates[e]===null)return{};if(this.deletedStates[e]){const d=this.deletedStates[e][i];if(d===null)return{};for(const g in d)delete c[g]}return c}initializeTileState(e,i){e.setFeatureState(this.state,i)}coalesceChanges(e,i){const a={};for(const c in this.stateChanges){this.state[c]=this.state[c]||{};const d={};for(const g in this.stateChanges[c])this.state[c][g]||(this.state[c][g]={}),Ve(this.state[c][g],this.stateChanges[c][g]),d[g]=this.state[c][g];a[c]=d}for(const c in this.deletedStates){this.state[c]=this.state[c]||{};const d={};if(this.deletedStates[c]===null)for(const g in this.state[c])d[g]={},this.state[c][g]={};else for(const g in this.deletedStates[c]){if(this.deletedStates[c][g]===null)this.state[c][g]={};else for(const y of Object.keys(this.deletedStates[c][g]))delete this.state[c][g][y];d[g]=this.state[c][g]}a[c]=a[c]||{},Ve(a[c],d)}if(this.stateChanges={},this.deletedStates={},Object.keys(a).length!==0)for(const c in e)e[c].setFeatureState(a,i)}}class Jx{constructor(e){this.size=e,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(e,i){const a=this.toIdx(e,i);return{min:this.minimums[a],max:this.maximums[a]}}isLeaf(e,i){return this.leaves[this.toIdx(e,i)]}toIdx(e,i){return i*this.size+e}}function eb(n,e,i,a){let c=0,d=Number.MAX_VALUE;for(let g=0;g<3;g++)if(Math.abs(a[g])<1e-15){if(i[g]<n[g]||i[g]>e[g])return null}else{const y=1/a[g];let b=(n[g]-i[g])*y,E=(e[g]-i[g])*y;if(b>E){const A=b;b=E,E=A}if(b>c&&(c=b),E<d&&(d=E),c>d)return null}return c}function tb(n,e,i,a,c,d,g,y,b,E,A){const P=a-n,z=c-e,O=d-i,F=g-n,q=y-e,Z=b-i,le=A[1]*Z-A[2]*q,ge=A[2]*F-A[0]*Z,ae=A[0]*q-A[1]*F,de=P*le+z*ge+O*ae;if(Math.abs(de)<1e-15)return null;const be=1/de,_e=E[0]-n,$e=E[1]-e,je=E[2]-i,it=(_e*le+$e*ge+je*ae)*be;if(it<0||it>1)return null;const St=$e*O-je*z,Ke=je*P-_e*O,ut=_e*z-$e*P,dt=(A[0]*St+A[1]*Ke+A[2]*ut)*be;return dt<0||it+dt>1?null:(F*St+q*Ke+Z*ut)*be}function nb(n,e,i){return(n-e)/(i-e)}function ib(n,e,i,a,c,d,g,y,b){const E=1<<i,A=d-a,P=g-c,z=(n+1)/E*A+a,O=(e+0)/E*P+c,F=(e+1)/E*P+c;y[0]=(n+0)/E*A+a,y[1]=O,b[0]=z,b[1]=F}class rb{constructor(e){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=e,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const i=function(d){const g=Math.ceil(Math.log2(d.dim/8)),y=[];let b=Math.ceil(Math.pow(2,g));const E=1/b,A=(O,F,q,Z,le)=>{const ge=Z?1:0,ae=(O+1)*q-ge,de=F*q,be=(F+1)*q-ge;le[0]=O*q,le[1]=de,le[2]=ae,le[3]=be};let P=new Jx(b);const z=[];for(let O=0;O<b*b;O++){A(O%b,Math.floor(O/b),E,!1,z);const F=Ca(z[0],z[1],d),q=Ca(z[2],z[1],d),Z=Ca(z[2],z[3],d),le=Ca(z[0],z[3],d);P.minimums.push(Math.min(F,q,Z,le)),P.maximums.push(Math.max(F,q,Z,le)),P.leaves.push(1)}for(y.push(P),b/=2;b>=1;b/=2){const O=y[y.length-1];P=new Jx(b);for(let F=0;F<b*b;F++){A(F%b,Math.floor(F/b),2,!0,z);const q=O.getElevation(z[0],z[1]),Z=O.getElevation(z[2],z[1]),le=O.getElevation(z[2],z[3]),ge=O.getElevation(z[0],z[3]),ae=O.isLeaf(z[0],z[1]),de=O.isLeaf(z[2],z[1]),be=O.isLeaf(z[2],z[3]),_e=O.isLeaf(z[0],z[3]),$e=Math.min(q.min,Z.min,le.min,ge.min),je=Math.max(q.max,Z.max,le.max,ge.max),it=ae&&de&&be&&_e;P.maximums.push(je),P.minimums.push($e),P.leaves.push(je-$e<=5&&it?1:0)}y.push(P)}return y}(this.dem),a=i.length-1,c=i[a];this._addNode(c.minimums[0],c.maximums[0],c.leaves[0]),this._construct(i,0,0,a,0)}raycastRoot(e,i,a,c,d,g,y=1){return eb([e,i,-100],[a,c,this.maximums[0]*y],d,g)}raycast(e,i,a,c,d,g,y=1){if(!this.nodeCount)return null;const b=this.raycastRoot(e,i,a,c,d,g,y);if(b==null)return null;const E=[],A=[],P=[],z=[],O=[{idx:0,t:b,nodex:0,nodey:0,depth:0}];for(;O.length>0;){const{idx:F,t:q,nodex:Z,nodey:le,depth:ge}=O.pop();if(this.leaves[F]){ib(Z,le,ge,e,i,a,c,P,z);const de=1<<ge,be=(Z+0)/de,_e=(Z+1)/de,$e=(le+0)/de,je=(le+1)/de,it=Ca(be,$e,this.dem)*y,St=Ca(_e,$e,this.dem)*y,Ke=Ca(_e,je,this.dem)*y,ut=Ca(be,je,this.dem)*y,dt=tb(P[0],P[1],it,z[0],P[1],St,z[0],z[1],Ke,d,g),vt=tb(z[0],z[1],Ke,P[0],z[1],ut,P[0],P[1],it,d,g),Ct=Math.min(dt!==null?dt:Number.MAX_VALUE,vt!==null?vt:Number.MAX_VALUE);if(Ct!==Number.MAX_VALUE)return Ct;{const Qe=Rh([],d,g,q);if(ob(it,St,ut,Ke,nb(Qe[0],P[0],z[0]),nb(Qe[1],P[1],z[1]))>=Qe[2])return q}continue}let ae=0;for(let de=0;de<this._siblingOffset.length;de++){ib((Z<<1)+this._siblingOffset[de][0],(le<<1)+this._siblingOffset[de][1],ge+1,e,i,a,c,P,z),P[2]=-100,z[2]=this.maximums[this.childOffsets[F]+de]*y;const be=eb(P,z,d,g);if(be!=null){const _e=be;E[de]=_e;let $e=!1;for(let je=0;je<ae&&!$e;je++)_e>=E[A[je]]&&(A.splice(je,0,de),$e=!0);$e||(A[ae]=de),ae++}}for(let de=0;de<ae;de++){const be=A[de];O.push({idx:this.childOffsets[F]+be,t:E[be],nodex:(Z<<1)+this._siblingOffset[be][0],nodey:(le<<1)+this._siblingOffset[be][1],depth:ge+1})}}return null}_addNode(e,i,a){return this.minimums.push(e),this.maximums.push(i),this.leaves.push(a),this.childOffsets.push(0),this.nodeCount++}_construct(e,i,a,c,d){if(e[c].isLeaf(i,a)===1)return;this.childOffsets[d]||(this.childOffsets[d]=this.nodeCount);const g=c-1,y=e[g];let b=0,E=0;for(let A=0;A<this._siblingOffset.length;A++){const P=2*i+this._siblingOffset[A][0],z=2*a+this._siblingOffset[A][1],O=y.getElevation(P,z),F=y.isLeaf(P,z),q=this._addNode(O.min,O.max,F);F&&(b|=1<<A),E||(E=q)}for(let A=0;A<this._siblingOffset.length;A++)b&1<<A||this._construct(e,2*i+this._siblingOffset[A][0],2*a+this._siblingOffset[A][1],g,E+A)}}function ob(n,e,i,a,c,d){return $n($n(n,i,d),$n(e,a,d),c)}function Ca(n,e,i){const a=i.dim,c=lt(n*a-.5,0,a-1),d=lt(e*a-.5,0,a-1),g=Math.floor(c),y=Math.floor(d),b=Math.min(g+1,a-1),E=Math.min(y+1,a-1);return ob(i.get(g,y),i.get(b,y),i.get(g,E),i.get(b,E),c-g,d-y)}const sb={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};class Ep{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(e,i,a,c=!1,d=!1){if(this.uid=e,i.height!==i.width)throw new RangeError("DEM tiles must be square");if(a&&a!=="mapbox"&&a!=="terrarium")return re(`"${a}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=i.height;const g=this.dim=i.height-2,y=new Uint32Array(i.data.buffer);if(this.pixels=new Uint8Array(i.data.buffer),this.encoding=a||"mapbox",this.borderReady=c,!c){for(let b=0;b<g;b++)y[this._idx(-1,b)]=y[this._idx(0,b)],y[this._idx(g,b)]=y[this._idx(g-1,b)],y[this._idx(b,-1)]=y[this._idx(b,0)],y[this._idx(b,g)]=y[this._idx(b,g-1)];y[this._idx(-1,-1)]=y[this._idx(0,0)],y[this._idx(g,-1)]=y[this._idx(g-1,0)],y[this._idx(-1,g)]=y[this._idx(0,g-1)],y[this._idx(g,g)]=y[this._idx(g-1,g-1)],d&&this._buildQuadTree()}}_buildQuadTree(){this._tree=new rb(this)}get(e,i,a=!1){a&&(e=lt(e,-1,this.dim),i=lt(i,-1,this.dim));const c=4*this._idx(e,i);return(this.encoding==="terrarium"?this._unpackTerrarium:this._unpackMapbox)(this.pixels[c],this.pixels[c+1],this.pixels[c+2])}static getUnpackVector(e){return sb[e]}get unpackVector(){return sb[this.encoding]}_idx(e,i){if(e<-1||e>=this.dim+1||i<-1||i>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(i+1)*this.stride+(e+1)}_unpackMapbox(e,i,a){return(256*e*256+256*i+a)/10-1e4}_unpackTerrarium(e,i,a){return 256*e+i+a/256-32768}static pack(e,i){const a=[0,0,0,0],c=Ep.getUnpackVector(i);let d=Math.floor((e+c[3])/c[2]);return a[2]=d%256,d=Math.floor(d/256),a[1]=d%256,d=Math.floor(d/256),a[0]=d,a}getPixels(){return new Qr({width:this.stride,height:this.stride},this.pixels)}backfillBorder(e,i,a){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let c=i*this.dim,d=i*this.dim+this.dim,g=a*this.dim,y=a*this.dim+this.dim;switch(i){case-1:c=d-1;break;case 1:d=c+1}switch(a){case-1:g=y-1;break;case 1:y=g+1}const b=-i*this.dim,E=-a*this.dim;for(let A=g;A<y;A++)for(let P=c;P<d;P++){const z=4*this._idx(P,A),O=4*this._idx(P+b,A+E);this.pixels[z+0]=e.pixels[O+0],this.pixels[z+1]=e.pixels[O+1],this.pixels[z+2]=e.pixels[O+2],this.pixels[z+3]=e.pixels[O+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}Zt(Ep,"DEMData"),Zt(rb,"DemMinMaxQuadTree",{omit:["dem"]});class WA{constructor(e,i){this.max=e,this.onRemove=i,this.reset()}reset(){for(const e in this.data)for(const i of this.data[e])i.timeout&&clearTimeout(i.timeout),this.onRemove(i.value);return this.data={},this.order=[],this}add(e,i,a){const c=e.wrapped().key;this.data[c]===void 0&&(this.data[c]=[]);const d={value:i,timeout:void 0};if(a!==void 0&&(d.timeout=setTimeout(()=>{this.remove(e,d)},a)),this.data[c].push(d),this.order.push(c),this.order.length>this.max){const g=this._getAndRemoveByKey(this.order[0]);g&&this.onRemove(g)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){const i=this.data[e].shift();return i.timeout&&clearTimeout(i.timeout),this.data[e].length===0&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),i.value}getByKey(e){const i=this.data[e];return i?i[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,i){if(!this.has(e))return this;const a=e.wrapped().key,c=i===void 0?0:this.data[a].indexOf(i),d=this.data[a][c];return this.data[a].splice(c,1),d.timeout&&clearTimeout(d.timeout),this.data[a].length===0&&delete this.data[a],this.onRemove(d.value),this.order.splice(this.order.indexOf(a),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){const i=this._getAndRemoveByKey(this.order[0]);i&&this.onRemove(i)}return this}filter(e){const i=[];for(const a in this.data)for(const c of this.data[a])e(c.value)||i.push(c);for(const a of i)this.remove(a.value.tileID,a)}}class nu{constructor(e,i,a){this.func=e,this.mask=i,this.range=a}}nu.ReadOnly=!1,nu.ReadWrite=!0,nu.disabled=new nu(519,nu.ReadOnly,[0,1]);const x_=7680;class b_{constructor(e,i,a,c,d,g){this.test=e,this.ref=i,this.mask=a,this.fail=c,this.depthFail=d,this.pass=g}}b_.disabled=new b_({func:519,mask:0},0,0,x_,x_,x_);class fs{constructor(e,i,a){this.blendFunction=e,this.blendColor=i,this.mask=a}}fs.Replace=[1,0],fs.disabled=new fs(fs.Replace,ki.transparent,[!1,!1,!1,!1]),fs.unblended=new fs(fs.Replace,ki.transparent,[!0,!0,!0,!0]),fs.alphaBlended=new fs([1,771],ki.transparent,[!0,!0,!0,!0]);const w_=1029,E_=2305;class $o{constructor(e,i,a){this.enable=e,this.mode=i,this.frontFace=a}}$o.disabled=new $o(!1,w_,E_),$o.backCCW=new $o(!0,w_,E_),$o.backCW=new $o(!0,w_,2304),$o.frontCW=new $o(!0,1028,2304),$o.frontCCW=new $o(!0,1028,E_);class zl extends mi{constructor(e,i,a){super(),this.id=e,this._onlySymbols=a,i.on("data",c=>{c.dataType==="source"&&c.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&c.dataType==="source"&&c.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),i.on("error",()=>{this._sourceErrored=!0}),this._source=i,this._tiles={},this._cache=new WA(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=i.minTileCacheSize,this._maxTileCacheSize=i.maxTileCacheSize,this._loadedParentTiles={},this._coveredTiles={},this._state=new HA,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(e){this.map=e,this._minTileCacheSize=this._minTileCacheSize===void 0&&e?e._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&e?e._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const e in this._tiles){const i=this._tiles[e];if(i.state!=="loaded"&&i.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(e,i){return e.isSymbolTile=this._onlySymbols,this._source.loadTile(e,i)}_unloadTile(e){if(this._source.unloadTile)return this._source.unloadTile(e,()=>{})}_abortTile(e){if(this._source.abortTile)return this._source.abortTile(e,()=>{})}serialize(){return this._source.serialize()}prepare(e){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const i in this._tiles){const a=this._tiles[i];a.upload(e),a.prepare(this.map.style.imageManager)}}getIds(){return tn(this._tiles).map(e=>e.tileID).sort(ab).map(e=>e.key)}getRenderableIds(e){const i=[];for(const a in this._tiles)this._isIdRenderable(+a,e)&&i.push(this._tiles[a]);return e?i.sort((a,c)=>{const d=a.tileID,g=c.tileID,y=new ce(d.canonical.x,d.canonical.y)._rotate(this.transform.angle),b=new ce(g.canonical.x,g.canonical.y)._rotate(this.transform.angle);return d.overscaledZ-g.overscaledZ||b.y-y.y||b.x-y.x}).map(a=>a.tileID.key):i.map(a=>a.tileID).sort(ab).map(a=>a.key)}hasRenderableParent(e){const i=this.findLoadedParent(e,0);return!!i&&this._isIdRenderable(i.tileID.key)}_isIdRenderable(e,i){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(i||!this._tiles[e].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const e in this._tiles)this._tiles[e].state!=="errored"&&this._reloadTile(+e,"reloading")}}_reloadTile(e,i){const a=this._tiles[e];a&&(a.state!=="loading"&&(a.state=i),this._loadTile(a,this._tileLoaded.bind(this,a,e,i)))}_tileLoaded(e,i,a,c){if(c)if(e.state="errored",c.status!==404)this._source.fire(new ai(c,{tile:e}));else if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const d=this.map.painter.terrain;this.update(this.transform,d.getScaledDemTileSize(),!0),d.resetTileLookupCache(this.id)}else this.update(this.transform);else e.timeAdded=at.now(),a==="expired"&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(i,e),this._source.type==="raster-dem"&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),this._source.fire(new Bn("data",{dataType:"source",tile:e,coord:e.tileID,sourceCacheId:this.id}))}_backfillDEM(e){const i=this.getRenderableIds();for(let c=0;c<i.length;c++){const d=i[c];if(e.neighboringTiles&&e.neighboringTiles[d]){const g=this.getTileByID(d);a(e,g),a(g,e)}}function a(c,d){if(!c.dem||c.dem.borderReady)return;c.needsHillshadePrepare=!0,c.needsDEMTextureUpload=!0;let g=d.tileID.canonical.x-c.tileID.canonical.x;const y=d.tileID.canonical.y-c.tileID.canonical.y,b=Math.pow(2,c.tileID.canonical.z),E=d.tileID.key;g===0&&y===0||Math.abs(y)>1||(Math.abs(g)>1&&(Math.abs(g+b)===1?g+=b:Math.abs(g-b)===1&&(g-=b)),d.dem&&c.dem&&(c.dem.backfillBorder(d.dem,g,y),c.neighboringTiles&&c.neighboringTiles[E]&&(c.neighboringTiles[E].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,i,a,c){for(const d in this._tiles){let g=this._tiles[d];if(c[d]||!g.hasData()||g.tileID.overscaledZ<=i||g.tileID.overscaledZ>a)continue;let y=g.tileID;for(;g&&g.tileID.overscaledZ>i+1;){const E=g.tileID.scaledTo(g.tileID.overscaledZ-1);g=this._tiles[E.key],g&&g.hasData()&&(y=E)}let b=y;for(;b.overscaledZ>i;)if(b=b.scaledTo(b.overscaledZ-1),e[b.key]){c[y.key]=y;break}}}findLoadedParent(e,i){if(e.key in this._loadedParentTiles){const a=this._loadedParentTiles[e.key];return a&&a.tileID.overscaledZ>=i?a:null}for(let a=e.overscaledZ-1;a>=i;a--){const c=e.scaledTo(a),d=this._getLoadedTile(c);if(d)return d}}_getLoadedTile(e){const i=this._tiles[e.key];return i&&i.hasData()?i:this._cache.getByKey(this._source.reparseOverscaled?e.wrapped().key:e.canonical.key)}updateCacheSize(e,i){i=i||this._source.tileSize;const a=Math.ceil(e.width/i)+1,c=Math.ceil(e.height/i)+1,d=Math.floor(a*c*5),g=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,d):d,y=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,g):g;this._cache.setMaxSize(y)}handleWrapJump(e){const i=Math.round((e-(this._prevLng===void 0?e:this._prevLng))/360);if(this._prevLng=e,i){const a={};for(const c in this._tiles){const d=this._tiles[c];d.tileID=d.tileID.unwrapTo(d.tileID.wrap+i),a[d.tileID.key]=d}this._tiles=a;for(const c in this._timers)clearTimeout(this._timers[c]),delete this._timers[c];for(const c in this._tiles)this._setTileReloadTimer(+c,this._tiles[c])}}update(e,i,a){if(this.transform=e,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!a)return;let c;this.updateCacheSize(e,i),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?c=e.getVisibleUnwrappedCoordinates(this._source.tileID).map(y=>new Rr(y.canonical.z,y.wrap,y.canonical.z,y.canonical.x,y.canonical.y)):(c=e.coveringTiles({tileSize:i||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!a,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(c=c.filter(y=>this._source.hasTile(y)))):c=[];const d=this._updateRetainedTiles(c);if(lb(this._source.type)&&c.length!==0){const y={},b={},E=Object.keys(d);for(const P of E){const z=d[P],O=this._tiles[P];if(!O||O.fadeEndTime&&O.fadeEndTime<=at.now())continue;const F=this.findLoadedParent(z,Math.max(z.overscaledZ-zl.maxOverzooming,this._source.minzoom));F&&(this._addTile(F.tileID),y[F.tileID.key]=F.tileID),b[P]=z}const A=c[c.length-1].overscaledZ;for(const P in this._tiles){const z=this._tiles[P];if(d[P]||!z.hasData())continue;let O=z.tileID;for(;O.overscaledZ>A;){O=O.scaledTo(O.overscaledZ-1);const F=this._tiles[O.key];if(F&&F.hasData()&&b[O.key]){d[P]=z.tileID;break}}}for(const P in y)d[P]||(this._coveredTiles[P]=!0,d[P]=y[P])}for(const y in d)this._tiles[y].clearFadeHold();const g=function(y,b){const E=[];for(const A in y)A in b||E.push(A);return E}(this._tiles,d);for(const y of g){const b=this._tiles[y];b.hasSymbolBuckets&&!b.holdingForFade()?b.setHoldDuration(this.map._fadeDuration):b.hasSymbolBuckets&&!b.symbolFadeFinished()||this._removeTile(+y)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(+e)}_updateRetainedTiles(e){const i={};if(e.length===0)return i;const a={},c=e.reduce((E,A)=>Math.min(E,A.overscaledZ),1/0),d=e[0].overscaledZ,g=Math.max(d-zl.maxOverzooming,this._source.minzoom),y=Math.max(d+zl.maxUnderzooming,this._source.minzoom),b={};for(const E of e){const A=this._addTile(E);i[E.key]=E,A.hasData()||c<this._source.maxzoom&&(b[E.key]=E)}this._retainLoadedChildren(b,c,y,i);for(const E of e){let A=this._tiles[E.key];if(A.hasData())continue;if(E.canonical.z>=this._source.maxzoom){const z=E.children(this._source.maxzoom)[0],O=this.getTile(z);if(O&&O.hasData()){i[z.key]=z;continue}}else{const z=E.children(this._source.maxzoom);if(i[z[0].key]&&i[z[1].key]&&i[z[2].key]&&i[z[3].key])continue}let P=A.wasRequested();for(let z=E.overscaledZ-1;z>=g;--z){const O=E.scaledTo(z);if(a[O.key]||(a[O.key]=!0,A=this.getTile(O),!A&&P&&(A=this._addTile(O)),A&&(i[O.key]=O,P=A.wasRequested(),A.hasData())))break}}return i}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const e in this._tiles){const i=[];let a,c=this._tiles[e].tileID;for(;c.overscaledZ>0;){if(c.key in this._loadedParentTiles){a=this._loadedParentTiles[c.key];break}i.push(c.key);const d=c.scaledTo(c.overscaledZ-1);if(a=this._getLoadedTile(d),a)break;c=d}for(const d of i)this._loadedParentTiles[d]=a}}_addTile(e){let i=this._tiles[e.key];if(i)return i;i=this._cache.getAndRemove(e),i&&(this._setTileReloadTimer(e.key,i),i.tileID=e,this._state.initializeTileState(i,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,i)));const a=Boolean(i);if(!a){const c=this.map?this.map.painter:null;i=new v_(e,this._source.tileSize*e.overscaleFactor(),this.transform.tileZoom,c,this._isRaster),this._loadTile(i,this._tileLoaded.bind(this,i,e.key,i.state))}return i?(i.uses++,this._tiles[e.key]=i,a||this._source.fire(new Bn("dataloading",{tile:i,coord:i.tileID,dataType:"source"})),i):null}_setTileReloadTimer(e,i){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);const a=i.getExpiryTimeout();a&&(this._timers[e]=setTimeout(()=>{this._reloadTile(e,"expired"),delete this._timers[e]},a))}_removeTile(e){const i=this._tiles[e];i&&(i.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),i.uses>0||(i.hasData()&&i.state!=="reloading"?this._cache.add(i.tileID,i,i.getExpiryTimeout()):(i.aborted=!0,this._abortTile(i),this._unloadTile(i))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const e in this._tiles)this._removeTile(+e);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(e,i,a){const c=[],d=this.transform;if(!d)return c;const g=d.projection.name==="globe",y=ss(d.center.lng);for(const b in this._tiles){const E=this._tiles[b];if(a&&E.clearQueryDebugViz(),E.holdingForFade())continue;let A;if(g){const P=E.tileID.canonical;if(P.z===0){const z=[Math.abs(lt(y,...od(P,-1))-y),Math.abs(lt(y,...od(P,1))-y)];A=[0,2*z.indexOf(Math.min(...z))-1]}else{const z=[Math.abs(lt(y,...od(P,-1))-y),Math.abs(lt(y,...od(P,0))-y),Math.abs(lt(y,...od(P,1))-y)];A=[z.indexOf(Math.min(...z))-1]}}else A=[0];for(const P of A){const z=e.containsTile(E,d,i,P);z&&c.push(z)}}return c}getVisibleCoordinates(e){const i=this.getRenderableIds(e).map(a=>this._tiles[a].tileID);for(const a of i)a.projMatrix=this.transform.calculateProjMatrix(a.toUnwrapped());return i}hasTransition(){if(this._source.hasTransition())return!0;if(lb(this._source.type))for(const e in this._tiles){const i=this._tiles[e];if(i.fadeEndTime!==void 0&&i.fadeEndTime>=at.now())return!0}return!1}setFeatureState(e,i,a){this._state.updateState(e=e||"_geojsonTileLayer",i,a)}removeFeatureState(e,i,a){this._state.removeFeatureState(e=e||"_geojsonTileLayer",i,a)}getFeatureState(e,i){return this._state.getState(e=e||"_geojsonTileLayer",i)}setDependencies(e,i,a){const c=this._tiles[e];c&&c.setDependencies(i,a)}reloadTilesForDependencies(e,i){for(const a in this._tiles)this._tiles[a].hasDependency(e,i)&&this._reloadTile(+a,"reloading");this._cache.filter(a=>!a.hasDependency(e,i))}_preloadTiles(e,i){const a=new Map,c=Array.isArray(e)?e:[e],d=this.map.painter.terrain,g=this.usedForTerrain&&d?d.getScaledDemTileSize():this._source.tileSize;for(const y of c){const b=y.coveringTiles({tileSize:g,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const E of b)a.set(E.key,E);this.usedForTerrain&&y.updateElevation(!1)}At(Array.from(a.values()),(y,b)=>{const E=new v_(y,this._source.tileSize*y.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(E,A=>{this._source.type==="raster-dem"&&E.dem&&this._backfillDEM(E),b(A,E)})},i)}}function ab(n,e){const i=Math.abs(2*n.wrap)-+(n.wrap<0),a=Math.abs(2*e.wrap)-+(e.wrap<0);return n.overscaledZ-e.overscaledZ||a-i||e.canonical.y-n.canonical.y||e.canonical.x-n.canonical.x}function lb(n){return n==="raster"||n==="image"||n==="video"||n==="custom"}function od(n,e){const i=1<<n.z;return[n.x/i+e,(n.x+1)/i+e]}zl.maxOverzooming=10,zl.maxUnderzooming=3;class Tp{constructor(e,i,a){this._demTile=e,this._dem=this._demTile.dem,this._scale=i,this._offset=a}static create(e,i,a){const c=a||e.findDEMTileFor(i);if(!c||!c.dem)return;const d=c.dem,g=c.tileID,y=1<<i.canonical.z-g.canonical.z;return new Tp(c,c.tileSize/_n/y,[(i.canonical.x/y-g.canonical.x)*d.dim,(i.canonical.y/y-g.canonical.y)*d.dim])}tileCoordToPixel(e,i){const a=i*this._scale+this._offset[1],c=Math.floor(e*this._scale+this._offset[0]),d=Math.floor(a);return new ce(c,d)}getElevationAt(e,i,a,c){const d=e*this._scale+this._offset[0],g=i*this._scale+this._offset[1],y=Math.floor(d),b=Math.floor(g),E=this._dem;return c=!!c,a?$n($n(E.get(y,b,c),E.get(y,b+1,c),g-b),$n(E.get(y+1,b,c),E.get(y+1,b+1,c),g-b),d-y):E.get(y,b,c)}getElevationAtPixel(e,i,a){return this._dem.get(e,i,!!a)}getMeterToDEM(e){return(1<<this._demTile.tileID.canonical.z)*wo(1,e)*this._dem.stride}}class cb{constructor(e,i){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new ma(_n,16,0),this.featureIndexArray=new Yv,this.promoteId=i}insert(e,i,a,c,d,g=0){const y=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(a,c,d,g);const b=this.grid;for(let E=0;E<i.length;E++){const A=i[E],P=[1/0,1/0,-1/0,-1/0];for(let z=0;z<A.length;z++){const O=A[z];P[0]=Math.min(P[0],O.x),P[1]=Math.min(P[1],O.y),P[2]=Math.max(P[2],O.x),P[3]=Math.max(P[3],O.y)}P[0]<_n&&P[1]<_n&&P[2]>=0&&P[3]>=0&&b.insert(y,P[0],P[1],P[2],P[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new Jg(new Hh(this.rawTileData)).layers,this.sourceLayerCoder=new Wx(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const e in this.vtLayers)this.vtFeatures[e]=[]}return this.vtLayers}query(e,i,a,c){this.loadVTLayers();const d=e.params||{},g=Ps(d.filter),y=e.tileResult,b=e.transform,E=y.bufferedTilespaceBounds,A=this.grid.query(E.min.x,E.min.y,E.max.x,E.max.y,(F,q,Z,le)=>m0(y.bufferedTilespaceGeometry,F,q,Z,le));A.sort(XA);let P=null;b.elevation&&A.length>0&&(P=Tp.create(b.elevation,this.tileID));const z={};let O;for(let F=0;F<A.length;F++){const q=A[F];if(q===O)continue;O=q;const Z=this.featureIndexArray.get(q);let le=null;this.loadMatchingFeature(z,Z,g,d.layers,d.availableImages,i,a,c,(ge,ae,de,be=0)=>(le||(le=Rs(ge,this.tileID.canonical,e.tileTransform)),ae.queryIntersectsFeature(y,ge,de,le,this.z,e.transform,e.pixelPosMatrix,P,be)))}return z}loadMatchingFeature(e,i,a,c,d,g,y,b,E){const{featureIndex:A,bucketIndex:P,sourceLayerIndex:z,layoutVertexArrayOffset:O}=i,F=this.bucketLayerIDs[P];if(c&&!function(ge,ae){for(let de=0;de<ge.length;de++)if(ae.indexOf(ge[de])>=0)return!0;return!1}(c,F))return;const q=this.sourceLayerCoder.decode(z),Z=this.vtLayers[q].feature(A);if(a.needGeometry){const ge=Tl(Z,!0);if(!a.filter(new Le(this.tileID.overscaledZ),ge,this.tileID.canonical))return}else if(!a.filter(new Le(this.tileID.overscaledZ),Z))return;const le=this.getId(Z,q);for(let ge=0;ge<F.length;ge++){const ae=F[ge];if(c&&c.indexOf(ae)<0)continue;const de=g[ae];if(!de)continue;let be={};le!==void 0&&b&&(be=b.getState(de.sourceLayer||"_geojsonTileLayer",le));const _e=Ve({},y[ae]);_e.paint=ub(_e.paint,de.paint,Z,be,d),_e.layout=ub(_e.layout,de.layout,Z,be,d);const $e=!E||E(Z,de,be,O);if(!$e)continue;const je=new Xx(Z,this.z,this.x,this.y,le);je.layer=_e;let it=e[ae];it===void 0&&(it=e[ae]=[]),it.push({featureIndex:A,feature:je,intersectionZ:$e})}}lookupSymbolFeatures(e,i,a,c,d,g,y,b){const E={};this.loadVTLayers();const A=Ps(d);for(const P of e)this.loadMatchingFeature(E,{bucketIndex:a,sourceLayerIndex:c,featureIndex:P,layoutVertexArrayOffset:0},A,g,y,b,i);return E}loadFeature(e){const{featureIndex:i,sourceLayerIndex:a}=e;this.loadVTLayers();const c=this.sourceLayerCoder.decode(a),d=this.vtFeatures[c];if(d[i])return d[i];const g=this.vtLayers[c].feature(i);return d[i]=g,g}hasLayer(e){for(const i of this.bucketLayerIDs)for(const a of i)if(e===a)return!0;return!1}getId(e,i){let a=e.id;if(this.promoteId){const c=typeof this.promoteId=="string"?this.promoteId:this.promoteId[i];c!=null&&(a=e.properties[c]),typeof a=="boolean"&&(a=Number(a))}return a}}function ub(n,e,i,a,c){return _t(n,(d,g)=>{const y=e instanceof Pt?e.get(g):null;return y&&y.evaluate?y.evaluate(i,a,c):y})}function XA(n,e){return e-n}Zt(cb,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});class hb{constructor(e,i){this.width=e,this.height=i,this.nextRow=0,this.image=new Os({width:e,height:i}),this.positions={},this.uploaded=!1}getDash(e,i){const a=this.getKey(e,i);return this.positions[a]}trim(){const e=this.width,i=this.height=xn(this.nextRow);this.image.resize({width:e,height:i})}getKey(e,i){return e.join(",")+i}getDashRanges(e,i,a){const c=[];let d=e.length%2==1?-e[e.length-1]*a:0,g=e[0]*a,y=!0;c.push({left:d,right:g,isDash:y,zeroLength:e[0]===0});let b=e[0];for(let E=1;E<e.length;E++){y=!y;const A=e[E];d=b*a,b+=A,g=b*a,c.push({left:d,right:g,isDash:y,zeroLength:A===0})}return c}addRoundDash(e,i,a){const c=i/2;for(let d=-a;d<=a;d++){const g=this.width*(this.nextRow+a+d);let y=0,b=e[y];for(let E=0;E<this.width;E++){E/b.right>1&&(b=e[++y]);const A=Math.abs(E-b.left),P=Math.abs(E-b.right),z=Math.min(A,P);let O;const F=d/a*(c+1);if(b.isDash){const q=c-Math.abs(F);O=Math.sqrt(z*z+q*q)}else O=c-Math.sqrt(z*z+F*F);this.image.data[g+E]=Math.max(0,Math.min(255,O+128))}}}addRegularDash(e,i){for(let b=e.length-1;b>=0;--b){const E=e[b],A=e[b+1];E.zeroLength?e.splice(b,1):A&&A.isDash===E.isDash&&(A.left=E.left,e.splice(b,1))}const a=e[0],c=e[e.length-1];a.isDash===c.isDash&&(a.left=c.left-this.width,c.right=a.right+this.width);const d=this.width*this.nextRow;let g=0,y=e[g];for(let b=0;b<this.width;b++){b/y.right>1&&(y=e[++g]);const E=Math.abs(b-y.left),A=Math.abs(b-y.right),P=Math.min(E,A);this.image.data[d+b]=Math.max(0,Math.min(255,(y.isDash?P:-P)+i+128))}}addDash(e,i){const a=this.getKey(e,i);if(this.positions[a])return this.positions[a];const c=i==="round",d=c?7:0,g=2*d+1;if(this.nextRow+g>this.height)return re("LineAtlas out of space"),null;e.length===0&&e.push(1);let y=0;for(let A=0;A<e.length;A++)e[A]<0&&(re("Negative value is found in line dasharray, replacing values with 0"),e[A]=0),y+=e[A];if(y!==0){const A=this.width/y,P=this.getDashRanges(e,this.width,A);c?this.addRoundDash(P,A,d):this.addRegularDash(P,i==="square"?.5*A:0)}const b=this.nextRow+d;this.nextRow+=g;const E={tl:[b,d],br:[y,0]};return this.positions[a]=E,E}}Zt(hb,"LineAtlas");class db{constructor(e){const i={},a=[];for(const y in e){const b=e[y],E=i[y]={};for(const A in b.glyphs){const P=b.glyphs[+A];if(!P||P.bitmap.width===0||P.bitmap.height===0)continue;const z=P.metrics.localGlyph?2:1,O={x:0,y:0,w:P.bitmap.width+2*z,h:P.bitmap.height+2*z};a.push(O),E[A]=O}}const{w:c,h:d}=n_(a),g=new Os({width:c||1,height:d||1});for(const y in e){const b=e[y];for(const E in b.glyphs){const A=b.glyphs[+E];if(!A||A.bitmap.width===0||A.bitmap.height===0)continue;const P=i[y][E],z=A.metrics.localGlyph?2:1;Os.copy(A.bitmap,g,{x:0,y:0},{x:P.x+z,y:P.y+z},A.bitmap)}}this.image=g,this.positions=i}}Zt(db,"GlyphAtlas");class KA{constructor(e){this.tileID=new Rr(e.tileID.overscaledZ,e.tileID.wrap,e.tileID.canonical.z,e.tileID.canonical.x,e.tileID.canonical.y),this.tileZoom=e.tileZoom,this.uid=e.uid,this.zoom=e.zoom,this.canonical=e.tileID.canonical,this.pixelRatio=e.pixelRatio,this.tileSize=e.tileSize,this.source=e.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=e.showCollisionBoxes,this.collectResourceTiming=!!e.collectResourceTiming,this.returnDependencies=!!e.returnDependencies,this.promoteId=e.promoteId,this.enableTerrain=!!e.enableTerrain,this.isSymbolTile=e.isSymbolTile,this.tileTransform=Pl(e.tileID.canonical,e.projection),this.projection=e.projection}parse(e,i,a,c,d){this.status="parsing",this.data=e,this.collisionBoxArray=new Ag;const g=new Wx(Object.keys(e.layers).sort()),y=new cb(this.tileID,this.promoteId);y.bucketLayerIDs=[];const b={},E=new hb(256,256),A={featureIndex:y,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:E,availableImages:a},P=i.familiesBySource[this.source];for(const be in P){const _e=e.layers[be];if(!_e)continue;let $e=!1,je=!1;for(const Ke of P[be])Ke[0].type==="symbol"?$e=!0:je=!0;if(this.isSymbolTile===!0&&!$e||this.isSymbolTile===!1&&!je)continue;_e.version===1&&re(`Vector tile source "${this.source}" layer "${be}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const it=g.encode(be),St=[];for(let Ke=0;Ke<_e.length;Ke++){const ut=_e.feature(Ke),dt=y.getId(ut,be);St.push({feature:ut,id:dt,index:Ke,sourceLayerIndex:it})}for(const Ke of P[be]){const ut=Ke[0];this.isSymbolTile!==void 0&&ut.type==="symbol"!==this.isSymbolTile||ut.minzoom&&this.zoom<Math.floor(ut.minzoom)||ut.maxzoom&&this.zoom>=ut.maxzoom||ut.visibility!=="none"&&(T_(Ke,this.zoom,a),(b[ut.id]=ut.createBucket({index:y.bucketLayerIDs.length,layers:Ke,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:it,sourceID:this.source,enableTerrain:this.enableTerrain,projection:this.projection.spec,availableImages:a})).populate(St,A,this.tileID.canonical,this.tileTransform),y.bucketLayerIDs.push(Ke.map(dt=>dt.id)))}}let z,O,F,q;E.trim();const Z={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},le=_t(A.glyphDependencies,be=>Object.keys(be).map(Number));Object.keys(le).length?c.send("getGlyphs",{uid:this.uid,stacks:le},(be,_e)=>{z||(z=be,O=_e,de.call(this))},void 0,!1,Z):O={};const ge=Object.keys(A.iconDependencies);ge.length?c.send("getImages",{icons:ge,source:this.source,tileID:this.tileID,type:"icons"},(be,_e)=>{z||(z=be,F=_e,de.call(this))},void 0,!1,Z):F={};const ae=Object.keys(A.patternDependencies);function de(){if(z)return d(z);if(O&&F&&q){const be=new db(O),_e=new dx(F,q);for(const $e in b){const je=b[$e];je instanceof Ea?(T_(je.layers,this.zoom,a),yA(je,O,be.positions,F,_e.iconPositions,this.showCollisionBoxes,a,this.tileID.canonical,this.tileZoom,this.projection)):je.hasPattern&&(je instanceof sp||je instanceof tp||je instanceof jh)&&(T_(je.layers,this.zoom,a),je.addFeatures(A,this.tileID.canonical,_e.patternPositions,a,this.tileTransform))}this.status="done",d(null,{buckets:tn(b).filter($e=>!$e.isEmpty()),featureIndex:y,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:be.image,lineAtlas:E,imageAtlas:_e,glyphMap:this.returnDependencies?O:null,iconMap:this.returnDependencies?F:null,glyphPositions:this.returnDependencies?be.positions:null})}}ae.length?c.send("getImages",{icons:ae,source:this.source,tileID:this.tileID,type:"patterns"},(be,_e)=>{z||(z=be,q=_e,de.call(this))},void 0,!1,Z):q={},de.call(this)}}function T_(n,e,i){const a=new Le(e);for(const c of n)c.recalculate(a,i)}class fb{constructor(e){this.entries={},this.scheduler=e}request(e,i,a,c){const d=this.entries[e]=this.entries[e]||{callbacks:[]};if(d.result){const[g,y]=d.result;return this.scheduler?this.scheduler.add(()=>{c(g,y)},i):c(g,y),()=>{}}return d.callbacks.push(c),d.cancel||(d.cancel=a((g,y)=>{d.result=[g,y];for(const b of d.callbacks)this.scheduler?this.scheduler.add(()=>{b(g,y)},i):b(g,y);setTimeout(()=>delete this.entries[e],3e3)})),()=>{d.result||(d.callbacks=d.callbacks.filter(g=>g!==c),d.callbacks.length||(d.cancel(),delete this.entries[e]))}}}function pb(n,e,i){const a=JSON.stringify(n.request);return n.data&&(this.deduped.entries[a]={result:[null,n.data]}),this.deduped.request(a,{type:"parseTile",isSymbolTile:n.isSymbolTile,zoom:n.tileZoom},c=>{const d=tr(n.request,(g,y,b,E)=>{g?c(g):y&&c(null,{vectorTile:i?void 0:new Jg(new Hh(y)),rawData:y,cacheControl:b,expires:E})});return()=>{d.cancel(),c()}},e)}o.ARRAY_TYPE=Yr,o.AUTH_ERR_MSG=fo,o.Aabb=Lr,o.Actor=class{constructor(n,e,i){this.target=n,this.parent=e,this.mapId=i,this.callbacks={},this.cancelCallbacks={},gt(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.globalScope=nt()?n:S,this.scheduler=new GA}send(n,e,i,a,c=!1,d){const g=Math.round(1e18*Math.random()).toString(36).substring(0,10);i&&(i.metadata=d,this.callbacks[g]=i);const y=Vt(this.globalScope)?void 0:[];return this.target.postMessage({id:g,type:n,hasCallback:!!i,targetMapId:a,mustQueue:c,sourceMapId:this.mapId,data:os(e,y)},y),{cancel:()=>{i&&delete this.callbacks[g],this.target.postMessage({id:g,type:"<cancel>",targetMapId:a,sourceMapId:this.mapId})}}}receive(n){const e=n.data,i=e.id;if(i&&(!e.targetMapId||this.mapId===e.targetMapId))if(e.type==="<cancel>"){const a=this.cancelCallbacks[i];delete this.cancelCallbacks[i],a&&a.cancel()}else if(e.mustQueue||nt()){const a=this.callbacks[i];this.cancelCallbacks[i]=this.scheduler.add(()=>this.processTask(i,e),a&&a.metadata||{type:"message"})}else this.processTask(i,e)}processTask(n,e){if(e.type==="<response>"){const i=this.callbacks[n];delete this.callbacks[n],i&&(e.error?i(yl(e.error)):i(null,yl(e.data)))}else{const i=Vt(this.globalScope)?void 0:[],a=e.hasCallback?(d,g)=>{delete this.cancelCallbacks[n],this.target.postMessage({id:n,type:"<response>",sourceMapId:this.mapId,error:d?os(d):null,data:os(g,i)},i)}:d=>{},c=yl(e.data);if(this.parent[e.type])this.parent[e.type](e.sourceMapId,c,a);else if(this.parent.getWorkerSource){const d=e.type.split(".");this.parent.getWorkerSource(e.sourceMapId,d[0],c.source)[d[1]](c,a)}else a(new Error(`Could not find function ${e.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}},o.CanonicalTileID=op,o.Color=ki,o.ColorMode=fs,o.CullFaceMode=$o,o.DEMData=Ep,o.DataConstantProperty=De,o.DedupedRequest=fb,o.DepthMode=nu,o.EXTENT=_n,o.Elevation=class{isDataAvailableAtPoint(n){const e=this._source();if(this.isUsingMockSource()||!e||n.y<0||n.y>1)return!1;const i=e.getSource().maxzoom,a=1<<i,c=Math.floor(n.x),d=Math.floor((n.x-c)*a),g=Math.floor(n.y*a),y=this.findDEMTileFor(new Rr(i,c,i,d,g));return!(!y||!y.dem)}getAtPointOrZero(n,e=0){return this.getAtPoint(n,e)||0}getAtPoint(n,e,i=!0){if(this.isUsingMockSource())return null;e==null&&(e=null);const a=this._source();if(!a||n.y<0||n.y>1)return e;const c=a.getSource().maxzoom,d=1<<c,g=Math.floor(n.x),y=n.x-g,b=new Rr(c,g,c,Math.floor(y*d),Math.floor(n.y*d)),E=this.findDEMTileFor(b);if(!E||!E.dem)return e;const A=E.dem,P=1<<E.tileID.canonical.z,z=(y*P-E.tileID.canonical.x)*A.dim,O=(n.y*P-E.tileID.canonical.y)*A.dim,F=Math.floor(z),q=Math.floor(O);return(i?this.exaggeration():1)*$n($n(A.get(F,q),A.get(F,q+1),O-q),$n(A.get(F+1,q),A.get(F+1,q+1),O-q),z-F)}getAtTileOffset(n,e,i){const a=1<<n.canonical.z;return this.getAtPointOrZero(new Nc(n.wrap+(n.canonical.x+e/_n)/a,(n.canonical.y+i/_n)/a))}getAtTileOffsetFunc(n,e,i,a){return c=>{const d=this.getAtTileOffset(n,c.x,c.y),g=a.upVector(n.canonical,c.x,c.y);return co(g,g,d*a.upVectorScale(n.canonical,e,i).metersToTile),g}}getForTilePoints(n,e,i,a){if(this.isUsingMockSource())return!1;const c=Tp.create(this,n,a);return!!c&&(e.forEach(d=>{d[2]=this.exaggeration()*c.getElevationAt(d[0],d[1],i)}),!0)}getMinMaxForTile(n){if(this.isUsingMockSource())return null;const e=this.findDEMTileFor(n);if(!e||!e.dem)return null;const i=e.dem.tree,a=e.tileID,c=1<<n.canonical.z-a.canonical.z;let d=n.canonical.x/c-a.canonical.x,g=n.canonical.y/c-a.canonical.y,y=0;for(let b=0;b<n.canonical.z-a.canonical.z&&!i.leaves[y];b++){d*=2,g*=2;const E=2*Math.floor(g)+Math.floor(d);y=i.childOffsets[y]+E,d%=1,g%=1}return{min:this.exaggeration()*i.minimums[y],max:this.exaggeration()*i.maximums[y]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(n,e,i){throw new Error("Pure virtual method called.")}pointCoordinate(n){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(n){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}},o.ErrorEvent=ai,o.EvaluationParameters=Le,o.Event=Bn,o.Evented=mi,o.FillExtrusionBucket=jh,o.Frustum=$g,o.FrustumCorners=jg,o.GLOBE_METERS_TO_ECEF=u_,o.GLOBE_RADIUS=Ns,o.GLOBE_SCALE_MATCH_LATITUDE=45,o.GLOBE_ZOOM_THRESHOLD_MAX=6,o.GLOBE_ZOOM_THRESHOLD_MIN=5,o.GlobeSharedBuffers=class{constructor(n){this._createGrid(n),this._createPoles(n)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const n of this._poleSegments)n.destroy();for(const n of this._gridSegments)n.destroy();if(this._wireframeIndexBuffer){this._wireframeIndexBuffer.destroy();for(const n of this._wireframeSegments)n.destroy()}}_createGrid(n){const e=new Hn,i=new pr,a=65;for(let c=0;c<a;c++)for(let d=0;d<a;d++)e.emplaceBack(d,c);this._gridSegments=[];for(let c=0,d=0;c<Qc.length;c++){const g=Qc[c];for(let b=0;b<g;b++)for(let E=0;E<64;E++){const A=b*a+E;i.emplaceBack(A+1,A,A+a),i.emplaceBack(A+a,A+a+1,A+1)}const y=64*g*2;this._gridSegments.push(Hi.simpleSegment(0,d,(g+1)*a,y)),d+=y}this._gridBuffer=n.createVertexBuffer(e,Kh.members),this._gridIndexBuffer=n.createIndexBuffer(i,!0)}_createPoles(n){const e=new pr;for(let c=0;c<=Yc;c++)e.emplaceBack(0,c+1,c+2);this._poleIndexBuffer=n.createIndexBuffer(e,!0);const i=new wl,a=new wl;this._poleSegments=[];for(let c=0,d=0;c<5;c++){const g=360/(1<<c);i.emplaceBack(0,-Ns,0,.5,0),a.emplaceBack(0,-Ns,0,.5,1);for(let y=0;y<=Yc;y++){const b=y/Yc,E=$n(0,g,b),[A,P,z]=Jc(SA,CA,E,Ns);i.emplaceBack(A,P,z,b,0),a.emplaceBack(A,P,z,b,1)}this._poleSegments.push(Hi.simpleSegment(d,0,66,64)),d+=66}this._poleNorthVertexBuffer=n.createVertexBuffer(i,zx,!1),this._poleSouthVertexBuffer=n.createVertexBuffer(a,zx,!1)}getGridBuffers(n){return[this._gridBuffer,this._gridIndexBuffer,this._gridSegments[n]]}getPoleBuffers(n){return[this._poleNorthVertexBuffer,this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[n]]}getWirefameBuffers(n,e){if(!this._wireframeSegments){const i=new bo,a=Yc,c=a+1;this._wireframeSegments=[];for(let d=0,g=0;d<Qc.length;d++){const y=Qc[d];for(let E=0;E<y;E++)for(let A=0;A<a;A++){const P=E*c+A;i.emplaceBack(P,P+1),i.emplaceBack(P,P+c),i.emplaceBack(P,P+c+1)}const b=y*a*3;this._wireframeSegments.push(Hi.simpleSegment(0,g,(y+1)*c,b)),g+=b}this._wireframeIndexBuffer=n.createIndexBuffer(i)}return[this._gridBuffer,this._wireframeIndexBuffer,this._wireframeSegments[e]]}},o.GlyphManager=Xc,o.ImagePosition=i_,o.LivePerformanceUtils=Ft,o.LngLat=qn,o.LngLatBounds=xa,o.LocalGlyphMode=s_,o.MAX_MERCATOR_LATITUDE=ls,o.MercatorCoordinate=Nc,o.ONE_EM=gr,o.OverscaledTileID=Rr,o.PerformanceMarkers=ht,o.Properties=ln,o.RGBAImage=Qr,o.Ray=qg,o.RequestManager=class{constructor(n,e,i){this._transformRequestFn=n,this._customAccessToken=e,this._silenceAuthErrors=!!i,this._createSkuToken()}_createSkuToken(){const n=function(){let e="";for(let i=0;i<10;i++)e+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",te,e].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=n.token,this._skuTokenExpiresAt=n.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(n,e){return this._transformRequestFn&&this._transformRequestFn(n,e)||{url:n}}normalizeStyleURL(n,e){if(!xr(n))return n;const i=hn(n);return i.path=`/styles/v1${i.path}`,this._makeAPIURL(i,this._customAccessToken||e)}normalizeGlyphsURL(n,e){if(!xr(n))return n;const i=hn(n);return i.path=`/fonts/v1${i.path}`,this._makeAPIURL(i,this._customAccessToken||e)}normalizeSourceURL(n,e,i,a){if(!xr(n))return n;const c=hn(n);return c.path=`/v4/${c.authority}.json`,c.params.push("secure"),i&&c.params.push(`language=${i}`),a&&c.params.push(`worldview=${a}`),this._makeAPIURL(c,this._customAccessToken||e)}normalizeSpriteURL(n,e,i,a){const c=hn(n);return xr(n)?(c.path=`/styles/v1${c.path}/sprite${e}${i}`,this._makeAPIURL(c,this._customAccessToken||a)):(c.path+=`${e}${i}`,En(c))}normalizeTileURL(n,e,i){if(this._isSkuTokenExpired()&&this._createSkuToken(),n&&!xr(n))return n;const a=hn(n);a.path=a.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${e||i&&a.authority!=="raster"&&i===512?"@2x":""}${B.supported?".webp":"$1"}`),a.authority==="raster"?a.path=`/${D.RASTER_URL_PREFIX}${a.path}`:(a.path=a.path.replace(/^.+\/v4\//,"/"),a.path=`/${D.TILE_URL_VERSION}${a.path}`);const c=this._customAccessToken||function(d){for(const g of d){const y=g.match(/^access_token=(.*)$/);if(y)return y[1]}return null}(a.params)||D.ACCESS_TOKEN;return D.REQUIRE_ACCESS_TOKEN&&c&&this._skuToken&&a.params.push(`sku=${this._skuToken}`),this._makeAPIURL(a,c)}canonicalizeTileURL(n,e){const i=hn(n);if(!i.path.match(/^(\/v4\/|\/raster\/v1\/)/)||!i.path.match(/\.[\w]+$/))return n;let a="mapbox://";i.path.match(/^\/raster\/v1\//)?a+=`raster/${i.path.replace(`/${D.RASTER_URL_PREFIX}/`,"")}`:a+=`tiles/${i.path.replace(`/${D.TILE_URL_VERSION}/`,"")}`;let c=i.params;return e&&(c=c.filter(d=>!d.match(/^access_token=/))),c.length&&(a+=`?${c.join("&")}`),a}canonicalizeTileset(n,e){const i=!!e&&xr(e),a=[];for(const c of n.tiles||[])oo(c)?a.push(this.canonicalizeTileURL(c,i)):a.push(c);return a}_makeAPIURL(n,e){const i="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",a=hn(D.API_URL);if(n.protocol=a.protocol,n.authority=a.authority,n.protocol==="http"){const c=n.params.indexOf("secure");c>=0&&n.params.splice(c,1)}if(a.path!=="/"&&(n.path=`${a.path}${n.path}`),!D.REQUIRE_ACCESS_TOKEN)return En(n);if(e=e||D.ACCESS_TOKEN,!this._silenceAuthErrors){if(!e)throw new Error(`An API access token is required to use Mapbox GL. ${i}`);if(e[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${i}`)}return n.params=n.params.filter(c=>c.indexOf("access_token")===-1),n.params.push(`access_token=${e||""}`),En(n)}},o.ResourceType=Wn,o.SegmentVector=Hi,o.SourceCache=zl,o.StencilMode=b_,o.StructArrayLayout1ui2=Mh,o.StructArrayLayout2f1f2i16=Er,o.StructArrayLayout2i4=Hn,o.StructArrayLayout2ui4=bo,o.StructArrayLayout3f12=No,o.StructArrayLayout3ui6=pr,o.StructArrayLayout4i8=ii,o.StructArrayLayout5f20=wl,o.Texture=rd,o.Tile=v_,o.Transitionable=st,o.Uniform1f=jf,o.Uniform1i=class extends zs{constructor(n){super(n),this.current=0}set(n,e,i){this.fetchUniformLocation(n,e)&&this.current!==i&&(this.current=i,this.gl.uniform1i(this.location,i))}},o.Uniform2f=class extends zs{constructor(n){super(n),this.current=[0,0]}set(n,e,i){this.fetchUniformLocation(n,e)&&(i[0]===this.current[0]&&i[1]===this.current[1]||(this.current=i,this.gl.uniform2f(this.location,i[0],i[1])))}},o.Uniform3f=class extends zs{constructor(n){super(n),this.current=[0,0,0]}set(n,e,i){this.fetchUniformLocation(n,e)&&(i[0]===this.current[0]&&i[1]===this.current[1]&&i[2]===this.current[2]||(this.current=i,this.gl.uniform3f(this.location,i[0],i[1],i[2])))}},o.Uniform4f=i0,o.UniformColor=r0,o.UniformMatrix2f=class extends zs{constructor(n){super(n),this.current=k2}set(n,e,i){if(this.fetchUniformLocation(n,e)){for(let a=0;a<4;a++)if(i[a]!==this.current[a]){this.current=i,this.gl.uniformMatrix2fv(this.location,!1,i);break}}}},o.UniformMatrix3f=class extends zs{constructor(n){super(n),this.current=I2}set(n,e,i){if(this.fetchUniformLocation(n,e)){for(let a=0;a<9;a++)if(i[a]!==this.current[a]){this.current=i,this.gl.uniformMatrix3fv(this.location,!1,i);break}}}},o.UniformMatrix4f=class extends zs{constructor(n){super(n),this.current=M2}set(n,e,i){if(this.fetchUniformLocation(n,e)){if(i[12]!==this.current[12]||i[0]!==this.current[0])return this.current=i,void this.gl.uniformMatrix4fv(this.location,!1,i);for(let a=1;a<16;a++)if(i[a]!==this.current[a]){this.current=i,this.gl.uniformMatrix4fv(this.location,!1,i);break}}}},o.UnwrappedTileID=J0,o.ValidationError=$t,o.VectorTileFeature=ip,o.VectorTileWorkerSource=class extends mi{constructor(n,e,i,a,c){super(),this.actor=n,this.layerIndex=e,this.availableImages=i,this.loadVectorData=c||pb,this.loading={},this.loaded={},this.deduped=new fb(n.scheduler),this.isSpriteLoaded=a,this.scheduler=n.scheduler}loadTile(n,e){const i=n.uid,a=n&&n.request,c=a&&a.collectResourceTiming,d=this.loading[i]=new KA(n);d.abort=this.loadVectorData(n,(g,y)=>{const b=!this.loading[i];if(delete this.loading[i],b||g||!y)return d.status="done",b||(this.loaded[i]=d),e(g);const E=y.rawData,A={};y.expires&&(A.expires=y.expires),y.cacheControl&&(A.cacheControl=y.cacheControl),d.vectorTile=y.vectorTile||new Jg(new Hh(E));const P=()=>{d.parse(d.vectorTile,this.layerIndex,this.availableImages,this.actor,(z,O)=>{if(z||!O)return e(z);const F={};if(c){const q=on(a);q.length>0&&(F.resourceTiming=JSON.parse(JSON.stringify(q)))}e(null,Ve({rawTileData:E.slice(0)},O,A,F))})};this.isSpriteLoaded?P():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(P,{type:"parseTile",isSymbolTile:n.isSymbolTile,zoom:n.tileZoom}):P()}),this.loaded=this.loaded||{},this.loaded[i]=d})}reloadTile(n,e){const i=this.loaded,a=n.uid,c=this;if(i&&i[a]){const d=i[a];d.showCollisionBoxes=n.showCollisionBoxes,d.enableTerrain=!!n.enableTerrain,d.projection=n.projection,d.tileTransform=Pl(n.tileID.canonical,n.projection);const g=(y,b)=>{const E=d.reloadCallback;E&&(delete d.reloadCallback,d.parse(d.vectorTile,c.layerIndex,this.availableImages,c.actor,E)),e(y,b)};d.status==="parsing"?d.reloadCallback=g:d.status==="done"&&(d.vectorTile?d.parse(d.vectorTile,this.layerIndex,this.availableImages,this.actor,g):g())}}abortTile(n,e){const i=n.uid,a=this.loading[i];a&&(a.abort&&a.abort(),delete this.loading[i]),e()}removeTile(n,e){const i=this.loaded,a=n.uid;i&&i[a]&&delete i[a],e()}},o.WritingMode=uo,o.add=Ds,o.addDynamicAttributes=xp,o.adjoint=function(n,e){var i=e[0],a=e[1],c=e[2],d=e[3],g=e[4],y=e[5],b=e[6],E=e[7],A=e[8];return n[0]=g*A-y*E,n[1]=c*E-a*A,n[2]=a*y-c*g,n[3]=y*b-d*A,n[4]=i*A-c*b,n[5]=c*d-i*y,n[6]=d*E-g*b,n[7]=a*b-i*E,n[8]=i*g-a*d,n},o.asyncAll=At,o.bezier=Ze,o.bindAll=gt,o.boundsAttributes=Yx,o.bufferConvexPolygon=function(n,e){const i=[];for(let a=0;a<n.length;a++){const c=Ge(a-1,-1,n.length-1),d=Ge(a+1,-1,n.length-1),g=n[a],y=n[d],b=n[c].sub(g).unit(),E=y.sub(g).unit(),A=E.angleWithSep(b.x,b.y),P=b.add(E).unit().mult(-1*e/Math.sin(A/2));i.push(g.add(P))}return i},o.cacheEntryPossiblyAdded=function(n){jn++,jn>nn&&(n.getActor().send("enforceCacheSizeLimit",Rt),jn=0)},o.calculateGlobeLabelMatrix=function(n,e){const{x:i,y:a}=n.point,c=Fx(i,a,n.worldSize/n._pixelsPerMercatorPixel,0,0);return Cl(c,c,f_(us(e)))},o.calculateGlobeMatrix=function(n){const{x:e,y:i}=n.point,{lng:a,lat:c}=n._center;return Fx(e,i,n.worldSize,a,c)},o.calculateGlobeMercatorMatrix=function(n){const e=n.pixelsPerMeter,i=e/wo(1,n.center.lat),a=qo(new Float64Array(16));return kh(a,a,[n.point.x,n.point.y,0]),Al(a,a,[i,i,e]),Float32Array.from(a)},o.circumferenceAtLatitude=kg,o.clamp=lt,o.clearTileCache=function(n){if(!bn())return;const e=S.caches.delete(Mt);n&&e.catch(n).then(()=>n())},o.clipLine=Tx,o.clone=function(n){var e=new Yr(16);return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[4]=n[4],e[5]=n[5],e[6]=n[6],e[7]=n[7],e[8]=n[8],e[9]=n[9],e[10]=n[10],e[11]=n[11],e[12]=n[12],e[13]=n[13],e[14]=n[14],e[15]=n[15],e},o.clone$1=sn,o.collisionCircleLayout=$C,o.config=D,o.conjugate=function(n,e){return n[0]=-e[0],n[1]=-e[1],n[2]=-e[2],n[3]=e[3],n},o.create=function(){var n=new Yr(16);return Yr!=Float32Array&&(n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=0,n[12]=0,n[13]=0,n[14]=0),n[0]=1,n[5]=1,n[10]=1,n[15]=1,n},o.create$1=y0,o.createExpression=is,o.createLayout=Gt,o.createStyleLayer=function(n){return n.type==="custom"?new UA(n):new jA[n.type](n)},o.cross=Ug,o.degToRad=Ie,o.distance=function(n,e){return Math.hypot(e[0]-n[0],e[1]-n[1],e[2]-n[2])},o.div=function(n,e,i){return n[0]=e[0]/i[0],n[1]=e[1]/i[1],n[2]=e[2]/i[2],n},o.dot=Eo,o.earthRadius=Gf,o.ease=Ye,o.easeCubicInOut=Re,o.ecefToLatLng=function([n,e,i]){const a=Math.hypot(n,e,i),c=Math.atan2(n,i),d=.5*Math.PI-Math.acos(-e/a);return new qn(ke(c),ke(d))},o.emitValidationErrors=Mf,o.endsWith=ot,o.enforceCacheSizeLimit=function(n){zn(),Ht&&Ht.then(e=>{e.keys().then(i=>{for(let a=0;a<i.length-n;a++)e.delete(i[a])})})},o.evaluateSizeForFeature=ap,o.evaluateSizeForZoom=Gc,o.evaluateVariableOffset=Ix,o.evented=ve,o.exactEquals=function(n,e){return n[0]===e[0]&&n[1]===e[1]&&n[2]===e[2]&&n[3]===e[3]},o.exactEquals$1=function(n,e){return n[0]===e[0]&&n[1]===e[1]&&n[2]===e[2]},o.exported=at,o.exported$1=B,o.extend=Ve,o.extend$1=Ro,o.fillExtrusionHeightLift=K0,o.filterObject=ft,o.fromMat4=function(n,e){return n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[4],n[4]=e[5],n[5]=e[6],n[6]=e[8],n[7]=e[9],n[8]=e[10],n},o.fromQuat=function(n,e){var i=e[0],a=e[1],c=e[2],d=e[3],g=i+i,y=a+a,b=c+c,E=i*g,A=a*g,P=a*y,z=c*g,O=c*y,F=c*b,q=d*g,Z=d*y,le=d*b;return n[0]=1-P-F,n[1]=A+le,n[2]=z-Z,n[3]=0,n[4]=A-le,n[5]=1-E-F,n[6]=O+q,n[7]=0,n[8]=z+Z,n[9]=O-q,n[10]=1-E-P,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n},o.fromRotation=function(n,e){var i=Math.sin(e),a=Math.cos(e);return n[0]=a,n[1]=i,n[2]=0,n[3]=-i,n[4]=a,n[5]=0,n[6]=0,n[7]=0,n[8]=1,n},o.fromScaling=x0,o.furthestTileCorner=function(n){const e=Math.round((n+45+360)%360/90)%4;return Be[e]},o.getAABBPointSquareDist=function(n,e,i){let a=0;for(let c=0;c<2;++c){const d=i?i[c]:0;n[c]>d&&(a+=(n[c]-d)*(n[c]-d)),e[c]<d&&(a+=(d-e[c])*(d-e[c]))}return a},o.getAnchorAlignment=o_,o.getAnchorJustification=l_,o.getBounds=function(n){let e=1/0,i=1/0,a=-1/0,c=-1/0;for(const d of n)e=Math.min(e,d.x),i=Math.min(i,d.y),a=Math.max(a,d.x),c=Math.max(c,d.y);return{min:new ce(e,i),max:new ce(a,c)}},o.getColumn=bt,o.getGridMatrix=function(n,e,i,a){const c=e.getNorth(),d=e.getSouth(),g=e.getWest(),y=e.getEast(),b=1<<n.z,E=y-g,A=c-d,P=E/Yc,z=-A/Qc[i],O=[0,P,0,z,0,0,c,g,0];if(n.z>0){const F=180/a;v0(O,O,[F/E+1,0,0,0,F/A+1,0,-.5*F/P,.5*F/z,1])}return O[2]=b,O[5]=n.x,O[8]=n.y,O},o.getImage=Mr,o.getJSON=function(n,e){return ji(Ve(n,{type:"json"}),e)},o.getLatitudinalLod=function(n){const e=80.051129;n=lt(n,-80.051129,e)/e*90;const i=Math.pow(Math.abs(Math.sin(Ie(n))),3);return Math.round(i*(Qc.length-1))},o.getMapSessionAPI=Ce,o.getPerformanceMeasurement=on,o.getProjection=Zx,o.getRTLTextPluginStatus=Pe,o.getReferrer=qi,o.getTilePoint=function(n,{x:e,y:i},a=0){return new ce(((e-a)*n.scale-n.x)*_n,(i*n.scale-n.y)*_n)},o.getTileVec3=function(n,e,i=0){return Uc(((e.x-i)*n.scale-n.x)*_n,(e.y*n.scale-n.y)*_n,a0(e.z,e.y))},o.getVideo=function(n,e){const i=S.document.createElement("video");i.muted=!0,i.onloadstart=function(){e(null,i)};for(let a=0;a<n.length;a++){const c=S.document.createElement("source");Ei(n[a])||(i.crossOrigin="Anonymous"),c.src=n[a],i.appendChild(c)}return{cancel:()=>{}}},o.globeCenterToScreenPoint=function(n){const e=[0,0,0],i=qo(new Float64Array(16));return Cl(i,n.pixelMatrix,n.globeMatrix),Di(e,e,i),new ce(e[0],e[1])},o.globeDenormalizeECEF=f_,o.globeECEFOrigin=function(n,e){const i=[0,0,0];return Di(i,i,Jh(us(e.canonical))),Di(i,i,n),i},o.globeNormalizeECEF=Jh,o.globePixelsToTileUnits=function(n,e){return _n/(512*Math.pow(2,n))*mp(us(e))},o.globePoleMatrixForTile=function(n,e,i){const a=qo(new Float64Array(16)),c=(e/(1<<n)-.5)*Math.PI*2;return Kf(a,i.globeMatrix,c),Float32Array.from(a)},o.globeTileBounds=us,o.globeTiltAtLngLat=Nx,o.globeToMercatorTransition=eu,o.globeUseCustomAntiAliasing=function(n,e,i){const a=eu(i.zoom),c=n.style.map._antialias,d=!!e.extStandardDerivatives,g=e.extStandardDerivativesForceOff||n.terrain&&n.terrain.exaggeration()>0;return a===0&&!c&&!g&&d},o.identity=qo,o.identity$1=M0,o.invert=Bg,o.isFullscreen=function(){return!!S.document.fullscreenElement||!!S.document.webkitFullscreenElement},o.isLngLatBehindGlobe=p_,o.isMapAuthenticated=function(n){return Ne.has(n)},o.isMapboxURL=xr,o.isSafariWithAntialiasingBug=function(n){const e=n.navigator?n.navigator.userAgent:null;return!!Vt(n)&&e&&(e.match("Version/15.4")||e.match("Version/15.5")||e.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},o.latFromMercatorY=mr,o.latLngToECEF=Yh,o.len=H2,o.length=Ph,o.length$1=function(n){return Math.hypot(n[0],n[1],n[2],n[3])},o.lngFromMercatorX=lo,o.loadVectorTile=pb,o.makeRequest=ji,o.mapValue=function(n,e,i,a,c){return lt((n-e)/(i-e)*(c-a)+a,a,c)},o.mercatorScale=l0,o.mercatorXfromLng=ss,o.mercatorYfromLat=as,o.mercatorZfromAltitude=wo,o.mul=G2,o.mul$1=Z2,o.multiply=Cl,o.multiply$1=v0,o.multiply$2=E0,o.nextPowerOfTwo=xn,o.normalize=zr,o.normalize$1=W2,o.normalize$2=C0,o.number=$n,o.ortho=function(n,e,i,a,c,d,g){var y=1/(e-i),b=1/(a-c),E=1/(d-g);return n[0]=-2*y,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=-2*b,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=2*E,n[11]=0,n[12]=(e+i)*y,n[13]=(c+a)*b,n[14]=(g+d)*E,n[15]=1,n},o.pbf=Hh,o.perspective=function(n,e,i,a,c){var d,g=1/Math.tan(e/2);return n[0]=g/i,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=g,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=-1,n[12]=0,n[13]=0,n[15]=0,c!=null&&c!==1/0?(n[10]=(c+a)*(d=1/(a-c)),n[14]=2*c*a*d):(n[10]=-1,n[14]=-2*a),n},o.pick=function(n,e){const i={};for(let a=0;a<e.length;a++){const c=e[a];c in n&&(i[c]=n[c])}return i},o.plugin=qe,o.pointGeometry=ce,o.polesInViewport=function(n){const e=qo(new Float64Array(16));Cl(e,n.pixelMatrix,n.globeMatrix);const i=[0,To,0],a=[0,So,0];return Di(i,i,e),Di(a,a,e),[i[0]>0&&i[0]<=n.width&&i[1]>0&&i[1]<=n.height&&!p_(n,new qn(n.center.lat,90)),a[0]>0&&a[0]<=n.width&&a[1]>0&&a[1]<=n.height&&!p_(n,new qn(n.center.lat,-90))]},o.polygonContainsPoint=Sl,o.polygonIntersectsBox=m0,o.polygonIntersectsPolygon=h0,o.polygonizeBounds=function(n,e,i=0,a=!0){const c=new ce(i,i),d=n.sub(c),g=e.add(c),y=[d,new ce(g.x,d.y),g,new ce(d.x,g.y)];return a&&y.push(d.clone()),y},o.posAttributes=Kh,o.postMapLoadEvent=ue,o.postPerformanceEvent=Oe,o.postTurnstileEvent=j,o.potpack=n_,o.prevPowerOfTwo=function(n){return n<=1?1:Math.pow(2,Math.floor(Math.log(n)/Math.LN2))},o.radToDeg=ke,o.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],o.registerForPluginStateChange=function(n){return n({pluginStatus:ie,pluginURL:ee}),ve.on("pluginStateChange",n),n},o.removeAuthState=function(n){Ne.delete(n)},o.renderColorRamp=Zg,o.resample=c0,o.rotateX=Fg,o.rotateX$1=I0,o.rotateY=Kf,o.rotateY$1=k0,o.rotateZ=function(n,e,i){var a=Math.sin(i),c=Math.cos(i),d=e[0],g=e[1],y=e[2],b=e[3],E=e[4],A=e[5],P=e[6],z=e[7];return e!==n&&(n[8]=e[8],n[9]=e[9],n[10]=e[10],n[11]=e[11],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n[0]=d*c+E*a,n[1]=g*c+A*a,n[2]=y*c+P*a,n[3]=b*c+z*a,n[4]=E*c-d*a,n[5]=A*c-g*a,n[6]=P*c-y*a,n[7]=z*c-b*a,n},o.rotateZ$1=function(n,e,i){i*=.5;var a=e[0],c=e[1],d=e[2],g=e[3],y=Math.sin(i),b=Math.cos(i);return n[0]=a*b+c*y,n[1]=c*b-a*y,n[2]=d*b+g*y,n[3]=g*b-d*y,n},o.scale=Al,o.scale$1=S0,o.scale$2=co,o.scaleAndAdd=Rh,o.set=function(n,e,i,a){return n[0]=e,n[1]=i,n[2]=a,n},o.setCacheLimits=function(n,e){Rt=n,nn=e},o.setColumn=function(n,e,i){n[4*e+0]=i[0],n[4*e+1]=i[1],n[4*e+2]=i[2],n[4*e+3]=i[3]},o.setRTLTextPlugin=function(n,e,i=!1){if(ie===K||ie===J||ie===H)throw new Error("setRTLTextPlugin cannot be called multiple times.");ee=at.resolveURL(n),ie=K,W=e,we(),i||He()},o.smoothstep=Xt,o.spec=tt,o.squaredLength=function(n){var e=n[0],i=n[1],a=n[2];return e*e+i*i+a*a},o.storeAuthState=function(n,e){e?Ne.add(n):Ne.delete(n)},o.sub=jo,o.subtract=Vg,o.symbolSize=GC,o.tileAABB=function(n,e,i,a,c,d,g,y,b){if(b.name==="globe")return TA(n,e,new op(i,a,c));const E=Pl({z:i,x:a,y:c},b);return new Lr([(d+E.x/E.scale)*e,e*(E.y/E.scale),g],[(d+E.x2/E.scale)*e,e*(E.y2/E.scale),y])},o.tileCornersToBounds=pp,o.tileTransform=Pl,o.transformMat3=function(n,e,i){var a=e[0],c=e[1],d=e[2];return n[0]=a*i[0]+c*i[3]+d*i[6],n[1]=a*i[1]+c*i[4]+d*i[7],n[2]=a*i[2]+c*i[5]+d*i[8],n},o.transformMat4=Di,o.transformMat4$1=Ml,o.transformQuat=T0,o.transitionTileAABBinECEF=Dx,o.translate=kh,o.transpose=function(n,e){if(n===e){var i=e[1],a=e[2],c=e[5];n[1]=e[3],n[2]=e[6],n[3]=i,n[5]=e[7],n[6]=a,n[7]=c}else n[0]=e[0],n[1]=e[3],n[2]=e[6],n[3]=e[1],n[4]=e[4],n[5]=e[7],n[6]=e[2],n[7]=e[5],n[8]=e[8];return n},o.triggerPluginCompletionEvent=he,o.uniqueId=Bt,o.updateGlobeVertexNormal=function(n,e,i,a,c){const d=5*e+2;n.float32[d+0]=i,n.float32[d+1]=a,n.float32[d+2]=c},o.validateCustomStyleLayer=function(n){const e=[],i=n.id;return i===void 0&&e.push({message:`layers.${i}: missing required property "id"`}),n.render===void 0&&e.push({message:`layers.${i}: missing required method "render"`}),n.renderingMode&&n.renderingMode!=="2d"&&n.renderingMode!=="3d"&&e.push({message:`layers.${i}: property "renderingMode" must be either "2d" or "3d"`}),e},o.validateFilter=n=>Fo(_l(n)),o.validateFog=n=>Fo(Cf(n)),o.validateLayer=n=>Fo(Lc(n)),o.validateLight=n=>Fo(Sf(n)),o.validateSource=n=>Fo(Ef(n)),o.validateStyle=vh,o.validateTerrain=n=>Fo(Rc(n)),o.values=tn,o.vectorTile=np,o.version=k,o.warnOnce=re,o.window=S,o.wrap=Ge}),v(["./shared"],function(o){function S(X){if(typeof X=="number"||typeof X=="boolean"||typeof X=="string"||X==null)return JSON.stringify(X);if(Array.isArray(X)){let j="[";for(const Y of X)j+=`${S(Y)},`;return`${j}]`}let N="{";for(const j of Object.keys(X).sort())N+=`${j}:${S(X[j])},`;return`${N}}`}function k(X){let N="";for(const j of o.refProperties)N+=`/${S(X[j])}`;return N}class I{constructor(N){this.keyCache={},N&&this.replace(N)}replace(N){this._layerConfigs={},this._layers={},this.update(N,[])}update(N,j){for(const ue of N)this._layerConfigs[ue.id]=ue,(this._layers[ue.id]=o.createStyleLayer(ue)).compileFilter(),this.keyCache[ue.id]&&delete this.keyCache[ue.id];for(const ue of j)delete this.keyCache[ue],delete this._layerConfigs[ue],delete this._layers[ue];this.familiesBySource={};const Y=function(ue,Te){const Oe={};for(let Ce=0;Ce<ue.length;Ce++){const Ne=Te&&Te[ue[Ce].id]||k(ue[Ce]);Te&&(Te[ue[Ce].id]=Ne);let ht=Oe[Ne];ht||(ht=Oe[Ne]=[]),ht.push(ue[Ce])}const ze=[];for(const Ce in Oe)ze.push(Oe[Ce]);return ze}(o.values(this._layerConfigs),this.keyCache);for(const ue of Y){const Te=ue.map(Ft=>this._layers[Ft.id]),Oe=Te[0];if(Oe.visibility==="none")continue;const ze=Oe.source||"";let Ce=this.familiesBySource[ze];Ce||(Ce=this.familiesBySource[ze]={});const Ne=Oe.sourceLayer||"_geojsonTileLayer";let ht=Ce[Ne];ht||(ht=Ce[Ne]=[]),ht.push(Te)}}}class D{loadTile(N,j){const{uid:Y,encoding:ue,rawImageData:Te,padding:Oe,buildQuadTree:ze}=N,Ce=o.window.ImageBitmap&&Te instanceof o.window.ImageBitmap?this.getImageData(Te,Oe):Te;j(null,new o.DEMData(Y,Ce,ue,Oe<1,ze))}getImageData(N,j){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(N.width,N.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=N.width,this.offscreenCanvas.height=N.height,this.offscreenCanvasContext.drawImage(N,0,0,N.width,N.height);const Y=this.offscreenCanvasContext.getImageData(-j,-j,N.width+2*j,N.height+2*j);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),Y}}var B=function X(N,j){var Y,ue=N&&N.type;if(ue==="FeatureCollection")for(Y=0;Y<N.features.length;Y++)X(N.features[Y],j);else if(ue==="GeometryCollection")for(Y=0;Y<N.geometries.length;Y++)X(N.geometries[Y],j);else if(ue==="Feature")X(N.geometry,j);else if(ue==="Polygon")V(N.coordinates,j);else if(ue==="MultiPolygon")for(Y=0;Y<N.coordinates.length;Y++)V(N.coordinates[Y],j);return N};function V(X,N){if(X.length!==0){$(X[0],N);for(var j=1;j<X.length;j++)$(X[j],!N)}}function $(X,N){for(var j=0,Y=0,ue=0,Te=X.length,Oe=Te-1;ue<Te;Oe=ue++){var ze=(X[ue][0]-X[Oe][0])*(X[Oe][1]+X[ue][1]),Ce=j+ze;Y+=Math.abs(j)>=Math.abs(ze)?j-Ce+ze:ze-Ce+j,j=Ce}j+Y>=0!=!!N&&X.reverse()}const ne=o.VectorTileFeature.prototype.toGeoJSON;class oe{constructor(N){this._feature=N,this.extent=o.EXTENT,this.type=N.type,this.properties=N.tags,"id"in N&&!isNaN(N.id)&&(this.id=parseInt(N.id,10))}loadGeometry(){if(this._feature.type===1){const N=[];for(const j of this._feature.geometry)N.push([new o.pointGeometry(j[0],j[1])]);return N}{const N=[];for(const j of this._feature.geometry){const Y=[];for(const ue of j)Y.push(new o.pointGeometry(ue[0],ue[1]));N.push(Y)}return N}}toGeoJSON(N,j,Y){return ne.call(this,N,j,Y)}}class ye{constructor(N){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=o.EXTENT,this.length=N.length,this._features=N}feature(N){return new oe(this._features[N])}}var te={exports:{}},Se=o.pointGeometry,Ae=o.vectorTile.VectorTileFeature,ce=fe;function fe(X,N){this.options=N||{},this.features=X,this.length=X.length}function Ee(X,N){this.id=typeof X.id=="number"?X.id:void 0,this.type=X.type,this.rawGeometry=X.type===1?[X.geometry]:X.geometry,this.properties=X.tags,this.extent=N||4096}fe.prototype.feature=function(X){return new Ee(this.features[X],this.options.extent)},Ee.prototype.loadGeometry=function(){var X=this.rawGeometry;this.geometry=[];for(var N=0;N<X.length;N++){for(var j=X[N],Y=[],ue=0;ue<j.length;ue++)Y.push(new Se(j[ue][0],j[ue][1]));this.geometry.push(Y)}return this.geometry},Ee.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var X=this.geometry,N=1/0,j=-1/0,Y=1/0,ue=-1/0,Te=0;Te<X.length;Te++)for(var Oe=X[Te],ze=0;ze<Oe.length;ze++){var Ce=Oe[ze];N=Math.min(N,Ce.x),j=Math.max(j,Ce.x),Y=Math.min(Y,Ce.y),ue=Math.max(ue,Ce.y)}return[N,Y,j,ue]},Ee.prototype.toGeoJSON=Ae.prototype.toGeoJSON;var Me=o.pbf,Ie=ce;function ke(X){var N=new Me;return function(j,Y){for(var ue in j.layers)Y.writeMessage(3,Be,j.layers[ue])}(X,N),N.finish()}function Be(X,N){var j;N.writeVarintField(15,X.version||1),N.writeStringField(1,X.name||""),N.writeVarintField(5,X.extent||4096);var Y={keys:[],values:[],keycache:{},valuecache:{}};for(j=0;j<X.length;j++)Y.feature=X.feature(j),N.writeMessage(2,Re,Y);var ue=Y.keys;for(j=0;j<ue.length;j++)N.writeStringField(3,ue[j]);var Te=Y.values;for(j=0;j<Te.length;j++)N.writeMessage(4,Ge,Te[j])}function Re(X,N){var j=X.feature;j.id!==void 0&&N.writeVarintField(1,j.id),N.writeMessage(2,Ze,X),N.writeVarintField(3,j.type),N.writeMessage(4,Xt,j)}function Ze(X,N){var j=X.feature,Y=X.keys,ue=X.values,Te=X.keycache,Oe=X.valuecache;for(var ze in j.properties){var Ce=j.properties[ze],Ne=Te[ze];if(Ce!==null){Ne===void 0&&(Y.push(ze),Te[ze]=Ne=Y.length-1),N.writeVarint(Ne);var ht=typeof Ce;ht!=="string"&&ht!=="boolean"&&ht!=="number"&&(Ce=JSON.stringify(Ce));var Ft=ht+":"+Ce,wt=Oe[Ft];wt===void 0&&(ue.push(Ce),Oe[Ft]=wt=ue.length-1),N.writeVarint(wt)}}}function Ye(X,N){return(N<<3)+(7&X)}function lt(X){return X<<1^X>>31}function Xt(X,N){for(var j=X.loadGeometry(),Y=X.type,ue=0,Te=0,Oe=j.length,ze=0;ze<Oe;ze++){var Ce=j[ze],Ne=1;Y===1&&(Ne=Ce.length),N.writeVarint(Ye(1,Ne));for(var ht=Y===3?Ce.length-1:Ce.length,Ft=0;Ft<ht;Ft++){Ft===1&&Y!==1&&N.writeVarint(Ye(2,ht-1));var wt=Ce[Ft].x-ue,an=Ce[Ft].y-Te;N.writeVarint(lt(wt)),N.writeVarint(lt(an)),ue+=wt,Te+=an}Y===3&&N.writeVarint(Ye(7,1))}}function Ge(X,N){var j=typeof X;j==="string"?N.writeStringField(1,X):j==="boolean"?N.writeBooleanField(7,X):j==="number"&&(X%1!=0?N.writeDoubleField(3,X):X<0?N.writeSVarintField(6,X):N.writeVarintField(5,X))}function At(X,N,j,Y,ue,Te){if(ue-Y<=j)return;const Oe=Y+ue>>1;tn(X,N,Oe,Y,ue,Te%2),At(X,N,j,Y,Oe-1,Te+1),At(X,N,j,Oe+1,ue,Te+1)}function tn(X,N,j,Y,ue,Te){for(;ue>Y;){if(ue-Y>600){const Ne=ue-Y+1,ht=j-Y+1,Ft=Math.log(Ne),wt=.5*Math.exp(2*Ft/3),an=.5*Math.sqrt(Ft*wt*(Ne-wt)/Ne)*(ht-Ne/2<0?-1:1);tn(X,N,j,Math.max(Y,Math.floor(j-ht*wt/Ne+an)),Math.min(ue,Math.floor(j+(Ne-ht)*wt/Ne+an)),Te)}const Oe=N[2*j+Te];let ze=Y,Ce=ue;for(Ve(X,N,Y,j),N[2*ue+Te]>Oe&&Ve(X,N,Y,ue);ze<Ce;){for(Ve(X,N,ze,Ce),ze++,Ce--;N[2*ze+Te]<Oe;)ze++;for(;N[2*Ce+Te]>Oe;)Ce--}N[2*Y+Te]===Oe?Ve(X,N,Y,Ce):(Ce++,Ve(X,N,Ce,ue)),Ce<=j&&(Y=Ce+1),j<=Ce&&(ue=Ce-1)}}function Ve(X,N,j,Y){mt(X,j,Y),mt(N,2*j,2*Y),mt(N,2*j+1,2*Y+1)}function mt(X,N,j){const Y=X[N];X[N]=X[j],X[j]=Y}function Bt(X,N,j,Y){const ue=X-j,Te=N-Y;return ue*ue+Te*Te}te.exports=ke,te.exports.fromVectorTileJs=ke,te.exports.fromGeojsonVt=function(X,N){N=N||{};var j={};for(var Y in X)j[Y]=new Ie(X[Y].features,N),j[Y].name=Y,j[Y].version=N.version,j[Y].extent=N.extent;return ke({layers:j})},te.exports.GeoJSONWrapper=Ie;const qt=X=>X[0],xn=X=>X[1];class rt{constructor(N,j=qt,Y=xn,ue=64,Te=Float64Array){this.nodeSize=ue,this.points=N;const Oe=N.length<65536?Uint16Array:Uint32Array,ze=this.ids=new Oe(N.length),Ce=this.coords=new Te(2*N.length);for(let Ne=0;Ne<N.length;Ne++)ze[Ne]=Ne,Ce[2*Ne]=j(N[Ne]),Ce[2*Ne+1]=Y(N[Ne]);At(ze,Ce,ue,0,ze.length-1,0)}range(N,j,Y,ue){return function(Te,Oe,ze,Ce,Ne,ht,Ft){const wt=[0,Te.length-1,0],an=[];let on,rn;for(;wt.length;){const fn=wt.pop(),me=wt.pop(),Lt=wt.pop();if(me-Lt<=Ft){for(let yn=Lt;yn<=me;yn++)on=Oe[2*yn],rn=Oe[2*yn+1],on>=ze&&on<=Ne&&rn>=Ce&&rn<=ht&&an.push(Te[yn]);continue}const at=Math.floor((Lt+me)/2);on=Oe[2*at],rn=Oe[2*at+1],on>=ze&&on<=Ne&&rn>=Ce&&rn<=ht&&an.push(Te[at]);const Yt=(fn+1)%2;(fn===0?ze<=on:Ce<=rn)&&(wt.push(Lt),wt.push(at-1),wt.push(Yt)),(fn===0?Ne>=on:ht>=rn)&&(wt.push(at+1),wt.push(me),wt.push(Yt))}return an}(this.ids,this.coords,N,j,Y,ue,this.nodeSize)}within(N,j,Y){return function(ue,Te,Oe,ze,Ce,Ne){const ht=[0,ue.length-1,0],Ft=[],wt=Ce*Ce;for(;ht.length;){const an=ht.pop(),on=ht.pop(),rn=ht.pop();if(on-rn<=Ne){for(let Yt=rn;Yt<=on;Yt++)Bt(Te[2*Yt],Te[2*Yt+1],Oe,ze)<=wt&&Ft.push(ue[Yt]);continue}const fn=Math.floor((rn+on)/2),me=Te[2*fn],Lt=Te[2*fn+1];Bt(me,Lt,Oe,ze)<=wt&&Ft.push(ue[fn]);const at=(an+1)%2;(an===0?Oe-Ce<=me:ze-Ce<=Lt)&&(ht.push(rn),ht.push(fn-1),ht.push(at)),(an===0?Oe+Ce>=me:ze+Ce>=Lt)&&(ht.push(fn+1),ht.push(on),ht.push(at))}return Ft}(this.ids,this.coords,N,j,Y,this.nodeSize)}}const gt={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:X=>X},ot=Math.fround||(_t=new Float32Array(1),X=>(_t[0]=+X,_t[0]));var _t;class ft{constructor(N){this.options=zt(Object.create(gt),N),this.trees=new Array(this.options.maxZoom+1)}load(N){const{log:j,minZoom:Y,maxZoom:ue,nodeSize:Te}=this.options;j&&console.time("total time");const Oe=`prepare ${N.length} points`;j&&console.time(Oe),this.points=N;let ze=[];for(let Ce=0;Ce<N.length;Ce++)N[Ce].geometry&&ze.push(un(N[Ce],Ce));this.trees[ue+1]=new rt(ze,Vt,kt,Te,Float32Array),j&&console.timeEnd(Oe);for(let Ce=ue;Ce>=Y;Ce--){const Ne=+Date.now();ze=this._cluster(ze,Ce),this.trees[Ce]=new rt(ze,Vt,kt,Te,Float32Array),j&&console.log("z%d: %d clusters in %dms",Ce,ze.length,+Date.now()-Ne)}return j&&console.timeEnd("total time"),this}getClusters(N,j){let Y=((N[0]+180)%360+360)%360-180;const ue=Math.max(-90,Math.min(90,N[1]));let Te=N[2]===180?180:((N[2]+180)%360+360)%360-180;const Oe=Math.max(-90,Math.min(90,N[3]));if(N[2]-N[0]>=360)Y=-180,Te=180;else if(Y>Te){const ht=this.getClusters([Y,ue,180,Oe],j),Ft=this.getClusters([-180,ue,Te,Oe],j);return ht.concat(Ft)}const ze=this.trees[this._limitZoom(j)],Ce=ze.range(Fe(Y),nt(Oe),Fe(Te),nt(ue)),Ne=[];for(const ht of Ce){const Ft=ze.points[ht];Ne.push(Ft.numPoints?re(Ft):this.points[Ft.index])}return Ne}getChildren(N){const j=this._getOriginId(N),Y=this._getOriginZoom(N),ue="No cluster with the specified id.",Te=this.trees[Y];if(!Te)throw new Error(ue);const Oe=Te.points[j];if(!Oe)throw new Error(ue);const ze=this.options.radius/(this.options.extent*Math.pow(2,Y-1)),Ce=Te.within(Oe.x,Oe.y,ze),Ne=[];for(const ht of Ce){const Ft=Te.points[ht];Ft.parentId===N&&Ne.push(Ft.numPoints?re(Ft):this.points[Ft.index])}if(Ne.length===0)throw new Error(ue);return Ne}getLeaves(N,j,Y){const ue=[];return this._appendLeaves(ue,N,j=j||10,Y=Y||0,0),ue}getTile(N,j,Y){const ue=this.trees[this._limitZoom(N)],Te=Math.pow(2,N),{extent:Oe,radius:ze}=this.options,Ce=ze/Oe,Ne=(Y-Ce)/Te,ht=(Y+1+Ce)/Te,Ft={features:[]};return this._addTileFeatures(ue.range((j-Ce)/Te,Ne,(j+1+Ce)/Te,ht),ue.points,j,Y,Te,Ft),j===0&&this._addTileFeatures(ue.range(1-Ce/Te,Ne,1,ht),ue.points,Te,Y,Te,Ft),j===Te-1&&this._addTileFeatures(ue.range(0,Ne,Ce/Te,ht),ue.points,-1,Y,Te,Ft),Ft.features.length?Ft:null}getClusterExpansionZoom(N){let j=this._getOriginZoom(N)-1;for(;j<=this.options.maxZoom;){const Y=this.getChildren(N);if(j++,Y.length!==1)break;N=Y[0].properties.cluster_id}return j}_appendLeaves(N,j,Y,ue,Te){const Oe=this.getChildren(j);for(const ze of Oe){const Ce=ze.properties;if(Ce&&Ce.cluster?Te+Ce.point_count<=ue?Te+=Ce.point_count:Te=this._appendLeaves(N,Ce.cluster_id,Y,ue,Te):Te<ue?Te++:N.push(ze),N.length===Y)break}return Te}_addTileFeatures(N,j,Y,ue,Te,Oe){for(const ze of N){const Ce=j[ze],Ne=Ce.numPoints;let ht,Ft,wt;if(Ne)ht=xe(Ce),Ft=Ce.x,wt=Ce.y;else{const rn=this.points[Ce.index];ht=rn.properties,Ft=Fe(rn.geometry.coordinates[0]),wt=nt(rn.geometry.coordinates[1])}const an={type:1,geometry:[[Math.round(this.options.extent*(Ft*Te-Y)),Math.round(this.options.extent*(wt*Te-ue))]],tags:ht};let on;Ne?on=Ce.id:this.options.generateId?on=Ce.index:this.points[Ce.index].id&&(on=this.points[Ce.index].id),on!==void 0&&(an.id=on),Oe.features.push(an)}}_limitZoom(N){return Math.max(this.options.minZoom,Math.min(Math.floor(+N),this.options.maxZoom+1))}_cluster(N,j){const Y=[],{radius:ue,extent:Te,reduce:Oe,minPoints:ze}=this.options,Ce=ue/(Te*Math.pow(2,j));for(let Ne=0;Ne<N.length;Ne++){const ht=N[Ne];if(ht.zoom<=j)continue;ht.zoom=j;const Ft=this.trees[j+1],wt=Ft.within(ht.x,ht.y,Ce),an=ht.numPoints||1;let on=an;for(const rn of wt){const fn=Ft.points[rn];fn.zoom>j&&(on+=fn.numPoints||1)}if(on>an&&on>=ze){let rn=ht.x*an,fn=ht.y*an,me=Oe&&an>1?this._map(ht,!0):null;const Lt=(Ne<<5)+(j+1)+this.points.length;for(const at of wt){const Yt=Ft.points[at];if(Yt.zoom<=j)continue;Yt.zoom=j;const yn=Yt.numPoints||1;rn+=Yt.x*yn,fn+=Yt.y*yn,Yt.parentId=Lt,Oe&&(me||(me=this._map(ht,!0)),Oe(me,this._map(Yt)))}ht.parentId=Lt,Y.push(sn(rn/on,fn/on,Lt,on,me))}else if(Y.push(ht),on>1)for(const rn of wt){const fn=Ft.points[rn];fn.zoom<=j||(fn.zoom=j,Y.push(fn))}}return Y}_getOriginId(N){return N-this.points.length>>5}_getOriginZoom(N){return(N-this.points.length)%32}_map(N,j){if(N.numPoints)return j?zt({},N.properties):N.properties;const Y=this.points[N.index].properties,ue=this.options.map(Y);return j&&ue===Y?zt({},ue):ue}}function sn(X,N,j,Y,ue){return{x:ot(X),y:ot(N),zoom:1/0,id:j,parentId:-1,numPoints:Y,properties:ue}}function un(X,N){const[j,Y]=X.geometry.coordinates;return{x:ot(Fe(j)),y:ot(nt(Y)),zoom:1/0,index:N,parentId:-1}}function re(X){return{type:"Feature",id:X.id,properties:xe(X),geometry:{type:"Point",coordinates:[(N=X.x,360*(N-.5)),yt(X.y)]}};var N}function xe(X){const N=X.numPoints,j=N>=1e4?`${Math.round(N/1e3)}k`:N>=1e3?Math.round(N/100)/10+"k":N;return zt(zt({},X.properties),{cluster:!0,cluster_id:X.id,point_count:N,point_count_abbreviated:j})}function Fe(X){return X/360+.5}function nt(X){const N=Math.sin(X*Math.PI/180),j=.5-.25*Math.log((1+N)/(1-N))/Math.PI;return j<0?0:j>1?1:j}function yt(X){const N=(180-360*X)*Math.PI/180;return 360*Math.atan(Math.exp(N))/Math.PI-90}function zt(X,N){for(const j in N)X[j]=N[j];return X}function Vt(X){return X.x}function kt(X){return X.y}function bt(X,N,j,Y){for(var ue,Te=Y,Oe=j-N>>1,ze=j-N,Ce=X[N],Ne=X[N+1],ht=X[j],Ft=X[j+1],wt=N+3;wt<j;wt+=3){var an=Mt(X[wt],X[wt+1],Ce,Ne,ht,Ft);if(an>Te)ue=wt,Te=an;else if(an===Te){var on=Math.abs(wt-Oe);on<ze&&(ue=wt,ze=on)}}Te>Y&&(ue-N>3&&bt(X,N,ue,Y),X[ue+2]=Te,j-ue>3&&bt(X,ue,j,Y))}function Mt(X,N,j,Y,ue,Te){var Oe=ue-j,ze=Te-Y;if(Oe!==0||ze!==0){var Ce=((X-j)*Oe+(N-Y)*ze)/(Oe*Oe+ze*ze);Ce>1?(j=ue,Y=Te):Ce>0&&(j+=Oe*Ce,Y+=ze*Ce)}return(Oe=X-j)*Oe+(ze=N-Y)*ze}function Ht(X,N,j,Y){var ue={id:X===void 0?null:X,type:N,geometry:j,tags:Y,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(Te){var Oe=Te.geometry,ze=Te.type;if(ze==="Point"||ze==="MultiPoint"||ze==="LineString")et(Te,Oe);else if(ze==="Polygon"||ze==="MultiLineString")for(var Ce=0;Ce<Oe.length;Ce++)et(Te,Oe[Ce]);else if(ze==="MultiPolygon")for(Ce=0;Ce<Oe.length;Ce++)for(var Ne=0;Ne<Oe[Ce].length;Ne++)et(Te,Oe[Ce][Ne])}(ue),ue}function et(X,N){for(var j=0;j<N.length;j+=3)X.minX=Math.min(X.minX,N[j]),X.minY=Math.min(X.minY,N[j+1]),X.maxX=Math.max(X.maxX,N[j]),X.maxY=Math.max(X.maxY,N[j+1])}function Rt(X,N,j,Y){if(N.geometry){var ue=N.geometry.coordinates,Te=N.geometry.type,Oe=Math.pow(j.tolerance/((1<<j.maxZoom)*j.extent),2),ze=[],Ce=N.id;if(j.promoteId?Ce=N.properties[j.promoteId]:j.generateId&&(Ce=Y||0),Te==="Point")nn(ue,ze);else if(Te==="MultiPoint")for(var Ne=0;Ne<ue.length;Ne++)nn(ue[Ne],ze);else if(Te==="LineString")bn(ue,ze,Oe,!1);else if(Te==="MultiLineString"){if(j.lineMetrics){for(Ne=0;Ne<ue.length;Ne++)bn(ue[Ne],ze=[],Oe,!1),X.push(Ht(Ce,"LineString",ze,N.properties));return}zn(ue,ze,Oe,!1)}else if(Te==="Polygon")zn(ue,ze,Oe,!0);else{if(Te!=="MultiPolygon"){if(Te==="GeometryCollection"){for(Ne=0;Ne<N.geometry.geometries.length;Ne++)Rt(X,{id:Ce,geometry:N.geometry.geometries[Ne],properties:N.properties},j,Y);return}throw new Error("Input data is not a valid GeoJSON object.")}for(Ne=0;Ne<ue.length;Ne++){var ht=[];zn(ue[Ne],ht,Oe,!0),ze.push(ht)}}X.push(Ht(Ce,Te,ze,N.properties))}}function nn(X,N){N.push(Cn(X[0])),N.push(jn(X[1])),N.push(0)}function bn(X,N,j,Y){for(var ue,Te,Oe=0,ze=0;ze<X.length;ze++){var Ce=Cn(X[ze][0]),Ne=jn(X[ze][1]);N.push(Ce),N.push(Ne),N.push(0),ze>0&&(Oe+=Y?(ue*Ne-Ce*Te)/2:Math.sqrt(Math.pow(Ce-ue,2)+Math.pow(Ne-Te,2))),ue=Ce,Te=Ne}var ht=N.length-3;N[2]=1,bt(N,0,ht,j),N[ht+2]=1,N.size=Math.abs(Oe),N.start=0,N.end=N.size}function zn(X,N,j,Y){for(var ue=0;ue<X.length;ue++){var Te=[];bn(X[ue],Te,j,Y),N.push(Te)}}function Cn(X){return X/360+.5}function jn(X){var N=Math.sin(X*Math.PI/180),j=.5-.25*Math.log((1+N)/(1-N))/Math.PI;return j<0?0:j>1?1:j}function Wn(X,N,j,Y,ue,Te,Oe,ze){if(Y/=N,Te>=(j/=N)&&Oe<Y)return X;if(Oe<j||Te>=Y)return null;for(var Ce=[],Ne=0;Ne<X.length;Ne++){var ht=X[Ne],Ft=ht.geometry,wt=ht.type,an=ue===0?ht.minX:ht.minY,on=ue===0?ht.maxX:ht.maxY;if(an>=j&&on<Y)Ce.push(ht);else if(!(on<j||an>=Y)){var rn=[];if(wt==="Point"||wt==="MultiPoint")Bi(Ft,rn,j,Y,ue);else if(wt==="LineString")qi(Ft,rn,j,Y,ue,!1,ze.lineMetrics);else if(wt==="MultiLineString")tr(Ft,rn,j,Y,ue,!1);else if(wt==="Polygon")tr(Ft,rn,j,Y,ue,!0);else if(wt==="MultiPolygon")for(var fn=0;fn<Ft.length;fn++){var me=[];tr(Ft[fn],me,j,Y,ue,!0),me.length&&rn.push(me)}if(rn.length){if(ze.lineMetrics&&wt==="LineString"){for(fn=0;fn<rn.length;fn++)Ce.push(Ht(ht.id,wt,rn[fn],ht.tags));continue}wt!=="LineString"&&wt!=="MultiLineString"||(rn.length===1?(wt="LineString",rn=rn[0]):wt="MultiLineString"),wt!=="Point"&&wt!=="MultiPoint"||(wt=rn.length===3?"Point":"MultiPoint"),Ce.push(Ht(ht.id,wt,rn,ht.tags))}}}return Ce.length?Ce:null}function Bi(X,N,j,Y,ue){for(var Te=0;Te<X.length;Te+=3){var Oe=X[Te+ue];Oe>=j&&Oe<=Y&&(N.push(X[Te]),N.push(X[Te+1]),N.push(X[Te+2]))}}function qi(X,N,j,Y,ue,Te,Oe){for(var ze,Ce,Ne=ji(X),ht=ue===0?$i:hr,Ft=X.start,wt=0;wt<X.length-3;wt+=3){var an=X[wt],on=X[wt+1],rn=X[wt+2],fn=X[wt+3],me=X[wt+4],Lt=ue===0?an:on,at=ue===0?fn:me,Yt=!1;Oe&&(ze=Math.sqrt(Math.pow(an-fn,2)+Math.pow(on-me,2))),Lt<j?at>j&&(Ce=ht(Ne,an,on,fn,me,j),Oe&&(Ne.start=Ft+ze*Ce)):Lt>Y?at<Y&&(Ce=ht(Ne,an,on,fn,me,Y),Oe&&(Ne.start=Ft+ze*Ce)):Ei(Ne,an,on,rn),at<j&&Lt>=j&&(Ce=ht(Ne,an,on,fn,me,j),Yt=!0),at>Y&&Lt<=Y&&(Ce=ht(Ne,an,on,fn,me,Y),Yt=!0),!Te&&Yt&&(Oe&&(Ne.end=Ft+ze*Ce),N.push(Ne),Ne=ji(X)),Oe&&(Ft+=ze)}var yn=X.length-3;an=X[yn],on=X[yn+1],rn=X[yn+2],(Lt=ue===0?an:on)>=j&&Lt<=Y&&Ei(Ne,an,on,rn),yn=Ne.length-3,Te&&yn>=3&&(Ne[yn]!==Ne[0]||Ne[yn+1]!==Ne[1])&&Ei(Ne,Ne[0],Ne[1],Ne[2]),Ne.length&&N.push(Ne)}function ji(X){var N=[];return N.size=X.size,N.start=X.start,N.end=X.end,N}function tr(X,N,j,Y,ue,Te){for(var Oe=0;Oe<X.length;Oe++)qi(X[Oe],N,j,Y,ue,Te,!1)}function Ei(X,N,j,Y){X.push(N),X.push(j),X.push(Y)}function $i(X,N,j,Y,ue,Te){var Oe=(Te-N)/(Y-N);return X.push(Te),X.push(j+(ue-j)*Oe),X.push(1),Oe}function hr(X,N,j,Y,ue,Te){var Oe=(Te-j)/(ue-j);return X.push(N+(Y-N)*Oe),X.push(Te),X.push(1),Oe}function Ar(X,N){for(var j=[],Y=0;Y<X.length;Y++){var ue,Te=X[Y],Oe=Te.type;if(Oe==="Point"||Oe==="MultiPoint"||Oe==="LineString")ue=Mr(Te.geometry,N);else if(Oe==="MultiLineString"||Oe==="Polygon"){ue=[];for(var ze=0;ze<Te.geometry.length;ze++)ue.push(Mr(Te.geometry[ze],N))}else if(Oe==="MultiPolygon")for(ue=[],ze=0;ze<Te.geometry.length;ze++){for(var Ce=[],Ne=0;Ne<Te.geometry[ze].length;Ne++)Ce.push(Mr(Te.geometry[ze][Ne],N));ue.push(Ce)}j.push(Ht(Te.id,Oe,ue,Te.tags))}return j}function Mr(X,N){var j=[];j.size=X.size,X.start!==void 0&&(j.start=X.start,j.end=X.end);for(var Y=0;Y<X.length;Y+=3)j.push(X[Y]+N,X[Y+1],X[Y+2]);return j}function fo(X,N){if(X.transformed)return X;var j,Y,ue,Te=1<<X.z,Oe=X.x,ze=X.y;for(j=0;j<X.features.length;j++){var Ce=X.features[j],Ne=Ce.geometry,ht=Ce.type;if(Ce.geometry=[],ht===1)for(Y=0;Y<Ne.length;Y+=2)Ce.geometry.push(xr(Ne[Y],Ne[Y+1],N,Te,Oe,ze));else for(Y=0;Y<Ne.length;Y++){var Ft=[];for(ue=0;ue<Ne[Y].length;ue+=2)Ft.push(xr(Ne[Y][ue],Ne[Y][ue+1],N,Te,Oe,ze));Ce.geometry.push(Ft)}}return X.transformed=!0,X}function xr(X,N,j,Y,ue,Te){return[Math.round(j*(X*Y-ue)),Math.round(j*(N*Y-Te))]}function oo(X,N,j,Y,ue){for(var Te=N===ue.maxZoom?0:ue.tolerance/((1<<N)*ue.extent),Oe={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:j,y:Y,z:N,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},ze=0;ze<X.length;ze++){Oe.numFeatures++,Jo(Oe,X[ze],Te,ue);var Ce=X[ze].minX,Ne=X[ze].minY,ht=X[ze].maxX,Ft=X[ze].maxY;Ce<Oe.minX&&(Oe.minX=Ce),Ne<Oe.minY&&(Oe.minY=Ne),ht>Oe.maxX&&(Oe.maxX=ht),Ft>Oe.maxY&&(Oe.maxY=Ft)}return Oe}function Jo(X,N,j,Y){var ue=N.geometry,Te=N.type,Oe=[];if(Te==="Point"||Te==="MultiPoint")for(var ze=0;ze<ue.length;ze+=3)Oe.push(ue[ze]),Oe.push(ue[ze+1]),X.numPoints++,X.numSimplified++;else if(Te==="LineString")so(Oe,ue,X,j,!1,!1);else if(Te==="MultiLineString"||Te==="Polygon")for(ze=0;ze<ue.length;ze++)so(Oe,ue[ze],X,j,Te==="Polygon",ze===0);else if(Te==="MultiPolygon")for(var Ce=0;Ce<ue.length;Ce++){var Ne=ue[Ce];for(ze=0;ze<Ne.length;ze++)so(Oe,Ne[ze],X,j,!0,ze===0)}if(Oe.length){var ht=N.tags||null;if(Te==="LineString"&&Y.lineMetrics){for(var Ft in ht={},N.tags)ht[Ft]=N.tags[Ft];ht.mapbox_clip_start=ue.start/ue.size,ht.mapbox_clip_end=ue.end/ue.size}var wt={geometry:Oe,type:Te==="Polygon"||Te==="MultiPolygon"?3:Te==="LineString"||Te==="MultiLineString"?2:1,tags:ht};N.id!==null&&(wt.id=N.id),X.features.push(wt)}}function so(X,N,j,Y,ue,Te){var Oe=Y*Y;if(Y>0&&N.size<(ue?Oe:Y))j.numPoints+=N.length/3;else{for(var ze=[],Ce=0;Ce<N.length;Ce+=3)(Y===0||N[Ce+2]>Oe)&&(j.numSimplified++,ze.push(N[Ce]),ze.push(N[Ce+1])),j.numPoints++;ue&&function(Ne,ht){for(var Ft=0,wt=0,an=Ne.length,on=an-2;wt<an;on=wt,wt+=2)Ft+=(Ne[wt]-Ne[on])*(Ne[wt+1]+Ne[on+1]);if(Ft>0===ht)for(wt=0,an=Ne.length;wt<an/2;wt+=2){var rn=Ne[wt],fn=Ne[wt+1];Ne[wt]=Ne[an-2-wt],Ne[wt+1]=Ne[an-1-wt],Ne[an-2-wt]=rn,Ne[an-1-wt]=fn}}(ze,Te),X.push(ze)}}function ct(X,N){var j=(N=this.options=function(ue,Te){for(var Oe in Te)ue[Oe]=Te[Oe];return ue}(Object.create(this.options),N)).debug;if(j&&console.time("preprocess data"),N.maxZoom<0||N.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(N.promoteId&&N.generateId)throw new Error("promoteId and generateId cannot be used together.");var Y=function(ue,Te){var Oe=[];if(ue.type==="FeatureCollection")for(var ze=0;ze<ue.features.length;ze++)Rt(Oe,ue.features[ze],Te,ze);else Rt(Oe,ue.type==="Feature"?ue:{geometry:ue},Te);return Oe}(X,N);this.tiles={},this.tileCoords=[],j&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",N.indexMaxZoom,N.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),Y=function(ue,Te){var Oe=Te.buffer/Te.extent,ze=ue,Ce=Wn(ue,1,-1-Oe,Oe,0,-1,2,Te),Ne=Wn(ue,1,1-Oe,2+Oe,0,-1,2,Te);return(Ce||Ne)&&(ze=Wn(ue,1,-Oe,1+Oe,0,-1,2,Te)||[],Ce&&(ze=Ar(Ce,1).concat(ze)),Ne&&(ze=ze.concat(Ar(Ne,-1)))),ze}(Y,N),Y.length&&this.splitTile(Y,0,0,0),j&&(Y.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Kt(X,N,j){return 32*((1<<X)*j+N)+X}function hn(X,N){const j=X.tileID.canonical;if(!this._geoJSONIndex)return N(null,null);const Y=this._geoJSONIndex.getTile(j.z,j.x,j.y);if(!Y)return N(null,null);const ue=new ye(Y.features);let Te=te.exports(ue);Te.byteOffset===0&&Te.byteLength===Te.buffer.byteLength||(Te=new Uint8Array(Te)),N(null,{vectorTile:ue,rawData:Te.buffer})}ct.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},ct.prototype.splitTile=function(X,N,j,Y,ue,Te,Oe){for(var ze=[X,N,j,Y],Ce=this.options,Ne=Ce.debug;ze.length;){Y=ze.pop(),j=ze.pop(),N=ze.pop(),X=ze.pop();var ht=1<<N,Ft=Kt(N,j,Y),wt=this.tiles[Ft];if(!wt&&(Ne>1&&console.time("creation"),wt=this.tiles[Ft]=oo(X,N,j,Y,Ce),this.tileCoords.push({z:N,x:j,y:Y}),Ne)){Ne>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",N,j,Y,wt.numFeatures,wt.numPoints,wt.numSimplified),console.timeEnd("creation"));var an="z"+N;this.stats[an]=(this.stats[an]||0)+1,this.total++}if(wt.source=X,ue){if(N===Ce.maxZoom||N===ue)continue;var on=1<<ue-N;if(j!==Math.floor(Te/on)||Y!==Math.floor(Oe/on))continue}else if(N===Ce.indexMaxZoom||wt.numPoints<=Ce.indexMaxPoints)continue;if(wt.source=null,X.length!==0){Ne>1&&console.time("clipping");var rn,fn,me,Lt,at,Yt,yn=.5*Ce.buffer/Ce.extent,Bn=.5-yn,ai=.5+yn,mi=1+yn;rn=fn=me=Lt=null,at=Wn(X,ht,j-yn,j+ai,0,wt.minX,wt.maxX,Ce),Yt=Wn(X,ht,j+Bn,j+mi,0,wt.minX,wt.maxX,Ce),X=null,at&&(rn=Wn(at,ht,Y-yn,Y+ai,1,wt.minY,wt.maxY,Ce),fn=Wn(at,ht,Y+Bn,Y+mi,1,wt.minY,wt.maxY,Ce),at=null),Yt&&(me=Wn(Yt,ht,Y-yn,Y+ai,1,wt.minY,wt.maxY,Ce),Lt=Wn(Yt,ht,Y+Bn,Y+mi,1,wt.minY,wt.maxY,Ce),Yt=null),Ne>1&&console.timeEnd("clipping"),ze.push(rn||[],N+1,2*j,2*Y),ze.push(fn||[],N+1,2*j,2*Y+1),ze.push(me||[],N+1,2*j+1,2*Y),ze.push(Lt||[],N+1,2*j+1,2*Y+1)}}},ct.prototype.getTile=function(X,N,j){var Y=this.options,ue=Y.extent,Te=Y.debug;if(X<0||X>24)return null;var Oe=1<<X,ze=Kt(X,N=(N%Oe+Oe)%Oe,j);if(this.tiles[ze])return fo(this.tiles[ze],ue);Te>1&&console.log("drilling down to z%d-%d-%d",X,N,j);for(var Ce,Ne=X,ht=N,Ft=j;!Ce&&Ne>0;)Ne--,ht=Math.floor(ht/2),Ft=Math.floor(Ft/2),Ce=this.tiles[Kt(Ne,ht,Ft)];return Ce&&Ce.source?(Te>1&&console.log("found parent tile z%d-%d-%d",Ne,ht,Ft),Te>1&&console.time("drilling down"),this.splitTile(Ce.source,Ne,ht,Ft,X,N,j),Te>1&&console.timeEnd("drilling down"),this.tiles[ze]?fo(this.tiles[ze],ue):null):null};class En extends o.VectorTileWorkerSource{constructor(N,j,Y,ue,Te){super(N,j,Y,ue,hn),Te&&(this.loadGeoJSON=Te)}loadData(N,j){const Y=N&&N.request,ue=Y&&Y.collectResourceTiming;this.loadGeoJSON(N,(Te,Oe)=>{if(Te||!Oe)return j(Te);if(typeof Oe!="object")return j(new Error(`Input data given to '${N.source}' is not a valid GeoJSON object.`));{B(Oe,!0);try{if(N.filter){const Ce=o.createExpression(N.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Ce.result==="error")throw new Error(Ce.value.map(ht=>`${ht.key}: ${ht.message}`).join(", "));Oe={type:"FeatureCollection",features:Oe.features.filter(ht=>Ce.value.evaluate({zoom:0},ht))}}this._geoJSONIndex=N.cluster?new ft(function({superclusterOptions:Ce,clusterProperties:Ne}){if(!Ne||!Ce)return Ce;const ht={},Ft={},wt={accumulated:null,zoom:0},an={properties:null},on=Object.keys(Ne);for(const rn of on){const[fn,me]=Ne[rn],Lt=o.createExpression(me),at=o.createExpression(typeof fn=="string"?[fn,["accumulated"],["get",rn]]:fn);ht[rn]=Lt.value,Ft[rn]=at.value}return Ce.map=rn=>{an.properties=rn;const fn={};for(const me of on)fn[me]=ht[me].evaluate(wt,an);return fn},Ce.reduce=(rn,fn)=>{an.properties=fn;for(const me of on)wt.accumulated=rn[me],rn[me]=Ft[me].evaluate(wt,an)},Ce}(N)).load(Oe.features):function(Ce,Ne){return new ct(Ce,Ne)}(Oe,N.geojsonVtOptions)}catch(Ce){return j(Ce)}this.loaded={};const ze={};if(ue){const Ce=o.getPerformanceMeasurement(Y);Ce&&(ze.resourceTiming={},ze.resourceTiming[N.source]=JSON.parse(JSON.stringify(Ce)))}j(null,ze)}})}reloadTile(N,j){const Y=this.loaded;return Y&&Y[N.uid]?super.reloadTile(N,j):this.loadTile(N,j)}loadGeoJSON(N,j){if(N.request)o.getJSON(N.request,j);else{if(typeof N.data!="string")return j(new Error(`Input data given to '${N.source}' is not a valid GeoJSON object.`));try{return j(null,JSON.parse(N.data))}catch{return j(new Error(`Input data given to '${N.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(N,j){try{j(null,this._geoJSONIndex.getClusterExpansionZoom(N.clusterId))}catch(Y){j(Y)}}getClusterChildren(N,j){try{j(null,this._geoJSONIndex.getChildren(N.clusterId))}catch(Y){j(Y)}}getClusterLeaves(N,j){try{j(null,this._geoJSONIndex.getLeaves(N.clusterId,N.limit,N.offset))}catch(Y){j(Y)}}}class In{constructor(N){this.self=N,this.actor=new o.Actor(N,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=o.getProjection({name:"mercator"}),this.workerSourceTypes={vector:o.VectorTileWorkerSource,geojson:En},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(j,Y)=>{if(this.workerSourceTypes[j])throw new Error(`Worker source with name "${j}" already registered.`);this.workerSourceTypes[j]=Y},this.self.registerRTLTextPlugin=j=>{if(o.plugin.isParsed())throw new Error("RTL text plugin already registered.");o.plugin.applyArabicShaping=j.applyArabicShaping,o.plugin.processBidirectionalText=j.processBidirectionalText,o.plugin.processStyledBidirectionalText=j.processStyledBidirectionalText}}clearCaches(N,j,Y){delete this.layerIndexes[N],delete this.availableImages[N],delete this.workerSources[N],delete this.demWorkerSources[N],Y()}checkIfReady(N,j,Y){Y()}setReferrer(N,j){this.referrer=j}spriteLoaded(N,j){this.isSpriteLoaded[N]=j;for(const Y in this.workerSources[N]){const ue=this.workerSources[N][Y];for(const Te in ue)ue[Te]instanceof o.VectorTileWorkerSource&&(ue[Te].isSpriteLoaded=j,ue[Te].fire(new o.Event("isSpriteLoaded")))}}setImages(N,j,Y){this.availableImages[N]=j;for(const ue in this.workerSources[N]){const Te=this.workerSources[N][ue];for(const Oe in Te)Te[Oe].availableImages=j}Y()}enableTerrain(N,j,Y){this.terrain=j,Y()}setProjection(N,j){this.projections[N]=o.getProjection(j)}setLayers(N,j,Y){this.getLayerIndex(N).replace(j),Y()}updateLayers(N,j,Y){this.getLayerIndex(N).update(j.layers,j.removedIds),Y()}loadTile(N,j,Y){const ue=this.enableTerrain?o.extend({enableTerrain:this.terrain},j):j;ue.projection=this.projections[N]||this.defaultProjection,this.getWorkerSource(N,j.type,j.source).loadTile(ue,Y)}loadDEMTile(N,j,Y){const ue=this.enableTerrain?o.extend({buildQuadTree:this.terrain},j):j;this.getDEMWorkerSource(N,j.source).loadTile(ue,Y)}reloadTile(N,j,Y){const ue=this.enableTerrain?o.extend({enableTerrain:this.terrain},j):j;ue.projection=this.projections[N]||this.defaultProjection,this.getWorkerSource(N,j.type,j.source).reloadTile(ue,Y)}abortTile(N,j,Y){this.getWorkerSource(N,j.type,j.source).abortTile(j,Y)}removeTile(N,j,Y){this.getWorkerSource(N,j.type,j.source).removeTile(j,Y)}removeSource(N,j,Y){if(!this.workerSources[N]||!this.workerSources[N][j.type]||!this.workerSources[N][j.type][j.source])return;const ue=this.workerSources[N][j.type][j.source];delete this.workerSources[N][j.type][j.source],ue.removeSource!==void 0?ue.removeSource(j,Y):Y()}loadWorkerSource(N,j,Y){try{this.self.importScripts(j.url),Y()}catch(ue){Y(ue.toString())}}syncRTLPluginState(N,j,Y){try{o.plugin.setState(j);const ue=o.plugin.getPluginURL();if(o.plugin.isLoaded()&&!o.plugin.isParsed()&&ue!=null){this.self.importScripts(ue);const Te=o.plugin.isParsed();Y(Te?void 0:new Error(`RTL Text Plugin failed to import scripts from ${ue}`),Te)}}catch(ue){Y(ue.toString())}}getAvailableImages(N){let j=this.availableImages[N];return j||(j=[]),j}getLayerIndex(N){let j=this.layerIndexes[N];return j||(j=this.layerIndexes[N]=new I),j}getWorkerSource(N,j,Y){if(this.workerSources[N]||(this.workerSources[N]={}),this.workerSources[N][j]||(this.workerSources[N][j]={}),!this.workerSources[N][j][Y]){const ue={send:(Te,Oe,ze,Ce,Ne,ht)=>{this.actor.send(Te,Oe,ze,N,Ne,ht)},scheduler:this.actor.scheduler};this.workerSources[N][j][Y]=new this.workerSourceTypes[j](ue,this.getLayerIndex(N),this.getAvailableImages(N),this.isSpriteLoaded[N])}return this.workerSources[N][j][Y]}getDEMWorkerSource(N,j){return this.demWorkerSources[N]||(this.demWorkerSources[N]={}),this.demWorkerSources[N][j]||(this.demWorkerSources[N][j]=new D),this.demWorkerSources[N][j]}enforceCacheSizeLimit(N,j){o.enforceCacheSizeLimit(j)}getWorkerPerformanceMetrics(N,j,Y){Y(void 0,void 0)}}return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new In(self)),In}),v(["./shared"],function(o){function S(h,r){if(Array.isArray(h)){if(!Array.isArray(r)||h.length!==r.length)return!1;for(let l=0;l<h.length;l++)if(!S(h[l],r[l]))return!1;return!0}if(typeof h=="object"&&h!==null&&r!==null){if(typeof r!="object"||Object.keys(h).length!==Object.keys(r).length)return!1;for(const l in h)if(!S(h[l],r[l]))return!1;return!0}return h===r}var k=I;function I(h){return!function(r){return typeof window>"u"||typeof document>"u"?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var p,_,x=new Blob([""],{type:"text/javascript"}),T=URL.createObjectURL(x);try{_=new Worker(T),p=!0}catch{p=!1}return _&&_.terminate(),URL.revokeObjectURL(T),p}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var p=document.createElement("canvas");p.width=p.height=1;var _=p.getContext("2d");if(!_)return!1;var x=_.getImageData(0,0,1,1);return x&&x.width===p.width}()?(D[l=r&&r.failIfMajorPerformanceCaveat]===void 0&&(D[l]=function(p){var _,x=function(T){var C=document.createElement("canvas"),M=Object.create(I.webGLContextAttributes);return M.failIfMajorPerformanceCaveat=T,C.getContext("webgl",M)||C.getContext("experimental-webgl",M)}(p);if(!x)return!1;try{_=x.createShader(x.VERTEX_SHADER)}catch{return!1}return!(!_||x.isContextLost())&&(x.shaderSource(_,"void main() {}"),x.compileShader(_),x.getShaderParameter(_,x.COMPILE_STATUS)===!0)}(l)),D[l]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var l}(h)}var D={};function B(h,r,l){const p=o.window.document.createElement(h);return r!==void 0&&(p.className=r),l&&l.appendChild(p),p}function V(h,r,l){const p=o.window.document.createElementNS("http://www.w3.org/2000/svg",h);for(const _ of Object.keys(r))p.setAttributeNS(null,_,r[_]);return l&&l.appendChild(p),p}I.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const $=o.window.document&&o.window.document.documentElement.style,ne=$&&$.userSelect!==void 0?"userSelect":"WebkitUserSelect";let oe;function ye(){$&&ne&&(oe=$[ne],$[ne]="none")}function te(){$&&ne&&($[ne]=oe)}function Se(h){h.preventDefault(),h.stopPropagation(),o.window.removeEventListener("click",Se,!0)}function Ae(){o.window.addEventListener("click",Se,!0),o.window.setTimeout(()=>{o.window.removeEventListener("click",Se,!0)},0)}function ce(h,r){const l=h.getBoundingClientRect();return Me(h,l,r)}function fe(h,r){const l=h.getBoundingClientRect(),p=[];for(let _=0;_<r.length;_++)p.push(Me(h,l,r[_]));return p}function Ee(h){return o.window.InstallTrigger!==void 0&&h.button===2&&h.ctrlKey&&o.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:h.button}function Me(h,r,l){const p=h.offsetWidth===r.width?1:h.offsetWidth/r.width;return new o.pointGeometry((l.clientX-r.left)*p,(l.clientY-r.top)*p)}function Ie(h,r){var l=r[0],p=r[1],_=r[2],x=r[3],T=l*x-_*p;return T?(h[0]=x*(T=1/T),h[1]=-p*T,h[2]=-_*T,h[3]=l*T,h):null}function ke(h){const{userImage:r}=h;return!!(r&&r.render&&r.render())&&(h.data.replace(new Uint8Array(r.data.buffer)),!0)}class Be extends o.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new o.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(r){if(this.loaded!==r&&(this.loaded=r,r)){for(const{ids:l,callback:p}of this.requestors)this._notify(l,p);this.requestors=[]}}hasImage(r){return!!this.getImage(r)}getImage(r){return this.images[r]}addImage(r,l){this._validate(r,l)&&(this.images[r]=l)}_validate(r,l){let p=!0;return this._validateStretch(l.stretchX,l.data&&l.data.width)||(this.fire(new o.ErrorEvent(new Error(`Image "${r}" has invalid "stretchX" value`))),p=!1),this._validateStretch(l.stretchY,l.data&&l.data.height)||(this.fire(new o.ErrorEvent(new Error(`Image "${r}" has invalid "stretchY" value`))),p=!1),this._validateContent(l.content,l)||(this.fire(new o.ErrorEvent(new Error(`Image "${r}" has invalid "content" value`))),p=!1),p}_validateStretch(r,l){if(!r)return!0;let p=0;for(const _ of r){if(_[0]<p||_[1]<_[0]||l<_[1])return!1;p=_[1]}return!0}_validateContent(r,l){return!(r&&(r.length!==4||r[0]<0||l.data.width<r[0]||r[1]<0||l.data.height<r[1]||r[2]<0||l.data.width<r[2]||r[3]<0||l.data.height<r[3]||r[2]<r[0]||r[3]<r[1]))}updateImage(r,l){l.version=this.images[r].version+1,this.images[r]=l,this.updatedImages[r]=!0}removeImage(r){const l=this.images[r];delete this.images[r],delete this.patterns[r],l.userImage&&l.userImage.onRemove&&l.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(r,l){let p=!0;if(!this.isLoaded())for(const _ of r)this.images[_]||(p=!1);this.isLoaded()||p?this._notify(r,l):this.requestors.push({ids:r,callback:l})}_notify(r,l){const p={};for(const _ of r){this.images[_]||this.fire(new o.Event("styleimagemissing",{id:_}));const x=this.images[_];x?p[_]={data:x.data.clone(),pixelRatio:x.pixelRatio,sdf:x.sdf,version:x.version,stretchX:x.stretchX,stretchY:x.stretchY,content:x.content,hasRenderCallback:Boolean(x.userImage&&x.userImage.render)}:o.warnOnce(`Image "${_}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}l(null,p)}getPixelSize(){const{width:r,height:l}=this.atlasImage;return{width:r,height:l}}getPattern(r){const l=this.patterns[r],p=this.getImage(r);if(!p)return null;if(l&&l.position.version===p.version)return l.position;if(l)l.position.version=p.version;else{const _={w:p.data.width+2,h:p.data.height+2,x:0,y:0},x=new o.ImagePosition(_,p);this.patterns[r]={bin:_,position:x}}return this._updatePatternAtlas(),this.patterns[r].position}bind(r){const l=r.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new o.Texture(r,this.atlasImage,l.RGBA),this.atlasTexture.bind(l.LINEAR,l.CLAMP_TO_EDGE)}_updatePatternAtlas(){const r=[];for(const x in this.patterns)r.push(this.patterns[x].bin);const{w:l,h:p}=o.potpack(r),_=this.atlasImage;_.resize({width:l||1,height:p||1});for(const x in this.patterns){const{bin:T}=this.patterns[x],C=T.x+1,M=T.y+1,R=this.images[x].data,L=R.width,U=R.height;o.RGBAImage.copy(R,_,{x:0,y:0},{x:C,y:M},{width:L,height:U}),o.RGBAImage.copy(R,_,{x:0,y:U-1},{x:C,y:M-1},{width:L,height:1}),o.RGBAImage.copy(R,_,{x:0,y:0},{x:C,y:M+U},{width:L,height:1}),o.RGBAImage.copy(R,_,{x:L-1,y:0},{x:C-1,y:M},{width:1,height:U}),o.RGBAImage.copy(R,_,{x:0,y:0},{x:C+L,y:M},{width:1,height:U})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(r){for(const l of r){if(this.callbackDispatchedThisFrame[l])continue;this.callbackDispatchedThisFrame[l]=!0;const p=this.images[l];ke(p)&&this.updateImage(l,p)}}}const Re=new o.Properties({anchor:new o.DataConstantProperty(o.spec.light.anchor),position:new class{constructor(){this.specification=o.spec.light.position}possiblyEvaluate(h,r){return function([l,p,_]){const x=o.degToRad(p+90),T=o.degToRad(_);return{x:l*Math.cos(x)*Math.sin(T),y:l*Math.sin(x)*Math.sin(T),z:l*Math.cos(T),azimuthal:p,polar:_}}(h.expression.evaluate(r))}interpolate(h,r,l){return{x:o.number(h.x,r.x,l),y:o.number(h.y,r.y,l),z:o.number(h.z,r.z,l),azimuthal:o.number(h.azimuthal,r.azimuthal,l),polar:o.number(h.polar,r.polar,l)}}},color:new o.DataConstantProperty(o.spec.light.color),intensity:new o.DataConstantProperty(o.spec.light.intensity)}),Ze="-transition";class Ye extends o.Evented{constructor(r){super(),this._transitionable=new o.Transitionable(Re),this.setLight(r),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(r,l={}){if(!this._validate(o.validateLight,r,l))for(const p in r){const _=r[p];o.endsWith(p,Ze)?this._transitionable.setTransition(p.slice(0,-Ze.length),_):this._transitionable.setValue(p,_)}}updateTransitions(r){this._transitioning=this._transitionable.transitioned(r,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(r){this.properties=this._transitioning.possiblyEvaluate(r)}_validate(r,l,p){return(!p||p.validate!==!1)&&o.emitValidationErrors(this,r.call(o.validateStyle,o.extend({value:l,style:{glyphs:!0,sprite:!0},styleSpec:o.spec})))}}const lt=new o.Properties({source:new o.DataConstantProperty(o.spec.terrain.source),exaggeration:new o.DataConstantProperty(o.spec.terrain.exaggeration)}),Xt="-transition";class Ge extends o.Evented{constructor(r,l){super(),this._transitionable=new o.Transitionable(lt),this.set(r),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=l}get(){return this._transitionable.serialize()}set(r){for(const l in r){const p=r[l];o.endsWith(l,Xt)?this._transitionable.setTransition(l.slice(0,-Xt.length),p):this._transitionable.setValue(l,p)}}updateTransitions(r){this._transitioning=this._transitionable.transitioned(r,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(r){this.properties=this._transitioning.possiblyEvaluate(r)}}function At(h,r,l,p){const _=o.smoothstep(45,65,l),[x,T]=tn(h,p),C=o.length(r);let M=1-Math.min(1,Math.exp((C-x)/(T-x)*-6));return M*=M*M,M=Math.min(1,1.00747*M),M*_*h.alpha}function tn(h,r){const l=.5/Math.tan(.5*r);return[h.range[0]+l,h.range[1]+l]}const Ve=new o.Properties({range:new o.DataConstantProperty(o.spec.fog.range),color:new o.DataConstantProperty(o.spec.fog.color),"high-color":new o.DataConstantProperty(o.spec.fog["high-color"]),"space-color":new o.DataConstantProperty(o.spec.fog["space-color"]),"horizon-blend":new o.DataConstantProperty(o.spec.fog["horizon-blend"]),"star-intensity":new o.DataConstantProperty(o.spec.fog["star-intensity"])}),mt="-transition";class Bt extends o.Evented{constructor(r,l){super(),this._transitionable=new o.Transitionable(Ve),this.set(r),this._transitioning=this._transitionable.untransitioned(),this._transform=l}get state(){const r=this._transform,l=r.projection.name==="globe",p=o.globeToMercatorTransition(r.zoom),_=this.properties.get("range"),x=[.5,3];return{range:l?[o.number(x[0],_[0],p),o.number(x[1],_[1],p)]:_,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(r,l={}){if(!this._validate(o.validateFog,r,l)){for(const p of Object.keys(o.spec.fog))r&&r[p]===void 0&&(r[p]=o.spec.fog[p].default);for(const p in r){const _=r[p];o.endsWith(p,mt)?this._transitionable.setTransition(p.slice(0,-mt.length),_):this._transitionable.setValue(p,_)}}}getOpacity(r){if(!this._transform.projection.supportsFog)return 0;const l=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:o.smoothstep(45,65,r))*l.a}getOpacityAtLatLng(r,l){return this._transform.projection.supportsFog?function(p,_,x){const T=o.MercatorCoordinate.fromLngLat(_),C=x.elevation?x.elevation.getAtPointOrZero(T):0,M=[T.x,T.y,C];return o.transformMat4(M,M,x.mercatorFogMatrix),At(p,M,x.pitch,x._fov)}(this.state,r,l):0}getFovAdjustedRange(r){return this._transform.projection.supportsFog?tn(this.state,r):[0,1]}updateTransitions(r){this._transitioning=this._transitionable.transitioned(r,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(r){this.properties=this._transitioning.possiblyEvaluate(r)}_validate(r,l,p){return(!p||p.validate!==!1)&&o.emitValidationErrors(this,r.call(o.validateStyle,o.extend({value:l,style:{glyphs:!0,sprite:!0},styleSpec:o.spec})))}}class qt{constructor(r,l){this.workerPool=r,this.actors=[],this.currentActor=0,this.id=o.uniqueId();const p=this.workerPool.acquire(this.id);for(let _=0;_<p.length;_++){const x=new qt.Actor(p[_],l,this.id);x.name=`Worker ${_}`,this.actors.push(x)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(r,l,p){o.asyncAll(this.actors,(_,x)=>{_.send(r,l,x)},p=p||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(r=>{r.remove()}),this.actors=[],this.workerPool.release(this.id)}}function xn(h,r,l){return r*(o.EXTENT/(h.tileSize*Math.pow(2,l-h.tileID.overscaledZ)))}qt.Actor=o.Actor;class rt{constructor(r,l,p,_){this.screenBounds=r,this.cameraPoint=l,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=p,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,_)}static createFromScreenPoints(r,l){let p,_;if(r instanceof o.pointGeometry||typeof r[0]=="number"){const x=o.pointGeometry.convert(r);p=[x],_=l.isPointAboveHorizon(x)}else{const x=o.pointGeometry.convert(r[0]),T=o.pointGeometry.convert(r[1]);p=[x,T],_=o.polygonizeBounds(x,T).every(C=>l.isPointAboveHorizon(C))}return new rt(p,l.getCameraPoint(),_,l)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(r){return o.polygonizeBounds(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],r)}bufferedCameraGeometry(r){const l=this.screenBounds[0],p=this.screenBounds.length===1?this.screenBounds[0].add(new o.pointGeometry(1,1)):this.screenBounds[1],_=o.polygonizeBounds(l,p,0,!1);return this.cameraPoint.y>p.y&&(this.cameraPoint.x>l.x&&this.cameraPoint.x<p.x?_.splice(3,0,this.cameraPoint):this.cameraPoint.x>=p.x?_[2]=this.cameraPoint:this.cameraPoint.x<=l.x&&(_[3]=this.cameraPoint)),o.bufferConvexPolygon(_,r)}bufferedCameraGeometryGlobe(r){const l=this.screenBounds[0],p=this.screenBounds.length===1?this.screenBounds[0].add(new o.pointGeometry(1,1)):this.screenBounds[1],_=o.polygonizeBounds(l,p,r),x=this.cameraPoint.clone();switch(3*((x.y>l.y)+(x.y>p.y))+((x.x>l.x)+(x.x>p.x))){case 0:_[0]=x,_[4]=x.clone();break;case 1:_.splice(1,0,x);break;case 2:_[1]=x;break;case 3:_.splice(4,0,x);break;case 5:_.splice(2,0,x);break;case 6:_[3]=x;break;case 7:_.splice(3,0,x);break;case 8:_[2]=x}return _}containsTile(r,l,p,_=0){const x=r.queryPadding/l._pixelsPerMercatorPixel+1,T=p?this._bufferedCameraMercator(x,l):this._bufferedScreenMercator(x,l);let C=r.tileID.wrap+(T.unwrapped?_:0);const M=T.polygon.map(H=>o.getTilePoint(r.tileTransform,H,C));if(!o.polygonIntersectsBox(M,0,0,o.EXTENT,o.EXTENT))return;C=r.tileID.wrap+(this.screenGeometryMercator.unwrapped?_:0);const R=this.screenGeometryMercator.polygon.map(H=>o.getTileVec3(r.tileTransform,H,C)),L=R.map(H=>new o.pointGeometry(H[0],H[1])),U=l.getFreeCameraOptions().position||new o.MercatorCoordinate(0,0,0),G=o.getTileVec3(r.tileTransform,U,C),Q=R.map(H=>{const W=o.sub(H,H,G);return o.normalize(W,W),new o.Ray(G,W)}),K=xn(r,1,l.zoom)*l._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:L,tilespaceRays:Q,bufferedTilespaceGeometry:M,bufferedTilespaceBounds:(J=o.getBounds(M),J.min.x=o.clamp(J.min.x,0,o.EXTENT),J.min.y=o.clamp(J.min.y,0,o.EXTENT),J.max.x=o.clamp(J.max.x,0,o.EXTENT),J.max.y=o.clamp(J.max.y,0,o.EXTENT),J),tile:r,tileID:r.tileID,pixelToTileUnitsFactor:K};var J}_bufferedScreenMercator(r,l){const p=_t(r);if(this._screenRaycastCache[p])return this._screenRaycastCache[p];{let _;return _=l.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(r),l):{polygon:this.bufferedScreenGeometry(r).map(x=>l.pointCoordinate3D(x)),unwrapped:!0},this._screenRaycastCache[p]=_,_}}_bufferedCameraMercator(r,l){const p=_t(r);if(this._cameraRaycastCache[p])return this._cameraRaycastCache[p];{let _;return _=l.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(r),l):{polygon:this.bufferedCameraGeometry(r).map(x=>l.pointCoordinate3D(x)),unwrapped:!0},this._cameraRaycastCache[p]=_,_}}_projectAndResample(r,l){const p=function(x,T){const C=o.multiply([],T.pixelMatrix,T.globeMatrix),M=[0,-o.GLOBE_RADIUS,0,1],R=[0,o.GLOBE_RADIUS,0,1],L=[0,0,0,1];o.transformMat4$1(M,M,C),o.transformMat4$1(R,R,C),o.transformMat4$1(L,L,C);const U=new o.pointGeometry(M[0]/M[3],M[1]/M[3]),G=new o.pointGeometry(R[0]/R[3],R[1]/R[3]),Q=o.polygonContainsPoint(x,U)&&M[3]<L[3],K=o.polygonContainsPoint(x,G)&&R[3]<L[3];if(!Q&&!K)return null;const J=function(Pe,He,qe){for(let Le=1;Le<Pe.length;Le++){const It=ot(He.pointCoordinate3D(Pe[Le-1]).x),Ue=ot(He.pointCoordinate3D(Pe[Le]).x);if(qe<0){if(It<Ue)return{idx:Le,t:-It/(Ue-1-It)}}else if(Ue<It)return{idx:Le,t:(1-It)/(Ue+1-It)}}return null}(x,T,Q?-1:1);if(!J)return null;const{idx:H,t:W}=J;let ie=H>1?gt(x.slice(0,H),T):[],ee=H<x.length?gt(x.slice(H),T):[];ie=ie.map(Pe=>new o.pointGeometry(ot(Pe.x),Pe.y)),ee=ee.map(Pe=>new o.pointGeometry(ot(Pe.x),Pe.y));const he=[...ie];he.length===0&&he.push(ee[ee.length-1]);const we=o.number(he[he.length-1].y,(ee.length===0?ie[0]:ee[0]).y,W);let ve;return ve=Q?[new o.pointGeometry(0,we),new o.pointGeometry(0,0),new o.pointGeometry(1,0),new o.pointGeometry(1,we)]:[new o.pointGeometry(1,we),new o.pointGeometry(1,1),new o.pointGeometry(0,1),new o.pointGeometry(0,we)],he.push(...ve),ee.length===0?he.push(ie[0]):he.push(...ee),{polygon:he.map(Pe=>new o.MercatorCoordinate(Pe.x,Pe.y)),unwrapped:!1}}(r,l);if(p)return p;const _=function(x,T){let C=!1,M=-1/0,R=0;for(let U=0;U<x.length-1;U++)x[U].x>M&&(M=x[U].x,R=U);for(let U=0;U<x.length-1;U++){const G=(R+U)%(x.length-1),Q=x[G],K=x[G+1];Math.abs(Q.x-K.x)>.5&&(Q.x<K.x?(Q.x+=1,G===0&&(x[x.length-1].x+=1)):(K.x+=1,G+1===x.length-1&&(x[0].x+=1)),C=!0)}const L=o.mercatorXfromLng(T.center.lng);return C&&L<Math.abs(L-1)&&x.forEach(U=>{U.x-=1}),{polygon:x,unwrapped:C}}(gt(r,l).map(x=>new o.pointGeometry(ot(x.x),x.y)),l);return{polygon:_.polygon.map(x=>new o.MercatorCoordinate(x.x,x.y)),unwrapped:_.unwrapped}}}function gt(h,r){return o.resample(h,l=>{const p=r.pointCoordinate3D(l);l.x=p.x,l.y=p.y},1/256)}function ot(h){return h<0?1+h%1:h%1}function _t(h){return 100*h|0}function ft(h,r,l,p,_){const x=function(T,C){if(T)return _(T);if(C){h.url&&C.tiles&&h.tiles&&delete h.tiles;const M=o.pick(o.extend(C,h),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);C.vector_layers&&(M.vectorLayers=C.vector_layers,M.vectorLayerIds=M.vectorLayers.map(R=>R.id)),M.tiles=r.canonicalizeTileset(M,h.url),_(null,M)}};return h.url?o.getJSON(r.transformRequest(r.normalizeSourceURL(h.url,null,l,p),o.ResourceType.Source),x):o.exported.frame(()=>x(null,h))}class sn{constructor(r,l,p){this.bounds=o.LngLatBounds.convert(this.validateBounds(r)),this.minzoom=l||0,this.maxzoom=p||24}validateBounds(r){return Array.isArray(r)&&r.length===4?[Math.max(-180,r[0]),Math.max(-90,r[1]),Math.min(180,r[2]),Math.min(90,r[3])]:[-180,-90,180,90]}contains(r){const l=Math.pow(2,r.z),p=Math.floor(o.mercatorXfromLng(this.bounds.getWest())*l),_=Math.floor(o.mercatorYfromLat(this.bounds.getNorth())*l),x=Math.ceil(o.mercatorXfromLng(this.bounds.getEast())*l),T=Math.ceil(o.mercatorYfromLat(this.bounds.getSouth())*l);return r.x>=p&&r.x<x&&r.y>=_&&r.y<T}}class un{constructor(r,l,p){this.context=r;const _=r.gl;this.buffer=_.createBuffer(),this.dynamicDraw=Boolean(p),this.context.unbindVAO(),r.bindElementBuffer.set(this.buffer),_.bufferData(_.ELEMENT_ARRAY_BUFFER,l.arrayBuffer,this.dynamicDraw?_.DYNAMIC_DRAW:_.STATIC_DRAW),this.dynamicDraw||l.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(r){const l=this.context.gl;this.context.unbindVAO(),this.bind(),l.bufferSubData(l.ELEMENT_ARRAY_BUFFER,0,r.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const re={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class xe{constructor(r,l,p,_){this.length=l.length,this.attributes=p,this.itemSize=l.bytesPerElement,this.dynamicDraw=_,this.context=r;const x=r.gl;this.buffer=x.createBuffer(),r.bindVertexBuffer.set(this.buffer),x.bufferData(x.ARRAY_BUFFER,l.arrayBuffer,this.dynamicDraw?x.DYNAMIC_DRAW:x.STATIC_DRAW),this.dynamicDraw||l.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(r){const l=this.context.gl;this.bind(),l.bufferSubData(l.ARRAY_BUFFER,0,r.arrayBuffer)}enableAttributes(r,l){for(let p=0;p<this.attributes.length;p++){const _=l.attributes[this.attributes[p].name];_!==void 0&&r.enableVertexAttribArray(_)}}setVertexAttribPointers(r,l,p){for(let _=0;_<this.attributes.length;_++){const x=this.attributes[_],T=l.attributes[x.name];T!==void 0&&r.vertexAttribPointer(T,x.components,r[re[x.type]],!1,this.itemSize,x.offset+this.itemSize*(p||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Fe{constructor(r){this.gl=r.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(r){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class nt extends Fe{getDefault(){return o.Color.transparent}set(r){const l=this.current;(r.r!==l.r||r.g!==l.g||r.b!==l.b||r.a!==l.a||this.dirty)&&(this.gl.clearColor(r.r,r.g,r.b,r.a),this.current=r,this.dirty=!1)}}class yt extends Fe{getDefault(){return 1}set(r){(r!==this.current||this.dirty)&&(this.gl.clearDepth(r),this.current=r,this.dirty=!1)}}class zt extends Fe{getDefault(){return 0}set(r){(r!==this.current||this.dirty)&&(this.gl.clearStencil(r),this.current=r,this.dirty=!1)}}class Vt extends Fe{getDefault(){return[!0,!0,!0,!0]}set(r){const l=this.current;(r[0]!==l[0]||r[1]!==l[1]||r[2]!==l[2]||r[3]!==l[3]||this.dirty)&&(this.gl.colorMask(r[0],r[1],r[2],r[3]),this.current=r,this.dirty=!1)}}class kt extends Fe{getDefault(){return!0}set(r){(r!==this.current||this.dirty)&&(this.gl.depthMask(r),this.current=r,this.dirty=!1)}}class bt extends Fe{getDefault(){return 255}set(r){(r!==this.current||this.dirty)&&(this.gl.stencilMask(r),this.current=r,this.dirty=!1)}}class Mt extends Fe{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(r){const l=this.current;(r.func!==l.func||r.ref!==l.ref||r.mask!==l.mask||this.dirty)&&(this.gl.stencilFunc(r.func,r.ref,r.mask),this.current=r,this.dirty=!1)}}class Ht extends Fe{getDefault(){const r=this.gl;return[r.KEEP,r.KEEP,r.KEEP]}set(r){const l=this.current;(r[0]!==l[0]||r[1]!==l[1]||r[2]!==l[2]||this.dirty)&&(this.gl.stencilOp(r[0],r[1],r[2]),this.current=r,this.dirty=!1)}}class et extends Fe{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const l=this.gl;r?l.enable(l.STENCIL_TEST):l.disable(l.STENCIL_TEST),this.current=r,this.dirty=!1}}class Rt extends Fe{getDefault(){return[0,1]}set(r){const l=this.current;(r[0]!==l[0]||r[1]!==l[1]||this.dirty)&&(this.gl.depthRange(r[0],r[1]),this.current=r,this.dirty=!1)}}class nn extends Fe{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const l=this.gl;r?l.enable(l.DEPTH_TEST):l.disable(l.DEPTH_TEST),this.current=r,this.dirty=!1}}class bn extends Fe{getDefault(){return this.gl.LESS}set(r){(r!==this.current||this.dirty)&&(this.gl.depthFunc(r),this.current=r,this.dirty=!1)}}class zn extends Fe{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const l=this.gl;r?l.enable(l.BLEND):l.disable(l.BLEND),this.current=r,this.dirty=!1}}class Cn extends Fe{getDefault(){const r=this.gl;return[r.ONE,r.ZERO]}set(r){const l=this.current;(r[0]!==l[0]||r[1]!==l[1]||this.dirty)&&(this.gl.blendFunc(r[0],r[1]),this.current=r,this.dirty=!1)}}class jn extends Fe{getDefault(){return o.Color.transparent}set(r){const l=this.current;(r.r!==l.r||r.g!==l.g||r.b!==l.b||r.a!==l.a||this.dirty)&&(this.gl.blendColor(r.r,r.g,r.b,r.a),this.current=r,this.dirty=!1)}}class Wn extends Fe{getDefault(){return this.gl.FUNC_ADD}set(r){(r!==this.current||this.dirty)&&(this.gl.blendEquation(r),this.current=r,this.dirty=!1)}}class Bi extends Fe{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const l=this.gl;r?l.enable(l.CULL_FACE):l.disable(l.CULL_FACE),this.current=r,this.dirty=!1}}class qi extends Fe{getDefault(){return this.gl.BACK}set(r){(r!==this.current||this.dirty)&&(this.gl.cullFace(r),this.current=r,this.dirty=!1)}}class ji extends Fe{getDefault(){return this.gl.CCW}set(r){(r!==this.current||this.dirty)&&(this.gl.frontFace(r),this.current=r,this.dirty=!1)}}class tr extends Fe{getDefault(){return null}set(r){(r!==this.current||this.dirty)&&(this.gl.useProgram(r),this.current=r,this.dirty=!1)}}class Ei extends Fe{getDefault(){return this.gl.TEXTURE0}set(r){(r!==this.current||this.dirty)&&(this.gl.activeTexture(r),this.current=r,this.dirty=!1)}}class $i extends Fe{getDefault(){const r=this.gl;return[0,0,r.drawingBufferWidth,r.drawingBufferHeight]}set(r){const l=this.current;(r[0]!==l[0]||r[1]!==l[1]||r[2]!==l[2]||r[3]!==l[3]||this.dirty)&&(this.gl.viewport(r[0],r[1],r[2],r[3]),this.current=r,this.dirty=!1)}}class hr extends Fe{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const l=this.gl;l.bindFramebuffer(l.FRAMEBUFFER,r),this.current=r,this.dirty=!1}}class Ar extends Fe{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const l=this.gl;l.bindRenderbuffer(l.RENDERBUFFER,r),this.current=r,this.dirty=!1}}class Mr extends Fe{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const l=this.gl;l.bindTexture(l.TEXTURE_2D,r),this.current=r,this.dirty=!1}}class fo extends Fe{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const l=this.gl;l.bindBuffer(l.ARRAY_BUFFER,r),this.current=r,this.dirty=!1}}class xr extends Fe{getDefault(){return null}set(r){const l=this.gl;l.bindBuffer(l.ELEMENT_ARRAY_BUFFER,r),this.current=r,this.dirty=!1}}class oo extends Fe{constructor(r){super(r),this.vao=r.extVertexArrayObject}getDefault(){return null}set(r){this.vao&&(r!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(r),this.current=r,this.dirty=!1)}}class Jo extends Fe{getDefault(){return 4}set(r){if(r===this.current&&!this.dirty)return;const l=this.gl;l.pixelStorei(l.UNPACK_ALIGNMENT,r),this.current=r,this.dirty=!1}}class so extends Fe{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const l=this.gl;l.pixelStorei(l.UNPACK_PREMULTIPLY_ALPHA_WEBGL,r),this.current=r,this.dirty=!1}}class ct extends Fe{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const l=this.gl;l.pixelStorei(l.UNPACK_FLIP_Y_WEBGL,r),this.current=r,this.dirty=!1}}class Kt extends Fe{constructor(r,l){super(r),this.context=r,this.parent=l}getDefault(){return null}}class hn extends Kt{setDirty(){this.dirty=!0}set(r){if(r===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const l=this.gl;l.framebufferTexture2D(l.FRAMEBUFFER,l.COLOR_ATTACHMENT0,l.TEXTURE_2D,r,0),this.current=r,this.dirty=!1}}class En extends Kt{attachment(){return this.gl.DEPTH_ATTACHMENT}set(r){if(r===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const l=this.gl;l.framebufferRenderbuffer(l.FRAMEBUFFER,this.attachment(),l.RENDERBUFFER,r),this.current=r,this.dirty=!1}}class In extends En{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class X{constructor(r,l,p,_){this.context=r,this.width=l,this.height=p;const x=this.framebuffer=r.gl.createFramebuffer();this.colorAttachment=new hn(r,x),_&&(this.depthAttachment=new En(r,x))}destroy(){const r=this.context.gl,l=this.colorAttachment.get();if(l&&r.deleteTexture(l),this.depthAttachment){const p=this.depthAttachment.get();p&&r.deleteRenderbuffer(p)}r.deleteFramebuffer(this.framebuffer)}}class N{constructor(r){this.gl=r,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new nt(this),this.clearDepth=new yt(this),this.clearStencil=new zt(this),this.colorMask=new Vt(this),this.depthMask=new kt(this),this.stencilMask=new bt(this),this.stencilFunc=new Mt(this),this.stencilOp=new Ht(this),this.stencilTest=new et(this),this.depthRange=new Rt(this),this.depthTest=new nn(this),this.depthFunc=new bn(this),this.blend=new zn(this),this.blendFunc=new Cn(this),this.blendColor=new jn(this),this.blendEquation=new Wn(this),this.cullFace=new Bi(this),this.cullFaceSide=new qi(this),this.frontFace=new ji(this),this.program=new tr(this),this.activeTexture=new Ei(this),this.viewport=new $i(this),this.bindFramebuffer=new hr(this),this.bindRenderbuffer=new Ar(this),this.bindTexture=new Mr(this),this.bindVertexBuffer=new fo(this),this.bindElementBuffer=new xr(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new oo(this),this.pixelStoreUnpack=new Jo(this),this.pixelStoreUnpackPremultiplyAlpha=new so(this),this.pixelStoreUnpackFlipY=new ct(this),this.extTextureFilterAnisotropic=r.getExtension("EXT_texture_filter_anisotropic")||r.getExtension("MOZ_EXT_texture_filter_anisotropic")||r.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=r.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureFilterAnisotropicForceOff=!1,this.extStandardDerivativesForceOff=!1,this.extDebugRendererInfo=r.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=r.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=r.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.extTextureHalfFloat=r.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(r.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=r.getExtension("EXT_color_buffer_half_float")),this.extStandardDerivatives=r.getExtension("OES_standard_derivatives"),this.extTimerQuery=r.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=r.getParameter(r.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(r,l){return new un(this,r,l)}createVertexBuffer(r,l,p){return new xe(this,r,l,p)}createRenderbuffer(r,l,p){const _=this.gl,x=_.createRenderbuffer();return this.bindRenderbuffer.set(x),_.renderbufferStorage(_.RENDERBUFFER,r,l,p),this.bindRenderbuffer.set(null),x}createFramebuffer(r,l,p){return new X(this,r,l,p)}clear({color:r,depth:l,stencil:p}){const _=this.gl;let x=0;r&&(x|=_.COLOR_BUFFER_BIT,this.clearColor.set(r),this.colorMask.set([!0,!0,!0,!0])),l!==void 0&&(x|=_.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(l),this.depthMask.set(!0)),p!==void 0&&(x|=_.STENCIL_BUFFER_BIT,this.clearStencil.set(p),this.stencilMask.set(255)),_.clear(x)}setCullFace(r){r.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(r.mode),this.frontFace.set(r.frontFace))}setDepthMode(r){r.func!==this.gl.ALWAYS||r.mask?(this.depthTest.set(!0),this.depthFunc.set(r.func),this.depthMask.set(r.mask),this.depthRange.set(r.range)):this.depthTest.set(!1)}setStencilMode(r){r.test.func!==this.gl.ALWAYS||r.mask?(this.stencilTest.set(!0),this.stencilMask.set(r.mask),this.stencilOp.set([r.fail,r.depthFail,r.pass]),this.stencilFunc.set({func:r.test.func,ref:r.ref,mask:r.test.mask})):this.stencilTest.set(!1)}setColorMode(r){S(r.blendFunction,o.ColorMode.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(r.blendFunction),this.blendColor.set(r.blendColor)),this.colorMask.set(r.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class j extends o.Evented{constructor(r,l,p,_){super(),this.id=r,this.dispatcher=p,this.setEventedParent(_),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=o.extend({type:"raster"},l),o.extend(this,o.pick(l,["url","scheme","tileSize"]))}load(){this._loaded=!1,this.fire(new o.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=ft(this._options,this.map._requestManager,null,null,(r,l)=>{this._tileJSONRequest=null,this._loaded=!0,r?this.fire(new o.ErrorEvent(r)):l&&(o.extend(this,l),l.bounds&&(this.tileBounds=new sn(l.bounds,this.minzoom,this.maxzoom)),o.postTurnstileEvent(l.tiles),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}onAdd(r){this.map=r,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return o.extend({},this._options)}hasTile(r){return!this.tileBounds||this.tileBounds.contains(r.canonical)}loadTile(r,l){const p=o.exported.devicePixelRatio>=2,_=this.map._requestManager.normalizeTileURL(r.tileID.canonical.url(this.tiles,this.scheme),p,this.tileSize);r.request=o.getImage(this.map._requestManager.transformRequest(_,o.ResourceType.Tile),(x,T,C,M)=>(delete r.request,r.aborted?(r.state="unloaded",l(null)):x?(r.state="errored",l(x)):T?(this.map._refreshExpiredTiles&&r.setExpiryData({cacheControl:C,expires:M}),r.setTexture(T,this.map.painter),r.state="loaded",o.cacheEntryPossiblyAdded(this.dispatcher),void l(null)):l(null)))}static loadTileData(r,l,p){r.setTexture(l,p)}static unloadTileData(r,l){r.texture&&l.saveTileTexture(r.texture)}abortTile(r,l){r.request&&(r.request.cancel(),delete r.request),l()}unloadTile(r,l){r.texture&&this.map.painter.saveTileTexture(r.texture),l()}hasTransition(){return!1}}let Y;function ue(h,r,l,p,_,x,T,C){const M=[h,l,_,r,p,x,1,1,1],R=[T,C,1],L=o.adjoint([],M),[U,G,Q]=o.transformMat3(R,R,o.transpose(L,L));return o.multiply$1(M,[U,0,0,0,G,0,0,0,Q],M)}class Te extends o.Evented{constructor(r,l,p,_){super(),this.id=r,this.dispatcher=p,this.coordinates=l.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(_),this.options=l,this._dirty=!1}load(r,l){this._loaded=l||!1,this.fire(new o.Event("dataloading",{dataType:"source"})),this.url=this.options.url,this._imageRequest=o.getImage(this.map._requestManager.transformRequest(this.url,o.ResourceType.Image),(p,_)=>{if(this._imageRequest=null,this._loaded=!0,p)this.fire(new o.ErrorEvent(p));else if(_){const{HTMLImageElement:x}=o.window;this.image=_ instanceof x?o.exported.getImageData(_):_,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,r&&(this.coordinates=r),this._finishLoading()}})}loaded(){return this._loaded}updateImage(r){return this.image&&r.url?(this._imageRequest&&r.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=r.url,this.load(r.coordinates,this._loaded),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(r){this.map=r,this.load()}onRemove(){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),this.texture&&this.texture.destroy()}setCoordinates(r){this.coordinates=r,this._boundsArray=void 0;const l=r.map(o.MercatorCoordinate.fromLngLat);return this.tileID=function(p){let _=1/0,x=1/0,T=-1/0,C=-1/0;for(const U of p)_=Math.min(_,U.x),x=Math.min(x,U.y),T=Math.max(T,U.x),C=Math.max(C,U.y);const M=Math.max(T-_,C-x),R=Math.max(0,Math.floor(-Math.log(M)/Math.LN2)),L=Math.pow(2,R);return new o.CanonicalTileID(R,Math.floor((_+T)/2*L),Math.floor((x+C)/2*L))}(l),this.minzoom=this.maxzoom=this.tileID.z,this.fire(new o.Event("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0}_prepareData(r){for(const M in this.tiles){const R=this.tiles[M];R.state!=="loaded"&&(R.state="loaded",R.texture=this.texture)}if(this._boundsArray)return;const l=o.tileTransform(this.tileID,this.map.transform.projection),[p,_,x,T]=this.coordinates.map(M=>{const R=l.projection.project(M[0],M[1]);return o.getTilePoint(l,R)._round()});this.perspectiveTransform=function(M,R,L,U,G,Q,K,J,H,W){const ie=ue(0,0,M,0,0,R,M,R),ee=ue(L,U,G,Q,K,J,H,W);return o.multiply$1(ee,o.adjoint(ie,ie),ee),[ee[6]/ee[8]*M/o.EXTENT,ee[7]/ee[8]*R/o.EXTENT]}(this.width,this.height,p.x,p.y,_.x,_.y,T.x,T.y,x.x,x.y);const C=this._boundsArray=new o.StructArrayLayout4i8;C.emplaceBack(p.x,p.y,0,0),C.emplaceBack(_.x,_.y,o.EXTENT,0),C.emplaceBack(T.x,T.y,0,o.EXTENT),C.emplaceBack(x.x,x.y,o.EXTENT,o.EXTENT),this.boundsBuffer&&this.boundsBuffer.destroy(),this.boundsBuffer=r.createVertexBuffer(C,o.boundsAttributes.members),this.boundsSegments=o.SegmentVector.simpleSegment(0,0,4,2)}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const r=this.map.painter.context,l=r.gl;this._dirty&&(this.texture?this.texture.update(this.image):(this.texture=new o.Texture(r,this.image,l.RGBA),this.texture.bind(l.LINEAR,l.CLAMP_TO_EDGE)),this._dirty=!1),this._prepareData(r)}loadTile(r,l){this.tileID&&this.tileID.equals(r.tileID.canonical)?(this.tiles[String(r.tileID.wrap)]=r,r.buckets={},l(null)):(r.state="errored",l(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}const Oe={vector:class extends o.Evented{constructor(h,r,l,p){if(super(),this.id=h,this.dispatcher=l,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,o.extend(this,o.pick(r,["url","scheme","tileSize","promoteId"])),this._options=o.extend({type:"vector"},r),this._collectResourceTiming=r.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(p),this._tileWorkers={},this._deduped=new o.DedupedRequest}load(h){this._loaded=!1,this.fire(new o.Event("dataloading",{dataType:"source"}));const r=Array.isArray(this.map._language)?this.map._language.join():this.map._language,l=this.map._worldview;this._tileJSONRequest=ft(this._options,this.map._requestManager,r,l,(p,_)=>{this._tileJSONRequest=null,this._loaded=!0,p?(r&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${r}`),l&&l.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${l}`),this.fire(new o.ErrorEvent(p))):_&&(o.extend(this,_),_.bounds&&(this.tileBounds=new sn(_.bounds,this.minzoom,this.maxzoom)),o.postTurnstileEvent(_.tiles,this.map._requestManager._customAccessToken),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"content"}))),h&&h(p)})}loaded(){return this._loaded}hasTile(h){return!this.tileBounds||this.tileBounds.contains(h.canonical)}onAdd(h){this.map=h,this.load()}reload(){this.cancelTileJSONRequest(),this.load(()=>{const h=this.map.style._getSourceCaches(this.id);for(const r of h)r.clearTiles()})}setSourceProperty(h){h(),this.reload()}setTiles(h){return this._options.tiles=h,this.reload(),this}setUrl(h){return this.url=h,this._options.url=h,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return o.extend({},this._options)}loadTile(h,r){const l=this.map._requestManager.normalizeTileURL(h.tileID.canonical.url(this.tiles,this.scheme)),p={request:this.map._requestManager.transformRequest(l,o.ResourceType.Tile),data:void 0,uid:h.uid,tileID:h.tileID,tileZoom:h.tileZoom,zoom:h.tileID.overscaledZ,tileSize:this.tileSize*h.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:o.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:h.isSymbolTile};if(p.request.collectResourceTiming=this._collectResourceTiming,h.actor&&h.state!=="expired")h.state==="loading"?h.reloadCallback=r:h.request=h.actor.send("reloadTile",p,_.bind(this));else if(h.actor=this._tileWorkers[l]=this._tileWorkers[l]||this.dispatcher.getActor(),this.dispatcher.ready)h.request=h.actor.send("loadTile",p,_.bind(this),void 0,!0);else{const x=o.loadVectorTile.call({deduped:this._deduped},p,(T,C)=>{T||!C?_.call(this,T):(p.data={cacheControl:C.cacheControl,expires:C.expires,rawData:C.rawData.slice(0)},h.actor&&h.actor.send("loadTile",p,_.bind(this),void 0,!0))},!0);h.request={cancel:x}}function _(x,T){return delete h.request,h.aborted?r(null):x&&x.status!==404?r(x):(T&&T.resourceTiming&&(h.resourceTiming=T.resourceTiming),this.map._refreshExpiredTiles&&T&&h.setExpiryData(T),h.loadVectorData(T,this.map.painter),o.cacheEntryPossiblyAdded(this.dispatcher),r(null),void(h.reloadCallback&&(this.loadTile(h,h.reloadCallback),h.reloadCallback=null)))}}abortTile(h){h.request&&(h.request.cancel(),delete h.request),h.actor&&h.actor.send("abortTile",{uid:h.uid,type:this.type,source:this.id})}unloadTile(h){h.unloadVectorData(),h.actor&&h.actor.send("removeTile",{uid:h.uid,type:this.type,source:this.id})}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}},raster:j,"raster-dem":class extends j{constructor(h,r,l,p){super(h,r,l,p),this.type="raster-dem",this.maxzoom=22,this._options=o.extend({type:"raster-dem"},r),this.encoding=r.encoding||"mapbox"}loadTile(h,r){const l=this.map._requestManager.normalizeTileURL(h.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function p(_,x){_&&(h.state="errored",r(_)),x&&(h.dem=x,h.dem.onDeserialize(),h.needsHillshadePrepare=!0,h.needsDEMTextureUpload=!0,h.state="loaded",r(null))}h.request=o.getImage(this.map._requestManager.transformRequest(l,o.ResourceType.Tile),function(_,x,T,C){if(delete h.request,h.aborted)h.state="unloaded",r(null);else if(_)h.state="errored",r(_);else if(x){this.map._refreshExpiredTiles&&h.setExpiryData({cacheControl:T,expires:C});const M=o.window.ImageBitmap&&x instanceof o.window.ImageBitmap&&(Y==null&&(Y=o.window.OffscreenCanvas&&new o.window.OffscreenCanvas(1,1).getContext("2d")&&typeof o.window.createImageBitmap=="function"),Y),R=1-(x.width-o.prevPowerOfTwo(x.width))/2;R<1||h.neighboringTiles||(h.neighboringTiles=this._getNeighboringTiles(h.tileID));const L=M?x:o.exported.getImageData(x,R),U={uid:h.uid,coord:h.tileID,source:this.id,rawImageData:L,encoding:this.encoding,padding:R};h.actor&&h.state!=="expired"||(h.actor=this.dispatcher.getActor(),h.actor.send("loadDEMTile",U,p.bind(this),void 0,!0))}}.bind(this))}_getNeighboringTiles(h){const r=h.canonical,l=Math.pow(2,r.z),p=(r.x-1+l)%l,_=r.x===0?h.wrap-1:h.wrap,x=(r.x+1+l)%l,T=r.x+1===l?h.wrap+1:h.wrap,C={};return C[new o.OverscaledTileID(h.overscaledZ,_,r.z,p,r.y).key]={backfilled:!1},C[new o.OverscaledTileID(h.overscaledZ,T,r.z,x,r.y).key]={backfilled:!1},r.y>0&&(C[new o.OverscaledTileID(h.overscaledZ,_,r.z,p,r.y-1).key]={backfilled:!1},C[new o.OverscaledTileID(h.overscaledZ,h.wrap,r.z,r.x,r.y-1).key]={backfilled:!1},C[new o.OverscaledTileID(h.overscaledZ,T,r.z,x,r.y-1).key]={backfilled:!1}),r.y+1<l&&(C[new o.OverscaledTileID(h.overscaledZ,_,r.z,p,r.y+1).key]={backfilled:!1},C[new o.OverscaledTileID(h.overscaledZ,h.wrap,r.z,r.x,r.y+1).key]={backfilled:!1},C[new o.OverscaledTileID(h.overscaledZ,T,r.z,x,r.y+1).key]={backfilled:!1}),C}unloadTile(h){h.demTexture&&this.map.painter.saveTileTexture(h.demTexture),h.fbo&&(h.fbo.destroy(),delete h.fbo),h.dem&&delete h.dem,delete h.neighboringTiles,h.state="unloaded"}},geojson:class extends o.Evented{constructor(h,r,l,p){super(),this.id=h,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=l.getActor(),this.setEventedParent(p),this._data=r.data,this._options=o.extend({},r),this._collectResourceTiming=r.collectResourceTiming,r.maxzoom!==void 0&&(this.maxzoom=r.maxzoom),r.type&&(this.type=r.type),r.attribution&&(this.attribution=r.attribution),this.promoteId=r.promoteId;const _=o.EXTENT/this.tileSize;this.workerOptions=o.extend({source:this.id,cluster:r.cluster||!1,geojsonVtOptions:{buffer:(r.buffer!==void 0?r.buffer:128)*_,tolerance:(r.tolerance!==void 0?r.tolerance:.375)*_,extent:o.EXTENT,maxZoom:this.maxzoom,lineMetrics:r.lineMetrics||!1,generateId:r.generateId||!1},superclusterOptions:{maxZoom:r.clusterMaxZoom!==void 0?r.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,r.clusterMinPoints||2),extent:o.EXTENT,radius:(r.clusterRadius!==void 0?r.clusterRadius:50)*_,log:!1,generateId:r.generateId||!1},clusterProperties:r.clusterProperties,filter:r.filter},r.workerOptions)}onAdd(h){this.map=h,this.setData(this._data)}setData(h){return this._data=h,this._updateWorkerData(),this}getClusterExpansionZoom(h,r){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:h,source:this.id},r),this}getClusterChildren(h,r){return this.actor.send("geojson.getClusterChildren",{clusterId:h,source:this.id},r),this}getClusterLeaves(h,r,l,p){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:h,limit:r,offset:l},p),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new o.Event("dataloading",{dataType:"source"})),this._loaded=!1;const h=o.extend({},this.workerOptions),r=this._data;typeof r=="string"?(h.request=this.map._requestManager.transformRequest(o.exported.resolveURL(r),o.ResourceType.Source),h.request.collectResourceTiming=this._collectResourceTiming):h.data=JSON.stringify(r),this._pendingLoad=this.actor.send(`${this.type}.loadData`,h,(l,p)=>{if(this._loaded=!0,this._pendingLoad=null,l)this.fire(new o.ErrorEvent(l));else{const _={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&p&&p.resourceTiming&&p.resourceTiming[this.id]&&(_.resourceTiming=p.resourceTiming[this.id]),this.fire(new o.Event("data",_)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(h,r){const l=h.actor?"reloadTile":"loadTile";h.actor=this.actor,h.request=this.actor.send(l,{type:this.type,uid:h.uid,tileID:h.tileID,tileZoom:h.tileZoom,zoom:h.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:o.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},(p,_)=>(delete h.request,h.unloadVectorData(),h.aborted?r(null):p?r(p):(h.loadVectorData(_,this.map.painter,l==="reloadTile"),r(null))),void 0,l==="loadTile")}abortTile(h){h.request&&(h.request.cancel(),delete h.request),h.aborted=!0}unloadTile(h){h.unloadVectorData(),this.actor.send("removeTile",{uid:h.uid,type:this.type,source:this.id})}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return o.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends Te{constructor(h,r,l,p){super(h,r,l,p),this.roundZoom=!0,this.type="video",this.options=r}load(){this._loaded=!1;const h=this.options;this.urls=[];for(const r of h.urls)this.urls.push(this.map._requestManager.transformRequest(r,o.ResourceType.Source).url);o.getVideo(this.urls,(r,l)=>{this._loaded=!0,r?this.fire(new o.ErrorEvent(r)):l&&(this.video=l,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(h){if(this.video){const r=this.video.seekable;h<r.start(0)||h>r.end(0)?this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${r.start(0)} and ${r.end(0)}-second mark.`))):this.video.currentTime=h}}getVideo(){return this.video}onAdd(h){this.map||(this.map=h,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const h=this.map.painter.context,r=h.gl;this.texture?this.video.paused||(this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE),r.texSubImage2D(r.TEXTURE_2D,0,0,0,r.RGBA,r.UNSIGNED_BYTE,this.video)):(this.texture=new o.Texture(h,this.video,r.RGBA),this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(h)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:Te,canvas:class extends Te{constructor(h,r,l,p){super(h,r,l,p),r.coordinates?Array.isArray(r.coordinates)&&r.coordinates.length===4&&!r.coordinates.some(_=>!Array.isArray(_)||_.length!==2||_.some(x=>typeof x!="number"))||this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${h}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${h}`,null,'missing required property "coordinates"'))),r.animate&&typeof r.animate!="boolean"&&this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${h}`,null,'optional "animate" property must be a boolean value'))),r.canvas?typeof r.canvas=="string"||r.canvas instanceof o.window.HTMLCanvasElement||this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${h}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${h}`,null,'missing required property "canvas"'))),this.options=r,this.animate=r.animate===void 0||r.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof o.window.HTMLCanvasElement?this.options.canvas:o.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new o.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(h){this.map=h,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let h=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,h=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,h=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const r=this.map.painter.context;this.texture?(h||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new o.Texture(r,this.canvas,r.gl.RGBA,{premultiply:!0}),this._prepareData(r)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const h of[this.canvas.width,this.canvas.height])if(isNaN(h)||h<=0)return!0;return!1}},custom:class extends o.Evented{constructor(h,r,l,p){super(),this.id=h,this.type="custom",this._dataType="raster",this._dispatcher=l,this._implementation=r,this.setEventedParent(p),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new o.ErrorEvent(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new o.ErrorEvent(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new sn(this._implementation.bounds,this.minzoom,this.maxzoom)),r.update=this._update.bind(this),r.clearTiles=this._clearTiles.bind(this),r.coveringTiles=this._coveringTiles.bind(this),o.extend(this,o.pick(r,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return o.pick(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new o.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(h){this._map=h,this._loaded=!1,this.fire(new o.Event("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(h),this.load()}onRemove(h){this._implementation.onRemove&&this._implementation.onRemove(h)}hasTile(h){if(this._implementation.hasTile){const{x:r,y:l,z:p}=h.canonical;return this._implementation.hasTile({x:r,y:l,z:p})}return!this.tileBounds||this.tileBounds.contains(h.canonical)}loadTile(h,r){const{x:l,y:p,z:_}=h.tileID.canonical,x=new o.window.AbortController;h.request=Promise.resolve(this._implementation.loadTile({x:l,y:p,z:_},{signal:x.signal})).then(function(T){return delete h.request,h.aborted?(h.state="unloaded",r(null)):T===void 0?(h.state="errored",r(null)):T===null?(this.loadTileData(h,{width:this.tileSize,height:this.tileSize,data:null}),h.state="loaded",r(null)):function(C){return C instanceof o.window.ImageData||C instanceof o.window.HTMLCanvasElement||C instanceof o.window.ImageBitmap||C instanceof o.window.HTMLImageElement}(T)?(this.loadTileData(h,T),h.state="loaded",void r(null)):(h.state="errored",r(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}.bind(this)).catch(T=>{T.code!==20&&(h.state="errored",r(T))}),h.request.cancel=()=>x.abort()}loadTileData(h,r){j.loadTileData(h,r,this._map.painter)}unloadTileData(h){j.unloadTileData(h,this._map.painter)}unloadTile(h,r){if(this.unloadTileData(h),this._implementation.unloadTile){const{x:l,y:p,z:_}=h.tileID.canonical;this._implementation.unloadTile({x:l,y:p,z:_})}r()}abortTile(h,r){h.request&&h.request.cancel&&(h.request.cancel(),delete h.request),r()}hasTransition(){return!1}_coveringTiles(){return this._map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(h=>({x:h.canonical.x,y:h.canonical.y,z:h.canonical.z}))}_clearTiles(){this._map.style._clearSource(this.id)}_update(){this.fire(new o.Event("data",{dataType:"source",sourceDataType:"content"}))}}},ze=function(h,r,l,p){const _=new Oe[r.type](h,r,l,p);if(_.id!==h)throw new Error(`Expected Source id to be ${h} instead of ${_.id}`);return o.bindAll(["load","abort","unload","serialize","prepare"],_),_};function Ce(h,r){const l=o.identity([]);return o.scale(l,l,[.5*h.width,.5*-h.height,1]),o.translate(l,l,[1,-1,0]),o.multiply(l,l,h.calculateProjMatrix(r.toUnwrapped())),Float32Array.from(l)}function Ne(h,r,l,p,_,x,T,C=!1){const M=h.tilesIn(p,T,C);M.sort(Ft);const R=[];for(const U of M)R.push({wrappedTileID:U.tile.tileID.wrapped().key,queryResults:U.tile.queryRenderedFeatures(r,l,h._state,U,_,x,Ce(h.transform,U.tile.tileID),C)});const L=function(U){const G={},Q={};for(const K of U){const J=K.queryResults,H=K.wrappedTileID,W=Q[H]=Q[H]||{};for(const ie in J){const ee=J[ie],he=W[ie]=W[ie]||{},we=G[ie]=G[ie]||[];for(const ve of ee)he[ve.featureIndex]||(he[ve.featureIndex]=!0,we.push(ve))}}return G}(R);for(const U in L)L[U].forEach(G=>{const Q=G.feature,K=Q.layer;K&&K.type!=="background"&&K.type!=="sky"&&(Q.source=K.source,K["source-layer"]&&(Q.sourceLayer=K["source-layer"]),Q.state=Q.id!==void 0?h.getFeatureState(K["source-layer"],Q.id):{})});return L}function ht(h,r){const l=h.getRenderableIds().map(x=>h.getTileByID(x)),p=[],_={};for(let x=0;x<l.length;x++){const T=l[x],C=T.tileID.canonical.key;_[C]||(_[C]=!0,T.querySourceFeatures(p,r))}return p}function Ft(h,r){const l=h.tileID,p=r.tileID;return l.overscaledZ-p.overscaledZ||l.canonical.y-p.canonical.y||l.wrap-p.wrap||l.canonical.x-p.canonical.x}function wt(){return xl.workerClass!=null?new xl.workerClass:new o.window.Worker(xl.workerUrl)}const an="mapboxgl_preloaded_worker_pool";class on{constructor(){this.active={}}acquire(r){if(!this.workers)for(this.workers=[];this.workers.length<on.workerCount;)this.workers.push(new wt);return this.active[r]=!0,this.workers.slice()}release(r){delete this.active[r],this.numActive()===0&&(this.workers.forEach(l=>{l.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[an]}numActive(){return Object.keys(this.active).length}}let rn;function fn(){return rn||(rn=new on),rn}function me(h,r){const l={};for(const p in h)p!=="ref"&&(l[p]=h[p]);return o.refProperties.forEach(p=>{p in r&&(l[p]=r[p])}),l}function Lt(h){h=h.slice();const r=Object.create(null);for(let l=0;l<h.length;l++)r[h[l].id]=h[l];for(let l=0;l<h.length;l++)"ref"in h[l]&&(h[l]=me(h[l],r[h[l].ref]));return h}on.workerCount=2;const at={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setProjection:"setProjection"};function Yt(h,r,l){l.push({command:at.addSource,args:[h,r[h]]})}function yn(h,r,l){r.push({command:at.removeSource,args:[h]}),l[h]=!0}function Bn(h,r,l,p){yn(h,l,p),Yt(h,r,l)}function ai(h,r,l){let p;for(p in h[l])if(h[l].hasOwnProperty(p)&&p!=="data"&&!S(h[l][p],r[l][p]))return!1;for(p in r[l])if(r[l].hasOwnProperty(p)&&p!=="data"&&!S(h[l][p],r[l][p]))return!1;return!0}function mi(h,r,l,p,_,x){let T;for(T in r=r||{},h=h||{})h.hasOwnProperty(T)&&(S(h[T],r[T])||l.push({command:x,args:[p,T,r[T],_]}));for(T in r)r.hasOwnProperty(T)&&!h.hasOwnProperty(T)&&(S(h[T],r[T])||l.push({command:x,args:[p,T,r[T],_]}))}function tt(h){return h.id}function Ro(h,r){return h[r.id]=r,h}class Gi{constructor(r,l){this.reset(r,l)}reset(r,l){this.points=r||[],this._distances=[0];for(let p=1;p<this.points.length;p++)this._distances[p]=this._distances[p-1]+this.points[p].dist(this.points[p-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(l||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(r){if(this.points.length===1)return this.points[0];r=o.clamp(r,0,1);let l=1,p=this._distances[l];const _=r*this.paddedLength+this.padding;for(;p<_&&l<this._distances.length;)p=this._distances[++l];const x=l-1,T=this._distances[x],C=p-T,M=C>0?(_-T)/C:0;return this.points[x].mult(1-M).add(this.points[l].mult(M))}}class Do{constructor(r,l,p){const _=this.boxCells=[],x=this.circleCells=[];this.xCellCount=Math.ceil(r/p),this.yCellCount=Math.ceil(l/p);for(let T=0;T<this.xCellCount*this.yCellCount;T++)_.push([]),x.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=r,this.height=l,this.xScale=this.xCellCount/r,this.yScale=this.yCellCount/l,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(r,l,p,_,x){this._forEachCell(l,p,_,x,this._insertBoxCell,this.boxUid++),this.boxKeys.push(r),this.bboxes.push(l),this.bboxes.push(p),this.bboxes.push(_),this.bboxes.push(x)}insertCircle(r,l,p,_){this._forEachCell(l-_,p-_,l+_,p+_,this._insertCircleCell,this.circleUid++),this.circleKeys.push(r),this.circles.push(l),this.circles.push(p),this.circles.push(_)}_insertBoxCell(r,l,p,_,x,T){this.boxCells[x].push(T)}_insertCircleCell(r,l,p,_,x,T){this.circleCells[x].push(T)}_query(r,l,p,_,x,T){if(p<0||r>this.width||_<0||l>this.height)return!x&&[];const C=[];if(r<=0&&l<=0&&this.width<=p&&this.height<=_){if(x)return!0;for(let M=0;M<this.boxKeys.length;M++)C.push({key:this.boxKeys[M],x1:this.bboxes[4*M],y1:this.bboxes[4*M+1],x2:this.bboxes[4*M+2],y2:this.bboxes[4*M+3]});for(let M=0;M<this.circleKeys.length;M++){const R=this.circles[3*M],L=this.circles[3*M+1],U=this.circles[3*M+2];C.push({key:this.circleKeys[M],x1:R-U,y1:L-U,x2:R+U,y2:L+U})}return T?C.filter(T):C}return this._forEachCell(r,l,p,_,this._queryCell,C,{hitTest:x,seenUids:{box:{},circle:{}}},T),x?C.length>0:C}_queryCircle(r,l,p,_,x){const T=r-p,C=r+p,M=l-p,R=l+p;if(C<0||T>this.width||R<0||M>this.height)return!_&&[];const L=[];return this._forEachCell(T,M,C,R,this._queryCellCircle,L,{hitTest:_,circle:{x:r,y:l,radius:p},seenUids:{box:{},circle:{}}},x),_?L.length>0:L}query(r,l,p,_,x){return this._query(r,l,p,_,!1,x)}hitTest(r,l,p,_,x){return this._query(r,l,p,_,!0,x)}hitTestCircle(r,l,p,_){return this._queryCircle(r,l,p,!0,_)}_queryCell(r,l,p,_,x,T,C,M){const R=C.seenUids,L=this.boxCells[x];if(L!==null){const G=this.bboxes;for(const Q of L)if(!R.box[Q]){R.box[Q]=!0;const K=4*Q;if(r<=G[K+2]&&l<=G[K+3]&&p>=G[K+0]&&_>=G[K+1]&&(!M||M(this.boxKeys[Q]))){if(C.hitTest)return T.push(!0),!0;T.push({key:this.boxKeys[Q],x1:G[K],y1:G[K+1],x2:G[K+2],y2:G[K+3]})}}}const U=this.circleCells[x];if(U!==null){const G=this.circles;for(const Q of U)if(!R.circle[Q]){R.circle[Q]=!0;const K=3*Q;if(this._circleAndRectCollide(G[K],G[K+1],G[K+2],r,l,p,_)&&(!M||M(this.circleKeys[Q]))){if(C.hitTest)return T.push(!0),!0;{const J=G[K],H=G[K+1],W=G[K+2];T.push({key:this.circleKeys[Q],x1:J-W,y1:H-W,x2:J+W,y2:H+W})}}}}}_queryCellCircle(r,l,p,_,x,T,C,M){const R=C.circle,L=C.seenUids,U=this.boxCells[x];if(U!==null){const Q=this.bboxes;for(const K of U)if(!L.box[K]){L.box[K]=!0;const J=4*K;if(this._circleAndRectCollide(R.x,R.y,R.radius,Q[J+0],Q[J+1],Q[J+2],Q[J+3])&&(!M||M(this.boxKeys[K])))return T.push(!0),!0}}const G=this.circleCells[x];if(G!==null){const Q=this.circles;for(const K of G)if(!L.circle[K]){L.circle[K]=!0;const J=3*K;if(this._circlesCollide(Q[J],Q[J+1],Q[J+2],R.x,R.y,R.radius)&&(!M||M(this.circleKeys[K])))return T.push(!0),!0}}}_forEachCell(r,l,p,_,x,T,C,M){const R=this._convertToXCellCoord(r),L=this._convertToYCellCoord(l),U=this._convertToXCellCoord(p),G=this._convertToYCellCoord(_);for(let Q=R;Q<=U;Q++)for(let K=L;K<=G;K++)if(x.call(this,r,l,p,_,this.xCellCount*K+Q,T,C,M))return}_convertToXCellCoord(r){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(r*this.xScale)))}_convertToYCellCoord(r){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(r*this.yScale)))}_circlesCollide(r,l,p,_,x,T){const C=_-r,M=x-l,R=p+T;return R*R>C*C+M*M}_circleAndRectCollide(r,l,p,_,x,T,C){const M=(T-_)/2,R=Math.abs(r-(_+M));if(R>M+p)return!1;const L=(C-x)/2,U=Math.abs(l-(x+L));if(U>L+p)return!1;if(R<=M||U<=L)return!0;const G=R-M,Q=U-L;return G*G+Q*Q<=p*p}}const hg=Math.tan(85*Math.PI/180);function qr(h,r,l,p,_,x,T){const C=o.create();if(l)if(x.name==="globe"){const M=o.calculateGlobeLabelMatrix(_,r);o.multiply(C,C,M)}else{const M=Ie([],T);C[0]=M[0],C[1]=M[1],C[4]=M[2],C[5]=M[3],p||o.rotateZ(C,C,_.angle)}else o.multiply(C,_.labelPlaneMatrix,h);return C}function ic(h,r,l,p,_,x,T){const C=qr(h,r,l,p,_,x,T);return x.name==="globe"&&l||(C[2]=C[6]=C[10]=C[14]=0),C}function jd(h,r,l,p,_,x,T){if(l){if(x.name==="globe"){const C=qr(h,r,l,p,_,x,T);return o.invert(C,C),o.multiply(C,h,C),C}{const C=o.clone(h),M=o.identity([]);return M[0]=T[0],M[1]=T[1],M[4]=T[2],M[5]=T[3],o.multiply(C,C,M),p||o.rotateZ(C,C,-_.angle),C}}return _.glCoordMatrix}function br(h,r,l,p){const _=[h,r,l,1];l?o.transformMat4$1(_,_,p):Ti(_,_,p);const x=_[3];return _[0]/=x,_[1]/=x,_[2]/=x,_}function jt(h,r){return Math.min(.5+h/r*.5,1.5)}function Fn(h,r){const l=h[0]/h[3],p=h[1]/h[3];return l>=-r[0]&&l<=r[0]&&p>=-r[1]&&p<=r[1]}function Ln(h,r,l,p,_,x,T,C,M,R){const L=l.transform,U=p?h.textSizeData:h.iconSizeData,G=o.evaluateSizeForZoom(U,l.transform.zoom),Q=L.projection.name==="globe",K=[256/l.width*2+1,256/l.height*2+1],J=p?h.text.dynamicLayoutVertexArray:h.icon.dynamicLayoutVertexArray;J.clear();let H=null;Q&&(H=p?h.text.globeExtVertexArray:h.icon.globeExtVertexArray);const W=h.lineVertexArray,ie=p?h.text.placedSymbolArray:h.icon.placedSymbolArray,ee=l.transform.width/l.transform.height;let he,we=!1;for(let ve=0;ve<ie.length;ve++){const Pe=ie.get(ve),{numGlyphs:He,writingMode:qe}=Pe;if(qe!==o.WritingMode.vertical||we||he===o.WritingMode.horizontal||(we=!0),he=qe,(Pe.hidden||qe===o.WritingMode.vertical)&&!we){nr(He,J);continue}we=!1;const Le=new o.pointGeometry(Pe.tileAnchorX,Pe.tileAnchorY);let{x:It,y:Ue,z:st}=L.projection.projectTilePoint(Le.x,Le.y,R.canonical);if(M){const[ln,Jt,mn]=M(Le);It+=ln,Ue+=Jt,st+=mn}const Xe=[It,Ue,st,1];if(o.transformMat4$1(Xe,Xe,r),!Fn(Xe,K)){nr(He,J);continue}const Et=jt(l.transform.cameraToCenterDistance,Xe[3]),Je=o.evaluateSizeForFeature(U,G,Pe),pt=T?Je/Et:Je*Et,Pt=br(It,Ue,st,_);if(Pt[3]<=0){nr(He,J);continue}let De={};const We=T?null:M,Qt=kn(Pe,pt,!1,C,r,_,x,h.glyphOffsetArray,W,J,H,Pt,Le,De,ee,We,L.projection,R,T);we=Qt.useVertical,We&&Qt.needsFlipping&&(De={}),(Qt.notEnoughRoom||we||Qt.needsFlipping&&kn(Pe,pt,!0,C,r,_,x,h.glyphOffsetArray,W,J,H,Pt,Le,De,ee,We,L.projection,R,T).notEnoughRoom)&&nr(He,J)}p?(h.text.dynamicLayoutVertexBuffer.updateData(J),H&&h.text.globeExtVertexBuffer.updateData(H)):(h.icon.dynamicLayoutVertexBuffer.updateData(J),H&&h.icon.globeExtVertexBuffer.updateData(H))}function ao(h,r,l,p,_,x,T,C,M,R,L,U,G,Q,K,J){const{lineStartIndex:H,glyphStartIndex:W,segment:ie}=C,ee=W+C.numGlyphs,he=H+C.lineLength,we=r.getoffsetX(W),ve=r.getoffsetX(ee-1),Pe=es(h*we,l,p,_,x,T,ie,H,he,M,R,L,U,G,!0,Q,K,J);if(!Pe)return null;const He=es(h*ve,l,p,_,x,T,ie,H,he,M,R,L,U,G,!0,Q,K,J);return He?{first:Pe,last:He}:null}function Ts(h,r,l,p){return h===o.WritingMode.horizontal&&Math.abs(p)>Math.abs(l)?{useVertical:!0}:h===o.WritingMode.vertical?p>0?{needsFlipping:!0}:null:r!==0&&function(_,x){return _===0||Math.abs(x/_)>hg}(l,p)?r===1?{needsFlipping:!0}:null:l<0?{needsFlipping:!0}:null}function kn(h,r,l,p,_,x,T,C,M,R,L,U,G,Q,K,J,H,W,ie){const ee=r/24,he=h.lineOffsetX*ee,we=h.lineOffsetY*ee,{lineStartIndex:ve,glyphStartIndex:Pe,numGlyphs:He,segment:qe,writingMode:Le,flipState:It}=h,Ue=ve+h.lineLength,st=Xe=>{if(L){const[Pt,De,We]=Xe.up,Qt=R.length;o.updateGlobeVertexNormal(L,Qt+0,Pt,De,We),o.updateGlobeVertexNormal(L,Qt+1,Pt,De,We),o.updateGlobeVertexNormal(L,Qt+2,Pt,De,We),o.updateGlobeVertexNormal(L,Qt+3,Pt,De,We)}const[Et,Je,pt]=Xe.point;o.addDynamicAttributes(R,Et,Je,pt,Xe.angle)};if(He>1){const Xe=ao(ee,C,he,we,l,U,G,h,M,x,Q,J,!1,H,W,ie);if(!Xe)return{notEnoughRoom:!0};if(p&&!l){let[Et,Je,pt]=Xe.first.point,[Pt,De,We]=Xe.last.point;[Et,Je]=br(Et,Je,pt,T),[Pt,De]=br(Pt,De,We,T);const Qt=Ts(Le,It,(Pt-Et)*K,De-Je);if(h.flipState=Qt&&Qt.needsFlipping?1:2,Qt)return Qt}st(Xe.first);for(let Et=Pe+1;Et<Pe+He-1;Et++){const Je=es(ee*C.getoffsetX(Et),he,we,l,U,G,qe,ve,Ue,M,x,Q,J,!1,!1,H,W,ie);if(!Je)return R.length-=4*(Et-Pe),{notEnoughRoom:!0};st(Je)}st(Xe.last)}else{if(p&&!l){const Et=br(G.x,G.y,0,_),Je=ve+qe+1,pt=new o.pointGeometry(M.getx(Je),M.gety(Je)),Pt=br(pt.x,pt.y,0,_),De=Pt[3]>0?Pt:na(G,pt,Et,1,_,void 0,H,W.canonical),We=Ts(Le,It,(De[0]-Et[0])*K,De[1]-Et[1]);if(h.flipState=We&&We.needsFlipping?1:2,We)return We}const Xe=es(ee*C.getoffsetX(Pe),he,we,l,U,G,qe,ve,Ue,M,x,Q,J,!1,!1,H,W,ie);if(!Xe)return{notEnoughRoom:!0};st(Xe)}return{}}function Ha(h,r,l,p,_){const{x,y:T,z:C}=p.projectTilePoint(h.x,h.y,r);if(!_)return br(x,T,C,l);const[M,R,L]=_(h);return br(x+M,T+R,C+L,l)}function na(h,r,l,p,_,x,T,C){const M=Ha(h.sub(r)._unit()._add(h),C,_,T,x);return o.sub(M,l,M),o.normalize(M,M),o.scaleAndAdd(M,l,M,p)}function es(h,r,l,p,_,x,T,C,M,R,L,U,G,Q,K,J,H,W){const ie=p?h-r:h+r;let ee=ie>0?1:-1,he=0;p&&(ee*=-1,he=Math.PI),ee<0&&(he+=Math.PI);let we=C+T+(ee>0?0:1)|0,ve=_,Pe=_,He=0,qe=0;const Le=Math.abs(ie),It=[],Ue=[];let st=x,Xe=st;const Et=()=>na(Xe,st,Pe,Le-He+1,L,G,J,H.canonical);for(;He+qe<=Le;){if(we+=ee,we<C||we>=M)return null;if(Pe=ve,Xe=st,It.push(Pe),Q&&Ue.push(Xe),st=new o.pointGeometry(R.getx(we),R.gety(we)),ve=U[we],!ve){const mn=Ha(st,H.canonical,L,J,G);ve=mn[3]>0?U[we]=mn:Et()}He+=qe,qe=o.distance(Pe,ve)}K&&G&&(U[we]&&(ve=Et(),qe=o.distance(Pe,ve)),U[we]=ve);const Je=(Le-He)/qe,pt=st.sub(Xe)._mult(Je)._add(Xe),Pt=o.sub([],ve,Pe),De=o.scaleAndAdd([],Pe,Pt,Je);let We=[0,0,1],Qt=Pt[0],ln=Pt[1];if(W&&(We=J.upVector(H.canonical,pt.x,pt.y),We[0]!==0||We[1]!==0||We[2]!==1)){const mn=[We[2],0,-We[0]],Tn=o.cross([],We,mn);o.normalize(mn,mn),o.normalize(Tn,Tn),Qt=o.dot(Pt,mn),ln=o.dot(Pt,Tn)}if(l){const mn=o.cross([],We,Pt);o.normalize(mn,mn),o.scaleAndAdd(De,De,mn,l*ee)}const Jt=he+Math.atan2(ln,Qt);return It.push(De),Q&&Ue.push(pt),{point:De,angle:Jt,path:It,tilePath:Ue,up:We}}function nr(h,r){const l=r.length,p=l+4*h;r.resize(p),r.float32.fill(-1/0,4*l,4*p)}function Ti(h,r,l){const p=r[0],_=r[1];return h[0]=l[0]*p+l[4]*_+l[12],h[1]=l[1]*p+l[5]*_+l[13],h[3]=l[3]*p+l[7]*_+l[15],h}const po=100;class Wa{constructor(r,l,p=new Do(r.width+200,r.height+200,25),_=new Do(r.width+200,r.height+200,25)){this.transform=r,this.grid=p,this.ignoredGrid=_,this.pitchfactor=Math.cos(r._pitch)*r.cameraToCenterDistance,this.screenRightBoundary=r.width+po,this.screenBottomBoundary=r.height+po,this.gridRightBoundary=r.width+200,this.gridBottomBoundary=r.height+200,this.fogState=l}placeCollisionBox(r,l,p,_,x,T,C,M){let R=p.projectedAnchorX,L=p.projectedAnchorY,U=p.projectedAnchorZ;const G=p.elevation,Q=p.tileID,K=r.getProjection();if(G&&Q){const[ve,Pe,He]=K.upVector(Q.canonical,p.tileAnchorX,p.tileAnchorY),qe=K.upVectorScale(Q.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;R+=ve*G*qe,L+=Pe*G*qe,U+=He*G*qe}const J=this.projectAndGetPerspectiveRatio(C,R,L,U,p.tileID,K.name==="globe"||!!G||this.transform.pitch>0,K),H=T*J.perspectiveRatio,W=(p.x1*l+_.x-p.padding)*H+J.point.x,ie=(p.y1*l+_.y-p.padding)*H+J.point.y,ee=(p.x2*l+_.x+p.padding)*H+J.point.x,he=(p.y2*l+_.y+p.padding)*H+J.point.y,we=J.perspectiveRatio<=.55||J.occluded;return!this.isInsideGrid(W,ie,ee,he)||!x&&this.grid.hitTest(W,ie,ee,he,M)||we?{box:[],offscreen:!1,occluded:J.occluded}:{box:[W,ie,ee,he],offscreen:this.isOffscreen(W,ie,ee,he),occluded:!1}}placeCollisionCircles(r,l,p,_,x,T,C,M,R,L,U,G,Q,K,J){const H=[],W=this.transform.elevation,ie=r.getProjection(),ee=W?W.getAtTileOffsetFunc(J,this.transform.center.lat,this.transform.worldSize,ie):null,he=new o.pointGeometry(p.tileAnchorX,p.tileAnchorY);let{x:we,y:ve,z:Pe}=ie.projectTilePoint(he.x,he.y,J.canonical);if(ee){const[pt,Pt,De]=ee(he);we+=pt,ve+=Pt,Pe+=De}const He=ie.name==="globe",qe=this.projectAndGetPerspectiveRatio(C,we,ve,Pe,J,He||!!W||this.transform.pitch>0,ie),{perspectiveRatio:Le}=qe,It=(U?T/Le:T*Le)/o.ONE_EM,Ue=br(we,ve,Pe,M),st=qe.signedDistanceFromCamera>0?ao(It,x,p.lineOffsetX*It,p.lineOffsetY*It,!1,Ue,he,p,_,M,{},W&&!U?ee:null,U&&!!W,ie,J,U):null;let Xe=!1,Et=!1,Je=!0;if(st&&!qe.occluded){const pt=.5*Q*Le+K,Pt=new o.pointGeometry(-100,-100),De=new o.pointGeometry(this.screenRightBoundary,this.screenBottomBoundary),We=new Gi,{first:Qt,last:ln}=st,Jt=Qt.path.length;let mn=[];for(let Gt=Jt-1;Gt>=1;Gt--)mn.push(Qt.path[Gt]);for(let Gt=1;Gt<ln.path.length;Gt++)mn.push(ln.path[Gt]);const Tn=2.5*pt;R&&(mn=mn.map(([Gt,ei,Hn],li)=>(ee&&!He&&(Hn=ee(li<Jt-1?Qt.tilePath[Jt-1-li]:ln.tilePath[li-Jt+2])[2]),br(Gt,ei,Hn,R))),mn.some(Gt=>Gt[3]<=0)&&(mn=[]));let cn=[];if(mn.length>0){let Gt=1/0,ei=-1/0,Hn=1/0,li=-1/0;for(const ii of mn)Gt=Math.min(Gt,ii[0]),Hn=Math.min(Hn,ii[1]),ei=Math.max(ei,ii[0]),li=Math.max(li,ii[1]);ei>=Pt.x&&Gt<=De.x&&li>=Pt.y&&Hn<=De.y&&(cn=[mn.map(ii=>new o.pointGeometry(ii[0],ii[1]))],(Gt<Pt.x||ei>De.x||Hn<Pt.y||li>De.y)&&(cn=o.clipLine(cn,Pt.x,Pt.y,De.x,De.y)))}for(const Gt of cn){We.reset(Gt,.25*pt);let ei=0;ei=We.length<=.5*pt?1:Math.ceil(We.paddedLength/Tn)+1;for(let Hn=0;Hn<ei;Hn++){const li=Hn/Math.max(ei-1,1),ii=We.lerp(li),Pr=ii.x+po,$r=ii.y+po;H.push(Pr,$r,pt,0);const wr=Pr-pt,yo=$r-pt,gi=Pr+pt,ci=$r+pt;if(Je=Je&&this.isOffscreen(wr,yo,gi,ci),Et=Et||this.isInsideGrid(wr,yo,gi,ci),!l&&this.grid.hitTestCircle(Pr,$r,pt,G)&&(Xe=!0,!L))return{circles:[],offscreen:!1,collisionDetected:Xe,occluded:!1}}}}return{circles:!L&&Xe||!Et?[]:H,offscreen:Je,collisionDetected:Xe,occluded:qe.occluded}}queryRenderedSymbols(r){if(r.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const l=[];let p=1/0,_=1/0,x=-1/0,T=-1/0;for(const L of r){const U=new o.pointGeometry(L.x+po,L.y+po);p=Math.min(p,U.x),_=Math.min(_,U.y),x=Math.max(x,U.x),T=Math.max(T,U.y),l.push(U)}const C=this.grid.query(p,_,x,T).concat(this.ignoredGrid.query(p,_,x,T)),M={},R={};for(const L of C){const U=L.key;if(M[U.bucketInstanceId]===void 0&&(M[U.bucketInstanceId]={}),M[U.bucketInstanceId][U.featureIndex])continue;const G=[new o.pointGeometry(L.x1,L.y1),new o.pointGeometry(L.x2,L.y1),new o.pointGeometry(L.x2,L.y2),new o.pointGeometry(L.x1,L.y2)];o.polygonIntersectsPolygon(l,G)&&(M[U.bucketInstanceId][U.featureIndex]=!0,R[U.bucketInstanceId]===void 0&&(R[U.bucketInstanceId]=[]),R[U.bucketInstanceId].push(U.featureIndex))}return R}insertCollisionBox(r,l,p,_,x){(l?this.ignoredGrid:this.grid).insert({bucketInstanceId:p,featureIndex:_,collisionGroupID:x},r[0],r[1],r[2],r[3])}insertCollisionCircles(r,l,p,_,x){const T=l?this.ignoredGrid:this.grid,C={bucketInstanceId:p,featureIndex:_,collisionGroupID:x};for(let M=0;M<r.length;M+=4)T.insertCircle(C,r[M],r[M+1],r[M+2])}projectAndGetPerspectiveRatio(r,l,p,_,x,T,C){const M=[l,p,_,1];let R=!1;if(_||this.transform.pitch>0){o.transformMat4$1(M,M,r);const U=C.name==="globe";this.fogState&&x&&!U&&(R=function(Q,K,J,H,W,ie){const ee=ie.calculateFogTileMatrix(W),he=[K,J,H];return o.transformMat4(he,he,ee),At(Q,he,ie.pitch,ie._fov)}(this.fogState,l,p,_,x.toUnwrapped(),this.transform)>.9)}else Ti(M,M,r);const L=M[3];return{point:new o.pointGeometry((M[0]/L+1)/2*this.transform.width+po,(-M[1]/L+1)/2*this.transform.height+po),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(C)/L*.5,1.5),signedDistanceFromCamera:L,occluded:T&&M[2]>L||R}}isOffscreen(r,l,p,_){return p<po||r>=this.screenRightBoundary||_<po||l>this.screenBottomBoundary}isInsideGrid(r,l,p,_){return p>=0&&r<this.gridRightBoundary&&_>=0&&l<this.gridBottomBoundary}getViewportMatrix(){const r=o.identity([]);return o.translate(r,r,[-100,-100,0]),r}}function Xa(h,r,l){const p=r.createTileMatrix(h,h.worldSize,l.toUnwrapped());return o.multiply(new Float32Array(16),h.projMatrix,p)}function Ka(h,r,l){if(r.projection.name===l.projection.name)return h.projMatrix;const p=l.clone();return p.setProjection(r.projection),Xa(p,r.getProjection(),h)}function Ya(h,r,l){return r.name===l.projection.name?h.projMatrix:Xa(l,r,h)}class qu{constructor(r,l,p,_){this.opacity=r?Math.max(0,Math.min(1,r.opacity+(r.placed?l:-l))):_&&p?1:0,this.placed=p}isHidden(){return this.opacity===0&&!this.placed}}class ts{constructor(r,l,p,_,x,T=!1){this.text=new qu(r?r.text:null,l,p,x),this.icon=new qu(r?r.icon:null,l,_,x),this.clipped=T}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Qa{constructor(r,l,p,_=!1){this.text=r,this.icon=l,this.skipFade=p,this.clipped=_}}class rc{constructor(){this.invProjMatrix=o.create(),this.viewportMatrix=o.create(),this.circles=[]}}class ju{constructor(r,l,p,_,x){this.bucketInstanceId=r,this.featureIndex=l,this.sourceLayerIndex=p,this.bucketIndex=_,this.tileID=x}}class Ir{constructor(r){this.crossSourceCollisions=r,this.maxGroupID=0,this.collisionGroups={}}get(r){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[r]){const l=++this.maxGroupID;this.collisionGroups[r]={ID:l,predicate:p=>p.collisionGroupID===l}}return this.collisionGroups[r]}}function ki(h,r,l,p,_){const{horizontalAlign:x,verticalAlign:T}=o.getAnchorAlignment(h),C=-(x-.5)*r,M=-(T-.5)*l,R=o.evaluateVariableOffset(h,p);return new o.pointGeometry(C+R[0]*_,M+R[1]*_)}function Ja(h,r,l,p,_){const x=new o.pointGeometry(h,r);return l&&x._rotate(p?_:-_),x}class $u{constructor(r,l,p,_,x){this.transform=r.clone(),this.projection=r.projection.name,this.collisionIndex=new Wa(this.transform,x),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=l,this.retainedQueryData={},this.collisionGroups=new Ir(p),this.collisionCircleArrays={},this.prevPlacement=_,_&&(_.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(r,l,p,_){const x=p.getBucket(l),T=p.latestFeatureIndex;if(!x||!T||l.id!==x.layerIds[0])return;const C=x.layers[0].layout,M=p.collisionBoxArray,R=Math.pow(2,this.transform.zoom-p.tileID.overscaledZ),L=p.tileSize/o.EXTENT,U=p.tileID.toUnwrapped();this.transform.setProjection(x.projection);const G=(Q=p.tileID,K=x.getProjection(),J=this.transform,K.name===this.projection?J.calculateProjMatrix(Q.toUnwrapped()):Xa(J,K,Q));var Q,K,J;const H=C.get("text-pitch-alignment")==="map",W=C.get("text-rotation-alignment")==="map";l.compileFilter();const ie=l.dynamicFilter(),ee=l.dynamicFilterNeedsFeature(),he=this.transform.calculatePixelsToTileUnitsMatrix(p),we=ic(G,p.tileID.canonical,H,W,this.transform,x.getProjection(),he);let ve=null;if(H){const qe=jd(G,p.tileID.canonical,H,W,this.transform,x.getProjection(),he);ve=o.multiply([],this.transform.labelPlaneMatrix,qe)}let Pe=null;ie&&p.latestFeatureIndex&&(Pe={unwrappedTileID:U,dynamicFilter:ie,dynamicFilterNeedsFeature:ee,featureIndex:p.latestFeatureIndex}),this.retainedQueryData[x.bucketInstanceId]=new ju(x.bucketInstanceId,T,x.sourceLayerIndex,x.index,p.tileID);const He={bucket:x,layout:C,posMatrix:G,textLabelPlaneMatrix:we,labelToScreenMatrix:ve,clippingData:Pe,scale:R,textPixelRatio:L,holdingForFade:p.holdingForFade(),collisionBoxArray:M,partiallyEvaluatedTextSize:o.evaluateSizeForZoom(x.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:o.evaluateSizeForZoom(x.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(x.sourceID)};if(_)for(const qe of x.sortKeyRanges){const{sortKey:Le,symbolInstanceStart:It,symbolInstanceEnd:Ue}=qe;r.push({sortKey:Le,symbolInstanceStart:It,symbolInstanceEnd:Ue,parameters:He})}else r.push({symbolInstanceStart:0,symbolInstanceEnd:x.symbolInstances.length,parameters:He})}attemptAnchorPlacement(r,l,p,_,x,T,C,M,R,L,U,G,Q,K,J,H,W,ie){const{textOffset0:ee,textOffset1:he,crossTileID:we}=G,ve=[ee,he],Pe=ki(r,p,_,ve,x),He=this.collisionIndex.placeCollisionBox(K,x,l,Ja(Pe.x,Pe.y,T,C,this.transform.angle),U,M,R,L.predicate);if(H){const qe=K.getSymbolInstanceIconSize(ie,this.transform.zoom,G.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(K,qe,H,Ja(Pe.x,Pe.y,T,C,this.transform.angle),U,M,R,L.predicate).box.length===0)return}if(He.box.length>0){let qe;return this.prevPlacement&&this.prevPlacement.variableOffsets[we]&&this.prevPlacement.placements[we]&&this.prevPlacement.placements[we].text&&(qe=this.prevPlacement.variableOffsets[we].anchor),this.variableOffsets[we]={textOffset:ve,width:p,height:_,anchor:r,textScale:x,prevAnchor:qe},this.markUsedJustification(K,r,G,J),K.allowVerticalPlacement&&(this.markUsedOrientation(K,J,G),this.placedOrientations[we]=J),{shift:Pe,placedGlyphBoxes:He}}}placeLayerBucketPart(r,l,p,_){const{bucket:x,layout:T,posMatrix:C,textLabelPlaneMatrix:M,labelToScreenMatrix:R,clippingData:L,textPixelRatio:U,holdingForFade:G,collisionBoxArray:Q,partiallyEvaluatedTextSize:K,partiallyEvaluatedIconSize:J,collisionGroup:H}=r.parameters,W=T.get("text-optional"),ie=T.get("icon-optional"),ee=T.get("text-allow-overlap"),he=T.get("icon-allow-overlap"),we=T.get("text-rotation-alignment")==="map",ve=T.get("text-pitch-alignment")==="map",Pe=T.get("icon-text-fit")!=="none",He=T.get("symbol-z-order")==="viewport-y";this.transform.setProjection(x.projection);let qe=ee&&(he||!x.hasIconData()||ie),Le=he&&(ee||!x.hasTextData()||W);!x.collisionArrays&&Q&&x.deserializeCollisionBoxes(Q),p&&_&&x.updateCollisionDebugBuffers(this.transform.zoom,Q);const It=(Ue,st,Xe)=>{const{crossTileID:Et,numVerticalGlyphVertices:Je}=Ue;if(L){const gi={zoom:this.transform.zoom,pitch:this.transform.pitch};let ci=null;if(L.dynamicFilterNeedsFeature){const Gn=this.retainedQueryData[x.bucketInstanceId];ci=L.featureIndex.loadFeature({featureIndex:Ue.featureIndex,bucketIndex:Gn.bucketIndex,sourceLayerIndex:Gn.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,L.dynamicFilter)(gi,ci,this.retainedQueryData[x.bucketInstanceId].tileID.canonical,new o.pointGeometry(Ue.tileAnchorX,Ue.tileAnchorY),this.transform.calculateDistanceTileData(L.unwrappedTileID)))return this.placements[Et]=new Qa(!1,!1,!1,!0),void(l[Et]=!0)}if(l[Et])return;if(G)return void(this.placements[Et]=new Qa(!1,!1,!1));let pt=!1,Pt=!1,De=!0,We=!1,Qt=!1,ln=null,Jt={box:null,offscreen:null,occluded:null},mn={box:null,offscreen:null,occluded:null},Tn=null,cn=null,Gt=null,ei=0,Hn=0,li=0;Xe.textFeatureIndex?ei=Xe.textFeatureIndex:Ue.useRuntimeCollisionCircles&&(ei=Ue.featureIndex),Xe.verticalTextFeatureIndex&&(Hn=Xe.verticalTextFeatureIndex);const ii=gi=>{gi.tileID=this.retainedQueryData[x.bucketInstanceId].tileID;const ci=this.transform.elevation;(ci||gi.elevation)&&(gi.elevation=ci?ci.getAtTileOffset(gi.tileID,gi.tileAnchorX,gi.tileAnchorY):0)},Pr=Xe.textBox;if(Pr){ii(Pr);const gi=Gn=>{let Ri=o.WritingMode.horizontal;if(x.allowVerticalPlacement&&!Gn&&this.prevPlacement){const fr=this.prevPlacement.placedOrientations[Et];fr&&(this.placedOrientations[Et]=fr,Ri=fr,this.markUsedOrientation(x,Ri,Ue))}return Ri},ci=(Gn,Ri)=>{if(x.allowVerticalPlacement&&Je>0&&Xe.verticalTextBox){for(const fr of x.writingModes)if(fr===o.WritingMode.vertical?(Jt=Ri(),mn=Jt):Jt=Gn(),Jt&&Jt.box&&Jt.box.length)break}else Jt=Gn()};if(T.get("text-variable-anchor")){let Gn=T.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[Et]){const di=this.prevPlacement.variableOffsets[Et];Gn.indexOf(di.anchor)>0&&(Gn=Gn.filter(Er=>Er!==di.anchor),Gn.unshift(di.anchor))}const Ri=(di,Er,bl)=>{const No=x.getSymbolInstanceTextSize(K,Ue,this.transform.zoom,st),pr=(di.x2-di.x1)*No+2*di.padding,Kr=(di.y2-di.y1)*No+2*di.padding,vo=Pe&&!he?Er:null;vo&&ii(vo);let xo={box:[],offscreen:!1,occluded:!1};const wl=ee?2*Gn.length:Gn.length;for(let _a=0;_a<wl;++_a){const bo=this.attemptAnchorPlacement(Gn[_a%Gn.length],di,pr,Kr,No,we,ve,U,C,H,_a>=Gn.length,Ue,st,x,bl,vo,K,J);if(bo&&(xo=bo.placedGlyphBoxes,xo&&xo.box&&xo.box.length)){pt=!0,ln=bo.shift;break}}return xo};ci(()=>Ri(Pr,Xe.iconBox,o.WritingMode.horizontal),()=>{const di=Xe.verticalTextBox;return di&&ii(di),x.allowVerticalPlacement&&!(Jt&&Jt.box&&Jt.box.length)&&Je>0&&di?Ri(di,Xe.verticalIconBox,o.WritingMode.vertical):{box:null,offscreen:null,occluded:null}}),Jt&&(pt=Jt.box,De=Jt.offscreen,We=Jt.occluded);const fr=gi(Jt&&Jt.box);if(!pt&&this.prevPlacement){const di=this.prevPlacement.variableOffsets[Et];di&&(this.variableOffsets[Et]=di,this.markUsedJustification(x,di.anchor,Ue,fr))}}else{const Gn=(Ri,fr)=>{const di=x.getSymbolInstanceTextSize(K,Ue,this.transform.zoom,st),Er=this.collisionIndex.placeCollisionBox(x,di,Ri,new o.pointGeometry(0,0),ee,U,C,H.predicate);return Er&&Er.box&&Er.box.length&&(this.markUsedOrientation(x,fr,Ue),this.placedOrientations[Et]=fr),Er};ci(()=>Gn(Pr,o.WritingMode.horizontal),()=>{const Ri=Xe.verticalTextBox;return x.allowVerticalPlacement&&Je>0&&Ri?(ii(Ri),Gn(Ri,o.WritingMode.vertical)):{box:null,offscreen:null,occluded:null}}),gi(Jt&&Jt.box&&Jt.box.length)}}if(Tn=Jt,pt=Tn&&Tn.box&&Tn.box.length>0,De=Tn&&Tn.offscreen,We=Tn&&Tn.occluded,Ue.useRuntimeCollisionCircles){const gi=x.text.placedSymbolArray.get(Ue.centerJustifiedTextSymbolIndex>=0?Ue.centerJustifiedTextSymbolIndex:Ue.verticalPlacedTextSymbolIndex),ci=o.evaluateSizeForFeature(x.textSizeData,K,gi),Gn=T.get("text-padding");cn=this.collisionIndex.placeCollisionCircles(x,ee,gi,x.lineVertexArray,x.glyphOffsetArray,ci,C,M,R,p,ve,H.predicate,Ue.collisionCircleDiameter*ci/o.ONE_EM,Gn,this.retainedQueryData[x.bucketInstanceId].tileID),pt=ee||cn.circles.length>0&&!cn.collisionDetected,De=De&&cn.offscreen,We=cn.occluded}if(Xe.iconFeatureIndex&&(li=Xe.iconFeatureIndex),Xe.iconBox){const gi=ci=>{ii(ci);const Gn=Pe&&ln?Ja(ln.x,ln.y,we,ve,this.transform.angle):new o.pointGeometry(0,0),Ri=x.getSymbolInstanceIconSize(J,this.transform.zoom,Ue.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(x,Ri,ci,Gn,he,U,C,H.predicate)};mn&&mn.box&&mn.box.length&&Xe.verticalIconBox?(Gt=gi(Xe.verticalIconBox),Pt=Gt.box.length>0):(Gt=gi(Xe.iconBox),Pt=Gt.box.length>0),De=De&&Gt.offscreen,Qt=Gt.occluded}const $r=W||Ue.numHorizontalGlyphVertices===0&&Je===0,wr=ie||Ue.numIconVertices===0;if($r||wr?wr?$r||(Pt=Pt&&pt):pt=Pt&&pt:Pt=pt=Pt&&pt,pt&&Tn&&Tn.box&&this.collisionIndex.insertCollisionBox(Tn.box,T.get("text-ignore-placement"),x.bucketInstanceId,mn&&mn.box&&Hn?Hn:ei,H.ID),Pt&&Gt&&this.collisionIndex.insertCollisionBox(Gt.box,T.get("icon-ignore-placement"),x.bucketInstanceId,li,H.ID),cn&&(pt&&this.collisionIndex.insertCollisionCircles(cn.circles,T.get("text-ignore-placement"),x.bucketInstanceId,ei,H.ID),p)){const gi=x.bucketInstanceId;let ci=this.collisionCircleArrays[gi];ci===void 0&&(ci=this.collisionCircleArrays[gi]=new rc);for(let Gn=0;Gn<cn.circles.length;Gn+=4)ci.circles.push(cn.circles[Gn+0]),ci.circles.push(cn.circles[Gn+1]),ci.circles.push(cn.circles[Gn+2]),ci.circles.push(cn.collisionDetected?1:0)}const yo=x.projection.name!=="globe";qe=qe&&(yo||!We),Le=Le&&(yo||!Qt),this.placements[Et]=new Qa(pt||qe,Pt||Le,De||x.justReloaded),l[Et]=!0};if(He){const Ue=x.getSortedSymbolIndexes(this.transform.angle);for(let st=Ue.length-1;st>=0;--st){const Xe=Ue[st];It(x.symbolInstances.get(Xe),Xe,x.collisionArrays[Xe])}}else for(let Ue=r.symbolInstanceStart;Ue<r.symbolInstanceEnd;Ue++)It(x.symbolInstances.get(Ue),Ue,x.collisionArrays[Ue]);if(p&&x.bucketInstanceId in this.collisionCircleArrays){const Ue=this.collisionCircleArrays[x.bucketInstanceId];o.invert(Ue.invProjMatrix,C),Ue.viewportMatrix=this.collisionIndex.getViewportMatrix()}x.justReloaded=!1}markUsedJustification(r,l,p,_){const{leftJustifiedTextSymbolIndex:x,centerJustifiedTextSymbolIndex:T,rightJustifiedTextSymbolIndex:C,verticalPlacedTextSymbolIndex:M,crossTileID:R}=p,L=o.getAnchorJustification(l),U=_===o.WritingMode.vertical?M:L==="left"?x:L==="center"?T:L==="right"?C:-1;x>=0&&(r.text.placedSymbolArray.get(x).crossTileID=U>=0&&x!==U?0:R),T>=0&&(r.text.placedSymbolArray.get(T).crossTileID=U>=0&&T!==U?0:R),C>=0&&(r.text.placedSymbolArray.get(C).crossTileID=U>=0&&C!==U?0:R),M>=0&&(r.text.placedSymbolArray.get(M).crossTileID=U>=0&&M!==U?0:R)}markUsedOrientation(r,l,p){const _=l===o.WritingMode.horizontal||l===o.WritingMode.horizontalOnly?l:0,x=l===o.WritingMode.vertical?l:0,{leftJustifiedTextSymbolIndex:T,centerJustifiedTextSymbolIndex:C,rightJustifiedTextSymbolIndex:M,verticalPlacedTextSymbolIndex:R}=p,L=r.text.placedSymbolArray;T>=0&&(L.get(T).placedOrientation=_),C>=0&&(L.get(C).placedOrientation=_),M>=0&&(L.get(M).placedOrientation=_),R>=0&&(L.get(R).placedOrientation=x)}commit(r){this.commitTime=r,this.zoomAtLastRecencyCheck=this.transform.zoom;const l=this.prevPlacement;let p=!1;this.prevZoomAdjustment=l?l.zoomAdjustment(this.transform.zoom):0;const _=l?l.symbolFadeChange(r):1,x=l?l.opacities:{},T=l?l.variableOffsets:{},C=l?l.placedOrientations:{};for(const M in this.placements){const R=this.placements[M],L=x[M];L?(this.opacities[M]=new ts(L,_,R.text,R.icon,null,R.clipped),p=p||R.text!==L.text.placed||R.icon!==L.icon.placed):(this.opacities[M]=new ts(null,_,R.text,R.icon,R.skipFade,R.clipped),p=p||R.text||R.icon)}for(const M in x){const R=x[M];if(!this.opacities[M]){const L=new ts(R,_,!1,!1);L.isHidden()||(this.opacities[M]=L,p=p||R.text.placed||R.icon.placed)}}for(const M in T)this.variableOffsets[M]||!this.opacities[M]||this.opacities[M].isHidden()||(this.variableOffsets[M]=T[M]);for(const M in C)this.placedOrientations[M]||!this.opacities[M]||this.opacities[M].isHidden()||(this.placedOrientations[M]=C[M]);p?this.lastPlacementChangeTime=r:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=l?l.lastPlacementChangeTime:r)}updateLayerOpacities(r,l){const p={};for(const _ of l){const x=_.getBucket(r);x&&_.latestFeatureIndex&&r.id===x.layerIds[0]&&this.updateBucketOpacities(x,p,_.collisionBoxArray)}}updateBucketOpacities(r,l,p){r.hasTextData()&&r.text.opacityVertexArray.clear(),r.hasIconData()&&r.icon.opacityVertexArray.clear(),r.hasIconCollisionBoxData()&&r.iconCollisionBox.collisionVertexArray.clear(),r.hasTextCollisionBoxData()&&r.textCollisionBox.collisionVertexArray.clear();const _=r.layers[0].layout,x=!!r.layers[0].dynamicFilter(),T=new ts(null,0,!1,!1,!0),C=_.get("text-allow-overlap"),M=_.get("icon-allow-overlap"),R=_.get("text-variable-anchor"),L=_.get("text-rotation-alignment")==="map",U=_.get("text-pitch-alignment")==="map",G=_.get("icon-text-fit")!=="none",Q=new ts(null,0,C&&(M||!r.hasIconData()||_.get("icon-optional")),M&&(C||!r.hasTextData()||_.get("text-optional")),!0);!r.collisionArrays&&p&&(r.hasIconCollisionBoxData()||r.hasTextCollisionBoxData())&&r.deserializeCollisionBoxes(p);const K=(H,W,ie)=>{for(let ee=0;ee<W/4;ee++)H.opacityVertexArray.emplaceBack(ie)};let J=0;for(let H=0;H<r.symbolInstances.length;H++){const W=r.symbolInstances.get(H),{numHorizontalGlyphVertices:ie,numVerticalGlyphVertices:ee,crossTileID:he,numIconVertices:we}=W;let ve=this.opacities[he];l[he]?ve=T:ve||(ve=Q,this.opacities[he]=ve),l[he]=!0;const Pe=ie>0||ee>0,He=we>0,qe=this.placedOrientations[he],Le=qe===o.WritingMode.vertical,It=qe===o.WritingMode.horizontal||qe===o.WritingMode.horizontalOnly;if(!Pe&&!He||ve.isHidden()||J++,Pe){const Ue=Ji(ve.text);K(r.text,ie,Le?ia:Ue),K(r.text,ee,It?ia:Ue);const st=ve.text.isHidden(),{leftJustifiedTextSymbolIndex:Xe,centerJustifiedTextSymbolIndex:Et,rightJustifiedTextSymbolIndex:Je,verticalPlacedTextSymbolIndex:pt}=W,Pt=r.text.placedSymbolArray,De=st||Le?1:0;Xe>=0&&(Pt.get(Xe).hidden=De),Et>=0&&(Pt.get(Et).hidden=De),Je>=0&&(Pt.get(Je).hidden=De),pt>=0&&(Pt.get(pt).hidden=st||It?1:0);const We=this.variableOffsets[he];We&&this.markUsedJustification(r,We.anchor,W,qe);const Qt=this.placedOrientations[he];Qt&&(this.markUsedJustification(r,"left",W,Qt),this.markUsedOrientation(r,Qt,W))}if(He){const Ue=Ji(ve.icon),{placedIconSymbolIndex:st,verticalPlacedIconSymbolIndex:Xe}=W,Et=r.icon.placedSymbolArray,Je=ve.icon.isHidden()?1:0;st>=0&&(K(r.icon,we,Le?ia:Ue),Et.get(st).hidden=Je),Xe>=0&&(K(r.icon,W.numVerticalIconVertices,It?ia:Ue),Et.get(Xe).hidden=Je)}if(r.hasIconCollisionBoxData()||r.hasTextCollisionBoxData()){const Ue=r.collisionArrays[H];if(Ue){let st=new o.pointGeometry(0,0),Xe=!0;if(Ue.textBox||Ue.verticalTextBox){if(R){const Je=this.variableOffsets[he];Je?(st=ki(Je.anchor,Je.width,Je.height,Je.textOffset,Je.textScale),L&&st._rotate(U?this.transform.angle:-this.transform.angle)):Xe=!1}x&&(Xe=!ve.clipped),Ue.textBox&&ir(r.textCollisionBox.collisionVertexArray,ve.text.placed,!Xe||Le,st.x,st.y),Ue.verticalTextBox&&ir(r.textCollisionBox.collisionVertexArray,ve.text.placed,!Xe||It,st.x,st.y)}const Et=Xe&&Boolean(!It&&Ue.verticalIconBox);Ue.iconBox&&ir(r.iconCollisionBox.collisionVertexArray,ve.icon.placed,Et,G?st.x:0,G?st.y:0),Ue.verticalIconBox&&ir(r.iconCollisionBox.collisionVertexArray,ve.icon.placed,!Et,G?st.x:0,G?st.y:0)}}}if(r.fullyClipped=J===0,r.sortFeatures(this.transform.angle),this.retainedQueryData[r.bucketInstanceId]&&(this.retainedQueryData[r.bucketInstanceId].featureSortOrder=r.featureSortOrder),r.hasTextData()&&r.text.opacityVertexBuffer&&r.text.opacityVertexBuffer.updateData(r.text.opacityVertexArray),r.hasIconData()&&r.icon.opacityVertexBuffer&&r.icon.opacityVertexBuffer.updateData(r.icon.opacityVertexArray),r.hasIconCollisionBoxData()&&r.iconCollisionBox.collisionVertexBuffer&&r.iconCollisionBox.collisionVertexBuffer.updateData(r.iconCollisionBox.collisionVertexArray),r.hasTextCollisionBoxData()&&r.textCollisionBox.collisionVertexBuffer&&r.textCollisionBox.collisionVertexBuffer.updateData(r.textCollisionBox.collisionVertexArray),r.bucketInstanceId in this.collisionCircleArrays){const H=this.collisionCircleArrays[r.bucketInstanceId];r.placementInvProjMatrix=H.invProjMatrix,r.placementViewportMatrix=H.viewportMatrix,r.collisionCircleArray=H.circles,delete this.collisionCircleArrays[r.bucketInstanceId]}}symbolFadeChange(r){return this.fadeDuration===0?1:(r-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(r){return Math.max(0,(this.transform.zoom-r)/1.5)}hasTransitions(r){return this.stale||r-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(r,l){const p=this.zoomAtLastRecencyCheck===l?1-this.zoomAdjustment(l):1;return this.zoomAtLastRecencyCheck=l,this.commitTime+this.fadeDuration*p>r}setStale(){this.stale=!0}}function ir(h,r,l,p,_){h.emplaceBack(r?1:0,l?1:0,p||0,_||0),h.emplaceBack(r?1:0,l?1:0,p||0,_||0),h.emplaceBack(r?1:0,l?1:0,p||0,_||0),h.emplaceBack(r?1:0,l?1:0,p||0,_||0)}const Wr=Math.pow(2,25),$d=Math.pow(2,24),oc=Math.pow(2,17),Zi=Math.pow(2,16),el=Math.pow(2,9),Gu=Math.pow(2,8),tl=Math.pow(2,1);function Ji(h){if(h.opacity===0&&!h.placed)return 0;if(h.opacity===1&&h.placed)return 4294967295;const r=h.placed?1:0,l=Math.floor(127*h.opacity);return l*Wr+r*$d+l*oc+r*Zi+l*el+r*Gu+l*tl+r}const ia=0;class Zu{constructor(r){this._sortAcrossTiles=r.layout.get("symbol-z-order")!=="viewport-y"&&r.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(r,l,p,_,x){const T=this._bucketParts;for(;this._currentTileIndex<r.length;)if(l.getBucketParts(T,_,r[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,x())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,T.sort((C,M)=>C.sortKey-M.sortKey));this._currentPartIndex<T.length;){const C=T[this._currentPartIndex];if(l.placeLayerBucketPart(C,this._seenCrossTileIDs,p,C.symbolInstanceStart===0),this._currentPartIndex++,x())return!0}return!1}}class Oo{constructor(r,l,p,_,x,T,C,M){this.placement=new $u(r,x,T,C,M),this._currentPlacementIndex=l.length-1,this._forceFullPlacement=p,this._showCollisionBoxes=_,this._done=!1}isDone(){return this._done}continuePlacement(r,l,p){const _=o.exported.now(),x=()=>{const T=o.exported.now()-_;return!this._forceFullPlacement&&T>2};for(;this._currentPlacementIndex>=0;){const T=l[r[this._currentPlacementIndex]],C=this.placement.collisionIndex.transform.zoom;if(T.type==="symbol"&&(!T.minzoom||T.minzoom<=C)&&(!T.maxzoom||T.maxzoom>C)){if(this._inProgressLayer||(this._inProgressLayer=new Zu(T)),this._inProgressLayer.continuePlacement(p[T.source],this.placement,this._showCollisionBoxes,T,x))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(r){return this.placement.commit(r),this.placement}}const nl=512/o.EXTENT/2;class sc{constructor(r,l,p){this.tileID=r,this.indexedSymbolInstances={},this.bucketInstanceId=p;for(let _=0;_<l.length;_++){const x=l.get(_),T=x.key;this.indexedSymbolInstances[T]||(this.indexedSymbolInstances[T]=[]),this.indexedSymbolInstances[T].push({crossTileID:x.crossTileID,coord:this.getScaledCoordinates(x,r)})}}getScaledCoordinates(r,l){const p=nl/Math.pow(2,l.canonical.z-this.tileID.canonical.z);return{x:Math.floor((l.canonical.x*o.EXTENT+r.tileAnchorX)*p),y:Math.floor((l.canonical.y*o.EXTENT+r.tileAnchorY)*p)}}findMatches(r,l,p){const _=this.tileID.canonical.z<l.canonical.z?1:Math.pow(2,this.tileID.canonical.z-l.canonical.z);for(let x=0;x<r.length;x++){const T=r.get(x);if(T.crossTileID)continue;const C=this.indexedSymbolInstances[T.key];if(!C)continue;const M=this.getScaledCoordinates(T,l);for(const R of C)if(Math.abs(R.coord.x-M.x)<=_&&Math.abs(R.coord.y-M.y)<=_&&!p[R.crossTileID]){p[R.crossTileID]=!0,T.crossTileID=R.crossTileID;break}}}}class dg{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Hu{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(r){const l=Math.round((r-this.lng)/360);if(l!==0)for(const p in this.indexes){const _=this.indexes[p],x={};for(const T in _){const C=_[T];C.tileID=C.tileID.unwrapTo(C.tileID.wrap+l),x[C.tileID.key]=C}this.indexes[p]=x}this.lng=r}addBucket(r,l,p){if(this.indexes[r.overscaledZ]&&this.indexes[r.overscaledZ][r.key]){if(this.indexes[r.overscaledZ][r.key].bucketInstanceId===l.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(r.overscaledZ,this.indexes[r.overscaledZ][r.key])}for(let x=0;x<l.symbolInstances.length;x++)l.symbolInstances.get(x).crossTileID=0;this.usedCrossTileIDs[r.overscaledZ]||(this.usedCrossTileIDs[r.overscaledZ]={});const _=this.usedCrossTileIDs[r.overscaledZ];for(const x in this.indexes){const T=this.indexes[x];if(Number(x)>r.overscaledZ)for(const C in T){const M=T[C];M.tileID.isChildOf(r)&&M.findMatches(l.symbolInstances,r,_)}else{const C=T[r.scaledTo(Number(x)).key];C&&C.findMatches(l.symbolInstances,r,_)}}for(let x=0;x<l.symbolInstances.length;x++){const T=l.symbolInstances.get(x);T.crossTileID||(T.crossTileID=p.generate(),_[T.crossTileID]=!0)}return this.indexes[r.overscaledZ]===void 0&&(this.indexes[r.overscaledZ]={}),this.indexes[r.overscaledZ][r.key]=new sc(r,l.symbolInstances,l.bucketInstanceId),!0}removeBucketCrossTileIDs(r,l){for(const p in l.indexedSymbolInstances)for(const _ of l.indexedSymbolInstances[p])delete this.usedCrossTileIDs[r][_.crossTileID]}removeStaleBuckets(r){let l=!1;for(const p in this.indexes){const _=this.indexes[p];for(const x in _)r[_[x].bucketInstanceId]||(this.removeBucketCrossTileIDs(p,_[x]),delete _[x],l=!0)}return l}}class Ss{constructor(){this.layerIndexes={},this.crossTileIDs=new dg,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(r,l,p,_){let x=this.layerIndexes[r.id];x===void 0&&(x=this.layerIndexes[r.id]=new Hu);let T=!1;const C={};_.name!=="globe"&&x.handleWrapJump(p);for(const M of l){const R=M.getBucket(r);R&&r.id===R.layerIds[0]&&(R.bucketInstanceId||(R.bucketInstanceId=++this.maxBucketInstanceId),x.addBucket(M.tileID,R,this.crossTileIDs)&&(T=!0),C[R.bucketInstanceId]=!0)}return x.removeStaleBuckets(C)&&(T=!0),T}pruneUnusedLayers(r){const l={};r.forEach(p=>{l[p]=!0});for(const p in this.layerIndexes)l[p]||delete this.layerIndexes[p]}}const ac=(h,r)=>o.emitValidationErrors(h,r&&r.filter(l=>l.identifier!=="source.canvas")),Gd=o.pick(at,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection"]),ra=o.pick(at,["setCenter","setZoom","setBearing","setPitch"]),ns={version:8,layers:[],sources:{}},lc={fill:!0,line:!0,background:!0,hillshade:!0,raster:!0};class rr extends o.Evented{constructor(r,l={}){super(),this.map=r,this.dispatcher=new qt(fn(),this),this.imageManager=new Be,this.imageManager.setEventedParent(this),this.glyphManager=new o.GlyphManager(r._requestManager,l.localFontFamily?o.LocalGlyphMode.all:l.localIdeographFontFamily?o.LocalGlyphMode.ideographs:o.LocalGlyphMode.none,l.localFontFamily||l.localIdeographFontFamily),this.crossTileSymbolIndex=new Ss,this._layers={},this._num3DLayers=0,this._numSymbolLayers=0,this._numCircleLayers=0,this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._availableImages=[],this._order=[],this._drapedFirstOrder=[],this._markersNeedUpdate=!1,this._resetUpdates(),this.dispatcher.broadcast("setReferrer",o.getReferrer());const p=this;this._rtlTextPluginCallback=rr.registerForPluginStateChange(_=>{p.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:_.pluginStatus,pluginURL:_.pluginURL},(x,T)=>{if(o.triggerPluginCompletionEvent(x),T&&T.every(C=>C))for(const C in p._sourceCaches){const M=p._sourceCaches[C],R=M.getSource().type;R!=="vector"&&R!=="geojson"||M.reload()}})}),this.on("data",_=>{if(_.dataType!=="source"||_.sourceDataType!=="metadata")return;const x=this.getSource(_.sourceId);if(x&&x.vectorLayerIds)for(const T in this._layers){const C=this._layers[T];C.source===x.id&&this._validateLayer(C)}})}loadURL(r,l={}){this.fire(new o.Event("dataloading",{dataType:"style"}));const p=typeof l.validate=="boolean"?l.validate:!o.isMapboxURL(r);r=this.map._requestManager.normalizeStyleURL(r,l.accessToken);const _=this.map._requestManager.transformRequest(r,o.ResourceType.Style);this._request=o.getJSON(_,(x,T)=>{this._request=null,x?this.fire(new o.ErrorEvent(x)):T&&this._load(T,p)})}loadJSON(r,l={}){this.fire(new o.Event("dataloading",{dataType:"style"})),this._request=o.exported.frame(()=>{this._request=null,this._load(r,l.validate!==!1)})}loadEmpty(){this.fire(new o.Event("dataloading",{dataType:"style"})),this._load(ns,!1)}_updateLayerCount(r,l){const p=l?1:-1;r.is3D()&&(this._num3DLayers+=p),r.type==="circle"&&(this._numCircleLayers+=p),r.type==="symbol"&&(this._numSymbolLayers+=p)}_load(r,l){if(l&&ac(this,o.validateStyle(r)))return;this._loaded=!0,this.stylesheet=o.clone$1(r),this._updateMapProjection();for(const _ in r.sources)this.addSource(_,r.sources[_],{validate:!1});this._changed=!1,r.sprite?this._loadSprite(r.sprite):(this.imageManager.setLoaded(!0),this.dispatcher.broadcast("spriteLoaded",!0)),this.glyphManager.setURL(r.glyphs);const p=Lt(this.stylesheet.layers);this._order=p.map(_=>_.id),this._layers={},this._serializedLayers={};for(let _ of p)_=o.createStyleLayer(_),_.setEventedParent(this,{layer:{id:_.id}}),this._layers[_.id]=_,this._serializedLayers[_.id]=_.serialize(),this._updateLayerCount(_,!0);this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new Ye(this.stylesheet.light),this.stylesheet.terrain&&!this.terrainSetForDrapingOnly()&&this._createTerrain(this.stylesheet.terrain,1),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this._updateDrapeFirstLayers(),this.fire(new o.Event("data",{dataType:"style"})),this.fire(new o.Event("style.load"))}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}setProjection(r){r?this.stylesheet.projection=r:delete this.stylesheet.projection,this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?this.getTerrain()||this.stylesheet.terrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null))}_updateMapProjection(){this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.stylesheet.projection)}_loadSprite(r){this._spriteRequest=function(l,p,_){let x,T,C;const M=o.exported.devicePixelRatio>1?"@2x":"";let R=o.getJSON(p.transformRequest(p.normalizeSpriteURL(l,M,".json"),o.ResourceType.SpriteJSON),(G,Q)=>{R=null,C||(C=G,x=Q,U())}),L=o.getImage(p.transformRequest(p.normalizeSpriteURL(l,M,".png"),o.ResourceType.SpriteImage),(G,Q)=>{L=null,C||(C=G,T=Q,U())});function U(){if(C)_(C);else if(x&&T){const G=o.exported.getImageData(T),Q={};for(const K in x){const{width:J,height:H,x:W,y:ie,sdf:ee,pixelRatio:he,stretchX:we,stretchY:ve,content:Pe}=x[K],He=new o.RGBAImage({width:J,height:H});o.RGBAImage.copy(G,He,{x:W,y:ie},{x:0,y:0},{width:J,height:H}),Q[K]={data:He,pixelRatio:he,sdf:ee,stretchX:we,stretchY:ve,content:Pe}}_(null,Q)}}return{cancel(){R&&(R.cancel(),R=null),L&&(L.cancel(),L=null)}}}(r,this.map._requestManager,(l,p)=>{if(this._spriteRequest=null,l)this.fire(new o.ErrorEvent(l));else if(p)for(const _ in p)this.imageManager.addImage(_,p[_]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.dispatcher.broadcast("spriteLoaded",!0),this.fire(new o.Event("data",{dataType:"style"}))})}_validateLayer(r){const l=this.getSource(r.source);if(!l)return;const p=r.sourceLayer;p&&(l.type==="geojson"||l.vectorLayerIds&&l.vectorLayerIds.indexOf(p)===-1)&&this.fire(new o.ErrorEvent(new Error(`Source layer "${p}" does not exist on source "${l.id}" as specified by style layer "${r.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const r in this._sourceCaches)if(!this._sourceCaches[r].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(r){const l=[];for(const p of r){const _=this._layers[p];_.type!=="custom"&&l.push(_.serialize())}return l}hasTransitions(){if(this.light&&this.light.hasTransition()||this.fog&&this.fog.hasTransition())return!0;for(const r in this._sourceCaches)if(this._sourceCaches[r].hasTransition())return!0;for(const r in this._layers)if(this._layers[r].hasTransition())return!0;return!1}get order(){return this.map._optimizeForTerrain&&this.terrain?this._drapedFirstOrder:this._order}isLayerDraped(r){return!!this.terrain&&lc[r.type]}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}update(r){if(!this._loaded)return;const l=this._changed;if(this._changed){const _=Object.keys(this._updatedLayers),x=Object.keys(this._removedLayers);(_.length||x.length)&&this._updateWorkerLayers(_,x);for(const T in this._updatedSources){const C=this._updatedSources[T];C==="reload"?this._reloadSource(T):C==="clear"&&this._clearSource(T)}this._updateTilesForChangedImages();for(const T in this._updatedPaintProps)this._layers[T].updateTransitions(r);this.light.updateTransitions(r),this.fog&&this.fog.updateTransitions(r),this._resetUpdates()}const p={};for(const _ in this._sourceCaches){const x=this._sourceCaches[_];p[_]=x.used,x.used=!1}for(const _ of this._order){const x=this._layers[_];if(x.recalculate(r,this._availableImages),!x.isHidden(r.zoom)){const C=this._getLayerSourceCache(x);C&&(C.used=!0)}const T=this.map.painter;if(T){const C=x.getProgramIds();if(!C)continue;const M=x.getProgramConfiguration(r.zoom);for(const R of C)T.useProgram(R,M)}}for(const _ in p){const x=this._sourceCaches[_];p[_]!==x.used&&x.getSource().fire(new o.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:x.getSource().id}))}this.light.recalculate(r),this.terrain&&this.terrain.recalculate(r),this.fog&&this.fog.recalculate(r),this.z=r.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),l&&this.fire(new o.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const r=Object.keys(this._changedImages);if(r.length){for(const l in this._sourceCaches)this._sourceCaches[l].reloadTilesForDependencies(["icons","patterns"],r);this._changedImages={}}}_updateWorkerLayers(r,l){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(r),removedIds:l})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setState(r){if(this._checkLoaded(),ac(this,o.validateStyle(r)))return!1;(r=o.clone$1(r)).layers=Lt(r.layers);const l=function(_,x){if(!_)return[{command:at.setStyle,args:[x]}];let T=[];try{if(!S(_.version,x.version))return[{command:at.setStyle,args:[x]}];S(_.center,x.center)||T.push({command:at.setCenter,args:[x.center]}),S(_.zoom,x.zoom)||T.push({command:at.setZoom,args:[x.zoom]}),S(_.bearing,x.bearing)||T.push({command:at.setBearing,args:[x.bearing]}),S(_.pitch,x.pitch)||T.push({command:at.setPitch,args:[x.pitch]}),S(_.sprite,x.sprite)||T.push({command:at.setSprite,args:[x.sprite]}),S(_.glyphs,x.glyphs)||T.push({command:at.setGlyphs,args:[x.glyphs]}),S(_.transition,x.transition)||T.push({command:at.setTransition,args:[x.transition]}),S(_.light,x.light)||T.push({command:at.setLight,args:[x.light]}),S(_.fog,x.fog)||T.push({command:at.setFog,args:[x.fog]}),S(_.projection,x.projection)||T.push({command:at.setProjection,args:[x.projection]});const C={},M=[];(function(U,G,Q,K){let J;for(J in G=G||{},U=U||{})U.hasOwnProperty(J)&&(G.hasOwnProperty(J)||yn(J,Q,K));for(J in G)G.hasOwnProperty(J)&&(U.hasOwnProperty(J)?S(U[J],G[J])||(U[J].type==="geojson"&&G[J].type==="geojson"&&ai(U,G,J)?Q.push({command:at.setGeoJSONSourceData,args:[J,G[J].data]}):Bn(J,G,Q,K)):Yt(J,G,Q))})(_.sources,x.sources,M,C);const R=[];_.layers&&_.layers.forEach(U=>{U.source&&C[U.source]?T.push({command:at.removeLayer,args:[U.id]}):R.push(U)});let L=_.terrain;L&&C[L.source]&&(T.push({command:at.setTerrain,args:[void 0]}),L=void 0),T=T.concat(M),S(L,x.terrain)||T.push({command:at.setTerrain,args:[x.terrain]}),function(U,G,Q){G=G||[];const K=(U=U||[]).map(tt),J=G.map(tt),H=U.reduce(Ro,{}),W=G.reduce(Ro,{}),ie=K.slice(),ee=Object.create(null);let he,we,ve,Pe,He,qe,Le;for(he=0,we=0;he<K.length;he++)ve=K[he],W.hasOwnProperty(ve)?we++:(Q.push({command:at.removeLayer,args:[ve]}),ie.splice(ie.indexOf(ve,we),1));for(he=0,we=0;he<J.length;he++)ve=J[J.length-1-he],ie[ie.length-1-he]!==ve&&(H.hasOwnProperty(ve)?(Q.push({command:at.removeLayer,args:[ve]}),ie.splice(ie.lastIndexOf(ve,ie.length-we),1)):we++,qe=ie[ie.length-he],Q.push({command:at.addLayer,args:[W[ve],qe]}),ie.splice(ie.length-he,0,ve),ee[ve]=!0);for(he=0;he<J.length;he++)if(ve=J[he],Pe=H[ve],He=W[ve],!ee[ve]&&!S(Pe,He))if(S(Pe.source,He.source)&&S(Pe["source-layer"],He["source-layer"])&&S(Pe.type,He.type)){for(Le in mi(Pe.layout,He.layout,Q,ve,null,at.setLayoutProperty),mi(Pe.paint,He.paint,Q,ve,null,at.setPaintProperty),S(Pe.filter,He.filter)||Q.push({command:at.setFilter,args:[ve,He.filter]}),S(Pe.minzoom,He.minzoom)&&S(Pe.maxzoom,He.maxzoom)||Q.push({command:at.setLayerZoomRange,args:[ve,He.minzoom,He.maxzoom]}),Pe)Pe.hasOwnProperty(Le)&&Le!=="layout"&&Le!=="paint"&&Le!=="filter"&&Le!=="metadata"&&Le!=="minzoom"&&Le!=="maxzoom"&&(Le.indexOf("paint.")===0?mi(Pe[Le],He[Le],Q,ve,Le.slice(6),at.setPaintProperty):S(Pe[Le],He[Le])||Q.push({command:at.setLayerProperty,args:[ve,Le,He[Le]]}));for(Le in He)He.hasOwnProperty(Le)&&!Pe.hasOwnProperty(Le)&&Le!=="layout"&&Le!=="paint"&&Le!=="filter"&&Le!=="metadata"&&Le!=="minzoom"&&Le!=="maxzoom"&&(Le.indexOf("paint.")===0?mi(Pe[Le],He[Le],Q,ve,Le.slice(6),at.setPaintProperty):S(Pe[Le],He[Le])||Q.push({command:at.setLayerProperty,args:[ve,Le,He[Le]]}))}else Q.push({command:at.removeLayer,args:[ve]}),qe=ie[ie.lastIndexOf(ve)+1],Q.push({command:at.addLayer,args:[He,qe]})}(R,x.layers,T)}catch(C){console.warn("Unable to compute style diff:",C),T=[{command:at.setStyle,args:[x]}]}return T}(this.serialize(),r).filter(_=>!(_.command in ra));if(l.length===0)return!1;const p=l.filter(_=>!(_.command in Gd));if(p.length>0)throw new Error(`Unimplemented: ${p.map(_=>_.command).join(", ")}.`);return l.forEach(_=>{_.command!=="setTransition"&&_.command!=="setProjection"&&this[_.command].apply(this,_.args)}),this.stylesheet=r,this._updateMapProjection(),!0}addImage(r,l){return this.getImage(r)?this.fire(new o.ErrorEvent(new Error("An image with this name already exists."))):(this.imageManager.addImage(r,l),this._afterImageUpdated(r),this)}updateImage(r,l){this.imageManager.updateImage(r,l)}getImage(r){return this.imageManager.getImage(r)}removeImage(r){return this.getImage(r)?(this.imageManager.removeImage(r),this._afterImageUpdated(r),this):this.fire(new o.ErrorEvent(new Error("No image with this name exists.")))}_afterImageUpdated(r){this._availableImages=this.imageManager.listImages(),this._changedImages[r]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new o.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addSource(r,l,p={}){if(this._checkLoaded(),this.getSource(r)!==void 0)throw new Error("There is already a source with this ID");if(!l.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(l).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(l.type)>=0&&this._validate(o.validateSource,`sources.${r}`,l,null,p))return;this.map&&this.map._collectResourceTiming&&(l.collectResourceTiming=!0);const _=ze(r,l,this.dispatcher,this);_.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(r),source:_.serialize(),sourceId:r}));const x=T=>{const C=(T?"symbol:":"other:")+r,M=this._sourceCaches[C]=new o.SourceCache(C,_,T);(T?this._symbolSourceCaches:this._otherSourceCaches)[r]=M,M.style=this,M.onAdd(this.map)};x(!1),l.type!=="vector"&&l.type!=="geojson"||x(!0),_.onAdd&&_.onAdd(this.map),this._changed=!0}removeSource(r){this._checkLoaded();const l=this.getSource(r);if(!l)throw new Error("There is no source with this ID");for(const _ in this._layers)if(this._layers[_].source===r)return this.fire(new o.ErrorEvent(new Error(`Source "${r}" cannot be removed while layer "${_}" is using it.`)));if(this.terrain&&this.terrain.get().source===r)return this.fire(new o.ErrorEvent(new Error(`Source "${r}" cannot be removed while terrain is using it.`)));const p=this._getSourceCaches(r);for(const _ of p)delete this._sourceCaches[_.id],delete this._updatedSources[_.id],_.fire(new o.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:_.getSource().id})),_.setEventedParent(null),_.clearTiles();return delete this._otherSourceCaches[r],delete this._symbolSourceCaches[r],l.setEventedParent(null),l.onRemove&&l.onRemove(this.map),this._changed=!0,this}setGeoJSONSourceData(r,l){this._checkLoaded(),this.getSource(r).setData(l),this._changed=!0}getSource(r){const l=this._getSourceCache(r);return l&&l.getSource()}_getSources(){const r=[];for(const l in this._otherSourceCaches){const p=this._getSourceCache(l);p&&r.push(p.getSource())}return r}addLayer(r,l,p={}){this._checkLoaded();const _=r.id;if(this.getLayer(_))return void this.fire(new o.ErrorEvent(new Error(`Layer with id "${_}" already exists on this map`)));let x;if(r.type==="custom"){if(ac(this,o.validateCustomStyleLayer(r)))return;x=o.createStyleLayer(r)}else{if(typeof r.source=="object"&&(this.addSource(_,r.source),r=o.clone$1(r),r=o.extend(r,{source:_})),this._validate(o.validateLayer,`layers.${_}`,r,{arrayIndex:-1},p))return;x=o.createStyleLayer(r),this._validateLayer(x),x.setEventedParent(this,{layer:{id:_}}),this._serializedLayers[x.id]=x.serialize(),this._updateLayerCount(x,!0)}const T=l?this._order.indexOf(l):this._order.length;if(l&&T===-1)return void this.fire(new o.ErrorEvent(new Error(`Layer with id "${l}" does not exist on this map.`)));this._order.splice(T,0,_),this._layerOrderChanged=!0,this._layers[_]=x;const C=this._getLayerSourceCache(x);if(this._removedLayers[_]&&x.source&&C&&x.type!=="custom"){const M=this._removedLayers[_];delete this._removedLayers[_],M.type!==x.type?this._updatedSources[x.source]="clear":(this._updatedSources[x.source]="reload",C.pause())}this._updateLayer(x),x.onAdd&&x.onAdd(this.map),this._updateDrapeFirstLayers()}moveLayer(r,l){if(this._checkLoaded(),this._changed=!0,!this._layers[r])return void this.fire(new o.ErrorEvent(new Error(`The layer '${r}' does not exist in the map's style and cannot be moved.`)));if(r===l)return;const p=this._order.indexOf(r);this._order.splice(p,1);const _=l?this._order.indexOf(l):this._order.length;l&&_===-1?this.fire(new o.ErrorEvent(new Error(`Layer with id "${l}" does not exist on this map.`))):(this._order.splice(_,0,r),this._layerOrderChanged=!0,this._updateDrapeFirstLayers())}removeLayer(r){this._checkLoaded();const l=this._layers[r];if(!l)return void this.fire(new o.ErrorEvent(new Error(`The layer '${r}' does not exist in the map's style and cannot be removed.`)));l.setEventedParent(null),this._updateLayerCount(l,!1);const p=this._order.indexOf(r);this._order.splice(p,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[r]=l,delete this._layers[r],delete this._serializedLayers[r],delete this._updatedLayers[r],delete this._updatedPaintProps[r],l.onRemove&&l.onRemove(this.map),this._updateDrapeFirstLayers()}getLayer(r){return this._layers[r]}hasLayer(r){return r in this._layers}hasLayerType(r){for(const l in this._layers)if(this._layers[l].type===r)return!0;return!1}setLayerZoomRange(r,l,p){this._checkLoaded();const _=this.getLayer(r);_?_.minzoom===l&&_.maxzoom===p||(l!=null&&(_.minzoom=l),p!=null&&(_.maxzoom=p),this._updateLayer(_)):this.fire(new o.ErrorEvent(new Error(`The layer '${r}' does not exist in the map's style and cannot have zoom extent.`)))}setFilter(r,l,p={}){this._checkLoaded();const _=this.getLayer(r);if(_){if(!S(_.filter,l))return l==null?(_.filter=void 0,void this._updateLayer(_)):void(this._validate(o.validateFilter,`layers.${_.id}.filter`,l,{layerType:_.type},p)||(_.filter=o.clone$1(l),this._updateLayer(_)))}else this.fire(new o.ErrorEvent(new Error(`The layer '${r}' does not exist in the map's style and cannot be filtered.`)))}getFilter(r){const l=this.getLayer(r);return l&&o.clone$1(l.filter)}setLayoutProperty(r,l,p,_={}){this._checkLoaded();const x=this.getLayer(r);x?S(x.getLayoutProperty(l),p)||(x.setLayoutProperty(l,p,_),this._updateLayer(x)):this.fire(new o.ErrorEvent(new Error(`The layer '${r}' does not exist in the map's style and cannot be styled.`)))}getLayoutProperty(r,l){const p=this.getLayer(r);if(p)return p.getLayoutProperty(l);this.fire(new o.ErrorEvent(new Error(`The layer '${r}' does not exist in the map's style.`)))}setPaintProperty(r,l,p,_={}){this._checkLoaded();const x=this.getLayer(r);x?S(x.getPaintProperty(l),p)||(x.setPaintProperty(l,p,_)&&this._updateLayer(x),this._changed=!0,this._updatedPaintProps[r]=!0):this.fire(new o.ErrorEvent(new Error(`The layer '${r}' does not exist in the map's style and cannot be styled.`)))}getPaintProperty(r,l){const p=this.getLayer(r);return p&&p.getPaintProperty(l)}setFeatureState(r,l){this._checkLoaded();const p=r.source,_=r.sourceLayer,x=this.getSource(p);if(!x)return void this.fire(new o.ErrorEvent(new Error(`The source '${p}' does not exist in the map's style.`)));const T=x.type;if(T==="geojson"&&_)return void this.fire(new o.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(T==="vector"&&!_)return void this.fire(new o.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));r.id===void 0&&this.fire(new o.ErrorEvent(new Error("The feature id parameter must be provided.")));const C=this._getSourceCaches(p);for(const M of C)M.setFeatureState(_,r.id,l)}removeFeatureState(r,l){this._checkLoaded();const p=r.source,_=this.getSource(p);if(!_)return void this.fire(new o.ErrorEvent(new Error(`The source '${p}' does not exist in the map's style.`)));const x=_.type,T=x==="vector"?r.sourceLayer:void 0;if(x==="vector"&&!T)return void this.fire(new o.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));if(l&&typeof r.id!="string"&&typeof r.id!="number")return void this.fire(new o.ErrorEvent(new Error("A feature id is required to remove its specific state property.")));const C=this._getSourceCaches(p);for(const M of C)M.removeFeatureState(T,r.id,l)}getFeatureState(r){this._checkLoaded();const l=r.source,p=r.sourceLayer,_=this.getSource(l);if(_){if(_.type!=="vector"||p)return r.id===void 0&&this.fire(new o.ErrorEvent(new Error("The feature id parameter must be provided."))),this._getSourceCaches(l)[0].getFeatureState(p,r.id);this.fire(new o.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new o.ErrorEvent(new Error(`The source '${l}' does not exist in the map's style.`)))}getTransition(){return o.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){const r={};for(const l in this._sourceCaches){const p=this._sourceCaches[l].getSource();r[p.id]||(r[p.id]=p.serialize())}return o.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,terrain:this.getTerrain()||void 0,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:r,layers:this._serializeLayers(this._order)},l=>l!==void 0)}_updateLayer(r){this._updatedLayers[r.id]=!0;const l=this._getLayerSourceCache(r);r.source&&!this._updatedSources[r.source]&&l&&l.getSource().type!=="raster"&&(this._updatedSources[r.source]="reload",l.pause()),this._changed=!0,r.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(r){const l=T=>this._layers[T].type==="fill-extrusion",p={},_=[];for(let T=this._order.length-1;T>=0;T--){const C=this._order[T];if(l(C)){p[C]=T;for(const M of r){const R=M[C];if(R)for(const L of R)_.push(L)}}}_.sort((T,C)=>C.intersectionZ-T.intersectionZ);const x=[];for(let T=this._order.length-1;T>=0;T--){const C=this._order[T];if(l(C))for(let M=_.length-1;M>=0;M--){const R=_[M].feature;if(p[R.layer.id]<T)break;x.push(R),_.pop()}else for(const M of r){const R=M[C];if(R)for(const L of R)x.push(L.feature)}}return x}queryRenderedFeatures(r,l,p){l&&l.filter&&this._validate(o.validateFilter,"queryRenderedFeatures.filter",l.filter,null,l);const _={};if(l&&l.layers){if(!Array.isArray(l.layers))return this.fire(new o.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const M of l.layers){const R=this._layers[M];if(!R)return this.fire(new o.ErrorEvent(new Error(`The layer '${M}' does not exist in the map's style and cannot be queried for features.`))),[];_[R.source]=!0}}const x=[];l.availableImages=this._availableImages;const T=l&&l.layers?l.layers.some(M=>{const R=this.getLayer(M);return R&&R.is3D()}):this.has3DLayers(),C=rt.createFromScreenPoints(r,p);for(const M in this._sourceCaches){const R=this._sourceCaches[M].getSource().id;l.layers&&!_[R]||x.push(Ne(this._sourceCaches[M],this._layers,this._serializedLayers,C,l,p,T,!!this.map._showQueryGeometry))}return this.placement&&x.push(function(M,R,L,U,G,Q,K){const J={},H=Q.queryRenderedSymbols(U),W=[];for(const ie of Object.keys(H).map(Number))W.push(K[ie]);W.sort(Ft);for(const ie of W){const ee=ie.featureIndex.lookupSymbolFeatures(H[ie.bucketInstanceId],R,ie.bucketIndex,ie.sourceLayerIndex,G.filter,G.layers,G.availableImages,M);for(const he in ee){const we=J[he]=J[he]||[],ve=ee[he];ve.sort((Pe,He)=>{const qe=ie.featureSortOrder;if(qe){const Le=qe.indexOf(Pe.featureIndex);return qe.indexOf(He.featureIndex)-Le}return He.featureIndex-Pe.featureIndex});for(const Pe of ve)we.push(Pe)}}for(const ie in J)J[ie].forEach(ee=>{const he=ee.feature,we=L(M[ie]).getFeatureState(he.layer["source-layer"],he.id);he.source=he.layer.source,he.layer["source-layer"]&&(he.sourceLayer=he.layer["source-layer"]),he.state=we});return J}(this._layers,this._serializedLayers,this._getLayerSourceCache.bind(this),C.screenGeometry,l,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(x)}querySourceFeatures(r,l){l&&l.filter&&this._validate(o.validateFilter,"querySourceFeatures.filter",l.filter,null,l);const p=this._getSourceCaches(r);let _=[];for(const x of p)_=_.concat(ht(x,l));return _}addSourceType(r,l,p){return rr.getSourceType(r)?p(new Error(`A source type called "${r}" already exists.`)):(rr.setSourceType(r,l),l.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:r,url:l.workerSourceURL},p):p(null,null))}getLight(){return this.light.getLight()}setLight(r,l={}){this._checkLoaded();const p=this.light.getLight();let _=!1;for(const T in r)if(!S(r[T],p[T])){_=!0;break}if(!_)return;const x=this._setTransitionParameters({duration:300,delay:0});this.light.setLight(r,l),this.light.updateTransitions(x)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}setTerrain(r,l=1){if(this._checkLoaded(),!r)return delete this.terrain,delete this.stylesheet.terrain,this.dispatcher.broadcast("enableTerrain",!1),this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);if(l===1){if(typeof r.source=="object"){const p="terrain-dem-src";this.addSource(p,r.source),r=o.clone$1(r),r=o.extend(r,{source:p})}if(this._validate(o.validateTerrain,"terrain",r))return}if(!this.terrain||this.terrain&&l!==this.terrain.drapeRenderMode)this._createTerrain(r,l);else{const p=this.terrain,_=p.get();for(const x of Object.keys(o.spec.terrain))!r.hasOwnProperty(x)&&o.spec.terrain[x].default&&(r[x]=o.spec.terrain[x].default);for(const x in r)if(!S(r[x],_[x])){p.set(r),this.stylesheet.terrain=r;const T=this._setTransitionParameters({duration:0});p.updateTransitions(T);break}}this._updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(r){const l=this.fog=new Bt(r,this.map.transform);this.stylesheet.fog=r;const p=this._setTransitionParameters({duration:0});l.updateTransitions(p)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(const r of this.map._markers)r._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(r){if(this._checkLoaded(),!r)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const l=this.fog,p=l.get();Object.keys(r).length===0&&l.set(r);for(const _ in r)if(!S(r[_],p[_])){l.set(r),this.stylesheet.fog=r;const x=this._setTransitionParameters({duration:0});l.updateTransitions(x);break}}else this._createFog(r);this._markersNeedUpdate=!0}_setTransitionParameters(r){return{now:o.exported.now(),transition:o.extend(r,this.stylesheet.transition)}}_updateDrapeFirstLayers(){if(!this.map._optimizeForTerrain||!this.terrain)return;const r=this._order.filter(p=>this.isLayerDraped(this._layers[p])),l=this._order.filter(p=>!this.isLayerDraped(this._layers[p]));this._drapedFirstOrder=[],this._drapedFirstOrder.push(...r),this._drapedFirstOrder.push(...l)}_createTerrain(r,l){const p=this.terrain=new Ge(r,l);this.stylesheet.terrain=r,this.dispatcher.broadcast("enableTerrain",!this.terrainSetForDrapingOnly()),this._force3DLayerUpdate();const _=this._setTransitionParameters({duration:0});p.updateTransitions(_)}_force3DLayerUpdate(){for(const r in this._layers){const l=this._layers[r];l.type==="fill-extrusion"&&this._updateLayer(l)}}_forceSymbolLayerUpdate(){for(const r in this._layers){const l=this._layers[r];l.type==="symbol"&&this._updateLayer(l)}}_validate(r,l,p,_,x={}){return(!x||x.validate!==!1)&&ac(this,r.call(o.validateStyle,o.extend({key:l,style:this.serialize(),value:p,styleSpec:o.spec},_)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),o.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const r in this._layers)this._layers[r].setEventedParent(null);for(const r in this._sourceCaches)this._sourceCaches[r].clearTiles(),this._sourceCaches[r].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(r){const l=this._getSourceCaches(r);for(const p of l)p.clearTiles()}_reloadSource(r){const l=this._getSourceCaches(r);for(const p of l)p.resume(),p.reload()}_reloadSources(){for(const r of this._getSources())r.reload&&r.reload()}_updateSources(r){for(const l in this._sourceCaches)this._sourceCaches[l].update(r)}_generateCollisionBoxes(){for(const r in this._sourceCaches){const l=this._sourceCaches[r];l.resume(),l.reload()}}_updatePlacement(r,l,p,_,x=!1){let T=!1,C=!1;const M={};for(const R of this._order){const L=this._layers[R];if(L.type!=="symbol")continue;if(!M[L.source]){const G=this._getLayerSourceCache(L);if(!G)continue;M[L.source]=G.getRenderableIds(!0).map(Q=>G.getTileByID(Q)).sort((Q,K)=>K.tileID.overscaledZ-Q.tileID.overscaledZ||(Q.tileID.isLessThan(K.tileID)?-1:1))}const U=this.crossTileSymbolIndex.addLayer(L,M[L.source],r.center.lng,r.projection);T=T||U}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),x=x||this._layerOrderChanged||p===0,this._layerOrderChanged&&this.fire(new o.Event("neworder")),(x||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(o.exported.now(),r.zoom))&&(this.pauseablePlacement=new Oo(r,this._order,x,l,p,_,this.placement,this.fog&&r.projection.supportsFog?this.fog.state:null),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,M),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(o.exported.now()),C=!0),T&&this.pauseablePlacement.placement.setStale()),C||T)for(const R of this._order){const L=this._layers[R];L.type==="symbol"&&this.placement.updateLayerOpacities(L,M[L.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(o.exported.now())}_releaseSymbolFadeTiles(){for(const r in this._sourceCaches)this._sourceCaches[r].releaseSymbolFadeTiles()}getImages(r,l,p){this.imageManager.getImages(l.icons,p),this._updateTilesForChangedImages();const _=x=>{x&&x.setDependencies(l.tileID.key,l.type,l.icons)};_(this._otherSourceCaches[l.source]),_(this._symbolSourceCaches[l.source])}getGlyphs(r,l,p){this.glyphManager.getGlyphs(l.stacks,p)}getResource(r,l,p){return o.makeRequest(l,p)}_getSourceCache(r){return this._otherSourceCaches[r]}_getLayerSourceCache(r){return r.type==="symbol"?this._symbolSourceCaches[r.source]:this._otherSourceCaches[r.source]}_getSourceCaches(r){const l=[];return this._otherSourceCaches[r]&&l.push(this._otherSourceCaches[r]),this._symbolSourceCaches[r]&&l.push(this._symbolSourceCaches[r]),l}_isSourceCacheLoaded(r){const l=this._getSourceCaches(r);return l.length===0?(this.fire(new o.ErrorEvent(new Error(`There is no source with ID '${r}'`))),!1):l.every(p=>p.loaded())}has3DLayers(){return this._num3DLayers>0}hasSymbolLayers(){return this._numSymbolLayers>0}hasCircleLayers(){return this._numCircleLayers>0}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}rr.getSourceType=function(h){return Oe[h]},rr.setSourceType=function(h,r){Oe[h]=r},rr.registerForPluginStateChange=o.registerForPluginStateChange;var cc=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#define EXTENT 8192.0
#define HALF_PI PI/2.0
#define QUARTER_PI PI/4.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0`,il="attribute highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;varying highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",Zd=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
#ifdef TERRAIN
#ifdef TERRAIN_DEM_FLOAT_FORMAT
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;
#else
uniform sampler2D u_dem;uniform sampler2D u_dem_prev;
#endif
uniform vec4 u_dem_unpack;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float decodeElevation(vec4 v) {return dot(vec4(v.xyz*255.0,-1.0),u_dem_unpack);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem,pos).a;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem,pos));
#ifdef TERRAIN_DEM_NEAREST_FILTER
return u_exaggeration*tl;
#endif
float tr=decodeElevation(texture2D(u_dem,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem_prev,pos).a;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem_prev,pos));float tr=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem_prev,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture2D(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(
unpack_depth(texture2D(u_depth,uv-df.xz)),unpack_depth(texture2D(u_depth,uv+df.xz)),unpack_depth(texture2D(u_depth,uv-df.zy)),unpack_depth(texture2D(u_depth,uv+df.zy))
);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
float tl=texture2D(u_dem,pos).a;float tr=texture2D(u_dem,pos+vec2(off.x,0.0)).a;float bl=texture2D(u_dem,pos+vec2(0.0,off.y)).a;float br=texture2D(u_dem,pos+off).a;
#else
vec4 demtl=vec4(texture2D(u_dem,pos).xyz*255.0,-1.0);float tl=dot(demtl,u_dem_unpack);vec4 demtr=vec4(texture2D(u_dem,pos+vec2(off.x,0.0)).xyz*255.0,-1.0);float tr=dot(demtr,u_dem_unpack);vec4 dembl=vec4(texture2D(u_dem,pos+vec2(0.0,off.y)).xyz*255.0,-1.0);float bl=dot(dembl,u_dem_unpack);vec4 dembr=vec4(texture2D(u_dem,pos+off).xyz*255.0,-1.0);float br=dot(dembr,u_dem_unpack);
#endif
return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }
#endif`,Hd=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;varying vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,uc=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump float u_fog_temporal_offset;varying vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,opacity);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec3 fog_dither(vec3 color) {vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`;let Wd={},hc={};const rl=[];Cs(cc,rl),Cs(Zd,rl),Cs(Hd,rl),Cs(uc,rl),Wd=Xn("",Zd),hc=Xn(uc,Hd);const Wu=Xn(`
highp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}`,`
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);//Normalized device coordinate that is not rendered.`),Xd=cc,ol=`
#ifdef GL_ES
precision mediump float;
#else

#if !defined(lowp)
#define lowp
#endif

#if !defined(mediump)
#define mediump
#endif

#if !defined(highp)
#define highp
#endif

#endif`;var Xu={background:Xn(`uniform vec4 u_color;uniform float u_opacity;
#ifdef LIGHTING_3D_MODE
varying vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#ifdef LIGHTING_3D_MODE
uniform vec4 u_color;varying vec4 v_color;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting(u_color);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:Xn(`uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos;void main() {vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),circle:Xn(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
gl_FragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:Xn("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Xn(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {gl_FragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:Xn(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:Xn("varying float v_placed;varying float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);gl_FragColor =mix(red,blue,step(0.5,v_placed))*0.5;gl_FragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`attribute vec3 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;attribute float a_size_scale;attribute vec2 a_padding;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*elevation(a_anchor_pos),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:Xn("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}",`attribute vec2 a_pos_2f;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:Xn("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}",`attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;
#endif
varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),fill:Xn(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutline:Xn(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:Xn(`uniform vec2 u_texsize;uniform sampler2D u_image;varying vec2 v_pos;varying vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;varying vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:Xn(`uniform vec2 u_texsize;uniform sampler2D u_image;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:Xn(`varying vec4 v_color;
#ifdef RENDER_SHADOWS
varying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#ifdef ZERO_ROOF_RADIUS
varying vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)
varying highp vec3 v_normal;
#endif
void main() {
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)
vec3 normal=v_normal;
#endif
float z;vec4 color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);color=mix(v_color,v_roof_color,z);
#else
color=v_color;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);color.rgb=color.rgb*shade;
#endif
#ifdef RENDER_SHADOWS
#ifdef ZERO_ROOF_RADIUS
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#endif
color.xyz=shadowed_color_normal(color.xyz,normalize(normal),v_pos_light_view_0,v_pos_light_view_1,v_depth);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
varying vec4 v_color;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;
#endif
#ifdef ZERO_ROOF_RADIUS
varying vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)
varying highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)
v_normal=normal;
#endif
base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele;vec3 pos;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);
#ifdef RENDER_SHADOWS
v_pos_light_view_0=u_light_matrix_0*vec4(pos,1);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1);v_depth=gl_Position.w;
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}v_color=vec4(0.0,0.0,0.0,1.0);
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting(color,NdotL);
#else
v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));
#endif
v_color*=u_opacity;
#ifdef ZERO_ROOF_RADIUS
v_roof_color=vec4(0.0,0.0,0.0,1.0);
#ifdef LIGHTING_3D_MODE
v_roof_color=apply_lighting(color,calculate_NdotL(vec3(0.0,0.0,1.0)));
#else
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));
#endif
v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionPattern:Xn(`uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
varying float v_NdotL;
#endif
varying vec2 v_pos;varying vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,v_NdotL)*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
varying vec2 v_pos;varying vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
varying float v_NdotL;
#endif
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_NdotL=NdotL;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif 
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),hillshadePrepare:Xn(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
return texture2D(u_image,coord).a/4.0;
#else
vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;
#endif
}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Xn(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
gl_FragColor=apply_lighting(gl_FragColor);
#endif
#ifdef FOG
gl_FragColor=fog_dither(fog_apply_premultiplied(gl_FragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:Xn(`uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;varying vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
uniform float u_border_width;uniform vec4 u_border_color;float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist=texture2D(u_dash_image,v_tex).a;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;alpha*=linearstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture2D(u_gradient_image,v_uv.xy);
#else
out_color=color;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
highp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {out_color=vec4(0,0,0,0);}}
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef RENDER_LINE_ALPHA_DISCARD
if (alpha < u_alpha_discard_threshold) {discard;}
#endif
#ifdef RENDER_LINE_BORDER
float edgeBlur=(u_border_width+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);
#ifdef RENDER_LINE_BORDER_AUTO
float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}
#else
out_color.rgb=mix(u_border_color.rgb,out_color.rgb,smoothAlpha);
#endif
}
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define EXTRUDE_SCALE 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
attribute highp vec4 a_packed;
#endif
#ifdef RENDER_LINE_DASH
attribute float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;varying vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);
#else
v_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/floorwidth,(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),linePattern:Xn(`uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;vec2 pattern_size=vec2(display_size.x/u_tile_units_to_pixels,display_size.y);float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x=mod(v_linesofar/pattern_size.x*aspect,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));vec4 color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
color=apply_lighting(color);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),raster:Xn(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply(out_color,v_fog_pos));
#endif
gl_FragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {float w=1.0+dot(a_texture_pos,u_perspective_transform);gl_Position=u_matrix*vec4(a_pos*w,0,w);v_pos0=a_texture_pos/8192.0;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),symbolIcon:Xn(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform vec3 u_up_vector;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjected_point;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetProjected_point=u_matrix*vec4(a_globe_anchor+displacement,1);
#else
offsetProjected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);
#endif
vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#endif
float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;}`),symbolSDF:Xn(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);
#endif
vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#endif
float gamma_scale=gl_Position.w;float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade);}`),symbolTextAndIcon:Xn(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_projected_pos;attribute float a_fade_opacity;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#endif
float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade,is_sdf);}`),terrainRaster:Xn(`uniform sampler2D u_image0;varying vec2 v_pos0;
#ifdef FOG
varying float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
varying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;
#endif
void main() {vec4 color=texture2D(u_image0,v_pos0);
#ifdef RENDER_SHADOWS
color.xyz=shadowed_color(color.xyz,v_pos_light_view_0,v_pos_light_view_1,v_depth);
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
gl_FragColor=color;
#ifdef TERRAIN_WIREFRAME
gl_FragColor=vec4(1.0,0.0,0.0,0.8);
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_skirt_height;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;
#ifdef FOG
varying float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;
#endif
const float skirtOffset=24575.0;const float wireframeOffset=0.00015;void main() {v_pos0=a_texture_pos/8192.0;float skirt=float(a_pos.x >=skirtOffset);float elevation=elevation(a_texture_pos)-skirt*u_skirt_height;
#ifdef TERRAIN_WIREFRAME
elevation+=u_skirt_height*u_skirt_height*wireframeOffset;
#endif
vec2 decodedPos=a_pos-vec2(skirt*skirtOffset,0.0);gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);v_depth=gl_Position.w;
#endif
}`),terrainDepth:Xn(`#ifdef GL_ES
precision highp float;
#endif
varying float v_depth;void main() {gl_FragColor=pack_depth(v_depth);}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying float v_depth;void main() {float elevation=elevation(a_texture_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}"),skybox:Xn(`
varying lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=textureCube(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);gl_FragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,il),skyboxGradient:Xn(`varying highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture2D(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,il),skyboxCapture:Xn(`
varying highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;
#ifdef GL_ES
precision highp float;
#endif
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;gl_FragColor=vec4(color,1.0);}`,"attribute highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;varying highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:Xn(`uniform sampler2D u_image0;varying vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture2D(u_image0,v_pos0);color=vec4(raster.rgb*antialias,raster.a*antialias);
#else
color=texture2D(u_image0,v_pos0);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color;
#ifdef TERRAIN_WIREFRAME
gl_FragColor=vec4(1.0,0.0,0.0,0.8);
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;
#ifdef GLOBE_POLES
attribute vec3 a_globe_pos;attribute vec2 a_uv;
#else
attribute vec2 a_pos;
#endif
varying vec2 v_pos0;const float wireframeOffset=1e3;float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(QUARTER_PI+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 latLng=u_grid_matrix*vec3(a_pos,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;
#ifdef GLOBE_POLES
vec3 up_vector=normalize(globe_pos)*u_tile_up_scale;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);
#ifdef TERRAIN_WIREFRAME
height+=wireframeOffset;
#endif
globe_pos+=up_vector*height;
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:Xn(`uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec3 u_start_color;uniform vec4 u_color;uniform vec4 u_space_color;uniform vec4 u_high_color;uniform float u_star_intensity;uniform float u_star_size;uniform float u_star_density;uniform float u_horizon_angle;uniform mat4 u_rotation_matrix;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;highp float random(highp vec3 p) {p=fract(p*vec3(23.2342,97.1231,91.2342));p+=dot(p.zxy,p.yxz+123.1234);return fract(p.x*p.y);}float stars(vec3 p,float scale,vec2 offset) {vec2 uv_scale=(u_viewport/u_star_size)*scale;vec3 position=vec3(p.xy*uv_scale+offset*u_viewport,p.z);vec3 q=fract(position)-0.5;vec3 id=floor(position);float random_visibility=step(random(id),u_star_density);float circle=smoothstep(0.5+u_star_intensity,0.5,length(q));return circle*random_visibility;}void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {discard;return;}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(dot(dir,horizon_dir)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;float closest_point_to_center=length(closest_point-u_globe_pos);float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c =mix(color_stop_2,c2,t);float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);vec2 uv=gl_FragCoord.xy/u_viewport-0.5;float aspect_ratio=u_viewport.x/u_viewport.y;vec4 uv_dir=vec4(normalize(vec3(uv.x*aspect_ratio,uv.y,1.0)),1.0);uv_dir=u_rotation_matrix*uv_dir;vec3 n=abs(uv_dir.xyz);vec2 uv_remap=(n.x > n.y && n.x > n.z) ? uv_dir.yz/uv_dir.x:
(n.y > n.x && n.y > n.z) ? uv_dir.zx/uv_dir.y:
uv_dir.xy/uv_dir.z;uv_remap.x/=aspect_ratio;vec3 D=vec3(uv_remap,1.0);highp float star_field=0.0;if (u_star_intensity > 0.0) {star_field+=stars(D,1.2,vec2(0.0,0.0));star_field+=stars(D,1.0,vec2(1.0,0.0));star_field+=stars(D,0.8,vec2(0.0,1.0));star_field+=stars(D,0.6,vec2(1.0,1.0));star_field*=(1.0-pow(t,0.25+(1.0-u_high_color.a)*0.75));c+=star_field*alpha_2;}c=dither(c,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=vec4(c,a);}`,`attribute vec3 a_pos;attribute vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`)};function Cs(h,r){const l=h.replace(/\s*\/\/[^\n]*\n/g,`
`).split(`
`);for(let p of l)if(p=p.trim(),p[0]==="#"&&p.includes("if")&&!p.includes("endif")){p=p.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const _=p.split(" ");for(const x of _)r.includes(x)||r.push(x)}}function Xn(h,r){const l=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,p=r.match(/attribute (highp |mediump |lowp )?([\w]+) ([\w]+)/g),_={},x=[...rl];return Cs(h,x),Cs(r,x),{fragmentSource:h=h.replace(l,(T,C,M,R,L)=>(_[L]=!0,C==="define"?`
#ifndef HAS_UNIFORM_u_${L}
varying ${M} ${R} ${L};
#else
uniform ${M} ${R} u_${L};
#endif
`:`
#ifdef HAS_UNIFORM_u_${L}
    ${M} ${R} ${L} = u_${L};
#endif
`)),vertexSource:r=r.replace(l,(T,C,M,R,L)=>{const U=R==="float"?"vec2":"vec4",G=L.match(/color/)?"color":U;return _[L]?C==="define"?`
#ifndef HAS_UNIFORM_u_${L}
uniform lowp float u_${L}_t;
attribute ${M} ${U} a_${L};
varying ${M} ${R} ${L};
#else
uniform ${M} ${R} u_${L};
#endif
`:G==="vec4"?`
#ifndef HAS_UNIFORM_u_${L}
    ${L} = a_${L};
#else
    ${M} ${R} ${L} = u_${L};
#endif
`:`
#ifndef HAS_UNIFORM_u_${L}
    ${L} = unpack_mix_${G}(a_${L}, u_${L}_t);
#else
    ${M} ${R} ${L} = u_${L};
#endif
`:C==="define"?`
#ifndef HAS_UNIFORM_u_${L}
uniform lowp float u_${L}_t;
attribute ${M} ${U} a_${L};
#else
uniform ${M} ${R} u_${L};
#endif
`:G==="vec4"?`
#ifndef HAS_UNIFORM_u_${L}
    ${M} ${R} ${L} = a_${L};
#else
    ${M} ${R} ${L} = u_${L};
#endif
`:`
#ifndef HAS_UNIFORM_u_${L}
    ${M} ${R} ${L} = unpack_mix_${G}(a_${L}, u_${L}_t);
#else
    ${M} ${R} ${L} = u_${L};
#endif
`}),staticAttributes:p,usedDefines:x}}class Kd{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(r,l,p,_,x,T,C){this.context=r;let M=this.boundPaintVertexBuffers.length!==_.length;for(let L=0;!M&&L<_.length;L++)this.boundPaintVertexBuffers[L]!==_[L]&&(M=!0);let R=this.boundDynamicVertexBuffers.length!==C.length;for(let L=0;!R&&L<C.length;L++)this.boundDynamicVertexBuffers[L]!==C[L]&&(R=!0);if(!r.extVertexArrayObject||!this.vao||this.boundProgram!==l||this.boundLayoutVertexBuffer!==p||M||R||this.boundIndexBuffer!==x||this.boundVertexOffset!==T)this.freshBind(l,p,_,x,T,C);else{r.bindVertexArrayOES.set(this.vao);for(const L of C)L&&L.bind();x&&x.dynamicDraw&&x.bind()}}freshBind(r,l,p,_,x,T){let C;const M=r.numAttributes,R=this.context,L=R.gl;if(R.extVertexArrayObject)this.vao&&this.destroy(),this.vao=R.extVertexArrayObject.createVertexArrayOES(),R.bindVertexArrayOES.set(this.vao),C=0,this.boundProgram=r,this.boundLayoutVertexBuffer=l,this.boundPaintVertexBuffers=p,this.boundIndexBuffer=_,this.boundVertexOffset=x,this.boundDynamicVertexBuffers=T;else{C=R.currentNumAttributes||0;for(let U=M;U<C;U++)L.disableVertexAttribArray(U)}l.enableAttributes(L,r),l.bind(),l.setVertexAttribPointers(L,r,x);for(const U of p)U.enableAttributes(L,r),U.bind(),U.setVertexAttribPointers(L,r,x);for(const U of T)U&&(U.enableAttributes(L,r),U.bind(),U.setVertexAttribPointers(L,r,x));_&&_.bind(),R.currentNumAttributes=M}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function sl(h,r){const l=Math.pow(2,r.canonical.z),p=r.canonical.y;return[new o.MercatorCoordinate(0,p/l).toLngLat().lat,new o.MercatorCoordinate(0,(p+1)/l).toLngLat().lat]}function Ku(h,r,l,p,_,x,T){const C=h.context,M=C.gl,R=l.fbo;if(!R)return;h.prepareDrawTile();const L=h.useProgram("hillshade");C.activeTexture.set(M.TEXTURE0),M.bindTexture(M.TEXTURE_2D,R.colorAttachment.get());const U=((J,H,W,ie)=>{const ee=W.paint.get("hillshade-shadow-color"),he=W.paint.get("hillshade-highlight-color"),we=W.paint.get("hillshade-accent-color");let ve=W.paint.get("hillshade-illumination-direction")*(Math.PI/180);W.paint.get("hillshade-illumination-anchor")==="viewport"&&(ve-=J.transform.angle);const Pe=!J.options.moving;return{u_matrix:ie||J.transform.calculateProjMatrix(H.tileID.toUnwrapped(),Pe),u_image:0,u_latrange:sl(0,H.tileID),u_light:[W.paint.get("hillshade-exaggeration"),ve],u_shadow:ee,u_highlight:he,u_accent:we}})(h,l,p,h.terrain?r.projMatrix:null);h.prepareDrawProgram(C,L,r.toUnwrapped());const{tileBoundsBuffer:G,tileBoundsIndexBuffer:Q,tileBoundsSegments:K}=h.getTileBoundsBuffers(l);L.draw(C,M.TRIANGLES,_,x,T,o.CullFaceMode.disabled,U,p.id,G,Q,K)}function oa(h,r,l){if(!r.needsDEMTextureUpload)return;const p=h.context,_=p.gl;p.pixelStoreUnpackPremultiplyAlpha.set(!1),r.demTexture=r.demTexture||h.getTileTexture(l.stride);const x=l.getPixels();r.demTexture?r.demTexture.update(x,{premultiply:!1}):r.demTexture=new o.Texture(p,x,_.RGBA,{premultiply:!1}),r.needsDEMTextureUpload=!1}function dc(h,r,l,p,_,x){const T=h.context,C=T.gl;if(!r.dem)return;const M=r.dem;if(T.activeTexture.set(C.TEXTURE1),oa(h,r,M),!r.demTexture)return;r.demTexture.bind(C.NEAREST,C.CLAMP_TO_EDGE);const R=M.dim;T.activeTexture.set(C.TEXTURE0);let L=r.fbo;if(!L){const K=new o.Texture(T,{width:R,height:R,data:null},C.RGBA);K.bind(C.LINEAR,C.CLAMP_TO_EDGE),L=r.fbo=T.createFramebuffer(R,R,!0),L.colorAttachment.set(K.texture)}T.bindFramebuffer.set(L.framebuffer),T.viewport.set([0,0,R,R]);const{tileBoundsBuffer:U,tileBoundsIndexBuffer:G,tileBoundsSegments:Q}=h.getMercatorTileBoundsBuffers();h.useProgram("hillshadePrepare").draw(T,C.TRIANGLES,p,_,x,o.CullFaceMode.disabled,((K,J)=>{const H=J.stride,W=o.create();return o.ortho(W,0,o.EXTENT,-o.EXTENT,0,0,1),o.translate(W,W,[0,-o.EXTENT,0]),{u_matrix:W,u_image:1,u_dimension:[H,H],u_zoom:K.overscaledZ,u_unpack:J.unpackVector}})(r.tileID,M),l.id,U,G,Q),r.needsHillshadePrepare=!1}const al=h=>({u_matrix:new o.UniformMatrix4f(h),u_image0:new o.Uniform1i(h),u_skirt_height:new o.Uniform1f(h)}),fc=(h,r)=>({u_matrix:h,u_image0:0,u_skirt_height:r}),Yu=(h,r,l,p,_,x,T,C,M,R,L,U,G,Q)=>({u_proj_matrix:Float32Array.from(h),u_globe_matrix:r,u_normalize_matrix:Float32Array.from(p),u_merc_matrix:l,u_zoom_transition:_,u_merc_center:x,u_image0:0,u_frustum_tl:T,u_frustum_tr:C,u_frustum_br:M,u_frustum_bl:R,u_globe_pos:L,u_globe_radius:U,u_viewport:G,u_grid_matrix:Q?Float32Array.from(Q):new Float32Array(9)});function pc(h,r){return h!=null&&r!=null&&!(!h.hasData()||!r.hasData())&&h.demTexture!=null&&r.demTexture!=null&&h.tileID.key!==r.tileID.key}const As=new class{constructor(){this.operations={}}newMorphing(h,r,l,p,_){if(h in this.operations){const x=this.operations[h];x.to.tileID.key!==l.tileID.key&&(x.queued=l)}else this.operations[h]={startTime:p,phase:0,duration:_,from:r,to:l,queued:null}}getMorphValuesForProxy(h){if(!(h in this.operations))return null;const r=this.operations[h];return{from:r.from,to:r.to,phase:r.phase}}update(h){for(const r in this.operations){const l=this.operations[r];for(l.phase=(h-l.startTime)/l.duration;l.phase>=1||!this._validOp(l);)if(!this._nextOp(l,h)){delete this.operations[r];break}}}_nextOp(h,r){return!!h.queued&&(h.from=h.to,h.to=h.queued,h.queued=null,h.phase=0,h.startTime=r,!0)}_validOp(h){return h.from.hasData()&&h.to.hasData()}},sa={0:null,1:"TERRAIN_VERTEX_MORPHING",2:"TERRAIN_WIREFRAME"};function mc(h,r){const l=1<<h.z;return!r&&(h.x===0||h.x===l-1)||h.y===0||h.y===l-1}const ll=h=>({u_matrix:h});function gc(h,r,l,p,_){if(_>0){const x=o.exported.now(),T=(x-h.timeAdded)/_,C=r?(x-r.timeAdded)/_:-1,M=l.getSource(),R=p.coveringZoomLevel({tileSize:M.tileSize,roundZoom:M.roundZoom}),L=!r||Math.abs(r.tileID.overscaledZ-R)>Math.abs(h.tileID.overscaledZ-R),U=L&&h.refreshedUponExpiration?1:o.clamp(L?T:1-C,0,1);return h.refreshedUponExpiration&&T>=1&&(h.refreshedUponExpiration=!1),r?{opacity:1,mix:1-U}:{opacity:U,mix:0}}return{opacity:1,mix:0}}class $n extends o.SourceCache{constructor(r){const l={type:"raster-dem",maxzoom:r.transform.maxZoom},p=new qt(fn(),null),_=ze("mock-dem",l,p,r.style);super("mock-dem",_,!1),_.setEventedParent(this),this._sourceLoaded=!0}_loadTile(r,l){r.state="loaded",l(null)}}class _c extends o.SourceCache{constructor(r){const l=ze("proxy",{type:"geojson",maxzoom:r.transform.maxZoom},new qt(fn(),null),r.style);super("proxy",l,!1),l.setEventedParent(this),this.map=this.getSource().map=r,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(r,l,p){if(r.freezeTileCoverage)return;this.transform=r;const _=r.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((x,T)=>{if(x[T.key]="",!this._tiles[T.key]){const C=new o.Tile(T,this._source.tileSize*T.overscaleFactor(),r.tileZoom);C.state="loaded",this._tiles[T.key]=C}return x},{});for(const x in this._tiles)x in _||(this.freeFBO(x),this._tiles[x].unloadVectorData(),delete this._tiles[x])}freeFBO(r){const l=this.proxyCachedFBO[r];if(l!==void 0){const p=Object.values(l);this.renderCachePool.push(...p),delete this.proxyCachedFBO[r]}}deallocRenderCache(){this.renderCache.forEach(r=>r.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class Qu extends o.OverscaledTileID{constructor(r,l,p){super(r.overscaledZ,r.wrap,r.canonical.z,r.canonical.x,r.canonical.y),this.proxyTileKey=l,this.projMatrix=p}}class Yd extends o.Elevation{constructor(r,l){super(),this.painter=r,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[p,_,x]=function(M){const R=new o.StructArrayLayout4i8,L=new o.StructArrayLayout3ui6,U=131;R.reserve(17161),L.reserve(33800);const G=o.EXTENT/128,Q=o.EXTENT+G/2,K=Q+G;for(let H=-G;H<K;H+=G)for(let W=-G;W<K;W+=G){const ie=W<0||W>Q||H<0||H>Q?24575:0,ee=o.clamp(Math.round(W),0,o.EXTENT),he=o.clamp(Math.round(H),0,o.EXTENT);R.emplaceBack(ee+ie,he,ee,he)}const J=(H,W)=>{const ie=W*U+H;L.emplaceBack(ie+1,ie,ie+U),L.emplaceBack(ie+U,ie+U+1,ie+1)};for(let H=1;H<129;H++)for(let W=1;W<129;W++)J(W,H);return[0,129].forEach(H=>{for(let W=0;W<130;W++)J(W,H),J(H,W)}),[R,L,32768]}(),T=r.context;this.gridBuffer=T.createVertexBuffer(p,o.boundsAttributes.members),this.gridIndexBuffer=T.createIndexBuffer(_),this.gridSegments=o.SegmentVector.simpleSegment(0,0,p.length,_.length),this.gridNoSkirtSegments=o.SegmentVector.simpleSegment(0,0,p.length,x),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new _c(l.map),this.orthoMatrix=o.create(),o.ortho(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,o.EXTENT,0,o.EXTENT,0,1);const C=T.gl;this._overlapStencilMode=new o.StencilMode({func:C.GEQUAL,mask:255},0,255,C.KEEP,C.KEEP,C.REPLACE),this._previousZoom=r.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=l,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new $n(l.map)}set style(r){r.on("data",this._onStyleDataEvent.bind(this)),r.on("neworder",this._checkRenderCacheEfficiency.bind(this)),this._style=r,this._checkRenderCacheEfficiency()}update(r,l,p){if(r&&r.terrain){this._style!==r&&(this.style=r),this.enabled=!0;const _=r.terrain.properties;this.sourceCache=r.terrain.drapeRenderMode===0?this._mockSourceCache:r._getSourceCache(_.get("source")),this._exaggeration=_.get("exaggeration");const x=()=>{this.sourceCache.used&&o.warnOnce(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const T=this.getScaledDemTileSize();this.sourceCache.update(l,T,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,x(),this._initializing=!0),x(),l.updateElevation(!0,p),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(l),this._emptyDEMTextureDirty=!0}else this._disable()}resetTileLookupCache(r){this._findCoveringTileCache[r]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_checkRenderCacheEfficiency(){const r=this.renderCacheEfficiency(this._style);this._style.map._optimizeForTerrain||r.efficiency!==100&&o.warnOnce(`Terrain render cache efficiency is not optimal (${r.efficiency}%) and performance
                may be affected negatively, consider placing all background, fill and line layers before layer
                with id '${r.firstUndrapedLayer}' or create a map using optimizeForTerrain: true option.`)}_onStyleDataEvent(r){r.coord&&r.dataType==="source"?this._clearRenderCacheForTile(r.sourceCacheId,r.coord):r.dataType==="style"&&(this._invalidateRenderCache=!0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const r in this._style._sourceCaches)this._style._sourceCaches[r].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach(r=>r.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0)}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const r=2*this.proxySourceCache.getSource().tileSize;return[r,r]}set useVertexMorphing(r){this._useVertexMorphing=r}updateTileBinding(r){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const l=this.proxySourceCache,p=this.painter.transform;this._initializing&&(this._initializing=p._centerAltitude===0&&this.getAtPointOrZero(o.MercatorCoordinate.fromLngLat(p.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const _=this.proxyCoords=l.getIds().map(M=>{const R=l.getTileByID(M).tileID;return R.projMatrix=p.calculateProjMatrix(R.toUnwrapped()),R});(function(M,R){const L=R.transform.pointCoordinate(R.transform.getCameraPoint()),U=new o.pointGeometry(L.x,L.y);M.sort((G,Q)=>{if(Q.overscaledZ-G.overscaledZ)return Q.overscaledZ-G.overscaledZ;const K=new o.pointGeometry(G.canonical.x+(1<<G.canonical.z)*G.wrap,G.canonical.y),J=new o.pointGeometry(Q.canonical.x+(1<<Q.canonical.z)*Q.wrap,Q.canonical.y),H=U.mult(1<<G.canonical.z);return H.x-=.5,H.y-=.5,H.distSqr(K)-H.distSqr(J)})})(_,this.painter),this._previousZoom=p.zoom;const x=this.proxyToSource||{};this.proxyToSource={},_.forEach(M=>{this.proxyToSource[M.key]={}}),this.terrainTileForTile={};const T=this._style._sourceCaches;for(const M in T){const R=T[M];if(!R.used||(R!==this.sourceCache&&this.resetTileLookupCache(R.id),this._setupProxiedCoordsForOrtho(R,r[M],x),R.usedForTerrain))continue;const L=r[M];R.getSource().reparseOverscaled&&this._assignTerrainTiles(L)}this.proxiedCoords[l.id]=_.map(M=>new Qu(M,M.key,this.orthoMatrix)),this._assignTerrainTiles(_),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(x),this.renderingToTexture=!1,this._updateTimestamp=o.exported.now();const C={};this._visibleDemTiles=[];for(const M of this.proxyCoords){const R=this.terrainTileForTile[M.key];if(!R)continue;const L=R.tileID.key;L in C||(this._visibleDemTiles.push(R),C[L]=L)}}_assignTerrainTiles(r){this._initializing||r.forEach(l=>{if(this.terrainTileForTile[l.key])return;const p=this._findTileCoveringTileID(l,this.sourceCache);p&&(this.terrainTileForTile[l.key]=p)})}_prepareDEMTextures(){const r=this.painter.context,l=r.gl;for(const p in this.terrainTileForTile){const _=this.terrainTileForTile[p],x=_.dem;!x||_.demTexture&&!_.needsDEMTextureUpload||(r.activeTexture.set(l.TEXTURE1),oa(this.painter,_,x))}}_prepareDemTileUniforms(r,l,p,_){if(!l||l.demTexture==null)return!1;const x=r.tileID.canonical,T=Math.pow(2,l.tileID.canonical.z-x.z),C=_||"";return p[`u_dem_tl${C}`]=[x.x*T%1,x.y*T%1],p[`u_dem_scale${C}`]=T,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){const r=this.painter.context,l=r.gl;if(!this._emptyDepthBufferTexture){const p=new o.RGBAImage({width:1,height:1},Uint8Array.of(255,255,255,255));this._emptyDepthBufferTexture=new o.Texture(r,p,l.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){let r=0;const l=this._visibleDemTiles.reduce((p,_)=>{if(!_.dem)return p;const x=_.dem.tree.minimums[0];return x>0&&r++,p+x},0);return r?l/r:0}_updateEmptyDEMTexture(){const r=this.painter.context,l=r.gl;r.activeTexture.set(l.TEXTURE2);const p=this._getLoadedAreaMinimum(),_=new o.RGBAImage({width:1,height:1},new Uint8Array(o.DEMData.pack(p,this.sourceCache.getSource().encoding)));this._emptyDEMTextureDirty=!1;let x=this._emptyDEMTexture;return x?x.update(_,{premultiply:!1}):x=this._emptyDEMTexture=new o.Texture(r,_,l.RGBA,{premultiply:!1}),x}setupElevationDraw(r,l,p){const _=this.painter.context,x=_.gl,T=(C=this.sourceCache.getSource().encoding,{u_dem:2,u_dem_prev:4,u_dem_unpack:o.DEMData.getUnpackVector(C),u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0});var C;T.u_dem_size=this.sourceCache.getSource().tileSize,T.u_exaggeration=this.exaggeration();let M=null,R=null,L=1;if(p&&p.morphing&&this._useVertexMorphing){const U=p.morphing.srcDemTile,G=p.morphing.dstDemTile;L=p.morphing.phase,U&&G&&(this._prepareDemTileUniforms(r,U,T,"_prev")&&(R=U),this._prepareDemTileUniforms(r,G,T)&&(M=G))}if(R&&M?(_.activeTexture.set(x.TEXTURE2),M.demTexture.bind(x.NEAREST,x.CLAMP_TO_EDGE,x.NEAREST),_.activeTexture.set(x.TEXTURE4),R.demTexture.bind(x.NEAREST,x.CLAMP_TO_EDGE,x.NEAREST),T.u_dem_lerp=L):(M=this.terrainTileForTile[r.tileID.key],_.activeTexture.set(x.TEXTURE2),(this._prepareDemTileUniforms(r,M,T)?M.demTexture:this.emptyDEMTexture).bind(x.NEAREST,x.CLAMP_TO_EDGE)),_.activeTexture.set(x.TEXTURE3),p&&p.useDepthForOcclusion?(this._depthTexture&&this._depthTexture.bind(x.NEAREST,x.CLAMP_TO_EDGE),this._depthFBO&&(T.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height])):(this.emptyDepthBufferTexture.bind(x.NEAREST,x.CLAMP_TO_EDGE),T.u_depth_size_inv=[1,1]),p&&p.useMeterToDem&&M){const U=(1<<M.tileID.canonical.z)*o.mercatorZfromAltitude(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;T.u_meter_to_dem=U}if(p&&p.labelPlaneMatrixInv&&(T.u_label_plane_matrix_inv=p.labelPlaneMatrixInv),l.setTerrainUniformValues(_,T),this.painter.transform.projection.name==="globe"){const U=this.globeUniformValues(this.painter.transform,r.tileID.canonical,p&&p.useDenormalizedUpVectorScale);l.setGlobeUniformValues(_,U)}}globeUniformValues(r,l,p){const _=r.projection;return{u_tile_tl_up:_.upVector(l,0,0),u_tile_tr_up:_.upVector(l,o.EXTENT,0),u_tile_br_up:_.upVector(l,o.EXTENT,o.EXTENT),u_tile_bl_up:_.upVector(l,0,o.EXTENT),u_tile_up_scale:p?o.GLOBE_METERS_TO_ECEF:_.upVectorScale(l,r.center.lat,r.worldSize).metersToTile}}renderToBackBuffer(r){const l=this.painter,p=this.painter.context;r.length!==0&&(p.bindFramebuffer.set(null),p.viewport.set([0,0,l.width,l.height]),l.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(_,x,T,C,M){if(_.transform.projection.name==="globe")(function(R,L,U,G,Q){const K=R.context,J=K.gl;let H,W;const ie=R.options.showTerrainWireframe?2:0,ee=R.transform,he=o.globeUseCustomAntiAliasing(R,K,ee),we=(Et,Je)=>{if(W===Et)return;const pt=[sa[Et],"PROJECTION_GLOBE_VIEW"];he&&pt.push("CUSTOM_ANTIALIASING"),Je&&pt.push(sa[ie]),H=R.useProgram("globeRaster",null,pt),W=Et},ve=R.colorModeForRenderPass(),Pe=new o.DepthMode(J.LEQUAL,o.DepthMode.ReadWrite,R.depthRangeFor3D);As.update(Q);const He=o.calculateGlobeMercatorMatrix(ee),qe=[o.mercatorXfromLng(ee.center.lng),o.mercatorYfromLat(ee.center.lat)],Le=ie?[!1,!0]:[!1],It=R.globeSharedBuffers,Ue=[ee.width*o.exported.devicePixelRatio,ee.height*o.exported.devicePixelRatio],st=Float32Array.from(ee.globeMatrix),Xe={useDenormalizedUpVectorScale:!0};if(Le.forEach(Et=>{W=-1;const Je=Et?J.LINES:J.TRIANGLES;for(const pt of G){const Pt=U.getTile(pt),De=o.StencilMode.disabled,We=L.prevTerrainTileForTile[pt.key],Qt=L.terrainTileForTile[pt.key];pc(We,Qt)&&As.newMorphing(pt.key,We,Qt,Q,250),K.activeTexture.set(J.TEXTURE0),Pt.texture.bind(J.LINEAR,J.CLAMP_TO_EDGE);const ln=As.getMorphValuesForProxy(pt.key),Jt=ln?1:0;ln&&o.extend$1(Xe,{morphing:{srcDemTile:ln.from,dstDemTile:ln.to,phase:o.easeCubicInOut(ln.phase)}});const mn=o.tileCornersToBounds(pt.canonical),Tn=o.getLatitudinalLod(mn.getCenter().lat),cn=o.getGridMatrix(pt.canonical,mn,Tn,ee.worldSize/ee._pixelsPerMercatorPixel),Gt=o.globeNormalizeECEF(o.globeTileBounds(pt.canonical)),ei=Yu(ee.projMatrix,st,He,Gt,o.globeToMercatorTransition(ee.zoom),qe,ee.frustumCorners.TL,ee.frustumCorners.TR,ee.frustumCorners.BR,ee.frustumCorners.BL,ee.globeCenterInViewSpace,ee.globeRadius,Ue,cn);if(we(Jt,Et),L.setupElevationDraw(Pt,H,Xe),R.prepareDrawProgram(K,H,pt.toUnwrapped()),It){const[Hn,li,ii]=Et?It.getWirefameBuffers(R.context,Tn):It.getGridBuffers(Tn);H.draw(K,Je,Pe,De,ve,o.CullFaceMode.backCCW,ei,"globe_raster",Hn,li,ii)}}}),It){const Et=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];he&&Et.push("CUSTOM_ANTIALIASING"),H=R.useProgram("globeRaster",null,Et);for(const Je of G){const{x:pt,y:Pt,z:De}=Je.canonical,We=Pt===0,Qt=Pt===(1<<De)-1,[ln,Jt,mn,Tn]=It.getPoleBuffers(De);if(Tn&&(We||Qt)){const cn=U.getTile(Je);K.activeTexture.set(J.TEXTURE0),cn.texture.bind(J.LINEAR,J.CLAMP_TO_EDGE);let Gt=o.globePoleMatrixForTile(De,pt,ee);const ei=o.globeNormalizeECEF(o.globeTileBounds(Je.canonical)),Hn=(li,ii)=>li.draw(K,J.TRIANGLES,Pe,o.StencilMode.disabled,ve,o.CullFaceMode.disabled,Yu(ee.projMatrix,Gt,Gt,ei,0,qe,ee.frustumCorners.TL,ee.frustumCorners.TR,ee.frustumCorners.BR,ee.frustumCorners.BL,ee.globeCenterInViewSpace,ee.globeRadius,Ue),"globe_pole_raster",ii,mn,Tn);L.setupElevationDraw(cn,H,Xe),R.prepareDrawProgram(K,H,Je.toUnwrapped()),We&&Hn(H,ln),Qt&&(Gt=o.scale(o.create(),Gt,[1,-1,1]),Hn(H,Jt))}}}})(_,x,T,C,M);else{const R=_.context,L=R.gl;let U,G;const Q=_.options.showTerrainWireframe?2:0,K=(ee,he)=>{if(G===ee)return;const we=[sa[ee]];he&&we.push(sa[Q]),U=_.useProgram("terrainRaster",null,we),G=ee},J=_.colorModeForRenderPass(),H=new o.DepthMode(L.LEQUAL,o.DepthMode.ReadWrite,_.depthRangeFor3D);As.update(M);const W=_.transform,ie=6*Math.pow(1.5,22-W.zoom)*x.exaggeration();(Q?[!1,!0]:[!1]).forEach(ee=>{G=-1;const he=ee?L.LINES:L.TRIANGLES,[we,ve]=ee?x.getWirefameBuffer():[x.gridIndexBuffer,x.gridSegments];for(const Pe of C){const He=T.getTile(Pe),qe=o.StencilMode.disabled,Le=x.prevTerrainTileForTile[Pe.key],It=x.terrainTileForTile[Pe.key];pc(Le,It)&&As.newMorphing(Pe.key,Le,It,M,250),R.activeTexture.set(L.TEXTURE0),He.texture.bind(L.LINEAR,L.CLAMP_TO_EDGE,L.LINEAR_MIPMAP_NEAREST);const Ue=As.getMorphValuesForProxy(Pe.key),st=Ue?1:0;let Xe;Ue&&(Xe={morphing:{srcDemTile:Ue.from,dstDemTile:Ue.to,phase:o.easeCubicInOut(Ue.phase)}});const Et=fc(Pe.projMatrix,mc(Pe.canonical,W.renderWorldCopies)?ie/10:ie);K(st,ee),x.setupElevationDraw(He,U,Xe),_.prepareDrawProgram(R,U,Pe.toUnwrapped()),U.draw(R,he,H,qe,J,o.CullFaceMode.backCCW,Et,"terrain_raster",x.gridBuffer,we,ve)}})}}(l,this,this.proxySourceCache,r,this._updateTimestamp),this.renderingToTexture=!0,l.gpuTimingDeferredRenderEnd(),r.splice(0,r.length))}renderBatch(r){if(this._drapedRenderBatches.length===0)return r+1;this.renderingToTexture=!0;const l=this.painter,p=this.painter.context,_=this.proxySourceCache,x=this.proxiedCoords[_.id],T=this._drapedRenderBatches.shift(),C=[],M=l.style.order;let R=0;for(const L of x){const U=_.getTileByID(L.proxyTileKey),G=_.proxyCachedFBO[L.key]?_.proxyCachedFBO[L.key][r]:void 0,Q=G!==void 0?_.renderCache[G]:this.pool[R++],K=G!==void 0;if(U.texture=Q.tex,K&&!Q.dirty){C.push(U.tileID);continue}let J;p.bindFramebuffer.set(Q.fb.framebuffer),this.renderedToTile=!1,Q.dirty&&(p.clear({color:o.Color.transparent,stencil:0}),Q.dirty=!1);for(let H=T.start;H<=T.end;++H){const W=l.style._layers[M[H]];if(W.isHidden(l.transform.zoom))continue;const ie=l.style._getLayerSourceCache(W),ee=ie?this.proxyToSource[L.key][ie.id]:[L];if(!ee)continue;const he=ee;p.viewport.set([0,0,Q.fb.width,Q.fb.height]),J!==(ie?ie.id:null)&&(this._setupStencil(Q,ee,W,ie),J=ie?ie.id:null),l.renderLayer(l,ie,W,he)}this.renderedToTile?(Q.dirty=!0,C.push(U.tileID)):K||--R,R===5&&(R=0,this.renderToBackBuffer(C))}return this.renderToBackBuffer(C),this.renderingToTexture=!1,p.bindFramebuffer.set(null),p.viewport.set([0,0,l.width,l.height]),T.end+1}postRender(){}renderCacheEfficiency(r){const l=r.order.length;if(l===0)return{efficiency:100};let p,_=0,x=0,T=!1;for(let C=0;C<l;++C){const M=r._layers[r.order[C]];this._style.isLayerDraped(M)?(T&&++_,++x):T||(T=!0,p=M.id)}return x===0?{efficiency:100}:{efficiency:100*(1-_/x),firstUndrapedLayer:p}}getMinElevationBelowMSL(){let r=0;return this._visibleDemTiles.filter(l=>l.dem).forEach(l=>{r=Math.min(r,l.dem.tree.minimums[0])}),r===0?r:(r-30)*this._exaggeration}raycast(r,l,p){if(!this._visibleDemTiles)return null;const _=this._visibleDemTiles.filter(x=>x.dem).map(x=>{const T=x.tileID,C=1<<T.overscaledZ,{x:M,y:R}=T.canonical,L=M/C,U=(M+1)/C,G=R/C,Q=(R+1)/C;return{minx:L,miny:G,maxx:U,maxy:Q,t:x.dem.tree.raycastRoot(L,G,U,Q,r,l,p),tile:x}});_.sort((x,T)=>(x.t!==null?x.t:Number.MAX_VALUE)-(T.t!==null?T.t:Number.MAX_VALUE));for(const x of _){if(x.t==null)return null;const T=x.tile.dem.tree.raycast(x.minx,x.miny,x.maxx,x.maxy,r,l,p);if(T!=null)return T}return null}_createFBO(){const r=this.painter.context,l=r.gl,p=this.drapeBufferSize;r.activeTexture.set(l.TEXTURE0);const _=new o.Texture(r,{width:p[0],height:p[1],data:null},l.RGBA);_.bind(l.LINEAR,l.CLAMP_TO_EDGE);const x=r.createFramebuffer(p[0],p[1],!1);return x.colorAttachment.set(_.texture),x.depthAttachment=new In(r,x.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=r.createRenderbuffer(r.gl.DEPTH_STENCIL,p[0],p[1]),this._stencilRef=0,x.depthAttachment.set(this._sharedDepthStencil),r.clear({stencil:0})):x.depthAttachment.set(this._sharedDepthStencil),r.extTextureFilterAnisotropic&&!r.extTextureFilterAnisotropicForceOff&&l.texParameterf(l.TEXTURE_2D,r.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,r.extTextureFilterAnisotropicMax),{fb:x,tex:_,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._style.light&&this._style.light.hasTransition())return!0;for(const r in this._style._sourceCaches)if(this._style._sourceCaches[r].hasTransition())return!0;return this._style.order.some(r=>{const l=this._style._layers[r],p=l.isHidden(this.painter.transform.zoom);return l.type!=="custom"&&!p&&l.hasTransition()})}_clearRasterFadeFromRenderCache(){let r=!1;for(const l in this._style._sourceCaches)if(this._style._sourceCaches[l]._source instanceof j){r=!0;break}if(r)for(let l=0;l<this._style.order.length;++l){const p=this._style._layers[this._style.order[l]],_=p.isHidden(this.painter.transform.zoom),x=this._style._getLayerSourceCache(p);if(p.type!=="raster"||_||!x)continue;const T=p.paint.get("raster-fade-duration");for(const C of this.proxyCoords){const M=this.proxyToSource[C.key][x.id];if(M)for(const R of M){const L=gc(x.getTile(R),x.findLoadedParent(R,0),x,this.painter.transform,T);(L.opacity!==1||L.mix!==0)&&this._clearRenderCacheForTile(x.id,R)}}}}_setupDrapedRenderBatches(){const r=this._style.order,l=r.length;if(l===0)return;const p=[];let _,x=0,T=this._style._layers[r[x]];for(;!this._style.isLayerDraped(T)&&T.isHidden(this.painter.transform.zoom)&&++x<l;)T=this._style._layers[r[x]];for(;x<l;++x){const C=this._style._layers[r[x]];C.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(C)?_===void 0&&(_=x):_!==void 0&&(p.push({start:_,end:x-1}),_=void 0))}_!==void 0&&p.push({start:_,end:x-1}),this._drapedRenderBatches=p}_setupRenderCache(r){const l=this.proxySourceCache;if(this._shouldDisableRenderCache()||this._invalidateRenderCache){if(this._invalidateRenderCache=!1,l.renderCache.length>l.renderCachePool.length){const T=Object.values(l.proxyCachedFBO);l.proxyCachedFBO={};for(let C=0;C<T.length;++C){const M=Object.values(T[C]);l.renderCachePool.push(...M)}}return}this._clearRasterFadeFromRenderCache();const p=this.proxyCoords,_=this._tilesDirty;for(let T=p.length-1;T>=0;T--){const C=p[T];if(l.getTileByID(C.key),l.proxyCachedFBO[C.key]!==void 0){const M=r[C.key],R=this.proxyToSource[C.key];let L=0;for(const U in R){const G=R[U],Q=M[U];if(!Q||Q.length!==G.length||G.some((K,J)=>K!==Q[J]||_[U]&&_[U].hasOwnProperty(K.key))){L=-1;break}++L}for(const U in l.proxyCachedFBO[C.key])l.renderCache[l.proxyCachedFBO[C.key][U]].dirty=L<0||L!==Object.values(M).length}}const x=[...this._drapedRenderBatches];x.sort((T,C)=>C.end-C.start-(T.end-T.start));for(const T of x)for(const C of p){if(l.proxyCachedFBO[C.key])continue;let M=l.renderCachePool.pop();M===void 0&&l.renderCache.length<50&&(M=l.renderCache.length,l.renderCache.push(this._createFBO())),M!==void 0&&(l.proxyCachedFBO[C.key]={},l.proxyCachedFBO[C.key][T.start]=M,l.renderCache[M].dirty=!0)}this._tilesDirty={}}_setupStencil(r,l,p,_){if(!_||!this._sourceTilesOverlap[_.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const x=this.painter.context,T=x.gl;if(l.length<=1)return void(this._overlapStencilType=!1);let C;if(p.isTileClipped())C=l.length,this._overlapStencilMode.test={func:T.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(l[0].overscaledZ>l[l.length-1].overscaledZ))return void(this._overlapStencilType=!1);C=1,this._overlapStencilMode.test={func:T.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+C>255&&(x.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=C,this._overlapStencilMode.ref=this._stencilRef,p.isTileClipped()&&this._renderTileClippingMasks(l,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(r){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[r.key]),this._overlapStencilMode):o.StencilMode.disabled}_renderTileClippingMasks(r,l){const p=this.painter,_=this.painter.context,x=_.gl;p._tileClippingMaskIDs={},_.setColorMode(o.ColorMode.disabled),_.setDepthMode(o.DepthMode.disabled);const T=p.useProgram("clippingMask");for(const C of r){const M=p._tileClippingMaskIDs[C.key]=--l;T.draw(_,x.TRIANGLES,o.DepthMode.disabled,new o.StencilMode({func:x.ALWAYS,mask:0},M,255,x.KEEP,x.KEEP,x.REPLACE),o.ColorMode.disabled,o.CullFaceMode.disabled,ll(C.projMatrix),"$clipping",p.tileExtentBuffer,p.quadTriangleIndexBuffer,p.tileExtentSegments)}}pointCoordinate(r){const l=this.painter.transform;if(r.x<0||r.x>l.width||r.y<0||r.y>l.height)return null;const p=[r.x,r.y,1,1];o.transformMat4$1(p,p,l.pixelMatrixInverse),o.scale$1(p,p,1/p[3]),p[0]/=l.worldSize,p[1]/=l.worldSize;const _=l._camera.position,x=o.mercatorZfromAltitude(1,l.center.lat),T=[_[0],_[1],_[2]/x,0],C=o.subtract([],p.slice(0,3),T);o.normalize(C,C);const M=this.raycast(T,C,this._exaggeration);return M!==null&&M?(o.scaleAndAdd(T,T,C,M),T[3]=T[2],T[2]*=x,T):null}drawDepth(){const r=this.painter,l=r.context,p=this.proxySourceCache,_=Math.ceil(r.width),x=Math.ceil(r.height);if(!this._depthFBO||this._depthFBO.width===_&&this._depthFBO.height===x||(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),!this._depthFBO){const T=l.gl,C=l.createFramebuffer(_,x,!0);l.activeTexture.set(T.TEXTURE0);const M=new o.Texture(l,{width:_,height:x,data:null},T.RGBA);M.bind(T.NEAREST,T.CLAMP_TO_EDGE),C.colorAttachment.set(M.texture);const R=l.createRenderbuffer(l.gl.DEPTH_COMPONENT16,_,x);C.depthAttachment.set(R),this._depthFBO=C,this._depthTexture=M}l.bindFramebuffer.set(this._depthFBO.framebuffer),l.viewport.set([0,0,_,x]),function(T,C,M,R){if(T.transform.projection.name==="globe")return;const L=T.context,U=L.gl;L.clear({depth:1});const G=T.useProgram("terrainDepth"),Q=new o.DepthMode(U.LESS,o.DepthMode.ReadWrite,T.depthRangeFor3D);for(const K of R){const J=M.getTile(K),H=fc(K.projMatrix,0);C.setupElevationDraw(J,G),G.draw(L,U.TRIANGLES,Q,o.StencilMode.disabled,o.ColorMode.unblended,o.CullFaceMode.backCCW,H,"terrain_depth",C.gridBuffer,C.gridIndexBuffer,C.gridNoSkirtSegments)}}(r,this,p,this.proxyCoords)}_setupProxiedCoordsForOrtho(r,l,p){if(r.getSource()instanceof Te)return this._setupProxiedCoordsForImageSource(r,l,p);this._findCoveringTileCache[r.id]=this._findCoveringTileCache[r.id]||{};const _=this.proxiedCoords[r.id]=[],x=this.proxyCoords;for(let C=0;C<x.length;C++){const M=x[C],R=this._findTileCoveringTileID(M,r);if(R){const L=this._createProxiedId(M,R,p[M.key]&&p[M.key][r.id]);_.push(L),this.proxyToSource[M.key][r.id]=[L]}}let T=!1;for(let C=0;C<l.length;C++){const M=r.getTile(l[C]);if(!M||!M.hasData())continue;const R=this._findTileCoveringTileID(M.tileID,this.proxySourceCache);if(R&&R.tileID.canonical.z!==M.tileID.canonical.z){const L=this.proxyToSource[R.tileID.key][r.id],U=this._createProxiedId(R.tileID,M,p[R.tileID.key]&&p[R.tileID.key][r.id]);L?L.splice(L.length-1,0,U):this.proxyToSource[R.tileID.key][r.id]=[U],_.push(U),T=!0}}this._sourceTilesOverlap[r.id]=T}_setupProxiedCoordsForImageSource(r,l,p){if(!r.getSource().loaded())return;const _=this.proxiedCoords[r.id]=[],x=this.proxyCoords,T=r.getSource(),C=new o.pointGeometry(T.tileID.x,T.tileID.y)._div(1<<T.tileID.z),M=T.coordinates.map(o.MercatorCoordinate.fromLngLat).reduce((L,U)=>(L.min.x=Math.min(L.min.x,U.x-C.x),L.min.y=Math.min(L.min.y,U.y-C.y),L.max.x=Math.max(L.max.x,U.x-C.x),L.max.y=Math.max(L.max.y,U.y-C.y),L),{min:new o.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE),max:new o.pointGeometry(-Number.MAX_VALUE,-Number.MAX_VALUE)}),R=(L,U)=>{const G=L.wrap+L.canonical.x/(1<<L.canonical.z),Q=L.canonical.y/(1<<L.canonical.z),K=o.EXTENT/(1<<L.canonical.z),J=U.wrap+U.canonical.x/(1<<U.canonical.z),H=U.canonical.y/(1<<U.canonical.z);return G+K<J+M.min.x||G>J+M.max.x||Q+K<H+M.min.y||Q>H+M.max.y};for(let L=0;L<x.length;L++){const U=x[L];for(let G=0;G<l.length;G++){const Q=r.getTile(l[G]);if(!Q||!Q.hasData()||R(U,Q.tileID))continue;const K=this._createProxiedId(U,Q,p[U.key]&&p[U.key][r.id]),J=this.proxyToSource[U.key][r.id];J?J.push(K):this.proxyToSource[U.key][r.id]=[K],_.push(K)}}}_createProxiedId(r,l,p){let _=this.orthoMatrix;if(p){const x=p.find(T=>T.key===l.tileID.key);if(x)return x}if(l.tileID.key!==r.key){const x=r.canonical.z-l.tileID.canonical.z;let T,C,M;_=o.create();const R=l.tileID.wrap-r.wrap<<r.overscaledZ;x>0?(T=o.EXTENT>>x,C=T*((l.tileID.canonical.x<<x)-r.canonical.x+R),M=T*((l.tileID.canonical.y<<x)-r.canonical.y)):(T=o.EXTENT<<-x,C=o.EXTENT*(l.tileID.canonical.x-(r.canonical.x+R<<-x)),M=o.EXTENT*(l.tileID.canonical.y-(r.canonical.y<<-x))),o.ortho(_,0,T,0,T,0,1),o.translate(_,_,[C,M,0])}return new Qu(l.tileID,r.key,_)}_findTileCoveringTileID(r,l){let p=l.getTile(r);if(p&&p.hasData())return p;const _=this._findCoveringTileCache[l.id],x=_[r.key];if(p=x?l.getTileByID(x):null,p&&p.hasData()||x===null)return p;let T=p?p.tileID:r,C=T.overscaledZ;const M=l.getSource().minzoom,R=[];if(!x){const U=l.getSource().maxzoom;if(r.canonical.z>=U){const G=r.canonical.z-U;l.getSource().reparseOverscaled?(C=Math.max(r.canonical.z+2,l.transform.tileZoom),T=new o.OverscaledTileID(C,r.wrap,U,r.canonical.x>>G,r.canonical.y>>G)):G!==0&&(C=U,T=new o.OverscaledTileID(C,r.wrap,U,r.canonical.x>>G,r.canonical.y>>G))}T.key!==r.key&&(R.push(T.key),p=l.getTile(T))}const L=U=>{R.forEach(G=>{_[G]=U}),R.length=0};for(C-=1;C>=M&&(!p||!p.hasData());C--){p&&L(p.tileID.key);const U=T.calculateScaledKey(C);if(p=l.getTileByID(U),p&&p.hasData())break;const G=_[U];if(G===null)break;G===void 0?R.push(U):p=l.getTileByID(G)}return L(p?p.tileID.key:null),p&&p.hasData()?p:null}findDEMTileFor(r){return this.enabled?this._findTileCoveringTileID(r,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(r,l){let p=this._tilesDirty[r];p||(p=this._tilesDirty[r]={}),p[l.key]=!0}getWirefameBuffer(){if(!this.wireframeSegments){const r=function(l){let p=0;const _=new o.StructArrayLayout2ui4,x=131;for(let T=1;T<129;T++){for(let C=1;C<129;C++)p=T*x+C,_.emplaceBack(p,p+1),_.emplaceBack(p,p+x),_.emplaceBack(p+1,p+x),T===128&&_.emplaceBack(p+x,p+x+1);_.emplaceBack(p+1,p+1+x)}return _}();this.wireframeIndexBuffer=this.painter.context.createIndexBuffer(r),this.wireframeSegments=o.SegmentVector.simpleSegment(0,0,this.gridBuffer.length,r.length)}return[this.wireframeIndexBuffer,this.wireframeSegments]}}class Ju{static cacheKey(r,l,p,_){let x=`${l}${_?_.cacheKey:""}`;for(const T of p)r.usedDefines.includes(T)&&(x+=`/${T}`);return x}constructor(r,l,p,_,x,T){const C=r.gl;this.program=C.createProgram();const M=function(H){const W=[];for(let ie=0;ie<H.length;ie++){if(H[ie]===null)continue;const ee=H[ie].split(" ");W.push(ee.pop())}return W}(p.staticAttributes),R=_?_.getBinderAttributes():[],L=M.concat(R);let U=_?_.defines():[];U=U.concat(T.map(H=>`#define ${H}`));const G=U.concat(r.extStandardDerivatives?`#extension GL_OES_standard_derivatives : enable
`.concat(ol):ol,ol,Xd,Wu.fragmentSource,hc.fragmentSource,p.fragmentSource).join(`
`),Q=U.concat(`
#ifdef GL_ES
precision highp float;
#else

#if !defined(lowp)
#define lowp
#endif

#if !defined(mediump)
#define mediump
#endif

#if !defined(highp)
#define highp
#endif

#endif`,Xd,Wu.vertexSource,hc.vertexSource,Wd.vertexSource,p.vertexSource).join(`
`),K=C.createShader(C.FRAGMENT_SHADER);if(C.isContextLost())return void(this.failedToCreate=!0);C.shaderSource(K,G),C.compileShader(K),C.attachShader(this.program,K);const J=C.createShader(C.VERTEX_SHADER);if(C.isContextLost())this.failedToCreate=!0;else{C.shaderSource(J,Q),C.compileShader(J),C.attachShader(this.program,J),this.attributes={},this.numAttributes=L.length;for(let H=0;H<this.numAttributes;H++)L[H]&&(C.bindAttribLocation(this.program,H,L[H]),this.attributes[L[H]]=H);C.linkProgram(this.program),C.deleteShader(J),C.deleteShader(K),this.fixedUniforms=x(r),this.binderUniforms=_?_.getUniforms(r):[],T.includes("TERRAIN")&&(this.terrainUniforms=(H=>({u_dem:new o.Uniform1i(H),u_dem_prev:new o.Uniform1i(H),u_dem_unpack:new o.Uniform4f(H),u_dem_tl:new o.Uniform2f(H),u_dem_scale:new o.Uniform1f(H),u_dem_tl_prev:new o.Uniform2f(H),u_dem_scale_prev:new o.Uniform1f(H),u_dem_size:new o.Uniform1f(H),u_dem_lerp:new o.Uniform1f(H),u_exaggeration:new o.Uniform1f(H),u_depth:new o.Uniform1i(H),u_depth_size_inv:new o.Uniform2f(H),u_meter_to_dem:new o.Uniform1f(H),u_label_plane_matrix_inv:new o.UniformMatrix4f(H)}))(r)),T.includes("GLOBE")&&(this.globeUniforms=(H=>({u_tile_tl_up:new o.Uniform3f(H),u_tile_tr_up:new o.Uniform3f(H),u_tile_br_up:new o.Uniform3f(H),u_tile_bl_up:new o.Uniform3f(H),u_tile_up_scale:new o.Uniform1f(H)}))(r)),T.includes("FOG")&&(this.fogUniforms=(H=>({u_fog_matrix:new o.UniformMatrix4f(H),u_fog_range:new o.Uniform2f(H),u_fog_color:new o.Uniform4f(H),u_fog_horizon_blend:new o.Uniform1f(H),u_fog_temporal_offset:new o.Uniform1f(H),u_frustum_tl:new o.Uniform3f(H),u_frustum_tr:new o.Uniform3f(H),u_frustum_br:new o.Uniform3f(H),u_frustum_bl:new o.Uniform3f(H),u_globe_pos:new o.Uniform3f(H),u_globe_radius:new o.Uniform1f(H),u_globe_transition:new o.Uniform1f(H),u_is_globe:new o.Uniform1i(H),u_viewport:new o.Uniform2f(H)}))(r))}}setTerrainUniformValues(r,l){if(!this.terrainUniforms)return;const p=this.terrainUniforms;if(!this.failedToCreate){r.program.set(this.program);for(const _ in l)p[_]&&p[_].set(this.program,_,l[_])}}setGlobeUniformValues(r,l){if(!this.globeUniforms)return;const p=this.globeUniforms;if(!this.failedToCreate){r.program.set(this.program);for(const _ in l)p[_]&&p[_].set(this.program,_,l[_])}}setFogUniformValues(r,l){if(!this.fogUniforms)return;const p=this.fogUniforms;if(!this.failedToCreate){r.program.set(this.program);for(const _ in l)p[_].set(this.program,_,l[_])}}draw(r,l,p,_,x,T,C,M,R,L,U,G,Q,K,J){const H=r.gl;if(this.failedToCreate)return;r.program.set(this.program),r.setDepthMode(p),r.setStencilMode(_),r.setColorMode(x),r.setCullFace(T);for(const ie of Object.keys(this.fixedUniforms))this.fixedUniforms[ie].set(this.program,ie,C[ie]);K&&K.setUniforms(this.program,r,this.binderUniforms,G,{zoom:Q});const W={[H.LINES]:2,[H.TRIANGLES]:3,[H.LINE_STRIP]:1}[l];for(const ie of U.get()){const ee=ie.vaos||(ie.vaos={});(ee[M]||(ee[M]=new Kd)).bind(r,this,R,K?K.getPaintVertexBuffers():[],L,ie.vertexOffset,J||[]),H.drawElements(l,ie.primitiveLength*W,H.UNSIGNED_SHORT,ie.primitiveOffset*W*2)}}}function yc(h,r){const l=Math.pow(2,r.tileID.overscaledZ),p=r.tileSize*Math.pow(2,h.transform.tileZoom)/l,_=p*(r.tileID.canonical.x+r.tileID.wrap*l),x=p*r.tileID.canonical.y;return{u_image:0,u_texsize:r.imageAtlasTexture.size,u_tile_units_to_pixels:1/xn(r,1,h.transform.tileZoom),u_pixel_coord_upper:[_>>16,x>>16],u_pixel_coord_lower:[65535&_,65535&x]}}const Qd=o.create(),Jd=(h,r,l,p,_,x,T,C,M,R,L)=>{const U=r.style.light,G=U.properties.get("position"),Q=[G.x,G.y,G.z],K=o.create$1();U.properties.get("anchor")==="viewport"&&(o.fromRotation(K,-r.transform.angle),o.transformMat3(Q,Q,K));const J=U.properties.get("color"),H=r.transform,W={u_matrix:h,u_lightpos:Q,u_lightintensity:U.properties.get("intensity"),u_lightcolor:[J.r,J.g,J.b],u_vertical_gradient:+l,u_opacity:p,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Qd,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_ao:_,u_edge_radius:x};return H.projection.name==="globe"&&(W.u_tile_id=[T.canonical.x,T.canonical.y,1<<T.canonical.z],W.u_zoom_transition=M,W.u_inv_rot_matrix=L,W.u_merc_center=R,W.u_up_dir=H.projection.upVector(new o.CanonicalTileID(0,0,0),R[0]*o.EXTENT,R[1]*o.EXTENT),W.u_height_lift=C),W},fg=(h,r,l,p,_,x,T,C,M,R,L,U)=>{const G=Jd(h,r,l,p,_,x,T,M,R,L,U),Q={u_height_factor:-Math.pow(2,T.overscaledZ)/C.tileSize/8};return o.extend(G,yc(r,C),Q)},vc=h=>({u_matrix:h}),xc=(h,r,l)=>o.extend(vc(h),yc(r,l)),eh=(h,r)=>({u_matrix:h,u_world:r}),th=(h,r,l,p)=>o.extend(xc(h,r,l),{u_world:p}),ef=o.create(),tf=(h,r,l,p,_,x)=>{const T=h.transform,C=T.projection.name==="globe";let M;if(x.paint.get("circle-pitch-alignment")==="map")if(C){const L=o.globePixelsToTileUnits(T.zoom,r.canonical)*T._pixelsPerMercatorPixel;M=Float32Array.from([L,0,0,L])}else M=T.calculatePixelsToTileUnitsMatrix(l);else M=new Float32Array([T.pixelsToGLUnits[0],0,0,T.pixelsToGLUnits[1]]);const R={u_camera_to_center_distance:T.cameraToCenterDistance,u_matrix:h.translatePosMatrix(r.projMatrix,l,x.paint.get("circle-translate"),x.paint.get("circle-translate-anchor")),u_device_pixel_ratio:o.exported.devicePixelRatio,u_extrude_scale:M,u_inv_rot_matrix:ef,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(C){R.u_inv_rot_matrix=p,R.u_merc_center=_,R.u_tile_id=[r.canonical.x,r.canonical.y,1<<r.canonical.z],R.u_zoom_transition=o.globeToMercatorTransition(T.zoom);const L=_[0]*o.EXTENT,U=_[1]*o.EXTENT;R.u_up_dir=T.projection.upVector(new o.CanonicalTileID(0,0,0),L,U)}return R},pg=h=>{const r=[];return h.paint.get("circle-pitch-alignment")==="map"&&r.push("PITCH_WITH_MAP"),h.paint.get("circle-pitch-scale")==="map"&&r.push("SCALE_WITH_MAP"),r},cl=(h,r,l,p)=>{const _=o.EXTENT/l.tileSize;return{u_matrix:h,u_camera_to_center_distance:r.getCameraToCenterDistance(p),u_extrude_scale:[r.pixelsToGLUnits[0]/_,r.pixelsToGLUnits[1]/_]}},aa=(h,r,l=1)=>({u_matrix:h,u_color:r,u_overlay:0,u_overlay_scale:l}),nf=o.create(),bc=(h,r,l,p,_,x,T)=>{const C=h.transform,M=C.projection.name==="globe",R=M?o.globePixelsToTileUnits(C.zoom,r.canonical)*C._pixelsPerMercatorPixel:xn(l,1,x),L={u_matrix:r.projMatrix,u_extrude_scale:R,u_intensity:T,u_inv_rot_matrix:nf,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(M){L.u_inv_rot_matrix=p,L.u_merc_center=_,L.u_tile_id=[r.canonical.x,r.canonical.y,1<<r.canonical.z],L.u_zoom_transition=o.globeToMercatorTransition(C.zoom);const U=_[0]*o.EXTENT,G=_[1]*o.EXTENT;L.u_up_dir=C.projection.upVector(new o.CanonicalTileID(0,0,0),U,G)}return L},nh=(h,r,l,p,_,x,T)=>{const C=h.transform,M=C.calculatePixelsToTileUnitsMatrix(r);return{u_matrix:ih(h,r,l,p),u_pixels_to_tile_units:M,u_device_pixel_ratio:x,u_units_to_pixels:[1/C.pixelsToGLUnits[0],1/C.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:_,u_texsize:Ec(l)?r.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:wc(r,h.transform),u_alpha_discard_threshold:0,u_trim_offset:T}},mo=(h,r,l,p,_)=>{const x=h.transform;return{u_matrix:ih(h,r,l,p),u_texsize:r.imageAtlasTexture.size,u_pixels_to_tile_units:x.calculatePixelsToTileUnitsMatrix(r),u_device_pixel_ratio:_,u_image:0,u_tile_units_to_pixels:wc(r,x),u_units_to_pixels:[1/x.pixelsToGLUnits[0],1/x.pixelsToGLUnits[1]],u_alpha_discard_threshold:0}};function wc(h,r){return 1/xn(h,1,r.tileZoom)}function ih(h,r,l,p){return h.translatePosMatrix(p||r.tileID.projMatrix,r,l.paint.get("line-translate"),l.paint.get("line-translate-anchor"))}function Ec(h){const r=h.paint.get("line-dasharray").value;return r.value||r.kind!=="constant"}const rf=(h,r,l,p,_,x)=>{return{u_matrix:h,u_tl_parent:r,u_scale_parent:l,u_fade_t:p.mix,u_opacity:p.opacity*_.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:_.paint.get("raster-brightness-min"),u_brightness_high:_.paint.get("raster-brightness-max"),u_saturation_factor:(C=_.paint.get("raster-saturation"),C>0?1-1/(1.001-C):-C),u_contrast_factor:(T=_.paint.get("raster-contrast"),T>0?1/(1-T):1+T),u_spin_weights:rh(_.paint.get("raster-hue-rotate")),u_perspective_transform:x};var T,C};function rh(h){h*=Math.PI/180;const r=Math.sin(h),l=Math.cos(h);return[(2*l+1)/3,(-Math.sqrt(3)*r-l+1)/3,(Math.sqrt(3)*r-l+1)/3]}const of=o.create(),Tc=(h,r,l,p,_,x,T,C,M,R,L,U,G,Q,K,J)=>{const H=_.transform,W={u_is_size_zoom_constant:+(h==="constant"||h==="source"),u_is_size_feature_constant:+(h==="constant"||h==="camera"),u_size_t:r?r.uSizeT:0,u_size:r?r.uSize:0,u_camera_to_center_distance:H.cameraToCenterDistance,u_rotate_symbol:+l,u_aspect_ratio:H.width/H.height,u_fade_change:_.options.fadeDuration?_.symbolFadeChange:1,u_matrix:x,u_label_plane_matrix:T,u_coord_matrix:C,u_is_text:+M,u_pitch_with_map:+p,u_texsize:R,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:of,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:of,u_up_vector:[0,-1,0]};return J.name==="globe"&&(W.u_tile_id=[L.canonical.x,L.canonical.y,1<<L.canonical.z],W.u_zoom_transition=U,W.u_inv_rot_matrix=Q,W.u_merc_center=G,W.u_camera_forward=H._camera.forward(),W.u_ecef_origin=o.globeECEFOrigin(H.globeMatrix,L.toUnwrapped()),W.u_tile_matrix=Float32Array.from(H.globeMatrix),W.u_up_vector=K),W},sf=(h,r,l,p,_,x,T,C,M,R,L,U,G,Q,K,J,H)=>o.extend(Tc(h,r,l,p,_,x,T,C,M,R,U,G,Q,K,J,H),{u_gamma_scale:p?_.transform.cameraToCenterDistance*Math.cos(_.terrain?0:_.transform._pitch):1,u_device_pixel_ratio:o.exported.devicePixelRatio,u_is_halo:+L}),Sc=(h,r,l,p,_,x,T,C,M,R,L,U,G,Q,K,J)=>o.extend(sf(h,r,l,p,_,x,T,C,!0,M,!0,L,U,G,Q,K,J),{u_texsize_icon:R,u_texture_icon:1}),mg=(h,r,l)=>({u_matrix:h,u_opacity:r,u_color:l}),oh=(h,r,l,p,_)=>o.extend(function(x,T,C){const M=T.imageManager.getPattern(x.toString()),{width:R,height:L}=T.imageManager.getPixelSize(),U=Math.pow(2,C.tileID.overscaledZ),G=C.tileSize*Math.pow(2,T.transform.tileZoom)/U,Q=G*(C.tileID.canonical.x+C.tileID.wrap*U),K=G*C.tileID.canonical.y;return{u_image:0,u_pattern_tl:M.tl,u_pattern_br:M.br,u_texsize:[R,L],u_pattern_size:M.displaySize,u_tile_units_to_pixels:1/xn(C,1,T.transform.tileZoom),u_pixel_coord_upper:[Q>>16,K>>16],u_pixel_coord_lower:[65535&Q,65535&K]}}(p,l,_),{u_matrix:h,u_opacity:r}),gg={fillExtrusion:h=>({u_matrix:new o.UniformMatrix4f(h),u_lightpos:new o.Uniform3f(h),u_lightintensity:new o.Uniform1f(h),u_lightcolor:new o.Uniform3f(h),u_vertical_gradient:new o.Uniform1f(h),u_opacity:new o.Uniform1f(h),u_edge_radius:new o.Uniform1f(h),u_ao:new o.Uniform2f(h),u_tile_id:new o.Uniform3f(h),u_zoom_transition:new o.Uniform1f(h),u_inv_rot_matrix:new o.UniformMatrix4f(h),u_merc_center:new o.Uniform2f(h),u_up_dir:new o.Uniform3f(h),u_height_lift:new o.Uniform1f(h)}),fillExtrusionPattern:h=>({u_matrix:new o.UniformMatrix4f(h),u_lightpos:new o.Uniform3f(h),u_lightintensity:new o.Uniform1f(h),u_lightcolor:new o.Uniform3f(h),u_vertical_gradient:new o.Uniform1f(h),u_height_factor:new o.Uniform1f(h),u_edge_radius:new o.Uniform1f(h),u_ao:new o.Uniform2f(h),u_tile_id:new o.Uniform3f(h),u_zoom_transition:new o.Uniform1f(h),u_inv_rot_matrix:new o.UniformMatrix4f(h),u_merc_center:new o.Uniform2f(h),u_up_dir:new o.Uniform3f(h),u_height_lift:new o.Uniform1f(h),u_image:new o.Uniform1i(h),u_texsize:new o.Uniform2f(h),u_pixel_coord_upper:new o.Uniform2f(h),u_pixel_coord_lower:new o.Uniform2f(h),u_tile_units_to_pixels:new o.Uniform1f(h),u_opacity:new o.Uniform1f(h)}),fill:h=>({u_matrix:new o.UniformMatrix4f(h)}),fillPattern:h=>({u_matrix:new o.UniformMatrix4f(h),u_image:new o.Uniform1i(h),u_texsize:new o.Uniform2f(h),u_pixel_coord_upper:new o.Uniform2f(h),u_pixel_coord_lower:new o.Uniform2f(h),u_tile_units_to_pixels:new o.Uniform1f(h)}),fillOutline:h=>({u_matrix:new o.UniformMatrix4f(h),u_world:new o.Uniform2f(h)}),fillOutlinePattern:h=>({u_matrix:new o.UniformMatrix4f(h),u_world:new o.Uniform2f(h),u_image:new o.Uniform1i(h),u_texsize:new o.Uniform2f(h),u_pixel_coord_upper:new o.Uniform2f(h),u_pixel_coord_lower:new o.Uniform2f(h),u_tile_units_to_pixels:new o.Uniform1f(h)}),circle:h=>({u_camera_to_center_distance:new o.Uniform1f(h),u_extrude_scale:new o.UniformMatrix2f(h),u_device_pixel_ratio:new o.Uniform1f(h),u_matrix:new o.UniformMatrix4f(h),u_inv_rot_matrix:new o.UniformMatrix4f(h),u_merc_center:new o.Uniform2f(h),u_tile_id:new o.Uniform3f(h),u_zoom_transition:new o.Uniform1f(h),u_up_dir:new o.Uniform3f(h)}),collisionBox:h=>({u_matrix:new o.UniformMatrix4f(h),u_camera_to_center_distance:new o.Uniform1f(h),u_extrude_scale:new o.Uniform2f(h)}),collisionCircle:h=>({u_matrix:new o.UniformMatrix4f(h),u_inv_matrix:new o.UniformMatrix4f(h),u_camera_to_center_distance:new o.Uniform1f(h),u_viewport_size:new o.Uniform2f(h)}),debug:h=>({u_color:new o.UniformColor(h),u_matrix:new o.UniformMatrix4f(h),u_overlay:new o.Uniform1i(h),u_overlay_scale:new o.Uniform1f(h)}),clippingMask:h=>({u_matrix:new o.UniformMatrix4f(h)}),heatmap:h=>({u_extrude_scale:new o.Uniform1f(h),u_intensity:new o.Uniform1f(h),u_matrix:new o.UniformMatrix4f(h),u_inv_rot_matrix:new o.UniformMatrix4f(h),u_merc_center:new o.Uniform2f(h),u_tile_id:new o.Uniform3f(h),u_zoom_transition:new o.Uniform1f(h),u_up_dir:new o.Uniform3f(h)}),heatmapTexture:h=>({u_image:new o.Uniform1i(h),u_color_ramp:new o.Uniform1i(h),u_opacity:new o.Uniform1f(h)}),hillshade:h=>({u_matrix:new o.UniformMatrix4f(h),u_image:new o.Uniform1i(h),u_latrange:new o.Uniform2f(h),u_light:new o.Uniform2f(h),u_shadow:new o.UniformColor(h),u_highlight:new o.UniformColor(h),u_accent:new o.UniformColor(h)}),hillshadePrepare:h=>({u_matrix:new o.UniformMatrix4f(h),u_image:new o.Uniform1i(h),u_dimension:new o.Uniform2f(h),u_zoom:new o.Uniform1f(h),u_unpack:new o.Uniform4f(h)}),line:h=>({u_matrix:new o.UniformMatrix4f(h),u_pixels_to_tile_units:new o.UniformMatrix2f(h),u_device_pixel_ratio:new o.Uniform1f(h),u_units_to_pixels:new o.Uniform2f(h),u_dash_image:new o.Uniform1i(h),u_gradient_image:new o.Uniform1i(h),u_image_height:new o.Uniform1f(h),u_texsize:new o.Uniform2f(h),u_tile_units_to_pixels:new o.Uniform1f(h),u_alpha_discard_threshold:new o.Uniform1f(h),u_trim_offset:new o.Uniform2f(h)}),linePattern:h=>({u_matrix:new o.UniformMatrix4f(h),u_texsize:new o.Uniform2f(h),u_pixels_to_tile_units:new o.UniformMatrix2f(h),u_device_pixel_ratio:new o.Uniform1f(h),u_image:new o.Uniform1i(h),u_units_to_pixels:new o.Uniform2f(h),u_tile_units_to_pixels:new o.Uniform1f(h),u_alpha_discard_threshold:new o.Uniform1f(h)}),raster:h=>({u_matrix:new o.UniformMatrix4f(h),u_tl_parent:new o.Uniform2f(h),u_scale_parent:new o.Uniform1f(h),u_fade_t:new o.Uniform1f(h),u_opacity:new o.Uniform1f(h),u_image0:new o.Uniform1i(h),u_image1:new o.Uniform1i(h),u_brightness_low:new o.Uniform1f(h),u_brightness_high:new o.Uniform1f(h),u_saturation_factor:new o.Uniform1f(h),u_contrast_factor:new o.Uniform1f(h),u_spin_weights:new o.Uniform3f(h),u_perspective_transform:new o.Uniform2f(h)}),symbolIcon:h=>({u_is_size_zoom_constant:new o.Uniform1i(h),u_is_size_feature_constant:new o.Uniform1i(h),u_size_t:new o.Uniform1f(h),u_size:new o.Uniform1f(h),u_camera_to_center_distance:new o.Uniform1f(h),u_rotate_symbol:new o.Uniform1i(h),u_aspect_ratio:new o.Uniform1f(h),u_fade_change:new o.Uniform1f(h),u_matrix:new o.UniformMatrix4f(h),u_label_plane_matrix:new o.UniformMatrix4f(h),u_coord_matrix:new o.UniformMatrix4f(h),u_is_text:new o.Uniform1i(h),u_pitch_with_map:new o.Uniform1i(h),u_texsize:new o.Uniform2f(h),u_tile_id:new o.Uniform3f(h),u_zoom_transition:new o.Uniform1f(h),u_inv_rot_matrix:new o.UniformMatrix4f(h),u_merc_center:new o.Uniform2f(h),u_camera_forward:new o.Uniform3f(h),u_tile_matrix:new o.UniformMatrix4f(h),u_up_vector:new o.Uniform3f(h),u_ecef_origin:new o.Uniform3f(h),u_texture:new o.Uniform1i(h)}),symbolSDF:h=>({u_is_size_zoom_constant:new o.Uniform1i(h),u_is_size_feature_constant:new o.Uniform1i(h),u_size_t:new o.Uniform1f(h),u_size:new o.Uniform1f(h),u_camera_to_center_distance:new o.Uniform1f(h),u_rotate_symbol:new o.Uniform1i(h),u_aspect_ratio:new o.Uniform1f(h),u_fade_change:new o.Uniform1f(h),u_matrix:new o.UniformMatrix4f(h),u_label_plane_matrix:new o.UniformMatrix4f(h),u_coord_matrix:new o.UniformMatrix4f(h),u_is_text:new o.Uniform1i(h),u_pitch_with_map:new o.Uniform1i(h),u_texsize:new o.Uniform2f(h),u_texture:new o.Uniform1i(h),u_gamma_scale:new o.Uniform1f(h),u_device_pixel_ratio:new o.Uniform1f(h),u_tile_id:new o.Uniform3f(h),u_zoom_transition:new o.Uniform1f(h),u_inv_rot_matrix:new o.UniformMatrix4f(h),u_merc_center:new o.Uniform2f(h),u_camera_forward:new o.Uniform3f(h),u_tile_matrix:new o.UniformMatrix4f(h),u_up_vector:new o.Uniform3f(h),u_ecef_origin:new o.Uniform3f(h),u_is_halo:new o.Uniform1i(h)}),symbolTextAndIcon:h=>({u_is_size_zoom_constant:new o.Uniform1i(h),u_is_size_feature_constant:new o.Uniform1i(h),u_size_t:new o.Uniform1f(h),u_size:new o.Uniform1f(h),u_camera_to_center_distance:new o.Uniform1f(h),u_rotate_symbol:new o.Uniform1i(h),u_aspect_ratio:new o.Uniform1f(h),u_fade_change:new o.Uniform1f(h),u_matrix:new o.UniformMatrix4f(h),u_label_plane_matrix:new o.UniformMatrix4f(h),u_coord_matrix:new o.UniformMatrix4f(h),u_is_text:new o.Uniform1i(h),u_pitch_with_map:new o.Uniform1i(h),u_texsize:new o.Uniform2f(h),u_texsize_icon:new o.Uniform2f(h),u_texture:new o.Uniform1i(h),u_texture_icon:new o.Uniform1i(h),u_gamma_scale:new o.Uniform1f(h),u_device_pixel_ratio:new o.Uniform1f(h),u_is_halo:new o.Uniform1i(h)}),background:h=>({u_matrix:new o.UniformMatrix4f(h),u_opacity:new o.Uniform1f(h),u_color:new o.UniformColor(h)}),backgroundPattern:h=>({u_matrix:new o.UniformMatrix4f(h),u_opacity:new o.Uniform1f(h),u_image:new o.Uniform1i(h),u_pattern_tl:new o.Uniform2f(h),u_pattern_br:new o.Uniform2f(h),u_texsize:new o.Uniform2f(h),u_pattern_size:new o.Uniform2f(h),u_pixel_coord_upper:new o.Uniform2f(h),u_pixel_coord_lower:new o.Uniform2f(h),u_tile_units_to_pixels:new o.Uniform1f(h)}),terrainRaster:al,terrainDepth:al,skybox:h=>({u_matrix:new o.UniformMatrix4f(h),u_sun_direction:new o.Uniform3f(h),u_cubemap:new o.Uniform1i(h),u_opacity:new o.Uniform1f(h),u_temporal_offset:new o.Uniform1f(h)}),skyboxGradient:h=>({u_matrix:new o.UniformMatrix4f(h),u_color_ramp:new o.Uniform1i(h),u_center_direction:new o.Uniform3f(h),u_radius:new o.Uniform1f(h),u_opacity:new o.Uniform1f(h),u_temporal_offset:new o.Uniform1f(h)}),skyboxCapture:h=>({u_matrix_3f:new o.UniformMatrix3f(h),u_sun_direction:new o.Uniform3f(h),u_sun_intensity:new o.Uniform1f(h),u_color_tint_r:new o.Uniform4f(h),u_color_tint_m:new o.Uniform4f(h),u_luminance:new o.Uniform1f(h)}),globeRaster:h=>({u_proj_matrix:new o.UniformMatrix4f(h),u_globe_matrix:new o.UniformMatrix4f(h),u_normalize_matrix:new o.UniformMatrix4f(h),u_merc_matrix:new o.UniformMatrix4f(h),u_zoom_transition:new o.Uniform1f(h),u_merc_center:new o.Uniform2f(h),u_image0:new o.Uniform1i(h),u_grid_matrix:new o.UniformMatrix3f(h),u_frustum_tl:new o.Uniform3f(h),u_frustum_tr:new o.Uniform3f(h),u_frustum_br:new o.Uniform3f(h),u_frustum_bl:new o.Uniform3f(h),u_globe_pos:new o.Uniform3f(h),u_globe_radius:new o.Uniform1f(h),u_viewport:new o.Uniform2f(h)}),globeAtmosphere:h=>({u_frustum_tl:new o.Uniform3f(h),u_frustum_tr:new o.Uniform3f(h),u_frustum_br:new o.Uniform3f(h),u_frustum_bl:new o.Uniform3f(h),u_horizon:new o.Uniform1f(h),u_transition:new o.Uniform1f(h),u_fadeout_range:new o.Uniform1f(h),u_color:new o.Uniform4f(h),u_high_color:new o.Uniform4f(h),u_space_color:new o.Uniform4f(h),u_star_intensity:new o.Uniform1f(h),u_star_density:new o.Uniform1f(h),u_star_size:new o.Uniform1f(h),u_temporal_offset:new o.Uniform1f(h),u_horizon_angle:new o.Uniform1f(h),u_rotation_matrix:new o.UniformMatrix4f(h)})};let la;function af(h,r,l,p,_,x,T){const C=h.context,M=C.gl,R=h.transform,L=h.useProgram("collisionBox"),U=[];let G=0,Q=0;for(let he=0;he<p.length;he++){const we=p[he],ve=r.getTile(we),Pe=ve.getBucket(l);if(!Pe)continue;const He=Ka(we,Pe,R);let qe=He;_[0]===0&&_[1]===0||(qe=h.translatePosMatrix(He,ve,_,x));const Le=T?Pe.textCollisionBox:Pe.iconCollisionBox,It=Pe.collisionCircleArray;if(It.length>0){const Ue=o.create(),st=qe;o.mul(Ue,Pe.placementInvProjMatrix,R.glCoordMatrix),o.mul(Ue,Ue,Pe.placementViewportMatrix),U.push({circleArray:It,circleOffset:Q,transform:st,invTransform:Ue,projection:Pe.getProjection()}),G+=It.length/4,Q=G}Le&&(h.terrain&&h.terrain.setupElevationDraw(ve,L),L.draw(C,M.LINES,o.DepthMode.disabled,o.StencilMode.disabled,h.colorModeForRenderPass(),o.CullFaceMode.disabled,cl(qe,R,ve,Pe.getProjection()),l.id,Le.layoutVertexBuffer,Le.indexBuffer,Le.segments,null,R.zoom,null,[Le.collisionVertexBuffer,Le.collisionVertexBufferExt]))}if(!T||!U.length)return;const K=h.useProgram("collisionCircle"),J=new o.StructArrayLayout2f1f2i16;J.resize(4*G),J._trim();let H=0;for(const he of U)for(let we=0;we<he.circleArray.length/4;we++){const ve=4*we,Pe=he.circleArray[ve+0],He=he.circleArray[ve+1],qe=he.circleArray[ve+2],Le=he.circleArray[ve+3];J.emplace(H++,Pe,He,qe,Le,0),J.emplace(H++,Pe,He,qe,Le,1),J.emplace(H++,Pe,He,qe,Le,2),J.emplace(H++,Pe,He,qe,Le,3)}(!la||la.length<2*G)&&(la=function(he){const we=2*he,ve=new o.StructArrayLayout3ui6;ve.resize(we),ve._trim();for(let Pe=0;Pe<we;Pe++){const He=6*Pe;ve.uint16[He+0]=4*Pe+0,ve.uint16[He+1]=4*Pe+1,ve.uint16[He+2]=4*Pe+2,ve.uint16[He+3]=4*Pe+2,ve.uint16[He+4]=4*Pe+3,ve.uint16[He+5]=4*Pe+0}return ve}(G));const W=C.createIndexBuffer(la,!0),ie=C.createVertexBuffer(J,o.collisionCircleLayout.members,!0);for(const he of U){const we={u_matrix:he.transform,u_inv_matrix:he.invTransform,u_camera_to_center_distance:(ee=R).getCameraToCenterDistance(he.projection),u_viewport_size:[ee.width,ee.height]};K.draw(C,M.TRIANGLES,o.DepthMode.disabled,o.StencilMode.disabled,h.colorModeForRenderPass(),o.CullFaceMode.disabled,we,l.id,ie,W,o.SegmentVector.simpleSegment(0,2*he.circleOffset,he.circleArray.length,he.circleArray.length/2),null,R.zoom)}var ee;ie.destroy(),W.destroy()}const ul=o.create();function _g({width:h,height:r,anchor:l,textOffset:p,textScale:_},x){const{horizontalAlign:T,verticalAlign:C}=o.getAnchorAlignment(l),M=-(T-.5)*h,R=-(C-.5)*r,L=o.evaluateVariableOffset(l,p);return new o.pointGeometry((M/_+L[0])*x,(R/_+L[1])*x)}function lf(h,r,l,p,_,x,T,C,M,R,L){const U=h.text.placedSymbolArray,G=h.text.dynamicLayoutVertexArray,Q=h.icon.dynamicLayoutVertexArray,K={},J=h.getProjection(),H=Ya(C,J,x),W=x.elevation,ie=J.upVectorScale(C.canonical,x.center.lat,x.worldSize).metersToTile;G.clear();for(let ee=0;ee<U.length;ee++){const he=U.get(ee),{tileAnchorX:we,tileAnchorY:ve,numGlyphs:Pe}=he,He=h.allowVerticalPlacement&&!he.placedOrientation,qe=he.hidden||!he.crossTileID||He?null:p[he.crossTileID];if(qe){let Le=0,It=0,Ue=0;if(W){const Qt=W?W.getAtTileOffset(C,we,ve):0,[ln,Jt,mn]=J.upVector(C.canonical,we,ve);Le=Qt*ln*ie,It=Qt*Jt*ie,Ue=Qt*mn*ie}let[st,Xe,Et,Je]=br(he.projectedAnchorX+Le,he.projectedAnchorY+It,he.projectedAnchorZ+Ue,l?H:T);const pt=jt(x.getCameraToCenterDistance(J),Je);let Pt=_.evaluateSizeForFeature(h.textSizeData,R,he)*pt/o.ONE_EM;l&&(Pt*=h.tilePixelRatio/M);const De=_g(qe,Pt);l?({x:st,y:Xe,z:Et}=J.projectTilePoint(we+De.x,ve+De.y,C.canonical),[st,Xe,Et]=br(st+Le,Xe+It,Et+Ue,T)):(r&&De._rotate(-x.angle),st+=De.x,Xe+=De.y,Et=0);const We=h.allowVerticalPlacement&&he.placedOrientation===o.WritingMode.vertical?Math.PI/2:0;for(let Qt=0;Qt<Pe;Qt++)o.addDynamicAttributes(G,st,Xe,Et,We);L&&he.associatedIconIndex>=0&&(K[he.associatedIconIndex]={x:st,y:Xe,z:Et,angle:We})}else nr(Pe,G)}if(L){Q.clear();const ee=h.icon.placedSymbolArray;for(let he=0;he<ee.length;he++){const we=ee.get(he),{numGlyphs:ve}=we,Pe=K[he];if(we.hidden||!Pe)nr(ve,Q);else{const{x:He,y:qe,z:Le,angle:It}=Pe;for(let Ue=0;Ue<ve;Ue++)o.addDynamicAttributes(Q,He,qe,Le,It)}}h.icon.dynamicLayoutVertexBuffer.updateData(Q)}h.text.dynamicLayoutVertexBuffer.updateData(G)}function cf(h,r,l){return l.iconsInText&&r?"symbolTextAndIcon":h?"symbolSDF":"symbolIcon"}function Ms(h,r,l,p,_,x,T,C,M,R,L,U){const G=h.context,Q=G.gl,K=h.transform,J=C==="map",H=M==="map",W=J&&l.layout.get("symbol-placement")!=="point",ie=J&&!H&&!W,ee=l.layout.get("symbol-sort-key").constantOr(1)!==void 0;let he=!1;const we=h.depthModeForSublayer(0,o.DepthMode.ReadOnly),ve=[o.mercatorXfromLng(K.center.lng),o.mercatorYfromLat(K.center.lat)],Pe=l.layout.get("text-variable-anchor"),He=K.projection.name==="globe",qe=[],Le=[0,-1,0];let It=Le;!He&&!K.mercatorFromTransition||J||(It=function(Ue){const st=Ue._camera.getWorldToCamera(Ue.worldSize,1),Xe=o.multiply([],st,Ue.globeMatrix);o.invert(Xe,Xe);const Et=[0,0,0],Je=[0,1,0,0];return o.transformMat4$1(Je,Je,Xe),Et[0]=Je[0],Et[1]=Je[1],Et[2]=Je[2],o.normalize(Et,Et),Et}(K));for(const Ue of p){const st=r.getTile(Ue),Xe=st.getBucket(l);if(!Xe||Xe.projection.name==="mercator"&&He)continue;const Et=_?Xe.text:Xe.icon;if(!Et||Xe.fullyClipped||!Et.segments.get().length)continue;const Je=Et.programConfigurations.get(l.id),pt=_||Xe.sdfIcons,Pt=_?Xe.textSizeData:Xe.iconSizeData,De=H||K.pitch!==0,We=o.evaluateSizeForZoom(Pt,K.zoom);let Qt,ln,Jt,mn,Tn=[0,0],cn=null;if(_){if(ln=st.glyphAtlasTexture,Jt=Q.LINEAR,Qt=st.glyphAtlasTexture.size,Xe.iconsInText){Tn=st.imageAtlasTexture.size,cn=st.imageAtlasTexture;const Kr=Pt.kind==="composite"||Pt.kind==="camera";mn=De||h.options.rotating||h.options.zooming||Kr?Q.LINEAR:Q.NEAREST}}else{const Kr=l.layout.get("icon-size").constantOr(0)!==1||Xe.iconsNeedLinear;ln=st.imageAtlasTexture,Jt=pt||h.options.rotating||h.options.zooming||Kr||De?Q.LINEAR:Q.NEAREST,Qt=st.imageAtlasTexture.size}const Gt=Xe.projection.name==="globe",ei=Gt?It:Le,Hn=Gt?o.globeToMercatorTransition(K.zoom):0,li=Ya(Ue,Xe.getProjection(),K),ii=K.calculatePixelsToTileUnitsMatrix(st),Pr=qr(li,st.tileID.canonical,H,J,K,Xe.getProjection(),ii),$r=h.terrain&&H&&W?o.invert(o.create(),Pr):ul,wr=jd(li,st.tileID.canonical,H,J,K,Xe.getProjection(),ii),yo=Pe&&Xe.hasTextData(),gi=l.layout.get("icon-text-fit")!=="none"&&yo&&Xe.hasIconData();if(W){const Kr=K.elevation,vo=Kr?Kr.getAtTileOffsetFunc(Ue,K.center.lat,K.worldSize,Xe.getProjection()):null,xo=ic(li,st.tileID.canonical,H,J,K,Xe.getProjection(),ii);Ln(Xe,li,h,_,xo,wr,H,R,vo,Ue)}const ci=W||_&&Pe||gi,Gn=h.translatePosMatrix(li,st,x,T),Ri=ci?ul:Pr,fr=h.translatePosMatrix(wr,st,x,T,!0),di=Xe.getProjection().createInversionMatrix(K,Ue.canonical),Er=[];h.terrainRenderModeElevated()&&H&&Er.push("PITCH_WITH_MAP_TERRAIN"),Gt&&Er.push("PROJECTION_GLOBE_VIEW"),ci&&Er.push("PROJECTED_POS_ON_VIEWPORT");const bl=pt&&l.paint.get(_?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let No;No=pt?Xe.iconsInText?Sc(Pt.kind,We,ie,H,h,Gn,Ri,fr,Qt,Tn,Ue,Hn,ve,di,ei,Xe.getProjection()):sf(Pt.kind,We,ie,H,h,Gn,Ri,fr,_,Qt,!0,Ue,Hn,ve,di,ei,Xe.getProjection()):Tc(Pt.kind,We,ie,H,h,Gn,Ri,fr,_,Qt,Ue,Hn,ve,di,ei,Xe.getProjection());const pr={program:h.useProgram(cf(pt,_,Xe),Je,Er),buffers:Et,uniformValues:No,atlasTexture:ln,atlasTextureIcon:cn,atlasInterpolation:Jt,atlasInterpolationIcon:mn,isSDF:pt,hasHalo:bl,tile:st,labelPlaneMatrixInv:$r};if(ee&&Xe.canOverlap){he=!0;const Kr=Et.segments.get();for(const vo of Kr)qe.push({segments:new o.SegmentVector([vo]),sortKey:vo.sortKey,state:pr})}else qe.push({segments:Et.segments,sortKey:0,state:pr})}he&&qe.sort((Ue,st)=>Ue.sortKey-st.sortKey);for(const Ue of qe){const st=Ue.state;if(h.terrain&&h.terrain.setupElevationDraw(st.tile,st.program,{useDepthForOcclusion:!He,labelPlaneMatrixInv:st.labelPlaneMatrixInv}),G.activeTexture.set(Q.TEXTURE0),st.atlasTexture.bind(st.atlasInterpolation,Q.CLAMP_TO_EDGE),st.atlasTextureIcon&&(G.activeTexture.set(Q.TEXTURE1),st.atlasTextureIcon&&st.atlasTextureIcon.bind(st.atlasInterpolationIcon,Q.CLAMP_TO_EDGE)),st.isSDF){const Xe=st.uniformValues;st.hasHalo&&(Xe.u_is_halo=1,uf(st.buffers,Ue.segments,l,h,st.program,we,L,U,Xe)),Xe.u_is_halo=0}uf(st.buffers,Ue.segments,l,h,st.program,we,L,U,st.uniformValues)}}function uf(h,r,l,p,_,x,T,C,M){const R=p.context,L=[h.dynamicLayoutVertexBuffer,h.opacityVertexBuffer,h.globeExtVertexBuffer];_.draw(R,R.gl.TRIANGLES,x,T,C,o.CullFaceMode.disabled,M,l.id,h.layoutVertexBuffer,h.indexBuffer,r,l.paint,p.transform.zoom,h.programConfigurations.get(l.id),L)}function hf(h,r,l,p,_,x,T){const C=h.context.gl,M=l.paint.get("fill-pattern"),R=M&&M.constantOr(1);let L,U,G,Q,K;T?(U=R&&!l.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",L=C.LINES):(U=R?"fillPattern":"fill",L=C.TRIANGLES);for(const J of p){const H=r.getTile(J);if(R&&!H.patternsLoaded())continue;const W=H.getBucket(l);if(!W)continue;h.prepareDrawTile();const ie=W.programConfigurations.get(l.id),ee=h.useProgram(U,ie);R&&(h.context.activeTexture.set(C.TEXTURE0),H.imageAtlasTexture.bind(C.LINEAR,C.CLAMP_TO_EDGE),ie.updatePaintBuffers());const he=M.constantOr(null);if(he&&H.imageAtlas){const ve=H.imageAtlas.patternPositions[he.toString()];ve&&ie.setConstantPatternPositions(ve)}const we=h.translatePosMatrix(J.projMatrix,H,l.paint.get("fill-translate"),l.paint.get("fill-translate-anchor"));if(T){Q=W.indexBuffer2,K=W.segments2;const ve=h.terrain&&h.terrain.renderingToTexture?h.terrain.drapeBufferSize:[C.drawingBufferWidth,C.drawingBufferHeight];G=U==="fillOutlinePattern"&&R?th(we,h,H,ve):eh(we,ve)}else Q=W.indexBuffer,K=W.segments,G=R?xc(we,h,H):vc(we);h.prepareDrawProgram(h.context,ee,J.toUnwrapped()),ee.draw(h.context,L,_,h.stencilModeForClipping(J),x,o.CullFaceMode.disabled,G,l.id,W.layoutVertexBuffer,Q,K,l.paint,h.transform.zoom,ie)}}function sh(h,r,l,p,_,x,T){const C=h.context,M=C.gl,R=h.transform,L=l.paint.get("fill-extrusion-pattern"),U=L.constantOr(1),G=l.paint.get("fill-extrusion-opacity"),Q=[l.paint.get("fill-extrusion-ambient-occlusion-intensity"),l.paint.get("fill-extrusion-ambient-occlusion-radius")],K=l.layout.get("fill-extrusion-edge-radius"),J=R.projection.name==="globe"?o.fillExtrusionHeightLift():0,H=R.projection.name==="globe",W=H?o.globeToMercatorTransition(R.zoom):0,ie=[o.mercatorXfromLng(R.center.lng),o.mercatorYfromLat(R.center.lat)],ee=[];H&&(ee.push("PROJECTION_GLOBE_VIEW"),h.style.terrainSetForDrapingOnly()&&ee.push("TERRAIN")),Q[0]>0&&ee.push("FAUX_AO");for(const he of p){const we=r.getTile(he),ve=we.getBucket(l);if(!ve||ve.projection.name!==R.projection.name)continue;const Pe=ve.programConfigurations.get(l.id),He=h.useProgram(U?"fillExtrusionPattern":"fillExtrusion",Pe,ee);if(h.terrain){const Et=h.terrain;if(h.style.terrainSetForDrapingOnly())Et.setupElevationDraw(we,He,{useMeterToDem:!0});else{if(!ve.enableTerrain)continue;if(Et.setupElevationDraw(we,He,{useMeterToDem:!0}),yg(C,r,he,ve,l,Et),!ve.centroidVertexBuffer){const Je=He.attributes.a_centroid_pos;Je!==void 0&&M.vertexAttrib2f(Je,0,0)}}}U&&(h.context.activeTexture.set(M.TEXTURE0),we.imageAtlasTexture.bind(M.LINEAR,M.CLAMP_TO_EDGE),Pe.updatePaintBuffers());const qe=L.constantOr(null);if(qe&&we.imageAtlas){const Et=we.imageAtlas.patternPositions[qe.toString()];Et&&Pe.setConstantPatternPositions(Et)}const Le=h.translatePosMatrix(he.projMatrix,we,l.paint.get("fill-extrusion-translate"),l.paint.get("fill-extrusion-translate-anchor")),It=R.projection.createInversionMatrix(R,he.canonical),Ue=l.paint.get("fill-extrusion-vertical-gradient"),st=U?fg(Le,h,Ue,G,Q,K,he,we,J,W,ie,It):Jd(Le,h,Ue,G,Q,K,he,J,W,ie,It);h.prepareDrawProgram(C,He,he.toUnwrapped());const Xe=[];h.terrain&&Xe.push(ve.centroidVertexBuffer),H&&Xe.push(ve.layoutVertexExtBuffer),He.draw(C,C.gl.TRIANGLES,_,x,T,o.CullFaceMode.backCCW,st,l.id,ve.layoutVertexBuffer,ve.indexBuffer,ve.segments,l.paint,h.transform.zoom,Pe,Xe)}}function yg(h,r,l,p,_,x){const T=[W=>{let ie=W.canonical.x-1,ee=W.wrap;return ie<0&&(ie=(1<<W.canonical.z)-1,ee--),new o.OverscaledTileID(W.overscaledZ,ee,W.canonical.z,ie,W.canonical.y)},W=>{let ie=W.canonical.x+1,ee=W.wrap;return ie===1<<W.canonical.z&&(ie=0,ee++),new o.OverscaledTileID(W.overscaledZ,ee,W.canonical.z,ie,W.canonical.y)},W=>new o.OverscaledTileID(W.overscaledZ,W.wrap,W.canonical.z,W.canonical.x,(W.canonical.y===0?1<<W.canonical.z:W.canonical.y)-1),W=>new o.OverscaledTileID(W.overscaledZ,W.wrap,W.canonical.z,W.canonical.x,W.canonical.y===(1<<W.canonical.z)-1?0:W.canonical.y+1)],C=W=>{const ie=r.getSource().minzoom,ee=we=>{const ve=r.getTileByID(we);if(ve&&ve.hasData())return ve.getBucket(_)},he=[0,-1,1];for(const we of he){if(W.overscaledZ+we<ie)continue;const ve=ee(W.calculateScaledKey(W.overscaledZ+we));if(ve)return ve}},M=[0,0,0],R=(W,ie)=>(M[0]=Math.min(W.min.y,ie.min.y),M[1]=Math.max(W.max.y,ie.max.y),M[2]=o.EXTENT-ie.min.x>W.max.x?ie.min.x-o.EXTENT:W.max.x,M),L=(W,ie)=>(M[0]=Math.min(W.min.x,ie.min.x),M[1]=Math.max(W.max.x,ie.max.x),M[2]=o.EXTENT-ie.min.y>W.max.y?ie.min.y-o.EXTENT:W.max.y,M),U=[(W,ie)=>R(W,ie),(W,ie)=>R(ie,W),(W,ie)=>L(W,ie),(W,ie)=>L(ie,W)],G=new o.pointGeometry(0,0);let Q,K,J;const H=(W,ie,ee,he,we)=>{const ve=[[he?ee:W,he?W:ee,0],[he?ee:ie,he?ie:ee,0]],Pe=we<0?o.EXTENT+we:we,He=[he?Pe:(W+ie)/2,he?(W+ie)/2:Pe,0];return ee===0&&we<0||ee!==0&&we>0?x.getForTilePoints(J,[He],!0,K):ve.push(He),x.getForTilePoints(l,ve,!0,Q),Math.max(ve[0][2],ve[1][2],He[2])/x.exaggeration()};for(let W=0;W<4;W++){const ie=(W<2?1:5)-W,ee=p.borders[W];if(ee.length===0)continue;const he=J=T[W](l),we=C(he);if(!(we&&we instanceof o.FillExtrusionBucket&&we.enableTerrain)||p.borderDoneWithNeighborZ[W]===we.canonical.z&&we.borderDoneWithNeighborZ[ie]===p.canonical.z||(K=x.findDEMTileFor(he),!K||!K.dem))continue;if(!Q){const qe=x.findDEMTileFor(l);if(!qe||!qe.dem)return;Q=qe}const ve=we.borders[ie];let Pe=0;const He=we.borderDoneWithNeighborZ[ie]!==p.canonical.z;if(p.canonical.z===we.canonical.z){for(let qe=0;qe<ee.length;qe++){const Le=p.featuresOnBorder[ee[qe]],It=Le.borders[W];let Ue;for(;Pe<ve.length&&(Ue=we.featuresOnBorder[ve[Pe]],!(Ue.borders[ie][1]>It[0]+3));)He&&we.encodeCentroid(void 0,Ue,!1),Pe++;if(Ue&&Pe<ve.length){const st=Pe;let Xe=0;for(;!(Ue.borders[ie][0]>It[1]-3)&&(Xe++,++Pe!==ve.length);)Ue=we.featuresOnBorder[ve[Pe]];if(Ue=we.featuresOnBorder[ve[st]],Le.intersectsCount()>1||Ue.intersectsCount()>1||Xe!==1){Xe!==1&&(Pe=st),p.encodeCentroid(void 0,Le,!1),He&&we.encodeCentroid(void 0,Ue,!1);continue}const Et=U[W](Le,Ue),Je=W%2?o.EXTENT-1:0;G.x=H(Et[0],Math.min(o.EXTENT-1,Et[1]),Je,W<2,Et[2]),G.y=0,p.encodeCentroid(G,Le,!1),He&&we.encodeCentroid(G,Ue,!1)}else p.encodeCentroid(void 0,Le,!1)}p.borderDoneWithNeighborZ[W]=we.canonical.z,p.needsCentroidUpdate=!0,He&&(we.borderDoneWithNeighborZ[ie]=p.canonical.z,we.needsCentroidUpdate=!0)}else{for(const qe of ee)p.encodeCentroid(void 0,p.featuresOnBorder[qe],!1);if(He){for(const qe of ve)we.encodeCentroid(void 0,we.featuresOnBorder[qe],!1);we.borderDoneWithNeighborZ[ie]=p.canonical.z,we.needsCentroidUpdate=!0}p.borderDoneWithNeighborZ[W]=we.canonical.z,p.needsCentroidUpdate=!0}}(p.needsCentroidUpdate||!p.centroidVertexBuffer&&p.centroidVertexArray.length!==0)&&p.uploadCentroid(h)}const vg=new o.Color(1,0,0,1),xg=new o.Color(0,1,0,1),ah=new o.Color(0,0,1,1),lh=new o.Color(1,0,1,1),df=new o.Color(0,1,1,1);function ff(h,r,l){const p=h.context,_=h.transform,x=p.gl,T=_.projection.name==="globe",C=T?["PROJECTION_GLOBE_VIEW"]:null;let M=l.projMatrix;if(T&&o.globeToMercatorTransition(_.zoom)>0){const Le=o.transitionTileAABBinECEF(l.canonical,_),It=o.globeDenormalizeECEF(Le);M=o.multiply(new Float32Array(16),_.globeMatrix,It),o.multiply(M,_.projMatrix,M)}const R=h.useProgram("debug",null,C),L=r.getTileByID(l.key);h.terrain&&h.terrain.setupElevationDraw(L,R);const U=o.DepthMode.disabled,G=o.StencilMode.disabled,Q=h.colorModeForRenderPass(),K="$debug";p.activeTexture.set(x.TEXTURE0),h.emptyTexture.bind(x.LINEAR,x.CLAMP_TO_EDGE),T?L._makeGlobeTileDebugBuffers(h.context,_):L._makeDebugTileBoundsBuffers(h.context,_.projection);const J=L._tileDebugBuffer||h.debugBuffer,H=L._tileDebugIndexBuffer||h.debugIndexBuffer,W=L._tileDebugSegments||h.debugSegments;R.draw(p,x.LINE_STRIP,U,G,Q,o.CullFaceMode.disabled,aa(M,o.Color.red),K,J,H,W,null,null,null,[L._globeTileDebugBorderBuffer]);const ie=L.latestRawTileData,ee=Math.floor((ie&&ie.byteLength||0)/1024),he=r.getTile(l).tileSize,we=512/Math.min(he,512)*(l.overscaledZ/_.zoom)*.5;let ve=l.canonical.toString();l.overscaledZ!==l.canonical.z&&(ve+=` => ${l.overscaledZ}`),ve+=` ${ee}kb`,function(Le,It){Le.initDebugOverlayCanvas();const Ue=Le.debugOverlayCanvas,st=Le.context.gl,Xe=Le.debugOverlayCanvas.getContext("2d");Xe.clearRect(0,0,Ue.width,Ue.height),Xe.shadowColor="white",Xe.shadowBlur=2,Xe.lineWidth=1.5,Xe.strokeStyle="white",Xe.textBaseline="top",Xe.font="bold 36px Open Sans, sans-serif",Xe.fillText(It,5,5),Xe.strokeText(It,5,5),Le.debugOverlayTexture.update(Ue),Le.debugOverlayTexture.bind(st.LINEAR,st.CLAMP_TO_EDGE)}(h,ve);const Pe=L._tileDebugTextBuffer||h.debugBuffer,He=L._tileDebugTextIndexBuffer||h.quadTriangleIndexBuffer,qe=L._tileDebugTextSegments||h.debugSegments;R.draw(p,x.TRIANGLES,U,G,o.ColorMode.alphaBlended,o.CullFaceMode.disabled,aa(M,o.Color.transparent,we),K,Pe,He,qe,null,null,null,[L._globeTileDebugTextBuffer])}function ch(h,r,l,p){go(h,0,r+l/2,h.transform.width,l,p)}function Cc(h,r,l,p){go(h,r-l/2,0,l,h.transform.height,p)}function go(h,r,l,p,_,x){const T=h.context,C=T.gl;C.enable(C.SCISSOR_TEST),C.scissor(r*o.exported.devicePixelRatio,l*o.exported.devicePixelRatio,p*o.exported.devicePixelRatio,_*o.exported.devicePixelRatio),T.clear({color:x}),C.disable(C.SCISSOR_TEST)}const hl=o.createLayout([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:pf}=hl;function jr(h,r,l,p){h.emplaceBack(r,l,p)}class Is{constructor(r){this.vertexArray=new o.StructArrayLayout3f12,this.indices=new o.StructArrayLayout3ui6,jr(this.vertexArray,-1,-1,1),jr(this.vertexArray,1,-1,1),jr(this.vertexArray,-1,1,1),jr(this.vertexArray,1,1,1),jr(this.vertexArray,-1,-1,-1),jr(this.vertexArray,1,-1,-1),jr(this.vertexArray,-1,1,-1),jr(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=r.createVertexBuffer(this.vertexArray,pf),this.indexBuffer=r.createIndexBuffer(this.indices),this.segment=o.SegmentVector.simpleSegment(0,0,36,12)}}function ks(h,r,l,p,_,x){const T=h.gl,C=r.paint.get("sky-atmosphere-color"),M=r.paint.get("sky-atmosphere-halo-color"),R=r.paint.get("sky-atmosphere-sun-intensity"),L=((U,G,Q,K,J)=>({u_matrix_3f:U,u_sun_direction:G,u_sun_intensity:Q,u_color_tint_r:[K.r,K.g,K.b,K.a],u_color_tint_m:[J.r,J.g,J.b,J.a],u_luminance:5e-5}))(o.fromMat4(o.create$1(),p),_,R,C,M);T.framebufferTexture2D(T.FRAMEBUFFER,T.COLOR_ATTACHMENT0,T.TEXTURE_CUBE_MAP_POSITIVE_X+x,r.skyboxTexture,0),l.draw(h,T.TRIANGLES,o.DepthMode.disabled,o.StencilMode.disabled,o.ColorMode.unblended,o.CullFaceMode.frontCW,L,"skyboxCapture",r.skyboxGeometry.vertexBuffer,r.skyboxGeometry.indexBuffer,r.skyboxGeometry.segment)}const uh=o.createLayout([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class Kn{constructor(r){const l=new o.StructArrayLayout5f20;l.emplaceBack(-1,1,1,0,0),l.emplaceBack(1,1,1,1,0),l.emplaceBack(1,-1,1,1,1),l.emplaceBack(-1,-1,1,0,1);const p=new o.StructArrayLayout3ui6;p.emplaceBack(0,1,2),p.emplaceBack(2,3,0),this.vertexBuffer=r.createVertexBuffer(l,uh.members),this.indexBuffer=r.createIndexBuffer(p),this.segments=o.SegmentVector.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const dl={symbol:function(h,r,l,p,_){if(h.renderPass!=="translucent")return;const x=o.StencilMode.disabled,T=h.colorModeForRenderPass();l.layout.get("text-variable-anchor")&&function(C,M,R,L,U,G,Q){const K=M.transform,J=U==="map",H=G==="map";for(const W of C){const ie=L.getTile(W),ee=ie.getBucket(R);if(!ee||!ee.text||!ee.text.segments.get().length)continue;const he=o.evaluateSizeForZoom(ee.textSizeData,K.zoom),we=Ya(W,ee.getProjection(),K),ve=K.calculatePixelsToTileUnitsMatrix(ie),Pe=qr(we,ie.tileID.canonical,H,J,K,ee.getProjection(),ve),He=R.layout.get("icon-text-fit")!=="none"&&ee.hasIconData();if(he){const qe=Math.pow(2,K.zoom-ie.tileID.overscaledZ);lf(ee,J,H,Q,o.symbolSize,K,Pe,W,qe,he,He)}}}(p,h,l,r,l.layout.get("text-rotation-alignment"),l.layout.get("text-pitch-alignment"),_),l.paint.get("icon-opacity").constantOr(1)!==0&&Ms(h,r,l,p,!1,l.paint.get("icon-translate"),l.paint.get("icon-translate-anchor"),l.layout.get("icon-rotation-alignment"),l.layout.get("icon-pitch-alignment"),l.layout.get("icon-keep-upright"),x,T),l.paint.get("text-opacity").constantOr(1)!==0&&Ms(h,r,l,p,!0,l.paint.get("text-translate"),l.paint.get("text-translate-anchor"),l.layout.get("text-rotation-alignment"),l.layout.get("text-pitch-alignment"),l.layout.get("text-keep-upright"),x,T),r.map.showCollisionBoxes&&(af(h,r,l,p,l.paint.get("text-translate"),l.paint.get("text-translate-anchor"),!0),af(h,r,l,p,l.paint.get("icon-translate"),l.paint.get("icon-translate-anchor"),!1))},circle:function(h,r,l,p){if(h.renderPass!=="translucent")return;const _=l.paint.get("circle-opacity"),x=l.paint.get("circle-stroke-width"),T=l.paint.get("circle-stroke-opacity"),C=l.layout.get("circle-sort-key").constantOr(1)!==void 0;if(_.constantOr(1)===0&&(x.constantOr(1)===0||T.constantOr(1)===0))return;const M=h.context,R=M.gl,L=h.transform,U=h.depthModeForSublayer(0,o.DepthMode.ReadOnly),G=o.StencilMode.disabled,Q=h.colorModeForRenderPass(),K=L.projection.name==="globe",J=[o.mercatorXfromLng(L.center.lng),o.mercatorYfromLat(L.center.lat)],H=[];for(let ie=0;ie<p.length;ie++){const ee=p[ie],he=r.getTile(ee),we=he.getBucket(l);if(!we||we.projection.name!==L.projection.name)continue;const ve=we.programConfigurations.get(l.id),Pe=pg(l);K&&Pe.push("PROJECTION_GLOBE_VIEW");const He=h.useProgram("circle",ve,Pe),qe=we.layoutVertexBuffer,Le=we.globeExtVertexBuffer,It=we.indexBuffer,Ue=L.projection.createInversionMatrix(L,ee.canonical),st={programConfiguration:ve,program:He,layoutVertexBuffer:qe,globeExtVertexBuffer:Le,indexBuffer:It,uniformValues:tf(h,ee,he,Ue,J,l),tile:he};if(C){const Xe=we.segments.get();for(const Et of Xe)H.push({segments:new o.SegmentVector([Et]),sortKey:Et.sortKey,state:st})}else H.push({segments:we.segments,sortKey:0,state:st})}C&&H.sort((ie,ee)=>ie.sortKey-ee.sortKey);const W={useDepthForOcclusion:!K};for(const ie of H){const{programConfiguration:ee,program:he,layoutVertexBuffer:we,globeExtVertexBuffer:ve,indexBuffer:Pe,uniformValues:He,tile:qe}=ie.state,Le=ie.segments;h.terrain&&h.terrain.setupElevationDraw(qe,he,W),h.prepareDrawProgram(M,he,qe.tileID.toUnwrapped()),he.draw(M,R.TRIANGLES,U,G,Q,o.CullFaceMode.disabled,He,l.id,we,Pe,Le,l.paint,L.zoom,ee,[ve])}},heatmap:function(h,r,l,p){if(l.paint.get("heatmap-opacity")!==0)if(h.renderPass==="offscreen"){const _=h.context,x=_.gl,T=o.StencilMode.disabled,C=new o.ColorMode([x.ONE,x.ONE],o.Color.transparent,[!0,!0,!0,!0]);(function(Q,K,J,H){const W=Q.gl,ie=K.width*H,ee=K.height*H;Q.activeTexture.set(W.TEXTURE1),Q.viewport.set([0,0,ie,ee]);let he=J.heatmapFbo;if(!he||he&&(he.width!==ie||he.height!==ee)){he&&he.destroy();const we=W.createTexture();W.bindTexture(W.TEXTURE_2D,we),W.texParameteri(W.TEXTURE_2D,W.TEXTURE_WRAP_S,W.CLAMP_TO_EDGE),W.texParameteri(W.TEXTURE_2D,W.TEXTURE_WRAP_T,W.CLAMP_TO_EDGE),W.texParameteri(W.TEXTURE_2D,W.TEXTURE_MIN_FILTER,W.LINEAR),W.texParameteri(W.TEXTURE_2D,W.TEXTURE_MAG_FILTER,W.LINEAR),he=J.heatmapFbo=Q.createFramebuffer(ie,ee,!1),function(ve,Pe,He,qe,Le,It){const Ue=ve.gl;Ue.texImage2D(Ue.TEXTURE_2D,0,Ue.RGBA,Le,It,0,Ue.RGBA,ve.extRenderToTextureHalfFloat?ve.extTextureHalfFloat.HALF_FLOAT_OES:Ue.UNSIGNED_BYTE,null),qe.colorAttachment.set(He)}(Q,0,we,he,ie,ee)}else W.bindTexture(W.TEXTURE_2D,he.colorAttachment.get()),Q.bindFramebuffer.set(he.framebuffer)})(_,h,l,h.transform.projection.name==="globe"?.5:.25),_.clear({color:o.Color.transparent});const M=h.transform,R=M.projection.name==="globe",L=R?["PROJECTION_GLOBE_VIEW"]:null,U=R?o.CullFaceMode.frontCCW:o.CullFaceMode.disabled,G=[o.mercatorXfromLng(M.center.lng),o.mercatorYfromLat(M.center.lat)];for(let Q=0;Q<p.length;Q++){const K=p[Q];if(r.hasRenderableParent(K))continue;const J=r.getTile(K),H=J.getBucket(l);if(!H||H.projection.name!==M.projection.name)continue;const W=H.programConfigurations.get(l.id),ie=h.useProgram("heatmap",W,L),{zoom:ee}=h.transform;h.terrain&&h.terrain.setupElevationDraw(J,ie),h.prepareDrawProgram(_,ie,K.toUnwrapped());const he=M.projection.createInversionMatrix(M,K.canonical);ie.draw(_,x.TRIANGLES,o.DepthMode.disabled,T,C,U,bc(h,K,J,he,G,ee,l.paint.get("heatmap-intensity")),l.id,H.layoutVertexBuffer,H.indexBuffer,H.segments,l.paint,h.transform.zoom,W,R?[H.globeExtVertexBuffer]:null)}_.viewport.set([0,0,h.width,h.height])}else h.renderPass==="translucent"&&(h.context.setColorMode(h.colorModeForRenderPass()),function(_,x){const T=_.context,C=T.gl,M=x.heatmapFbo;if(!M)return;T.activeTexture.set(C.TEXTURE0),C.bindTexture(C.TEXTURE_2D,M.colorAttachment.get()),T.activeTexture.set(C.TEXTURE1);let R=x.colorRampTexture;R||(R=x.colorRampTexture=new o.Texture(T,x.colorRamp,C.RGBA)),R.bind(C.LINEAR,C.CLAMP_TO_EDGE),_.useProgram("heatmapTexture").draw(T,C.TRIANGLES,o.DepthMode.disabled,o.StencilMode.disabled,_.colorModeForRenderPass(),o.CullFaceMode.disabled,((L,U,G,Q)=>({u_image:0,u_color_ramp:1,u_opacity:U.paint.get("heatmap-opacity")}))(0,x),x.id,_.viewportBuffer,_.quadTriangleIndexBuffer,_.viewportSegments,x.paint,_.transform.zoom)}(h,l))},line:function(h,r,l,p){if(h.renderPass!=="translucent")return;const _=l.paint.get("line-opacity"),x=l.paint.get("line-width");if(_.constantOr(1)===0||x.constantOr(1)===0)return;const T=h.depthModeForSublayer(0,o.DepthMode.ReadOnly),C=h.colorModeForRenderPass(),M=h.terrain&&h.terrain.renderingToTexture?1:o.exported.devicePixelRatio,R=l.paint.get("line-dasharray"),L=R.constantOr(1),U=l.layout.get("line-cap"),G=l.paint.get("line-pattern"),Q=G.constantOr(1),K=l.paint.get("line-gradient"),J=Q?"linePattern":"line",H=h.context,W=H.gl,ie=(he=>{const we=[];Ec(he)&&we.push("RENDER_LINE_DASH"),he.paint.get("line-gradient")&&we.push("RENDER_LINE_GRADIENT");const ve=he.paint.get("line-trim-offset");ve[0]===0&&ve[1]===0||we.push("RENDER_LINE_TRIM_OFFSET");const Pe=he.paint.get("line-pattern").constantOr(1),He=he.paint.get("line-opacity").constantOr(1)!==1;return!Pe&&He&&we.push("RENDER_LINE_ALPHA_DISCARD"),we})(l);let ee=ie.includes("RENDER_LINE_ALPHA_DISCARD");h.terrain&&h.terrain.clipOrMaskOverlapStencilType()&&(ee=!1);for(const he of p){const we=r.getTile(he);if(Q&&!we.patternsLoaded())continue;const ve=we.getBucket(l);if(!ve)continue;h.prepareDrawTile();const Pe=ve.programConfigurations.get(l.id),He=h.useProgram(J,Pe,ie),qe=G.constantOr(null);if(qe&&we.imageAtlas){const pt=we.imageAtlas.patternPositions[qe.toString()];pt&&Pe.setConstantPatternPositions(pt)}const Le=R.constantOr(null),It=U.constantOr(null);if(!Q&&Le&&It&&we.lineAtlas){const pt=we.lineAtlas.getDash(Le,It);pt&&Pe.setConstantPatternPositions(pt)}let[Ue,st]=l.paint.get("line-trim-offset");(It==="round"||It==="square")&&Ue!==st&&(Ue===0&&(Ue-=1),st===1&&(st+=1));const Xe=h.terrain?he.projMatrix:null,Et=Q?mo(h,we,l,Xe,M):nh(h,we,l,Xe,ve.lineClipsArray.length,M,[Ue,st]);if(K){const pt=ve.gradients[l.id];let Pt=pt.texture;if(l.gradientVersion!==pt.version){let De=256;if(l.stepInterpolant){const We=r.getSource().maxzoom,Qt=he.canonical.z===We?Math.ceil(1<<h.transform.maxZoom-he.canonical.z):1;De=o.clamp(o.nextPowerOfTwo(ve.maxLineLength/o.EXTENT*1024*Qt),256,H.maxTextureSize)}pt.gradient=o.renderColorRamp({expression:l.gradientExpression(),evaluationKey:"lineProgress",resolution:De,image:pt.gradient||void 0,clips:ve.lineClipsArray}),pt.texture?pt.texture.update(pt.gradient):pt.texture=new o.Texture(H,pt.gradient,W.RGBA),pt.version=l.gradientVersion,Pt=pt.texture}H.activeTexture.set(W.TEXTURE1),Pt.bind(l.stepInterpolant?W.NEAREST:W.LINEAR,W.CLAMP_TO_EDGE)}L&&(H.activeTexture.set(W.TEXTURE0),we.lineAtlasTexture.bind(W.LINEAR,W.REPEAT),Pe.updatePaintBuffers()),Q&&(H.activeTexture.set(W.TEXTURE0),we.imageAtlasTexture.bind(W.LINEAR,W.CLAMP_TO_EDGE),Pe.updatePaintBuffers()),h.prepareDrawProgram(H,He,he.toUnwrapped());const Je=pt=>{He.draw(H,W.TRIANGLES,T,pt,C,o.CullFaceMode.disabled,Et,l.id,ve.layoutVertexBuffer,ve.indexBuffer,ve.segments,l.paint,h.transform.zoom,Pe,[ve.layoutVertexBuffer2])};if(ee){const pt=h.stencilModeForClipping(he).ref;pt===0&&h.terrain&&H.clear({stencil:0});const Pt={func:W.EQUAL,mask:255};Et.u_alpha_discard_threshold=.8,Je(new o.StencilMode(Pt,pt,255,W.KEEP,W.KEEP,W.INVERT)),Et.u_alpha_discard_threshold=0,Je(new o.StencilMode(Pt,pt,255,W.KEEP,W.KEEP,W.KEEP))}else Je(h.stencilModeForClipping(he))}ee&&(h.resetStencilClippingMasks(),h.terrain&&H.clear({stencil:0}))},fill:function(h,r,l,p){const _=l.paint.get("fill-color"),x=l.paint.get("fill-opacity");if(x.constantOr(1)===0)return;const T=h.colorModeForRenderPass(),C=l.paint.get("fill-pattern"),M=h.opaquePassEnabledForLayer()&&!C.constantOr(1)&&_.constantOr(o.Color.transparent).a===1&&x.constantOr(0)===1?"opaque":"translucent";if(h.renderPass===M){const R=h.depthModeForSublayer(1,h.renderPass==="opaque"?o.DepthMode.ReadWrite:o.DepthMode.ReadOnly);hf(h,r,l,p,R,T,!1)}if(h.renderPass==="translucent"&&l.paint.get("fill-antialias")){const R=h.depthModeForSublayer(l.getPaintProperty("fill-outline-color")?2:0,o.DepthMode.ReadOnly);hf(h,r,l,p,R,T,!0)}},"fill-extrusion":function(h,r,l,p){const _=l.paint.get("fill-extrusion-opacity");if(_!==0&&h.renderPass==="translucent"){const x=new o.DepthMode(h.context.gl.LEQUAL,o.DepthMode.ReadWrite,h.depthRangeFor3D);if(_!==1||l.paint.get("fill-extrusion-pattern").constantOr(1))sh(h,r,l,p,x,o.StencilMode.disabled,o.ColorMode.disabled),sh(h,r,l,p,x,h.stencilModeFor3D(),h.colorModeForRenderPass()),h.resetStencilClippingMasks();else{const T=h.colorModeForRenderPass();sh(h,r,l,p,x,o.StencilMode.disabled,T)}}},hillshade:function(h,r,l,p){if(h.renderPass!=="offscreen"&&h.renderPass!=="translucent")return;const _=h.context,x=h.depthModeForSublayer(0,o.DepthMode.ReadOnly),T=h.colorModeForRenderPass(),C=h.terrain&&h.terrain.renderingToTexture,[M,R]=h.renderPass!=="translucent"||C?[{},p]:h.stencilConfigForOverlap(p);for(const L of R){const U=r.getTile(L);if(U.needsHillshadePrepare&&h.renderPass==="offscreen")dc(h,U,l,x,o.StencilMode.disabled,T);else if(h.renderPass==="translucent"){const G=C&&h.terrain?h.terrain.stencilModeForRTTOverlap(L):M[L.overscaledZ];Ku(h,L,U,l,x,G,T)}}_.viewport.set([0,0,h.width,h.height]),h.resetStencilClippingMasks()},raster:function(h,r,l,p,_,x){if(h.renderPass!=="translucent"||l.paint.get("raster-opacity")===0||!p.length)return;const T=h.context,C=T.gl,M=r.getSource(),R=h.useProgram("raster"),L=h.colorModeForRenderPass(),U=h.terrain&&h.terrain.renderingToTexture,[G,Q]=M instanceof Te||U?[{},p]:h.stencilConfigForOverlap(p),K=Q[Q.length-1].overscaledZ,J=!h.options.moving;for(const H of Q){const W=U?o.DepthMode.disabled:h.depthModeForSublayer(H.overscaledZ-K,l.paint.get("raster-opacity")===1?o.DepthMode.ReadWrite:o.DepthMode.ReadOnly,C.LESS),ie=H.toUnwrapped(),ee=r.getTile(H);if(U&&(!ee||!ee.hasData()))continue;const he=U?H.projMatrix:h.transform.calculateProjMatrix(ie,J),we=h.terrain&&U?h.terrain.stencilModeForRTTOverlap(H):G[H.overscaledZ],ve=x?0:l.paint.get("raster-fade-duration");ee.registerFadeDuration(ve);const Pe=r.findLoadedParent(H,0),He=gc(ee,Pe,r,h.transform,ve);let qe,Le;h.terrain&&h.terrain.prepareDrawTile();const It=l.paint.get("raster-resampling")==="nearest"?C.NEAREST:C.LINEAR;T.activeTexture.set(C.TEXTURE0),ee.texture.bind(It,C.CLAMP_TO_EDGE),T.activeTexture.set(C.TEXTURE1),Pe?(Pe.texture.bind(It,C.CLAMP_TO_EDGE),qe=Math.pow(2,Pe.tileID.overscaledZ-ee.tileID.overscaledZ),Le=[ee.tileID.canonical.x*qe%1,ee.tileID.canonical.y*qe%1]):ee.texture.bind(It,C.CLAMP_TO_EDGE);const Ue=rf(he,Le||[0,0],qe||1,He,l,M instanceof Te?M.perspectiveTransform:[0,0]);if(h.prepareDrawProgram(T,R,ie),M instanceof Te)M.boundsBuffer&&M.boundsSegments&&R.draw(T,C.TRIANGLES,W,o.StencilMode.disabled,L,o.CullFaceMode.disabled,Ue,l.id,M.boundsBuffer,h.quadTriangleIndexBuffer,M.boundsSegments);else{const{tileBoundsBuffer:st,tileBoundsIndexBuffer:Xe,tileBoundsSegments:Et}=h.getTileBoundsBuffers(ee);R.draw(T,C.TRIANGLES,W,we,L,o.CullFaceMode.disabled,Ue,l.id,st,Xe,Et)}}h.resetStencilClippingMasks()},background:function(h,r,l,p){const _=l.paint.get("background-color"),x=l.paint.get("background-opacity");if(x===0)return;const T=h.context,C=T.gl,M=h.transform,R=M.tileSize,L=l.paint.get("background-pattern");if(h.isPatternMissing(L))return;const U=!L&&_.a===1&&x===1&&h.opaquePassEnabledForLayer()?"opaque":"translucent";if(h.renderPass!==U)return;const G=o.StencilMode.disabled,Q=h.depthModeForSublayer(0,U==="opaque"?o.DepthMode.ReadWrite:o.DepthMode.ReadOnly),K=h.colorModeForRenderPass(),J=h.useProgram(L?"backgroundPattern":"background");let H,W=p;W||(H=h.getBackgroundTiles(),W=Object.values(H).map(ie=>ie.tileID)),L&&(T.activeTexture.set(C.TEXTURE0),h.imageManager.bind(h.context));for(const ie of W){const ee=ie.toUnwrapped(),he=p?ie.projMatrix:h.transform.calculateProjMatrix(ee);h.prepareDrawTile();const we=r?r.getTile(ie):H?H[ie.key]:new o.Tile(ie,R,M.zoom,h),ve=L?oh(he,x,h,L,{tileID:ie,tileSize:R}):mg(he,x,_);h.prepareDrawProgram(T,J,ee);const{tileBoundsBuffer:Pe,tileBoundsIndexBuffer:He,tileBoundsSegments:qe}=h.getTileBoundsBuffers(we);J.draw(T,C.TRIANGLES,Q,G,K,o.CullFaceMode.disabled,ve,l.id,Pe,He,qe)}},sky:function(h,r,l){const p=h.transform,_=p.projection.name==="mercator"||p.projection.name==="globe"?1:o.smoothstep(7,8,p.zoom),x=l.paint.get("sky-opacity")*_;if(x===0)return;const T=h.context,C=l.paint.get("sky-type"),M=new o.DepthMode(T.gl.LEQUAL,o.DepthMode.ReadOnly,[0,1]),R=h.frameCounter/1e3%1;C==="atmosphere"?h.renderPass==="offscreen"?l.needsSkyboxCapture(h)&&(function(L,U,G,Q){const K=L.context,J=K.gl;let H=U.skyboxFbo;if(!H){H=U.skyboxFbo=K.createFramebuffer(32,32,!1),U.skyboxGeometry=new Is(K),U.skyboxTexture=K.gl.createTexture(),J.bindTexture(J.TEXTURE_CUBE_MAP,U.skyboxTexture),J.texParameteri(J.TEXTURE_CUBE_MAP,J.TEXTURE_WRAP_S,J.CLAMP_TO_EDGE),J.texParameteri(J.TEXTURE_CUBE_MAP,J.TEXTURE_WRAP_T,J.CLAMP_TO_EDGE),J.texParameteri(J.TEXTURE_CUBE_MAP,J.TEXTURE_MIN_FILTER,J.LINEAR),J.texParameteri(J.TEXTURE_CUBE_MAP,J.TEXTURE_MAG_FILTER,J.LINEAR);for(let he=0;he<6;++he)J.texImage2D(J.TEXTURE_CUBE_MAP_POSITIVE_X+he,0,J.RGBA,32,32,0,J.RGBA,J.UNSIGNED_BYTE,null)}K.bindFramebuffer.set(H.framebuffer),K.viewport.set([0,0,32,32]);const W=U.getCenter(L,!0),ie=L.useProgram("skyboxCapture"),ee=new Float64Array(16);o.identity(ee),o.rotateY(ee,ee,.5*-Math.PI),ks(K,U,ie,ee,W,0),o.identity(ee),o.rotateY(ee,ee,.5*Math.PI),ks(K,U,ie,ee,W,1),o.identity(ee),o.rotateX(ee,ee,.5*-Math.PI),ks(K,U,ie,ee,W,2),o.identity(ee),o.rotateX(ee,ee,.5*Math.PI),ks(K,U,ie,ee,W,3),o.identity(ee),ks(K,U,ie,ee,W,4),o.identity(ee),o.rotateY(ee,ee,Math.PI),ks(K,U,ie,ee,W,5),K.viewport.set([0,0,L.width,L.height])}(h,l),l.markSkyboxValid(h)):h.renderPass==="sky"&&function(L,U,G,Q,K){const J=L.context,H=J.gl,W=L.transform,ie=L.useProgram("skybox");J.activeTexture.set(H.TEXTURE0),H.bindTexture(H.TEXTURE_CUBE_MAP,U.skyboxTexture);const ee=((he,we,ve,Pe,He)=>({u_matrix:he,u_sun_direction:we,u_cubemap:0,u_opacity:Pe,u_temporal_offset:He}))(W.skyboxMatrix,U.getCenter(L,!1),0,Q,K);L.prepareDrawProgram(J,ie),ie.draw(J,H.TRIANGLES,G,o.StencilMode.disabled,L.colorModeForRenderPass(),o.CullFaceMode.backCW,ee,"skybox",U.skyboxGeometry.vertexBuffer,U.skyboxGeometry.indexBuffer,U.skyboxGeometry.segment)}(h,l,M,x,R):C==="gradient"&&h.renderPass==="sky"&&function(L,U,G,Q,K){const J=L.context,H=J.gl,W=L.transform,ie=L.useProgram("skyboxGradient");U.skyboxGeometry||(U.skyboxGeometry=new Is(J)),J.activeTexture.set(H.TEXTURE0);let ee=U.colorRampTexture;ee||(ee=U.colorRampTexture=new o.Texture(J,U.colorRamp,H.RGBA)),ee.bind(H.LINEAR,H.CLAMP_TO_EDGE);const he=((we,ve,Pe,He,qe)=>({u_matrix:we,u_color_ramp:0,u_center_direction:ve,u_radius:o.degToRad(Pe),u_opacity:He,u_temporal_offset:qe}))(W.skyboxMatrix,U.getCenter(L,!1),U.paint.get("sky-gradient-radius"),Q,K);L.prepareDrawProgram(J,ie),ie.draw(J,H.TRIANGLES,G,o.StencilMode.disabled,L.colorModeForRenderPass(),o.CullFaceMode.backCW,he,"skyboxGradient",U.skyboxGeometry.vertexBuffer,U.skyboxGeometry.indexBuffer,U.skyboxGeometry.segment)}(h,l,M,x,R)},debug:function(h,r,l){for(let p=0;p<l.length;p++)ff(h,r,l[p])},custom:function(h,r,l){const p=h.context,_=l.implementation;if(h.transform.projection.unsupportedLayers&&h.transform.projection.unsupportedLayers.includes("custom"))o.warnOnce("Custom layers are not yet supported with non-mercator projections. Use mercator to enable custom layers.");else if(h.renderPass==="offscreen"){const x=_.prerender;x&&(h.setCustomLayerDefaults(),p.setColorMode(h.colorModeForRenderPass()),x.call(_,p.gl,h.transform.customLayerMatrix()),p.setDirty(),h.setBaseState())}else if(h.renderPass==="translucent"){h.setCustomLayerDefaults(),p.setColorMode(h.colorModeForRenderPass()),p.setStencilMode(o.StencilMode.disabled);const x=_.renderingMode==="3d"?new o.DepthMode(h.context.gl.LEQUAL,o.DepthMode.ReadWrite,h.depthRangeFor3D):h.depthModeForSublayer(0,o.DepthMode.ReadOnly);p.setDepthMode(x),_.render(p.gl,h.transform.customLayerMatrix()),p.setDirty(),h.setBaseState(),p.bindFramebuffer.set(null)}}};class bg{constructor(r,l){this.context=new N(r),this.transform=l,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.setup(),this.numSublayers=o.SourceCache.maxUnderzooming+o.SourceCache.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Ss,this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={}}updateTerrain(r,l){const p=!!r&&!!r.terrain&&this.transform.projection.supportsTerrain;if(!(p||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new Yd(this,r));const _=this._terrain;this.transform.elevation=p?_:null,_.update(r,this.transform,l)}_updateFog(r){const l=r.fog;if(!l||this.transform.projection.name==="globe"||l.getOpacity(this.transform.pitch)<1||l.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[p,_]=l.getFovAdjustedRange(this.transform._fov);if(p>_)return void(this.transform.fogCullDistSq=null);const x=p+.78*(_-p);this.transform.fogCullDistSq=x*x}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}resize(r,l){if(this.width=r*o.exported.devicePixelRatio,this.height=l*o.exported.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const p of this.style.order)this.style._layers[p].resize()}setup(){const r=this.context,l=new o.StructArrayLayout2i4;l.emplaceBack(0,0),l.emplaceBack(o.EXTENT,0),l.emplaceBack(0,o.EXTENT),l.emplaceBack(o.EXTENT,o.EXTENT),this.tileExtentBuffer=r.createVertexBuffer(l,o.posAttributes.members),this.tileExtentSegments=o.SegmentVector.simpleSegment(0,0,4,2);const p=new o.StructArrayLayout2i4;p.emplaceBack(0,0),p.emplaceBack(o.EXTENT,0),p.emplaceBack(0,o.EXTENT),p.emplaceBack(o.EXTENT,o.EXTENT),this.debugBuffer=r.createVertexBuffer(p,o.posAttributes.members),this.debugSegments=o.SegmentVector.simpleSegment(0,0,4,5);const _=new o.StructArrayLayout2i4;_.emplaceBack(-1,-1),_.emplaceBack(1,-1),_.emplaceBack(-1,1),_.emplaceBack(1,1),this.viewportBuffer=r.createVertexBuffer(_,o.posAttributes.members),this.viewportSegments=o.SegmentVector.simpleSegment(0,0,4,2);const x=new o.StructArrayLayout4i8;x.emplaceBack(0,0,0,0),x.emplaceBack(o.EXTENT,0,o.EXTENT,0),x.emplaceBack(0,o.EXTENT,0,o.EXTENT),x.emplaceBack(o.EXTENT,o.EXTENT,o.EXTENT,o.EXTENT),this.mercatorBoundsBuffer=r.createVertexBuffer(x,o.boundsAttributes.members),this.mercatorBoundsSegments=o.SegmentVector.simpleSegment(0,0,4,2);const T=new o.StructArrayLayout3ui6;T.emplaceBack(0,1,2),T.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=r.createIndexBuffer(T);const C=new o.StructArrayLayout1ui2;for(const R of[0,1,3,2,0])C.emplaceBack(R);this.debugIndexBuffer=r.createIndexBuffer(C),this.emptyTexture=new o.Texture(r,new o.RGBAImage({width:1,height:1},Uint8Array.of(0,0,0,0)),r.gl.RGBA),this.identityMat=o.create();const M=this.context.gl;this.stencilClearMode=new o.StencilMode({func:M.ALWAYS,mask:0},0,255,M.ZERO,M.ZERO,M.ZERO),this.loadTimeStamps.push(o.window.performance.now()),this.atmosphereBuffer=new Kn(this.context)}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(r){return r._makeTileBoundsBuffers(this.context,this.transform.projection),r._tileBoundsBuffer?{tileBoundsBuffer:r._tileBoundsBuffer,tileBoundsIndexBuffer:r._tileBoundsIndexBuffer,tileBoundsSegments:r._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const r=this.context,l=r.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.useProgram("clippingMask").draw(r,l.TRIANGLES,o.DepthMode.disabled,this.stencilClearMode,o.ColorMode.disabled,o.CullFaceMode.disabled,ll(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(r,l,p){if(!l||this.currentStencilSource===l.id||!r.isTileClipped()||!p||p.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let C=!1;for(const M of p)if(this._tileClippingMaskIDs[M.key]===void 0){C=!0;break}if(!C)return}this.currentStencilSource=l.id;const _=this.context,x=_.gl;this.nextStencilID+p.length>256&&this.clearStencil(),_.setColorMode(o.ColorMode.disabled),_.setDepthMode(o.DepthMode.disabled);const T=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const C of p){const M=l.getTile(C),R=this._tileClippingMaskIDs[C.key]=this.nextStencilID++,{tileBoundsBuffer:L,tileBoundsIndexBuffer:U,tileBoundsSegments:G}=this.getTileBoundsBuffers(M);T.draw(_,x.TRIANGLES,o.DepthMode.disabled,new o.StencilMode({func:x.ALWAYS,mask:0},R,255,x.KEEP,x.KEEP,x.REPLACE),o.ColorMode.disabled,o.CullFaceMode.disabled,ll(C.projMatrix),"$clipping",L,U,G)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const r=this.nextStencilID++,l=this.context.gl;return new o.StencilMode({func:l.NOTEQUAL,mask:255},r,255,l.KEEP,l.KEEP,l.REPLACE)}stencilModeForClipping(r){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(r);const l=this.context.gl;return new o.StencilMode({func:l.EQUAL,mask:255},this._tileClippingMaskIDs[r.key],0,l.KEEP,l.KEEP,l.REPLACE)}stencilConfigForOverlap(r){const l=this.context.gl,p=r.sort((T,C)=>C.overscaledZ-T.overscaledZ),_=p[p.length-1].overscaledZ,x=p[0].overscaledZ-_+1;if(x>1){this.currentStencilSource=void 0,this.nextStencilID+x>256&&this.clearStencil();const T={};for(let C=0;C<x;C++)T[C+_]=new o.StencilMode({func:l.GEQUAL,mask:255},C+this.nextStencilID,255,l.KEEP,l.KEEP,l.REPLACE);return this.nextStencilID+=x,[T,p]}return[{[_]:o.StencilMode.disabled},p]}colorModeForRenderPass(){const r=this.context.gl;return this._showOverdrawInspector?new o.ColorMode([r.CONSTANT_COLOR,r.ONE],new o.Color(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?o.ColorMode.unblended:o.ColorMode.alphaBlended}depthModeForSublayer(r,l,p){if(!this.opaquePassEnabledForLayer())return o.DepthMode.disabled;const _=1-((1+this.currentLayer)*this.numSublayers+r)*this.depthEpsilon;return new o.DepthMode(p||this.context.gl.LEQUAL,l,[_,_])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(r,l){this.style=r,this.options=l,this.imageManager=r.imageManager,this.glyphManager=r.glyphManager,this.symbolFadeChange=r.placement.symbolFadeChange(o.exported.now()),this.imageManager.beginFrame();const p=this.style.order,_=this.style._sourceCaches;for(const M in _){const R=_[M];R.used&&R.prepare(this.context)}const x={},T={},C={};for(const M in _){const R=_[M];x[M]=R.getVisibleCoordinates(),T[M]=x[M].slice().reverse(),C[M]=R.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let M=0;M<p.length;M++)if(this.style._layers[p[M]].is3D()){this.opaquePassCutoff=M;break}if(this.terrain&&(this.terrain.updateTileBinding(C),this.opaquePassCutoff=0),this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new o.GlobeSharedBuffers(this.context)),o.isMapAuthenticated(this.context.gl)){this.renderPass="offscreen";for(const M of p){const R=this.style._layers[M],L=r._getLayerSourceCache(R);if(!R.hasOffscreenPass()||R.isHidden(this.transform.zoom))continue;const U=L?T[L.id]:void 0;(R.type==="custom"||R.isSky()||U&&U.length)&&this.renderLayer(this,L,R,U)}if(this.depthRangeFor3D=[0,1-(r.order.length+2)*this.numSublayers*this.depthEpsilon],this.terrain&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&this.terrain.drawDepth(),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]),this.context.clear({color:l.showOverdrawInspector?o.Color.black:o.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=l.showOverdrawInspector,this.renderPass="opaque",!this.terrain)for(this.currentLayer=p.length-1;this.currentLayer>=0;this.currentLayer--){const M=this.style._layers[p[this.currentLayer]],R=r._getLayerSourceCache(M);if(M.isSky())continue;const L=R?T[R.id]:void 0;this._renderTileClippingMasks(M,R,L),this.renderLayer(this,R,M,L)}if(this.style.fog&&this.transform.projection.supportsFog&&function(M,R){const L=M.context,U=L.gl,G=M.transform,Q=new o.DepthMode(U.LEQUAL,o.DepthMode.ReadOnly,[0,1]),K=M.useProgram("globeAtmosphere",null,G.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"]),J=o.globeToMercatorTransition(G.zoom),H=R.properties.get("color").toArray01(),W=R.properties.get("high-color").toArray01(),ie=R.properties.get("space-color").toArray01PremultipliedAlpha(),ee=o.identity$1([]);o.rotateY$1(ee,ee,-o.degToRad(G._center.lng)),o.rotateX$1(ee,ee,o.degToRad(G._center.lat)),o.rotateZ$1(ee,ee,G.angle),o.rotateX$1(ee,ee,-G._pitch);const he=o.fromQuat(new Float32Array(16),ee),we=o.mapValue(R.properties.get("star-intensity"),0,1,0,.25),ve=5e-4,Pe=o.mapValue(R.properties.get("horizon-blend"),0,1,ve,.25),He=o.globeUseCustomAntiAliasing(M,L,G)&&Pe===ve?G.worldSize/(2*Math.PI*1.025)-1:G.globeRadius,qe=M.frameCounter/1e3%1,Le=o.length(G.globeCenterInViewSpace),It=Math.sqrt(Math.pow(Le,2)-Math.pow(He,2)),Ue=Math.acos(It/Le),st=((Et,Je,pt,Pt,De,We,Qt,ln,Jt,mn,Tn,cn,Gt,ei)=>({u_frustum_tl:Et,u_frustum_tr:Je,u_frustum_br:pt,u_frustum_bl:Pt,u_horizon:De,u_transition:We,u_fadeout_range:Qt,u_color:ln,u_high_color:Jt,u_space_color:mn,u_star_intensity:Tn,u_star_size:5*o.exported.devicePixelRatio,u_star_density:0,u_temporal_offset:cn,u_horizon_angle:Gt,u_rotation_matrix:ei}))(G.frustumCorners.TL,G.frustumCorners.TR,G.frustumCorners.BR,G.frustumCorners.BL,G.frustumCorners.horizon,J,Pe,H,W,ie,we,qe,Ue,he);M.prepareDrawProgram(L,K);const Xe=M.atmosphereBuffer;Xe&&K.draw(L,U.TRIANGLES,Q,o.StencilMode.disabled,o.ColorMode.alphaBlended,o.CullFaceMode.backCW,st,"skybox",Xe.vertexBuffer,Xe.indexBuffer,Xe.segments)}(this,this.style.fog),this.renderPass="sky",(o.globeToMercatorTransition(this.transform.zoom)>0||this.transform.projection.name!=="globe")&&this.transform.isHorizonVisible())for(this.currentLayer=0;this.currentLayer<p.length;this.currentLayer++){const M=this.style._layers[p[this.currentLayer]],R=r._getLayerSourceCache(M);M.isSky()&&this.renderLayer(this,R,M,R?T[R.id]:void 0)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<p.length;){const M=this.style._layers[p[this.currentLayer]],R=r._getLayerSourceCache(M);if(M.isSky()){++this.currentLayer;continue}if(this.terrain&&this.style.isLayerDraped(M)){if(M.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer);continue}const L=R?(M.type==="symbol"?C:T)[R.id]:void 0;this._renderTileClippingMasks(M,R,R?x[R.id]:void 0),this.renderLayer(this,R,M,L),++this.currentLayer}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let M=null;o.values(this.style._layers).forEach(R=>{const L=r._getLayerSourceCache(R);L&&!R.isHidden(this.transform.zoom)&&(!M||M.getSource().maxzoom<L.getSource().maxzoom)&&(M=L)}),M&&this.options.showTileBoundaries&&dl.debug(this,M,M.getVisibleCoordinates())}this.options.showPadding&&function(M){const R=M.transform.padding;ch(M,M.transform.height-(R.top||0),3,vg),ch(M,R.bottom||0,3,xg),Cc(M,R.left||0,3,ah),Cc(M,M.transform.width-(R.right||0),3,lh);const L=M.transform.centerPoint;(function(U,G,Q,K){go(U,G-1,Q-10,2,20,K),go(U,G-10,Q-1,20,2,K)})(M,L.x,M.transform.height-L.y,df)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(o.window.performance.now()),this.saveCanvasCopy())}}renderLayer(r,l,p,_){p.isHidden(this.transform.zoom)||(p.type==="background"||p.type==="sky"||p.type==="custom"||_&&_.length)&&(this.id=p.id,this.gpuTimingStart(p),r.transform.projection.unsupportedLayers&&r.transform.projection.unsupportedLayers.includes(p.type)||dl[p.type](r,l,p,_,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(r){if(!this.options.gpuTiming)return;const l=this.context.extTimerQuery;let p=this.gpuTimers[r.id];p||(p=this.gpuTimers[r.id]={calls:0,cpuTime:0,query:l.createQueryEXT()}),p.calls++,l.beginQueryEXT(l.TIME_ELAPSED_EXT,p.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const r=this.context.extTimerQuery,l=r.createQueryEXT();this.deferredRenderGpuTimeQueries.push(l),r.beginQueryEXT(r.TIME_ELAPSED_EXT,l)}}gpuTimingDeferredRenderEnd(){if(!this.options.gpuTimingDeferredRender)return;const r=this.context.extTimerQuery;r.endQueryEXT(r.TIME_ELAPSED_EXT)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const r=this.context.extTimerQuery;r.endQueryEXT(r.TIME_ELAPSED_EXT)}collectGpuTimers(){const r=this.gpuTimers;return this.gpuTimers={},r}collectDeferredRenderGpuQueries(){const r=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],r}queryGpuTimers(r){const l={};for(const p in r){const _=r[p],x=this.context.extTimerQuery,T=x.getQueryObjectEXT(_.query,x.QUERY_RESULT_EXT)/1e6;x.deleteQueryEXT(_.query),l[p]=T}return l}queryGpuTimeDeferredRender(r){if(!this.options.gpuTimingDeferredRender)return 0;const l=this.context.extTimerQuery;let p=0;for(const _ of r)p+=l.getQueryObjectEXT(_,l.QUERY_RESULT_EXT)/1e6,l.deleteQueryEXT(_);return p}translatePosMatrix(r,l,p,_,x){if(!p[0]&&!p[1])return r;const T=x?_==="map"?this.transform.angle:0:_==="viewport"?-this.transform.angle:0;if(T){const R=Math.sin(T),L=Math.cos(T);p=[p[0]*L-p[1]*R,p[0]*R+p[1]*L]}const C=[x?p[0]:xn(l,p[0],this.transform.zoom),x?p[1]:xn(l,p[1],this.transform.zoom),0],M=new Float32Array(16);return o.translate(M,r,C),M}saveTileTexture(r){const l=this._tileTextures[r.size[0]];l?l.push(r):this._tileTextures[r.size[0]]=[r]}getTileTexture(r){const l=this._tileTextures[r];return l&&l.length>0?l.pop():null}isPatternMissing(r){return r===null||r!==void 0&&!this.imageManager.getPattern(r.toString())}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture}currentGlobalDefines(){const r=this.terrain&&this.terrain.renderingToTexture,l=this.terrain&&this.terrain.exaggeration()===0,p=this.style&&this.style.fog,_=[];return this.terrainRenderModeElevated()&&_.push("TERRAIN"),this.transform.projection.name==="globe"&&_.push("GLOBE"),l&&_.push("ZERO_EXAGGERATION"),p&&!r&&p.getOpacity(this.transform.pitch)!==0&&_.push("FOG"),r&&_.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&_.push("OVERDRAW_INSPECTOR"),_}useProgram(r,l,p){this.cache=this.cache||{};const _=p||[],x=this.currentGlobalDefines().concat(_),T=Ju.cacheKey(Xu[r],r,x,l);return this.cache[T]||(this.cache[T]=new Ju(this.context,r,Xu[r],l,gg[r],x)),this.cache[T]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const r=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(r.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=o.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new o.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this.atmosphereBuffer&&this.atmosphereBuffer.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}prepareDrawProgram(r,l,p){if(this.terrain&&this.terrain.renderingToTexture)return;const _=this.style.fog;if(_){const x=_.getOpacity(this.transform.pitch),T=((C,M,R,L,U,G,Q,K,J,H,W)=>{const ie=C.transform,ee=M.properties.get("color").toArray01();ee[3]=L;const he=C.frameCounter/1e3%1;return{u_fog_matrix:R?ie.calculateFogTileMatrix(R):C.identityMat,u_fog_range:M.getFovAdjustedRange(ie._fov),u_fog_color:ee,u_fog_horizon_blend:M.properties.get("horizon-blend"),u_fog_temporal_offset:he,u_frustum_tl:U,u_frustum_tr:G,u_frustum_br:Q,u_frustum_bl:K,u_globe_pos:J,u_globe_radius:H,u_viewport:W,u_globe_transition:o.globeToMercatorTransition(ie.zoom),u_is_globe:+(ie.projection.name==="globe")}})(this,_,p,x,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*o.exported.devicePixelRatio,this.transform.height*o.exported.devicePixelRatio]);l.setFogUniformValues(r,T)}}setTileLoadedFlag(r){this.tileLoaded=r}saveCanvasCopy(){this.frameCopies.push(this.canvasCopy()),this.tileLoaded=!1}canvasCopy(){const r=this.context.gl,l=r.createTexture();return r.bindTexture(r.TEXTURE_2D,l),r.copyTexImage2D(r.TEXTURE_2D,0,r.RGBA,0,0,r.drawingBufferWidth,r.drawingBufferHeight,0),l}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const r=this.style&&this.style.fog;return!!r&&r.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const r=this._backgroundTiles,l=this._backgroundTiles={},p=this.transform.coveringTiles({tileSize:512});for(const _ of p)l[_.key]=r[_.key]||new o.Tile(_,512,this.transform.tileZoom,this);return l}clearBackgroundTiles(){this._backgroundTiles={}}}class Ac{constructor(r=0,l=0,p=0,_=0){if(isNaN(r)||r<0||isNaN(l)||l<0||isNaN(p)||p<0||isNaN(_)||_<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=r,this.bottom=l,this.left=p,this.right=_}interpolate(r,l,p){return l.top!=null&&r.top!=null&&(this.top=o.number(r.top,l.top,p)),l.bottom!=null&&r.bottom!=null&&(this.bottom=o.number(r.bottom,l.bottom,p)),l.left!=null&&r.left!=null&&(this.left=o.number(r.left,l.left,p)),l.right!=null&&r.right!=null&&(this.right=o.number(r.right,l.right,p)),this}getCenter(r,l){const p=o.clamp((this.left+r-this.right)/2,0,r),_=o.clamp((this.top+l-this.bottom)/2,0,l);return new o.pointGeometry(p,_)}equals(r){return this.top===r.top&&this.bottom===r.bottom&&this.left===r.left&&this.right===r.right}clone(){return new Ac(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function ca(h,r){const l=o.getColumn(h,3);o.fromQuat(h,r),o.setColumn(h,3,l)}function hh(h,r){const l=o.identity$1([]);return o.rotateZ$1(l,l,-r),o.rotateX$1(l,l,-h),l}function mf(h,r){const l=[h[0],h[1],0],p=[r[0],r[1],0];if(o.length(l)>=1e-15){const T=o.normalize([],l);o.scale$2(p,T,o.dot(p,T)),r[0]=p[0],r[1]=p[1]}const _=o.cross([],r,h);if(o.len(_)<1e-15)return null;const x=Math.atan2(-_[1],_[0]);return hh(Math.atan2(Math.sqrt(h[0]*h[0]+h[1]*h[1]),-h[2]),x)}class dh{constructor(r,l){this.position=r,this.orientation=l}get position(){return this._position}set position(r){if(r){const l=r instanceof o.MercatorCoordinate?r:new o.MercatorCoordinate(r[0],r[1],r[2]);this._renderWorldCopies&&(l.x=o.wrap(l.x,0,1)),this._position=l}else this._position=null}lookAtPoint(r,l){if(this.orientation=null,!this.position)return;const p=this._elevation?this._elevation.getAtPointOrZero(o.MercatorCoordinate.fromLngLat(r)):0,_=this.position,x=o.MercatorCoordinate.fromLngLat(r,p),T=[x.x-_.x,x.y-_.y,x.z-_.z];l||(l=[0,0,1]),l[2]=Math.abs(l[2]),this.orientation=mf(T,l)}setPitchBearing(r,l){this.orientation=hh(o.degToRad(r),o.degToRad(-l))}}class fh{constructor(r,l){this._transform=o.identity([]),this.orientation=l,this.position=r}get mercatorPosition(){const r=this.position;return new o.MercatorCoordinate(r[0],r[1],r[2])}get position(){const r=o.getColumn(this._transform,3);return[r[0],r[1],r[2]]}set position(r){var l;r&&o.setColumn(this._transform,3,[(l=r)[0],l[1],l[2],1])}get orientation(){return this._orientation}set orientation(r){this._orientation=r||o.identity$1([]),r&&ca(this._transform,this._orientation)}getPitchBearing(){const r=this.forward(),l=this.right();return{bearing:Math.atan2(-l[1],l[0]),pitch:Math.atan2(Math.sqrt(r[0]*r[0]+r[1]*r[1]),-r[2])}}setPitchBearing(r,l){this._orientation=hh(r,l),ca(this._transform,this._orientation)}forward(){const r=o.getColumn(this._transform,2);return[-r[0],-r[1],-r[2]]}up(){const r=o.getColumn(this._transform,1);return[-r[0],-r[1],-r[2]]}right(){const r=o.getColumn(this._transform,0);return[r[0],r[1],r[2]]}getCameraToWorld(r,l){const p=new Float64Array(16);return o.invert(p,this.getWorldToCamera(r,l)),p}getWorldToCameraPosition(r,l,p){const _=this.position;o.scale$2(_,_,-r);const x=new Float64Array(16);return o.fromScaling(x,[p,p,p]),o.translate(x,x,_),x[10]*=l,x}getWorldToCamera(r,l){const p=new Float64Array(16),_=new Float64Array(4),x=this.position;return o.conjugate(_,this._orientation),o.scale$2(x,x,-r),o.fromQuat(p,_),o.translate(p,p,x),p[1]*=-1,p[5]*=-1,p[9]*=-1,p[13]*=-1,p[8]*=l,p[9]*=l,p[10]*=l,p[11]*=l,p}getCameraToClipPerspective(r,l,p,_){const x=new Float64Array(16);return o.perspective(x,r,l,p,_),x}getDistanceToElevation(r,l=!1){const p=r===0?0:o.mercatorZfromAltitude(r,l?o.latFromMercatorY(this.position[1]):this.position[1]),_=this.forward();return(p-this.position[2])/_[2]}clone(){return new fh([...this.position],[...this.orientation])}}function Mc(h,r){const l=is(h.projection,h.zoom,h.width,h.height),p=function(x,T,C,M,R){const L=new o.LngLat(C.lng-180*rs,C.lat),U=new o.LngLat(C.lng+180*rs,C.lat),G=x.project(L.lng,L.lat),Q=x.project(U.lng,U.lat),K=-Math.atan2(Q.y-G.y,Q.x-G.x),J=o.MercatorCoordinate.fromLngLat(C);J.y=o.clamp(J.y,-.999975,.999975);const H=J.toLngLat(),W=x.project(H.lng,H.lat),ie=o.MercatorCoordinate.fromLngLat(H);ie.x+=rs;const ee=ie.toLngLat(),he=x.project(ee.lng,ee.lat),we=ph(he.x-W.x,he.y-W.y,K),ve=o.MercatorCoordinate.fromLngLat(H);ve.y+=rs;const Pe=ve.toLngLat(),He=x.project(Pe.lng,Pe.lat),qe=ph(He.x-W.x,He.y-W.y,K),Le=Math.abs(we.x)/Math.abs(qe.y),It=o.identity([]);o.rotateZ(It,It,-K*(1-(R?0:M)));const Ue=o.identity([]);return o.scale(Ue,Ue,[1,1-(1-Le)*M,1]),Ue[4]=-qe.x/qe.y*M,o.rotateZ(Ue,Ue,K),o.multiply(Ue,It,Ue),Ue}(h.projection,0,h.center,l,r),_=fl(h);return o.scale(p,p,[_,_,1]),p}function fl(h){const r=h.projection,l=is(h.projection,h.zoom,h.width,h.height),p=Ic(r,h.center),_=Ic(r,o.LngLat.convert(r.center));return Math.pow(2,p*l+(1-l)*_)}function is(h,r,l,p,_=1/0){const x=h.range;if(!x)return 0;const T=Math.min(_,Math.max(l,p)),C=Math.log(T/1024)/Math.LN2;return o.smoothstep(x[0]+C,x[1]+C,r)}const rs=1/4e4;function Ic(h,r){const l=o.clamp(r.lat,-o.MAX_MERCATOR_LATITUDE,o.MAX_MERCATOR_LATITUDE),p=new o.LngLat(r.lng-180*rs,l),_=new o.LngLat(r.lng+180*rs,l),x=h.project(p.lng,l),T=h.project(_.lng,l),C=o.MercatorCoordinate.fromLngLat(p),M=o.MercatorCoordinate.fromLngLat(_),R=T.x-x.x,L=T.y-x.y,U=M.x-C.x,G=M.y-C.y,Q=Math.sqrt((U*U+G*G)/(R*R+L*L));return Math.log(Q)/Math.LN2}function ph(h,r,l){const p=Math.cos(l),_=Math.sin(l);return{x:h*p-r*_,y:h*_+r*p}}class ua{constructor(r,l,p,_,x,T,C){this.tileSize=512,this._renderWorldCopies=x===void 0||x,this._minZoom=r||0,this._maxZoom=l||22,this._minPitch=p==null?0:p,this._maxPitch=_==null?60:_,this.setProjection(T),this.setMaxBounds(C),this.width=0,this.height=0,this._center=new o.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new Ac,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._distanceTileDataCache={},this._camera=new fh,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._horizonShift=.1}clone(){const r=new ua(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return r._elevation=this._elevation,r._centerAltitude=this._centerAltitude,r._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,r.tileSize=this.tileSize,r.mercatorFromTransition=this.mercatorFromTransition,r.width=this.width,r.height=this.height,r.cameraElevationReference=this.cameraElevationReference,r._center=this._center,r._setZoom(this.zoom),r._seaLevelZoom=this._seaLevelZoom,r.angle=this.angle,r._fov=this._fov,r._pitch=this._pitch,r._nearZ=this._nearZ,r._farZ=this._farZ,r._averageElevation=this._averageElevation,r._unmodified=this._unmodified,r._edgeInsets=this._edgeInsets.clone(),r._camera=this._camera.clone(),r._calcMatrices(),r.freezeTileCoverage=this.freezeTileCoverage,r.frustumCorners=this.frustumCorners,r}get elevation(){return this._elevation}set elevation(r){this._elevation!==r&&(this._elevation=r,this._updateCameraOnTerrain(),this._calcMatrices())}updateElevation(r,l=!1){const p=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||p)&&this._updateCameraOnTerrain(),(r||p)&&this._constrainCamera(l),this._calcMatrices()}getProjection(){return o.pick(this.projection,["name","center","parallels"])}setProjection(r){this.projectionOptions=r||{name:"mercator"};const l=this.projection?this.getProjection():void 0;this.projection=o.getProjection(this.projectionOptions);const p=!S(l,this.getProjection());return p&&this._calcMatrices(),this.mercatorFromTransition=!1,p}setMercatorFromTransition(){const r=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=o.getProjection({name:"mercator"});const l=r!==this.projection.name;return l&&this._calcMatrices(),l}get minZoom(){return this._minZoom}set minZoom(r){this._minZoom!==r&&(this._minZoom=r,this.zoom=Math.max(this.zoom,r))}get maxZoom(){return this._maxZoom}set maxZoom(r){this._maxZoom!==r&&(this._maxZoom=r,this.zoom=Math.min(this.zoom,r))}get minPitch(){return this._minPitch}set minPitch(r){this._minPitch!==r&&(this._minPitch=r,this.pitch=Math.max(this.pitch,r))}get maxPitch(){return this._maxPitch}set maxPitch(r){this._maxPitch!==r&&(this._maxPitch=r,this.pitch=Math.min(this.pitch,r))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(r){r===void 0?r=!0:r===null&&(r=!1),this._renderWorldCopies=r}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const r=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(r))}get cameraWorldSize(){const r=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(r))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return o.mercatorZfromAltitude(this.center.lat,this.cameraWorldSizeForFog)}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new o.pointGeometry(this.width,this.height)}get bearing(){return o.wrap(this.rotation,-180,180)}set bearing(r){this.rotation=r}get rotation(){return-this.angle/Math.PI*180}set rotation(r){const l=-r*Math.PI/180;var p;this.angle!==l&&(this._unmodified=!1,this.angle=l,this._calcMatrices(),this.rotationMatrix=(p=new o.ARRAY_TYPE(4),o.ARRAY_TYPE!=Float32Array&&(p[1]=0,p[2]=0),p[0]=1,p[3]=1,p),function(_,x,T){var C=x[0],M=x[1],R=x[2],L=x[3],U=Math.sin(T),G=Math.cos(T);_[0]=C*G+R*U,_[1]=M*G+L*U,_[2]=C*-U+R*G,_[3]=M*-U+L*G}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(r){const l=o.clamp(r,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==l&&(this._unmodified=!1,this._pitch=l,this._calcMatrices())}get aspect(){return this.width/this.height}get fovX(){return this._fov}get fovY(){const r=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/r)}set fov(r){r=Math.max(.01,Math.min(60,r)),this._fov!==r&&(this._unmodified=!1,this._fov=o.degToRad(r),this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(r){this._averageElevation=r,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(r){const l=Math.min(Math.max(r,this.minZoom),this.maxZoom);this._zoom!==l&&(this._unmodified=!1,this._setZoom(l),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(r){this._zoom=r,this.scale=this.zoomScale(r),this.tileZoom=Math.floor(r),this.zoomFraction=r-this.tileZoom}_updateCameraOnTerrain(){if(!this._elevation||!this._elevation.isDataAvailableAtPoint(this.locationCoordinate(this.center)))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const r=this._elevation;this._centerAltitude=r.getAtPointOrZero(this.locationCoordinate(this.center)),this._centerAltitudeValidForExaggeration=r.exaggeration(),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){this._centerAltitudeValidForExaggeration!==void 0&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const r=this._elevation,l=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],p=this.horizonLineFromTop();let _=0,x=0;for(let T=0;T<l.length;T++){const C=new o.pointGeometry(l[T][0]*this.width,p+l[T][1]*(this.height-p)),M=r.pointCoordinate(C);if(!M)continue;const R=1/Math.hypot(M[0]-this._camera.position[0],M[1]-this._camera.position[1]);_+=M[3]*R,x+=R}return x===0?NaN:_/x}get center(){return this._center}set center(r){r.lat===this._center.lat&&r.lng===this._center.lng||(this._unmodified=!1,this._center=r,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;const r=this._seaLevelZoom,l=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),p=this.pixelsPerMeter/this.worldSize*l,_=this._mercatorZfromZoom(r),x=this._mercatorZfromZoom(this._maxZoom),T=Math.max(_-p,x);this._setZoom(this._zoomFromMercatorZ(T))}get padding(){return this._edgeInsets.toJSON()}set padding(r){this._edgeInsets.equals(r)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,r,1),this._calcMatrices())}computeZoomRelativeTo(r){const l=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,r.toAltitude()));let p;p=r.z<this._camera.position[2]?[l.x,l.y,l.z]:[r.x,r.y,r.z];const _=o.length(o.sub([],this._camera.position,p));return o.clamp(this._zoomFromMercatorZ(_),this._minZoom,this._maxZoom)}setFreeCameraOptions(r){if(!this.height||!r.position&&!r.orientation)return;this._updateCameraState();let l=!1;if(r.orientation&&!o.exactEquals(r.orientation,this._camera.orientation)&&(l=this._setCameraOrientation(r.orientation)),r.position){const p=[r.position.x,r.position.y,r.position.z];o.exactEquals$1(p,this._camera.position)||(this._setCameraPosition(p),l=!0)}l&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const r=this._camera.position,l=new dh;return l.position=new o.MercatorCoordinate(r[0],r[1],r[2]),l.orientation=this._camera.orientation,l._elevation=this.elevation,l._renderWorldCopies=this.renderWorldCopies,l}_setCameraOrientation(r){if(!o.length$1(r))return!1;o.normalize$1(r,r);const l=o.transformQuat([],[0,0,-1],r),p=o.transformQuat([],[0,-1,0],r);if(p[2]<0)return!1;const _=mf(l,p);return!!_&&(this._camera.orientation=_,!0)}_setCameraPosition(r){const l=this.zoomScale(this.minZoom)*this.tileSize,p=this.zoomScale(this.maxZoom)*this.tileSize,_=this.cameraToCenterDistance;r[2]=o.clamp(r[2],_/p,_/l),this._camera.position=r}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(r){return this._edgeInsets.equals(r)}interpolatePadding(r,l,p){this._unmodified=!1,this._edgeInsets.interpolate(r,l,p),this._constrain(),this._calcMatrices()}coveringZoomLevel(r){const l=(r.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/r.tileSize));return Math.max(0,l)}getVisibleUnwrappedCoordinates(r){const l=[new o.UnwrappedTileID(0,r)];if(this.renderWorldCopies){const p=this.pointCoordinate(new o.pointGeometry(0,0)),_=this.pointCoordinate(new o.pointGeometry(this.width,0)),x=this.pointCoordinate(new o.pointGeometry(this.width,this.height)),T=this.pointCoordinate(new o.pointGeometry(0,this.height)),C=Math.floor(Math.min(p.x,_.x,x.x,T.x)),M=Math.floor(Math.max(p.x,_.x,x.x,T.x)),R=1;for(let L=C-R;L<=M+R;L++)L!==0&&l.push(new o.UnwrappedTileID(L,r))}return l}coveringTiles(r){let l=this.coveringZoomLevel(r);const p=l,_=this.elevation&&!r.isTerrainDEM,x=this.projection.name==="mercator";if(r.minzoom!==void 0&&l<r.minzoom)return[];r.maxzoom!==void 0&&l>r.maxzoom&&(l=r.maxzoom);const T=this.locationCoordinate(this.center),C=this.center.lat,M=1<<l,R=[M*T.x,M*T.y,0],L=this.projection.name==="globe",U=!L,G=o.Frustum.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,l,U),Q=L?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),K=M*o.mercatorZfromAltitude(1,this.center.lat),J=this._camera.position[2]/o.mercatorZfromAltitude(1,this.center.lat),H=[M*Q.x,M*Q.y,J*(U?1:K)],W=this.cameraToCenterDistance/r.tileSize*(r.roundZoom?1:.502),ie=this.pitch<=60&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace?l:0,ee=r.isTerrainDEM&&this._elevation?1e4*this._elevation.exaggeration():this._centerAltitude,he=r.isTerrainDEM?-ee:this._elevation?this._elevation.getMinElevationBelowMSL():0,we=this.projection.isReprojectedInTileSpace?fl(this):1,ve=Je=>{const Pt=new o.MercatorCoordinate(Je.x+25e-6,Je.y,Je.z),De=new o.MercatorCoordinate(Je.x,Je.y+25e-6,Je.z),We=Je.toLngLat(),Qt=Pt.toLngLat(),ln=De.toLngLat(),Jt=this.locationCoordinate(We),mn=this.locationCoordinate(Qt),Tn=this.locationCoordinate(ln),cn=Math.hypot(mn.x-Jt.x,mn.y-Jt.y),Gt=Math.hypot(Tn.x-Jt.x,Tn.y-Jt.y);return Math.sqrt(cn*Gt)*we/25e-6},Pe=Je=>{const pt=ee,Pt=he;return{aabb:o.tileAABB(this,M,0,0,0,Je,Pt,pt,this.projection),zoom:0,x:0,y:0,minZ:Pt,maxZ:pt,wrap:Je,fullyVisible:!1}},He=[];let qe=[];const Le=l,It=r.reparseOverscaled?p:l,Ue=Je=>Je*Je,st=Ue((J-this._centerAltitude)*K),Xe=Je=>{if(!this._elevation||!Je.tileID||!x)return;const pt=this._elevation.getMinMaxForTile(Je.tileID),Pt=Je.aabb;pt?(Pt.min[2]=pt.min,Pt.max[2]=pt.max,Pt.center[2]=(Pt.min[2]+Pt.max[2])/2):(Je.shouldSplit=Et(Je),Je.shouldSplit||(Pt.min[2]=Pt.max[2]=Pt.center[2]=this._centerAltitude))},Et=Je=>{if(Je.zoom<ie)return!0;if(Je.zoom===Le)return!1;if(Je.shouldSplit!=null)return Je.shouldSplit;const pt=Je.aabb.distanceX(H),Pt=Je.aabb.distanceY(H);let De=st,We=1;if(L){De=Ue(Je.aabb.distanceZ(H));const Jt=Math.pow(2,Je.zoom),mn=o.latFromMercatorY((Je.y+1)/Jt),Tn=o.latFromMercatorY(Je.y/Jt),cn=Math.min(Math.max(C,mn),Tn),Gt=o.circumferenceAtLatitude(cn)/o.circumferenceAtLatitude(C);if(We=cn===C?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,Gt/this._mercatorScaleRatio),this.zoom<=o.GLOBE_ZOOM_THRESHOLD_MIN&&Je.zoom===Le-1&&Gt>=.9)return!0}else if(_&&(De=Ue(Je.aabb.distanceZ(H)*K)),this.projection.isReprojectedInTileSpace&&p<=5){const Jt=Math.pow(2,Je.zoom),mn=ve(new o.MercatorCoordinate((Je.x+.5)/Jt,(Je.y+.5)/Jt));We=mn>.85?1:mn}const Qt=pt*pt+Pt*Pt+De,ln=Ue((1<<Le-Je.zoom)*W*We*((Jt,mn)=>{if(mn*Ue(.707)<Jt)return 1;const Tn=Math.sqrt(mn/Jt);return Tn/(1.4144271570014144+(Math.pow(1.1,Tn-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(De,st),Qt));return Qt<ln};if(this.renderWorldCopies)for(let Je=1;Je<=3;Je++)He.push(Pe(-Je)),He.push(Pe(Je));for(He.push(Pe(0));He.length>0;){const Je=He.pop(),pt=Je.x,Pt=Je.y;let De=Je.fullyVisible;if(!De){const We=Je.aabb.intersects(G);if(We===0)continue;De=We===2}if(Je.zoom!==Le&&Et(Je))for(let We=0;We<4;We++){const Qt=(pt<<1)+We%2,ln=(Pt<<1)+(We>>1),Jt={aabb:x?Je.aabb.quadrant(We):o.tileAABB(this,M,Je.zoom+1,Qt,ln,Je.wrap,Je.minZ,Je.maxZ,this.projection),zoom:Je.zoom+1,x:Qt,y:ln,wrap:Je.wrap,fullyVisible:De,tileID:void 0,shouldSplit:void 0,minZ:Je.minZ,maxZ:Je.maxZ};_&&!L&&(Jt.tileID=new o.OverscaledTileID(Je.zoom+1===Le?It:Je.zoom+1,Je.wrap,Je.zoom+1,Qt,ln),Xe(Jt)),He.push(Jt)}else{const We=Je.zoom===Le?It:Je.zoom;if(r.minzoom&&r.minzoom>We)continue;const Qt=R[0]-(.5+pt+(Je.wrap<<Je.zoom))*(1<<l-Je.zoom),ln=R[1]-.5-Pt,Jt=Je.tileID?Je.tileID:new o.OverscaledTileID(We,Je.wrap,Je.zoom,pt,Pt);qe.push({tileID:Jt,distanceSq:Qt*Qt+ln*ln})}}if(this.fogCullDistSq){const Je=this.fogCullDistSq,pt=this.horizonLineFromTop();qe=qe.filter(Pt=>{const De=[0,0,0,1],We=[o.EXTENT,o.EXTENT,0,1],Qt=this.calculateFogTileMatrix(Pt.tileID.toUnwrapped());o.transformMat4$1(De,De,Qt),o.transformMat4$1(We,We,Qt);const ln=o.getAABBPointSquareDist(De,We);if(ln===0)return!0;let Jt=!1;const mn=this._elevation;if(mn&&ln>Je&&pt!==0){const Tn=this.calculateProjMatrix(Pt.tileID.toUnwrapped());let cn;r.isTerrainDEM||(cn=mn.getMinMaxForTile(Pt.tileID)),cn||(cn={min:he,max:ee});const Gt=o.furthestTileCorner(this.rotation),ei=[Gt[0]*o.EXTENT,Gt[1]*o.EXTENT,cn.max];o.transformMat4(ei,ei,Tn),Jt=(1-ei[1])*this.height*.5<pt}return ln<Je||Jt})}return qe.sort((Je,pt)=>Je.distanceSq-pt.distanceSq).map(Je=>Je.tileID)}resize(r,l){this.width=r,this.height=l,this.pixelsToGLUnits=[2/r,-2/l],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(r){return Math.pow(2,r)}scaleZoom(r){return Math.log(r)/Math.LN2}project(r){const l=o.clamp(r.lat,-o.MAX_MERCATOR_LATITUDE,o.MAX_MERCATOR_LATITUDE),p=this.projection.project(r.lng,l);return new o.pointGeometry(p.x*this.worldSize,p.y*this.worldSize)}unproject(r){return this.projection.unproject(r.x/this.worldSize,r.y/this.worldSize)}get point(){return this.project(this.center)}setLocationAtPoint(r,l){let p,_;const x=this.centerPoint;if(this.projection.name==="globe"){const C=this.worldSize;p=(l.x-x.x)/C,_=(l.y-x.y)/C}else{const C=this.pointCoordinate(l),M=this.pointCoordinate(x);p=C.x-M.x,_=C.y-M.y}const T=this.locationCoordinate(r);this.setLocation(new o.MercatorCoordinate(T.x-p,T.y-_))}setLocation(r){this.center=this.coordinateLocation(r),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(r){return this.projection.locationPoint(this,r)}locationPoint3D(r){return this.projection.locationPoint(this,r,!0)}pointLocation(r){return this.coordinateLocation(this.pointCoordinate(r))}pointLocation3D(r){return this.coordinateLocation(this.pointCoordinate3D(r))}locationCoordinate(r,l){const p=l?o.mercatorZfromAltitude(l,r.lat):void 0,_=this.projection.project(r.lng,r.lat);return new o.MercatorCoordinate(_.x,_.y,p)}coordinateLocation(r){return this.projection.unproject(r.x,r.y)}pointRayIntersection(r,l){const p=l!=null?l:this._centerAltitude,_=[r.x,r.y,0,1],x=[r.x,r.y,1,1];o.transformMat4$1(_,_,this.pixelMatrixInverse),o.transformMat4$1(x,x,this.pixelMatrixInverse);const T=x[3];o.scale$1(_,_,1/_[3]),o.scale$1(x,x,1/T);const C=_[2],M=x[2];return{p0:_,p1:x,t:C===M?0:(p-C)/(M-C)}}screenPointToMercatorRay(r){const l=[r.x,r.y,0,1],p=[r.x,r.y,1,1];return o.transformMat4$1(l,l,this.pixelMatrixInverse),o.transformMat4$1(p,p,this.pixelMatrixInverse),o.scale$1(l,l,1/l[3]),o.scale$1(p,p,1/p[3]),l[2]=o.mercatorZfromAltitude(l[2],this._center.lat)*this.worldSize,p[2]=o.mercatorZfromAltitude(p[2],this._center.lat)*this.worldSize,o.scale$1(l,l,1/this.worldSize),o.scale$1(p,p,1/this.worldSize),new o.Ray([l[0],l[1],l[2]],o.normalize([],o.sub([],p,l)))}rayIntersectionCoordinate(r){const{p0:l,p1:p,t:_}=r,x=o.mercatorZfromAltitude(l[2],this._center.lat),T=o.mercatorZfromAltitude(p[2],this._center.lat);return new o.MercatorCoordinate(o.number(l[0],p[0],_)/this.worldSize,o.number(l[1],p[1],_)/this.worldSize,o.number(x,T,_))}pointCoordinate(r,l=this._centerAltitude){return this.projection.pointCoordinate(this,r.x,r.y,l)}pointCoordinate3D(r){if(!this.elevation)return this.pointCoordinate(r);let l=this.projection.pointCoordinate3D(this,r.x,r.y);if(l)return new o.MercatorCoordinate(l[0],l[1],l[2]);let p=0,_=this.horizonLineFromTop();if(r.y>_)return this.pointCoordinate(r);const x=.02*_,T=r.clone();for(let C=0;C<10&&_-p>x;C++){T.y=o.number(p,_,.66);const M=this.projection.pointCoordinate3D(this,T.x,T.y);M?(_=T.y,l=M):p=T.y}return l?new o.MercatorCoordinate(l[0],l[1],l[2]):this.pointCoordinate(r)}isPointAboveHorizon(r){return this.projection.isPointAboveHorizon(this,r)}_coordinatePoint(r,l){const p=l&&this.elevation?this.elevation.getAtPointOrZero(r,this._centerAltitude):this._centerAltitude,_=[r.x*this.worldSize,r.y*this.worldSize,p+r.toAltitude(),1];return o.transformMat4$1(_,_,this.pixelMatrix),_[3]>0?new o.pointGeometry(_[0]/_[3],_[1]/_[3]):new o.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE)}_getGlobeBounds(){const{top:r,left:l}=this._edgeInsets,p=this.height-this._edgeInsets.bottom,_=this.width-this._edgeInsets.right,x=this.pointCoordinate3D(new o.pointGeometry(l,r)),T=this.pointCoordinate3D(new o.pointGeometry(_,r)),C=this.pointCoordinate3D(new o.pointGeometry(_,p)),M=this.pointCoordinate3D(new o.pointGeometry(l,p));let R=Math.min(x.x,M.x),L=Math.max(T.x,C.x),U=Math.min(x.y,T.y),G=Math.max(M.y,C.y);const Q=Math.pow(2,-this.zoom)/16,K=(ve,Pe,He,qe)=>{const Le=(ve+He)/2,It=(Pe+qe)/2,Ue=new o.pointGeometry(Le,It),st=this.pointCoordinate3D(Ue),Xe=Math.max(0,R-st.x,U-st.y,st.x-L,st.y-G);R=Math.min(R,st.x),L=Math.max(L,st.x),U=Math.min(U,st.y),G=Math.max(G,st.y),Xe>Q&&(K(ve,Pe,Le,It),K(Le,It,He,qe))};K(l,r,_,r),K(_,r,_,p),K(_,p,l,p),K(l,p,l,r);const[J,H]=o.polesInViewport(this),W=J||H,ie=J?90:o.latFromMercatorY(U),ee=W?180:o.lngFromMercatorX(L),he=H?-90:o.latFromMercatorY(G),we=W?-180:o.lngFromMercatorX(R);return new o.LngLatBounds(new o.LngLat(we,he),new o.LngLat(ee,ie))}_getBounds(r,l){if(this.projection.name==="globe")return this._getGlobeBounds();const p=new o.pointGeometry(this._edgeInsets.left,this._edgeInsets.top),_=new o.pointGeometry(this.width-this._edgeInsets.right,this._edgeInsets.top),x=new o.pointGeometry(this.width-this._edgeInsets.right,this.height-this._edgeInsets.bottom),T=new o.pointGeometry(this._edgeInsets.left,this.height-this._edgeInsets.bottom);let C=this.pointCoordinate(p,r),M=this.pointCoordinate(_,r);const R=this.pointCoordinate(x,l),L=this.pointCoordinate(T,l),U=(G,Q)=>(Q.y-G.y)/(Q.x-G.x);return C.y>1&&M.y>=0?C=new o.MercatorCoordinate((1-L.y)/U(L,C)+L.x,1):C.y<0&&M.y<=1&&(C=new o.MercatorCoordinate(-L.y/U(L,C)+L.x,0)),M.y>1&&C.y>=0?M=new o.MercatorCoordinate((1-R.y)/U(R,M)+R.x,1):M.y<0&&C.y<=1&&(M=new o.MercatorCoordinate(-R.y/U(R,M)+R.x,0)),new o.LngLatBounds().extend(this.coordinateLocation(C)).extend(this.coordinateLocation(M)).extend(this.coordinateLocation(L)).extend(this.coordinateLocation(R))}_getBounds3D(){const r=this.elevation;if(!r.visibleDemTiles.length||r.isUsingMockSource())return this._getBounds(0,0);const l=r.visibleDemTiles.reduce((p,_)=>{if(_.dem){const x=_.dem.tree;p.min=Math.min(p.min,x.minimums[0]),p.max=Math.max(p.max,x.maximums[0])}return p},{min:Number.MAX_VALUE,max:0});return this._getBounds(l.min*r.exaggeration(),l.max*r.exaggeration())}getBounds(){return this._terrainEnabled()?this._getBounds3D():this._getBounds(0,0)}horizonLineFromTop(r=!0){const l=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))+this.centerOffset.y,p=this.height/2-l*(1-this._horizonShift);return r?Math.max(0,p):p}getMaxBounds(){return this.maxBounds}setMaxBounds(r){this.maxBounds=r,this.minLat=-o.MAX_MERCATOR_LATITUDE,this.maxLat=o.MAX_MERCATOR_LATITUDE,this.minLng=-180,this.maxLng=180,r&&(this.minLat=r.getSouth(),this.maxLat=r.getNorth(),this.minLng=r.getWest(),this.maxLng=r.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=o.mercatorXfromLng(this.minLng)*this.tileSize,this.worldMaxX=o.mercatorXfromLng(this.maxLng)*this.tileSize,this.worldMinY=o.mercatorYfromLat(this.maxLat)*this.tileSize,this.worldMaxY=o.mercatorYfromLat(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(r,l){return this.projection.createTileMatrix(this,l,r)}calculateDistanceTileData(r){const l=r.key,p=this._distanceTileDataCache;if(p[l])return p[l];const _=r.canonical,x=1/this.height,T=this.cameraWorldSize,C=T/this.zoomScale(_.z),M=(_.x+Math.pow(2,_.z)*r.wrap)*C,R=_.y*C,L=this.point;L.x*=T/this.worldSize,L.y*=T/this.worldSize;const U=this.angle,G=Math.sin(-U),Q=-Math.cos(-U);return p[l]={bearing:[G,Q],center:[(L.x-M)*x,(L.y-R)*x],scale:C/o.EXTENT*x},p[l]}calculateFogTileMatrix(r){const l=r.key,p=this._fogTileMatrixCache;if(p[l])return p[l];const _=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,r);return o.multiply(_,this.worldToFogMatrix,_),p[l]=new Float32Array(_),p[l]}calculateProjMatrix(r,l=!1){const p=r.key,_=l?this._alignedProjMatrixCache:this._projMatrixCache;if(_[p])return _[p];const x=this.calculatePosMatrix(r,this.worldSize);return o.multiply(x,this.projection.isReprojectedInTileSpace?this.mercatorMatrix:l?this.alignedProjMatrix:this.projMatrix,x),_[p]=new Float32Array(x),_[p]}calculatePixelsToTileUnitsMatrix(r){const l=r.tileID.key,p=this._pixelsToTileUnitsCache;if(p[l])return p[l];const _=function(x,T){const{scale:C}=x.tileTransform,M=C*o.EXTENT/(x.tileSize*Math.pow(2,T.zoom-x.tileID.overscaledZ+x.tileID.canonical.z));return R=new Float32Array(4),G=(L=T.inverseAdjustmentMatrix)[1],Q=L[2],K=L[3],H=(U=[M,M])[1],R[0]=L[0]*(J=U[0]),R[1]=G*J,R[2]=Q*H,R[3]=K*H,R;var R,L,U,G,Q,K,J,H}(r,this);return p[l]=_,p[l]}customLayerMatrix(){return this.mercatorMatrix.slice()}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;const r=this._elevation;this._updateCameraState();const l=o.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,p=this._computeCameraPosition(l),_=this._camera.forward(),x=o.mercatorZfromAltitude(1,this._center.lat);p[2]/=x,_[2]/=x,o.normalize(_,_);const T=r.raycast(p,_,r.exaggeration());if(T){const C=o.scaleAndAdd([],p,_,T),M=new o.MercatorCoordinate(C[0],C[1],o.mercatorZfromAltitude(C[2],o.latFromMercatorY(C[1]))),R=(M.z+o.length([M.x-p[0],M.y-p[1],M.z-p[2]*x]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(R),this._centerAltitude=M.toAltitude(),this._center=this.coordinateLocation(M),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(r=!1){if(!this._elevation)return;const l=this._elevation,p=o.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,_=this._computeCameraPosition(p),x=l.getAtPointOrZero(new o.MercatorCoordinate(..._)),T=this.pixelsPerMeter/this.worldSize*x,C=this._minimumHeightOverTerrain(),M=_[2]-T;if(M<=C)if(M<0||r){const R=this.locationCoordinate(this._center,this._centerAltitude),L=[_[0],_[1],R.z-_[2]],U=o.length(L);L[2]-=(C-M)/this._pixelsPerMercatorPixel;const G=o.length(L);if(G===0)return;o.scale$2(L,L,U/G*this._pixelsPerMercatorPixel),this._camera.position=[_[0],_[1],R.z*this._pixelsPerMercatorPixel-L[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const r=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||r){const G=this.center;return G.lat=o.clamp(G.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!r)&&(G.lng=o.clamp(G.lng,this.minLng,this.maxLng)),this.center=G,void(this._constraining=!1)}const l=this._unmodified,{x:p,y:_}=this.point;let x=0,T=p,C=_;const M=this.width/2,R=this.height/2,L=this.worldMinY*this.scale,U=this.worldMaxY*this.scale;if(_-R<L&&(C=L+R),_+R>U&&(C=U-R),U-L<this.height&&(x=Math.max(x,this.height/(U-L)),C=(U+L)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const G=this.worldMinX*this.scale,Q=this.worldMaxX*this.scale,K=this.worldSize/2-(G+Q)/2;T=(p+K+this.worldSize)%this.worldSize-K,T-M<G&&(T=G+M),T+M>Q&&(T=Q-M),Q-G<this.width&&(x=Math.max(x,this.width/(Q-G)),T=(Q+G)/2)}T===p&&C===_||(this.center=this.unproject(new o.pointGeometry(T,C))),x&&(this.zoom+=this.scaleZoom(x)),this._constrainCamera(),this._unmodified=l,this._constraining=!1}_minZoomForBounds(){let r=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(r=Math.max(r,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),r}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const r=this.centerOffset,l=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=o.mercatorZfromAltitude(1,this.center.lat)/o.mercatorZfromAltitude(1,o.GLOBE_SCALE_MATCH_LATITUDE));const p=is(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,p),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const _=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?l:1),x=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);x[8]=2*-r.x/this.width,x[9]=2*r.y/this.height;let T=o.mul([],x,_);if(this.projection.isReprojectedInTileSpace){const we=this.locationCoordinate(this.center),ve=o.identity([]);o.translate(ve,ve,[we.x*this.worldSize,we.y*this.worldSize,0]),o.multiply(ve,ve,Mc(this)),o.translate(ve,ve,[-we.x*this.worldSize,-we.y*this.worldSize,0]),o.multiply(T,T,ve),this.inverseAdjustmentMatrix=function(Pe){const He=Mc(Pe,!0);return Ie([],[He[0],He[1],He[4],He[5]])}(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];this.mercatorMatrix=o.scale([],T,[this.worldSize,this.worldSize,this.worldSize/l,1]),this.projMatrix=T,this.invProjMatrix=o.invert(new Float64Array(16),this.projMatrix);const C=o.invert([],x);this.frustumCorners=o.FrustumCorners.fromInvProjectionMatrix(C,this.horizonLineFromTop(),this.height);const M=new Float32Array(16);o.identity(M),o.scale(M,M,[1,-1,1]),o.rotateX(M,M,this._pitch),o.rotateZ(M,M,this.angle);const R=o.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ),L=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;R[8]=2*-r.x/this.width,R[9]=2*(r.y+L)/this.height,this.skyboxMatrix=o.multiply(M,R,M);const U=this.point,G=U.x,Q=U.y,K=this.width%2/2,J=this.height%2/2,H=Math.cos(this.angle),W=Math.sin(this.angle),ie=G-Math.round(G)+H*K+W*J,ee=Q-Math.round(Q)+H*J+W*K,he=new Float64Array(T);if(o.translate(he,he,[ie>.5?ie-1:ie,ee>.5?ee-1:ee,0]),this.alignedProjMatrix=he,T=o.create(),o.scale(T,T,[this.width/2,-this.height/2,1]),o.translate(T,T,[1,-1,0]),this.labelPlaneMatrix=T,T=o.create(),o.scale(T,T,[1,-1,1]),o.translate(T,T,[-1,-1,0]),o.scale(T,T,[2/this.width,2/this.height,1]),this.glCoordMatrix=T,this.pixelMatrix=o.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),this._calcFogMatrices(),this._distanceTileDataCache={},T=o.invert(new Float64Array(16),this.pixelMatrix),!T)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=T,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=o.calculateGlobeMatrix(this);const we=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=o.transformMat4(we,we,_),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=T;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const r=this.cameraWorldSizeForFog,l=this.cameraPixelsPerMeter,p=this._camera.position,_=1/this.height/this._pixelsPerMercatorPixel,x=[r,r,l];o.scale$2(x,x,_),o.scale$2(p,p,-1),o.multiply$2(p,p,x);const T=o.create();o.translate(T,T,p),o.scale(T,T,x),this.mercatorFogMatrix=T,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(r,l,_)}_computeCameraPosition(r){const l=(r=r||this.pixelsPerMeter)/this.pixelsPerMeter,p=this._camera.forward(),_=this.point,x=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*l-r/this.worldSize*this._centerAltitude;return[_.x/this.worldSize-p[0]*x,_.y/this.worldSize-p[1]*x,r/this.worldSize*this._centerAltitude-p[2]*x]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(r){const l=this._maxCameraBoundsDistance()*Math.cos(this._pitch),p=this._camera.position[2],_=r[2];let x=1;this.projection.wrap&&(this.center=this.center.wrap()),_>0&&(x=Math.min((l-p)/_,1)),this._camera.position=o.scaleAndAdd([],this._camera.position,r,x),this._updateStateFromCamera()}_updateStateFromCamera(){const r=this._camera.position,l=this._camera.forward(),{pitch:p,bearing:_}=this._camera.getPitchBearing(),x=o.mercatorZfromAltitude(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,T=this._mercatorZfromZoom(this._maxZoom)*Math.cos(o.degToRad(this._maxPitch)),C=Math.max((r[2]-x)/Math.cos(p),T),M=this._zoomFromMercatorZ(C);o.scaleAndAdd(r,r,l,C),this._pitch=o.clamp(p,o.degToRad(this.minPitch),o.degToRad(this.maxPitch)),this.angle=o.wrap(_,-Math.PI,Math.PI),this._setZoom(o.clamp(M,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new o.MercatorCoordinate(r[0],r[1],r[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(r){return Math.pow(2,r)*this.tileSize}_mercatorZfromZoom(r){return this.cameraToCenterDistance/this._worldSizeFromZoom(r)}_minimumHeightOverTerrain(){const r=Math.min((this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom)+4,this._maxZoom);return this._mercatorZfromZoom(r)}_zoomFromMercatorZ(r){return this.scaleZoom(this.cameraToCenterDistance/(r*this.tileSize))}zoomFromMercatorZAdjusted(r){const l=T=>{const C=this.getCameraToCenterDistance(this.projection,T);return this.scaleZoom(C/(r*this.tileSize))};let p,_=l(this.zoom),x=Math.abs(_-l(_));for(;p!==x;)_=l(_),p=x,x=Math.abs(_-l(_));return _}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(o.warnOnce("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(r,l){const p=Math.min(r.x,l.x),_=Math.max(r.x,l.x),x=Math.min(r.y,l.y),T=Math.max(r.y,l.y);if(x<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const C=[new o.pointGeometry(p,x),new o.pointGeometry(_,T),new o.pointGeometry(p,T),new o.pointGeometry(_,x)],M=this.renderWorldCopies?-3:0,R=this.renderWorldCopies?4:1;for(const L of C){const U=this.pointRayIntersection(L);if(U.t<0)return!0;const G=this.rayIntersectionCoordinate(U);if(G.x<M||G.y<0||G.x>R||G.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+o.radToDeg(this.fovAboveCenter)>88||this.anyCornerOffEdge(new o.pointGeometry(0,0),new o.pointGeometry(this.width,this.height))}zoomDeltaToMovement(r,l){const p=o.length(o.sub([],this._camera.position,r)),_=this._zoomFromMercatorZ(p)+l;return p-this._mercatorZfromZoom(_)}getCameraPoint(){if(this.projection.name==="globe"){const r=function([l,p,_],x){const T=[l,p,_,1];o.transformMat4$1(T,T,x);const C=T[3]=Math.max(T[3],1e-6);return T[0]/=C,T[1]/=C,T[2]/=C,T}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new o.pointGeometry(r[0],r[1])}{const r=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new o.pointGeometry(0,r))}}getCameraToCenterDistance(r,l=this.zoom){const p=is(r,l,this.width,this.height,1024),_=r.pixelSpaceConversion(this.center.lat,this.worldSize,p);return .5/Math.tan(.5*this._fov)*this.height*_}getWorldToCameraMatrix(){const r=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&o.multiply(r,r,this.globeMatrix),r}}function pl(h,r){let l=!1,p=null;const _=()=>{p=null,l&&(h(),p=setTimeout(_,r),l=!1)};return()=>(l=!0,p||_(),p)}class $t{constructor(r){this._hashName=r&&encodeURIComponent(r),o.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=pl(this._updateHashUnthrottled.bind(this),300)}addTo(r){return this._map=r,o.window.addEventListener("hashchange",this._onHashChange,!1),r.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),o.window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const r=this._map;if(!r)return"";const l=Xr(r);if(this._hashName){const p=this._hashName;let _=!1;const x=o.window.location.hash.slice(1).split("&").map(T=>{const C=T.split("=")[0];return C===p?(_=!0,`${C}=${l}`):T}).filter(T=>T);return _||x.push(`${p}=${l}`),`#${x.join("&")}`}return`#${l}`}_getCurrentHash(){const r=o.window.location.hash.replace("#","");if(this._hashName){let l;return r.split("&").map(p=>p.split("=")).forEach(p=>{p[0]===this._hashName&&(l=p)}),(l&&l[1]||"").split("/")}return r.split("/")}_onHashChange(){const r=this._map;if(!r)return!1;const l=this._getCurrentHash();if(l.length>=3&&!l.some(p=>isNaN(p))){const p=r.dragRotate.isEnabled()&&r.touchZoomRotate.isEnabled()?+(l[3]||0):r.getBearing();return r.jumpTo({center:[+l[2],+l[1]],zoom:+l[0],bearing:p,pitch:+(l[4]||0)}),!0}return!1}_updateHashUnthrottled(){const r=o.window.location.href.replace(/(#.+)?$/,this.getHashString());o.window.history.replaceState(o.window.history.state,null,r)}}function Xr(h,r){const l=h.getCenter(),p=Math.round(100*h.getZoom())/100,_=Math.ceil((p*Math.LN2+Math.log(512/360/.5))/Math.LN10),x=Math.pow(10,_),T=Math.round(l.lng*x)/x,C=Math.round(l.lat*x)/x,M=h.getBearing(),R=h.getPitch();let L=r?`/${T}/${C}/${p}`:`${p}/${C}/${T}`;return(M||R)&&(L+="/"+Math.round(10*M)/10),R&&(L+=`/${Math.round(R)}`),L}const ml={linearity:.3,easing:o.bezier(0,0,.3,1)},gf=o.extend({deceleration:2500,maxSpeed:1400},ml),_f=o.extend({deceleration:20,maxSpeed:1400},ml),ha=o.extend({deceleration:1e3,maxSpeed:360},ml),yf=o.extend({deceleration:1e3,maxSpeed:90},ml);class kc{constructor(r){this._map=r,this.clear()}clear(){this._inertiaBuffer=[]}record(r){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:o.exported.now(),settings:r})}_drainInertiaBuffer(){const r=this._inertiaBuffer,l=o.exported.now();for(;r.length>0&&l-r[0].time>160;)r.shift()}_onMoveEnd(r){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const l={zoom:0,bearing:0,pitch:0,pan:new o.pointGeometry(0,0),pinchAround:void 0,around:void 0};for(const{settings:x}of this._inertiaBuffer)l.zoom+=x.zoomDelta||0,l.bearing+=x.bearingDelta||0,l.pitch+=x.pitchDelta||0,x.panDelta&&l.pan._add(x.panDelta),x.around&&(l.around=x.around),x.pinchAround&&(l.pinchAround=x.pinchAround);const p=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,_={};if(l.pan.mag()){const x=Ps(l.pan.mag(),p,o.extend({},gf,r||{}));_.offset=l.pan.mult(x.amount/l.pan.mag()),_.center=this._map.transform.center,da(_,x)}if(l.zoom){const x=Ps(l.zoom,p,_f);_.zoom=this._map.transform.zoom+x.amount,da(_,x)}if(l.bearing){const x=Ps(l.bearing,p,ha);_.bearing=this._map.transform.bearing+o.clamp(x.amount,-179,179),da(_,x)}if(l.pitch){const x=Ps(l.pitch,p,yf);_.pitch=this._map.transform.pitch+x.amount,da(_,x)}if(_.zoom||_.bearing){const x=l.pinchAround===void 0?l.around:l.pinchAround;_.around=x?this._map.unproject(x):this._map.getCenter()}return this.clear(),_.noMoveStart=!0,_}}function da(h,r){(!h.duration||h.duration<r.duration)&&(h.duration=r.duration,h.easing=r.easing)}function Ps(h,r,l){const{maxSpeed:p,linearity:_,deceleration:x}=l,T=o.clamp(h*_/(r/1e3),-p,p),C=Math.abs(T)/(x*_);return{easing:l.easing,duration:1e3*C,amount:T*(C/2)}}class kr extends o.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(r,l,p,_={}){const x=ce(l.getCanvasContainer(),p),T=l.unproject(x);super(r,o.extend({point:x,lngLat:T,originalEvent:p},_)),this._defaultPrevented=!1,this.target=l}}class gl extends o.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(r,l,p){const _=r==="touchend"?p.changedTouches:p.touches,x=fe(l.getCanvasContainer(),_),T=x.map(M=>l.unproject(M)),C=x.reduce((M,R,L,U)=>M.add(R.div(U.length)),new o.pointGeometry(0,0));super(r,{points:x,point:C,lngLats:T,lngLat:l.unproject(C),originalEvent:p}),this._defaultPrevented=!1}}class fa extends o.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(r,l,p){super(r,{originalEvent:p}),this._defaultPrevented=!1}}class wg{constructor(r,l){this._map=r,this._clickTolerance=l.clickTolerance}reset(){this._mousedownPos=void 0}wheel(r){return this._firePreventable(new fa(r.type,this._map,r))}mousedown(r,l){return this._mousedownPos=l,this._firePreventable(new kr(r.type,this._map,r))}mouseup(r){this._map.fire(new kr(r.type,this._map,r))}preclick(r){const l=o.extend({},r);l.type="preclick",this._map.fire(new kr(l.type,this._map,l))}click(r,l){this._mousedownPos&&this._mousedownPos.dist(l)>=this._clickTolerance||(this.preclick(r),this._map.fire(new kr(r.type,this._map,r)))}dblclick(r){return this._firePreventable(new kr(r.type,this._map,r))}mouseover(r){this._map.fire(new kr(r.type,this._map,r))}mouseout(r){this._map.fire(new kr(r.type,this._map,r))}touchstart(r){return this._firePreventable(new gl(r.type,this._map,r))}touchmove(r){this._map.fire(new gl(r.type,this._map,r))}touchend(r){this._map.fire(new gl(r.type,this._map,r))}touchcancel(r){this._map.fire(new gl(r.type,this._map,r))}_firePreventable(r){if(this._map.fire(r),r.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Eg{constructor(r){this._map=r}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(r){this._map.fire(new kr(r.type,this._map,r))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new kr("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(r){this._delayContextMenu?this._contextMenuEvent=r:this._map.fire(new kr(r.type,this._map,r)),this._map.listens("contextmenu")&&r.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class vf{constructor(r,l){this._map=r,this._el=r.getCanvasContainer(),this._container=r.getContainer(),this._clickTolerance=l.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(r,l){this.isEnabled()&&r.shiftKey&&r.button===0&&(ye(),this._startPos=this._lastPos=l,this._active=!0)}mousemoveWindow(r,l){if(!this._active)return;const p=l,_=this._startPos,x=this._lastPos;if(!_||!x||x.equals(p)||!this._box&&p.dist(_)<this._clickTolerance)return;this._lastPos=p,this._box||(this._box=B("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",r));const T=Math.min(_.x,p.x),C=Math.max(_.x,p.x),M=Math.min(_.y,p.y),R=Math.max(_.y,p.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${T}px,${M}px)`,this._box.style.width=C-T+"px",this._box.style.height=R-M+"px")})}mouseupWindow(r,l){if(!this._active)return;const p=this._startPos,_=l;if(p&&r.button===0){if(this.reset(),Ae(),p.x!==_.x||p.y!==_.y)return this._map.fire(new o.Event("boxzoomend",{originalEvent:r})),{cameraAnimation:x=>x.fitScreenCoordinates(p,_,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",r)}}keydown(r){this._active&&r.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",r))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),te(),delete this._startPos,delete this._lastPos}_fireEvent(r,l){return this._map.fire(new o.Event(r,{originalEvent:l}))}}function pa(h,r){const l={};for(let p=0;p<h.length;p++)l[h[p].identifier]=r[p];return l}class mh{constructor(r){this.reset(),this.numTouches=r.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(r,l,p){(this.centroid||p.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=r.timeStamp),p.length===this.numTouches&&(this.centroid=function(_){const x=new o.pointGeometry(0,0);for(const T of _)x._add(T);return x.div(_.length)}(l),this.touches=pa(p,l)))}touchmove(r,l,p){if(this.aborted||!this.centroid)return;const _=pa(p,l);for(const x in this.touches){const T=this.touches[x],C=_[x];(!C||C.dist(T)>30)&&(this.aborted=!0)}}touchend(r,l,p){if((!this.centroid||r.timeStamp-this.startTime>500)&&(this.aborted=!0),p.length===0){const _=!this.aborted&&this.centroid;if(this.reset(),_)return _}}}class Pc{constructor(r){this.singleTap=new mh(r),this.numTaps=r.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(r,l,p){this.singleTap.touchstart(r,l,p)}touchmove(r,l,p){this.singleTap.touchmove(r,l,p)}touchend(r,l,p){const _=this.singleTap.touchend(r,l,p);if(_){const x=r.timeStamp-this.lastTime<500,T=!this.lastTap||this.lastTap.dist(_)<30;if(x&&T||this.reset(),this.count++,this.lastTime=r.timeStamp,this.lastTap=_,this.count===this.numTaps)return this.reset(),_}}}class xf{constructor(){this._zoomIn=new Pc({numTouches:1,numTaps:2}),this._zoomOut=new Pc({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(r,l,p){this._zoomIn.touchstart(r,l,p),this._zoomOut.touchstart(r,l,p)}touchmove(r,l,p){this._zoomIn.touchmove(r,l,p),this._zoomOut.touchmove(r,l,p)}touchend(r,l,p){const _=this._zoomIn.touchend(r,l,p),x=this._zoomOut.touchend(r,l,p);return _?(this._active=!0,r.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:T=>T.easeTo({duration:300,zoom:T.getZoom()+1,around:T.unproject(_)},{originalEvent:r})}):x?(this._active=!0,r.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:T=>T.easeTo({duration:300,zoom:T.getZoom()-1,around:T.unproject(x)},{originalEvent:r})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const zc={0:1,2:2};class _l{constructor(r){this.reset(),this._clickTolerance=r.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(r,l){return!1}_move(r,l){return{}}mousedown(r,l){if(this._lastPoint)return;const p=Ee(r);this._correctButton(r,p)&&(this._lastPoint=l,this._eventButton=p)}mousemoveWindow(r,l){const p=this._lastPoint;if(p){if(r.preventDefault(),this._eventButton!=null&&function(_,x){const T=zc[x];return _.buttons===void 0||(_.buttons&T)!==T}(r,this._eventButton))this.reset();else if(this._moved||!(l.dist(p)<this._clickTolerance))return this._moved=!0,this._lastPoint=l,this._move(p,l)}}mouseupWindow(r){this._lastPoint&&Ee(r)===this._eventButton&&(this._moved&&Ae(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class bf extends _l{mousedown(r,l){super.mousedown(r,l),this._lastPoint&&(this._active=!0)}_correctButton(r,l){return l===0&&!r.ctrlKey}_move(r,l){return{around:l,panDelta:l.sub(r)}}}class gh extends _l{_correctButton(r,l){return l===0&&r.ctrlKey||l===2}_move(r,l){const p=.8*(l.x-r.x);if(p)return this._active=!0,{bearingDelta:p}}contextmenu(r){r.preventDefault()}}class _h extends _l{_correctButton(r,l){return l===0&&r.ctrlKey||l===2}_move(r,l){const p=-.5*(l.y-r.y);if(p)return this._active=!0,{pitchDelta:p}}contextmenu(r){r.preventDefault()}}class wf{constructor(r,l){this._map=r,this._el=r.getCanvasContainer(),this._minTouches=1,this._clickTolerance=l.clickTolerance||1,this.reset(),o.bindAll(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new o.pointGeometry(0,0)}touchstart(r,l,p){return this._calculateTransform(r,l,p)}touchmove(r,l,p){if(this._active&&!(p.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(p.length===1&&!o.isFullscreen())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return r.cancelable&&r.preventDefault(),this._calculateTransform(r,l,p)}}touchend(r,l,p){this._calculateTransform(r,l,p),this._active&&p.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(r,l,p){p.length>0&&(this._active=!0);const _=pa(p,l),x=new o.pointGeometry(0,0),T=new o.pointGeometry(0,0);let C=0;for(const R in _){const L=_[R],U=this._touches[R];U&&(x._add(L),T._add(L.sub(U)),C++,_[R]=L)}if(this._touches=_,C<this._minTouches||!T.mag())return;const M=T.div(C);return this._sum._add(M),this._sum.mag()<this._clickTolerance?void 0:{around:x.div(C),panDelta:M}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=B("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","null")},500)}}class Lc{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(r){}_move(r,l,p){return{}}touchstart(r,l,p){this._firstTwoTouches||p.length<2||(this._firstTwoTouches=[p[0].identifier,p[1].identifier],this._start([l[0],l[1]]))}touchmove(r,l,p){const _=this._firstTwoTouches;if(!_)return;r.preventDefault();const[x,T]=_,C=Bo(p,l,x),M=Bo(p,l,T);if(!C||!M)return;const R=this._aroundCenter?null:C.add(M).div(2);return this._move([C,M],R,r)}touchend(r,l,p){if(!this._firstTwoTouches)return;const[_,x]=this._firstTwoTouches,T=Bo(p,l,_),C=Bo(p,l,x);T&&C||(this._active&&Ae(),this.reset())}touchcancel(){this.reset()}enable(r){this._enabled=!0,this._aroundCenter=!!r&&r.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Bo(h,r,l){for(let p=0;p<h.length;p++)if(h[p].identifier===l)return r[p]}function yh(h,r){return Math.log(h/r)/Math.LN2}class Ef extends Lc{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(r){this._startDistance=this._distance=r[0].dist(r[1])}_move(r,l){const p=this._distance;if(this._distance=r[0].dist(r[1]),this._active||!(Math.abs(yh(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:yh(this._distance,p),pinchAround:l}}}function Tf(h,r){return 180*h.angleWith(r)/Math.PI}class Sf extends Lc{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(r){this._startVector=this._vector=r[0].sub(r[1]),this._minDiameter=r[0].dist(r[1])}_move(r,l){const p=this._vector;if(this._vector=r[0].sub(r[1]),p&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:Tf(this._vector,p),pinchAround:l}}_isBelowThreshold(r){this._minDiameter=Math.min(this._minDiameter,r.mag());const l=25/(Math.PI*this._minDiameter)*360,p=this._startVector;if(!p)return!1;const _=Tf(r,p);return Math.abs(_)<l}}function Rc(h){return Math.abs(h.y)>Math.abs(h.x)}class Cf extends Lc{constructor(r){super(),this._map=r}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(r){this._lastPoints=r,Rc(r[0].sub(r[1]))&&(this._valid=!1)}_move(r,l,p){const _=this._lastPoints;if(!_)return;const x=r[0].sub(_[0]),T=r[1].sub(_[1]);return this._map._cooperativeGestures&&!o.isFullscreen()&&p.touches.length<3||(this._valid=this.gestureBeginsVertically(x,T,p.timeStamp),!this._valid)?void 0:(this._lastPoints=r,this._active=!0,{pitchDelta:(x.y+T.y)/2*-.5})}gestureBeginsVertically(r,l,p){if(this._valid!==void 0)return this._valid;const _=r.mag()>=2,x=l.mag()>=2;if(!_&&!x)return;if(!_||!x)return this._firstMove==null&&(this._firstMove=p),p-this._firstMove<100&&void 0;const T=r.y>0==l.y>0;return Rc(r)&&Rc(l)&&T}}const Af={panStep:100,bearingStep:15,pitchStep:10};class dr{constructor(){const r=Af;this._panStep=r.panStep,this._bearingStep=r.bearingStep,this._pitchStep=r.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(r){if(r.altKey||r.ctrlKey||r.metaKey)return;let l=0,p=0,_=0,x=0,T=0;switch(r.keyCode){case 61:case 107:case 171:case 187:l=1;break;case 189:case 109:case 173:l=-1;break;case 37:r.shiftKey?p=-1:(r.preventDefault(),x=-1);break;case 39:r.shiftKey?p=1:(r.preventDefault(),x=1);break;case 38:r.shiftKey?_=1:(r.preventDefault(),T=-1);break;case 40:r.shiftKey?_=-1:(r.preventDefault(),T=1);break;default:return}return this._rotationDisabled&&(p=0,_=0),{cameraAnimation:C=>{const M=C.getZoom();C.easeTo({duration:300,easeId:"keyboardHandler",easing:Tg,zoom:l?Math.round(M)+l*(r.shiftKey?2:1):M,bearing:C.getBearing()+p*this._bearingStep,pitch:C.getPitch()+_*this._pitchStep,offset:[-x*this._panStep,-T*this._panStep],center:C.getCenter()},{originalEvent:r})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Tg(h){return h*(2-h)}const vh=4.000244140625;class Sg{constructor(r,l){this._map=r,this._el=r.getCanvasContainer(),this._handler=l,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,o.bindAll(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(r){this._defaultZoomRate=r}setWheelZoomRate(r){this._wheelZoomRate=r}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(r){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!r&&r.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(r){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(r.ctrlKey||r.metaKey||this.isZooming()||o.isFullscreen()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let l=r.deltaMode===o.window.WheelEvent.DOM_DELTA_LINE?40*r.deltaY:r.deltaY;const p=o.exported.now(),_=p-(this._lastWheelEventTime||0);this._lastWheelEventTime=p,l!==0&&l%vh==0?this._type="wheel":l!==0&&Math.abs(l)<4?this._type="trackpad":_>400?(this._type=null,this._lastValue=l,this._timeout=setTimeout(this._onTimeout,40,r)):this._type||(this._type=Math.abs(_*l)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,l+=this._lastValue)),r.shiftKey&&l&&(l/=4),this._type&&(this._lastWheelEvent=r,this._delta-=l,this._active||this._start(r)),r.preventDefault()}_onTimeout(r){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(r)}_start(r){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const l=ce(this._el,r);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:l,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const r=this._map.transform;this._type==="wheel"&&r.projection.wrap&&(r._center.lng>=180||r._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const l=()=>r._terrainEnabled()&&this._aroundCoord?r.computeZoomRelativeTo(this._aroundCoord):r.zoom;if(this._delta!==0){const M=this._type==="wheel"&&Math.abs(this._delta)>vh?this._wheelZoomRate:this._defaultZoomRate;let R=2/(1+Math.exp(-Math.abs(this._delta*M)));this._delta<0&&R!==0&&(R=1/R);const L=l(),U=Math.pow(2,L),G=typeof this._targetZoom=="number"?r.zoomScale(this._targetZoom):U;this._targetZoom=Math.min(r.maxZoom,Math.max(r.minZoom,r.scaleZoom(G*R))),this._type==="wheel"&&(this._startZoom=L,this._easing=this._smoothOutEasing(200)),this._delta=0}const p=typeof this._targetZoom=="number"?this._targetZoom:l(),_=this._startZoom,x=this._easing;let T,C=!1;if(this._type==="wheel"&&_&&x){const M=Math.min((o.exported.now()-this._lastWheelEventTime)/200,1),R=x(M);T=o.number(_,p,R),M<1?this._frameId||(this._frameId=!0):C=!0}else T=p,C=!0;return this._active=!0,C&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!C,zoomDelta:T-l(),around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(r){let l=o.ease;if(this._prevEase){const p=this._prevEase,_=(o.exported.now()-p.start)/p.duration,x=p.easing(_+.01)-p.easing(_),T=.27/Math.sqrt(x*x+1e-4)*.01,C=Math.sqrt(.0729-T*T);l=o.bezier(T,C,.25,1)}return this._prevEase={start:o.exported.now(),duration:r,easing:l},l}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=B("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(o.window.navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","null")},200)}}class Cg{constructor(r,l){this._clickZoom=r,this._tapZoom=l}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Fo{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(r,l){return r.preventDefault(),{cameraAnimation:p=>{p.easeTo({duration:300,zoom:p.getZoom()+(r.shiftKey?-1:1),around:p.unproject(l)},{originalEvent:r})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Mf{constructor(){this._tap=new Pc({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(r,l,p){this._swipePoint||(this._tapTime&&r.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?p.length>0&&(this._swipePoint=l[0],this._swipeTouch=p[0].identifier):this._tap.touchstart(r,l,p))}touchmove(r,l,p){if(this._tapTime){if(this._swipePoint){if(p[0].identifier!==this._swipeTouch)return;const _=l[0],x=_.y-this._swipePoint.y;return this._swipePoint=_,r.preventDefault(),this._active=!0,{zoomDelta:x/128}}}else this._tap.touchmove(r,l,p)}touchend(r,l,p){this._tapTime?this._swipePoint&&p.length===0&&this.reset():this._tap.touchend(r,l,p)&&(this._tapTime=r.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ma{constructor(r,l,p){this._el=r,this._mousePan=l,this._touchPan=p}enable(r){this._inertiaOptions=r||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class _o{constructor(r,l,p){this._pitchWithRotate=r.pitchWithRotate,this._mouseRotate=l,this._mousePitch=p}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Dc{constructor(r,l,p,_){this._el=r,this._touchZoom=l,this._touchRotate=p,this._tapDragZoom=_,this._rotationDisabled=!1,this._enabled=!0}enable(r){this._touchZoom.enable(r),this._rotationDisabled||this._touchRotate.enable(r),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const Zt=h=>h.zoom||h.drag||h.pitch||h.rotate;class If extends o.Event{}class kf{constructor(){this.constants=[1,1,.01],this.radius=0}setup(r,l){const p=o.sub([],l,r);this.radius=o.length(p[2]<0?o.div([],p,this.constants):[p[0],p[1],0])}projectRay(r){o.div(r,r,this.constants),o.normalize(r,r),o.mul$1(r,r,this.constants);const l=o.scale$2([],r,this.radius);if(l[2]>0){const p=o.scale$2([],[0,0,1],o.dot(l,[0,0,1])),_=o.scale$2([],o.normalize([],[l[0],l[1],0]),this.radius),x=o.add([],l,o.scale$2([],o.sub([],o.add([],_,p),l),2));l[0]=x[0],l[1]=x[1]}return l}}function os(h){return h.panDelta&&h.panDelta.mag()||h.zoomDelta||h.bearingDelta||h.pitchDelta}class yl{constructor(r,l){this._map=r,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new kc(r),this._bearingSnap=l.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new kf,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(l),o.bindAll(["handleEvent","handleWindowEvent"],this);const p=this._el;this._listeners=[[p,"touchstart",{passive:!0}],[p,"touchmove",{passive:!1}],[p,"touchend",void 0],[p,"touchcancel",void 0],[p,"mousedown",void 0],[p,"mousemove",void 0],[p,"mouseup",void 0],[o.window.document,"mousemove",{capture:!0}],[o.window.document,"mouseup",void 0],[p,"mouseover",void 0],[p,"mouseout",void 0],[p,"dblclick",void 0],[p,"click",void 0],[p,"keydown",{capture:!1}],[p,"keyup",void 0],[p,"wheel",{passive:!1}],[p,"contextmenu",void 0],[o.window,"blur",void 0]];for(const[_,x,T]of this._listeners)_.addEventListener(x,_===o.window.document?this.handleWindowEvent:this.handleEvent,T)}destroy(){for(const[r,l,p]of this._listeners)r.removeEventListener(l,r===o.window.document?this.handleWindowEvent:this.handleEvent,p)}_addDefaultHandlers(r){const l=this._map,p=l.getCanvasContainer();this._add("mapEvent",new wg(l,r));const _=l.boxZoom=new vf(l,r);this._add("boxZoom",_);const x=new xf,T=new Fo;l.doubleClickZoom=new Cg(T,x),this._add("tapZoom",x),this._add("clickZoom",T);const C=new Mf;this._add("tapDragZoom",C);const M=l.touchPitch=new Cf(l);this._add("touchPitch",M);const R=new gh(r),L=new _h(r);l.dragRotate=new _o(r,R,L),this._add("mouseRotate",R,["mousePitch"]),this._add("mousePitch",L,["mouseRotate"]);const U=new bf(r),G=new wf(l,r);l.dragPan=new ma(p,U,G),this._add("mousePan",U),this._add("touchPan",G,["touchZoom","touchRotate"]);const Q=new Sf,K=new Ef;l.touchZoomRotate=new Dc(p,K,Q,C),this._add("touchRotate",Q,["touchPan","touchZoom"]),this._add("touchZoom",K,["touchPan","touchRotate"]),this._add("blockableMapEvent",new Eg(l));const J=l.scrollZoom=new Sg(l,this);this._add("scrollZoom",J,["mousePan"]);const H=l.keyboard=new dr;this._add("keyboard",H);for(const W of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])r.interactive&&r[W]&&l[W].enable(r[W])}_add(r,l,p){this._handlers.push({handlerName:r,handler:l,allowed:p}),this._handlersById[r]=l}stop(r){if(!this._updatingCamera){for(const{handler:l}of this._handlers)l.reset();this._inertia.clear(),this._fireEvents({},{},r),this._changes=[]}}isActive(){for(const{handler:r}of this._handlers)if(r.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Zt(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(r,l,p){for(const _ in r)if(_!==p&&(!l||l.indexOf(_)<0))return!0;return!1}handleWindowEvent(r){this.handleEvent(r,`${r.type}Window`)}_getMapTouches(r){const l=[];for(const p of r)this._el.contains(p.target)&&l.push(p);return l}handleEvent(r,l){this._updatingCamera=!0;const p=r.type==="renderFrame",_=p?void 0:r,x={needsRenderFrame:!1},T={},C={},M=r.touches?this._getMapTouches(r.touches):void 0,R=M?fe(this._el,M):p?void 0:ce(this._el,r);for(const{handlerName:G,handler:Q,allowed:K}of this._handlers){if(!Q.isEnabled())continue;let J;this._blockedByActive(C,K,G)?Q.reset():Q[l||r.type]&&(J=Q[l||r.type](r,R,M),this.mergeHandlerResult(x,T,J,G,_),J&&J.needsRenderFrame&&this._triggerRenderFrame()),(J||Q.isActive())&&(C[G]=Q)}const L={};for(const G in this._previousActiveHandlers)C[G]||(L[G]=_);this._previousActiveHandlers=C,(Object.keys(L).length||os(x))&&(this._changes.push([x,T,L]),this._triggerRenderFrame()),(Object.keys(C).length||os(x))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:U}=x;U&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],U(this._map))}mergeHandlerResult(r,l,p,_,x){if(!p)return;o.extend(r,p);const T={handlerName:_,originalEvent:p.originalEvent||x};p.zoomDelta!==void 0&&(l.zoom=T),p.panDelta!==void 0&&(l.drag=T),p.pitchDelta!==void 0&&(l.pitch=T),p.bearingDelta!==void 0&&(l.rotate=T)}_applyChanges(){const r={},l={},p={};for(const[_,x,T]of this._changes)_.panDelta&&(r.panDelta=(r.panDelta||new o.pointGeometry(0,0))._add(_.panDelta)),_.zoomDelta&&(r.zoomDelta=(r.zoomDelta||0)+_.zoomDelta),_.bearingDelta&&(r.bearingDelta=(r.bearingDelta||0)+_.bearingDelta),_.pitchDelta&&(r.pitchDelta=(r.pitchDelta||0)+_.pitchDelta),_.around!==void 0&&(r.around=_.around),_.aroundCoord!==void 0&&(r.aroundCoord=_.aroundCoord),_.pinchAround!==void 0&&(r.pinchAround=_.pinchAround),_.noInertia&&(r.noInertia=_.noInertia),o.extend(l,x),o.extend(p,T);this._updateMapTransform(r,l,p),this._changes=[]}_updateMapTransform(r,l,p){const _=this._map,x=_.transform,T=ie=>[ie.x,ie.y,ie.z];if((ie=>{const ee=this._eventsInProgress.drag;return ee&&!this._handlersById[ee.handlerName].isActive()})()&&!os(r)){const ie=x.zoom;x.cameraElevationReference="sea",x.recenterOnTerrain(),x.cameraElevationReference="ground",ie!==x.zoom&&this._map._update(!0)}if(x._isCameraConstrained&&_._stop(!0),!os(r))return void this._fireEvents(l,p,!0);let{panDelta:C,zoomDelta:M,bearingDelta:R,pitchDelta:L,around:U,aroundCoord:G,pinchAround:Q}=r;x._isCameraConstrained&&(M>0&&(M=0),x._isCameraConstrained=!1),Q!==void 0&&(U=Q),(ie=>l.drag&&!this._eventsInProgress.drag)()&&U&&(this._dragOrigin=T(x.pointCoordinate3D(U)),this._trackingEllipsoid.setup(x._camera.position,this._dragOrigin)),x.cameraElevationReference="sea",_._stop(!0),U=U||_.transform.centerPoint,R&&(x.bearing+=R),L&&(x.pitch+=L),x._updateCameraState();const K=[0,0,0];if(C)if(x.projection.name==="mercator"){const ie=this._trackingEllipsoid.projectRay(x.screenPointToMercatorRay(U).dir),ee=this._trackingEllipsoid.projectRay(x.screenPointToMercatorRay(U.sub(C)).dir);K[0]=ee[0]-ie[0],K[1]=ee[1]-ie[1]}else{const ie=x.pointCoordinate(U);if(x.projection.name==="globe"){C=C.rotate(-x.angle);const ee=x._pixelsPerMercatorPixel/x.worldSize;K[0]=-C.x*o.mercatorScale(o.latFromMercatorY(ie.y))*ee,K[1]=-C.y*o.mercatorScale(x.center.lat)*ee}else{const ee=x.pointCoordinate(U.sub(C));ie&&ee&&(K[0]=ee.x-ie.x,K[1]=ee.y-ie.y)}}const J=x.zoom,H=[0,0,0];if(M){const ie=T(G||x.pointCoordinate3D(U)),ee={dir:o.normalize([],o.sub([],ie,x._camera.position))};if(ee.dir[2]<0){const he=x.zoomDeltaToMovement(ie,M);o.scale$2(H,ee.dir,he)}}const W=o.add(K,K,H);x._translateCameraConstrained(W),M&&Math.abs(x.zoom-J)>1e-4&&x.recenterOnTerrain(),x.cameraElevationReference="ground",this._map._update(),r.noInertia||this._inertia.record(r),this._fireEvents(l,p,!0)}_fireEvents(r,l,p){const _=Zt(this._eventsInProgress),x=Zt(r),T={};for(const L in r){const{originalEvent:U}=r[L];this._eventsInProgress[L]||(T[`${L}start`]=U),this._eventsInProgress[L]=r[L]}!_&&x&&this._fireEvent("movestart",x.originalEvent);for(const L in T)this._fireEvent(L,T[L]);x&&this._fireEvent("move",x.originalEvent);for(const L in r){const{originalEvent:U}=r[L];this._fireEvent(L,U)}const C={};let M;for(const L in this._eventsInProgress){const{handlerName:U,originalEvent:G}=this._eventsInProgress[L];this._handlersById[U].isActive()||(delete this._eventsInProgress[L],M=l[U]||G,C[`${L}end`]=M)}for(const L in C)this._fireEvent(L,C[L]);const R=Zt(this._eventsInProgress);if(p&&(_||x)&&!R){this._updatingCamera=!0;const L=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),U=G=>G!==0&&-this._bearingSnap<G&&G<this._bearingSnap;L?(U(L.bearing||this._map.getBearing())&&(L.bearing=0),this._map.easeTo(L,{originalEvent:M})):(this._map.fire(new o.Event("moveend",{originalEvent:M})),U(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(r,l){this._map.fire(new o.Event(r,l?{originalEvent:l}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(r=>{this._frameId=void 0,this.handleEvent(new If("renderFrame",{timeStamp:r})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const xh="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class Pf extends o.Evented{constructor(r,l){super(),this._moving=!1,this._zooming=!1,this.transform=r,this._bearingSnap=l.bearingSnap,o.bindAll(["_renderFrameCallback"],this)}getCenter(){return new o.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(r,l){return this.jumpTo({center:r},l)}panBy(r,l,p){return r=o.pointGeometry.convert(r).mult(-1),this.panTo(this.transform.center,o.extend({offset:r},l),p)}panTo(r,l,p){return this.easeTo(o.extend({center:r},l),p)}getZoom(){return this.transform.zoom}setZoom(r,l){return this.jumpTo({zoom:r},l),this}zoomTo(r,l,p){return this.easeTo(o.extend({zoom:r},l),p)}zoomIn(r,l){return this.zoomTo(this.getZoom()+1,r,l),this}zoomOut(r,l){return this.zoomTo(this.getZoom()-1,r,l),this}getBearing(){return this.transform.bearing}setBearing(r,l){return this.jumpTo({bearing:r},l),this}getPadding(){return this.transform.padding}setPadding(r,l){return this.jumpTo({padding:r},l),this}rotateTo(r,l,p){return this.easeTo(o.extend({bearing:r},l),p)}resetNorth(r,l){return this.rotateTo(0,o.extend({duration:1e3},r),l),this}resetNorthPitch(r,l){return this.easeTo(o.extend({bearing:0,pitch:0,duration:1e3},r),l),this}snapToNorth(r,l){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(r,l):this}getPitch(){return this.transform.pitch}setPitch(r,l){return this.jumpTo({pitch:r},l),this}cameraForBounds(r,l){r=o.LngLatBounds.convert(r);const p=l&&l.bearing||0,_=l&&l.pitch||0,x=r.getNorthWest(),T=r.getSouthEast();return this._cameraForBounds(this.transform,x,T,p,_,l)}_extendCameraOptions(r){const l={top:0,bottom:0,right:0,left:0};if(typeof(r=o.extend({padding:l,offset:[0,0],maxZoom:this.transform.maxZoom},r)).padding=="number"){const p=r.padding;r.padding={top:p,bottom:p,right:p,left:p}}return r.padding=o.extend(l,r.padding),r}_minimumAABBFrustumDistance(r,l){const p=l.max[0]-l.min[0],_=l.max[1]-l.min[1];return p/_>r.aspect?p/(2*Math.tan(.5*r.fovX)*r.aspect):_/(2*Math.tan(.5*r.fovY)*r.aspect)}_cameraForBoundsOnGlobe(r,l,p,_,x,T){const C=r.clone(),M=this._extendCameraOptions(T);C.bearing=_,C.pitch=x;const R=o.LngLat.convert(l),L=o.LngLat.convert(p),U=.5*(R.lat+L.lat),G=.5*(R.lng+L.lng),Q=o.latLngToECEF(U,G),K=o.normalize([],Q),J=o.normalize([],o.cross([],K,[0,1,0])),H=o.cross([],J,K),W=[J[0],J[1],J[2],0,H[0],H[1],H[2],0,K[0],K[1],K[2],0,0,0,0,1],ie=[Q,o.latLngToECEF(R.lat,R.lng),o.latLngToECEF(L.lat,R.lng),o.latLngToECEF(L.lat,L.lng),o.latLngToECEF(R.lat,L.lng),o.latLngToECEF(U,R.lng),o.latLngToECEF(U,L.lng),o.latLngToECEF(R.lat,G),o.latLngToECEF(L.lat,G)];let ee=o.Aabb.fromPoints(ie.map(De=>[o.dot(J,De),o.dot(H,De),o.dot(K,De)]));const he=o.transformMat4([],ee.center,W);o.squaredLength(he)===0&&o.set(he,0,0,1),o.normalize(he,he),o.scale$2(he,he,o.GLOBE_RADIUS),C.center=o.ecefToLatLng(he);const we=C.getWorldToCameraMatrix(),ve=o.invert(new Float64Array(16),we);ee=o.Aabb.applyTransform(ee,o.multiply([],we,W)),o.transformMat4(he,he,we);const Pe=.5*(ee.max[2]-ee.min[2]),He=this._minimumAABBFrustumDistance(C,ee),qe=o.scale$2([],[0,0,1],Pe),Le=o.add(qe,he,qe),It=He+(C.pitch===0?0:o.distance(he,Le)),Ue=C.globeCenterInViewSpace,st=o.sub([],he,[Ue[0],Ue[1],Ue[2]]);o.normalize(st,st),o.scale$2(st,st,It);const Xe=o.add([],he,st);o.transformMat4(Xe,Xe,ve);const Et=o.earthRadius/o.GLOBE_RADIUS,Je=o.length(Xe),pt=o.mercatorZfromAltitude(Je*Et-o.earthRadius,0),Pt=Math.min(C.zoomFromMercatorZAdjusted(pt),M.maxZoom);return Pt>.5*(o.GLOBE_ZOOM_THRESHOLD_MIN+o.GLOBE_ZOOM_THRESHOLD_MAX)?(C.setProjection({name:"mercator"}),C.zoom=Pt,this._cameraForBounds(C,l,p,_,x,T)):{center:C.center,zoom:Pt,bearing:_,pitch:x}}queryTerrainElevation(r,l){const p=this.transform.elevation;return p?(l=o.extend({},{exaggerated:!0},l),p.getAtPoint(o.MercatorCoordinate.fromLngLat(r),null,l.exaggerated)):null}_cameraForBounds(r,l,p,_,x,T){if(r.projection.name==="globe")return this._cameraForBoundsOnGlobe(r,l,p,_,x,T);const C=r.clone(),M=this._extendCameraOptions(T),R=C.padding;C.bearing=_,C.pitch=x;const L=o.LngLat.convert(l),U=o.LngLat.convert(p),G=new o.LngLat(L.lng,U.lat),Q=new o.LngLat(U.lng,L.lat),K=C.project(L),J=C.project(U),H=this.queryTerrainElevation(L),W=this.queryTerrainElevation(U),ie=this.queryTerrainElevation(G),ee=this.queryTerrainElevation(Q),he=[[K.x,K.y,Math.min(H||0,W||0,ie||0,ee||0)],[J.x,J.y,Math.max(H||0,W||0,ie||0,ee||0)]];let we=o.Aabb.fromPoints(he);const ve=C.getWorldToCameraMatrix(),Pe=o.invert(new Float64Array(16),ve);we=o.Aabb.applyTransform(we,ve);const He=o.sub([],we.max,we.min),qe=R.left||0,Le=R.right||0,It=R.bottom||0,Ue=R.top||0,{left:st,right:Xe,top:Et,bottom:Je}=M.padding,pt=.5*(qe+Le),Pt=.5*(Ue+It),De=Math.min(C.scaleZoom(C.scale*Math.min((C.width-(qe+Le+st+Xe))/He[0],(C.height-(It+Ue+Je+Et))/He[1])),M.maxZoom),We=C.scale/C.zoomScale(De);we=new o.Aabb([we.min[0]-(st+pt)*We,we.min[1]-(Je+Pt)*We,we.min[2]],[we.max[0]+(Xe+pt)*We,we.max[1]+(Et+Pt)*We,we.max[2]]);const Qt=.5*He[2],ln=this._minimumAABBFrustumDistance(C,we),Jt=[0,0,1,0];o.transformMat4$1(Jt,Jt,ve),o.normalize$2(Jt,Jt);const mn=o.scale$2([],Jt,ln+Qt),Tn=o.add([],we.center,mn),cn=(typeof M.offset.x=="number"&&typeof M.offset.y=="number"?new o.pointGeometry(M.offset.x,M.offset.y):o.pointGeometry.convert(M.offset)).rotate(-o.degToRad(_));we.center[0]-=cn.x*We,we.center[1]+=cn.y*We,o.transformMat4(we.center,we.center,Pe),o.transformMat4(Tn,Tn,Pe);const Gt=[we.center[0],we.center[1],Tn[2]*C.pixelsPerMeter];o.scale$2(Gt,Gt,1/C.worldSize);const ei=o.lngFromMercatorX(Gt[0]),Hn=o.latFromMercatorY(Gt[1]),li=Math.min(C._zoomFromMercatorZ(Gt[2]),M.maxZoom),ii=new o.LngLat(ei,Hn);return C.mercatorFromTransition&&li<.5*(o.GLOBE_ZOOM_THRESHOLD_MIN+o.GLOBE_ZOOM_THRESHOLD_MAX)?(C.setProjection({name:"globe"}),C.zoom=li,this._cameraForBounds(C,l,p,_,x,T)):{center:ii,zoom:li,bearing:_,pitch:x}}fitBounds(r,l,p){const _=this.cameraForBounds(r,l);return this._fitInternal(_,l,p)}fitScreenCoordinates(r,l,p,_,x){const T=o.pointGeometry.convert(r),C=o.pointGeometry.convert(l),M=new o.pointGeometry(Math.min(T.x,C.x),Math.min(T.y,C.y)),R=new o.pointGeometry(Math.max(T.x,C.x),Math.max(T.y,C.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(T,C))return this;const L=this.transform.pointLocation3D(M),U=this.transform.pointLocation3D(R),G=this.transform.pointLocation3D(new o.pointGeometry(M.x,R.y)),Q=this.transform.pointLocation3D(new o.pointGeometry(R.x,M.y)),K=[Math.min(L.lng,U.lng,G.lng,Q.lng),Math.min(L.lat,U.lat,G.lat,Q.lat)],J=[Math.max(L.lng,U.lng,G.lng,Q.lng),Math.max(L.lat,U.lat,G.lat,Q.lat)],H=_&&_.pitch?_.pitch:this.getPitch(),W=this._cameraForBounds(this.transform,K,J,p,H,_);return this._fitInternal(W,_,x)}_fitInternal(r,l,p){return r?(delete(l=o.extend(r,l)).padding,l.linear?this.easeTo(l,p):this.flyTo(l,p)):this}jumpTo(r,l){this.stop();const p=r.preloadOnly?this.transform.clone():this.transform;let _=!1,x=!1,T=!1;return"zoom"in r&&p.zoom!==+r.zoom&&(_=!0,p.zoom=+r.zoom),r.center!==void 0&&(p.center=o.LngLat.convert(r.center)),"bearing"in r&&p.bearing!==+r.bearing&&(x=!0,p.bearing=+r.bearing),"pitch"in r&&p.pitch!==+r.pitch&&(T=!0,p.pitch=+r.pitch),r.padding==null||p.isPaddingEqual(r.padding)||(p.padding=r.padding),r.preloadOnly?(this._preloadTiles(p),this):(this.fire(new o.Event("movestart",l)).fire(new o.Event("move",l)),_&&this.fire(new o.Event("zoomstart",l)).fire(new o.Event("zoom",l)).fire(new o.Event("zoomend",l)),x&&this.fire(new o.Event("rotatestart",l)).fire(new o.Event("rotate",l)).fire(new o.Event("rotateend",l)),T&&this.fire(new o.Event("pitchstart",l)).fire(new o.Event("pitch",l)).fire(new o.Event("pitchend",l)),this.fire(new o.Event("moveend",l)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||o.warnOnce(xh),this.transform.getFreeCameraOptions()}setFreeCameraOptions(r,l){const p=this.transform;if(!p.projection.supportsFreeCamera)return o.warnOnce(xh),this;this.stop();const _=p.zoom,x=p.pitch,T=p.bearing;p.setFreeCameraOptions(r);const C=_!==p.zoom,M=x!==p.pitch,R=T!==p.bearing;return this.fire(new o.Event("movestart",l)).fire(new o.Event("move",l)),C&&this.fire(new o.Event("zoomstart",l)).fire(new o.Event("zoom",l)).fire(new o.Event("zoomend",l)),R&&this.fire(new o.Event("rotatestart",l)).fire(new o.Event("rotate",l)).fire(new o.Event("rotateend",l)),M&&this.fire(new o.Event("pitchstart",l)).fire(new o.Event("pitch",l)).fire(new o.Event("pitchend",l)),this.fire(new o.Event("moveend",l)),this}easeTo(r,l){this._stop(!1,r.easeId),((r=o.extend({offset:[0,0],duration:500,easing:o.ease},r)).animate===!1||!r.essential&&o.exported.prefersReducedMotion)&&(r.duration=0);const p=this.transform,_=this.getZoom(),x=this.getBearing(),T=this.getPitch(),C=this.getPadding(),M="zoom"in r?+r.zoom:_,R="bearing"in r?this._normalizeBearing(r.bearing,x):x,L="pitch"in r?+r.pitch:T,U="padding"in r?r.padding:p.padding,G=o.pointGeometry.convert(r.offset);let Q,K,J;if(p.projection.name==="globe"){const qe=o.MercatorCoordinate.fromLngLat(p.center),Le=G.rotate(-p.angle);qe.x+=Le.x/p.worldSize,qe.y+=Le.y/p.worldSize;const It=qe.toLngLat(),Ue=o.LngLat.convert(r.center||It);this._normalizeCenter(Ue),Q=p.centerPoint.add(Le),K=new o.pointGeometry(qe.x,qe.y).mult(p.worldSize),J=new o.pointGeometry(o.mercatorXfromLng(Ue.lng),o.mercatorYfromLat(Ue.lat)).mult(p.worldSize).sub(K)}else{Q=p.centerPoint.add(G);const qe=p.pointLocation(Q),Le=o.LngLat.convert(r.center||qe);this._normalizeCenter(Le),K=p.project(qe),J=p.project(Le).sub(K)}const H=p.zoomScale(M-_);let W,ie;r.around&&(W=o.LngLat.convert(r.around),ie=p.locationPoint(W));const ee=this._zooming||M!==_,he=this._rotating||x!==R,we=this._pitching||L!==T,ve=!p.isPaddingEqual(U),Pe=qe=>Le=>{if(ee&&(qe.zoom=o.number(_,M,Le)),he&&(qe.bearing=o.number(x,R,Le)),we&&(qe.pitch=o.number(T,L,Le)),ve&&(qe.interpolatePadding(C,U,Le),Q=qe.centerPoint.add(G)),W)qe.setLocationAtPoint(W,ie);else{const It=qe.zoomScale(qe.zoom-_),Ue=M>_?Math.min(2,H):Math.max(.5,H),st=Math.pow(Ue,1-Le),Xe=qe.unproject(K.add(J.mult(Le*st)).mult(It));qe.setLocationAtPoint(qe.renderWorldCopies?Xe.wrap():Xe,Q)}return r.preloadOnly||this._fireMoveEvents(l),qe};if(r.preloadOnly){const qe=this._emulate(Pe,r.duration,p);return this._preloadTiles(qe),this}const He={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=ee,this._rotating=he,this._pitching=we,this._padding=ve,this._easeId=r.easeId,this._prepareEase(l,r.noMoveStart,He),this._ease(Pe(p),qe=>{p.recenterOnTerrain(),this._afterEase(l,qe)},r),this}_prepareEase(r,l,p={}){this._moving=!0,this.transform.cameraElevationReference="sea",l||p.moving||this.fire(new o.Event("movestart",r)),this._zooming&&!p.zooming&&this.fire(new o.Event("zoomstart",r)),this._rotating&&!p.rotating&&this.fire(new o.Event("rotatestart",r)),this._pitching&&!p.pitching&&this.fire(new o.Event("pitchstart",r))}_fireMoveEvents(r){this.fire(new o.Event("move",r)),this._zooming&&this.fire(new o.Event("zoom",r)),this._rotating&&this.fire(new o.Event("rotate",r)),this._pitching&&this.fire(new o.Event("pitch",r))}_afterEase(r,l){if(this._easeId&&l&&this._easeId===l)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const p=this._zooming,_=this._rotating,x=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,p&&this.fire(new o.Event("zoomend",r)),_&&this.fire(new o.Event("rotateend",r)),x&&this.fire(new o.Event("pitchend",r)),this.fire(new o.Event("moveend",r))}flyTo(r,l){if(!r.essential&&o.exported.prefersReducedMotion){const De=o.pick(r,["center","zoom","bearing","pitch","around"]);return this.jumpTo(De,l)}this.stop(),r=o.extend({offset:[0,0],speed:1.2,curve:1.42,easing:o.ease},r);const p=this.transform,_=this.getZoom(),x=this.getBearing(),T=this.getPitch(),C=this.getPadding(),M="zoom"in r?o.clamp(+r.zoom,p.minZoom,p.maxZoom):_,R="bearing"in r?this._normalizeBearing(r.bearing,x):x,L="pitch"in r?+r.pitch:T,U="padding"in r?r.padding:p.padding,G=p.zoomScale(M-_),Q=o.pointGeometry.convert(r.offset);let K=p.centerPoint.add(Q);const J=p.pointLocation(K),H=o.LngLat.convert(r.center||J);this._normalizeCenter(H);const W=p.project(J),ie=p.project(H).sub(W);let ee=r.curve;const he=Math.max(p.width,p.height),we=he/G,ve=ie.mag();if("minZoom"in r){const De=o.clamp(Math.min(r.minZoom,_,M),p.minZoom,p.maxZoom),We=he/p.zoomScale(De-_);ee=Math.sqrt(We/ve*2)}const Pe=ee*ee;function He(De){const We=(we*we-he*he+(De?-1:1)*Pe*Pe*ve*ve)/(2*(De?we:he)*Pe*ve);return Math.log(Math.sqrt(We*We+1)-We)}function qe(De){return(Math.exp(De)-Math.exp(-De))/2}function Le(De){return(Math.exp(De)+Math.exp(-De))/2}const It=He(0);let Ue=function(De){return Le(It)/Le(It+ee*De)},st=function(De){return he*((Le(It)*(qe(We=It+ee*De)/Le(We))-qe(It))/Pe)/ve;var We},Xe=(He(1)-It)/ee;if(Math.abs(ve)<1e-6||!isFinite(Xe)){if(Math.abs(he-we)<1e-6)return this.easeTo(r,l);const De=we<he?-1:1;Xe=Math.abs(Math.log(we/he))/ee,st=function(){return 0},Ue=function(We){return Math.exp(De*ee*We)}}r.duration="duration"in r?+r.duration:1e3*Xe/("screenSpeed"in r?+r.screenSpeed/ee:+r.speed),r.maxDuration&&r.duration>r.maxDuration&&(r.duration=0);const Et=x!==R,Je=L!==T,pt=!p.isPaddingEqual(U),Pt=De=>We=>{const Qt=We*Xe,ln=1/Ue(Qt);De.zoom=We===1?M:_+De.scaleZoom(ln),Et&&(De.bearing=o.number(x,R,We)),Je&&(De.pitch=o.number(T,L,We)),pt&&(De.interpolatePadding(C,U,We),K=De.centerPoint.add(Q));const Jt=We===1?H:De.unproject(W.add(ie.mult(st(Qt))).mult(ln));return De.setLocationAtPoint(De.renderWorldCopies?Jt.wrap():Jt,K),De._updateCameraOnTerrain(),r.preloadOnly||this._fireMoveEvents(l),De};if(r.preloadOnly){const De=this._emulate(Pt,r.duration,p);return this._preloadTiles(De),this}return this._zooming=!0,this._rotating=Et,this._pitching=Je,this._padding=pt,this._prepareEase(l,!1),this._ease(Pt(p),()=>this._afterEase(l),r),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(r,l){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const p=this._onEaseEnd;this._onEaseEnd=void 0,p.call(this,l)}if(!r){const p=this.handlers;p&&p.stop(!1)}return this}_ease(r,l,p){p.animate===!1||p.duration===0?(r(1),l()):(this._easeStart=o.exported.now(),this._easeOptions=p,this._onEaseFrame=r,this._onEaseEnd=l,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const r=Math.min((o.exported.now()-this._easeStart)/this._easeOptions.duration,1),l=this._onEaseFrame;l&&l(this._easeOptions.easing(r)),r<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(r,l){r=o.wrap(r,-180,180);const p=Math.abs(r-l);return Math.abs(r-360-l)<p&&(r-=360),Math.abs(r+360-l)<p&&(r+=360),r}_normalizeCenter(r){const l=this.transform;if(!l.renderWorldCopies||l.maxBounds)return;const p=r.lng-l.center.lng;r.lng+=p>180?-360:p<-180?360:0}_emulate(r,l,p){const _=Math.ceil(15*l/1e3),x=[],T=r(p.clone());for(let C=0;C<=_;C++){const M=T(C/_);x.push(M.clone())}return x}}class bh{constructor(r={}){this.options=r,o.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(r){const l=this.options&&this.options.compact;return this._map=r,this._container=B("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=B("button","mapboxgl-ctrl-attrib-button",this._container),B("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden","true"),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=B("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),l&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),l===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(r,l){const p=this._map._getUIString(`AttributionControl.${l}`);r.setAttribute("aria-label",p),r.removeAttribute("title"),r.firstElementChild&&r.firstElementChild.setAttribute("title",p)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let r=this._editLink;r||(r=this._editLink=this._container.querySelector(".mapbox-improve-map"));const l=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||o.config.ACCESS_TOKEN}];if(r){const p=l.reduce((_,x,T)=>(x.value&&(_+=`${x.key}=${x.value}${T<l.length-1?"&":""}`),_),"?");r.href=`${o.config.FEEDBACK_URL}/${p}#${Xr(this._map,!0)}`,r.rel="noopener nofollow",this._setElementTitle(r,"MapFeedback")}}_updateData(r){!r||r.sourceDataType!=="metadata"&&r.sourceDataType!=="visibility"&&r.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let r=[];if(this._map.style.stylesheet){const _=this._map.style.stylesheet;this.styleOwner=_.owner,this.styleId=_.id}const l=this._map.style._sourceCaches;for(const _ in l){const x=l[_];if(x.used){const T=x.getSource();T.attribution&&r.indexOf(T.attribution)<0&&r.push(T.attribution)}}r.sort((_,x)=>_.length-x.length),r=r.filter((_,x)=>{for(let T=x+1;T<r.length;T++)if(r[T].indexOf(_)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?r=[...this.options.customAttribution,...r]:r.unshift(this.options.customAttribution));const p=r.join(" | ");p!==this._attribHTML&&(this._attribHTML=p,r.length?(this._innerContainer.innerHTML=p,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class wh{constructor(){o.bindAll(["_updateLogo","_updateCompact"],this)}onAdd(r){this._map=r,this._container=B("div","mapboxgl-ctrl");const l=B("a","mapboxgl-ctrl-logo");return l.target="_blank",l.rel="noopener nofollow",l.href="https://www.mapbox.com/",l.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),l.setAttribute("rel","noopener nofollow"),this._container.appendChild(l),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(r){r&&r.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const r=this._map.style._sourceCaches;if(Object.entries(r).length===0)return!0;for(const l in r){const p=r[l].getSource();if(p.hasOwnProperty("mapbox_logo")&&!p.mapbox_logo)return!1}return!0}_updateCompact(){const r=this._container.children;if(r.length){const l=r[0];this._map.getCanvasContainer().offsetWidth<250?l.classList.add("mapboxgl-compact"):l.classList.remove("mapboxgl-compact")}}}class Eh{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(r){const l=++this._id;return this._queue.push({callback:r,id:l,cancelled:!1}),l}remove(r){const l=this._currentlyRunning,p=l?this._queue.concat(l):this._queue;for(const _ of p)if(_.id===r)return void(_.cancelled=!0)}run(r=0){const l=this._currentlyRunning=this._queue;this._queue=[];for(const p of l)if(!p.cancelled&&(p.callback(r),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function Th(h,r,l){if(h=new o.LngLat(h.lng,h.lat),r){const p=new o.LngLat(h.lng-360,h.lat),_=new o.LngLat(h.lng+360,h.lat),x=360*Math.ceil(Math.abs(h.lng-l.center.lng)/360),T=l.locationPoint(h).distSqr(r),C=r.x<0||r.y<0||r.x>l.width||r.y>l.height;l.locationPoint(p).distSqr(r)<T&&(C||Math.abs(p.lng-l.center.lng)<x)?h=p:l.locationPoint(_).distSqr(r)<T&&(C||Math.abs(_.lng-l.center.lng)<x)&&(h=_)}for(;Math.abs(h.lng-l.center.lng)>180;){const p=l.locationPoint(h);if(p.x>=0&&p.y>=0&&p.x<=l.width&&p.y<=l.height)break;h.lng>l.center.lng?h.lng-=360:h.lng+=360}return h}const ga={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class vl extends o.Evented{constructor(r,l){if(super(),(r instanceof o.window.HTMLElement||l)&&(r=o.extend({element:r},l)),o.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=r&&r.anchor||"center",this._color=r&&r.color||"#3FB1CE",this._scale=r&&r.scale||1,this._draggable=r&&r.draggable||!1,this._clickTolerance=r&&r.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=r&&r.rotation||0,this._rotationAlignment=r&&r.rotationAlignment||"auto",this._pitchAlignment=r&&r.pitchAlignment&&r.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),this._occludedOpacity=r&&r.occludedOpacity||.2,r&&r.element)this._element=r.element,this._offset=o.pointGeometry.convert(r&&r.offset||[0,0]);else{this._defaultMarker=!0,this._element=B("div");const _=41,x=27,T=V("svg",{display:"block",height:_*this._scale+"px",width:x*this._scale+"px",viewBox:`0 0 ${x} ${_}`},this._element),C=V("radialGradient",{id:"shadowGradient"},V("defs",{},T));V("stop",{offset:"10%","stop-opacity":.4},C),V("stop",{offset:"100%","stop-opacity":.05},C),V("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},T),V("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},T),V("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},T),V("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},T),this._offset=o.pointGeometry.convert(r&&r.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",_=>{_.preventDefault()}),this._element.addEventListener("mousedown",_=>{_.preventDefault()});const p=this._element.classList;for(const _ in ga)p.remove(`mapboxgl-marker-anchor-${_}`);p.add(`mapboxgl-marker-anchor-${this._anchor}`),this._popup=null}addTo(r){return r===this._map||(this.remove(),this._map=r,r.getCanvasContainer().appendChild(this._element),r.on("move",this._updateMoving),r.on("moveend",this._update),r.on("remove",this._clearFadeTimer),r._addMarker(this),this.setDraggable(this._draggable),this._update(),r.on("click",this._onMapClick)),this}remove(){const r=this._map;return r&&(r.off("click",this._onMapClick),r.off("move",this._updateMoving),r.off("moveend",this._update),r.off("mousedown",this._addDragHandler),r.off("touchstart",this._addDragHandler),r.off("mouseup",this._onUp),r.off("touchend",this._onUp),r.off("mousemove",this._onMove),r.off("touchmove",this._onMove),r.off("remove",this._clearFadeTimer),r._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(r){return this._lngLat=o.LngLat.convert(r),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(r){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),r){if(!("offset"in r.options)){const _=Math.sqrt(Math.pow(13.5,2)/2);r.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[_,-1*(38.1-13.5+_)],"bottom-right":[-_,-1*(38.1-13.5+_)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=r,r._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(r){const l=r.code,p=r.charCode||r.keyCode;l!=="Space"&&l!=="Enter"&&p!==32&&p!==13||this.togglePopup()}_onMapClick(r){const l=r.originalEvent.target,p=this._element;this._popup&&(l===p||p.contains(l))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const r=this._popup;return r?(r.isOpen()?(r.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(r.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const r=this._map,l=this._pos;if(!r||!l)return!1;const p=r.unproject(l),_=r.getFreeCameraOptions();if(!_.position)return!1;const x=_.position.toLngLat();return x.distanceTo(p)<.9*x.distanceTo(this._lngLat)}_evaluateOpacity(){const r=this._map;if(!r)return;const l=this._pos;if(!l||l.x<0||l.x>r.transform.width||l.y<0||l.y>r.transform.height)return void this._clearFadeTimer();const p=r.unproject(l);let _;r._showingGlobe()&&o.isLngLatBehindGlobe(r.transform,this._lngLat)?_=0:(_=1-r._queryFogOpacity(p),r.transform._terrainEnabled()&&r.getTerrain()&&this._behindTerrain()&&(_*=this._occludedOpacity)),this._element.style.opacity=`${_}`,this._element.style.pointerEvents=_>0?"auto":"none",this._popup&&this._popup._setOpacity(_),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const r=this._pos;if(!r||!this._map)return;const l=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${r.x}px,${r.y}px)
            ${ga[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${l.x}px,${l.y}px)
        `}_calculateXYTransform(){const r=this._pos,l=this._map,p=this.getPitchAlignment();if(!l||!r||p!=="map")return"";if(!l._showingGlobe()){const M=l.getPitch();return M?`rotateX(${M}deg)`:""}const _=o.radToDeg(o.globeTiltAtLngLat(l.transform,this._lngLat)),x=r.sub(o.globeCenterToScreenPoint(l.transform)),T=Math.abs(x.x)+Math.abs(x.y);if(T===0)return"";const C=_/T;return`rotateX(${-x.y*C}deg) rotateY(${x.x*C}deg)`}_calculateZTransform(){const r=this._pos,l=this._map;if(!l||!r)return"";let p=0;const _=this.getRotationAlignment();if(_==="map")if(l._showingGlobe()){const x=l.project(new o.LngLat(this._lngLat.lng,this._lngLat.lat+.001)),T=l.project(new o.LngLat(this._lngLat.lng,this._lngLat.lat-.001)).sub(x);p=o.radToDeg(Math.atan2(T.y,T.x))-90}else p=-l.getBearing();else if(_==="horizon"){const x=o.smoothstep(4,6,l.getZoom()),T=o.globeCenterToScreenPoint(l.transform);T.y+=x*l.transform.height;const C=r.sub(T),M=o.radToDeg(Math.atan2(C.y,C.x));p=(M>90?M-270:M+90)*(1-x)}return p+=this._rotation,p?`rotateZ(${p}deg)`:""}_update(r){o.window.cancelAnimationFrame(this._updateFrameId);const l=this._map;l&&(l.transform.renderWorldCopies&&(this._lngLat=Th(this._lngLat,this._pos,l.transform)),this._pos=l.project(this._lngLat),r===!0?this._updateFrameId=o.window.requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),l._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(l._showingGlobe()||l.getTerrain()||l.getFog())&&!this._fadeTimer&&(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(r){return this._offset=o.pointGeometry.convert(r),this._update(),this}_onMove(r){const l=this._map;if(!l)return;const p=this._pointerdownPos,_=this._positionDelta;if(p&&_){if(!this._isDragging){const x=this._clickTolerance||l._clickTolerance;if(r.point.dist(p)<x)return;this._isDragging=!0}this._pos=r.point.sub(_),this._lngLat=l.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new o.Event("dragstart"))),this.fire(new o.Event("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const r=this._map;r&&(r.off("mousemove",this._onMove),r.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new o.Event("dragend")),this._state="inactive"}_addDragHandler(r){const l=this._map,p=this._pos;l&&p&&this._element.contains(r.originalEvent.target)&&(r.preventDefault(),this._positionDelta=r.point.sub(p),this._pointerdownPos=r.point,this._state="pending",l.on("mousemove",this._onMove),l.on("touchmove",this._onMove),l.once("mouseup",this._onUp),l.once("touchend",this._onUp))}setDraggable(r){this._draggable=!!r;const l=this._map;return l&&(r?(l.on("mousedown",this._addDragHandler),l.on("touchstart",this._addDragHandler)):(l.off("mousedown",this._addDragHandler),l.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(r){return this._rotation=r||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(r){return this._rotationAlignment=r||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(r){return this._pitchAlignment=r||"auto",this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(r){return this._occludedOpacity=r||.2,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const Oc={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},zf=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Sh(h=new o.pointGeometry(0,0),r="bottom"){if(typeof h=="number"){const l=Math.round(Math.sqrt(.5*Math.pow(h,2)));switch(r){case"top":return new o.pointGeometry(0,h);case"top-left":return new o.pointGeometry(l,l);case"top-right":return new o.pointGeometry(-l,l);case"bottom":return new o.pointGeometry(0,-h);case"bottom-left":return new o.pointGeometry(l,-l);case"bottom-right":return new o.pointGeometry(-l,-l);case"left":return new o.pointGeometry(h,0);case"right":return new o.pointGeometry(-h,0)}return new o.pointGeometry(0,0)}return h instanceof o.pointGeometry||Array.isArray(h)?o.pointGeometry.convert(h):o.pointGeometry.convert(h[r]||[0,0])}class Lf{constructor(r){this.jumpTo(r)}getValue(r){if(r<=this._startTime)return this._start;if(r>=this._endTime)return this._end;const l=o.easeCubicInOut((r-this._startTime)/(this._endTime-this._startTime));return this._start*(1-l)+this._end*l}isEasing(r){return r>=this._startTime&&r<=this._endTime}jumpTo(r){this._startTime=-1/0,this._endTime=-1/0,this._start=r,this._end=r}easeTo(r,l,p){this._start=this.getValue(l),this._end=r,this._startTime=l,this._endTime=l+p}}const Rf={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use \u2318 + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},Df={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,optimizeForTerrain:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0},Of={showCompass:!0,showZoom:!0,visualizePitch:!1};class Bf{constructor(r,l,p=!1){this._clickTolerance=10,this.element=l,this.mouseRotate=new gh({clickTolerance:r.dragRotate._mouseRotate._clickTolerance}),this.map=r,p&&(this.mousePitch=new _h({clickTolerance:r.dragRotate._mousePitch._clickTolerance})),o.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),l.addEventListener("mousedown",this.mousedown),l.addEventListener("touchstart",this.touchstart,{passive:!1}),l.addEventListener("touchmove",this.touchmove),l.addEventListener("touchend",this.touchend),l.addEventListener("touchcancel",this.reset)}down(r,l){this.mouseRotate.mousedown(r,l),this.mousePitch&&this.mousePitch.mousedown(r,l),ye()}move(r,l){const p=this.map,_=this.mouseRotate.mousemoveWindow(r,l),x=_&&_.bearingDelta;if(x&&p.setBearing(p.getBearing()+x),this.mousePitch){const T=this.mousePitch.mousemoveWindow(r,l),C=T&&T.pitchDelta;C&&p.setPitch(p.getPitch()+C)}}off(){const r=this.element;r.removeEventListener("mousedown",this.mousedown),r.removeEventListener("touchstart",this.touchstart,{passive:!1}),r.removeEventListener("touchmove",this.touchmove),r.removeEventListener("touchend",this.touchend),r.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){te(),o.window.removeEventListener("mousemove",this.mousemove),o.window.removeEventListener("mouseup",this.mouseup)}mousedown(r){this.down(o.extend({},r,{ctrlKey:!0,preventDefault:()=>r.preventDefault()}),ce(this.element,r)),o.window.addEventListener("mousemove",this.mousemove),o.window.addEventListener("mouseup",this.mouseup)}mousemove(r){this.move(r,ce(this.element,r))}mouseup(r){this.mouseRotate.mouseupWindow(r),this.mousePitch&&this.mousePitch.mouseupWindow(r),this.offTemp()}touchstart(r){r.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=fe(this.element,r.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>r.preventDefault()},this._startPos))}touchmove(r){r.targetTouches.length!==1?this.reset():(this._lastPos=fe(this.element,r.targetTouches)[0],this.move({preventDefault:()=>r.preventDefault()},this._lastPos))}touchend(r){r.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const Ch={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},Ff={maxWidth:100,unit:"metric"};function Nf(h,r,l){const p=Ah(r),_=p/r,x={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"}[l];this._map._requestDomTask(()=>{this._container.style.width=h*_+"px",this._container.innerHTML=`${p}&nbsp;${x}`})}function Ah(h){const r=Math.pow(10,`${Math.floor(h)}`.length-1);let l=h/r;return l=l>=10?10:l>=5?5:l>=3?3:l>=2?2:l>=1?1:function(p){const _=Math.pow(10,Math.ceil(-Math.log(p)/Math.LN10));return Math.round(p*_)/_}(l),r*l}const xl={version:o.version,supported:k,setRTLTextPlugin:o.setRTLTextPlugin,getRTLTextPluginStatus:o.getRTLTextPluginStatus,Map:class extends Pf{constructor(h){if(o.LivePerformanceUtils.mark(o.PerformanceMarkers.create),(h=o.extend({},Df,h)).minZoom!=null&&h.maxZoom!=null&&h.minZoom>h.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(h.minPitch!=null&&h.maxPitch!=null&&h.minPitch>h.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(h.minPitch!=null&&h.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(h.maxPitch!=null&&h.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(h.antialias&&o.isSafariWithAntialiasingBug(o.window)&&(h.antialias=!1,o.warnOnce("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new ua(h.minZoom,h.maxZoom,h.minPitch,h.maxPitch,h.renderWorldCopies),h),this._interactive=h.interactive,this._minTileCacheSize=h.minTileCacheSize,this._maxTileCacheSize=h.maxTileCacheSize,this._failIfMajorPerformanceCaveat=h.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=h.preserveDrawingBuffer,this._antialias=h.antialias,this._trackResize=h.trackResize,this._bearingSnap=h.bearingSnap,this._refreshExpiredTiles=h.refreshExpiredTiles,this._fadeDuration=h.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=h.crossSourceCollisions,this._collectResourceTiming=h.collectResourceTiming,this._optimizeForTerrain=h.optimizeForTerrain,this._language=this._parseLanguage(h.language),this._worldview=h.worldview,this._renderTaskQueue=new Eh,this._domRenderTaskQueue=new Eh,this._controls=[],this._markers=[],this._popups=[],this._mapId=o.uniqueId(),this._locale=o.extend({},Rf,h.locale),this._clickTolerance=h.clickTolerance,this._cooperativeGestures=h.cooperativeGestures,this._performanceMetricsCollection=h.performanceMetricsCollection,this._containerWidth=0,this._containerHeight=0,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new Lf(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._requestManager=new o.RequestManager(h.transformRequest,h.accessToken,h.testMode),this._silenceAuthErrors=!!h.testMode,typeof h.container=="string"){if(this._container=o.window.document.getElementById(h.container),!this._container)throw new Error(`Container '${h.container}' not found.`)}else{if(!(h.container instanceof o.window.HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=h.container}if(this._container.childNodes.length>0&&o.warnOnce("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),h.maxBounds&&this.setMaxBounds(h.maxBounds),o.bindAll(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),o.window!==void 0&&(o.window.addEventListener("online",this._onWindowOnline,!1),o.window.addEventListener("resize",this._onWindowResize,!1),o.window.addEventListener("orientationchange",this._onWindowResize,!1),o.window.addEventListener("webkitfullscreenchange",this._onWindowResize,!1),o.window.addEventListener("visibilitychange",this._onVisibilityChange,!1)),this.handlers=new yl(this,h),this._localFontFamily=h.localFontFamily,this._localIdeographFontFamily=h.localIdeographFontFamily,h.style&&this.setStyle(h.style,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),h.projection&&this.setProjection(h.projection),this._hash=h.hash&&new $t(typeof h.hash=="string"&&h.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:h.center,zoom:h.zoom,bearing:h.bearing,pitch:h.pitch}),h.bounds&&(this.resize(),this.fitBounds(h.bounds,o.extend({},h.fitBoundsOptions,{duration:0})))),this.resize(),h.attributionControl&&this.addControl(new bh({customAttribution:h.customAttribution})),this._logoControl=new wh,this.addControl(this._logoControl,h.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",r=>{this._update(r.dataType==="style"),this.fire(new o.Event(`${r.dataType}data`,r))}),this.on("dataloading",r=>{this.fire(new o.Event(`${r.dataType}dataloading`,r))})}_getMapId(){return this._mapId}addControl(h,r){if(r===void 0&&(r=h.getDefaultPosition?h.getDefaultPosition():"top-right"),!h||!h.onAdd)return this.fire(new o.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const l=h.onAdd(this);this._controls.push(h);const p=this._controlPositions[r];return r.indexOf("bottom")!==-1?p.insertBefore(l,p.firstChild):p.appendChild(l),this}removeControl(h){if(!h||!h.onRemove)return this.fire(new o.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const r=this._controls.indexOf(h);return r>-1&&this._controls.splice(r,1),h.onRemove(this),this}hasControl(h){return this._controls.indexOf(h)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(h){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const r=!this._moving;return r&&this.fire(new o.Event("movestart",h)).fire(new o.Event("move",h)),this.fire(new o.Event("resize",h)),r&&this.fire(new o.Event("moveend",h)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(h){return this.transform.setMaxBounds(o.LngLatBounds.convert(h)),this._update()}setMinZoom(h){if((h=h==null?-2:h)>=-2&&h<=this.transform.maxZoom)return this.transform.minZoom=h,this._update(),this.getZoom()<h?this.setZoom(h):this.fire(new o.Event("zoomstart")).fire(new o.Event("zoom")).fire(new o.Event("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(h){if((h=h==null?22:h)>=this.transform.minZoom)return this.transform.maxZoom=h,this._update(),this.getZoom()>h?this.setZoom(h):this.fire(new o.Event("zoomstart")).fire(new o.Event("zoom")).fire(new o.Event("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(h){if((h=h==null?0:h)<0)throw new Error("minPitch must be greater than or equal to 0");if(h>=0&&h<=this.transform.maxPitch)return this.transform.minPitch=h,this._update(),this.getPitch()<h?this.setPitch(h):this.fire(new o.Event("pitchstart")).fire(new o.Event("pitch")).fire(new o.Event("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(h){if((h=h==null?85:h)>85)throw new Error("maxPitch must be less than or equal to 85");if(h>=this.transform.minPitch)return this.transform.maxPitch=h,this._update(),this.getPitch()>h?this.setPitch(h):this.fire(new o.Event("pitchstart")).fire(new o.Event("pitch")).fire(new o.Event("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(h){return this.transform.renderWorldCopies=h,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(h){return h==="auto"?o.window.navigator.language:Array.isArray(h)?h.length===0?void 0:h.map(r=>r==="auto"?o.window.navigator.language:r):h}setLanguage(h){const r=this._parseLanguage(h);if(!this.style||r===this._language)return this;this._language=r,this.style._reloadSources();for(const l of this._controls)l._setLanguage&&l._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(h){return this.style&&h!==this._worldview?(this._worldview=h,this.style._reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(h){return this._lazyInitEmptyStyle(),h?typeof h=="string"&&(h={name:h}):h=null,this._useExplicitProjection=!!h,this._prioritizeAndUpdateProjection(h,this.style.stylesheet?this.style.stylesheet.projection:null)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;const h=this.transform,r=h.projection.name;let l;r==="globe"&&h.zoom>=o.GLOBE_ZOOM_THRESHOLD_MAX?(h.setMercatorFromTransition(),l=!0):r==="mercator"&&h.zoom<o.GLOBE_ZOOM_THRESHOLD_MAX&&(h.setProjection({name:"globe"}),l=!0),l&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(h,r){return this._updateProjection(h||r||{name:"mercator"})}_updateProjection(h){let r;if(r=h.name==="globe"&&this.transform.zoom>=o.GLOBE_ZOOM_THRESHOLD_MAX?this.transform.setMercatorFromTransition():this.transform.setProjection(h),this.style.applyProjectionUpdate(),r){this.painter.clearBackgroundTiles();for(const l in this.style._sourceCaches)this.style._sourceCaches[l].clearTiles();this._update(!0),this._forceMarkerAndPopupUpdate(!0)}return this}project(h){return this.transform.locationPoint3D(o.LngLat.convert(h))}unproject(h){return this.transform.pointLocation3D(o.pointGeometry.convert(h))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(h,r,l){if(h==="mouseenter"||h==="mouseover"){let p=!1;const _=T=>{const C=r.filter(R=>this.getLayer(R)),M=C.length?this.queryRenderedFeatures(T.point,{layers:C}):[];M.length?p||(p=!0,l.call(this,new kr(h,this,T.originalEvent,{features:M}))):p=!1},x=()=>{p=!1};return{layers:new Set(r),listener:l,delegates:{mousemove:_,mouseout:x}}}if(h==="mouseleave"||h==="mouseout"){let p=!1;const _=T=>{const C=r.filter(M=>this.getLayer(M));(C.length?this.queryRenderedFeatures(T.point,{layers:C}):[]).length?p=!0:p&&(p=!1,l.call(this,new kr(h,this,T.originalEvent)))},x=T=>{p&&(p=!1,l.call(this,new kr(h,this,T.originalEvent)))};return{layers:new Set(r),listener:l,delegates:{mousemove:_,mouseout:x}}}{const p=_=>{const x=r.filter(C=>this.getLayer(C)),T=x.length?this.queryRenderedFeatures(_.point,{layers:x}):[];T.length&&(_.features=T,l.call(this,_),delete _.features)};return{layers:new Set(r),listener:l,delegates:{[h]:p}}}}on(h,r,l){if(l===void 0)return super.on(h,r);Array.isArray(r)||(r=[r]);const p=this._createDelegatedListener(h,r,l);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[h]=this._delegatedListeners[h]||[],this._delegatedListeners[h].push(p);for(const _ in p.delegates)this.on(_,p.delegates[_]);return this}once(h,r,l){if(l===void 0)return super.once(h,r);Array.isArray(r)||(r=[r]);const p=this._createDelegatedListener(h,r,l);for(const _ in p.delegates)this.once(_,p.delegates[_]);return this}off(h,r,l){if(l===void 0)return super.off(h,r);r=new Set(Array.isArray(r)?r:[r]);const p=(x,T)=>{if(x.size!==T.size)return!1;for(const C of x)if(!T.has(C))return!1;return!0},_=this._delegatedListeners?this._delegatedListeners[h]:void 0;return _&&(x=>{for(let T=0;T<x.length;T++){const C=x[T];if(C.listener===l&&p(C.layers,r)){for(const M in C.delegates)this.off(M,C.delegates[M]);return x.splice(T,1),this}}})(_),this}queryRenderedFeatures(h,r){return this.style?(r!==void 0||h===void 0||h instanceof o.pointGeometry||Array.isArray(h)||(r=h,h=void 0),this.style.queryRenderedFeatures(h=h||[[0,0],[this.transform.width,this.transform.height]],r=r||{},this.transform)):[]}querySourceFeatures(h,r){return this.style.querySourceFeatures(h,r)}setStyle(h,r){return(r=o.extend({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},r)).diff!==!1&&r.localIdeographFontFamily===this._localIdeographFontFamily&&r.localFontFamily===this._localFontFamily&&this.style&&h?(this._diffStyle(h,r),this):(this._localIdeographFontFamily=r.localIdeographFontFamily,this._localFontFamily=r.localFontFamily,this._updateStyle(h,r))}_getUIString(h){const r=this._locale[h];if(r==null)throw new Error(`Missing UI string '${h}'`);return r}_updateStyle(h,r){return this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),h&&(this.style=new rr(this,r||{}),this.style.setEventedParent(this,{style:this.style}),typeof h=="string"?this.style.loadURL(h):this.style.loadJSON(h)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new rr(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(h,r){if(typeof h=="string"){const l=this._requestManager.normalizeStyleURL(h),p=this._requestManager.transformRequest(l,o.ResourceType.Style);o.getJSON(p,(_,x)=>{_?this.fire(new o.ErrorEvent(_)):x&&this._updateDiff(x,r)})}else typeof h=="object"&&this._updateDiff(h,r)}_updateDiff(h,r){try{this.style.setState(h)&&this._update(!0)}catch(l){o.warnOnce(`Unable to perform style diff: ${l.message||l.error||l}.  Rebuilding the style from scratch.`),this._updateStyle(h,r)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(o.warnOnce("There is no style added to the map."),!1)}addSource(h,r){return this._lazyInitEmptyStyle(),this.style.addSource(h,r),this._update(!0)}isSourceLoaded(h){return!!this.style&&this.style._isSourceCacheLoaded(h)}areTilesLoaded(){const h=this.style&&this.style._sourceCaches;for(const r in h){const l=h[r]._tiles;for(const p in l){const _=l[p];if(_.state!=="loaded"&&_.state!=="errored")return!1}}return!0}addSourceType(h,r,l){this._lazyInitEmptyStyle(),this.style.addSourceType(h,r,l)}removeSource(h){return this.style.removeSource(h),this._updateTerrain(),this._update(!0)}getSource(h){return this.style.getSource(h)}addImage(h,r,{pixelRatio:l=1,sdf:p=!1,stretchX:_,stretchY:x,content:T}={}){if(this._lazyInitEmptyStyle(),r instanceof o.window.HTMLImageElement||o.window.ImageBitmap&&r instanceof o.window.ImageBitmap){const{width:C,height:M,data:R}=o.exported.getImageData(r);this.style.addImage(h,{data:new o.RGBAImage({width:C,height:M},R),pixelRatio:l,stretchX:_,stretchY:x,content:T,sdf:p,version:0})}else if(r.width===void 0||r.height===void 0)this.fire(new o.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:C,height:M}=r,R=r;this.style.addImage(h,{data:new o.RGBAImage({width:C,height:M},new Uint8Array(R.data)),pixelRatio:l,stretchX:_,stretchY:x,content:T,sdf:p,version:0,userImage:R}),R.onAdd&&R.onAdd(this,h)}}updateImage(h,r){const l=this.style.getImage(h);if(!l)return void this.fire(new o.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const p=r instanceof o.window.HTMLImageElement||o.window.ImageBitmap&&r instanceof o.window.ImageBitmap?o.exported.getImageData(r):r,{width:_,height:x}=p;_!==void 0&&x!==void 0?_===l.data.width&&x===l.data.height?(l.data.replace(p.data,!(r instanceof o.window.HTMLImageElement||o.window.ImageBitmap&&r instanceof o.window.ImageBitmap)),this.style.updateImage(h,l)):this.fire(new o.ErrorEvent(new Error(`The width and height of the updated image (${_}, ${x})
                must be that same as the previous version of the image
                (${l.data.width}, ${l.data.height})`))):this.fire(new o.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")))}hasImage(h){return h?!!this.style.getImage(h):(this.fire(new o.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(h){this.style.removeImage(h)}loadImage(h,r){o.getImage(this._requestManager.transformRequest(h,o.ResourceType.Image),(l,p)=>{r(l,p instanceof o.window.HTMLImageElement?o.exported.getImageData(p):p)})}listImages(){return this.style.listImages()}addLayer(h,r){return this._lazyInitEmptyStyle(),this.style.addLayer(h,r),this._update(!0)}moveLayer(h,r){return this.style.moveLayer(h,r),this._update(!0)}removeLayer(h){return this.style.removeLayer(h),this._update(!0)}getLayer(h){return this.style.getLayer(h)}setLayerZoomRange(h,r,l){return this.style.setLayerZoomRange(h,r,l),this._update(!0)}setFilter(h,r,l={}){return this.style.setFilter(h,r,l),this._update(!0)}getFilter(h){return this.style.getFilter(h)}setPaintProperty(h,r,l,p={}){return this.style.setPaintProperty(h,r,l,p),this._update(!0)}getPaintProperty(h,r){return this.style.getPaintProperty(h,r)}setLayoutProperty(h,r,l,p={}){return this.style.setLayoutProperty(h,r,l,p),this._update(!0)}getLayoutProperty(h,r){return this.style.getLayoutProperty(h,r)}setLight(h,r={}){return this._lazyInitEmptyStyle(),this.style.setLight(h,r),this._update(!0)}getLight(){return this.style.getLight()}setTerrain(h){return this._lazyInitEmptyStyle(),!h&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(h),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(h){return this._lazyInitEmptyStyle(),this.style.setFog(h),this._update(!0)}getFog(){return this.style?this.style.getFog():null}_queryFogOpacity(h){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(o.LngLat.convert(h),this.transform):0}setFeatureState(h,r){return this.style.setFeatureState(h,r),this._update()}removeFeatureState(h,r){return this.style.removeFeatureState(h,r),this._update()}getFeatureState(h){return this.style.getFeatureState(h)}_updateContainerDimensions(){if(!this._container)return;const h=this._container.getBoundingClientRect().width||400,r=this._container.getBoundingClientRect().height||300;let l,p,_,x=this._container;for(;x&&(!p||!_);){const T=o.window.getComputedStyle(x).transform;T&&T!=="none"&&(l=T.match(/matrix.*\((.+)\)/)[1].split(", "),l[0]&&l[0]!=="0"&&l[0]!=="1"&&(p=l[0]),l[3]&&l[3]!=="0"&&l[3]!=="1"&&(_=l[3])),x=x.parentElement}this._containerWidth=p?Math.abs(h/p):h,this._containerHeight=_?Math.abs(r/_):r}_detectMissingCSS(){o.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&o.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const h=this._container;h.classList.add("mapboxgl-map"),(this._missingCSSCanary=B("div","mapboxgl-canary",h)).style.visibility="hidden",this._detectMissingCSS();const r=this._canvasContainer=B("div","mapboxgl-canvas-container",h);this._interactive&&r.classList.add("mapboxgl-interactive"),this._canvas=B("canvas","mapboxgl-canvas",r),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const l=this._controlContainer=B("div","mapboxgl-control-container",h),p=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(_=>{p[_]=B("div",`mapboxgl-ctrl-${_}`,l)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(h,r){const l=o.exported.devicePixelRatio||1;this._canvas.width=l*Math.ceil(h),this._canvas.height=l*Math.ceil(r),this._canvas.style.width=`${h}px`,this._canvas.style.height=`${r}px`}_addMarker(h){this._markers.push(h)}_removeMarker(h){const r=this._markers.indexOf(h);r!==-1&&this._markers.splice(r,1)}_addPopup(h){this._popups.push(h)}_removePopup(h){const r=this._popups.indexOf(h);r!==-1&&this._popups.splice(r,1)}_setupPainter(){const h=o.extend({},k.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),r=this._canvas.getContext("webgl",h)||this._canvas.getContext("experimental-webgl",h);r?(o.storeAuthState(r,!0),this.painter=new bg(r,this.transform),this.on("data",l=>{l.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),o.exported$1.testSupport(r)):this.fire(new o.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(h){h.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new o.Event("webglcontextlost",{originalEvent:h}))}_contextRestored(h){this._setupPainter(),this.resize(),this._update(),this.fire(new o.Event("webglcontextrestored",{originalEvent:h}))}_onMapScroll(h){if(h.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(h){return this.style?(this._styleDirty=this._styleDirty||h,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(h){return this._update(),this._renderTaskQueue.add(h)}_cancelRenderFrame(h){this._renderTaskQueue.remove(h)}_requestDomTask(h){!this.loaded()||this.loaded()&&!this.isMoving()?h():this._domRenderTaskQueue.add(h)}_render(h){let r;const l=this.painter.context.extTimerQuery,p=o.exported.now();if(this.listens("gpu-timing-frame")&&(r=l.createQueryEXT(),l.beginQueryEXT(l.TIME_ELAPSED_EXT,r)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],o.window.performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],o.window.performance.now())),this._renderTaskQueue.run(h),this._domRenderTaskQueue.run(h),this._removed)return;this._updateProjectionTransition();const _=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const C=this.transform.zoom,M=this.transform.pitch,R=o.exported.now(),L=new o.EvaluationParameters(C,{now:R,fadeDuration:_,pitch:M,transition:this.style.getTransition()});this.style.update(L)}this.style&&this.style.fog&&this.style.fog.hasTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let x=!1;if(this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),x=this._updateAverageElevation(p),this.style._updateSources(this.transform),this._forceMarkerAndPopupUpdate()):x=this._updateAverageElevation(p),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,_,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showTerrainWireframe:this.showTerrainWireframe,showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:_,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new o.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new o.Event("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),r){const C=o.exported.now()-p;l.endQueryEXT(l.TIME_ELAPSED_EXT,r),setTimeout(()=>{const M=l.getQueryObjectEXT(r,l.QUERY_RESULT_EXT)/1e6;l.deleteQueryEXT(r),this.fire(new o.Event("gpu-timing-frame",{cpuTime:C,gpuTime:M})),o.window.performance.mark("frame-gpu",{startTime:p,detail:{gpuTime:M}})},50)}if(this.listens("gpu-timing-layer")){const C=this.painter.collectGpuTimers();setTimeout(()=>{const M=this.painter.queryGpuTimers(C);this.fire(new o.Event("gpu-timing-layer",{layerTimes:M}))},50)}if(this.listens("gpu-timing-deferred-render")){const C=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const M=this.painter.queryGpuTimeDeferredRender(C);this.fire(new o.Event("gpu-timing-deferred-render",{gpuTime:M}))},50)}const T=this._sourcesDirty||this._styleDirty||this._placementDirty||x;if(T||this._repaint)this.triggerRepaint();else{const C=!this.isMoving()&&this.loaded();if(C&&(x=this._updateAverageElevation(p,!0)),x)this.triggerRepaint();else if(this._triggerFrame(!1),C&&(this.fire(new o.Event("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const M=this._calculateSpeedIndex();this.fire(new o.Event("speedindexcompleted",{speedIndex:M})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||T||(this._fullyLoaded=!0,o.LivePerformanceUtils.mark(o.PerformanceMarkers.fullLoad),this._performanceMetricsCollection&&o.postPerformanceEvent(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(h){for(const r of this._markers)h&&!this.getRenderWorldCopies()&&(r._lngLat=r._lngLat.wrap()),r._update();for(const r of this._popups)!h||this.getRenderWorldCopies()||r._trackPointer||(r._lngLat=r._lngLat.wrap()),r._update()}_updateAverageElevation(h,r=!1){const l=p=>(this.transform.averageElevation=p,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&l(0);if((r||h-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(h)){const p=this.transform.averageElevation;let _=this.transform.sampleAverageElevation(),x=!1;this.transform.elevation&&(x=this.transform.elevation.exaggeration()!==this._averageElevationExaggeration,this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(_)?_=0:this._averageElevationLastSampledAt=h;const T=Math.abs(p-_);if(T>1){if(this._isInitialLoad||x)return this._averageElevation.jumpTo(_),l(_);this._averageElevation.easeTo(_,h,300)}else if(T>1e-4)return this._averageElevation.jumpTo(_),l(_)}return!!this._averageElevation.isEasing(h)&&l(this._averageElevation.getValue(h))}_authenticate(){o.getMapSessionAPI(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,h=>{if(h&&(h.message===o.AUTH_ERR_MSG||h.status===401)){const r=this.painter.context.gl;o.storeAuthState(r,!1),this._logoControl instanceof wh&&this._logoControl._updateLogo(),r&&r.clear(r.DEPTH_BUFFER_BIT|r.COLOR_BUFFER_BIT|r.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new o.ErrorEvent(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),o.postMapLoadEvent(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_updateTerrain(){const h=this._isDragging();this.painter.updateTerrain(this.style,h)}_calculateSpeedIndex(){const h=this.painter.canvasCopy(),r=this.painter.getCanvasCopiesAndTimestamps();r.timeStamps.push(performance.now());const l=this.painter.context.gl,p=l.createFramebuffer();function _(x){l.framebufferTexture2D(l.FRAMEBUFFER,l.COLOR_ATTACHMENT0,l.TEXTURE_2D,x,0);const T=new Uint8Array(l.drawingBufferWidth*l.drawingBufferHeight*4);return l.readPixels(0,0,l.drawingBufferWidth,l.drawingBufferHeight,l.RGBA,l.UNSIGNED_BYTE,T),T}return l.bindFramebuffer(l.FRAMEBUFFER,p),this._canvasPixelComparison(_(h),r.canvasCopies.map(_),r.timeStamps)}_canvasPixelComparison(h,r,l){let p=l[1]-l[0];const _=h.length/4;for(let x=0;x<r.length;x++){const T=r[x];let C=0;for(let M=0;M<T.length;M+=4)T[M]===h[M]&&T[M+1]===h[M+1]&&T[M+2]===h[M+2]&&T[M+3]===h[M+3]&&(C+=1);p+=(l[x+2]-l[x+1])*(1-C/_)}return p}remove(){this._hash&&this._hash.remove();for(const r of this._controls)r.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),o.window!==void 0&&(o.window.removeEventListener("resize",this._onWindowResize,!1),o.window.removeEventListener("orientationchange",this._onWindowResize,!1),o.window.removeEventListener("webkitfullscreenchange",this._onWindowResize,!1),o.window.removeEventListener("online",this._onWindowOnline,!1),o.window.removeEventListener("visibilitychange",this._onVisibilityChange,!1));const h=this.painter.context.gl.getExtension("WEBGL_lose_context");h&&h.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),o.removeAuthState(this.painter.context.gl),this._removed=!0,this.fire(new o.Event("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(h){this._renderNextFrame=this._renderNextFrame||h,this.style&&!this._frame&&(this._frame=o.exported.frame(r=>{const l=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,l&&this._render(r)}))}_preloadTiles(h){const r=this.style?Object.values(this.style._sourceCaches):[];return o.asyncAll(r,(l,p)=>l._preloadTiles(h,p),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(h){this._trackResize&&this.resize({originalEvent:h})._update()}_onVisibilityChange(){o.window.document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(h){this._showTileBoundaries!==h&&(this._showTileBoundaries=h,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(h){this._showTerrainWireframe!==h&&(this._showTerrainWireframe=h,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(h){this._speedIndexTiming!==h&&(this._speedIndexTiming=h,this._update())}get showPadding(){return!!this._showPadding}set showPadding(h){this._showPadding!==h&&(this._showPadding=h,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(h){this._showCollisionBoxes!==h&&(this._showCollisionBoxes=h,h?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(h){this._showOverdrawInspector!==h&&(this._showOverdrawInspector=h,this._update())}get repaint(){return!!this._repaint}set repaint(h){this._repaint!==h&&(this._repaint=h,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(h){this._vertices=h,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(h){this._showTileAABBs!==h&&(this._showTileAABBs=h,h&&this._update())}_setCacheLimits(h,r){o.setCacheLimits(h,r)}get version(){return o.version}},NavigationControl:class{constructor(h){this.options=o.extend({},Of,h),this._container=B("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",r=>r.preventDefault()),this.options.showZoom&&(o.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",r=>{this._map&&this._map.zoomIn({},{originalEvent:r})}),B("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",r=>{this._map&&this._map.zoomOut({},{originalEvent:r})}),B("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(o.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",r=>{const l=this._map;l&&(this.options.visualizePitch?l.resetNorthPitch({},{originalEvent:r}):l.resetNorth({},{originalEvent:r}))}),this._compassIcon=B("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const h=this._map;if(!h)return;const r=h.getZoom(),l=r===h.getMaxZoom(),p=r===h.getMinZoom();this._zoomInButton.disabled=l,this._zoomOutButton.disabled=p,this._zoomInButton.setAttribute("aria-disabled",l.toString()),this._zoomOutButton.setAttribute("aria-disabled",p.toString())}_rotateCompassArrow(){const h=this._map;if(!h)return;const r=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(h.transform.pitch*(Math.PI/180)),.5)}) rotateX(${h.transform.pitch}deg) rotateZ(${h.transform.angle*(180/Math.PI)}deg)`:`rotate(${h.transform.angle*(180/Math.PI)}deg)`;h._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=r)})}onAdd(h){return this._map=h,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),h.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&h.on("pitch",this._rotateCompassArrow),h.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Bf(h,this._compass,this.options.visualizePitch)),this._container}onRemove(){const h=this._map;h&&(this._container.remove(),this.options.showZoom&&h.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&h.off("pitch",this._rotateCompassArrow),h.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(h,r){const l=B("button",h,this._container);return l.type="button",l.addEventListener("click",r),l}_setButtonTitle(h,r){if(!this._map)return;const l=this._map._getUIString(`NavigationControl.${r}`);h.setAttribute("aria-label",l),h.firstElementChild&&h.firstElementChild.setAttribute("title",l)}},GeolocateControl:class extends o.Evented{constructor(h){super(),this.options=o.extend({geolocation:o.window.navigator.geolocation},Ch,h),o.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=pl(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(h){return this._map=h,this._container=B("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(h){const r=(l=!!this.options.geolocation)=>{this._supportsGeolocation=l,h(l)};this._supportsGeolocation!==void 0?h(this._supportsGeolocation):o.window.navigator.permissions!==void 0?o.window.navigator.permissions.query({name:"geolocation"}).then(l=>r(l.state!=="denied")).catch(()=>r()):r()}_isOutOfMapMaxBounds(h){const r=this._map.getMaxBounds(),l=h.coords;return!!r&&(l.longitude<r.getWest()||l.longitude>r.getEast()||l.latitude<r.getSouth()||l.latitude>r.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(h){if(this._map){if(this._isOutOfMapMaxBounds(h))return this._setErrorState(),this.fire(new o.Event("outofmaxbounds",h)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=h,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(h),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(h),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new o.Event("geolocate",h)),this._finish()}}_updateCamera(h){const r=new o.LngLat(h.coords.longitude,h.coords.latitude),l=h.coords.accuracy,p=this._map.getBearing(),_=o.extend({bearing:p},this.options.fitBoundsOptions);this._map.fitBounds(r.toBounds(l),_,{geolocateSource:!0})}_updateMarker(h){if(h){const r=new o.LngLat(h.coords.longitude,h.coords.latitude);this._accuracyCircleMarker.setLngLat(r).addTo(this._map),this._userLocationDotMarker.setLngLat(r).addTo(this._map),this._accuracy=h.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const h=this._map.transform,r=o.mercatorZfromAltitude(1,h._center.lat)*h.worldSize,l=Math.ceil(2*this._accuracy*r);this._circleElement.style.width=`${l}px`,this._circleElement.style.height=`${l}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._dotElement.classList.add("mapboxgl-user-location-show-heading")):(this._dotElement.classList.remove("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(h){if(this._map){if(this.options.trackUserLocation)if(h.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const r=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",r),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",r),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(h.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new o.Event("error",h)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(h){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",r=>r.preventDefault()),this._geolocateButton=B("button","mapboxgl-ctrl-geolocate",this._container),B("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",h===!1){o.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const r=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",r),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",r)}else{const r=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",r),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",r)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=B("div","mapboxgl-user-location"),this._dotElement.appendChild(B("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(B("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new vl({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=B("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new vl({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",r=>{r.geolocateSource||this._watchState!=="ACTIVE_LOCK"||r.originalEvent&&r.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new o.Event("trackuserlocationend")))})}}_onDeviceOrientation(h){this._userLocationDotMarker&&(h.webkitCompassHeading?this._heading=h.webkitCompassHeading:h.absolute===!0&&(this._heading=-1*h.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return o.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new o.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new o.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new o.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let h;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(h={maximumAge:6e5,timeout:0},this._noTimeout=!0):(h=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,h),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const h=()=>{o.window.addEventListener("ondeviceorientationabsolute"in o.window?"deviceorientationabsolute":"deviceorientation",this._onDeviceOrientation)};o.window.DeviceMotionEvent!==void 0&&typeof o.window.DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(r=>{r==="granted"&&h()}).catch(console.error):h()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),o.window.removeEventListener("deviceorientation",this._onDeviceOrientation),o.window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:bh,ScaleControl:class{constructor(h){this.options=o.extend({},Ff,h),function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"narrow",unit:"meter"}),!0}catch{return!1}}()||(this._setScale=Nf.bind(this)),o.bindAll(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const h=this.options.maxWidth||100,r=this._map,l=r._containerHeight/2,p=r._containerWidth/2-h/2,_=r.unproject([p,l]),x=r.unproject([p+h,l]),T=_.distanceTo(x);if(this.options.unit==="imperial"){const C=3.2808*T;C>5280?this._setScale(h,C/5280,"mile"):this._setScale(h,C,"foot")}else this.options.unit==="nautical"?this._setScale(h,T/1852,"nautical-mile"):T>=1e3?this._setScale(h,T/1e3,"kilometer"):this._setScale(h,T,"meter")}_setScale(h,r,l){const p=Ah(r),_=p/r;this._map._requestDomTask(()=>{this._container.style.width=h*_+"px",this._container.innerHTML=l!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"narrow",unit:l}).format(p):`${p}&nbsp;nm`})}onAdd(h){return this._map=h,this._language=h.getLanguage(),this._container=B("div","mapboxgl-ctrl mapboxgl-ctrl-scale",h.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(h){this._language=h,this._update()}setUnit(h){this.options.unit=h,this._update()}},FullscreenControl:class{constructor(h){this._fullscreen=!1,h&&h.container&&(h.container instanceof o.window.HTMLElement?this._container=h.container:o.warnOnce("Full screen control 'container' must be a DOM element.")),o.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in o.window.document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in o.window.document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(h){return this._map=h,this._container||(this._container=this._map.getContainer()),this._controlContainer=B("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",o.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,o.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!o.window.document.fullscreenEnabled&&!o.window.document.webkitFullscreenEnabled)}_setupUI(){const h=this._fullscreenButton=B("button","mapboxgl-ctrl-fullscreen",this._controlContainer);B("span","mapboxgl-ctrl-icon",h).setAttribute("aria-hidden","true"),h.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),o.window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const h=this._getTitle();this._fullscreenButton.setAttribute("aria-label",h),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",h)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(o.window.document.fullscreenElement||o.window.document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?o.window.document.exitFullscreen?o.window.document.exitFullscreen():o.window.document.webkitCancelFullScreen&&o.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends o.Evented{constructor(h){super(),this.options=o.extend(Object.create(Oc),h),o.bindAll(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(h&&h.className?h.className.trim().split(/\s+/):[])}addTo(h){return this._map&&this.remove(),this._map=h,this.options.closeOnClick&&h.on("preclick",this._onClose),this.options.closeOnMove&&h.on("move",this._onClose),h.on("remove",this.remove),this._update(),h._addPopup(this),this._focusFirstElement(),this._trackPointer?(h.on("mousemove",this._onMouseEvent),h.on("mouseup",this._onMouseEvent),h._canvasContainer.classList.add("mapboxgl-track-pointer")):h.on("move",this._update),this.fire(new o.Event("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const h=this._map;return h&&(h.off("move",this._update),h.off("move",this._onClose),h.off("preclick",this._onClose),h.off("click",this._onClose),h.off("remove",this.remove),h.off("mousemove",this._onMouseEvent),h.off("mouseup",this._onMouseEvent),h.off("drag",this._onMouseEvent),h._canvasContainer&&h._canvasContainer.classList.remove("mapboxgl-track-pointer"),h._removePopup(this),this._map=void 0),this.fire(new o.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(h){this._lngLat=o.LngLat.convert(h),this._pos=null,this._trackPointer=!1,this._update();const r=this._map;return r&&(r.on("move",this._update),r.off("mousemove",this._onMouseEvent),r._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const h=this._map;return h&&(h.off("move",this._update),h.on("mousemove",this._onMouseEvent),h.on("drag",this._onMouseEvent),h._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(h){return this.setDOMContent(o.window.document.createTextNode(h))}setHTML(h){const r=o.window.document.createDocumentFragment(),l=o.window.document.createElement("body");let p;for(l.innerHTML=h;p=l.firstChild,p;)r.appendChild(p);return this.setDOMContent(r)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(h){return this.options.maxWidth=h,this._update(),this}setDOMContent(h){let r=this._content;if(r)for(;r.hasChildNodes();)r.firstChild&&r.removeChild(r.firstChild);else r=this._content=B("div","mapboxgl-popup-content",this._container||void 0);if(r.appendChild(h),this.options.closeButton){const l=this._closeButton=B("button","mapboxgl-popup-close-button",r);l.type="button",l.setAttribute("aria-label","Close popup"),l.setAttribute("aria-hidden","true"),l.innerHTML="&#215;",l.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(h){return this._classList.add(h),this._updateClassList(),this}removeClassName(h){return this._classList.delete(h),this._updateClassList(),this}setOffset(h){return this.options.offset=h,this._update(),this}toggleClassName(h){let r;return this._classList.delete(h)?r=!1:(this._classList.add(h),r=!0),this._updateClassList(),r}_onMouseEvent(h){this._update(h.point)}_getAnchor(h){if(this.options.anchor)return this.options.anchor;const r=this._map,l=this._container,p=this._pos;if(!r||!l||!p)return"bottom";const _=l.offsetWidth,x=l.offsetHeight,T=p.x<_/2,C=p.x>r.transform.width-_/2;if(p.y+h<x)return T?"top-left":C?"top-right":"top";if(p.y>r.transform.height-x){if(T)return"bottom-left";if(C)return"bottom-right"}return T?"left":C?"right":"bottom"}_updateClassList(){const h=this._container;if(!h)return;const r=[...this._classList];r.push("mapboxgl-popup"),this._anchor&&r.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&r.push("mapboxgl-popup-track-pointer"),h.className=r.join(" ")}_update(h){const r=this._map,l=this._content;if(!r||!this._lngLat&&!this._trackPointer||!l)return;let p=this._container;if(p||(p=this._container=B("div","mapboxgl-popup",r.getContainer()),this._tip=B("div","mapboxgl-popup-tip",p),p.appendChild(l)),this.options.maxWidth&&p.style.maxWidth!==this.options.maxWidth&&(p.style.maxWidth=this.options.maxWidth),r.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Th(this._lngLat,this._pos,r.transform)),!this._trackPointer||h){const _=this._pos=this._trackPointer&&h?h:r.project(this._lngLat),x=Sh(this.options.offset),T=this._anchor=this._getAnchor(x.y),C=Sh(this.options.offset,T),M=_.add(C).round();r._requestDomTask(()=>{this._container&&T&&(this._container.style.transform=`${ga[T]} translate(${M.x}px,${M.y}px)`)})}if(!this._marker&&r._showingGlobe()){const _=o.isLngLatBehindGlobe(r.transform,this._lngLat)?0:1;this._setOpacity(_)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const h=this._container.querySelector(zf);h&&h.focus()}_onClose(){this.remove()}_setOpacity(h){this._container&&(this._container.style.opacity=`${h}`),this._content&&(this._content.style.pointerEvents=h?"auto":"none")}},Marker:vl,Style:rr,LngLat:o.LngLat,LngLatBounds:o.LngLatBounds,Point:o.pointGeometry,MercatorCoordinate:o.MercatorCoordinate,FreeCameraOptions:dh,Evented:o.Evented,config:o.config,prewarm:function(){fn().acquire(an)},clearPrewarmedResources:function(){const h=rn;h&&(h.isPreloaded()&&h.numActive()===1?(h.release(an),rn=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return o.config.ACCESS_TOKEN},set accessToken(h){o.config.ACCESS_TOKEN=h},get baseApiUrl(){return o.config.API_URL},set baseApiUrl(h){o.config.API_URL=h},get workerCount(){return on.workerCount},set workerCount(h){on.workerCount=h},get maxParallelImageRequests(){return o.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(h){o.config.MAX_PARALLEL_IMAGE_REQUESTS=h},clearStorage(h){o.clearTileCache(h)},workerUrl:"",workerClass:null,setNow:o.exported.setNow,restoreNow:o.exported.restoreNow};return xl});var w=m;return w})})(bS);const Qs=bS.exports;var Uu=zR,PR=Object.prototype.hasOwnProperty;function zR(){for(var t={},s=0;s<arguments.length;s++){var u=arguments[s];for(var f in u)PR.call(u,f)&&(t[f]=u[f])}return t}var ES={exports:{}};(function(t,s){(function(){var u={};t.exports=u,u.simpleFilter=function(f,m){return m.filter(function(v){return u.test(f,v)})},u.test=function(f,m){return u.match(f,m)!==null},u.match=function(f,m,v){v=v||{};var w=0,o=[],S=m.length,k=0,I=0,D=v.pre||"",B=v.post||"",V=v.caseSensitive&&m||m.toLowerCase(),$;f=v.caseSensitive&&f||f.toLowerCase();for(var ne=0;ne<S;ne++)$=m[ne],V[ne]===f[w]?($=D+$+B,w+=1,I+=1+I):I=0,k+=I,o[o.length]=$;return w===f.length?(k=V===f?1/0:k,{rendered:o.join(""),score:k}):null},u.filter=function(f,m,v){return!m||m.length===0?[]:typeof f!="string"?m:(v=v||{},m.reduce(function(w,o,S,k){var I=o;v.extract&&(I=v.extract(o));var D=u.match(f,I,v);return D!=null&&(w[w.length]={string:D.rendered,score:D.score,index:S,original:o}),w},[]).sort(function(w,o){var S=o.score-w.score;return S||w.index-o.index}))}})()})(ES);var ro=function(t){return this.component=t,this.items=[],this.active=0,this.wrapper=document.createElement("div"),this.wrapper.className="suggestions-wrapper",this.element=document.createElement("ul"),this.element.className="suggestions",this.wrapper.appendChild(this.element),this.selectingListItem=!1,t.el.parentNode.insertBefore(this.wrapper,t.el.nextSibling),this};ro.prototype.show=function(){this.element.style.display="block"};ro.prototype.hide=function(){this.element.style.display="none"};ro.prototype.add=function(t){this.items.push(t)};ro.prototype.clear=function(){this.items=[],this.active=0};ro.prototype.isEmpty=function(){return!this.items.length};ro.prototype.isVisible=function(){return this.element.style.display==="block"};ro.prototype.draw=function(){if(this.element.innerHTML="",this.items.length===0){this.hide();return}for(var t=0;t<this.items.length;t++)this.drawItem(this.items[t],this.active===t);this.show()};ro.prototype.drawItem=function(t,s){var u=document.createElement("li"),f=document.createElement("a");s&&(u.className+=" active"),f.innerHTML=t.string,u.appendChild(f),this.element.appendChild(u),u.addEventListener("mousedown",function(){this.selectingListItem=!0}.bind(this)),u.addEventListener("mouseup",function(){this.handleMouseUp.call(this,t)}.bind(this))};ro.prototype.handleMouseUp=function(t){this.selectingListItem=!1,this.component.value(t.original),this.clear(),this.draw()};ro.prototype.move=function(t){this.active=t,this.draw()};ro.prototype.previous=function(){this.move(this.active===0?this.items.length-1:this.active-1)};ro.prototype.next=function(){this.move(this.active===this.items.length-1?0:this.active+1)};ro.prototype.drawError=function(t){var s=document.createElement("li");s.innerHTML=t,this.element.appendChild(s),this.show()};var LR=ro,RR=Uu,DR=ES.exports,OR=LR,Ur=function(t,s,u){return u=u||{},this.options=RR({minLength:2,limit:5,filter:!0,hideOnBlur:!0},u),this.el=t,this.data=s||[],this.list=new OR(this),this.query="",this.selected=null,this.list.draw(),this.el.addEventListener("keyup",function(f){this.handleKeyUp(f.keyCode)}.bind(this),!1),this.el.addEventListener("keydown",function(f){this.handleKeyDown(f)}.bind(this)),this.el.addEventListener("focus",function(){this.handleFocus()}.bind(this)),this.el.addEventListener("blur",function(){this.handleBlur()}.bind(this)),this.el.addEventListener("paste",function(f){this.handlePaste(f)}.bind(this)),this.render=this.options.render?this.options.render.bind(this):this.render.bind(this),this.getItemValue=this.options.getItemValue?this.options.getItemValue.bind(this):this.getItemValue.bind(this),this};Ur.prototype.handleKeyUp=function(t){t===40||t===38||t===27||t===13||t===9||this.handleInputChange(this.el.value)};Ur.prototype.handleKeyDown=function(t){switch(t.keyCode){case 13:case 9:this.list.isEmpty()||(this.list.isVisible()&&t.preventDefault(),this.value(this.list.items[this.list.active].original),this.list.hide());break;case 27:this.list.isEmpty()||this.list.hide();break;case 38:this.list.previous();break;case 40:this.list.next();break}};Ur.prototype.handleBlur=function(){!this.list.selectingListItem&&this.options.hideOnBlur&&this.list.hide()};Ur.prototype.handlePaste=function(t){if(t.clipboardData)this.handleInputChange(t.clipboardData.getData("Text"));else{var s=this;setTimeout(function(){s.handleInputChange(t.target.value)},100)}};Ur.prototype.handleInputChange=function(t){if(this.query=this.normalize(t),this.list.clear(),this.query.length<this.options.minLength){this.list.draw();return}this.getCandidates(function(s){for(var u=0;u<s.length&&(this.list.add(s[u]),u!==this.options.limit-1);u++);this.list.draw()}.bind(this))};Ur.prototype.handleFocus=function(){this.list.isEmpty()||this.list.show(),this.list.selectingListItem=!1};Ur.prototype.update=function(t){this.data=t,this.handleKeyUp()};Ur.prototype.clear=function(){this.data=[],this.list.clear()};Ur.prototype.normalize=function(t){return t=t.toLowerCase(),t};Ur.prototype.match=function(t,s){return t.indexOf(s)>-1};Ur.prototype.value=function(t){if(this.selected=t,this.el.value=this.getItemValue(t),document.createEvent){var s=document.createEvent("HTMLEvents");s.initEvent("change",!0,!1),this.el.dispatchEvent(s)}else this.el.fireEvent("onchange")};Ur.prototype.getCandidates=function(t){var s={pre:"<strong>",post:"</strong>",extract:function(f){return this.getItemValue(f)}.bind(this)},u;this.options.filter?(u=DR.filter(this.query,this.data,s),u=u.map(function(f){return{original:f.original,string:this.render(f.original,f.string)}}.bind(this))):u=this.data.map(function(f){var m=this.render(f);return{original:f,string:m}}.bind(this)),t(u)};Ur.prototype.getItemValue=function(t){return t};Ur.prototype.render=function(t,s){if(s)return s;for(var u=t.original?this.getItemValue(t.original):this.getItemValue(t),f=this.normalize(u),m=f.lastIndexOf(this.query);m>-1;){var v=m+this.query.length;u=u.slice(0,m)+"<strong>"+u.slice(m,v)+"</strong>"+u.slice(v),m=f.slice(0,m).lastIndexOf(this.query)}return u};Ur.prototype.renderError=function(t){this.list.drawError(t)};var BR=Ur,TS=BR,FR=TS;typeof window<"u"&&(window.Suggestions=TS);var NR="Expected a function",lw=0/0,VR="[object Symbol]",UR=/^\s+|\s+$/g,qR=/^[-+]0x[0-9a-f]+$/i,jR=/^0b[01]+$/i,$R=/^0o[0-7]+$/i,GR=parseInt,ZR=typeof Ko=="object"&&Ko&&Ko.Object===Object&&Ko,HR=typeof self=="object"&&self&&self.Object===Object&&self,WR=ZR||HR||Function("return this")(),XR=Object.prototype,KR=XR.toString,YR=Math.max,QR=Math.min,Q_=function(){return WR.Date.now()};function JR(t,s,u){var f,m,v,w,o,S,k=0,I=!1,D=!1,B=!0;if(typeof t!="function")throw new TypeError(NR);s=cw(s)||0,Fy(u)&&(I=!!u.leading,D="maxWait"in u,v=D?YR(cw(u.maxWait)||0,s):v,B="trailing"in u?!!u.trailing:B);function V(fe){var Ee=f,Me=m;return f=m=void 0,k=fe,w=t.apply(Me,Ee),w}function $(fe){return k=fe,o=setTimeout(ye,s),I?V(fe):w}function ne(fe){var Ee=fe-S,Me=fe-k,Ie=s-Ee;return D?QR(Ie,v-Me):Ie}function oe(fe){var Ee=fe-S,Me=fe-k;return S===void 0||Ee>=s||Ee<0||D&&Me>=v}function ye(){var fe=Q_();if(oe(fe))return te(fe);o=setTimeout(ye,ne(fe))}function te(fe){return o=void 0,B&&f?V(fe):(f=m=void 0,w)}function Se(){o!==void 0&&clearTimeout(o),k=0,f=S=m=o=void 0}function Ae(){return o===void 0?w:te(Q_())}function ce(){var fe=Q_(),Ee=oe(fe);if(f=arguments,m=this,S=fe,Ee){if(o===void 0)return $(S);if(D)return o=setTimeout(ye,s),V(S)}return o===void 0&&(o=setTimeout(ye,s)),w}return ce.cancel=Se,ce.flush=Ae,ce}function Fy(t){var s=typeof t;return!!t&&(s=="object"||s=="function")}function eD(t){return!!t&&typeof t=="object"}function tD(t){return typeof t=="symbol"||eD(t)&&KR.call(t)==VR}function cw(t){if(typeof t=="number")return t;if(tD(t))return lw;if(Fy(t)){var s=typeof t.valueOf=="function"?t.valueOf():t;t=Fy(s)?s+"":s}if(typeof t!="string")return t===0?t:+t;t=t.replace(UR,"");var u=jR.test(t);return u||$R.test(t)?GR(t.slice(2),u?2:8):qR.test(t)?lw:+t}var nD=JR,Ov={exports:{}},xu=typeof Reflect=="object"?Reflect:null,uw=xu&&typeof xu.apply=="function"?xu.apply:function(s,u,f){return Function.prototype.apply.call(s,u,f)},Jp;xu&&typeof xu.ownKeys=="function"?Jp=xu.ownKeys:Object.getOwnPropertySymbols?Jp=function(s){return Object.getOwnPropertyNames(s).concat(Object.getOwnPropertySymbols(s))}:Jp=function(s){return Object.getOwnPropertyNames(s)};function iD(t){console&&console.warn&&console.warn(t)}var SS=Number.isNaN||function(s){return s!==s};function wi(){wi.init.call(this)}Ov.exports=wi;Ov.exports.once=aD;wi.EventEmitter=wi;wi.prototype._events=void 0;wi.prototype._eventsCount=0;wi.prototype._maxListeners=void 0;var hw=10;function Jm(t){if(typeof t!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t)}Object.defineProperty(wi,"defaultMaxListeners",{enumerable:!0,get:function(){return hw},set:function(t){if(typeof t!="number"||t<0||SS(t))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+t+".");hw=t}});wi.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};wi.prototype.setMaxListeners=function(s){if(typeof s!="number"||s<0||SS(s))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+s+".");return this._maxListeners=s,this};function CS(t){return t._maxListeners===void 0?wi.defaultMaxListeners:t._maxListeners}wi.prototype.getMaxListeners=function(){return CS(this)};wi.prototype.emit=function(s){for(var u=[],f=1;f<arguments.length;f++)u.push(arguments[f]);var m=s==="error",v=this._events;if(v!==void 0)m=m&&v.error===void 0;else if(!m)return!1;if(m){var w;if(u.length>0&&(w=u[0]),w instanceof Error)throw w;var o=new Error("Unhandled error."+(w?" ("+w.message+")":""));throw o.context=w,o}var S=v[s];if(S===void 0)return!1;if(typeof S=="function")uw(S,this,u);else for(var k=S.length,I=PS(S,k),f=0;f<k;++f)uw(I[f],this,u);return!0};function AS(t,s,u,f){var m,v,w;if(Jm(u),v=t._events,v===void 0?(v=t._events=Object.create(null),t._eventsCount=0):(v.newListener!==void 0&&(t.emit("newListener",s,u.listener?u.listener:u),v=t._events),w=v[s]),w===void 0)w=v[s]=u,++t._eventsCount;else if(typeof w=="function"?w=v[s]=f?[u,w]:[w,u]:f?w.unshift(u):w.push(u),m=CS(t),m>0&&w.length>m&&!w.warned){w.warned=!0;var o=new Error("Possible EventEmitter memory leak detected. "+w.length+" "+String(s)+" listeners added. Use emitter.setMaxListeners() to increase limit");o.name="MaxListenersExceededWarning",o.emitter=t,o.type=s,o.count=w.length,iD(o)}return t}wi.prototype.addListener=function(s,u){return AS(this,s,u,!1)};wi.prototype.on=wi.prototype.addListener;wi.prototype.prependListener=function(s,u){return AS(this,s,u,!0)};function rD(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function MS(t,s,u){var f={fired:!1,wrapFn:void 0,target:t,type:s,listener:u},m=rD.bind(f);return m.listener=u,f.wrapFn=m,m}wi.prototype.once=function(s,u){return Jm(u),this.on(s,MS(this,s,u)),this};wi.prototype.prependOnceListener=function(s,u){return Jm(u),this.prependListener(s,MS(this,s,u)),this};wi.prototype.removeListener=function(s,u){var f,m,v,w,o;if(Jm(u),m=this._events,m===void 0)return this;if(f=m[s],f===void 0)return this;if(f===u||f.listener===u)--this._eventsCount===0?this._events=Object.create(null):(delete m[s],m.removeListener&&this.emit("removeListener",s,f.listener||u));else if(typeof f!="function"){for(v=-1,w=f.length-1;w>=0;w--)if(f[w]===u||f[w].listener===u){o=f[w].listener,v=w;break}if(v<0)return this;v===0?f.shift():oD(f,v),f.length===1&&(m[s]=f[0]),m.removeListener!==void 0&&this.emit("removeListener",s,o||u)}return this};wi.prototype.off=wi.prototype.removeListener;wi.prototype.removeAllListeners=function(s){var u,f,m;if(f=this._events,f===void 0)return this;if(f.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):f[s]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete f[s]),this;if(arguments.length===0){var v=Object.keys(f),w;for(m=0;m<v.length;++m)w=v[m],w!=="removeListener"&&this.removeAllListeners(w);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(u=f[s],typeof u=="function")this.removeListener(s,u);else if(u!==void 0)for(m=u.length-1;m>=0;m--)this.removeListener(s,u[m]);return this};function IS(t,s,u){var f=t._events;if(f===void 0)return[];var m=f[s];return m===void 0?[]:typeof m=="function"?u?[m.listener||m]:[m]:u?sD(m):PS(m,m.length)}wi.prototype.listeners=function(s){return IS(this,s,!0)};wi.prototype.rawListeners=function(s){return IS(this,s,!1)};wi.listenerCount=function(t,s){return typeof t.listenerCount=="function"?t.listenerCount(s):kS.call(t,s)};wi.prototype.listenerCount=kS;function kS(t){var s=this._events;if(s!==void 0){var u=s[t];if(typeof u=="function")return 1;if(u!==void 0)return u.length}return 0}wi.prototype.eventNames=function(){return this._eventsCount>0?Jp(this._events):[]};function PS(t,s){for(var u=new Array(s),f=0;f<s;++f)u[f]=t[f];return u}function oD(t,s){for(;s+1<t.length;s++)t[s]=t[s+1];t.pop()}function sD(t){for(var s=new Array(t.length),u=0;u<s.length;++u)s[u]=t[u].listener||t[u];return s}function aD(t,s){return new Promise(function(u,f){function m(w){t.removeListener(s,v),f(w)}function v(){typeof t.removeListener=="function"&&t.removeListener("error",m),u([].slice.call(arguments))}zS(t,s,v,{once:!0}),s!=="error"&&lD(t,m,{once:!0})})}function lD(t,s,u){typeof t.on=="function"&&zS(t,"error",s,u)}function zS(t,s,u,f){if(typeof t.on=="function")f.once?t.once(s,u):t.on(s,u);else if(typeof t.addEventListener=="function")t.addEventListener(s,function m(v){f.once&&t.removeEventListener(s,m),u(v)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof t)}var cD={fr:{name:"France",bbox:[[-4.59235,41.380007],[9.560016,51.148506]]},us:{name:"United States",bbox:[[-171.791111,18.91619],[-66.96466,71.357764]]},ru:{name:"Russia",bbox:[[19.66064,41.151416],[190.10042,81.2504]]},ca:{name:"Canada",bbox:[[-140.99778,41.675105],[-52.648099,83.23324]]}};function uD(t){var s=t.match(/\s*(.+)\s*=\s*"?([^"]+)"?/);return s?{key:s[1],value:s[2]}:null}function hD(t){var s=t.match(/<?([^>]*)>(.*)/);if(!s)return null;var u=s[1],f=s[2].split(";"),m=null,v=f.reduce(function(w,o){var S=uD(o);return S?S.key==="rel"?(m||(m=S.value),w):(w[S.key]=S.value,w):w},{});return m?{url:u,rel:m,params:v}:null}function dD(t){return t?t.split(/,\s*</).reduce(function(s,u){var f=hD(u);if(!f)return s;var m=f.rel.split(/\s+/);return m.forEach(function(v){s[v]||(s[v]={url:f.url,params:f.params})}),s},{}):{}}var fD=dD,pD=fD;function Bv(t,s){this.request=t,this.headers=s.headers,this.rawBody=s.body,this.statusCode=s.statusCode;try{this.body=JSON.parse(s.body||"{}")}catch{this.body=s.body}this.links=pD(this.headers.link)}Bv.prototype.hasNextPage=function(){return!!this.links.next};Bv.prototype.nextPage=function(){return this.hasNextPage()?this.request._extend({path:this.links.next.url}):null};var mD=Bv,eg={API_ORIGIN:"https://api.mapbox.com",EVENT_PROGRESS_DOWNLOAD:"downloadProgress",EVENT_PROGRESS_UPLOAD:"uploadProgress",EVENT_ERROR:"error",EVENT_RESPONSE:"response",ERROR_HTTP:"HttpError",ERROR_REQUEST_ABORTED:"RequestAbortedError"},dw=eg;function gD(t){var s=t.type||dw.ERROR_HTTP,u;if(t.body)try{u=JSON.parse(t.body)}catch{u=t.body}else u=null;var f=t.message||null;f||(typeof u=="string"?f=u:u&&typeof u.message=="string"?f=u.message:s===dw.ERROR_REQUEST_ABORTED&&(f="Request aborted")),this.message=f,this.type=s,this.statusCode=t.statusCode||null,this.request=t.request,this.body=u}var _D=gD;function yD(t){var s=t.indexOf(":"),u=t.substring(0,s).trim().toLowerCase(),f=t.substring(s+1).trim();return{name:u,value:f}}function vD(t){var s={};return t&&t.trim().split(/[\r|\n]+/).forEach(function(u){var f=yD(u);s[f.name]=f.value}),s}var xD=vD,bD=mD,fw=_D,J_=eg,wD=xD,vm={};function ED(t){var s=vm[t.id];!s||(s.abort(),delete vm[t.id])}function TD(t,s){return new bD(t,{body:s.response,headers:wD(s.getAllResponseHeaders()),statusCode:s.status})}function pw(t){var s=t.total,u=t.loaded,f=100*u/s;return{total:s,transferred:u,percent:f}}function LS(t,s){return new Promise(function(u,f){s.onprogress=function(w){t.emitter.emit(J_.EVENT_PROGRESS_DOWNLOAD,pw(w))};var m=t.file;m&&(s.upload.onprogress=function(w){t.emitter.emit(J_.EVENT_PROGRESS_UPLOAD,pw(w))}),s.onerror=function(w){f(w)},s.onabort=function(){var w=new fw({request:t,type:J_.ERROR_REQUEST_ABORTED});f(w)},s.onload=function(){if(delete vm[t.id],s.status<200||s.status>=400){var w=new fw({request:t,body:s.response,statusCode:s.status});f(w);return}u(s)};var v=t.body;typeof v=="string"?s.send(v):v?s.send(JSON.stringify(v)):m?s.send(m):s.send(),vm[t.id]=s}).then(function(u){return TD(t,u)})}function RS(t,s){var u=t.url(s),f=new window.XMLHttpRequest;return f.open(t.method,u),Object.keys(t.headers).forEach(function(m){f.setRequestHeader(m,t.headers[m])}),f}function SD(t){return Promise.resolve().then(function(){var s=RS(t,t.client.accessToken);return LS(t,s)})}var CD={browserAbort:ED,sendRequestXhr:LS,browserSend:SD,createRequestXhr:RS},Ny={exports:{}};/*! http://mths.be/base64 v0.1.0 by @mathias | MIT license */(function(t,s){(function(u){var f=s,m=t&&t.exports==f&&t,v=typeof Ko=="object"&&Ko;(v.global===v||v.window===v)&&(u=v);var w=function($){this.message=$};w.prototype=new Error,w.prototype.name="InvalidCharacterError";var o=function($){throw new w($)},S="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",k=/[\t\n\f\r ]/g,I=function($){$=String($).replace(k,"");var ne=$.length;ne%4==0&&($=$.replace(/==?$/,""),ne=$.length),(ne%4==1||/[^+a-zA-Z0-9/]/.test($))&&o("Invalid character: the string to be decoded is not correctly encoded.");for(var oe=0,ye,te,Se="",Ae=-1;++Ae<ne;)te=S.indexOf($.charAt(Ae)),ye=oe%4?ye*64+te:te,oe++%4&&(Se+=String.fromCharCode(255&ye>>(-2*oe&6)));return Se},D=function($){$=String($),/[^\0-\xFF]/.test($)&&o("The string to be encoded contains characters outside of the Latin1 range.");for(var ne=$.length%3,oe="",ye=-1,te,Se,Ae,ce,fe=$.length-ne;++ye<fe;)te=$.charCodeAt(ye)<<16,Se=$.charCodeAt(++ye)<<8,Ae=$.charCodeAt(++ye),ce=te+Se+Ae,oe+=S.charAt(ce>>18&63)+S.charAt(ce>>12&63)+S.charAt(ce>>6&63)+S.charAt(ce&63);return ne==2?(te=$.charCodeAt(ye)<<8,Se=$.charCodeAt(++ye),ce=te+Se,oe+=S.charAt(ce>>10)+S.charAt(ce>>4&63)+S.charAt(ce<<2&63)+"="):ne==1&&(ce=$.charCodeAt(ye),oe+=S.charAt(ce>>2)+S.charAt(ce<<4&63)+"=="),oe},B={encode:D,decode:I,version:"0.1.0"};if(f&&!f.nodeType)if(m)m.exports=B;else for(var V in B)B.hasOwnProperty(V)&&(f[V]=B[V]);else u.base64=B})(Ko)})(Ny,Ny.exports);var AD=Ny.exports,ey={};function MD(t){if(ey[t])return ey[t];var s=t.split("."),u=s[0],f=s[1];if(!f)throw new Error("Invalid token");var m=ID(f),v={usage:u,user:m.u};return Fl(m,"a")&&(v.authorization=m.a),Fl(m,"exp")&&(v.expires=m.exp*1e3),Fl(m,"iat")&&(v.created=m.iat*1e3),Fl(m,"scopes")&&(v.scopes=m.scopes),Fl(m,"client")&&(v.client=m.client),Fl(m,"ll")&&(v.lastLogin=m.ll),Fl(m,"iu")&&(v.impersonator=m.iu),ey[t]=v,v}function ID(t){try{return JSON.parse(AD.decode(t))}catch{throw new Error("Invalid token")}}function Fl(t,s){return Object.prototype.hasOwnProperty.call(t,s)}var DS=MD,OS={exports:{}};(function(t){var s=Object.prototype.hasOwnProperty,u="~";function f(){}Object.create&&(f.prototype=Object.create(null),new f().__proto__||(u=!1));function m(S,k,I){this.fn=S,this.context=k,this.once=I||!1}function v(S,k,I,D,B){if(typeof I!="function")throw new TypeError("The listener must be a function");var V=new m(I,D||S,B),$=u?u+k:k;return S._events[$]?S._events[$].fn?S._events[$]=[S._events[$],V]:S._events[$].push(V):(S._events[$]=V,S._eventsCount++),S}function w(S,k){--S._eventsCount===0?S._events=new f:delete S._events[k]}function o(){this._events=new f,this._eventsCount=0}o.prototype.eventNames=function(){var k=[],I,D;if(this._eventsCount===0)return k;for(D in I=this._events)s.call(I,D)&&k.push(u?D.slice(1):D);return Object.getOwnPropertySymbols?k.concat(Object.getOwnPropertySymbols(I)):k},o.prototype.listeners=function(k){var I=u?u+k:k,D=this._events[I];if(!D)return[];if(D.fn)return[D.fn];for(var B=0,V=D.length,$=new Array(V);B<V;B++)$[B]=D[B].fn;return $},o.prototype.listenerCount=function(k){var I=u?u+k:k,D=this._events[I];return D?D.fn?1:D.length:0},o.prototype.emit=function(k,I,D,B,V,$){var ne=u?u+k:k;if(!this._events[ne])return!1;var oe=this._events[ne],ye=arguments.length,te,Se;if(oe.fn){switch(oe.once&&this.removeListener(k,oe.fn,void 0,!0),ye){case 1:return oe.fn.call(oe.context),!0;case 2:return oe.fn.call(oe.context,I),!0;case 3:return oe.fn.call(oe.context,I,D),!0;case 4:return oe.fn.call(oe.context,I,D,B),!0;case 5:return oe.fn.call(oe.context,I,D,B,V),!0;case 6:return oe.fn.call(oe.context,I,D,B,V,$),!0}for(Se=1,te=new Array(ye-1);Se<ye;Se++)te[Se-1]=arguments[Se];oe.fn.apply(oe.context,te)}else{var Ae=oe.length,ce;for(Se=0;Se<Ae;Se++)switch(oe[Se].once&&this.removeListener(k,oe[Se].fn,void 0,!0),ye){case 1:oe[Se].fn.call(oe[Se].context);break;case 2:oe[Se].fn.call(oe[Se].context,I);break;case 3:oe[Se].fn.call(oe[Se].context,I,D);break;case 4:oe[Se].fn.call(oe[Se].context,I,D,B);break;default:if(!te)for(ce=1,te=new Array(ye-1);ce<ye;ce++)te[ce-1]=arguments[ce];oe[Se].fn.apply(oe[Se].context,te)}}return!0},o.prototype.on=function(k,I,D){return v(this,k,I,D,!1)},o.prototype.once=function(k,I,D){return v(this,k,I,D,!0)},o.prototype.removeListener=function(k,I,D,B){var V=u?u+k:k;if(!this._events[V])return this;if(!I)return w(this,V),this;var $=this._events[V];if($.fn)$.fn===I&&(!B||$.once)&&(!D||$.context===D)&&w(this,V);else{for(var ne=0,oe=[],ye=$.length;ne<ye;ne++)($[ne].fn!==I||B&&!$[ne].once||D&&$[ne].context!==D)&&oe.push($[ne]);oe.length?this._events[V]=oe.length===1?oe[0]:oe:w(this,V)}return this},o.prototype.removeAllListeners=function(k){var I;return k?(I=u?u+k:k,this._events[I]&&w(this,I)):(this._events=new f,this._eventsCount=0),this},o.prototype.off=o.prototype.removeListener,o.prototype.addListener=o.prototype.on,o.prefixed=u,o.EventEmitter=o,t.exports=o})(OS);function kD(t){return t.map(encodeURIComponent).join(",")}function BS(t){return Array.isArray(t)?kD(t):encodeURIComponent(String(t))}function FS(t,s,u){if(u===!1||u===null)return t;var f=/\?/.test(t)?"&":"?",m=encodeURIComponent(s);return u!==void 0&&u!==""&&u!==!0&&(m+="="+BS(u)),""+t+f+m}function PD(t,s){if(!s)return t;var u=t;return Object.keys(s).forEach(function(f){var m=s[f];m!==void 0&&(Array.isArray(m)&&(m=m.filter(function(v){return v!=null}).join(",")),u=FS(u,f,m))}),u}function zD(t,s){if(!s||t.slice(0,4)==="http")return t;var u=t[0]==="/"?"":"/";return""+s.replace(/\/$/,"")+u+t}function LD(t,s){return s?t.replace(/\/:([a-zA-Z0-9]+)/g,function(u,f){var m=s[f];if(m===void 0)throw new Error("Unspecified route parameter "+f);var v=BS(m);return"/"+v}):t}var RD={appendQueryObject:PD,appendQueryParam:FS,prependOrigin:zD,interpolateRouteParams:LD},DD=DS,Fv=Uu,OD=OS.exports,Rp=RD,mw=eg,BD=1;function Ga(t,s){if(!t)throw new Error("MapiRequest requires a client");if(!s||!s.path||!s.method)throw new Error("MapiRequest requires an options object with path and method properties");var u={};s.body&&(u["content-type"]="application/json");var f=Fv(u,s.headers),m=Object.keys(f).reduce(function(v,w){return v[w.toLowerCase()]=f[w],v},{});this.id=BD++,this._options=s,this.emitter=new OD,this.client=t,this.response=null,this.error=null,this.sent=!1,this.aborted=!1,this.path=s.path,this.method=s.method,this.origin=s.origin||t.origin,this.query=s.query||{},this.params=s.params||{},this.body=s.body||null,this.file=s.file||null,this.encoding=s.encoding||"utf8",this.sendFileAs=s.sendFileAs||null,this.headers=m}Ga.prototype.url=function(s){var u=Rp.prependOrigin(this.path,this.origin);u=Rp.appendQueryObject(u,this.query);var f=this.params,m=s==null?this.client.accessToken:s;if(m){u=Rp.appendQueryParam(u,"access_token",m);var v=DD(m).user;f=Fv({ownerId:v},f)}return u=Rp.interpolateRouteParams(u,f),u};Ga.prototype.send=function(){var s=this;if(s.sent)throw new Error("This request has already been sent. Check the response and error properties. Create a new request with clone().");return s.sent=!0,s.client.sendRequest(s).then(function(u){return s.response=u,s.emitter.emit(mw.EVENT_RESPONSE,u),u},function(u){throw s.error=u,s.emitter.emit(mw.EVENT_ERROR,u),u})};Ga.prototype.abort=function(){this._nextPageRequest&&(this._nextPageRequest.abort(),delete this._nextPageRequest),!(this.response||this.error||this.aborted)&&(this.aborted=!0,this.client.abortRequest(this))};Ga.prototype.eachPage=function(s){var u=this;function f(w){function o(){delete u._nextPageRequest;var S=w.nextPage();S&&(u._nextPageRequest=S,v(S))}s(null,w,o)}function m(w){s(w,null,function(){})}function v(w){w.send().then(f,m)}v(this)};Ga.prototype.clone=function(){return this._extend()};Ga.prototype._extend=function(s){var u=Fv(this._options,s);return new Ga(this.client,u)};var FD=Ga,ND=DS,VD=FD,UD=eg;function NS(t){if(!t||!t.accessToken)throw new Error("Cannot create a client without an access token");ND(t.accessToken),this.accessToken=t.accessToken,this.origin=t.origin||UD.API_ORIGIN}NS.prototype.createRequest=function(s){return new VD(this,s)};var VS=NS,US=CD,qS=VS;function Lu(t){qS.call(this,t)}Lu.prototype=Object.create(qS.prototype);Lu.prototype.constructor=Lu;Lu.prototype.sendRequest=US.browserSend;Lu.prototype.abortRequest=US.browserAbort;function qD(t){return new Lu(t)}var jS=qD,jD=jS,$D=jD,GD=Object.prototype.toString,ZD=function(t){var s;return GD.call(t)==="[object Object]"&&(s=Object.getPrototypeOf(t),s===null||s===Object.getPrototypeOf({}))},HD=ZD,WD=Uu,$S="value",ty=`
  `,Mi={};Mi.assert=function(t,s){return s=s||{},function(u){var f=Za(t,u);if(!!f){var m=Nv(f,s);throw s.apiName&&(m=s.apiName+": "+m),new Error(m)}}};Mi.shape=function(s){var u=QD(s);return function(m){var v=Za(Mi.plainObject,m);if(v)return v;for(var w,o,S=[],k=0;k<u.length;k++)w=u[k].key,o=u[k].value,v=Za(o,m[w]),v&&S.push([w].concat(v));return S.length<2?S[0]:function(I){S=S.map(function(V){var $=V[0],ne=Nv(V,I).split(`
`).join(ty);return"- "+$+": "+ne});var D=I.path.join("."),B=D===$S?"":" of "+D;return"The following properties"+B+" have invalid values:"+ty+S.join(ty)}}};Mi.strictShape=function(s){var u=Mi.shape(s);return function(m){var v=u(m);if(v)return v;var w=Object.keys(m).reduce(function(o,S){return s[S]===void 0&&o.push(S),o},[]);if(w.length!==0)return function(){return"The following keys are invalid: "+w.join(", ")}}};Mi.arrayOf=function(s){return GS(s)};Mi.tuple=function(){var s=Array.isArray(arguments[0])?arguments[0]:Array.prototype.slice.call(arguments);return GS(s)};function GS(t){var s=Array.isArray(t),u=function(f){return s?t[f]:t};return function(m){var v=Za(Mi.plainArray,m);if(v)return v;if(s&&m.length!==t.length)return"an array with "+t.length+" items";for(var w=0;w<m.length;w++)if(v=Za(u(w),m[w]),v)return[w].concat(v)}}Mi.required=function(s){function u(f){return f==null?function(m){return ZS(m,HS(m.path)?"cannot be undefined/null.":"is required.")}:s.apply(this,arguments)}return u.__required=!0,u};Mi.oneOfType=function(){var s=Array.isArray(arguments[0])?arguments[0]:Array.prototype.slice.call(arguments);return function(f){var m=s.map(function(v){return Za(v,f)}).filter(Boolean);if(m.length===s.length)return m.every(function(v){return v.length===1&&typeof v[0]=="string"})?XD(m.map(function(v){return v[0]})):m.reduce(function(v,w){return w.length>v.length?w:v})}};Mi.equal=function(s){return function(f){if(f!==s)return JSON.stringify(s)}};Mi.oneOf=function(){var s=Array.isArray(arguments[0])?arguments[0]:Array.prototype.slice.call(arguments),u=s.map(function(f){return Mi.equal(f)});return Mi.oneOfType.apply(this,u)};Mi.range=function(s){var u=s[0],f=s[1];return function(v){var w=Za(Mi.number,v);if(w||v<u||v>f)return"number between "+u+" & "+f+" (inclusive)"}};Mi.any=function(){};Mi.boolean=function(s){if(typeof s!="boolean")return"boolean"};Mi.number=function(s){if(typeof s!="number")return"number"};Mi.plainArray=function(s){if(!Array.isArray(s))return"array"};Mi.plainObject=function(s){if(!HD(s))return"object"};Mi.string=function(s){if(typeof s!="string")return"string"};Mi.func=function(s){if(typeof s!="function")return"function"};function Za(t,s){if(!(s==null&&!t.hasOwnProperty("__required"))){var u=t(s);if(u)return Array.isArray(u)?u:[u]}}function Nv(t,s){var u=t.length,f=t[u-1],m=t.slice(0,u-1);return m.length===0&&(m=[$S]),s=WD(s,{path:m}),typeof f=="function"?f(s):ZS(s,KD(f))}function XD(t){return t.length<2?t[0]:t.length===2?t.join(" or "):t.slice(0,-1).join(", ")+", or "+t.slice(-1)}function KD(t){return"must be "+YD(t)+"."}function YD(t){return/^an? /.test(t)?t:/^[aeiou]/i.test(t)?"an "+t:/^[a-z]/i.test(t)?"a "+t:t}function ZS(t,s){var u=HS(t.path),f=t.path.join(".")+" "+s,m=u?"Item at position ":"";return m+f}function HS(t){return typeof t[t.length-1]=="number"||typeof t[0]=="number"}function QD(t){return Object.keys(t||{}).map(function(s){return{key:s,value:t[s]}})}Mi.validate=Za;Mi.processMessage=Nv;var JD=Mi,eO=Uu,bu=JD;function tO(t){if(typeof window<"u")return t instanceof Ko.Blob||t instanceof Ko.ArrayBuffer?void 0:"Blob or ArrayBuffer";if(!(typeof t=="string"||t.pipe!==void 0))return"Filename or Readable stream"}function nO(t,s){return bu.assert(bu.strictShape(t),s)}function iO(t){var s="date";if(typeof t=="boolean")return s;try{var u=new Date(t);if(u.getTime&&isNaN(u.getTime()))return s}catch{return s}}function rO(t){return bu.tuple(bu.number,bu.number)(t)}var oO=eO(bu,{file:tO,date:iO,coordinates:rO,assertShape:nO});function sO(t,s){var u=function(f,m){return s.indexOf(f)!==-1&&m!==void 0};return typeof s=="function"&&(u=s),Object.keys(t).filter(function(f){return u(f,t[f])}).reduce(function(f,m){return f[m]=t[m],f},{})}var aO=sO;function lO(t,s){return Object.keys(t).reduce(function(u,f){return u[f]=s(f,t[f]),u},{})}var cO=lO,uO=cO;function hO(t){return uO(t,function(s,u){return typeof u=="boolean"?JSON.stringify(u):u})}var dO=hO,fO=VS,pO=jS;function mO(t){return function(s){var u;fO.prototype.isPrototypeOf(s)?u=s:u=pO(s);var f=Object.create(t);return f.client=u,f}}var gO=mO,WS=Uu,Qn=oO,xm=aO,XS=dO,_O=gO,Vv={},KS=["country","region","postcode","district","place","locality","neighborhood","address","poi","poi.landmark"];Vv.forwardGeocode=function(t){Qn.assertShape({query:Qn.required(Qn.string),mode:Qn.oneOf("mapbox.places","mapbox.places-permanent"),countries:Qn.arrayOf(Qn.string),proximity:Qn.oneOf(Qn.coordinates,"ip"),types:Qn.arrayOf(Qn.oneOf(KS)),autocomplete:Qn.boolean,bbox:Qn.arrayOf(Qn.number),limit:Qn.number,language:Qn.arrayOf(Qn.string),routing:Qn.boolean,fuzzyMatch:Qn.boolean,worldview:Qn.string})(t),t.mode=t.mode||"mapbox.places";var s=XS(WS({country:t.countries},xm(t,["proximity","types","autocomplete","bbox","limit","language","routing","fuzzyMatch","worldview"])));return this.client.createRequest({method:"GET",path:"/geocoding/v5/:mode/:query.json",params:xm(t,["mode","query"]),query:s})};Vv.reverseGeocode=function(t){Qn.assertShape({query:Qn.required(Qn.coordinates),mode:Qn.oneOf("mapbox.places","mapbox.places-permanent"),countries:Qn.arrayOf(Qn.string),types:Qn.arrayOf(Qn.oneOf(KS)),bbox:Qn.arrayOf(Qn.number),limit:Qn.number,language:Qn.arrayOf(Qn.string),reverseMode:Qn.oneOf("distance","score"),routing:Qn.boolean,worldview:Qn.string})(t),t.mode=t.mode||"mapbox.places";var s=XS(WS({country:t.countries},xm(t,["country","types","bbox","limit","language","reverseMode","routing","worldview"])));return this.client.createRequest({method:"GET",path:"/geocoding/v5/:mode/:query.json",params:xm(t,["mode","query"]),query:s})};var yO=_O(Vv);let vO="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict",YS=t=>crypto.getRandomValues(new Uint8Array(t)),QS=(t,s,u)=>{let f=(2<<Math.log(t.length-1)/Math.LN2)-1,m=-~(1.6*f*s/t.length);return(v=s)=>{let w="";for(;;){let o=u(m),S=m;for(;S--;)if(w+=t[o[S]&f]||"",w.length===v)return w}}},xO=(t,s=21)=>QS(t,s,YS),bO=(t=21)=>crypto.getRandomValues(new Uint8Array(t)).reduce((s,u)=>(u&=63,u<36?s+=u.toString(36):u<62?s+=(u-26).toString(36).toUpperCase():u>62?s+="-":s+="_",s),"");const wO=Object.freeze(Object.defineProperty({__proto__:null,nanoid:bO,customAlphabet:xO,customRandom:QS,urlAlphabet:vO,random:YS},Symbol.toStringTag,{value:"Module"})),EO=ZL(wO);var TO=EO.nanoid;function JS(t){this.origin=t.origin||"https://api.mapbox.com",this.endpoint="events/v2",this.access_token=t.accessToken,this.version="0.2.0",this.sessionID=this.generateSessionID(),this.userAgent=this.getUserAgent(),this.options=t,this.send=this.send.bind(this),this.countries=t.countries?t.countries.split(","):null,this.types=t.types?t.types.split(","):null,this.bbox=t.bbox?t.bbox:null,this.language=t.language?t.language.split(","):null,this.limit=t.limit?+t.limit:null,this.locale=navigator.language||null,this.enableEventLogging=this.shouldEnableLogging(t),this.eventQueue=new Array,this.flushInterval=t.flushInterval||1e3,this.maxQueueSize=t.maxQueueSize||100,this.timer=this.flushInterval?setTimeout(this.flush.bind(this),this.flushInterval):null,this.lastSentInput="",this.lastSentIndex=0}JS.prototype={select:function(t,s){var u=this.getSelectedIndex(t,s),f=this.getEventPayload("search.select",s);if(f.resultIndex=u,f.resultPlaceName=t.place_name,f.resultId=t.id,!(u===this.lastSentIndex&&f.queryString===this.lastSentInput||u==-1)&&(this.lastSentIndex=u,this.lastSentInput=f.queryString,!!f.queryString))return this.push(f)},start:function(t){var s=this.getEventPayload("search.start",t);if(!!s.queryString)return this.push(s)},keyevent:function(t,s){if(!!t.key&&!(t.metaKey||[9,27,37,39,13,38,40].indexOf(t.keyCode)!==-1)){var u=this.getEventPayload("search.keystroke",s);if(u.lastAction=t.key,!!u.queryString)return this.push(u)}},send:function(t,s){if(!this.enableEventLogging)return s?s():void 0;var u=this.getRequestOptions(t);this.request(u,function(f){if(f)return this.handleError(f,s);if(s)return s()}.bind(this))},getRequestOptions:function(t){Array.isArray(t)||(t=[t]);var s={method:"POST",host:this.origin,path:this.endpoint+"?access_token="+this.access_token,headers:{"Content-Type":"application/json"},body:JSON.stringify(t)};return s},getEventPayload:function(t,s){var u;s.options.proximity?typeof s.options.proximity=="object"?u=[s.options.proximity.longitude,s.options.proximity.latitude]:s.options.proximity==="ip"?u=[999,999]:u=s.options.proximity:u=null;var f=s._map?s._map.getZoom():void 0,m={event:t,created:+new Date,sessionIdentifier:this.sessionID,country:this.countries,userAgent:this.userAgent,language:this.language,bbox:this.bbox,types:this.types,endpoint:"mapbox.places",autocomplete:s.options.autocomplete,fuzzyMatch:s.options.fuzzyMatch,proximity:u,limit:s.options.limit,routing:s.options.routing,worldview:s.options.worldview,mapZoom:f,keyboardLocale:this.locale};return t==="search.select"?m.queryString=s.inputString:t!="search.select"&&s._inputEl?m.queryString=s._inputEl.value:m.queryString=s.inputString,m},request:function(t,s){var u=new XMLHttpRequest;u.onreadystatechange=function(){if(this.readyState==4)return this.status==204?s(null):s(this.statusText)},u.open(t.method,t.host+"/"+t.path,!0);for(var f in t.headers){var m=t.headers[f];u.setRequestHeader(f,m)}u.send(t.body)},handleError:function(t,s){if(s)return s(t)},generateSessionID:function(){return TO()},getUserAgent:function(){return"mapbox-gl-geocoder."+this.version+"."+navigator.userAgent},getSelectedIndex:function(t,s){if(!!s._typeahead){var u=s._typeahead.data,f=t.id,m=u.map(function(w){return w.id}),v=m.indexOf(f);return v}},shouldEnableLogging:function(t){return!(t.enableEventLogging===!1||t.origin&&t.origin!=="https://api.mapbox.com"||t.localGeocoder||t.filter)},flush:function(){this.eventQueue.length>0&&(this.send(this.eventQueue),this.eventQueue=new Array),this.timer&&clearTimeout(this.timer),this.flushInterval&&(this.timer=setTimeout(this.flush.bind(this),this.flushInterval))},push:function(t,s){this.eventQueue.push(t),(this.eventQueue.length>=this.maxQueueSize||s)&&this.flush()},remove:function(){this.flush()}};var SO=JS,CO={de:"Suche",it:"Ricerca",en:"Search",nl:"Zoeken",fr:"Chercher",ca:"Cerca",he:"\u05DC\u05D7\u05E4\u05E9",ja:"\u30B5\u30FC\u30C1",lv:"Mekl\u0113t",pt:"Procurar",sr:"\u041F\u0440\u0435\u0442\u0440\u0430\u0433\u0430",zh:"\u641C\u7D22",cs:"Vyhled\xE1v\xE1n\xED",hu:"Keres\xE9s",ka:"\u10EB\u10D8\u10D4\u10D1\u10D0",nb:"S\xF8ke",sk:"Vyh\u013Ead\xE1vanie",th:"\u0E04\u0E49\u0E19\u0E2B\u0E32",fi:"Hae",is:"Leita",ko:"\uC218\uC0C9",pl:"Szukaj",sl:"Iskanje",fa:"\u062C\u0633\u062A\u062C\u0648",ru:"\u041F\u043E\u0438\u0441\u043A"},AO={placeholder:CO},e2={exports:{}};(function(t){(function(s,u,f){t.exports?t.exports=f():s[u]=f()})(Ko,"subtag",function(){var s="",u=/^([a-zA-Z]{2,3})(?:[_-]+([a-zA-Z]{3})(?=$|[_-]+))?(?:[_-]+([a-zA-Z]{4})(?=$|[_-]+))?(?:[_-]+([a-zA-Z]{2}|[0-9]{3})(?=$|[_-]+))?/;function f(S){return S.match(u)||[]}function m(S){return f(S).filter(function(k,I){return k&&I})}function v(S){return S=f(S),{language:S[1]||s,extlang:S[2]||s,script:S[3]||s,region:S[4]||s}}function w(S,k,I){Object.defineProperty(S,k,{value:I,enumerable:!0})}function o(S,k,I){function D(B){return f(B)[S]||s}w(D,"pattern",k),w(v,I,D)}return o(1,/^[a-zA-Z]{2,3}$/,"language"),o(2,/^[a-zA-Z]{3}$/,"extlang"),o(3,/^[a-zA-Z]{4}$/,"script"),o(4,/^[a-zA-Z]{2}$|^[0-9]{3}$/,"region"),w(v,"split",m),v})})(e2);function t2(){}t2.prototype={isSupport:function(){return Boolean(window.navigator.geolocation)},getCurrentPosition:function(){const t={enableHighAccuracy:!0};return new Promise(function(s,u){window.navigator.geolocation.getCurrentPosition(s,u,t)})}};var MO=t2;function IO(t,s){const u=n2(t),f=["address","street","place","country"];var m;if(typeof s=="function")return s(u);const v=f.indexOf(s);return v===-1?m=f:m=f.slice(v),m.reduce(function(w,o){return u[o]?(w!==""&&(w=w+", "),w+u[o]):w},"")}function n2(t){const s=t.address||"",u=t.text||"",f=t.place_name||"",v={address:f.split(",")[0],houseNumber:s,street:u,placeName:f};return t.context.forEach(function(w){const o=w.id.split(".")[0];v[o]=w.text}),v}const kO=/^[ ]*(-?\d{1,3}(\.\d{0,256})?)[, ]+(-?\d{1,3}(\.\d{0,256})?)[ ]*$/;var PO={transformFeatureToGeolocationText:IO,getAddressInfo:n2,REVERSE_GEOCODE_COORD_RGX:kO},zO=FR,LO=nD,Ul=Uu,RO=Ov.exports.EventEmitter,gw=cD,ny=$D,iy=yO,DO=SO,OO=AO,BO=e2.exports,FO=MO,_w=PO;const za={FORWARD:0,LOCAL:1,REVERSE:2};function NO(){var t=document.createElement("div");return t.className="mapboxgl-ctrl-geocoder--powered-by",t.innerHTML='<a href="https://www.mapbox.com/search-service" target="_blank">Powered by Mapbox</a>',t}function i2(t){this._eventEmitter=new RO,this.options=Ul({},this.options,t),this.inputString="",this.fresh=!0,this.lastSelected=null,this.geolocation=new FO}i2.prototype={options:{zoom:16,flyTo:!0,trackProximity:!0,minLength:2,reverseGeocode:!1,flipCoordinates:!1,limit:5,origin:"https://api.mapbox.com",enableEventLogging:!0,marker:!0,mapboxgl:null,collapsed:!1,clearAndBlurOnEsc:!1,clearOnBlur:!1,enableGeolocation:!1,addressAccuracy:"street",getItemValue:function(t){return t.place_name},render:function(t){var s=t.place_name.split(",");return'<div class="mapboxgl-ctrl-geocoder--suggestion"><div class="mapboxgl-ctrl-geocoder--suggestion-title">'+s[0]+'</div><div class="mapboxgl-ctrl-geocoder--suggestion-address">'+s.splice(1,s.length).join(",")+"</div></div>"}},addTo:function(t){function s(u,f){if(!document.body.contains(f))throw new Error("Element provided to #addTo() exists, but is not in the DOM");const m=u.onAdd();f.appendChild(m)}if(t._controlContainer)t.addControl(this);else if(t instanceof HTMLElement)s(this,t);else if(typeof t=="string"){const u=document.querySelectorAll(t);if(u.length===0)throw new Error("Element ",t,"not found.");if(u.length>1)throw new Error("Geocoder can only be added to a single html element");s(this,u[0])}else throw new Error("Error: addTo must be a mapbox-gl-js map, an html element, or a CSS selector query for a single html element")},onAdd:function(t){if(t&&typeof t!="string"&&(this._map=t),this.setLanguage(),this.options.localGeocoderOnly||(this.geocoderService=iy(ny({accessToken:this.options.accessToken,origin:this.options.origin}))),this.options.localGeocoderOnly&&!this.options.localGeocoder)throw new Error("A localGeocoder function must be specified to use localGeocoderOnly mode");this.eventManager=new DO(this.options),this._onChange=this._onChange.bind(this),this._onKeyDown=this._onKeyDown.bind(this),this._onPaste=this._onPaste.bind(this),this._onBlur=this._onBlur.bind(this),this._showButton=this._showButton.bind(this),this._hideButton=this._hideButton.bind(this),this._onQueryResult=this._onQueryResult.bind(this),this.clear=this.clear.bind(this),this._updateProximity=this._updateProximity.bind(this),this._collapse=this._collapse.bind(this),this._unCollapse=this._unCollapse.bind(this),this._clear=this._clear.bind(this),this._clearOnBlur=this._clearOnBlur.bind(this),this._geolocateUser=this._geolocateUser.bind(this);var s=this.container=document.createElement("div");s.className="mapboxgl-ctrl-geocoder mapboxgl-ctrl";var u=this.createIcon("search",'<path d="M7.4 2.5c-2.7 0-4.9 2.2-4.9 4.9s2.2 4.9 4.9 4.9c1 0 1.8-.2 2.5-.8l3.7 3.7c.2.2.4.3.8.3.7 0 1.1-.4 1.1-1.1 0-.3-.1-.5-.3-.8L11.4 10c.4-.8.8-1.6.8-2.5.1-2.8-2.1-5-4.8-5zm0 1.6c1.8 0 3.2 1.4 3.2 3.2s-1.4 3.2-3.2 3.2-3.3-1.3-3.3-3.1 1.4-3.3 3.3-3.3z"/>');this._inputEl=document.createElement("input"),this._inputEl.type="text",this._inputEl.className="mapboxgl-ctrl-geocoder--input",this.setPlaceholder(),this.options.collapsed&&(this._collapse(),this.container.addEventListener("mouseenter",this._unCollapse),this.container.addEventListener("mouseleave",this._collapse),this._inputEl.addEventListener("focus",this._unCollapse)),(this.options.collapsed||this.options.clearOnBlur)&&this._inputEl.addEventListener("blur",this._onBlur),this._inputEl.addEventListener("keydown",LO(this._onKeyDown,200)),this._inputEl.addEventListener("paste",this._onPaste),this._inputEl.addEventListener("change",this._onChange),this.container.addEventListener("mouseenter",this._showButton),this.container.addEventListener("mouseleave",this._hideButton),this._inputEl.addEventListener("keyup",function(k){this.eventManager.keyevent(k,this)}.bind(this));var f=document.createElement("div");f.classList.add("mapboxgl-ctrl-geocoder--pin-right"),this._clearEl=document.createElement("button"),this._clearEl.setAttribute("aria-label","Clear"),this._clearEl.addEventListener("click",this.clear),this._clearEl.className="mapboxgl-ctrl-geocoder--button";var m=this.createIcon("close",'<path d="M3.8 2.5c-.6 0-1.3.7-1.3 1.3 0 .3.2.7.5.8L7.2 9 3 13.2c-.3.3-.5.7-.5 1 0 .6.7 1.3 1.3 1.3.3 0 .7-.2 1-.5L9 10.8l4.2 4.2c.2.3.7.3 1 .3.6 0 1.3-.7 1.3-1.3 0-.3-.2-.7-.3-1l-4.4-4L15 4.6c.3-.2.5-.5.5-.8 0-.7-.7-1.3-1.3-1.3-.3 0-.7.2-1 .3L9 7.1 4.8 2.8c-.3-.1-.7-.3-1-.3z"/>');if(this._clearEl.appendChild(m),this._loadingEl=this.createIcon("loading",'<path fill="#333" d="M4.4 4.4l.8.8c2.1-2.1 5.5-2.1 7.6 0l.8-.8c-2.5-2.5-6.7-2.5-9.2 0z"/><path opacity=".1" d="M12.8 12.9c-2.1 2.1-5.5 2.1-7.6 0-2.1-2.1-2.1-5.5 0-7.7l-.8-.8c-2.5 2.5-2.5 6.7 0 9.2s6.6 2.5 9.2 0 2.5-6.6 0-9.2l-.8.8c2.2 2.1 2.2 5.6 0 7.7z"/>'),f.appendChild(this._clearEl),f.appendChild(this._loadingEl),s.appendChild(u),s.appendChild(this._inputEl),s.appendChild(f),this.options.enableGeolocation&&this.geolocation.isSupport()){this._geolocateEl=document.createElement("button"),this._geolocateEl.setAttribute("aria-label","Geolocate"),this._geolocateEl.addEventListener("click",this._geolocateUser),this._geolocateEl.className="mapboxgl-ctrl-geocoder--button";var v=this.createIcon("geolocate",'<path d="M12.999 3.677L2.042 8.269c-.962.403-.747 1.823.29 1.912l5.032.431.431 5.033c.089 1.037 1.509 1.252 1.912.29l4.592-10.957c.345-.822-.477-1.644-1.299-1.299z" fill="#4264fb"/>');this._geolocateEl.appendChild(v),f.appendChild(this._geolocateEl),this._showGeolocateButton()}var w=this._typeahead=new zO(this._inputEl,[],{filter:!1,minLength:this.options.minLength,limit:this.options.limit});this.setRenderFunction(this.options.render),w.getItemValue=this.options.getItemValue;var o=w.list.draw,S=this._footerNode=NO();return w.list.draw=function(){o.call(this),S.addEventListener("mousedown",function(){this.selectingListItem=!0}.bind(this)),S.addEventListener("mouseup",function(){this.selectingListItem=!1}.bind(this)),this.element.appendChild(S)},this.mapMarker=null,this._handleMarker=this._handleMarker.bind(this),this._map&&(this.options.trackProximity&&(this._updateProximity(),this._map.on("moveend",this._updateProximity)),this._mapboxgl=this.options.mapboxgl,!this._mapboxgl&&this.options.marker&&(console.error("No mapboxgl detected in options. Map markers are disabled. Please set options.mapboxgl."),this.options.marker=!1)),s},_geolocateUser:function(){this._hideGeolocateButton(),this._showLoadingIcon(),this.geolocation.getCurrentPosition().then(function(t){this._hideLoadingIcon();const s={geometry:{type:"Point",coordinates:[t.coords.longitude,t.coords.latitude]}};this._handleMarker(s),this._fly(s),this._typeahead.clear(),this._typeahead.selected=!0,this.lastSelected=JSON.stringify(s),this._showClearButton(),this.fresh=!1;const u={limit:1,language:[this.options.language],query:s.geometry.coordinates,types:["address"]};if(this.options.localGeocoderOnly){const f=s.geometry.coordinates[0]+","+s.geometry.coordinates[1];this._setInputValue(f),this._eventEmitter.emit("result",{result:s})}else this.geocoderService.reverseGeocode(u).send().then(function(f){const m=f.body.features[0];if(m){const v=_w.transformFeatureToGeolocationText(m,this.options.addressAccuracy);this._setInputValue(v),m.user_coordinates=s.geometry.coordinates,this._eventEmitter.emit("result",{result:m})}else this._eventEmitter.emit("result",{result:{user_coordinates:s.geometry.coordinates}})}.bind(this))}.bind(this)).catch(function(t){t.code===1?this._renderUserDeniedGeolocationError():this._renderLocationError(),this._hideLoadingIcon(),this._showGeolocateButton(),this._hideAttribution()}.bind(this))},createIcon:function(t,s){var u=document.createElementNS("http://www.w3.org/2000/svg","svg");return u.setAttribute("class","mapboxgl-ctrl-geocoder--icon mapboxgl-ctrl-geocoder--icon-"+t),u.setAttribute("viewBox","0 0 18 18"),u.setAttribute("xml:space","preserve"),u.setAttribute("width",18),u.setAttribute("height",18),u.innerHTML=s,u},onRemove:function(){return this.container.parentNode.removeChild(this.container),this.options.trackProximity&&this._map&&this._map.off("moveend",this._updateProximity),this._removeMarker(),this._map=null,this},_setInputValue:function(t){this._inputEl.value=t,setTimeout(function(){this._inputEl.focus(),this._inputEl.scrollLeft=0,this._inputEl.setSelectionRange(0,0)}.bind(this),1)},_onPaste:function(t){var s=(t.clipboardData||window.clipboardData).getData("text");s.length>=this.options.minLength&&this._geocode(s)},_onKeyDown:function(t){var s=27,u=9;if(t.keyCode===s&&this.options.clearAndBlurOnEsc)return this._clear(t),this._inputEl.blur();var f=t.target&&t.target.shadowRoot?t.target.shadowRoot.activeElement:t.target,m=f?f.value:"";if(!m)return this.fresh=!0,t.keyCode!==u&&this.clear(t),this._showGeolocateButton(),this._hideClearButton();this._hideGeolocateButton(),!(t.metaKey||[u,s,37,39,13,38,40].indexOf(t.keyCode)!==-1)&&f.value.length>=this.options.minLength&&this._geocode(f.value)},_showButton:function(){this._typeahead.selected&&this._showClearButton()},_hideButton:function(){this._typeahead.selected&&this._hideClearButton()},_showClearButton:function(){this._clearEl.style.display="block"},_hideClearButton:function(){this._clearEl.style.display="none"},_showGeolocateButton:function(){this._geolocateEl&&this.geolocation.isSupport()&&(this._geolocateEl.style.display="block")},_hideGeolocateButton:function(){this._geolocateEl&&(this._geolocateEl.style.display="none")},_showLoadingIcon:function(){this._loadingEl.style.display="block"},_hideLoadingIcon:function(){this._loadingEl.style.display="none"},_showAttribution:function(){this._footerNode.style.display="block"},_hideAttribution:function(){this._footerNode.style.display="none"},_onBlur:function(t){this.options.clearOnBlur&&this._clearOnBlur(t),this.options.collapsed&&this._collapse()},_onChange:function(){var t=this._typeahead.selected;t&&JSON.stringify(t)!==this.lastSelected&&(this._hideClearButton(),this.options.flyTo&&this._fly(t),this.options.marker&&this._mapboxgl&&this._handleMarker(t),this._inputEl.focus(),this._inputEl.scrollLeft=0,this._inputEl.setSelectionRange(0,0),this.lastSelected=JSON.stringify(t),this._eventEmitter.emit("result",{result:t}),this.eventManager.select(t,this))},_fly:function(t){var s;if(t.properties&&gw[t.properties.short_code])s=Ul({},this.options.flyTo),this._map&&this._map.fitBounds(gw[t.properties.short_code].bbox,s);else if(t.bbox){var u=t.bbox;s=Ul({},this.options.flyTo),this._map&&this._map.fitBounds([[u[0],u[1]],[u[2],u[3]]],s)}else{var f={zoom:this.options.zoom};s=Ul({},f,this.options.flyTo),t.center?s.center=t.center:t.geometry&&t.geometry.type&&t.geometry.type==="Point"&&t.geometry.coordinates&&(s.center=t.geometry.coordinates),this._map&&this._map.flyTo(s)}},_requestType:function(t,s){var u;return t.localGeocoderOnly?u=za.LOCAL:t.reverseGeocode&&_w.REVERSE_GEOCODE_COORD_RGX.test(s)?u=za.REVERSE:u=za.FORWARD,u},_setupConfig:function(t,s){const u=["bbox","limit","proximity","countries","types","language","reverseMode","mode","autocomplete","fuzzyMatch","routing","worldview"],f=/[\s,]+/;var m=this,v=u.reduce(function(o,S){if(m.options[S]===void 0||m.options[S]===null)return o;["countries","types","language"].indexOf(S)>-1?o[S]=m.options[S].split(f):o[S]=m.options[S];const k=typeof m.options[S].longitude=="number"&&typeof m.options[S].latitude=="number";if(S==="proximity"&&k){const I=m.options[S].longitude,D=m.options[S].latitude;o[S]=[I,D]}return o},{});switch(t){case za.REVERSE:{var w=s.split(f).map(function(o){return parseFloat(o,10)});m.options.flipCoordinates||w.reverse(),v.types&&v.types[0],v=Ul(v,{query:w,limit:1}),["proximity","autocomplete","fuzzyMatch","bbox"].forEach(function(o){o in v&&delete v[o]})}break;case za.FORWARD:{const o=s.trim();/^(-?\d{1,3}(\.\d{0,256})?)[, ]+(-?\d{1,3}(\.\d{0,256})?)?$/.test(o)&&(s=s.replace(/,/g," ")),v=Ul(v,{query:s})}break}return v},_geocode:function(t){this.inputString=t,this._showLoadingIcon(),this._eventEmitter.emit("loading",{query:t});const s=this._requestType(this.options,t),u=this._setupConfig(s,t);var f;switch(s){case za.LOCAL:f=Promise.resolve();break;case za.FORWARD:f=this.geocoderService.forwardGeocode(u).send();break;case za.REVERSE:f=this.geocoderService.reverseGeocode(u).send();break}var m=this.options.localGeocoder?this.options.localGeocoder(t)||[]:[],v=[],w=null;return f.catch(function(o){w=o}.bind(this)).then(function(o){this._hideLoadingIcon();var S={};return o?o.statusCode=="200"&&(S=o.body,S.request=o.request,S.headers=o.headers):S={type:"FeatureCollection",features:[]},S.config=u,this.fresh&&(this.eventManager.start(this),this.fresh=!1),S.features=S.features?m.concat(S.features):m,this.options.externalGeocoder?(v=this.options.externalGeocoder(t,S.features)||Promise.resolve([]),v.then(function(k){return S.features=S.features?k.concat(S.features):k,S},function(){return S})):S}.bind(this)).then(function(o){if(w)throw w;this.options.filter&&o.features.length&&(o.features=o.features.filter(this.options.filter)),o.features.length?(this._showClearButton(),this._hideGeolocateButton(),this._showAttribution(),this._eventEmitter.emit("results",o),this._typeahead.update(o.features)):(this._hideClearButton(),this._hideAttribution(),this._typeahead.selected=null,this._renderNoResults(),this._eventEmitter.emit("results",o))}.bind(this)).catch(function(o){this._hideLoadingIcon(),this._hideAttribution(),m.length&&this.options.localGeocoder||v.length&&this.options.externalGeocoder?(this._showClearButton(),this._hideGeolocateButton(),this._typeahead.update(m)):(this._hideClearButton(),this._typeahead.selected=null,this._renderError()),this._eventEmitter.emit("results",{features:m}),this._eventEmitter.emit("error",{error:o})}.bind(this)),f},_clear:function(t){t&&t.preventDefault(),this._inputEl.value="",this._typeahead.selected=null,this._typeahead.clear(),this._onChange(),this._hideClearButton(),this._showGeolocateButton(),this._removeMarker(),this.lastSelected=null,this._eventEmitter.emit("clear"),this.fresh=!0},clear:function(t){this._clear(t),this._inputEl.focus()},_clearOnBlur:function(t){var s=this;t.relatedTarget&&s._clear(t)},_onQueryResult:function(t){var s=t.body;if(!!s.features.length){var u=s.features[0];this._typeahead.selected=u,this._inputEl.value=u.place_name,this._onChange()}},_updateProximity:function(){if(!(!this._map||!this.options.trackProximity))if(this._map.getZoom()>9){var t=this._map.getCenter().wrap();this.setProximity({longitude:t.lng,latitude:t.lat},!1)}else this.setProximity(null,!1)},_collapse:function(){!this._inputEl.value&&this._inputEl!==document.activeElement&&this.container.classList.add("mapboxgl-ctrl-geocoder--collapsed")},_unCollapse:function(){this.container.classList.remove("mapboxgl-ctrl-geocoder--collapsed")},query:function(t){return this._geocode(t).then(this._onQueryResult),this},_renderError:function(){var t="<div class='mapbox-gl-geocoder--error'>There was an error reaching the server</div>";this._renderMessage(t)},_renderLocationError:function(){var t="<div class='mapbox-gl-geocoder--error'>A location error has occurred</div>";this._renderMessage(t)},_renderNoResults:function(){var t="<div class='mapbox-gl-geocoder--error mapbox-gl-geocoder--no-results'>No results found</div>";this._renderMessage(t)},_renderUserDeniedGeolocationError:function(){var t="<div class='mapbox-gl-geocoder--error'>Geolocation permission denied</div>";this._renderMessage(t)},_renderMessage:function(t){this._typeahead.update([]),this._typeahead.selected=null,this._typeahead.clear(),this._typeahead.renderError(t)},_getPlaceholderText:function(){if(this.options.placeholder)return this.options.placeholder;if(this.options.language){var t=this.options.language.split(",")[0],s=BO.language(t),u=OO.placeholder[s];if(u)return u}return"Search"},setInput:function(t){return this._inputEl.value=t,this._typeahead.selected=null,this._typeahead.clear(),t.length>=this.options.minLength&&this._geocode(t),this},setProximity:function(t,s=!0){return this.options.proximity=t,s&&(this.options.trackProximity=!1),this},getProximity:function(){return this.options.proximity},setRenderFunction:function(t){return t&&typeof t=="function"&&(this._typeahead.render=t),this},getRenderFunction:function(){return this._typeahead.render},setLanguage:function(t){var s=navigator.language||navigator.userLanguage||navigator.browserLanguage;return this.options.language=t||this.options.language||s,this},getLanguage:function(){return this.options.language},getZoom:function(){return this.options.zoom},setZoom:function(t){return this.options.zoom=t,this},getFlyTo:function(){return this.options.flyTo},setFlyTo:function(t){return this.options.flyTo=t,this},getPlaceholder:function(){return this.options.placeholder},setPlaceholder:function(t){return this.placeholder=t||this._getPlaceholderText(),this._inputEl.placeholder=this.placeholder,this._inputEl.setAttribute("aria-label",this.placeholder),this},getBbox:function(){return this.options.bbox},setBbox:function(t){return this.options.bbox=t,this},getCountries:function(){return this.options.countries},setCountries:function(t){return this.options.countries=t,this},getTypes:function(){return this.options.types},setTypes:function(t){return this.options.types=t,this},getMinLength:function(){return this.options.minLength},setMinLength:function(t){return this.options.minLength=t,this._typeahead&&(this._typeahead.options.minLength=t),this},getLimit:function(){return this.options.limit},setLimit:function(t){return this.options.limit=t,this._typeahead&&(this._typeahead.options.limit=t),this},getFilter:function(){return this.options.filter},setFilter:function(t){return this.options.filter=t,this},setOrigin:function(t){return this.options.origin=t,this.geocoderService=iy(ny({accessToken:this.options.accessToken,origin:this.options.origin})),this},getOrigin:function(){return this.options.origin},setAccessToken:function(t){return this.options.accessToken=t,this.geocoderService=iy(ny({accessToken:this.options.accessToken,origin:this.options.origin})),this},setAutocomplete:function(t){return this.options.autocomplete=t,this},getAutocomplete:function(){return this.options.autocomplete},setFuzzyMatch:function(t){return this.options.fuzzyMatch=t,this},getFuzzyMatch:function(){return this.options.fuzzyMatch},setRouting:function(t){return this.options.routing=t,this},getRouting:function(){return this.options.routing},setWorldview:function(t){return this.options.worldview=t,this},getWorldview:function(){return this.options.worldview},_handleMarker:function(t){if(!!this._map){this._removeMarker();var s={color:"#4668F2"},u=Ul({},s,this.options.marker);return this.mapMarker=new this._mapboxgl.Marker(u),t.center?this.mapMarker.setLngLat(t.center).addTo(this._map):t.geometry&&t.geometry.type&&t.geometry.type==="Point"&&t.geometry.coordinates&&this.mapMarker.setLngLat(t.geometry.coordinates).addTo(this._map),this}},_removeMarker:function(){this.mapMarker&&(this.mapMarker.remove(),this.mapMarker=null)},on:function(t,s){return this._eventEmitter.on(t,s),this},off:function(t,s){return this._eventEmitter.removeListener(t,s),this.eventManager.remove(),this}};var VO=i2;function Uv(){return{map:Vr("mapbox-map")}}var ry=new Map,UO=/onMb([A-Z])(.+)/;function qO(t){return ry.has(t)||ry.set(t,t.replace(UO,(s,u,f)=>u.toLowerCase()+f)),ry.get(t)}function tg(t,s,u=[],f=null){const m=GI(),v=se(()=>Object.entries(m).filter(([k,I])=>k.startsWith("on")&&typeof I=="function").map(([k])=>k)),w=new Map;function o(k){!Array.isArray(k)||k.forEach(I=>{const D=w.get(I);typeof D=="function"&&D()})}function S(k){!Array.isArray(k)||k.forEach(I=>{const D=qO(I);if(!u.includes(D))return;const B=(...V)=>{t(`mb-${D}`,...V)};f?(On(s).on(D,f,B),w.set(I,()=>{On(s).off(D,f,B)})):(On(s).on(D,B),w.set(I,()=>{On(s).off(D,B)}))})}Wt(v,(k,I)=>{const D=Array.isArray(k)?(I!=null?I:[]).filter(V=>!k.includes(V)):I!=null?I:[],B=Array.isArray(I)?(k!=null?k:[]).filter(V=>!I.includes(V)):k!=null?k:[];if(On(s))o(D),S(B);else{const V=Wt(s,$=>{$&&(o(D),S(B),V())})}},{immediate:!0})}function jO(t){return t.charAt(0).toUpperCase()+t.slice(1)}function ng(t,s,u){function f(m){Object.keys(t).filter(v=>t[v]!==void 0&&t[v]!==null).forEach(v=>{var w,o;const S=v==="mapStyle"?"setStyle":`set${jO(v)}`,k=typeof m[S]=="function",I=typeof u[v]>"u"||"bind"in u[v]?(o=(w=u[v])==null?void 0:w.bind)!=null?o:!1:!0;if(!k||!I)return;const{type:D}=t[v],B={deep:D===Object||Array.isArray(D)&&D.includes(Object)};Wt(()=>t[v],V=>{m[S](V)},B)})}if(On(s))f(On(s));else{const m=Wt(s,v=>{v&&(f(v),m())})}}function $O(t,{propsConfig:s,props:u,emit:f,events:m=[]}){const{map:v}=Uv(),w=xt();return Array.isArray(m)&&m.length&&tg(f,w,m),typeof s<"u"&&ng(u,w,s),Wt(()=>u.position,o=>{On(v)&&On(v).removeControl(On(w)).addControl(On(w),o)}),Ui(async()=>{const o=new t(u);On(v)&&On(v).addControl(o,u.position),await ui(),w.value=o}),ea(()=>{On(w)&&On(v)&&On(v).removeControl(On(w))}),{control:w,map:v}}var ig=(t,s)=>{const u=t.__vccOpts||t;for(const[f,m]of s)u[f]=m;return u};if(!Qs)throw new Error("mapboxgl is not installed.");if(!VO)throw new Error("MapboxGeocoder is not installed.");var GO={key:0},ZO={key:1};if(!Qs)throw new Error("mapboxgl is not installed.");var{LngLatBounds:yw,LngLat:HO}=Qs,vw={accessToken:{type:String,default:"no-token"},container:{type:[typeof HTMLElement<"u"&&HTMLElement,String],default:void 0},minZoom:{type:Number,default:0},maxZoom:{type:Number,default:22},minPitch:{type:Number,default:0},maxPitch:{type:Number,default:60},mapStyle:{type:[Object,String],required:!0},hash:{type:Boolean,default:!1},interactive:{type:Boolean,default:!0},bearingSnap:{type:Number,default:7},pitchWithRotate:{type:Boolean,default:!0},clickTolerance:{type:Number,default:3},attributionControl:{type:Boolean,default:!0},customAttribution:{type:[String,Array],default:null},logoPosition:{type:String,default:"bottom-left"},failIfMajorPerformanceCaveat:{type:Boolean,default:!1},preserveDrawingBuffer:{type:Boolean,default:!1},antialias:{type:Boolean,default:!1},refreshExpiredTiles:{type:Boolean,default:!0},maxBounds:{type:[yw,Array],default:void 0},scrollZoom:{type:[Boolean,Object],default:!0},boxZoom:{type:Boolean,default:!0},dragRotate:{type:Boolean,default:!0},dragPan:{type:[Boolean,Object],default:!0},keyboard:{type:Boolean,default:!0},doubleClickZoom:{type:Boolean,default:!0},touchZoomRotate:{type:[Boolean,Object],default:!0},trackResize:{type:Boolean,default:!0},center:{type:[HO,Array,Object],default:()=>[0,0]},zoom:{type:Number,default:0},bearing:{type:Number,default:0},pitch:{type:Number,default:0},bounds:{type:[yw,Array],default:void 0},fitBoundsOptions:{type:Object,default:null},renderWorldCopies:{type:Boolean,default:!0},maxTileCacheSize:{type:Number,default:null},localIdeographFontFamily:{type:String,default:"sans-serif"},transformRequest:{type:Function,default:null},collectResourceTiming:{type:Boolean,default:!1},fadeDuration:{type:Number,default:300},crossSourceCollisions:{type:Boolean,default:!0}},WO=["boxzoomcancel","boxzoomend","boxzoomstart","click","contextmenu","data","dataloading","dblclick","drag","dragend","dragstart","error","idle","load","mousedown","mouseenter","mouseleave","mousemove","mouseout","mouseover","mouseup","move","moveend","movestart","pitch","pitchend","pitchstart","remove","render","resize","rotate","rotateend","rotatestart","sourcedata","sourcedataloading","styledata","styledataloading","styleimagemissing","touchcancel","touchend","touchmove","touchstart","webglcontextlost","webglcontextrestored","wheel","zoom","zoomend","zoomstart"],XO={inheritAttrs:!1},KO=Object.assign(XO,{__name:"MapboxMap",props:vw,setup(t,{expose:s,emit:u}){const f=t,m=xt();Wl("mapbox-map",m);const v=xt(),w=xt(!1),o=se(()=>{const{accessToken:S,mapStyle:k,...I}=f;return!I.container&&v.value&&(I.container=v.value),{style:k,...I}});return tg(u,m,WO),ng(f,m,vw),Ui(()=>{Qs.accessToken=f.accessToken,m.value=new Qs.Map(o.value),m.value.on("load",()=>{w.value=!0}),u("mb-created",m.value);const S=new ResizeObserver(()=>{m.value.resize()});S.observe(o.value.container),ea(()=>{S.disconnect(),m.value.remove()})}),s({map:m}),(S,k)=>(Yn(),Zr(Ki,null,[yr("div",Fm({ref_key:"root",ref:v},S.$attrs),null,16),w.value?(Yn(),Zr("div",GO,[zd(S.$slots,"default")])):(Yn(),Zr("div",ZO,[zd(S.$slots,"loader")]))],64))}}),Vy=ig(KO,[["__file","/home/runner/work/vue-mapbox-gl/vue-mapbox-gl/packages/vue-mapbox-gl/components/MapboxMap.vue"]]);if(!Qs)throw new Error("mapboxgl is not installed.");var{GeolocateControl:YO}=Qs,xw={positionOptions:{type:Object,default:()=>({enableHighAccuracy:!1,timeout:6e3})},fitBoundsOptions:{type:Object,default:()=>({maxZoom:15})},trackUserLocation:{type:Boolean,default:!1},showAccuracyCircle:{type:Boolean,default:!0},showUserLocation:{type:Boolean,default:!0},position:{type:String,default:"top-right",bind:!1}},QO=["trackuserlocationend","error","geolocate","outofmaxbounds","trackuserlocationstart"],JO={__name:"MapboxGeolocateControl",props:xw,setup(t,{expose:s,emit:u}){const f=t,{control:m}=$O(YO,{propsConfig:xw,events:QO,props:f,emit:u});return s({control:m}),(v,w)=>(Yn(),Zr("div"))}},eB=ig(JO,[["__file","/home/runner/work/vue-mapbox-gl/vue-mapbox-gl/packages/vue-mapbox-gl/components/MapboxGeolocateControl.vue"]]),{Popup:tB,Point:nB,LngLat:iB}=Qs,bw={lngLat:{type:[iB,Array,Object],required:!0},closeButton:{type:Boolean,default:!0},closeOnClick:{type:Boolean,default:!0},closeOnMove:{type:Boolean,default:!1},anchor:{type:String,default:null},offset:{type:[Number,nB,Array,Object],default:0},className:{type:String,default:null},maxWidth:{type:String,default:"240px"},renderless:{type:Boolean,default:!1,bind:!1}},rB=["open","close"],oB={__name:"MapboxPopup",props:bw,setup(t,{expose:s,emit:u}){const f=t,m=xt(),v=xt(),w=se(()=>{const{lngLat:o,...S}=f;return S});return ng(f,m,bw),tg(u,m,rB),Ui(()=>{const{map:o}=Uv();m.value=new tB(w.value).setLngLat(f.lngLat).setDOMContent(v.value),f.renderless||m.value.addTo(o.value),u("mb-open",m.value)}),ea(()=>{m.value&&m.value.remove()}),s({popup:m}),(o,S)=>(Yn(),Zr("div",{ref_key:"root",ref:v},[zd(o.$slots,"default")],512))}},sB=ig(oB,[["__file","/home/runner/work/vue-mapbox-gl/vue-mapbox-gl/packages/vue-mapbox-gl/components/MapboxPopup.vue"]]),{Marker:aB,Point:lB}=Qs,ww={lngLat:{type:Array,required:!0},popup:{type:[Object,Boolean],default:!1,bind:!1},element:{type:typeof HTMLElement<"u"?HTMLElement:Object,default:null},offset:{type:[lB,Array],default:null},anchor:{type:String,default:"center"},color:{type:String,default:null},scale:{type:Number,default:1},draggable:{type:Boolean,default:!1},rotation:{type:Number,default:0},pitchAlignment:{type:String,default:"auto"},rotationAlignment:{type:String,default:"auto"}},cB=["dragstart","drag","dragend"],uB={__name:"MapboxMarker",props:ww,setup(t,{emit:s}){const u=t,f=$I(),m=xt(),v=xt(),w=xt(),o=se(()=>typeof f.popup<"u"),S=se(()=>o.value?w.value.popup:null),k=se(()=>({lngLat:u.lngLat,...u.popup?u.popup:{},renderless:!0})),I=se(()=>{const{lngLat:D,popup:B,...V}=u;return f.default&&(V.element=v.value),V});return ng(u,m,ww),tg(s,m,cB),Ui(()=>{const{map:D}=Uv();m.value=new aB(I.value).setLngLat(u.lngLat).addTo(D.value),o.value&&m.value.setPopup(S.value)}),ea(()=>{m.value&&m.value.remove()}),(D,B)=>(Yn(),Zr("div",null,[yr("div",{ref_key:"contentRef",ref:v},[zd(D.$slots,"default")],512),On(o)?(Yn(),Qi(sB,Fm({key:0,ref_key:"popupRef",ref:w},On(k)),{default:vn(()=>[zd(D.$slots,"popup")]),_:3},16)):xs("v-if",!0)]))}},Uy=ig(uB,[["__file","/home/runner/work/vue-mapbox-gl/vue-mapbox-gl/packages/vue-mapbox-gl/components/MapboxMarker.vue"]]);const qy=Vn({name:"QBar",props:{...no,dense:Boolean},setup(t,{slots:s}){const{proxy:{$q:u}}=Mn(),f=io(t,u),m=se(()=>`q-bar row no-wrap items-center q-bar--${t.dense===!0?"dense":"standard"}  q-bar--${f.value===!0?"dark":"light"}`);return()=>pe("div",{class:m.value,role:"toolbar"},bi(s.default))}}),$s=Vn({name:"QCardSection",props:{tag:{type:String,default:"div"},horizontal:Boolean},setup(t,{slots:s}){const u=se(()=>`q-card__section q-card__section--${t.horizontal===!0?"horiz row no-wrap":"vert"}`);return()=>pe(t.tag,{class:u.value},bi(s.default))}}),oy=Vn({name:"QCardActions",props:{...mT,vertical:Boolean},setup(t,{slots:s}){const u=gT(t),f=se(()=>`q-card__actions ${u.value} q-card__actions--${t.vertical===!0?"vert column":"horiz row"}`);return()=>pe("div",{class:f.value},bi(s.default))}}),Cd=Vn({name:"QCard",props:{...no,tag:{type:String,default:"div"},square:Boolean,flat:Boolean,bordered:Boolean},setup(t,{slots:s}){const{proxy:{$q:u}}=Mn(),f=io(t,u),m=se(()=>"q-card"+(f.value===!0?" q-card--dark q-dark":"")+(t.bordered===!0?" q-card--bordered":"")+(t.square===!0?" q-card--square no-border-radius":"")+(t.flat===!0?" q-card--flat no-shadow":""));return()=>pe(t.tag,{class:m.value},bi(s.default))}});function hB(t){const s=[.06,6,50];return typeof t=="string"&&t.length&&t.split(":").forEach((u,f)=>{const m=parseFloat(u);m&&(s[f]=m)}),s}const dB=$m({name:"touch-swipe",beforeMount(t,{value:s,arg:u,modifiers:f}){if(f.mouse!==!0&&hi.has.touch!==!0)return;const m=f.mouseCapture===!0?"Capture":"",v={handler:s,sensitivity:hB(u),direction:mm(f),noop:Es,mouseStart(w){gm(w,v)&&YE(w)&&(Xo(v,"temp",[[document,"mousemove","move",`notPassive${m}`],[document,"mouseup","end","notPassiveCapture"]]),v.start(w,!0))},touchStart(w){if(gm(w,v)){const o=w.target;Xo(v,"temp",[[o,"touchmove","move","notPassiveCapture"],[o,"touchcancel","end","notPassiveCapture"],[o,"touchend","end","notPassiveCapture"]]),v.start(w)}},start(w,o){hi.is.firefox===!0&&yu(t,!0);const S=ec(w);v.event={x:S.left,y:S.top,time:Date.now(),mouse:o===!0,dir:!1}},move(w){if(v.event===void 0)return;if(v.event.dir!==!1){zi(w);return}const o=Date.now()-v.event.time;if(o===0)return;const S=ec(w),k=S.left-v.event.x,I=Math.abs(k),D=S.top-v.event.y,B=Math.abs(D);if(v.event.mouse!==!0){if(I<v.sensitivity[1]&&B<v.sensitivity[1]){v.end(w);return}}else if(I<v.sensitivity[2]&&B<v.sensitivity[2])return;const V=I/o,$=B/o;v.direction.vertical===!0&&I<B&&I<100&&$>v.sensitivity[0]&&(v.event.dir=D<0?"up":"down"),v.direction.horizontal===!0&&I>B&&B<100&&V>v.sensitivity[0]&&(v.event.dir=k<0?"left":"right"),v.direction.up===!0&&I<B&&D<0&&I<100&&$>v.sensitivity[0]&&(v.event.dir="up"),v.direction.down===!0&&I<B&&D>0&&I<100&&$>v.sensitivity[0]&&(v.event.dir="down"),v.direction.left===!0&&I>B&&k<0&&B<100&&V>v.sensitivity[0]&&(v.event.dir="left"),v.direction.right===!0&&I>B&&k>0&&B<100&&V>v.sensitivity[0]&&(v.event.dir="right"),v.event.dir!==!1?(zi(w),v.event.mouse===!0&&(document.body.classList.add("no-pointer-events--children"),document.body.classList.add("non-selectable"),bv(),v.styleCleanup=ne=>{v.styleCleanup=void 0,document.body.classList.remove("non-selectable");const oe=()=>{document.body.classList.remove("no-pointer-events--children")};ne===!0?setTimeout(oe,50):oe()}),v.handler({evt:w,touch:v.event.mouse!==!0,mouse:v.event.mouse,direction:v.event.dir,duration:o,distance:{x:I,y:B}})):v.end(w)},end(w){v.event!==void 0&&(qa(v,"temp"),hi.is.firefox===!0&&yu(t,!1),v.styleCleanup!==void 0&&v.styleCleanup(!0),w!==void 0&&v.event.dir!==!1&&zi(w),v.event=void 0)}};if(t.__qtouchswipe=v,f.mouse===!0){const w=f.mouseCapture===!0||f.mousecapture===!0?"Capture":"";Xo(v,"main",[[t,"mousedown","mouseStart",`passive${w}`]])}hi.has.touch===!0&&Xo(v,"main",[[t,"touchstart","touchStart",`passive${f.capture===!0?"Capture":""}`],[t,"touchmove","noop","notPassiveCapture"]])},updated(t,s){const u=t.__qtouchswipe;u!==void 0&&(s.oldValue!==s.value&&(typeof s.value!="function"&&u.end(),u.handler=s.value),u.direction=mm(s.modifiers))},beforeUnmount(t){const s=t.__qtouchswipe;s!==void 0&&(qa(s,"main"),qa(s,"temp"),hi.is.firefox===!0&&yu(t,!1),s.styleCleanup!==void 0&&s.styleCleanup(),delete t.__qtouchswipe)}});function fB(){const t=new Map;return{getCache:function(s,u){return t[s]===void 0?t[s]=u:t[s]},getCacheWithFn:function(s,u){return t[s]===void 0?t[s]=u():t[s]}}}const pB={name:{required:!0},disable:Boolean},Ew={setup(t,{slots:s}){return()=>pe("div",{class:"q-panel scroll",role:"tabpanel"},bi(s.default))}},mB={modelValue:{required:!0},animated:Boolean,infinite:Boolean,swipeable:Boolean,vertical:Boolean,transitionPrev:String,transitionNext:String,transitionDuration:{type:[String,Number],default:300},keepAlive:Boolean,keepAliveInclude:[String,Array,RegExp],keepAliveExclude:[String,Array,RegExp],keepAliveMax:Number},gB=["update:modelValue","before-transition","transition"];function _B(){const{props:t,emit:s,proxy:u}=Mn(),{getCacheWithFn:f}=fB();let m,v;const w=xt(null),o=xt(null);function S(Ze){const Ye=t.vertical===!0?"up":"left";Ee((u.$q.lang.rtl===!0?-1:1)*(Ze.direction===Ye?1:-1))}const k=se(()=>[[dB,S,void 0,{horizontal:t.vertical!==!0,vertical:t.vertical,mouse:!0}]]),I=se(()=>t.transitionPrev||`slide-${t.vertical===!0?"down":"right"}`),D=se(()=>t.transitionNext||`slide-${t.vertical===!0?"up":"left"}`),B=se(()=>`--q-transition-duration: ${t.transitionDuration}ms`),V=se(()=>typeof t.modelValue=="string"||typeof t.modelValue=="number"?t.modelValue:String(t.modelValue)),$=se(()=>({include:t.keepAliveInclude,exclude:t.keepAliveExclude,max:t.keepAliveMax})),ne=se(()=>t.keepAliveInclude!==void 0||t.keepAliveExclude!==void 0);Wt(()=>t.modelValue,(Ze,Ye)=>{const lt=Se(Ze)===!0?Ae(Ze):-1;v!==!0&&fe(lt===-1?0:lt<Ae(Ye)?-1:1),w.value!==lt&&(w.value=lt,s("before-transition",Ze,Ye),ui(()=>{s("transition",Ze,Ye)}))});function oe(){Ee(1)}function ye(){Ee(-1)}function te(Ze){s("update:modelValue",Ze)}function Se(Ze){return Ze!=null&&Ze!==""}function Ae(Ze){return m.findIndex(Ye=>Ye.props.name===Ze&&Ye.props.disable!==""&&Ye.props.disable!==!0)}function ce(){return m.filter(Ze=>Ze.props.disable!==""&&Ze.props.disable!==!0)}function fe(Ze){const Ye=Ze!==0&&t.animated===!0&&w.value!==-1?"q-transition--"+(Ze===-1?I.value:D.value):null;o.value!==Ye&&(o.value=Ye)}function Ee(Ze,Ye=w.value){let lt=Ye+Ze;for(;lt>-1&&lt<m.length;){const Xt=m[lt];if(Xt!==void 0&&Xt.props.disable!==""&&Xt.props.disable!==!0){fe(Ze),v=!0,s("update:modelValue",Xt.props.name),setTimeout(()=>{v=!1});return}lt+=Ze}t.infinite===!0&&m.length>0&&Ye!==-1&&Ye!==m.length&&Ee(Ze,Ze===-1?m.length:-1)}function Me(){const Ze=Ae(t.modelValue);return w.value!==Ze&&(w.value=Ze),!0}function Ie(){const Ze=Se(t.modelValue)===!0&&Me()&&m[w.value];return t.keepAlive===!0?[pe(oI,$.value,[pe(ne.value===!0?f(V.value,()=>({...Ew,name:V.value})):Ew,{key:V.value,style:B.value},()=>Ze)])]:[pe("div",{class:"q-panel scroll",style:B.value,key:V.value,role:"tabpanel"},[Ze])]}function ke(){if(m.length!==0)return t.animated===!0?[pe(Ys,{name:o.value},Ie)]:Ie()}function Be(Ze){return m=hP(bi(Ze.default,[])).filter(Ye=>Ye.props!==null&&Ye.props.slot===void 0&&Se(Ye.props.name)===!0),m.length}function Re(){return m}return Object.assign(u,{next:oe,previous:ye,goTo:te}),{panelIndex:w,panelDirectives:k,updatePanelsList:Be,updatePanelIndex:Me,getPanelContent:ke,getEnabledPanels:ce,getPanels:Re,isValidPanelName:Se,keepAliveProps:$,needsUniqueKeepAliveWrapper:ne,goToPanelByOffset:Ee,goToPanel:te,nextPanel:oe,previousPanel:ye}}const jy=Vn({name:"QCarouselSlide",props:{...pB,imgSrc:String},setup(t,{slots:s}){const u=se(()=>t.imgSrc?{backgroundImage:`url("${t.imgSrc}")`}:{});return()=>pe("div",{class:"q-carousel__slide",style:u.value},bi(s.default))}});let pd=0;const r2={fullscreen:Boolean,noRouteFullscreenExit:Boolean},o2=["update:fullscreen","fullscreen"];function s2(){const t=Mn(),{props:s,emit:u,proxy:f}=t;let m,v,w;const o=xt(!1);vv(t)===!0&&Wt(()=>f.$route.fullPath,()=>{s.noRouteFullscreenExit!==!0&&I()}),Wt(()=>s.fullscreen,D=>{o.value!==D&&S()}),Wt(o,D=>{u("update:fullscreen",D),u("fullscreen",D)});function S(){o.value===!0?I():k()}function k(){o.value!==!0&&(o.value=!0,w=f.$el.parentNode,w.replaceChild(v,f.$el),document.body.appendChild(f.$el),pd++,pd===1&&document.body.classList.add("q-body--fullscreen-mixin"),m={handler:I},Od.add(m))}function I(){o.value===!0&&(m!==void 0&&(Od.remove(m),m=void 0),w.replaceChild(f.$el,v),o.value=!1,pd=Math.max(0,pd-1),pd===0&&(document.body.classList.remove("q-body--fullscreen-mixin"),f.$el.scrollIntoView!==void 0&&setTimeout(()=>{f.$el.scrollIntoView()})))}return Rm(()=>{v=document.createElement("span")}),Ui(()=>{s.fullscreen===!0&&k()}),Ii(I),Object.assign(f,{toggleFullscreen:S,setFullscreen:k,exitFullscreen:I}),{inFullscreen:o,toggleFullscreen:S}}const yB=["top","right","bottom","left"],vB=["regular","flat","outline","push","unelevated"],a2=Vn({name:"QCarousel",props:{...no,...mB,...r2,transitionPrev:{type:String,default:"fade"},transitionNext:{type:String,default:"fade"},height:String,padding:Boolean,controlColor:String,controlTextColor:String,controlType:{type:String,validator:t=>vB.includes(t),default:"flat"},autoplay:[Number,Boolean],arrows:Boolean,prevIcon:String,nextIcon:String,navigation:Boolean,navigationPosition:{type:String,validator:t=>yB.includes(t)},navigationIcon:String,navigationActiveIcon:String,thumbnails:Boolean},emits:[...o2,...gB],setup(t,{slots:s}){const{proxy:{$q:u}}=Mn(),f=io(t,u);let m,v;const{updatePanelsList:w,getPanelContent:o,panelDirectives:S,goToPanel:k,previousPanel:I,nextPanel:D,getEnabledPanels:B,panelIndex:V}=_B(),{inFullscreen:$}=s2(),ne=se(()=>$.value!==!0&&t.height!==void 0?{height:t.height}:{}),oe=se(()=>t.vertical===!0?"vertical":"horizontal"),ye=se(()=>`q-carousel q-panel-parent q-carousel--with${t.padding===!0?"":"out"}-padding`+($.value===!0?" fullscreen":"")+(f.value===!0?" q-carousel--dark q-dark":"")+(t.arrows===!0?` q-carousel--arrows-${oe.value}`:"")+(t.navigation===!0?` q-carousel--navigation-${ce.value}`:"")),te=se(()=>{const ke=[t.prevIcon||u.iconSet.carousel[t.vertical===!0?"up":"left"],t.nextIcon||u.iconSet.carousel[t.vertical===!0?"down":"right"]];return t.vertical===!1&&u.lang.rtl===!0?ke.reverse():ke}),Se=se(()=>t.navigationIcon||u.iconSet.carousel.navigationIcon),Ae=se(()=>t.navigationActiveIcon||Se.value),ce=se(()=>t.navigationPosition||(t.vertical===!0?"right":"bottom")),fe=se(()=>({color:t.controlColor,textColor:t.controlTextColor,round:!0,[t.controlType]:!0,dense:!0}));Wt(()=>t.modelValue,()=>{t.autoplay&&(clearInterval(m),Ee())}),Wt(()=>t.autoplay,ke=>{ke?Ee():clearInterval(m)});function Ee(){const ke=um(t.autoplay)===!0?t.autoplay:5e3;m=setTimeout(ke>=0?D:I,Math.abs(ke))}Ui(()=>{t.autoplay&&Ee()}),Ii(()=>{clearInterval(m)});function Me(ke,Be){return pe("div",{class:`q-carousel__control q-carousel__navigation no-wrap absolute flex q-carousel__navigation--${ke} q-carousel__navigation--${ce.value}`+(t.controlColor!==void 0?` text-${t.controlColor}`:"")},[pe("div",{class:"q-carousel__navigation-inner flex flex-center no-wrap"},B().map(Be))])}function Ie(){const ke=[];if(t.navigation===!0){const Be=s["navigation-icon"]!==void 0?s["navigation-icon"]:Ze=>pe(Ci,{key:"nav"+Ze.name,class:`q-carousel__navigation-icon q-carousel__navigation-icon--${Ze.active===!0?"":"in"}active`,...Ze.btnProps,onClick:Ze.onClick}),Re=v-1;ke.push(Me("buttons",(Ze,Ye)=>{const lt=Ze.props.name,Xt=V.value===Ye;return Be({index:Ye,maxIndex:Re,name:lt,active:Xt,btnProps:{icon:Xt===!0?Ae.value:Se.value,size:"sm",...fe.value},onClick:()=>{k(lt)}})}))}else if(t.thumbnails===!0){const Be=t.controlColor!==void 0?` text-${t.controlColor}`:"";ke.push(Me("thumbnails",Re=>{const Ze=Re.props;return pe("img",{key:"tmb#"+Ze.name,class:`q-carousel__thumbnail q-carousel__thumbnail--${Ze.name===t.modelValue?"":"in"}active`+Be,src:Ze.imgSrc||Ze["img-src"],onClick:()=>{k(Ze.name)}})}))}return t.arrows===!0&&V.value>=0&&((t.infinite===!0||V.value>0)&&ke.push(pe("div",{key:"prev",class:`q-carousel__control q-carousel__arrow q-carousel__prev-arrow q-carousel__prev-arrow--${oe.value} absolute flex flex-center`},[pe(Ci,{icon:te.value[0],...fe.value,onClick:I})])),(t.infinite===!0||V.value<v-1)&&ke.push(pe("div",{key:"next",class:`q-carousel__control q-carousel__arrow q-carousel__next-arrow q-carousel__next-arrow--${oe.value} absolute flex flex-center`},[pe(Ci,{icon:te.value[1],...fe.value,onClick:D})]))),Po(s.control,ke)}return()=>(v=w(s),pe("div",{class:ye.value,style:ne.value},[hm("div",{class:"q-carousel__slides-container"},o(),"sl-cont",t.swipeable,()=>S.value)].concat(Ie())))}}),xB={xs:8,sm:10,md:14,lg:20,xl:24},l2=Vn({name:"QChip",props:{...no,...Fu,dense:Boolean,icon:String,iconRight:String,iconRemove:String,iconSelected:String,label:[String,Number],color:String,textColor:String,modelValue:{type:Boolean,default:!0},selected:{type:Boolean,default:null},square:Boolean,outline:Boolean,clickable:Boolean,removable:Boolean,removeAriaLabel:String,tabindex:[String,Number],disable:Boolean,ripple:{type:[Boolean,Object],default:!0}},emits:["update:modelValue","update:selected","remove","click"],setup(t,{slots:s,emit:u}){const{proxy:{$q:f}}=Mn(),m=io(t,f),v=Nu(t,xB),w=se(()=>t.selected===!0||t.icon!==void 0),o=se(()=>t.selected===!0?t.iconSelected||f.iconSet.chip.selected:t.icon),S=se(()=>t.iconRemove||f.iconSet.chip.remove),k=se(()=>t.disable===!1&&(t.clickable===!0||t.selected!==null)),I=se(()=>{const oe=t.outline===!0&&t.color||t.textColor;return"q-chip row inline no-wrap items-center"+(t.outline===!1&&t.color!==void 0?` bg-${t.color}`:"")+(oe?` text-${oe} q-chip--colored`:"")+(t.disable===!0?" disabled":"")+(t.dense===!0?" q-chip--dense":"")+(t.outline===!0?" q-chip--outline":"")+(t.selected===!0?" q-chip--selected":"")+(k.value===!0?" q-chip--clickable cursor-pointer non-selectable q-hoverable":"")+(t.square===!0?" q-chip--square":"")+(m.value===!0?" q-chip--dark q-dark":"")}),D=se(()=>{const oe=t.disable===!0?{tabindex:-1,"aria-disabled":"true"}:{tabindex:t.tabindex||0},ye={...oe,role:"button","aria-hidden":"false","aria-label":t.removeAriaLabel||f.lang.label.remove};return{chip:oe,remove:ye}});function B(oe){oe.keyCode===13&&V(oe)}function V(oe){t.disable||(u("update:selected",!t.selected),u("click",oe))}function $(oe){(oe.keyCode===void 0||oe.keyCode===13)&&(zi(oe),t.disable===!1&&(u("update:modelValue",!1),u("remove")))}function ne(){const oe=[];k.value===!0&&oe.push(pe("div",{class:"q-focus-helper"})),w.value===!0&&oe.push(pe(Hr,{class:"q-chip__icon q-chip__icon--left",name:o.value}));const ye=t.label!==void 0?[pe("div",{class:"ellipsis"},[t.label])]:void 0;return oe.push(pe("div",{class:"q-chip__content col row no-wrap items-center q-anchor--skip"},lT(s.default,ye))),t.iconRight&&oe.push(pe(Hr,{class:"q-chip__icon q-chip__icon--right",name:t.iconRight})),t.removable===!0&&oe.push(pe(Hr,{class:"q-chip__icon q-chip__icon--remove cursor-pointer",name:S.value,...D.value.remove,onClick:$,onKeyup:$})),oe}return()=>{if(t.modelValue===!1)return;const oe={class:I.value,style:v.value};return k.value===!0&&Object.assign(oe,D.value.chip,{onClick:V,onKeyup:B}),hm("div",oe,ne(),"ripple",t.ripple!==!1&&t.disable!==!0,()=>[[fT,t.ripple]])}}});function bB({validate:t,resetValidation:s,requiresQForm:u}){const f=Vr(Uk,!1);if(f!==!1){const{props:m,proxy:v}=Mn();Object.assign(v,{validate:t,resetValidation:s}),Wt(()=>m.disable,w=>{w===!0?(typeof s=="function"&&s(),f.unbindComponent(v)):f.bindComponent(v)}),Ui(()=>{m.disable!==!0&&f.bindComponent(v)}),Ii(()=>{m.disable!==!0&&f.unbindComponent(v)})}else u===!0&&console.error("Parent QForm not found on useFormChild()!")}const Tw=/^#[0-9a-fA-F]{3}([0-9a-fA-F]{3})?$/,Sw=/^#[0-9a-fA-F]{4}([0-9a-fA-F]{4})?$/,Cw=/^#([0-9a-fA-F]{3}|[0-9a-fA-F]{4}|[0-9a-fA-F]{6}|[0-9a-fA-F]{8})$/,Dp=/^rgb\(((0|[1-9][\d]?|1[\d]{0,2}|2[\d]?|2[0-4][\d]|25[0-5]),){2}(0|[1-9][\d]?|1[\d]{0,2}|2[\d]?|2[0-4][\d]|25[0-5])\)$/,Op=/^rgba\(((0|[1-9][\d]?|1[\d]{0,2}|2[\d]?|2[0-4][\d]|25[0-5]),){2}(0|[1-9][\d]?|1[\d]{0,2}|2[\d]?|2[0-4][\d]|25[0-5]),(0|0\.[0-9]+[1-9]|0\.[1-9]+|1)\)$/,sy={date:t=>/^-?[\d]+\/[0-1]\d\/[0-3]\d$/.test(t),time:t=>/^([0-1]?\d|2[0-3]):[0-5]\d$/.test(t),fulltime:t=>/^([0-1]?\d|2[0-3]):[0-5]\d:[0-5]\d$/.test(t),timeOrFulltime:t=>/^([0-1]?\d|2[0-3]):[0-5]\d(:[0-5]\d)?$/.test(t),email:t=>/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(t),hexColor:t=>Tw.test(t),hexaColor:t=>Sw.test(t),hexOrHexaColor:t=>Cw.test(t),rgbColor:t=>Dp.test(t),rgbaColor:t=>Op.test(t),rgbOrRgbaColor:t=>Dp.test(t)||Op.test(t),hexOrRgbColor:t=>Tw.test(t)||Dp.test(t),hexaOrRgbaColor:t=>Sw.test(t)||Op.test(t),anyColor:t=>Cw.test(t)||Dp.test(t)||Op.test(t)},wB=[!0,!1,"ondemand"],EB={modelValue:{},error:{type:Boolean,default:null},errorMessage:String,noErrorIcon:Boolean,rules:Array,reactiveRules:Boolean,lazyRules:{type:[Boolean,String],validator:t=>wB.includes(t)}};function TB(t,s){const{props:u,proxy:f}=Mn(),m=xt(!1),v=xt(null),w=xt(null);bB({validate:$,resetValidation:V});let o=0,S;const k=se(()=>u.rules!==void 0&&u.rules!==null&&u.rules.length>0),I=se(()=>u.disable!==!0&&k.value===!0),D=se(()=>u.error===!0||m.value===!0),B=se(()=>typeof u.errorMessage=="string"&&u.errorMessage.length>0?u.errorMessage:v.value);Wt(()=>u.modelValue,()=>{ne()}),Wt(()=>u.reactiveRules,ye=>{ye===!0?S===void 0&&(S=Wt(()=>u.rules,()=>{ne(!0)})):S!==void 0&&(S(),S=void 0)},{immediate:!0}),Wt(t,ye=>{ye===!0?w.value===null&&(w.value=!1):w.value===!1&&(w.value=!0,I.value===!0&&u.lazyRules!=="ondemand"&&s.value===!1&&oe())});function V(){o++,s.value=!1,w.value=null,m.value=!1,v.value=null,oe.cancel()}function $(ye=u.modelValue){if(I.value!==!0)return!0;const te=++o,Se=s.value!==!0?()=>{w.value=!0}:()=>{},Ae=(fe,Ee)=>{fe===!0&&Se(),m.value=fe,v.value=Ee||null,s.value=!1},ce=[];for(let fe=0;fe<u.rules.length;fe++){const Ee=u.rules[fe];let Me;if(typeof Ee=="function"?Me=Ee(ye,sy):typeof Ee=="string"&&sy[Ee]!==void 0&&(Me=sy[Ee](ye)),Me===!1||typeof Me=="string")return Ae(!0,Me),!1;Me!==!0&&Me!==void 0&&ce.push(Me)}return ce.length===0?(Ae(!1),!0):(s.value=!0,Promise.all(ce).then(fe=>{if(fe===void 0||Array.isArray(fe)===!1||fe.length===0)return te===o&&Ae(!1),!0;const Ee=fe.find(Me=>Me===!1||typeof Me=="string");return te===o&&Ae(Ee!==void 0,Ee),Ee===void 0},fe=>(te===o&&(console.error(fe),Ae(!0)),!1)))}function ne(ye){I.value===!0&&u.lazyRules!=="ondemand"&&(w.value===!0||u.lazyRules!==!0&&ye!==!0)&&oe()}const oe=gv($,0);return Ii(()=>{S!==void 0&&S(),oe.cancel()}),Object.assign(f,{resetValidation:V,validate:$}),ys(f,"hasError",()=>D.value),{isDirtyModel:w,hasRules:k,hasError:D,errorMessage:B,validate:$,resetValidation:V}}const Aw=/^on[A-Z]/;function SB(t,s){const u={listeners:xt({}),attributes:xt({})};function f(){const m={},v={};for(const w in t)w!=="class"&&w!=="style"&&Aw.test(w)===!1&&(m[w]=t[w]);for(const w in s.props)Aw.test(w)===!0&&(v[w]=s.props[w]);u.attributes.value=m,u.listeners.value=v}return Dm(f),f(),u}let ay,Bp=0;const Sr=new Array(256);for(let t=0;t<256;t++)Sr[t]=(t+256).toString(16).substring(1);const CB=(()=>{const t=typeof crypto<"u"?crypto:typeof window<"u"?window.crypto||window.msCrypto:void 0;if(t!==void 0){if(t.randomBytes!==void 0)return t.randomBytes;if(t.getRandomValues!==void 0)return s=>{const u=new Uint8Array(s);return t.getRandomValues(u),u}}return s=>{const u=[];for(let f=s;f>0;f--)u.push(Math.floor(Math.random()*256));return u}})(),Mw=4096;function AB(){(ay===void 0||Bp+16>Mw)&&(Bp=0,ay=CB(Mw));const t=Array.prototype.slice.call(ay,Bp,Bp+=16);return t[6]=t[6]&15|64,t[8]=t[8]&63|128,Sr[t[0]]+Sr[t[1]]+Sr[t[2]]+Sr[t[3]]+"-"+Sr[t[4]]+Sr[t[5]]+"-"+Sr[t[6]]+Sr[t[7]]+"-"+Sr[t[8]]+Sr[t[9]]+"-"+Sr[t[10]]+Sr[t[11]]+Sr[t[12]]+Sr[t[13]]+Sr[t[14]]+Sr[t[15]]}function $y(t){return t===void 0?`f_${AB()}`:t}function nc(t){return t!=null&&(""+t).length>0}const qd={...no,...EB,label:String,stackLabel:Boolean,hint:String,hideHint:Boolean,prefix:String,suffix:String,labelColor:String,color:String,bgColor:String,filled:Boolean,outlined:Boolean,borderless:Boolean,standout:[Boolean,String],square:Boolean,loading:Boolean,labelSlot:Boolean,bottomSlots:Boolean,hideBottomSpace:Boolean,rounded:Boolean,dense:Boolean,itemAligned:Boolean,counter:Boolean,clearable:Boolean,clearIcon:String,disable:Boolean,readonly:Boolean,autofocus:Boolean,for:String,maxlength:[Number,String]},rg=["update:modelValue","clear","focus","blur","popup-show","popup-hide"];function og(){const{props:t,attrs:s,proxy:u,vnode:f}=Mn();return{isDark:io(t,u.$q),editable:se(()=>t.disable!==!0&&t.readonly!==!0),innerLoading:xt(!1),focused:xt(!1),hasPopupOpen:!1,splitAttrs:SB(s,f),targetUid:xt($y(t.for)),rootRef:xt(null),targetRef:xt(null),controlRef:xt(null)}}function sg(t){const{props:s,emit:u,slots:f,attrs:m,proxy:v}=Mn(),{$q:w}=v;let o;t.hasValue===void 0&&(t.hasValue=se(()=>nc(s.modelValue))),t.emitValue===void 0&&(t.emitValue=Ge=>{u("update:modelValue",Ge)}),t.controlEvents===void 0&&(t.controlEvents={onFocusin:Ie,onFocusout:ke}),Object.assign(t,{clearValue:Be,onControlFocusin:Ie,onControlFocusout:ke,focus:Ee}),t.computedCounter===void 0&&(t.computedCounter=se(()=>{if(s.counter!==!1){const Ge=typeof s.modelValue=="string"||typeof s.modelValue=="number"?(""+s.modelValue).length:Array.isArray(s.modelValue)===!0?s.modelValue.length:0,At=s.maxlength!==void 0?s.maxlength:s.maxValues;return Ge+(At!==void 0?" / "+At:"")}}));const{isDirtyModel:S,hasRules:k,hasError:I,errorMessage:D,resetValidation:B}=TB(t.focused,t.innerLoading),V=t.floatingLabel!==void 0?se(()=>s.stackLabel===!0||t.focused.value===!0||t.floatingLabel.value===!0):se(()=>s.stackLabel===!0||t.focused.value===!0||t.hasValue.value===!0),$=se(()=>s.bottomSlots===!0||s.hint!==void 0||k.value===!0||s.counter===!0||s.error!==null),ne=se(()=>s.filled===!0?"filled":s.outlined===!0?"outlined":s.borderless===!0?"borderless":s.standout?"standout":"standard"),oe=se(()=>`q-field row no-wrap items-start q-field--${ne.value}`+(t.fieldClass!==void 0?` ${t.fieldClass.value}`:"")+(s.rounded===!0?" q-field--rounded":"")+(s.square===!0?" q-field--square":"")+(V.value===!0?" q-field--float":"")+(te.value===!0?" q-field--labeled":"")+(s.dense===!0?" q-field--dense":"")+(s.itemAligned===!0?" q-field--item-aligned q-item-type":"")+(t.isDark.value===!0?" q-field--dark":"")+(t.getControl===void 0?" q-field--auto-height":"")+(t.focused.value===!0?" q-field--focused":"")+(I.value===!0?" q-field--error":"")+(I.value===!0||t.focused.value===!0?" q-field--highlighted":"")+(s.hideBottomSpace!==!0&&$.value===!0?" q-field--with-bottom":"")+(s.disable===!0?" q-field--disabled":s.readonly===!0?" q-field--readonly":"")),ye=se(()=>"q-field__control relative-position row no-wrap"+(s.bgColor!==void 0?` bg-${s.bgColor}`:"")+(I.value===!0?" text-negative":typeof s.standout=="string"&&s.standout.length>0&&t.focused.value===!0?` ${s.standout}`:s.color!==void 0?` text-${s.color}`:"")),te=se(()=>s.labelSlot===!0||s.label!==void 0),Se=se(()=>"q-field__label no-pointer-events absolute ellipsis"+(s.labelColor!==void 0&&I.value!==!0?` text-${s.labelColor}`:"")),Ae=se(()=>({id:t.targetUid.value,editable:t.editable.value,focused:t.focused.value,floatingLabel:V.value,modelValue:s.modelValue,emitValue:t.emitValue})),ce=se(()=>{const Ge={for:t.targetUid.value};return s.disable===!0?Ge["aria-disabled"]="true":s.readonly===!0&&(Ge["aria-readonly"]="true"),Ge});Wt(()=>s.for,Ge=>{t.targetUid.value=$y(Ge)});function fe(){const Ge=document.activeElement;let At=t.targetRef!==void 0&&t.targetRef.value;At&&(Ge===null||Ge.id!==t.targetUid.value)&&(At.hasAttribute("tabindex")===!0||(At=At.querySelector("[tabindex]")),At&&At!==Ge&&At.focus({preventScroll:!0}))}function Ee(){Zm(fe)}function Me(){DP(fe);const Ge=document.activeElement;Ge!==null&&t.rootRef.value.contains(Ge)&&Ge.blur()}function Ie(Ge){clearTimeout(o),t.editable.value===!0&&t.focused.value===!1&&(t.focused.value=!0,u("focus",Ge))}function ke(Ge,At){clearTimeout(o),o=setTimeout(()=>{document.hasFocus()===!0&&(t.hasPopupOpen===!0||t.controlRef===void 0||t.controlRef.value===null||t.controlRef.value.contains(document.activeElement)!==!1)||(t.focused.value===!0&&(t.focused.value=!1,u("blur",Ge)),At!==void 0&&At())})}function Be(Ge){zi(Ge),w.platform.is.mobile!==!0?(t.targetRef!==void 0&&t.targetRef.value||t.rootRef.value).focus():t.rootRef.value.contains(document.activeElement)===!0&&document.activeElement.blur(),s.type==="file"&&(t.inputRef.value.value=null),u("update:modelValue",null),u("clear",s.modelValue),ui(()=>{B(),w.platform.is.mobile!==!0&&(S.value=!1)})}function Re(){const Ge=[];return f.prepend!==void 0&&Ge.push(pe("div",{class:"q-field__prepend q-field__marginal row no-wrap items-center",key:"prepend",onClick:Fr},f.prepend())),Ge.push(pe("div",{class:"q-field__control-container col relative-position row no-wrap q-anchor--skip"},Ze())),I.value===!0&&s.noErrorIcon===!1&&Ge.push(lt("error",[pe(Hr,{name:w.iconSet.field.error,color:"negative"})])),s.loading===!0||t.innerLoading.value===!0?Ge.push(lt("inner-loading-append",f.loading!==void 0?f.loading():[pe(Gm,{color:s.color})])):s.clearable===!0&&t.hasValue.value===!0&&t.editable.value===!0&&Ge.push(lt("inner-clearable-append",[pe(Hr,{class:"q-field__focusable-action",tag:"button",name:s.clearIcon||w.iconSet.field.clear,tabindex:0,type:"button","aria-hidden":null,role:null,onClick:Be})])),f.append!==void 0&&Ge.push(pe("div",{class:"q-field__append q-field__marginal row no-wrap items-center",key:"append",onClick:Fr},f.append())),t.getInnerAppend!==void 0&&Ge.push(lt("inner-append",t.getInnerAppend())),t.getControlChild!==void 0&&Ge.push(t.getControlChild()),Ge}function Ze(){const Ge=[];return s.prefix!==void 0&&s.prefix!==null&&Ge.push(pe("div",{class:"q-field__prefix no-pointer-events row items-center"},s.prefix)),t.getShadowControl!==void 0&&t.hasShadow.value===!0&&Ge.push(t.getShadowControl()),t.getControl!==void 0?Ge.push(t.getControl()):f.rawControl!==void 0?Ge.push(f.rawControl()):f.control!==void 0&&Ge.push(pe("div",{ref:t.targetRef,class:"q-field__native row",tabindex:-1,...t.splitAttrs.attributes.value,"data-autofocus":s.autofocus===!0||void 0},f.control(Ae.value))),te.value===!0&&Ge.push(pe("div",{class:Se.value},bi(f.label,s.label))),s.suffix!==void 0&&s.suffix!==null&&Ge.push(pe("div",{class:"q-field__suffix no-pointer-events row items-center"},s.suffix)),Ge.concat(bi(f.default))}function Ye(){let Ge,At;I.value===!0?D.value!==null?(Ge=[pe("div",{role:"alert"},D.value)],At=`q--slot-error-${D.value}`):(Ge=bi(f.error),At="q--slot-error"):(s.hideHint!==!0||t.focused.value===!0)&&(s.hint!==void 0?(Ge=[pe("div",s.hint)],At=`q--slot-hint-${s.hint}`):(Ge=bi(f.hint),At="q--slot-hint"));const tn=s.counter===!0||f.counter!==void 0;if(s.hideBottomSpace===!0&&tn===!1&&Ge===void 0)return;const Ve=pe("div",{key:At,class:"q-field__messages col"},Ge);return pe("div",{class:"q-field__bottom row items-start q-field__bottom--"+(s.hideBottomSpace!==!0?"animated":"stale"),onClick:Fr},[s.hideBottomSpace===!0?Ve:pe(Ys,{name:"q-transition--field-message"},()=>Ve),tn===!0?pe("div",{class:"q-field__counter"},f.counter!==void 0?f.counter():t.computedCounter.value):null])}function lt(Ge,At){return At===null?null:pe("div",{key:Ge,class:"q-field__append q-field__marginal row no-wrap items-center q-anchor--skip"},At)}let Xt=!1;return Bu(()=>{Xt=!0}),zm(()=>{Xt===!0&&s.autofocus===!0&&v.focus()}),Ui(()=>{ws.value===!0&&s.for===void 0&&(t.targetUid.value=$y()),s.autofocus===!0&&v.focus()}),Ii(()=>{clearTimeout(o)}),Object.assign(v,{focus:Ee,blur:Me}),function(){const At=t.getControl===void 0&&f.control===void 0?{...t.splitAttrs.attributes.value,"data-autofocus":s.autofocus===!0||void 0,...ce.value}:ce.value;return pe("label",{ref:t.rootRef,class:[oe.value,m.class],style:m.style,...At},[f.before!==void 0?pe("div",{class:"q-field__before q-field__marginal row no-wrap items-center",onClick:Fr},f.before()):null,pe("div",{class:"q-field__inner relative-position col self-stretch"},[pe("div",{ref:t.controlRef,class:ye.value,tabindex:-1,...t.controlEvents},Re()),$.value===!0?Ye():null]),f.after!==void 0?pe("div",{class:"q-field__after q-field__marginal row no-wrap items-center",onClick:Fr},f.after()):null])}}const ag={name:String};function MB(t={}){return(s,u,f)=>{s[u](pe("input",{class:"hidden"+(f||""),...t.value}))}}function qv(t){return se(()=>t.name||t.for)}function hu(t,s,u,f){const m=[];return t.forEach(v=>{f(v)===!0?m.push(v):s.push({failedPropValidation:u,file:v})}),m}function Fp(t){t&&t.dataTransfer&&(t.dataTransfer.dropEffect="copy"),zi(t)}const IB={multiple:Boolean,accept:String,capture:String,maxFileSize:[Number,String],maxTotalSize:[Number,String],maxFiles:[Number,String],filter:Function},kB=["rejected"];function PB({editable:t,dnd:s,getFileInput:u,addFilesToQueue:f}){const{props:m,emit:v,proxy:w}=Mn(),o=xt(null),S=se(()=>m.accept!==void 0?m.accept.split(",").map(te=>(te=te.trim(),te==="*"?"*/":(te.endsWith("/*")&&(te=te.slice(0,te.length-1)),te.toUpperCase()))):null),k=se(()=>parseInt(m.maxFiles,10)),I=se(()=>parseInt(m.maxTotalSize,10));function D(te){if(t.value)if(te!==Object(te)&&(te={target:null}),te.target!==null&&te.target.matches('input[type="file"]')===!0)te.clientX===0&&te.clientY===0&&to(te);else{const Se=u();Se&&Se!==te.target&&Se.click(te)}}function B(te){t.value&&te&&f(null,te)}function V(te,Se,Ae,ce){let fe=Array.from(Se||te.target.files);const Ee=[],Me=()=>{Ee.length>0&&v("rejected",Ee)};if(m.accept!==void 0&&S.value.indexOf("*/")===-1&&(fe=hu(fe,Ee,"accept",Ie=>S.value.some(ke=>Ie.type.toUpperCase().startsWith(ke)||Ie.name.toUpperCase().endsWith(ke))),fe.length===0))return Me();if(m.maxFileSize!==void 0){const Ie=parseInt(m.maxFileSize,10);if(fe=hu(fe,Ee,"max-file-size",ke=>ke.size<=Ie),fe.length===0)return Me()}if(m.multiple!==!0&&fe.length>0&&(fe=[fe[0]]),fe.forEach(Ie=>{Ie.__key=Ie.webkitRelativePath+Ie.lastModified+Ie.name+Ie.size}),ce===!0){const Ie=Ae.map(ke=>ke.__key);fe=hu(fe,Ee,"duplicate",ke=>Ie.includes(ke.__key)===!1)}if(fe.length===0)return Me();if(m.maxTotalSize!==void 0){let Ie=ce===!0?Ae.reduce((ke,Be)=>ke+Be.size,0):0;if(fe=hu(fe,Ee,"max-total-size",ke=>(Ie+=ke.size,Ie<=I.value)),fe.length===0)return Me()}if(typeof m.filter=="function"){const Ie=m.filter(fe);fe=hu(fe,Ee,"filter",ke=>Ie.includes(ke))}if(m.maxFiles!==void 0){let Ie=ce===!0?Ae.length:0;if(fe=hu(fe,Ee,"max-files",()=>(Ie++,Ie<=k.value)),fe.length===0)return Me()}if(Me(),fe.length>0)return fe}function $(te){Fp(te),s.value!==!0&&(s.value=!0)}function ne(te){zi(te),(te.relatedTarget!==null||hi.is.safari!==!0?te.relatedTarget!==o.value:document.elementsFromPoint(te.clientX,te.clientY).includes(o.value)===!1)===!0&&(s.value=!1)}function oe(te){Fp(te);const Se=te.dataTransfer.files;Se.length>0&&f(null,Se),s.value=!1}function ye(te){if(s.value===!0)return pe("div",{ref:o,class:`q-${te}__dnd absolute-full`,onDragenter:Fp,onDragover:Fp,onDragleave:ne,onDrop:oe})}return Object.assign(w,{pickFiles:D,addFiles:B}),{pickFiles:D,addFiles:B,onDragover:$,onDragleave:ne,processFiles:V,getDndNode:ye,maxFilesNumber:k,maxTotalSizeNumber:I}}function c2(t,s){function u(){const f=t.modelValue;try{const m="DataTransfer"in window?new DataTransfer:"ClipboardEvent"in window?new ClipboardEvent("").clipboardData:void 0;return Object(f)===f&&("length"in f?Array.from(f):[f]).forEach(v=>{m.items.add(v)}),{files:m.files}}catch{return{files:void 0}}}return se(s===!0?()=>{if(t.type==="file")return u()}:u)}const zB=Vn({name:"QFile",inheritAttrs:!1,props:{...qd,...ag,...IB,modelValue:[File,FileList,Array],append:Boolean,useChips:Boolean,displayValue:[String,Number],tabindex:{type:[String,Number],default:0},counterLabel:Function,inputClass:[Array,String,Object],inputStyle:[Array,String,Object]},emits:[...rg,...kB],setup(t,{slots:s,emit:u,attrs:f}){const{proxy:m}=Mn(),v=og(),w=xt(null),o=xt(!1),S=qv(t),{pickFiles:k,onDragover:I,onDragleave:D,processFiles:B,getDndNode:V}=PB({editable:v.editable,dnd:o,getFileInput:Re,addFilesToQueue:Ze}),$=c2(t),ne=se(()=>Object(t.modelValue)===t.modelValue?"length"in t.modelValue?Array.from(t.modelValue):[t.modelValue]:[]),oe=se(()=>nc(ne.value)),ye=se(()=>ne.value.map(Ge=>Ge.name).join(", ")),te=se(()=>oz(ne.value.reduce((Ge,At)=>Ge+At.size,0))),Se=se(()=>({totalSize:te.value,filesNumber:ne.value.length,maxFiles:t.maxFiles})),Ae=se(()=>({tabindex:-1,type:"file",title:"",accept:t.accept,capture:t.capture,name:S.value,...f,id:v.targetUid.value,disabled:v.editable.value!==!0})),ce=se(()=>"q-file q-field--auto-height"+(o.value===!0?" q-file--dnd":"")),fe=se(()=>t.multiple===!0&&t.append===!0);function Ee(Ge){const At=ne.value.slice();At.splice(Ge,1),Ie(At)}function Me(Ge){const At=ne.value.findIndex(Ge);At>-1&&Ee(At)}function Ie(Ge){u("update:modelValue",t.multiple===!0?Ge:Ge[0])}function ke(Ge){Ge.keyCode===13&&Fr(Ge)}function Be(Ge){(Ge.keyCode===13||Ge.keyCode===32)&&k(Ge)}function Re(){return w.value}function Ze(Ge,At){const tn=B(Ge,At,ne.value,fe.value),Ve=Re();Ve!=null&&(Ve.value=""),tn!==void 0&&((t.multiple===!0?t.modelValue&&tn.every(mt=>ne.value.includes(mt)):t.modelValue===tn[0])||Ie(fe.value===!0?ne.value.concat(tn):tn))}function Ye(){return[pe("input",{class:[t.inputClass,"q-file__filler"],style:t.inputStyle})]}function lt(){if(s.file!==void 0)return ne.value.length===0?Ye():ne.value.map((At,tn)=>s.file({index:tn,file:At,ref:this}));if(s.selected!==void 0)return ne.value.length===0?Ye():s.selected({files:ne.value,ref:this});if(t.useChips===!0)return ne.value.length===0?Ye():ne.value.map((At,tn)=>pe(l2,{key:"file-"+tn,removable:v.editable.value,dense:!0,textColor:t.color,tabindex:t.tabindex,onRemove:()=>{Ee(tn)}},()=>pe("span",{class:"ellipsis",textContent:At.name})));const Ge=t.displayValue!==void 0?t.displayValue:ye.value;return Ge.length>0?[pe("div",{class:t.inputClass,style:t.inputStyle,textContent:Ge})]:Ye()}function Xt(){const Ge={ref:w,...Ae.value,...$.value,class:"q-field__input fit absolute-full cursor-pointer",onChange:Ze};return t.multiple===!0&&(Ge.multiple=!0),pe("input",Ge)}return Object.assign(v,{fieldClass:ce,emitValue:Ie,hasValue:oe,inputRef:w,innerValue:ne,floatingLabel:se(()=>oe.value===!0||nc(t.displayValue)),computedCounter:se(()=>{if(t.counterLabel!==void 0)return t.counterLabel(Se.value);const Ge=t.maxFiles;return`${ne.value.length}${Ge!==void 0?" / "+Ge:""} (${te.value})`}),getControlChild:()=>V("file"),getControl:()=>{const Ge={ref:v.targetRef,class:"q-field__native row items-center cursor-pointer",tabindex:t.tabindex};return v.editable.value===!0&&Object.assign(Ge,{onDragover:I,onDragleave:D,onKeydown:ke,onKeyup:Be}),pe("div",Ge,[Xt()].concat(lt()))}}),Object.assign(m,{removeAtIndex:Ee,removeFile:Me,getNativeElement:()=>w.value}),sg(v)}}),Iw={date:"####/##/##",datetime:"####/##/## ##:##",time:"##:##",fulltime:"##:##:##",phone:"(###) ### - ####",card:"#### #### #### ####"},bm={"#":{pattern:"[\\d]",negate:"[^\\d]"},S:{pattern:"[a-zA-Z]",negate:"[^a-zA-Z]"},N:{pattern:"[0-9a-zA-Z]",negate:"[^0-9a-zA-Z]"},A:{pattern:"[a-zA-Z]",negate:"[^a-zA-Z]",transform:t=>t.toLocaleUpperCase()},a:{pattern:"[a-zA-Z]",negate:"[^a-zA-Z]",transform:t=>t.toLocaleLowerCase()},X:{pattern:"[0-9a-zA-Z]",negate:"[^0-9a-zA-Z]",transform:t=>t.toLocaleUpperCase()},x:{pattern:"[0-9a-zA-Z]",negate:"[^0-9a-zA-Z]",transform:t=>t.toLocaleLowerCase()}},u2=Object.keys(bm);u2.forEach(t=>{bm[t].regex=new RegExp(bm[t].pattern)});const LB=new RegExp("\\\\([^.*+?^${}()|([\\]])|([.*+?^${}()|[\\]])|(["+u2.join("")+"])|(.)","g"),kw=/[.*+?^${}()|[\]\\]/g,cr=String.fromCharCode(1),RB={mask:String,reverseFillMask:Boolean,fillMask:[Boolean,String],unmaskedValue:Boolean};function DB(t,s,u,f){let m,v,w,o;const S=xt(null),k=xt(D());function I(){return t.autogrow===!0||["textarea","text","search","url","tel","password"].includes(t.type)}Wt(()=>t.type+t.autogrow,V),Wt(()=>t.mask,fe=>{if(fe!==void 0)$(k.value,!0);else{const Ee=Ae(k.value);V(),t.modelValue!==Ee&&s("update:modelValue",Ee)}}),Wt(()=>t.fillMask+t.reverseFillMask,()=>{S.value===!0&&$(k.value,!0)}),Wt(()=>t.unmaskedValue,()=>{S.value===!0&&$(k.value)});function D(){if(V(),S.value===!0){const fe=te(Ae(t.modelValue));return t.fillMask!==!1?ce(fe):fe}return t.modelValue}function B(fe){if(fe<m.length)return m.slice(-fe);let Ee="",Me=m;const Ie=Me.indexOf(cr);if(Ie>-1){for(let ke=fe-Me.length;ke>0;ke--)Ee+=cr;Me=Me.slice(0,Ie)+Ee+Me.slice(Ie)}return Me}function V(){if(S.value=t.mask!==void 0&&t.mask.length>0&&I(),S.value===!1){o=void 0,m="",v="";return}const fe=Iw[t.mask]===void 0?t.mask:Iw[t.mask],Ee=typeof t.fillMask=="string"&&t.fillMask.length>0?t.fillMask.slice(0,1):"_",Me=Ee.replace(kw,"\\$&"),Ie=[],ke=[],Be=[];let Re=t.reverseFillMask===!0,Ze="",Ye="";fe.replace(LB,(At,tn,Ve,mt,Bt)=>{if(mt!==void 0){const qt=bm[mt];Be.push(qt),Ye=qt.negate,Re===!0&&(ke.push("(?:"+Ye+"+)?("+qt.pattern+"+)?(?:"+Ye+"+)?("+qt.pattern+"+)?"),Re=!1),ke.push("(?:"+Ye+"+)?("+qt.pattern+")?")}else if(Ve!==void 0)Ze="\\"+(Ve==="\\"?"":Ve),Be.push(Ve),Ie.push("([^"+Ze+"]+)?"+Ze+"?");else{const qt=tn!==void 0?tn:Bt;Ze=qt==="\\"?"\\\\\\\\":qt.replace(kw,"\\\\$&"),Be.push(qt),Ie.push("([^"+Ze+"]+)?"+Ze+"?")}});const lt=new RegExp("^"+Ie.join("")+"("+(Ze===""?".":"[^"+Ze+"]")+"+)?"+(Ze===""?"":"["+Ze+"]*")+"$"),Xt=ke.length-1,Ge=ke.map((At,tn)=>tn===0&&t.reverseFillMask===!0?new RegExp("^"+Me+"*"+At):tn===Xt?new RegExp("^"+At+"("+(Ye===""?".":Ye)+"+)?"+(t.reverseFillMask===!0?"$":Me+"*")):new RegExp("^"+At));w=Be,o=At=>{const tn=lt.exec(At);tn!==null&&(At=tn.slice(1).join(""));const Ve=[],mt=Ge.length;for(let Bt=0,qt=At;Bt<mt;Bt++){const xn=Ge[Bt].exec(qt);if(xn===null)break;qt=qt.slice(xn.shift().length),Ve.push(...xn)}return Ve.length>0?Ve.join(""):At},m=Be.map(At=>typeof At=="string"?At:cr).join(""),v=m.split(cr).join(Ee)}function $(fe,Ee,Me){const Ie=f.value,ke=Ie.selectionEnd,Be=Ie.value.length-ke,Re=Ae(fe);Ee===!0&&V();const Ze=te(Re),Ye=t.fillMask!==!1?ce(Ze):Ze,lt=k.value!==Ye;Ie.value!==Ye&&(Ie.value=Ye),lt===!0&&(k.value=Ye),document.activeElement===Ie&&ui(()=>{if(Ye===v){const Ge=t.reverseFillMask===!0?v.length:0;Ie.setSelectionRange(Ge,Ge,"forward");return}if(Me==="insertFromPaste"&&t.reverseFillMask!==!0){const Ge=ke-1;oe.right(Ie,Ge,Ge);return}if(["deleteContentBackward","deleteContentForward"].indexOf(Me)>-1){const Ge=t.reverseFillMask===!0?ke===0?Ye.length>Ze.length?1:0:Math.max(0,Ye.length-(Ye===v?0:Math.min(Ze.length,Be)+1))+1:ke;Ie.setSelectionRange(Ge,Ge,"forward");return}if(t.reverseFillMask===!0)if(lt===!0){const Ge=Math.max(0,Ye.length-(Ye===v?0:Math.min(Ze.length,Be+1)));Ge===1&&ke===1?Ie.setSelectionRange(Ge,Ge,"forward"):oe.rightReverse(Ie,Ge,Ge)}else{const Ge=Ye.length-Be;Ie.setSelectionRange(Ge,Ge,"backward")}else if(lt===!0){const Ge=Math.max(0,m.indexOf(cr),Math.min(Ze.length,ke)-1);oe.right(Ie,Ge,Ge)}else{const Ge=ke-1;oe.right(Ie,Ge,Ge)}});const Xt=t.unmaskedValue===!0?Ae(Ye):Ye;String(t.modelValue)!==Xt&&u(Xt,!0)}function ne(fe,Ee,Me){const Ie=te(Ae(fe.value));Ee=Math.max(0,m.indexOf(cr),Math.min(Ie.length,Ee)),fe.setSelectionRange(Ee,Me,"forward")}const oe={left(fe,Ee,Me,Ie){const ke=m.slice(Ee-1).indexOf(cr)===-1;let Be=Math.max(0,Ee-1);for(;Be>=0;Be--)if(m[Be]===cr){Ee=Be,ke===!0&&Ee++;break}if(Be<0&&m[Ee]!==void 0&&m[Ee]!==cr)return oe.right(fe,0,0);Ee>=0&&fe.setSelectionRange(Ee,Ie===!0?Me:Ee,"backward")},right(fe,Ee,Me,Ie){const ke=fe.value.length;let Be=Math.min(ke,Me+1);for(;Be<=ke;Be++)if(m[Be]===cr){Me=Be;break}else m[Be-1]===cr&&(Me=Be);if(Be>ke&&m[Me-1]!==void 0&&m[Me-1]!==cr)return oe.left(fe,ke,ke);fe.setSelectionRange(Ie?Ee:Me,Me,"forward")},leftReverse(fe,Ee,Me,Ie){const ke=B(fe.value.length);let Be=Math.max(0,Ee-1);for(;Be>=0;Be--)if(ke[Be-1]===cr){Ee=Be;break}else if(ke[Be]===cr&&(Ee=Be,Be===0))break;if(Be<0&&ke[Ee]!==void 0&&ke[Ee]!==cr)return oe.rightReverse(fe,0,0);Ee>=0&&fe.setSelectionRange(Ee,Ie===!0?Me:Ee,"backward")},rightReverse(fe,Ee,Me,Ie){const ke=fe.value.length,Be=B(ke),Re=Be.slice(0,Me+1).indexOf(cr)===-1;let Ze=Math.min(ke,Me+1);for(;Ze<=ke;Ze++)if(Be[Ze-1]===cr){Me=Ze,Me>0&&Re===!0&&Me--;break}if(Ze>ke&&Be[Me-1]!==void 0&&Be[Me-1]!==cr)return oe.leftReverse(fe,ke,ke);fe.setSelectionRange(Ie===!0?Ee:Me,Me,"forward")}};function ye(fe){if(_v(fe)===!0)return;const Ee=f.value,Me=Ee.selectionStart,Ie=Ee.selectionEnd;if(fe.keyCode===37||fe.keyCode===39){const ke=oe[(fe.keyCode===39?"right":"left")+(t.reverseFillMask===!0?"Reverse":"")];fe.preventDefault(),ke(Ee,Me,Ie,fe.shiftKey)}else fe.keyCode===8&&t.reverseFillMask!==!0&&Me===Ie?oe.left(Ee,Me,Ie,!0):fe.keyCode===46&&t.reverseFillMask===!0&&Me===Ie&&oe.rightReverse(Ee,Me,Ie,!0)}function te(fe){if(fe==null||fe==="")return"";if(t.reverseFillMask===!0)return Se(fe);const Ee=w;let Me=0,Ie="";for(let ke=0;ke<Ee.length;ke++){const Be=fe[Me],Re=Ee[ke];if(typeof Re=="string")Ie+=Re,Be===Re&&Me++;else if(Be!==void 0&&Re.regex.test(Be))Ie+=Re.transform!==void 0?Re.transform(Be):Be,Me++;else return Ie}return Ie}function Se(fe){const Ee=w,Me=m.indexOf(cr);let Ie=fe.length-1,ke="";for(let Be=Ee.length-1;Be>=0&&Ie>-1;Be--){const Re=Ee[Be];let Ze=fe[Ie];if(typeof Re=="string")ke=Re+ke,Ze===Re&&Ie--;else if(Ze!==void 0&&Re.regex.test(Ze))do ke=(Re.transform!==void 0?Re.transform(Ze):Ze)+ke,Ie--,Ze=fe[Ie];while(Me===Be&&Ze!==void 0&&Re.regex.test(Ze));else return ke}return ke}function Ae(fe){return typeof fe!="string"||o===void 0?typeof fe=="number"?o(""+fe):fe:o(fe)}function ce(fe){return v.length-fe.length<=0?fe:t.reverseFillMask===!0&&fe.length>0?v.slice(0,-fe.length)+fe:fe+v.slice(fe.length)}return{innerValue:k,hasMask:S,moveCursorForPaste:ne,updateMaskValue:$,onMaskedKeydown:ye}}const OB=/[\u3000-\u303f\u3040-\u309f\u30a0-\u30ff\uff00-\uff9f\u4e00-\u9faf\u3400-\u4dbf]/,BB=/[\u4e00-\u9fff\u3400-\u4dbf\u{20000}-\u{2a6df}\u{2a700}-\u{2b73f}\u{2b740}-\u{2b81f}\u{2b820}-\u{2ceaf}\uf900-\ufaff\u3300-\u33ff\ufe30-\ufe4f\uf900-\ufaff\u{2f800}-\u{2fa1f}]/u,FB=/[\u3131-\u314e\u314f-\u3163\uac00-\ud7a3]/,NB=/[a-z0-9_ -]$/i;function h2(t){return function(u){if(u.type==="compositionend"||u.type==="change"){if(u.target.qComposing!==!0)return;u.target.qComposing=!1,t(u)}else u.type==="compositionupdate"&&u.target.qComposing!==!0&&typeof u.data=="string"&&(hi.is.firefox===!0?NB.test(u.data)===!1:OB.test(u.data)===!0||BB.test(u.data)===!0||FB.test(u.data)===!0)===!0&&(u.target.qComposing=!0)}}const em=Vn({name:"QInput",inheritAttrs:!1,props:{...qd,...RB,...ag,modelValue:{required:!1},shadowText:String,type:{type:String,default:"text"},debounce:[String,Number],autogrow:Boolean,inputClass:[Array,String,Object],inputStyle:[Array,String,Object]},emits:[...rg,"paste","change"],setup(t,{emit:s,attrs:u}){const{proxy:f}=Mn(),{$q:m}=f,v={};let w=NaN,o,S,k,I;const D=xt(null),B=qv(t),{innerValue:V,hasMask:$,moveCursorForPaste:ne,updateMaskValue:oe,onMaskedKeydown:ye}=DB(t,s,Ye,D),te=c2(t,!0),Se=se(()=>nc(V.value)),Ae=h2(Ze),ce=og(),fe=se(()=>t.type==="textarea"||t.autogrow===!0),Ee=se(()=>fe.value===!0||["text","search","url","tel","password"].includes(t.type)),Me=se(()=>{const Ve={...ce.splitAttrs.listeners.value,onInput:Ze,onPaste:Re,onChange:Xt,onBlur:Ge,onFocus:to};return Ve.onCompositionstart=Ve.onCompositionupdate=Ve.onCompositionend=Ae,$.value===!0&&(Ve.onKeydown=ye),t.autogrow===!0&&(Ve.onAnimationend=lt),Ve}),Ie=se(()=>{const Ve={tabindex:0,"data-autofocus":t.autofocus===!0||void 0,rows:t.type==="textarea"?6:void 0,"aria-label":t.label,name:B.value,...ce.splitAttrs.attributes.value,id:ce.targetUid.value,maxlength:t.maxlength,disabled:t.disable===!0,readonly:t.readonly===!0};return fe.value===!1&&(Ve.type=t.type),t.autogrow===!0&&(Ve.rows=1),Ve});Wt(()=>t.type,()=>{D.value&&(D.value.value=t.modelValue)}),Wt(()=>t.modelValue,Ve=>{if($.value===!0){if(S===!0&&(S=!1,String(Ve)===w))return;oe(Ve)}else V.value!==Ve&&(V.value=Ve,t.type==="number"&&v.hasOwnProperty("value")===!0&&(o===!0?o=!1:delete v.value));t.autogrow===!0&&ui(lt)}),Wt(()=>t.autogrow,Ve=>{Ve===!0?ui(lt):D.value!==null&&u.rows>0&&(D.value.style.height="auto")}),Wt(()=>t.dense,()=>{t.autogrow===!0&&ui(lt)});function ke(){Zm(()=>{const Ve=document.activeElement;D.value!==null&&D.value!==Ve&&(Ve===null||Ve.id!==ce.targetUid.value)&&D.value.focus({preventScroll:!0})})}function Be(){D.value!==null&&D.value.select()}function Re(Ve){if($.value===!0&&t.reverseFillMask!==!0){const mt=Ve.target;ne(mt,mt.selectionStart,mt.selectionEnd)}s("paste",Ve)}function Ze(Ve){if(!Ve||!Ve.target)return;if(t.type==="file"){s("update:modelValue",Ve.target.files);return}const mt=Ve.target.value;if(Ve.target.qComposing===!0){v.value=mt;return}if($.value===!0)oe(mt,!1,Ve.inputType);else if(Ye(mt),Ee.value===!0&&Ve.target===document.activeElement){const{selectionStart:Bt,selectionEnd:qt}=Ve.target;Bt!==void 0&&qt!==void 0&&ui(()=>{Ve.target===document.activeElement&&mt.indexOf(Ve.target.value)===0&&Ve.target.setSelectionRange(Bt,qt)})}t.autogrow===!0&&lt()}function Ye(Ve,mt){I=()=>{t.type!=="number"&&v.hasOwnProperty("value")===!0&&delete v.value,t.modelValue!==Ve&&w!==Ve&&(w=Ve,mt===!0&&(S=!0),s("update:modelValue",Ve),ui(()=>{w===Ve&&(w=NaN)})),I=void 0},t.type==="number"&&(o=!0,v.value=Ve),t.debounce!==void 0?(clearTimeout(k),v.value=Ve,k=setTimeout(I,t.debounce)):I()}function lt(){requestAnimationFrame(()=>{const Ve=D.value;if(Ve!==null){const mt=Ve.parentNode.style,{overflow:Bt}=Ve.style;m.platform.is.firefox!==!0&&(Ve.style.overflow="hidden"),Ve.style.height="1px",mt.marginBottom=Ve.scrollHeight-1+"px",Ve.style.height=Ve.scrollHeight+"px",Ve.style.overflow=Bt,mt.marginBottom=""}})}function Xt(Ve){Ae(Ve),clearTimeout(k),I!==void 0&&I(),s("change",Ve.target.value)}function Ge(Ve){Ve!==void 0&&to(Ve),clearTimeout(k),I!==void 0&&I(),o=!1,S=!1,delete v.value,t.type!=="file"&&setTimeout(()=>{D.value!==null&&(D.value.value=V.value!==void 0?V.value:"")})}function At(){return v.hasOwnProperty("value")===!0?v.value:V.value!==void 0?V.value:""}Ii(()=>{Ge()}),Ui(()=>{t.autogrow===!0&&lt()}),Object.assign(ce,{innerValue:V,fieldClass:se(()=>`q-${fe.value===!0?"textarea":"input"}`+(t.autogrow===!0?" q-textarea--autogrow":"")),hasShadow:se(()=>t.type!=="file"&&typeof t.shadowText=="string"&&t.shadowText.length>0),inputRef:D,emitValue:Ye,hasValue:Se,floatingLabel:se(()=>Se.value===!0||nc(t.displayValue)),getControl:()=>pe(fe.value===!0?"textarea":"input",{ref:D,class:["q-field__native q-placeholder",t.inputClass],style:t.inputStyle,...Ie.value,...Me.value,...t.type!=="file"?{value:At()}:te.value}),getShadowControl:()=>pe("div",{class:"q-field__native q-field__shadow absolute-bottom no-pointer-events"+(fe.value===!0?"":" text-no-wrap")},[pe("span",{class:"invisible"},At()),pe("span",t.shadowText)])});const tn=sg(ce);return Object.assign(f,{focus:ke,select:Be,getNativeElement:()=>D.value}),tn}});let Np=0;const VB={standard:"fixed-full flex-center",top:"fixed-top justify-center",bottom:"fixed-bottom justify-center",right:"fixed-right items-center",left:"fixed-left items-center"},Pw={standard:["scale","scale"],top:["slide-down","slide-up"],bottom:["slide-up","slide-down"],right:["slide-left","slide-right"],left:["slide-right","slide-left"]},wm=Vn({name:"QDialog",inheritAttrs:!1,props:{...wv,...IT,transitionShow:String,transitionHide:String,persistent:Boolean,autoClose:Boolean,allowFocusOutside:Boolean,noEscDismiss:Boolean,noBackdropDismiss:Boolean,noRouteDismiss:Boolean,noRefocus:Boolean,noFocus:Boolean,noShake:Boolean,seamless:Boolean,maximized:Boolean,fullWidth:Boolean,fullHeight:Boolean,square:Boolean,position:{type:String,default:"standard",validator:t=>t==="standard"||["top","bottom","left","right"].includes(t)}},emits:[...Ev,"shake","click","escape-key"],setup(t,{slots:s,emit:u,attrs:f}){const m=Mn(),v=xt(null),w=xt(!1),o=xt(!1),S=xt(!1);let k,I=null,D,B;const V=se(()=>t.persistent!==!0&&t.noRouteDismiss!==!0&&t.seamless!==!0),{preventBodyScroll:$}=qT(),{registerTimeout:ne}=Sv(),{registerTick:oe,removeTick:ye}=kT(),{showPortal:te,hidePortal:Se,portalIsAccessible:Ae,renderPortal:ce}=MT(m,v,ot,!0),{hide:fe}=Tv({showing:w,hideOnRouteChange:V,handleShow:Ge,handleHide:At,processOnMount:!0}),{addToHistory:Ee,removeFromHistory:Me}=UT(w,fe,V),Ie=se(()=>`q-dialog__inner flex no-pointer-events q-dialog__inner--${t.maximized===!0?"maximized":"minimized"} q-dialog__inner--${t.position} ${VB[t.position]}`+(S.value===!0?" q-dialog__inner--animating":"")+(t.fullWidth===!0?" q-dialog__inner--fullwidth":"")+(t.fullHeight===!0?" q-dialog__inner--fullheight":"")+(t.square===!0?" q-dialog__inner--square":"")),ke=se(()=>"q-transition--"+(t.transitionShow===void 0?Pw[t.position][0]:t.transitionShow)),Be=se(()=>"q-transition--"+(t.transitionHide===void 0?Pw[t.position][1]:t.transitionHide)),Re=se(()=>o.value===!0?Be.value:ke.value),Ze=se(()=>`--q-transition-duration: ${t.transitionDuration}ms`),Ye=se(()=>w.value===!0&&t.seamless!==!0),lt=se(()=>t.autoClose===!0?{onClick:xn}:{}),Xt=se(()=>[`q-dialog fullscreen no-pointer-events q-dialog--${Ye.value===!0?"modal":"seamless"}`,f.class]);Wt(w,_t=>{ui(()=>{o.value=_t})}),Wt(()=>t.maximized,_t=>{w.value===!0&&qt(_t)}),Wt(Ye,_t=>{$(_t),_t===!0?(OT(gt),RT(mt)):(My(gt),dm(mt))});function Ge(_t){Ee(),I=t.noRefocus===!1&&document.activeElement!==null?document.activeElement:null,qt(t.maximized),te(),S.value=!0,t.noFocus!==!0?(document.activeElement!==null&&document.activeElement.blur(),oe(tn)):ye(),ne(()=>{if(m.proxy.$q.platform.is.ios===!0){if(t.seamless!==!0&&document.activeElement){const{top:ft,bottom:sn}=document.activeElement.getBoundingClientRect(),{innerHeight:un}=window,re=window.visualViewport!==void 0?window.visualViewport.height:un;ft>0&&sn>re/2&&(document.scrollingElement.scrollTop=Math.min(document.scrollingElement.scrollHeight-re,sn>=un?1/0:Math.ceil(document.scrollingElement.scrollTop+sn-re/2))),document.activeElement.scrollIntoView()}B=!0,v.value.click(),B=!1}te(!0),S.value=!1,u("show",_t)},t.transitionDuration)}function At(_t){ye(),Me(),Bt(!0),S.value=!0,Se(),I!==null&&(I.focus(),I=null),ne(()=>{Se(!0),S.value=!1,u("hide",_t)},t.transitionDuration)}function tn(_t){Zm(()=>{let ft=v.value;ft===null||ft.contains(document.activeElement)===!0||(ft=ft.querySelector(_t||"[autofocus], [data-autofocus]")||ft,ft.focus({preventScroll:!0}))})}function Ve(){tn(),u("shake");const _t=v.value;_t!==null&&(_t.classList.remove("q-animate--scale"),_t.classList.add("q-animate--scale"),clearTimeout(k),k=setTimeout(()=>{v.value!==null&&(_t.classList.remove("q-animate--scale"),tn())},170))}function mt(){t.seamless!==!0&&(t.persistent===!0||t.noEscDismiss===!0?t.maximized!==!0&&t.noShake!==!0&&Ve():(u("escape-key"),fe()))}function Bt(_t){clearTimeout(k),(_t===!0||w.value===!0)&&(qt(!1),t.seamless!==!0&&($(!1),My(gt),dm(mt))),_t!==!0&&(I=null)}function qt(_t){_t===!0?D!==!0&&(Np<1&&document.body.classList.add("q-body--dialog"),Np++,D=!0):D===!0&&(Np<2&&document.body.classList.remove("q-body--dialog"),Np--,D=!1)}function xn(_t){B!==!0&&(fe(_t),u("click",_t))}function rt(_t){t.persistent!==!0&&t.noBackdropDismiss!==!0?fe(_t):t.noShake!==!0&&Ve()}function gt(_t){t.allowFocusOutside!==!0&&Ae.value===!0&&dT(v.value,_t.target)!==!0&&tn('[tabindex]:not([tabindex="-1"])')}Object.assign(m.proxy,{focus:tn,shake:Ve,__updateRefocusTarget(_t){I=_t||null}}),Ii(Bt);function ot(){return pe("div",{role:"dialog","aria-modal":Ye.value===!0?"true":"false",...f,class:Xt.value},[pe(Ys,{name:"q-transition--fade",appear:!0},()=>Ye.value===!0?pe("div",{class:"q-dialog__backdrop fixed-full",style:Ze.value,"aria-hidden":"true",onMousedown:rt}):null),pe(Ys,{name:Re.value,appear:!0},()=>w.value===!0?pe("div",{ref:v,class:Ie.value,style:Ze.value,tabindex:-1,...lt.value},bi(s.default)):null)])}return ce}});function zw(t){if(t===!1)return 0;if(t===!0||t===void 0)return 1;const s=parseInt(t,10);return isNaN(s)?0:s}const tm=$m({name:"close-popup",beforeMount(t,{value:s}){const u={depth:zw(s),handler(f){u.depth!==0&&setTimeout(()=>{const m=OP(t);m!==void 0&&BP(m,f,u.depth)})},handlerKey(f){$a(f,13)===!0&&u.handler(f)}};t.__qclosepopup=u,t.addEventListener("click",u.handler),t.addEventListener("keyup",u.handlerKey)},updated(t,{value:s,oldValue:u}){s!==u&&(t.__qclosepopup.depth=zw(s))},beforeUnmount(t){const s=t.__qclosepopup;t.removeEventListener("click",s.handler),t.removeEventListener("keyup",s.handlerKey),delete t.__qclosepopup}}),d2={__name:"ImageCarousel",props:{images:Array},setup(t){const s=t,u=xt(0);return(f,m)=>(Yn(),Qi(a2,{modelValue:u.value,"onUpdate:modelValue":m[0]||(m[0]=v=>u.value=v),"transition-prev":"slide","transition-next":"slide",swipeable:"",animated:"","control-color":"white",navigation:"",padding:"",arrows:"",height:"200px",class:"bg-primary text-white shadow-1 rounded-borders"},{default:vn(()=>[(Yn(!0),Zr(Ki,null,Su(s.images,(v,w)=>(Yn(),Qi(jy,{key:w,name:w,class:"column no-wrap flex-center","img-src":`/images/${v}`},null,8,["name","img-src"]))),128))]),_:1},8,["modelValue"]))}};var Lw;const lg=typeof window<"u",UB=t=>typeof t<"u",qB=t=>typeof t=="function";lg&&((Lw=window==null?void 0:window.navigator)==null?void 0:Lw.userAgent)&&/iP(ad|hone|od)/.test(window.navigator.userAgent);function jB(t){return t}lg&&window.document;lg&&window.navigator;lg&&window.location;function $B(t){return JSON.parse(JSON.stringify(t))}const Gy=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},Zy="__vueuse_ssr_handlers__";Gy[Zy]=Gy[Zy]||{};Gy[Zy];var Rw;(function(t){t.UP="UP",t.RIGHT="RIGHT",t.DOWN="DOWN",t.LEFT="LEFT",t.NONE="NONE"})(Rw||(Rw={}));var GB=Object.defineProperty,Dw=Object.getOwnPropertySymbols,ZB=Object.prototype.hasOwnProperty,HB=Object.prototype.propertyIsEnumerable,Ow=(t,s,u)=>s in t?GB(t,s,{enumerable:!0,configurable:!0,writable:!0,value:u}):t[s]=u,WB=(t,s)=>{for(var u in s||(s={}))ZB.call(s,u)&&Ow(t,u,s[u]);if(Dw)for(var u of Dw(s))HB.call(s,u)&&Ow(t,u,s[u]);return t};const XB={easeInSine:[.12,0,.39,0],easeOutSine:[.61,1,.88,1],easeInOutSine:[.37,0,.63,1],easeInQuad:[.11,0,.5,0],easeOutQuad:[.5,1,.89,1],easeInOutQuad:[.45,0,.55,1],easeInCubic:[.32,0,.67,0],easeOutCubic:[.33,1,.68,1],easeInOutCubic:[.65,0,.35,1],easeInQuart:[.5,0,.75,0],easeOutQuart:[.25,1,.5,1],easeInOutQuart:[.76,0,.24,1],easeInQuint:[.64,0,.78,0],easeOutQuint:[.22,1,.36,1],easeInOutQuint:[.83,0,.17,1],easeInExpo:[.7,0,.84,0],easeOutExpo:[.16,1,.3,1],easeInOutExpo:[.87,0,.13,1],easeInCirc:[.55,0,1,.45],easeOutCirc:[0,.55,.45,1],easeInOutCirc:[.85,0,.15,1],easeInBack:[.36,0,.66,-.56],easeOutBack:[.34,1.56,.64,1],easeInOutBack:[.68,-.6,.32,1.6]};WB({linear:jB},XB);function f2(t,s,u,f={}){var m,v,w;const{clone:o=!1,passive:S=!1,eventName:k,deep:I=!1,defaultValue:D}=f,B=Mn(),V=u||(B==null?void 0:B.emit)||((m=B==null?void 0:B.$emit)==null?void 0:m.bind(B))||((w=(v=B==null?void 0:B.proxy)==null?void 0:v.$emit)==null?void 0:w.bind(B==null?void 0:B.proxy));let $=k;s||(s="modelValue"),$=k||$||`update:${s.toString()}`;const ne=ye=>o?qB(o)?o(ye):$B(ye):ye,oe=()=>UB(t[s])?ne(t[s]):D;if(S){const ye=oe(),te=xt(ye);return Wt(()=>t[s],Se=>te.value=ne(Se)),Wt(te,Se=>{(Se!==t[s]||I)&&V($,Se)},{deep:I}),te}else return se({get(){return oe()},set(ye){V($,ye)}})}const cg=aT("tagStore",()=>{const t=xt([]),s=se(()=>Un(t.value));async function u(){const{data:S}=await Vl.get("/api/tag/");t.value=S}async function f(S,k){const I=await Vl.post(`/api/tag/upload/${S._id}`,{updatedFields:k});console.log(I)}async function m(S){const k=new FormData;S.forEach(D=>{k.append("image",D)});const{data:I}=await Vl.post("/api/tag/image",k,{headers:{"Content-Type":"multipart/form-data"}});return console.log(I),I}async function v(S){await Vl.delete(`/api/tag/${S._id}`),t.value.splice(t.value.findIndex(k=>k._id==S._id),1)}async function w(S){await Vl.post(`/api/tag/favourite/${S._id}`);const k=t.value.find(I=>I._id===S._id);k.favourite=!k.favourite}async function o(S){await Vl.post("/api/tag",{updatedFields:S}),u()}return{getUserTags:u,updateTag:f,uploadAddedImages:m,deleteTag:v,favouriteTag:w,createTag:o,tags:t,tagsGetter:s}},{persist:!0}),KB={class:"text-h3",style:{"font-family":"BlankRiver"}},YB=yr("p",{class:"text-h5"},"Willst du diesen Tag wirklich l\xF6schen?",-1),QB={class:"text-subtitle1"},JB={style:{"font-family":"blankRiver"}},e3={__name:"BigCardPopUP",props:{toggle:Boolean,currentTag:Object},emits:["update:toggle"],setup(t,{emit:s}){const u=t,f=cg(),m="pk.eyJ1IjoidG9iaXdhbmtpcm5vYmkiLCJhIjoiY2xlNXBuc2g1MGY4YzNxcWkxcWNtZ3N2ZCJ9.qWMZQd_uuqNnTDb9QcBtiQ",v=xt(),w=xt([]),o=[],S=xt(0),k=xt(!1),I=xt(""),D=xt(!1),B=xt(),V=xt([]),$=xt(),ne=xt([]),oe=f2(u,"toggle",s),ye=()=>{B.value=u.currentTag.title,$.value=u.currentTag.description,V.value=JSON.parse(JSON.stringify(u.currentTag.images)),ne.value.longitude=u.currentTag.coords.longitude,ne.value.latitude=u.currentTag.coords.latitude,w.value.splice(0,w.value.length),o.splice(0,o.length)},te=()=>{ye(),D.value=!1},Se=()=>{ye(),D.value=!D.value},Ae=ke=>{console.log(ke.target.getLngLat());const{lng:Be,lat:Re}=ke.target.getLngLat();ne.value.longitude=Be,ne.value.latitude=Re},ce=async()=>{w.value.length>0&&(await f.uploadAddedImages(o)).forEach(Re=>V.value.push(Re.filename));const ke={};B.value!==u.currentTag.title&&(ke.title=B.value),$.value!==u.currentTag.description&&(ke.description=$.value),ne.value!==u.currentTag.coords&&(ke.coords={longitude:ne.value.longitude,latitude:ne.value.latitude}),V.value!==JSON.parse(JSON.stringify(u.currentTag.images))&&(ke.images=V.value),f.updateTag(u.currentTag,ke),f.getUserTags(),ye(),D.value=!D.value},fe=ke=>{console.log(ke),w.value.push(URL.createObjectURL(ke)),o.push(ke),console.log(ke),v.value=null},Ee=ke=>{const Be=V.value.findIndex(Re=>Re===ke);V.value.splice(Be,1)},Me=ke=>{const Be=w.value.findIndex(Re=>Re===ke);w.value.splice(Be,1),o.splice(Be,1)},Ie=()=>{f.deleteTag(u.currentTag),f.getUserTags(),s("update:toggle",!1)};return(ke,Be)=>(Yn(),Zr(Ki,null,[Nt(wm,{modelValue:On(oe),"onUpdate:modelValue":Be[10]||(Be[10]=Re=>Vi(oe)?oe.value=Re:null),persistent:"",maximized:!0,"transition-show":"slide-up","transition-hide":"slide-down"},{default:vn(()=>[D.value?xs("",!0):(Yn(),Qi(Cd,{key:0,class:"bg-white text-balck"},{default:vn(()=>[Nt(qy,{class:"bg-primary text-white flex justify-center"},{default:vn(()=>[Xl(Nt(Ci,{dense:"",flat:"","font-size":"30px",icon:"expand_more"},null,512),[[tm]])]),_:1}),Nt(d2,{images:t.currentTag.images},null,8,["images"]),Nt($s,null,{default:vn(()=>[yr("p",KB,Gs(t.currentTag.title),1),yr("p",null,Gs(t.currentTag.description),1)]),_:1}),Nt($s,null,{default:vn(()=>[Nt(On(Vy),{style:{height:"200px"},ref:"mapboxMap","access-token":On(m),"map-style":"mapbox://styles/tobiwankirnobi/cle5t3xjp001b01o4s7negt5k",center:[t.currentTag.coords.longitude,t.currentTag.coords.latitude],zoom:10},{default:vn(()=>[Nt(On(Uy),{"lng-lat":[t.currentTag.coords.longitude,t.currentTag.coords.latitude]},null,8,["lng-lat"])]),_:1},8,["access-token","center"])]),_:1}),Nt($s,{class:"q-pt-none"}),Nt(oy,{class:"fixed-bottom q-pa-md",align:"around"},{default:vn(()=>[Nt(Ci,{class:"bg-primary text-white",square:"",rouded:"",icon:"edit",onClick:Be[0]||(Be[0]=Re=>Se())}),Nt(Ci,{class:"bg-primary text-white",square:"",rouded:"",icon:"delete",onClick:Be[1]||(Be[1]=Re=>k.value=!0)})]),_:1})]),_:1})),D.value?(Yn(),Qi(Cd,{key:1,class:"bg-white text-balck"},{default:vn(()=>[Nt(qy,{class:"bg-primary text-white flex justify-center"},{default:vn(()=>[Xl(Nt(Ci,{dense:"",flat:"","font-size":"30px",icon:"expand_more"},null,512),[[tm]])]),_:1}),Nt(a2,{modelValue:S.value,"onUpdate:modelValue":Be[2]||(Be[2]=Re=>S.value=Re),"transition-prev":"slide","transition-next":"slide",swipeable:"",animated:"","control-color":"white",navigation:"",padding:"",arrows:"",height:"35%",class:"bg-primary text-white shadow-1 rounded-borders"},{default:vn(()=>[(Yn(!0),Zr(Ki,null,Su(V.value,(Re,Ze)=>(Yn(),Qi(jy,{key:Ze,name:Ze,class:"column no-wrap flex-center","img-src":`/images/${Re}`},{default:vn(()=>[Nt(Ci,{class:"absolute-top-right rouded bg-primary q-ma-md",icon:"delete",style:{"z-index":"1"},onClick:Ye=>Ee(Re)},null,8,["onClick"])]),_:2},1032,["name","img-src"]))),128)),(Yn(!0),Zr(Ki,null,Su(w.value,(Re,Ze)=>(Yn(),Qi(jy,{key:Ze,name:Ze+V.value.length,class:"column no-wrap flex-center","img-src":Re},{default:vn(()=>[Nt(Ci,{class:"absolute-top-right rouded bg-primary q-ma-md",icon:"delete",style:{"z-index":"1"},onClick:Ye=>Me(Re)},null,8,["onClick"])]),_:2},1032,["name","img-src"]))),128))]),_:1},8,["modelValue"]),Nt($s,null,{default:vn(()=>[Nt(zB,{standout:"",modelValue:v.value,"onUpdate:modelValue":[Be[3]||(Be[3]=Re=>v.value=Re),Be[4]||(Be[4]=Re=>fe(Re))],label:"Standout",lable:"Upload Image"},null,8,["modelValue"]),Nt(em,{standout:"bg-primary text-white",modelValue:B.value,"onUpdate:modelValue":Be[5]||(Be[5]=Re=>B.value=Re),label:"Title"},null,8,["modelValue"]),Nt(em,{standout:"bg-primary text-white",modelValue:$.value,"onUpdate:modelValue":Be[6]||(Be[6]=Re=>$.value=Re),label:"description"},null,8,["modelValue"])]),_:1}),Nt($s,{class:"q-pt-none"},{default:vn(()=>[Nt(On(Vy),{style:{height:"200px"},ref:"mapboxMap","access-token":On(m),"map-style":"mapbox://styles/tobiwankirnobi/cle5t3xjp001b01o4s7negt5k",center:[ne.value.longitude,ne.value.latitude],zoom:10},{default:vn(()=>[Nt(On(Uy),{"lng-lat":[ne.value.longitude,ne.value.latitude],draggable:"",onMbDragend:Be[7]||(Be[7]=Re=>Ae(Re))},null,8,["lng-lat"])]),_:1},8,["access-token","center"])]),_:1}),Nt(oy,{class:"fixed-bottom q-pa-md",align:"around"},{default:vn(()=>[Nt(Ci,{class:"bg-primary text-white",square:"",rouded:"",icon:"close",onClick:Be[8]||(Be[8]=Re=>te())}),Nt(Ci,{class:"bg-primary text-white",square:"",rouded:"",icon:"done",onClick:Be[9]||(Be[9]=Re=>ce())})]),_:1})]),_:1})):xs("",!0)]),_:1},8,["modelValue"]),Nt(wm,{modelValue:k.value,"onUpdate:modelValue":Be[13]||(Be[13]=Re=>k.value=Re),persistent:""},{default:vn(()=>[Nt(Cd,{calss:"q-ma-md"},{default:vn(()=>[Nt($s,null,{default:vn(()=>[YB,yr("p",QB,[Cu("Titel: "),yr("span",JB,Gs(t.currentTag.title),1)]),Nt(em,{modelValue:I.value,"onUpdate:modelValue":Be[11]||(Be[11]=Re=>I.value=Re),label:"Gib den Namen des Tags ein um zu best\xE4tigen"},null,8,["modelValue"])]),_:1}),Nt(oy,{align:"center"},{default:vn(()=>[Xl(Nt(Ci,{class:"bg-primary text-white",icon:"close"},null,512),[[tm]]),Nt(Ci,{class:"bg-negative text-white",disable:I.value!==t.currentTag.title,icon:"delete",onClick:Be[12]||(Be[12]=Re=>Ie())},null,8,["disable"])]),_:1})]),_:1})]),_:1},8,["modelValue"])],64))}},p2=Vn({name:"QTh",props:{props:Object,autoWidth:Boolean},emits:["click"],setup(t,{slots:s,emit:u}){const f=Mn(),{proxy:{$q:m}}=f,v=w=>{u("click",w)};return()=>{if(t.props===void 0)return pe("th",{class:t.autoWidth===!0?"q-table--col-auto-width":"",onClick:v},bi(s.default));let w,o;const S=f.vnode.key;if(S){if(w=t.props.colsMap[S],w===void 0)return}else w=t.props.col;if(w.sortable===!0){const I=w.align==="right"?"unshift":"push";o=yv(s.default,[]),o[I](pe(Hr,{class:w.__iconClass,name:m.iconSet.table.arrowUp}))}else o=bi(s.default);const k={class:w.__thClass+(t.autoWidth===!0?" q-table--col-auto-width":""),style:w.headerStyle,onClick:I=>{w.sortable===!0&&t.props.sort(w),v(I)}};return pe("th",k,o)}}}),t3=Vn({name:"QTr",props:{props:Object,noHover:Boolean},setup(t,{slots:s}){const u=se(()=>"q-tr"+(t.props===void 0||t.props.header===!0?"":" "+t.props.__trClass)+(t.noHover===!0?" q-tr--no-hover":""));return()=>pe("tr",{class:u.value},bi(s.default))}}),n3={ratio:[String,Number]};function i3(t,s){return se(()=>{const u=Number(t.ratio||(s!==void 0?s.value:void 0));return isNaN(u)!==!0&&u>0?{paddingBottom:`${100/u}%`}:null})}const r3=16/9,o3=Vn({name:"QImg",props:{...n3,src:String,srcset:String,sizes:String,alt:String,crossorigin:String,decoding:String,referrerpolicy:String,draggable:Boolean,loading:{type:String,default:"lazy"},fetchpriority:{type:String,default:"auto"},width:String,height:String,initialRatio:{type:[Number,String],default:r3},placeholderSrc:String,fit:{type:String,default:"cover"},position:{type:String,default:"50% 50%"},imgClass:String,imgStyle:Object,noSpinner:Boolean,noNativeMenu:Boolean,noTransition:Boolean,spinnerColor:String,spinnerSize:String},emits:["load","error"],setup(t,{slots:s,emit:u}){const f=xt(t.initialRatio),m=i3(t,f);let v;const w=[xt(null),xt(t.placeholderSrc!==void 0?{src:t.placeholderSrc}:null)],o=xt(0),S=xt(!1),k=xt(!1),I=se(()=>`q-img q-img--${t.noNativeMenu===!0?"no-":""}menu`),D=se(()=>({width:t.width,height:t.height})),B=se(()=>`q-img__image ${t.imgClass!==void 0?t.imgClass+" ":""}q-img__image--with${t.noTransition===!0?"out":""}-transition`),V=se(()=>({...t.imgStyle,objectFit:t.fit,objectPosition:t.position}));Wt(()=>$(),ne);function $(){return t.src||t.srcset||t.sizes?{src:t.src,srcset:t.srcset,sizes:t.sizes}:null}function ne(Ee){if(clearTimeout(v),k.value=!1,Ee===null){S.value=!1,w[0].value=null,w[1].value=null;return}S.value=!0,w[o.value].value=Ee}function oe({target:Ee}){v!==null&&(clearTimeout(v),f.value=Ee.naturalHeight===0?.5:Ee.naturalWidth/Ee.naturalHeight,ye(Ee,1))}function ye(Ee,Me){v===null||Me===1e3||(Ee.complete===!0?te(Ee):v=setTimeout(()=>{ye(Ee,Me+1)},50))}function te(Ee){v!==null&&(o.value=o.value===1?0:1,w[o.value].value=null,S.value=!1,k.value=!1,u("load",Ee.currentSrc||Ee.src))}function Se(Ee){clearTimeout(v),S.value=!1,k.value=!0,w[0].value=null,w[1].value=null,u("error",Ee)}function Ae(Ee,Me){return pe("div",{class:"q-img__container absolute-full",key:Ee},Me)}function ce(Ee){const Me=w[Ee].value,Ie={key:"img_"+Ee,class:B.value,style:V.value,crossorigin:t.crossorigin,decoding:t.decoding,referrerpolicy:t.referrerpolicy,height:t.height,width:t.width,loading:t.loading,fetchpriority:t.fetchpriority,"aria-hidden":"true",draggable:t.draggable,...Me};return o.value===Ee?(Ie.class+=" q-img__image--waiting",Object.assign(Ie,{onLoad:oe,onError:Se})):Ie.class+=" q-img__image--loaded",Ae("img"+Ee,pe("img",Ie))}function fe(){return S.value!==!0?pe("div",{key:"content",class:"q-img__content absolute-full q-anchor--skip"},bi(s[k.value===!0?"error":"default"])):pe("div",{key:"loading",class:"q-img__loading absolute-full flex flex-center"},s.loading!==void 0?s.loading():t.noSpinner===!0?void 0:[pe(Gm,{color:t.spinnerColor,size:t.spinnerSize})])}return ne($()),Ii(()=>{clearTimeout(v),v=null}),()=>{const Ee=[];return m.value!==null&&Ee.push(pe("div",{key:"filler",style:m.value})),k.value!==!0&&(w[0].value!==null&&Ee.push(ce(0)),w[1].value!==null&&Ee.push(ce(1))),Ee.push(pe(Ys,{name:"q-transition--fade"},fe)),pe("div",{class:I.value,style:D.value,role:"img","aria-label":t.alt},Ee)}}}),s3=Vn({name:"QTd",props:{props:Object,autoWidth:Boolean,noHover:Boolean},setup(t,{slots:s}){const u=Mn(),f=se(()=>"q-td"+(t.autoWidth===!0?" q-table--col-auto-width":"")+(t.noHover===!0?" q-td--no-hover":"")+" ");return()=>{if(t.props===void 0)return pe("td",{class:f.value},bi(s.default));const m=u.vnode.key,v=(t.props.colsMap!==void 0?t.props.colsMap[m]:null)||t.props.col;if(v===void 0)return;const{row:w}=t.props;return pe("td",{class:f.value+v.__tdClass(w),style:v.__tdStyle(w)},bi(s.default))}}}),a3={true:"inset",item:"item-inset","item-thumbnail":"item-thumbnail-inset"},ly={xs:2,sm:4,md:8,lg:16,xl:24},m2=Vn({name:"QSeparator",props:{...no,spaced:[Boolean,String],inset:[Boolean,String],vertical:Boolean,color:String,size:String},setup(t){const s=Mn(),u=io(t,s.proxy.$q),f=se(()=>t.vertical===!0?"vertical":"horizontal"),m=se(()=>` q-separator--${f.value}`),v=se(()=>t.inset!==!1?`${m.value}-${a3[t.inset]}`:""),w=se(()=>`q-separator${m.value}${v.value}`+(t.color!==void 0?` bg-${t.color}`:"")+(u.value===!0?" q-separator--dark":"")),o=se(()=>{const S={};if(t.size!==void 0&&(S[t.vertical===!0?"width":"height"]=t.size),t.spaced!==!1){const k=t.spaced===!0?`${ly.md}px`:t.spaced in ly?`${ly[t.spaced]}px`:t.spaced,I=t.vertical===!0?["Left","Right"]:["Top","Bottom"];S[`margin${I[0]}`]=S[`margin${I[1]}`]=k}return S});return()=>pe("hr",{class:w.value,style:o.value,"aria-orientation":f.value})}}),l3=["horizontal","vertical","cell","none"],c3=Vn({name:"QMarkupTable",props:{...no,dense:Boolean,flat:Boolean,bordered:Boolean,square:Boolean,wrapCells:Boolean,separator:{type:String,default:"horizontal",validator:t=>l3.includes(t)}},setup(t,{slots:s}){const u=Mn(),f=io(t,u.proxy.$q),m=se(()=>`q-markup-table q-table__container q-table__card q-table--${t.separator}-separator`+(f.value===!0?" q-table--dark q-table__card--dark q-dark":"")+(t.dense===!0?" q-table--dense":"")+(t.flat===!0?" q-table--flat":"")+(t.bordered===!0?" q-table--bordered":"")+(t.square===!0?" q-table--square":"")+(t.wrapCells===!1?" q-table--no-wrap":""));return()=>pe("div",{class:m.value},[pe("table",{class:"q-table"},bi(s.default))])}});function g2(t,s){return pe("div",t,[pe("table",{class:"q-table"},s)])}let Em=!1;{const t=document.createElement("div");t.setAttribute("dir","rtl"),Object.assign(t.style,{width:"1px",height:"1px",overflow:"auto"});const s=document.createElement("div");Object.assign(s.style,{width:"1000px",height:"1px"}),document.body.appendChild(t),t.appendChild(s),t.scrollLeft=-1e3,Em=t.scrollLeft>=0,t.remove()}const Zo=1e3,u3=["start","center","end","start-force","center-force","end-force"],_2=Array.prototype.filter,h3=window.getComputedStyle(document.body).overflowAnchor===void 0?Es:function(t,s){t!==null&&(cancelAnimationFrame(t._qOverflowAnimationFrame),t._qOverflowAnimationFrame=requestAnimationFrame(()=>{if(t===null)return;const u=t.children||[];_2.call(u,m=>m.dataset&&m.dataset.qVsAnchor!==void 0).forEach(m=>{delete m.dataset.qVsAnchor});const f=u[s];f&&f.dataset&&(f.dataset.qVsAnchor="")}))};function wu(t,s){return t+s}function cy(t,s,u,f,m,v,w,o){const S=t===window?document.scrollingElement||document.documentElement:t,k=m===!0?"offsetWidth":"offsetHeight",I={scrollStart:0,scrollViewSize:-w-o,scrollMaxSize:0,offsetStart:-w,offsetEnd:-o};if(m===!0?(t===window?(I.scrollStart=window.pageXOffset||window.scrollX||document.body.scrollLeft||0,I.scrollViewSize+=document.documentElement.clientWidth):(I.scrollStart=S.scrollLeft,I.scrollViewSize+=S.clientWidth),I.scrollMaxSize=S.scrollWidth,v===!0&&(I.scrollStart=(Em===!0?I.scrollMaxSize-I.scrollViewSize:0)-I.scrollStart)):(t===window?(I.scrollStart=window.pageYOffset||window.scrollY||document.body.scrollTop||0,I.scrollViewSize+=document.documentElement.clientHeight):(I.scrollStart=S.scrollTop,I.scrollViewSize+=S.clientHeight),I.scrollMaxSize=S.scrollHeight),u!==null)for(let D=u.previousElementSibling;D!==null;D=D.previousElementSibling)D.classList.contains("q-virtual-scroll--skip")===!1&&(I.offsetStart+=D[k]);if(f!==null)for(let D=f.nextElementSibling;D!==null;D=D.nextElementSibling)D.classList.contains("q-virtual-scroll--skip")===!1&&(I.offsetEnd+=D[k]);if(s!==t){const D=S.getBoundingClientRect(),B=s.getBoundingClientRect();m===!0?(I.offsetStart+=B.left-D.left,I.offsetEnd-=B.width):(I.offsetStart+=B.top-D.top,I.offsetEnd-=B.height),t!==window&&(I.offsetStart+=I.scrollStart),I.offsetEnd+=I.scrollMaxSize-I.offsetStart}return I}function Bw(t,s,u,f){s==="end"&&(s=(t===window?document.body:t)[u===!0?"scrollWidth":"scrollHeight"]),t===window?u===!0?(f===!0&&(s=(Em===!0?document.body.scrollWidth-document.documentElement.clientWidth:0)-s),window.scrollTo(s,window.pageYOffset||window.scrollY||document.body.scrollTop||0)):window.scrollTo(window.pageXOffset||window.scrollX||document.body.scrollLeft||0,s):u===!0?(f===!0&&(s=(Em===!0?t.scrollWidth-t.offsetWidth:0)-s),t.scrollLeft=s):t.scrollTop=s}function md(t,s,u,f){if(u>=f)return 0;const m=s.length,v=Math.floor(u/Zo),w=Math.floor((f-1)/Zo)+1;let o=t.slice(v,w).reduce(wu,0);return u%Zo!==0&&(o-=s.slice(v*Zo,u).reduce(wu,0)),f%Zo!==0&&f!==m&&(o-=s.slice(f,w*Zo).reduce(wu,0)),o}const y2={virtualScrollSliceSize:{type:[Number,String],default:null},virtualScrollSliceRatioBefore:{type:[Number,String],default:1},virtualScrollSliceRatioAfter:{type:[Number,String],default:1},virtualScrollItemSize:{type:[Number,String],default:24},virtualScrollStickySizeStart:{type:[Number,String],default:0},virtualScrollStickySizeEnd:{type:[Number,String],default:0},tableColspan:[Number,String]},v2=Object.keys(y2),x2={virtualScrollHorizontal:Boolean,onVirtualScroll:Function,...y2};function b2({virtualScrollLength:t,getVirtualScrollTarget:s,getVirtualScrollEl:u,virtualScrollItemSizeComputed:f}){const m=Mn(),{props:v,emit:w,proxy:o}=m,{$q:S}=o;let k,I,D,B=[],V;const $=xt(0),ne=xt(0),oe=xt({}),ye=xt(null),te=xt(null),Se=xt(null),Ae=xt({from:0,to:0}),ce=se(()=>v.tableColspan!==void 0?v.tableColspan:100);f===void 0&&(f=se(()=>v.virtualScrollItemSize));const fe=se(()=>f.value+";"+v.virtualScrollHorizontal),Ee=se(()=>fe.value+";"+v.virtualScrollSliceRatioBefore+";"+v.virtualScrollSliceRatioAfter);Wt(Ee,()=>{Xt()}),Wt(fe,Me);function Me(){lt(I,!0)}function Ie(mt){lt(mt===void 0?I:mt)}function ke(mt,Bt){const qt=s();if(qt==null||qt.nodeType===8)return;const xn=cy(qt,u(),ye.value,te.value,v.virtualScrollHorizontal,S.lang.rtl,v.virtualScrollStickySizeStart,v.virtualScrollStickySizeEnd);D!==xn.scrollViewSize&&Xt(xn.scrollViewSize),Re(qt,xn,Math.min(t.value-1,Math.max(0,parseInt(mt,10)||0)),0,u3.indexOf(Bt)>-1?Bt:I>-1&&mt>I?"end":"start")}function Be(){const mt=s();if(mt==null||mt.nodeType===8)return;const Bt=cy(mt,u(),ye.value,te.value,v.virtualScrollHorizontal,S.lang.rtl,v.virtualScrollStickySizeStart,v.virtualScrollStickySizeEnd),qt=t.value-1,xn=Bt.scrollMaxSize-Bt.offsetStart-Bt.offsetEnd-ne.value;if(k===Bt.scrollStart)return;if(Bt.scrollMaxSize<=0){Re(mt,Bt,0,0);return}D!==Bt.scrollViewSize&&Xt(Bt.scrollViewSize),Ze(Ae.value.from);const rt=Math.floor(Bt.scrollMaxSize-Math.max(Bt.scrollViewSize,Bt.offsetEnd)-Math.min(V[qt],Bt.scrollViewSize/2));if(rt>0&&Math.ceil(Bt.scrollStart)>=rt){Re(mt,Bt,qt,Bt.scrollMaxSize-Bt.offsetEnd-B.reduce(wu,0));return}let gt=0,ot=Bt.scrollStart-Bt.offsetStart,_t=ot;if(ot<=xn&&ot+Bt.scrollViewSize>=$.value)ot-=$.value,gt=Ae.value.from,_t=ot;else for(let ft=0;ot>=B[ft]&&gt<qt;ft++)ot-=B[ft],gt+=Zo;for(;ot>0&&gt<qt;)ot-=V[gt],ot>-Bt.scrollViewSize?(gt++,_t=ot):_t=V[gt]+ot;Re(mt,Bt,gt,_t)}function Re(mt,Bt,qt,xn,rt){const gt=typeof rt=="string"&&rt.indexOf("-force")>-1,ot=gt===!0?rt.replace("-force",""):rt,_t=ot!==void 0?ot:"start";let ft=Math.max(0,qt-oe.value[_t]),sn=ft+oe.value.total;sn>t.value&&(sn=t.value,ft=Math.max(0,sn-oe.value.total)),k=Bt.scrollStart;const un=ft!==Ae.value.from||sn!==Ae.value.to;if(un===!1&&ot===void 0){At(qt);return}const{activeElement:re}=document,xe=Se.value;un===!0&&xe!==null&&xe!==re&&xe.contains(re)===!0&&(xe.addEventListener("focusout",Ye),setTimeout(()=>{xe!==null&&xe.removeEventListener("focusout",Ye)})),h3(xe,qt-ft);const Fe=ot!==void 0?V.slice(ft,qt).reduce(wu,0):0;if(un===!0){const nt=sn>=Ae.value.from&&ft<=Ae.value.to?Ae.value.to:sn;Ae.value={from:ft,to:nt},$.value=md(B,V,0,ft),ne.value=md(B,V,sn,t.value),requestAnimationFrame(()=>{Ae.value.to!==sn&&k===Bt.scrollStart&&(Ae.value={from:Ae.value.from,to:sn},ne.value=md(B,V,sn,t.value))})}requestAnimationFrame(()=>{if(k!==Bt.scrollStart)return;un===!0&&Ze(ft);const nt=V.slice(ft,qt).reduce(wu,0),yt=nt+Bt.offsetStart+$.value,zt=yt+V[qt];let Vt=yt+xn;if(ot!==void 0){const kt=nt-Fe,bt=Bt.scrollStart+kt;Vt=gt!==!0&&bt<yt&&zt<bt+Bt.scrollViewSize?bt:ot==="end"?zt-Bt.scrollViewSize:yt-(ot==="start"?0:Math.round((Bt.scrollViewSize-V[qt])/2))}k=Vt,Bw(mt,Vt,v.virtualScrollHorizontal,S.lang.rtl),At(qt)})}function Ze(mt){const Bt=Se.value;if(Bt){const qt=_2.call(Bt.children,ft=>ft.classList&&ft.classList.contains("q-virtual-scroll--skip")===!1),xn=qt.length,rt=v.virtualScrollHorizontal===!0?ft=>ft.getBoundingClientRect().width:ft=>ft.offsetHeight;let gt=mt,ot,_t;for(let ft=0;ft<xn;){for(ot=rt(qt[ft]),ft++;ft<xn&&qt[ft].classList.contains("q-virtual-scroll--with-prev")===!0;)ot+=rt(qt[ft]),ft++;_t=ot-V[gt],_t!==0&&(V[gt]+=_t,B[Math.floor(gt/Zo)]+=_t),gt++}}}function Ye(){Se.value!==null&&Se.value!==void 0&&Se.value.focus()}function lt(mt,Bt){const qt=1*f.value;(Bt===!0||Array.isArray(V)===!1)&&(V=[]);const xn=V.length;V.length=t.value;for(let gt=t.value-1;gt>=xn;gt--)V[gt]=qt;const rt=Math.floor((t.value-1)/Zo);B=[];for(let gt=0;gt<=rt;gt++){let ot=0;const _t=Math.min((gt+1)*Zo,t.value);for(let ft=gt*Zo;ft<_t;ft++)ot+=V[ft];B.push(ot)}I=-1,k=void 0,$.value=md(B,V,0,Ae.value.from),ne.value=md(B,V,Ae.value.to,t.value),mt>=0?(Ze(Ae.value.from),ui(()=>{ke(mt)})):tn()}function Xt(mt){if(mt===void 0&&typeof window<"u"){const ot=s();ot!=null&&ot.nodeType!==8&&(mt=cy(ot,u(),ye.value,te.value,v.virtualScrollHorizontal,S.lang.rtl,v.virtualScrollStickySizeStart,v.virtualScrollStickySizeEnd).scrollViewSize)}D=mt;const Bt=parseFloat(v.virtualScrollSliceRatioBefore)||0,qt=parseFloat(v.virtualScrollSliceRatioAfter)||0,xn=1+Bt+qt,rt=mt===void 0||mt<=0?1:Math.ceil(mt/f.value),gt=Math.max(1,rt,Math.ceil((v.virtualScrollSliceSize>0?v.virtualScrollSliceSize:10)/xn));oe.value={total:Math.ceil(gt*xn),start:Math.ceil(gt*Bt),center:Math.ceil(gt*(.5+Bt)),end:Math.ceil(gt*(1+Bt)),view:rt}}function Ge(mt,Bt){const qt=v.virtualScrollHorizontal===!0?"width":"height",xn={["--q-virtual-scroll-item-"+qt]:f.value+"px"};return[mt==="tbody"?pe(mt,{class:"q-virtual-scroll__padding",key:"before",ref:ye},[pe("tr",[pe("td",{style:{[qt]:`${$.value}px`,...xn},colspan:ce.value})])]):pe(mt,{class:"q-virtual-scroll__padding",key:"before",ref:ye,style:{[qt]:`${$.value}px`,...xn}}),pe(mt,{class:"q-virtual-scroll__content",key:"content",ref:Se,tabindex:-1},Bt.flat()),mt==="tbody"?pe(mt,{class:"q-virtual-scroll__padding",key:"after",ref:te},[pe("tr",[pe("td",{style:{[qt]:`${ne.value}px`,...xn},colspan:ce.value})])]):pe(mt,{class:"q-virtual-scroll__padding",key:"after",ref:te,style:{[qt]:`${ne.value}px`,...xn}})]}function At(mt){I!==mt&&(v.onVirtualScroll!==void 0&&w("virtual-scroll",{index:mt,from:Ae.value.from,to:Ae.value.to-1,direction:mt<I?"decrease":"increase",ref:o}),I=mt)}Xt();const tn=gv(Be,S.platform.is.ios===!0?120:35);Rm(()=>{Xt()});let Ve=!1;return Bu(()=>{Ve=!0}),zm(()=>{if(Ve!==!0)return;const mt=s();k!==void 0&&mt!==void 0&&mt!==null&&mt.nodeType!==8?Bw(mt,k,v.virtualScrollHorizontal,S.lang.rtl):ke(I)}),Ii(()=>{tn.cancel()}),Object.assign(o,{scrollTo:ke,reset:Me,refresh:Ie}),{virtualScrollSliceRange:Ae,virtualScrollSliceSizeComputed:oe,setVirtualScrollSize:Xt,onVirtualScrollEvt:tn,localResetVirtualScroll:lt,padVirtualScroll:Ge,scrollTo:ke,reset:Me,refresh:Ie}}const d3={list:ST,table:c3},f3=["list","table","__qtable"],p3=Vn({name:"QVirtualScroll",props:{...x2,type:{type:String,default:"list",validator:t=>f3.includes(t)},items:{type:Array,default:()=>[]},itemsFn:Function,itemsSize:Number,scrollTarget:{default:void 0}},setup(t,{slots:s,attrs:u}){let f;const m=xt(null),v=se(()=>t.itemsSize>=0&&t.itemsFn!==void 0?parseInt(t.itemsSize,10):Array.isArray(t.items)?t.items.length:0),{virtualScrollSliceRange:w,localResetVirtualScroll:o,padVirtualScroll:S,onVirtualScrollEvt:k}=b2({virtualScrollLength:v,getVirtualScrollTarget:$,getVirtualScrollEl:V}),I=se(()=>{if(v.value===0)return[];const te=(Se,Ae)=>({index:w.value.from+Ae,item:Se});return t.itemsFn===void 0?t.items.slice(w.value.from,w.value.to).map(te):t.itemsFn(w.value.from,w.value.to-w.value.from).map(te)}),D=se(()=>"q-virtual-scroll q-virtual-scroll"+(t.virtualScrollHorizontal===!0?"--horizontal":"--vertical")+(t.scrollTarget!==void 0?"":" scroll")),B=se(()=>t.scrollTarget!==void 0?{}:{tabindex:0});Wt(v,()=>{o()}),Wt(()=>t.scrollTarget,()=>{oe(),ne()});function V(){return m.value.$el||m.value}function $(){return f}function ne(){f=Cv(V(),t.scrollTarget),f.addEventListener("scroll",k,Xi.passive)}function oe(){f!==void 0&&(f.removeEventListener("scroll",k,Xi.passive),f=void 0)}function ye(){let te=S(t.type==="list"?"div":"tbody",I.value.map(s.default));return s.before!==void 0&&(te=s.before().concat(te)),Po(s.after,te)}return Rm(()=>{o()}),Ui(()=>{ne()}),zm(()=>{ne()}),Bu(()=>{oe()}),Ii(()=>{oe()}),()=>{if(s.default===void 0){console.error("QVirtualScroll: default scoped slot is required for rendering");return}return t.type==="__qtable"?g2({ref:m,class:"q-table__middle "+D.value},ye()):pe(d3[t.type],{...u,ref:m,class:[u.class,D.value],...B.value},ye)}}}),m3=Vn({name:"QField",inheritAttrs:!1,props:qd,emits:rg,setup(){return sg(og())}}),Fw=t=>["add","add-unique","toggle"].includes(t),g3=".*+?^${}()|[]\\",_3=Object.keys(qd),y3=Vn({name:"QSelect",inheritAttrs:!1,props:{...x2,...ag,...qd,modelValue:{required:!0},multiple:Boolean,displayValue:[String,Number],displayValueHtml:Boolean,dropdownIcon:String,options:{type:Array,default:()=>[]},optionValue:[Function,String],optionLabel:[Function,String],optionDisable:[Function,String],hideSelected:Boolean,hideDropdownIcon:Boolean,fillInput:Boolean,maxValues:[Number,String],optionsDense:Boolean,optionsDark:{type:Boolean,default:null},optionsSelectedClass:String,optionsHtml:Boolean,optionsCover:Boolean,menuShrink:Boolean,menuAnchor:String,menuSelf:String,menuOffset:Array,popupContentClass:String,popupContentStyle:[String,Array,Object],useInput:Boolean,useChips:Boolean,newValueMode:{type:String,validator:Fw},mapOptions:Boolean,emitValue:Boolean,inputDebounce:{type:[Number,String],default:500},inputClass:[Array,String,Object],inputStyle:[Array,String,Object],tabindex:{type:[String,Number],default:0},autocomplete:String,transitionShow:String,transitionHide:String,transitionDuration:[String,Number],behavior:{type:String,validator:t=>["default","menu","dialog"].includes(t),default:"default"},virtualScrollItemSize:{type:[Number,String],default:void 0},onNewValue:Function,onFilter:Function},emits:[...rg,"add","remove","input-value","new-value","keyup","keypress","keydown","filter-abort"],setup(t,{slots:s,emit:u}){const{proxy:f}=Mn(),{$q:m}=f,v=xt(!1),w=xt(!1),o=xt(-1),S=xt(""),k=xt(!1),I=xt(!1);let D,B,V,$,ne,oe,ye,te,Se;const Ae=xt(null),ce=xt(null),fe=xt(null),Ee=xt(null),Me=xt(null),Ie=qv(t),ke=h2(so),Be=se(()=>Array.isArray(t.options)?t.options.length:0),Re=se(()=>t.virtualScrollItemSize===void 0?t.optionsDense===!0?24:48:t.virtualScrollItemSize),{virtualScrollSliceRange:Ze,virtualScrollSliceSizeComputed:Ye,localResetVirtualScroll:lt,padVirtualScroll:Xt,onVirtualScrollEvt:Ge,scrollTo:At,setVirtualScrollSize:tn}=b2({virtualScrollLength:Be,getVirtualScrollTarget:fo,getVirtualScrollEl:Mr,virtualScrollItemSizeComputed:Re}),Ve=og(),mt=se(()=>{const me=t.mapOptions===!0&&t.multiple!==!0,Lt=t.modelValue!==void 0&&(t.modelValue!==null||me===!0)?t.multiple===!0&&Array.isArray(t.modelValue)?t.modelValue:[t.modelValue]:[];if(t.mapOptions===!0&&Array.isArray(t.options)===!0){const at=t.mapOptions===!0&&B!==void 0?B:[],Yt=Lt.map(yn=>Bi(yn,at));return t.modelValue===null&&me===!0?Yt.filter(yn=>yn!==null):Yt}return Lt}),Bt=se(()=>{const me={};return _3.forEach(Lt=>{const at=t[Lt];at!==void 0&&(me[Lt]=at)}),me}),qt=se(()=>t.optionsDark===null?Ve.isDark.value:t.optionsDark),xn=se(()=>nc(mt.value)),rt=se(()=>{let me="q-field__input q-placeholder col";return t.hideSelected===!0||mt.value.length===0?[me,t.inputClass]:(me+=" q-field__input--padding",t.inputClass===void 0?me:[me,t.inputClass])}),gt=se(()=>(t.virtualScrollHorizontal===!0?"q-virtual-scroll--horizontal":"")+(t.popupContentClass?" "+t.popupContentClass:"")),ot=se(()=>Be.value===0),_t=se(()=>mt.value.map(me=>bt.value(me)).join(", ")),ft=se(()=>t.optionsHtml===!0?()=>!0:me=>me!=null&&me.html===!0),sn=se(()=>t.displayValueHtml===!0||t.displayValue===void 0&&(t.optionsHtml===!0||mt.value.some(ft.value))),un=se(()=>Ve.focused.value===!0?t.tabindex:-1),re=se(()=>({tabindex:t.tabindex,role:"combobox","aria-label":t.label,"aria-readonly":t.readonly===!0?"true":"false","aria-autocomplete":t.useInput===!0?"list":"none","aria-expanded":v.value===!0?"true":"false","aria-owns":`${Ve.targetUid.value}_lb`,"aria-controls":`${Ve.targetUid.value}_lb`})),xe=se(()=>{const me={id:`${Ve.targetUid.value}_lb`,role:"listbox","aria-multiselectable":t.multiple===!0?"true":"false"};return o.value>=0&&(me["aria-activedescendant"]=`${Ve.targetUid.value}_${o.value}`),me}),Fe=se(()=>mt.value.map((me,Lt)=>({index:Lt,opt:me,html:ft.value(me),selected:!0,removeAtIndex:bn,toggleOption:Cn,tabindex:un.value}))),nt=se(()=>{if(Be.value===0)return[];const{from:me,to:Lt}=Ze.value;return t.options.slice(me,Lt).map((at,Yt)=>{const yn=Mt.value(at)===!0,Bn=me+Yt,ai={clickable:!0,active:!1,activeClass:Vt.value,manualFocus:!0,focused:!1,disable:yn,tabindex:-1,dense:t.optionsDense,dark:qt.value,role:"option",id:`${Ve.targetUid.value}_${Bn}`,onClick:()=>{Cn(at)}};return yn!==!0&&(ji(at)===!0&&(ai.active=!0),o.value===Bn&&(ai.focused=!0),ai["aria-selected"]=ai.active===!0?"true":"false",m.platform.is.desktop===!0&&(ai.onMousemove=()=>{v.value===!0&&jn(Bn)})),{index:Bn,opt:at,html:ft.value(at),label:bt.value(at),selected:ai.active,focused:ai.focused,toggleOption:Cn,setOptionIndex:jn,itemProps:ai}})}),yt=se(()=>t.dropdownIcon!==void 0?t.dropdownIcon:m.iconSet.arrow.dropdown),zt=se(()=>t.optionsCover===!1&&t.outlined!==!0&&t.standout!==!0&&t.borderless!==!0&&t.rounded!==!0),Vt=se(()=>t.optionsSelectedClass!==void 0?t.optionsSelectedClass:t.color!==void 0?`text-${t.color}`:""),kt=se(()=>qi(t.optionValue,"value")),bt=se(()=>qi(t.optionLabel,"label")),Mt=se(()=>qi(t.optionDisable,"disable")),Ht=se(()=>mt.value.map(me=>kt.value(me))),et=se(()=>{const me={onInput:so,onChange:ke,onKeydown:Ar,onKeyup:$i,onKeypress:hr,onFocus:tr,onClick(Lt){V===!0&&to(Lt)}};return me.onCompositionstart=me.onCompositionupdate=me.onCompositionend=ke,me});Wt(mt,me=>{B=me,t.useInput===!0&&t.fillInput===!0&&t.multiple!==!0&&Ve.innerLoading.value!==!0&&(w.value!==!0&&v.value!==!0||xn.value!==!0)&&($!==!0&&ht(),(w.value===!0||v.value===!0)&&hn(""))},{immediate:!0}),Wt(()=>t.fillInput,ht),Wt(v,Ft),Wt(Be,wt);function Rt(me){return t.emitValue===!0?kt.value(me):me}function nn(me){if(me>-1&&me<mt.value.length)if(t.multiple===!0){const Lt=t.modelValue.slice();u("remove",{index:me,value:Lt.splice(me,1)[0]}),u("update:modelValue",Lt)}else u("update:modelValue",null)}function bn(me){nn(me),Ve.focus()}function zn(me,Lt){const at=Rt(me);if(t.multiple!==!0){t.fillInput===!0&&Kt(bt.value(me),!0,!0),u("update:modelValue",at);return}if(mt.value.length===0){u("add",{index:0,value:at}),u("update:modelValue",t.multiple===!0?[at]:at);return}if(Lt===!0&&ji(me)===!0||t.maxValues!==void 0&&t.modelValue.length>=t.maxValues)return;const Yt=t.modelValue.slice();u("add",{index:Yt.length,value:at}),Yt.push(at),u("update:modelValue",Yt)}function Cn(me,Lt){if(Ve.editable.value!==!0||me===void 0||Mt.value(me)===!0)return;const at=kt.value(me);if(t.multiple!==!0){Lt!==!0&&(Kt(t.fillInput===!0?bt.value(me):"",!0,!0),Ne()),ce.value!==null&&ce.value.focus(),(mt.value.length===0||Fa(kt.value(mt.value[0]),at)!==!0)&&u("update:modelValue",t.emitValue===!0?at:me);return}if((V!==!0||k.value===!0)&&Ve.focus(),tr(),mt.value.length===0){const Bn=t.emitValue===!0?at:me;u("add",{index:0,value:Bn}),u("update:modelValue",t.multiple===!0?[Bn]:Bn);return}const Yt=t.modelValue.slice(),yn=Ht.value.findIndex(Bn=>Fa(Bn,at));if(yn>-1)u("remove",{index:yn,value:Yt.splice(yn,1)[0]});else{if(t.maxValues!==void 0&&Yt.length>=t.maxValues)return;const Bn=t.emitValue===!0?at:me;u("add",{index:Yt.length,value:Bn}),Yt.push(Bn)}u("update:modelValue",Yt)}function jn(me){if(m.platform.is.desktop!==!0)return;const Lt=me>-1&&me<Be.value?me:-1;o.value!==Lt&&(o.value=Lt)}function Wn(me=1,Lt){if(v.value===!0){let at=o.value;do at=z1(at+me,-1,Be.value-1);while(at!==-1&&at!==o.value&&Mt.value(t.options[at])===!0);o.value!==at&&(jn(at),At(at),Lt!==!0&&t.useInput===!0&&t.fillInput===!0&&ct(at>=0?bt.value(t.options[at]):oe))}}function Bi(me,Lt){const at=Yt=>Fa(kt.value(Yt),me);return t.options.find(at)||Lt.find(at)||me}function qi(me,Lt){const at=me!==void 0?me:Lt;return typeof at=="function"?at:Yt=>Yt!==null&&typeof Yt=="object"&&at in Yt?Yt[at]:Yt}function ji(me){const Lt=kt.value(me);return Ht.value.find(at=>Fa(at,Lt))!==void 0}function tr(me){t.useInput===!0&&ce.value!==null&&(me===void 0||ce.value===me.target&&me.target.value===_t.value)&&ce.value.select()}function Ei(me){$a(me,27)===!0&&v.value===!0&&(to(me),Ne(),ht()),u("keyup",me)}function $i(me){const{value:Lt}=me.target;if(me.keyCode!==void 0){Ei(me);return}if(me.target.value="",clearTimeout(D),ht(),typeof Lt=="string"&&Lt.length>0){const at=Lt.toLocaleLowerCase(),Yt=Bn=>{const ai=t.options.find(mi=>Bn.value(mi).toLocaleLowerCase()===at);return ai===void 0?!1:(mt.value.indexOf(ai)===-1?Cn(ai):Ne(),!0)},yn=Bn=>{Yt(kt)!==!0&&(Yt(bt)===!0||Bn===!0||hn(Lt,!0,()=>yn(!0)))};yn()}else Ve.clearValue(me)}function hr(me){u("keypress",me)}function Ar(me){if(u("keydown",me),_v(me)===!0)return;const Lt=S.value.length>0&&(t.newValueMode!==void 0||t.onNewValue!==void 0),at=me.shiftKey!==!0&&t.multiple!==!0&&(o.value>-1||Lt===!0);if(me.keyCode===27){Fr(me);return}if(me.keyCode===9&&at===!1){ze();return}if(me.target===void 0||me.target.id!==Ve.targetUid.value)return;if(me.keyCode===40&&Ve.innerLoading.value!==!0&&v.value===!1){zi(me),Ce();return}if(me.keyCode===8&&t.hideSelected!==!0&&S.value.length===0){t.multiple===!0&&Array.isArray(t.modelValue)===!0?nn(t.modelValue.length-1):t.multiple!==!0&&t.modelValue!==null&&u("update:modelValue",null);return}(me.keyCode===35||me.keyCode===36)&&(typeof S.value!="string"||S.value.length===0)&&(zi(me),o.value=-1,Wn(me.keyCode===36?1:-1,t.multiple)),(me.keyCode===33||me.keyCode===34)&&Ye.value!==void 0&&(zi(me),o.value=Math.max(-1,Math.min(Be.value,o.value+(me.keyCode===33?-1:1)*Ye.value.view)),Wn(me.keyCode===33?1:-1,t.multiple)),(me.keyCode===38||me.keyCode===40)&&(zi(me),Wn(me.keyCode===38?-1:1,t.multiple));const Yt=Be.value;if((te===void 0||Se<Date.now())&&(te=""),Yt>0&&t.useInput!==!0&&me.key!==void 0&&me.key.length===1&&me.altKey===me.ctrlKey&&(me.keyCode!==32||te.length>0)){v.value!==!0&&Ce(me);const yn=me.key.toLocaleLowerCase(),Bn=te.length===1&&te[0]===yn;Se=Date.now()+1500,Bn===!1&&(zi(me),te+=yn);const ai=new RegExp("^"+te.split("").map(tt=>g3.indexOf(tt)>-1?"\\"+tt:tt).join(".*"),"i");let mi=o.value;if(Bn===!0||mi<0||ai.test(bt.value(t.options[mi]))!==!0)do mi=z1(mi+1,-1,Yt-1);while(mi!==o.value&&(Mt.value(t.options[mi])===!0||ai.test(bt.value(t.options[mi]))!==!0));o.value!==mi&&ui(()=>{jn(mi),At(mi),mi>=0&&t.useInput===!0&&t.fillInput===!0&&ct(bt.value(t.options[mi]))});return}if(!(me.keyCode!==13&&(me.keyCode!==32||t.useInput===!0||te!=="")&&(me.keyCode!==9||at===!1))){if(me.keyCode!==9&&zi(me),o.value>-1&&o.value<Yt){Cn(t.options[o.value]);return}if(Lt===!0){const yn=(Bn,ai)=>{if(ai){if(Fw(ai)!==!0)return}else ai=t.newValueMode;if(Bn==null)return;Kt("",t.multiple!==!0,!0),(ai==="toggle"?Cn:zn)(Bn,ai==="add-unique"),t.multiple!==!0&&(ce.value!==null&&ce.value.focus(),Ne())};if(t.onNewValue!==void 0?u("new-value",S.value,yn):yn(S.value),t.multiple!==!0)return}v.value===!0?ze():Ve.innerLoading.value!==!0&&Ce()}}function Mr(){return V===!0?Me.value:fe.value!==null&&fe.value.__qPortalInnerRef.value!==null?fe.value.__qPortalInnerRef.value:void 0}function fo(){return Mr()}function xr(){return t.hideSelected===!0?[]:s["selected-item"]!==void 0?Fe.value.map(me=>s["selected-item"](me)).slice():s.selected!==void 0?[].concat(s.selected()):t.useChips===!0?Fe.value.map((me,Lt)=>pe(l2,{key:"option-"+Lt,removable:Ve.editable.value===!0&&Mt.value(me.opt)!==!0,dense:!0,textColor:t.color,tabindex:un.value,onRemove(){me.removeAtIndex(Lt)}},()=>pe("span",{class:"ellipsis",[me.html===!0?"innerHTML":"textContent"]:bt.value(me.opt)}))):[pe("span",{[sn.value===!0?"innerHTML":"textContent"]:t.displayValue!==void 0?t.displayValue:_t.value})]}function oo(){if(ot.value===!0)return s["no-option"]!==void 0?s["no-option"]({inputValue:S.value}):void 0;const me=s.option!==void 0?s.option:at=>pe($T,{key:at.index,...at.itemProps},()=>pe(Hp,()=>pe(jT,()=>pe("span",{[at.html===!0?"innerHTML":"textContent"]:at.label}))));let Lt=Xt("div",nt.value.map(me));return s["before-options"]!==void 0&&(Lt=s["before-options"]().concat(Lt)),Po(s["after-options"],Lt)}function Jo(me,Lt){const at=Lt===!0?{...re.value,...Ve.splitAttrs.attributes.value}:void 0,Yt={ref:Lt===!0?ce:void 0,key:"i_t",class:rt.value,style:t.inputStyle,value:S.value!==void 0?S.value:"",type:"search",...at,id:Lt===!0?Ve.targetUid.value:void 0,maxlength:t.maxlength,autocomplete:t.autocomplete,"data-autofocus":me!==!0&&t.autofocus===!0||void 0,disabled:t.disable===!0,readonly:t.readonly===!0,...et.value};return me!==!0&&V===!0&&(Array.isArray(Yt.class)===!0?Yt.class=[...Yt.class,"no-pointer-events"]:Yt.class+=" no-pointer-events"),pe("input",Yt)}function so(me){clearTimeout(D),!(me&&me.target&&me.target.qComposing===!0)&&(ct(me.target.value||""),$=!0,oe=S.value,Ve.focused.value!==!0&&(V!==!0||k.value===!0)&&Ve.focus(),t.onFilter!==void 0&&(D=setTimeout(()=>{hn(S.value)},t.inputDebounce)))}function ct(me){S.value!==me&&(S.value=me,u("input-value",me))}function Kt(me,Lt,at){$=at!==!0,t.useInput===!0&&(ct(me),(Lt===!0||at!==!0)&&(oe=me),Lt!==!0&&hn(me))}function hn(me,Lt,at){if(t.onFilter===void 0||Lt!==!0&&Ve.focused.value!==!0)return;Ve.innerLoading.value===!0?u("filter-abort"):(Ve.innerLoading.value=!0,I.value=!0),me!==""&&t.multiple!==!0&&mt.value.length>0&&$!==!0&&me===bt.value(mt.value[0])&&(me="");const Yt=setTimeout(()=>{v.value===!0&&(v.value=!1)},10);clearTimeout(ne),ne=Yt,u("filter",me,(yn,Bn)=>{(Lt===!0||Ve.focused.value===!0)&&ne===Yt&&(clearTimeout(ne),typeof yn=="function"&&yn(),I.value=!1,ui(()=>{Ve.innerLoading.value=!1,Ve.editable.value===!0&&(Lt===!0?v.value===!0&&Ne():v.value===!0?Ft(!0):v.value=!0),typeof Bn=="function"&&ui(()=>{Bn(f)}),typeof at=="function"&&ui(()=>{at(f)})}))},()=>{Ve.focused.value===!0&&ne===Yt&&(clearTimeout(ne),Ve.innerLoading.value=!1,I.value=!1),v.value===!0&&(v.value=!1)})}function En(){return pe(FT,{ref:fe,class:gt.value,style:t.popupContentStyle,modelValue:v.value,fit:t.menuShrink!==!0,cover:t.optionsCover===!0&&ot.value!==!0&&t.useInput!==!0,anchor:t.menuAnchor,self:t.menuSelf,offset:t.menuOffset,dark:qt.value,noParentEvent:!0,noRefocus:!0,noFocus:!0,square:zt.value,transitionShow:t.transitionShow,transitionHide:t.transitionHide,transitionDuration:t.transitionDuration,separateClosePopup:!0,...xe.value,onScrollPassive:Ge,onBeforeShow:on,onBeforeHide:In,onShow:X},oo)}function In(me){rn(me),ze()}function X(){tn()}function N(me){to(me),ce.value!==null&&ce.value.focus(),k.value=!0,window.scrollTo(window.pageXOffset||window.scrollX||document.body.scrollLeft||0,0)}function j(me){to(me),ui(()=>{k.value=!1})}function Y(){const me=[pe(m3,{class:`col-auto ${Ve.fieldClass.value}`,...Bt.value,for:Ve.targetUid.value,dark:qt.value,square:!0,loading:I.value,itemAligned:!1,filled:!0,stackLabel:S.value.length>0,...Ve.splitAttrs.listeners.value,onFocus:N,onBlur:j},{...s,rawControl:()=>Ve.getControl(!0),before:void 0,after:void 0})];return v.value===!0&&me.push(pe("div",{ref:Me,class:gt.value+" scroll",style:t.popupContentStyle,...xe.value,onClick:Fr,onScrollPassive:Ge},oo())),pe(wm,{ref:Ee,modelValue:w.value,position:t.useInput===!0?"top":void 0,transitionShow:ye,transitionHide:t.transitionHide,transitionDuration:t.transitionDuration,onBeforeShow:on,onBeforeHide:ue,onHide:Te,onShow:Oe},()=>pe("div",{class:"q-select__dialog"+(qt.value===!0?" q-select__dialog--dark q-dark":"")+(k.value===!0?" q-select__dialog--focused":"")},me))}function ue(me){rn(me),Ee.value!==null&&Ee.value.__updateRefocusTarget(Ve.rootRef.value.querySelector(".q-field__native > [tabindex]:last-child")),Ve.focused.value=!1}function Te(me){Ne(),Ve.focused.value===!1&&u("blur",me),ht()}function Oe(){const me=document.activeElement;(me===null||me.id!==Ve.targetUid.value)&&ce.value!==null&&ce.value!==me&&ce.value.focus(),tn()}function ze(){w.value!==!0&&(o.value=-1,v.value===!0&&(v.value=!1),Ve.focused.value===!1&&(clearTimeout(ne),ne=void 0,Ve.innerLoading.value===!0&&(u("filter-abort"),Ve.innerLoading.value=!1,I.value=!1)))}function Ce(me){Ve.editable.value===!0&&(V===!0?(Ve.onControlFocusin(me),w.value=!0,ui(()=>{Ve.focus()})):Ve.focus(),t.onFilter!==void 0?hn(S.value):(ot.value!==!0||s["no-option"]!==void 0)&&(v.value=!0))}function Ne(){w.value=!1,ze()}function ht(){t.useInput===!0&&Kt(t.multiple!==!0&&t.fillInput===!0&&mt.value.length>0&&bt.value(mt.value[0])||"",!0,!0)}function Ft(me){let Lt=-1;if(me===!0){if(mt.value.length>0){const at=kt.value(mt.value[0]);Lt=t.options.findIndex(Yt=>Fa(kt.value(Yt),at))}lt(Lt)}jn(Lt)}function wt(me,Lt){v.value===!0&&Ve.innerLoading.value===!1&&(lt(-1,!0),ui(()=>{v.value===!0&&Ve.innerLoading.value===!1&&(me>Lt?lt():Ft(!0))}))}function an(){w.value===!1&&fe.value!==null&&fe.value.updatePosition()}function on(me){me!==void 0&&to(me),u("popup-show",me),Ve.hasPopupOpen=!0,Ve.onControlFocusin(me)}function rn(me){me!==void 0&&to(me),u("popup-hide",me),Ve.hasPopupOpen=!1,Ve.onControlFocusout(me)}function fn(){V=m.platform.is.mobile!==!0&&t.behavior!=="dialog"?!1:t.behavior!=="menu"&&(t.useInput===!0?s["no-option"]!==void 0||t.onFilter!==void 0||ot.value===!1:!0),ye=m.platform.is.ios===!0&&V===!0&&t.useInput===!0?"fade":t.transitionShow}return Dm(fn),Om(an),fn(),Ii(()=>{clearTimeout(D)}),Object.assign(f,{showPopup:Ce,hidePopup:Ne,removeAtIndex:nn,add:zn,toggleOption:Cn,getOptionIndex:()=>o.value,setOptionIndex:jn,moveOptionSelection:Wn,filter:hn,updateMenuPosition:an,updateInputValue:Kt,isOptionSelected:ji,getEmittingOptionValue:Rt,isOptionDisabled:(...me)=>Mt.value.apply(null,me)===!0,getOptionValue:(...me)=>kt.value.apply(null,me),getOptionLabel:(...me)=>bt.value.apply(null,me)}),Object.assign(Ve,{innerValue:mt,fieldClass:se(()=>`q-select q-field--auto-height q-select--with${t.useInput!==!0?"out":""}-input q-select--with${t.useChips!==!0?"out":""}-chips q-select--${t.multiple===!0?"multiple":"single"}`),inputRef:Ae,targetRef:ce,hasValue:xn,showPopup:Ce,floatingLabel:se(()=>t.hideSelected!==!0&&xn.value===!0||typeof S.value=="number"||S.value.length>0||nc(t.displayValue)),getControlChild:()=>{if(Ve.editable.value!==!1&&(w.value===!0||ot.value!==!0||s["no-option"]!==void 0))return V===!0?Y():En();Ve.hasPopupOpen===!0&&(Ve.hasPopupOpen=!1)},controlEvents:{onFocusin(me){Ve.onControlFocusin(me)},onFocusout(me){Ve.onControlFocusout(me,()=>{ht(),ze()})},onClick(me){if(Fr(me),V!==!0&&v.value===!0){ze(),ce.value!==null&&ce.value.focus();return}Ce(me)}},getControl:me=>{const Lt=xr(),at=me===!0||w.value!==!0||V!==!0;if(t.useInput===!0)Lt.push(Jo(me,at));else if(Ve.editable.value===!0){const yn=at===!0?re.value:void 0;Lt.push(pe("input",{ref:at===!0?ce:void 0,key:"d_t",class:"q-select__focus-target",id:at===!0?Ve.targetUid.value:void 0,readonly:!0,"data-autofocus":me!==!0&&t.autofocus===!0||void 0,...yn,onKeydown:Ar,onKeyup:Ei,onKeypress:hr})),at===!0&&typeof t.autocomplete=="string"&&t.autocomplete.length>0&&Lt.push(pe("input",{class:"q-select__autocomplete-input",autocomplete:t.autocomplete,tabindex:-1,onKeyup:$i}))}if(Ie.value!==void 0&&t.disable!==!0&&Ht.value.length>0){const yn=Ht.value.map(Bn=>pe("option",{value:Bn,selected:!0}));Lt.push(pe("select",{class:"hidden",name:Ie.value,multiple:t.multiple},yn))}const Yt=t.useInput===!0||at!==!0?void 0:Ve.splitAttrs.attributes.value;return pe("div",{class:"q-field__native row items-center",...Yt},Lt)},getInnerAppend:()=>t.loading!==!0&&I.value!==!0&&t.hideDropdownIcon!==!0?[pe(Hr,{class:"q-select__dropdown-icon"+(v.value===!0?" rotate-180":""),name:yt.value})]:null}),sg(Ve)}}),v3={xs:2,sm:4,md:6,lg:10,xl:14};function Nw(t,s,u){return{transform:s===!0?`translateX(${u.lang.rtl===!0?"-":""}100%) scale3d(${-t},1,1)`:`scale3d(${t},1,1)`}}const x3=Vn({name:"QLinearProgress",props:{...no,...Fu,value:{type:Number,default:0},buffer:Number,color:String,trackColor:String,reverse:Boolean,stripe:Boolean,indeterminate:Boolean,query:Boolean,rounded:Boolean,animationSpeed:{type:[String,Number],default:2100},instantFeedback:Boolean},setup(t,{slots:s}){const{proxy:u}=Mn(),f=io(t,u.$q),m=Nu(t,v3),v=se(()=>t.indeterminate===!0||t.query===!0),w=se(()=>t.reverse!==t.query),o=se(()=>({...m.value!==null?m.value:{},"--q-linear-progress-speed":`${t.animationSpeed}ms`})),S=se(()=>"q-linear-progress"+(t.color!==void 0?` text-${t.color}`:"")+(t.reverse===!0||t.query===!0?" q-linear-progress--reverse":"")+(t.rounded===!0?" rounded-borders":"")),k=se(()=>Nw(t.buffer!==void 0?t.buffer:1,w.value,u.$q)),I=se(()=>`q-linear-progress__track absolute-full q-linear-progress__track--with${t.instantFeedback===!0?"out":""}-transition q-linear-progress__track--${f.value===!0?"dark":"light"}`+(t.trackColor!==void 0?` bg-${t.trackColor}`:"")),D=se(()=>Nw(v.value===!0?1:t.value,w.value,u.$q)),B=se(()=>`q-linear-progress__model absolute-full q-linear-progress__model--with${t.instantFeedback===!0?"out":""}-transition q-linear-progress__model--${v.value===!0?"in":""}determinate`),V=se(()=>({width:`${t.value*100}%`})),$=se(()=>`q-linear-progress__stripe absolute-${t.reverse===!0?"right":"left"}`);return()=>{const ne=[pe("div",{class:I.value,style:k.value}),pe("div",{class:B.value,style:D.value})];return t.stripe===!0&&v.value===!1&&ne.push(pe("div",{class:$.value,style:V.value})),pe("div",{class:S.value,style:o.value,role:"progressbar","aria-valuemin":0,"aria-valuemax":1,"aria-valuenow":t.indeterminate===!0?void 0:t.value},Po(s.default,ne))}}});function b3(t,s){const u=xt(null),f=se(()=>t.disable===!0?null:pe("span",{ref:u,class:"no-outline",tabindex:-1}));function m(v){const w=s.value;v!==void 0&&v.type.indexOf("key")===0?w!==null&&document.activeElement!==w&&w.contains(document.activeElement)===!0&&w.focus():u.value!==null&&(v===void 0||w!==null&&w.contains(v.target)===!0)&&u.value.focus()}return{refocusTargetEl:f,refocusTarget:m}}const w3={xs:30,sm:35,md:40,lg:50,xl:60},E3={...no,...Fu,...ag,modelValue:{required:!0,default:null},val:{},trueValue:{default:!0},falseValue:{default:!1},indeterminateValue:{default:null},checkedIcon:String,uncheckedIcon:String,indeterminateIcon:String,toggleOrder:{type:String,validator:t=>t==="tf"||t==="ft"},toggleIndeterminate:Boolean,label:String,leftLabel:Boolean,color:String,keepColor:Boolean,dense:Boolean,disable:Boolean,tabindex:[String,Number]},T3=["update:modelValue"];function S3(t,s){const{props:u,slots:f,emit:m,proxy:v}=Mn(),{$q:w}=v,o=io(u,w),S=xt(null),{refocusTargetEl:k,refocusTarget:I}=b3(u,S),D=Nu(u,w3),B=se(()=>u.val!==void 0&&Array.isArray(u.modelValue)),V=se(()=>{const Re=Un(u.val);return B.value===!0?u.modelValue.findIndex(Ze=>Un(Ze)===Re):-1}),$=se(()=>B.value===!0?V.value>-1:Un(u.modelValue)===Un(u.trueValue)),ne=se(()=>B.value===!0?V.value===-1:Un(u.modelValue)===Un(u.falseValue)),oe=se(()=>$.value===!1&&ne.value===!1),ye=se(()=>u.disable===!0?-1:u.tabindex||0),te=se(()=>`q-${t} cursor-pointer no-outline row inline no-wrap items-center`+(u.disable===!0?" disabled":"")+(o.value===!0?` q-${t}--dark`:"")+(u.dense===!0?` q-${t}--dense`:"")+(u.leftLabel===!0?" reverse":"")),Se=se(()=>{const Re=$.value===!0?"truthy":ne.value===!0?"falsy":"indet",Ze=u.color!==void 0&&(u.keepColor===!0||(t==="toggle"?$.value===!0:ne.value!==!0))?` text-${u.color}`:"";return`q-${t}__inner relative-position non-selectable q-${t}__inner--${Re}${Ze}`}),Ae=se(()=>{const Re={type:"checkbox"};return u.name!==void 0&&Object.assign(Re,{"^checked":$.value===!0?"checked":void 0,name:u.name,value:B.value===!0?u.val:u.trueValue}),Re}),ce=MB(Ae),fe=se(()=>{const Re={tabindex:ye.value,role:t==="toggle"?"switch":"checkbox","aria-label":u.label,"aria-checked":oe.value===!0?"mixed":$.value===!0?"true":"false"};return u.disable===!0&&(Re["aria-disabled"]="true"),Re});function Ee(Re){Re!==void 0&&(zi(Re),I(Re)),u.disable!==!0&&m("update:modelValue",Me(),Re)}function Me(){if(B.value===!0){if($.value===!0){const Re=u.modelValue.slice();return Re.splice(V.value,1),Re}return u.modelValue.concat([u.val])}if($.value===!0){if(u.toggleOrder!=="ft"||u.toggleIndeterminate===!1)return u.falseValue}else if(ne.value===!0){if(u.toggleOrder==="ft"||u.toggleIndeterminate===!1)return u.trueValue}else return u.toggleOrder!=="ft"?u.trueValue:u.falseValue;return u.indeterminateValue}function Ie(Re){(Re.keyCode===13||Re.keyCode===32)&&zi(Re)}function ke(Re){(Re.keyCode===13||Re.keyCode===32)&&Ee(Re)}const Be=s($,oe);return Object.assign(v,{toggle:Ee}),()=>{const Re=Be();u.disable!==!0&&ce(Re,"unshift",` q-${t}__native absolute q-ma-none q-pa-none`);const Ze=[pe("div",{class:Se.value,style:D.value,"aria-hidden":"true"},Re)];k.value!==null&&Ze.push(k.value);const Ye=u.label!==void 0?Po(f.default,[u.label]):bi(f.default);return Ye!==void 0&&Ze.push(pe("div",{class:`q-${t}__label q-anchor--skip`},Ye)),pe("div",{ref:S,class:te.value,...fe.value,onClick:Ee,onKeydown:Ie,onKeyup:ke},Ze)}}const C3=pe("div",{key:"svg",class:"q-checkbox__bg absolute"},[pe("svg",{class:"q-checkbox__svg fit absolute-full",viewBox:"0 0 24 24"},[pe("path",{class:"q-checkbox__truthy",fill:"none",d:"M1.73,12.91 8.1,19.28 22.79,4.59"}),pe("path",{class:"q-checkbox__indet",d:"M4,14H20V10H4"})])]),uy=Vn({name:"QCheckbox",props:E3,emits:T3,setup(t){function s(u,f){const m=se(()=>(u.value===!0?t.checkedIcon:f.value===!0?t.indeterminateIcon:t.uncheckedIcon)||null);return()=>m.value!==null?[pe("div",{key:"icon",class:"q-checkbox__icon-container absolute-full flex flex-center no-wrap"},[pe(Hr,{class:"q-checkbox__icon",name:m.value})])]:[C3]}return S3("checkbox",s)}});function A3(t,s){return new Date(t)-new Date(s)}const M3={sortMethod:Function,binaryStateSort:Boolean,columnSortOrder:{type:String,validator:t=>t==="ad"||t==="da",default:"ad"}};function I3(t,s,u,f){const m=se(()=>{const{sortBy:o}=s.value;return o&&u.value.find(S=>S.name===o)||null}),v=se(()=>t.sortMethod!==void 0?t.sortMethod:(o,S,k)=>{const I=u.value.find(V=>V.name===S);if(I===void 0||I.field===void 0)return o;const D=k===!0?-1:1,B=typeof I.field=="function"?V=>I.field(V):V=>V[I.field];return o.sort((V,$)=>{let ne=B(V),oe=B($);return ne==null?-1*D:oe==null?1*D:I.sort!==void 0?I.sort(ne,oe,V,$)*D:um(ne)===!0&&um(oe)===!0?(ne-oe)*D:o1(ne)===!0&&o1(oe)===!0?A3(ne,oe)*D:typeof ne=="boolean"&&typeof oe=="boolean"?(ne-oe)*D:([ne,oe]=[ne,oe].map(ye=>(ye+"").toLocaleString().toLowerCase()),ne<oe?-1*D:ne===oe?0:D)})});function w(o){let S=t.columnSortOrder;if(Mu(o)===!0)o.sortOrder&&(S=o.sortOrder),o=o.name;else{const D=u.value.find(B=>B.name===o);D!==void 0&&D.sortOrder&&(S=D.sortOrder)}let{sortBy:k,descending:I}=s.value;k!==o?(k=o,I=S==="da"):t.binaryStateSort===!0?I=!I:I===!0?S==="ad"?k=null:I=!1:S==="ad"?I=!0:k=null,f({sortBy:k,descending:I,page:1})}return{columnToSort:m,computedSortMethod:v,sort:w}}const k3={filter:[String,Object],filterMethod:Function};function P3(t,s){const u=se(()=>t.filterMethod!==void 0?t.filterMethod:(f,m,v,w)=>{const o=m?m.toLowerCase():"";return f.filter(S=>v.some(k=>{const I=w(k,S)+"";return(I==="undefined"||I==="null"?"":I.toLowerCase()).indexOf(o)!==-1}))});return Wt(()=>t.filter,()=>{ui(()=>{s({page:1},!0)})},{deep:!0}),{computedFilterMethod:u}}function z3(t,s){for(const u in s)if(s[u]!==t[u])return!1;return!0}function Vw(t){return t.page<1&&(t.page=1),t.rowsPerPage!==void 0&&t.rowsPerPage<1&&(t.rowsPerPage=0),t}const L3={pagination:Object,rowsPerPageOptions:{type:Array,default:()=>[5,7,10,15,20,25,50,0]},"onUpdate:pagination":[Function,Array]};function R3(t,s){const{props:u,emit:f}=t,m=xt(Object.assign({sortBy:null,descending:!1,page:1,rowsPerPage:u.rowsPerPageOptions.length>0?u.rowsPerPageOptions[0]:5},u.pagination)),v=se(()=>{const I=u["onUpdate:pagination"]!==void 0?{...m.value,...u.pagination}:m.value;return Vw(I)}),w=se(()=>v.value.rowsNumber!==void 0);function o(I){S({pagination:I,filter:u.filter})}function S(I={}){ui(()=>{f("request",{pagination:I.pagination||v.value,filter:I.filter||u.filter,getCellValue:s})})}function k(I,D){const B=Vw({...v.value,...I});if(z3(v.value,B)===!0){w.value===!0&&D===!0&&o(B);return}if(w.value===!0){o(B);return}u.pagination!==void 0&&u["onUpdate:pagination"]!==void 0?f("update:pagination",B):m.value=B}return{innerPagination:m,computedPagination:v,isServerSide:w,requestServerInteraction:S,setPagination:k}}function D3(t,s,u,f,m,v){const{props:w,emit:o,proxy:{$q:S}}=t,k=se(()=>f.value===!0?u.value.rowsNumber||0:v.value),I=se(()=>{const{page:Ae,rowsPerPage:ce}=u.value;return(Ae-1)*ce}),D=se(()=>{const{page:Ae,rowsPerPage:ce}=u.value;return Ae*ce}),B=se(()=>u.value.page===1),V=se(()=>u.value.rowsPerPage===0?1:Math.max(1,Math.ceil(k.value/u.value.rowsPerPage))),$=se(()=>D.value===0?!0:u.value.page>=V.value),ne=se(()=>(w.rowsPerPageOptions.includes(s.value.rowsPerPage)?w.rowsPerPageOptions:[s.value.rowsPerPage].concat(w.rowsPerPageOptions)).map(ce=>({label:ce===0?S.lang.table.allRows:""+ce,value:ce})));Wt(V,(Ae,ce)=>{if(Ae===ce)return;const fe=u.value.page;Ae&&!fe?m({page:1}):Ae<fe&&m({page:Ae})});function oe(){m({page:1})}function ye(){const{page:Ae}=u.value;Ae>1&&m({page:Ae-1})}function te(){const{page:Ae,rowsPerPage:ce}=u.value;D.value>0&&Ae*ce<k.value&&m({page:Ae+1})}function Se(){m({page:V.value})}return w["onUpdate:pagination"]!==void 0&&o("update:pagination",{...u.value}),{firstRowIndex:I,lastRowIndex:D,isFirstPage:B,isLastPage:$,pagesNumber:V,computedRowsPerPageOptions:ne,computedRowsNumber:k,firstPage:oe,prevPage:ye,nextPage:te,lastPage:Se}}const O3={selection:{type:String,default:"none",validator:t=>["single","multiple","none"].includes(t)},selected:{type:Array,default:()=>[]}},B3=["update:selected","selection"];function F3(t,s,u,f){const m=se(()=>{const $={};return t.selected.map(f.value).forEach(ne=>{$[ne]=!0}),$}),v=se(()=>t.selection!=="none"),w=se(()=>t.selection==="single"),o=se(()=>t.selection==="multiple"),S=se(()=>u.value.length>0&&u.value.every($=>m.value[f.value($)]===!0)),k=se(()=>S.value!==!0&&u.value.some($=>m.value[f.value($)]===!0)),I=se(()=>t.selected.length);function D($){return m.value[$]===!0}function B(){s("update:selected",[])}function V($,ne,oe,ye){s("selection",{rows:ne,added:oe,keys:$,evt:ye});const te=w.value===!0?oe===!0?ne:[]:oe===!0?t.selected.concat(ne):t.selected.filter(Se=>$.includes(f.value(Se))===!1);s("update:selected",te)}return{hasSelectionMode:v,singleSelection:w,multipleSelection:o,allRowsSelected:S,someRowsSelected:k,rowsSelectedNumber:I,isRowSelected:D,clearSelection:B,updateSelection:V}}function Uw(t){return Array.isArray(t)?t.slice():[]}const N3={expanded:Array},V3=["update:expanded"];function U3(t,s){const u=xt(Uw(t.expanded));Wt(()=>t.expanded,w=>{u.value=Uw(w)});function f(w){return u.value.includes(w)}function m(w){t.expanded!==void 0?s("update:expanded",w):u.value=w}function v(w,o){const S=u.value.slice(),k=S.indexOf(w);o===!0?k===-1&&(S.push(w),m(S)):k!==-1&&(S.splice(k,1),m(S))}return{isRowExpanded:f,setExpanded:m,updateExpanded:v}}const q3={visibleColumns:Array};function j3(t,s,u){const f=se(()=>{if(t.columns!==void 0)return t.columns;const o=t.rows[0];return o!==void 0?Object.keys(o).map(S=>({name:S,label:S.toUpperCase(),field:S,align:um(o[S])?"right":"left",sortable:!0})):[]}),m=se(()=>{const{sortBy:o,descending:S}=s.value;return(t.visibleColumns!==void 0?f.value.filter(I=>I.required===!0||t.visibleColumns.includes(I.name)===!0):f.value).map(I=>{const D=I.align||"right",B=`text-${D}`;return{...I,align:D,__iconClass:`q-table__sort-icon q-table__sort-icon--${D}`,__thClass:B+(I.headerClasses!==void 0?" "+I.headerClasses:"")+(I.sortable===!0?" sortable":"")+(I.name===o?` sorted ${S===!0?"sort-desc":""}`:""),__tdStyle:I.style!==void 0?typeof I.style!="function"?()=>I.style:I.style:()=>null,__tdClass:I.classes!==void 0?typeof I.classes!="function"?()=>B+" "+I.classes:V=>B+" "+I.classes(V):()=>B}})}),v=se(()=>{const o={};return m.value.forEach(S=>{o[S.name]=S}),o}),w=se(()=>t.tableColspan!==void 0?t.tableColspan:m.value.length+(u.value===!0?1:0));return{colList:f,computedCols:m,computedColsMap:v,computedColspan:w}}const Vp="q-table__bottom row items-center",w2={};v2.forEach(t=>{w2[t]={}});const $3=Vn({name:"QTable",props:{rows:{type:Array,default:()=>[]},rowKey:{type:[String,Function],default:"id"},columns:Array,loading:Boolean,iconFirstPage:String,iconPrevPage:String,iconNextPage:String,iconLastPage:String,title:String,hideHeader:Boolean,grid:Boolean,gridHeader:Boolean,dense:Boolean,flat:Boolean,bordered:Boolean,square:Boolean,separator:{type:String,default:"horizontal",validator:t=>["horizontal","vertical","cell","none"].includes(t)},wrapCells:Boolean,virtualScroll:Boolean,virtualScrollTarget:{default:void 0},...w2,noDataLabel:String,noResultsLabel:String,loadingLabel:String,selectedRowsLabel:Function,rowsPerPageLabel:String,paginationLabel:Function,color:{type:String,default:"grey-8"},titleClass:[String,Array,Object],tableStyle:[String,Array,Object],tableClass:[String,Array,Object],tableHeaderStyle:[String,Array,Object],tableHeaderClass:[String,Array,Object],cardContainerClass:[String,Array,Object],cardContainerStyle:[String,Array,Object],cardStyle:[String,Array,Object],cardClass:[String,Array,Object],hideBottom:Boolean,hideSelectedBanner:Boolean,hideNoData:Boolean,hidePagination:Boolean,onRowClick:Function,onRowDblclick:Function,onRowContextmenu:Function,...no,...r2,...q3,...k3,...L3,...N3,...O3,...M3},emits:["request","virtual-scroll",...o2,...V3,...B3],setup(t,{slots:s,emit:u}){const f=Mn(),{proxy:{$q:m}}=f,v=io(t,m),{inFullscreen:w,toggleFullscreen:o}=s2(),S=se(()=>typeof t.rowKey=="function"?t.rowKey:ct=>ct[t.rowKey]),k=xt(null),I=xt(null),D=se(()=>t.grid!==!0&&t.virtualScroll===!0),B=se(()=>" q-table__card"+(v.value===!0?" q-table__card--dark q-dark":"")+(t.square===!0?" q-table--square":"")+(t.flat===!0?" q-table--flat":"")+(t.bordered===!0?" q-table--bordered":"")),V=se(()=>`q-table__container q-table--${t.separator}-separator column no-wrap`+(t.grid===!0?" q-table--grid":B.value)+(v.value===!0?" q-table--dark":"")+(t.dense===!0?" q-table--dense":"")+(t.wrapCells===!1?" q-table--no-wrap":"")+(w.value===!0?" fullscreen scroll":"")),$=se(()=>V.value+(t.loading===!0?" q-table--loading":""));Wt(()=>t.tableStyle+t.tableClass+t.tableHeaderStyle+t.tableHeaderClass+V.value,()=>{D.value===!0&&I.value!==null&&I.value.reset()});const{innerPagination:ne,computedPagination:oe,isServerSide:ye,requestServerInteraction:te,setPagination:Se}=R3(f,Bi),{computedFilterMethod:Ae}=P3(t,Se),{isRowExpanded:ce,setExpanded:fe,updateExpanded:Ee}=U3(t,u),Me=se(()=>{let ct=t.rows;if(ye.value===!0||ct.length===0)return ct;const{sortBy:Kt,descending:hn}=oe.value;return t.filter&&(ct=Ae.value(ct,t.filter,mt.value,Bi)),xn.value!==null&&(ct=rt.value(t.rows===ct?ct.slice():ct,Kt,hn)),ct}),Ie=se(()=>Me.value.length),ke=se(()=>{let ct=Me.value;if(ye.value===!0)return ct;const{rowsPerPage:Kt}=oe.value;return Kt!==0&&(ot.value===0&&t.rows!==ct?ct.length>_t.value&&(ct=ct.slice(0,_t.value)):ct=ct.slice(ot.value,_t.value)),ct}),{hasSelectionMode:Be,singleSelection:Re,multipleSelection:Ze,allRowsSelected:Ye,someRowsSelected:lt,rowsSelectedNumber:Xt,isRowSelected:Ge,clearSelection:At,updateSelection:tn}=F3(t,u,ke,S),{colList:Ve,computedCols:mt,computedColsMap:Bt,computedColspan:qt}=j3(t,oe,Be),{columnToSort:xn,computedSortMethod:rt,sort:gt}=I3(t,oe,Ve,Se),{firstRowIndex:ot,lastRowIndex:_t,isFirstPage:ft,isLastPage:sn,pagesNumber:un,computedRowsPerPageOptions:re,computedRowsNumber:xe,firstPage:Fe,prevPage:nt,nextPage:yt,lastPage:zt}=D3(f,ne,oe,ye,Se,Ie),Vt=se(()=>ke.value.length===0),kt=se(()=>{const ct={};return v2.forEach(Kt=>{ct[Kt]=t[Kt]}),ct.virtualScrollItemSize===void 0&&(ct.virtualScrollItemSize=t.dense===!0?28:48),ct});function bt(){D.value===!0&&I.value.reset()}function Mt(){if(t.grid===!0)return so();const ct=t.hideHeader!==!0?Ei:null;if(D.value===!0){const hn=s["top-row"],En=s["bottom-row"],In={default:X=>nn(X.item,s.body,X.index)};if(hn!==void 0){const X=pe("tbody",hn({cols:mt.value}));In.before=ct===null?()=>X:()=>[ct()].concat(X)}else ct!==null&&(In.before=ct);return En!==void 0&&(In.after=()=>pe("tbody",En({cols:mt.value}))),pe(p3,{ref:I,class:t.tableClass,style:t.tableStyle,...kt.value,scrollTarget:t.virtualScrollTarget,items:ke.value,type:"__qtable",tableColspan:qt.value,onVirtualScroll:et},In)}const Kt=[bn()];return ct!==null&&Kt.unshift(ct()),g2({class:["q-table__middle scroll",t.tableClass],style:t.tableStyle},Kt)}function Ht(ct,Kt){if(I.value!==null){I.value.scrollTo(ct,Kt);return}ct=parseInt(ct,10);const hn=k.value.querySelector(`tbody tr:nth-of-type(${ct+1})`);if(hn!==null){const En=k.value.querySelector(".q-table__middle.scroll"),In=hn.offsetTop-t.virtualScrollStickySizeStart,X=In<En.scrollTop?"decrease":"increase";En.scrollTop=In,u("virtual-scroll",{index:ct,from:0,to:ne.value.rowsPerPage-1,direction:X})}}function et(ct){u("virtual-scroll",ct)}function Rt(){return[pe(x3,{class:"q-table__linear-progress",color:t.color,dark:v.value,indeterminate:!0,trackColor:"transparent"})]}function nn(ct,Kt,hn){const En=S.value(ct),In=Ge(En);if(Kt!==void 0)return Kt(zn({key:En,row:ct,pageIndex:hn,__trClass:In?"selected":""}));const X=s["body-cell"],N=mt.value.map(Y=>{const ue=s[`body-cell-${Y.name}`],Te=ue!==void 0?ue:X;return Te!==void 0?Te(Cn({key:En,row:ct,pageIndex:hn,col:Y})):pe("td",{class:Y.__tdClass(ct),style:Y.__tdStyle(ct)},Bi(Y,ct))});if(Be.value===!0){const Y=s["body-selection"],ue=Y!==void 0?Y(jn({key:En,row:ct,pageIndex:hn})):[pe(uy,{modelValue:In,color:t.color,dark:v.value,dense:t.dense,"onUpdate:modelValue":(Te,Oe)=>{tn([En],[ct],Te,Oe)}})];N.unshift(pe("td",{class:"q-table--col-auto-width"},ue))}const j={key:En,class:{selected:In}};return t.onRowClick!==void 0&&(j.class["cursor-pointer"]=!0,j.onClick=Y=>{u("RowClick",Y,ct,hn)}),t.onRowDblclick!==void 0&&(j.class["cursor-pointer"]=!0,j.onDblclick=Y=>{u("RowDblclick",Y,ct,hn)}),t.onRowContextmenu!==void 0&&(j.class["cursor-pointer"]=!0,j.onContextmenu=Y=>{u("RowContextmenu",Y,ct,hn)}),pe("tr",j,N)}function bn(){const ct=s.body,Kt=s["top-row"],hn=s["bottom-row"];let En=ke.value.map((In,X)=>nn(In,ct,X));return Kt!==void 0&&(En=Kt({cols:mt.value}).concat(En)),hn!==void 0&&(En=En.concat(hn({cols:mt.value}))),pe("tbody",En)}function zn(ct){return Wn(ct),ct.cols=ct.cols.map(Kt=>ys({...Kt},"value",()=>Bi(Kt,ct.row))),ct}function Cn(ct){return Wn(ct),ys(ct,"value",()=>Bi(ct.col,ct.row)),ct}function jn(ct){return Wn(ct),ct}function Wn(ct){Object.assign(ct,{cols:mt.value,colsMap:Bt.value,sort:gt,rowIndex:ot.value+ct.pageIndex,color:t.color,dark:v.value,dense:t.dense}),Be.value===!0&&ys(ct,"selected",()=>Ge(ct.key),(Kt,hn)=>{tn([ct.key],[ct.row],Kt,hn)}),ys(ct,"expand",()=>ce(ct.key),Kt=>{Ee(ct.key,Kt)})}function Bi(ct,Kt){const hn=typeof ct.field=="function"?ct.field(Kt):Kt[ct.field];return ct.format!==void 0?ct.format(hn,Kt):hn}const qi=se(()=>({pagination:oe.value,pagesNumber:un.value,isFirstPage:ft.value,isLastPage:sn.value,firstPage:Fe,prevPage:nt,nextPage:yt,lastPage:zt,inFullscreen:w.value,toggleFullscreen:o}));function ji(){const ct=s.top,Kt=s["top-left"],hn=s["top-right"],En=s["top-selection"],In=Be.value===!0&&En!==void 0&&Xt.value>0,X="q-table__top relative-position row items-center";if(ct!==void 0)return pe("div",{class:X},[ct(qi.value)]);let N;if(In===!0?N=En(qi.value).slice():(N=[],Kt!==void 0?N.push(pe("div",{class:"q-table-control"},[Kt(qi.value)])):t.title&&N.push(pe("div",{class:"q-table__control"},[pe("div",{class:["q-table__title",t.titleClass]},t.title)]))),hn!==void 0&&(N.push(pe("div",{class:"q-table__separator col"})),N.push(pe("div",{class:"q-table__control"},[hn(qi.value)]))),N.length!==0)return pe("div",{class:X},N)}const tr=se(()=>lt.value===!0?null:Ye.value);function Ei(){const ct=$i();return t.loading===!0&&s.loading===void 0&&ct.push(pe("tr",{class:"q-table__progress"},[pe("th",{class:"relative-position",colspan:qt.value},Rt())])),pe("thead",ct)}function $i(){const ct=s.header,Kt=s["header-cell"];if(ct!==void 0)return ct(hr({header:!0})).slice();const hn=mt.value.map(En=>{const In=s[`header-cell-${En.name}`],X=In!==void 0?In:Kt,N=hr({col:En});return X!==void 0?X(N):pe(p2,{key:En.name,props:N},()=>En.label)});if(Re.value===!0&&t.grid!==!0)hn.unshift(pe("th",{class:"q-table--col-auto-width"}," "));else if(Ze.value===!0){const En=s["header-selection"],In=En!==void 0?En(hr({})):[pe(uy,{color:t.color,modelValue:tr.value,dark:v.value,dense:t.dense,"onUpdate:modelValue":Ar})];hn.unshift(pe("th",{class:"q-table--col-auto-width"},In))}return[pe("tr",{class:t.tableHeaderClass,style:t.tableHeaderStyle},hn)]}function hr(ct){return Object.assign(ct,{cols:mt.value,sort:gt,colsMap:Bt.value,color:t.color,dark:v.value,dense:t.dense}),Ze.value===!0&&ys(ct,"selected",()=>tr.value,Ar),ct}function Ar(ct){lt.value===!0&&(ct=!1),tn(ke.value.map(S.value),ke.value,ct)}const Mr=se(()=>{const ct=[t.iconFirstPage||m.iconSet.table.firstPage,t.iconPrevPage||m.iconSet.table.prevPage,t.iconNextPage||m.iconSet.table.nextPage,t.iconLastPage||m.iconSet.table.lastPage];return m.lang.rtl===!0?ct.reverse():ct});function fo(){if(t.hideBottom===!0)return;if(Vt.value===!0){if(t.hideNoData===!0)return;const hn=t.loading===!0?t.loadingLabel||m.lang.table.loading:t.filter?t.noResultsLabel||m.lang.table.noResults:t.noDataLabel||m.lang.table.noData,En=s["no-data"],In=En!==void 0?[En({message:hn,icon:m.iconSet.table.warning,filter:t.filter})]:[pe(Hr,{class:"q-table__bottom-nodata-icon",name:m.iconSet.table.warning}),hn];return pe("div",{class:Vp+" q-table__bottom--nodata"},In)}const ct=s.bottom;if(ct!==void 0)return pe("div",{class:Vp},[ct(qi.value)]);const Kt=t.hideSelectedBanner!==!0&&Be.value===!0&&Xt.value>0?[pe("div",{class:"q-table__control"},[pe("div",[(t.selectedRowsLabel||m.lang.table.selectedRecords)(Xt.value)])])]:[];if(t.hidePagination!==!0)return pe("div",{class:Vp+" justify-end"},oo(Kt));if(Kt.length>0)return pe("div",{class:Vp},Kt)}function xr(ct){Se({page:1,rowsPerPage:ct.value})}function oo(ct){let Kt;const{rowsPerPage:hn}=oe.value,En=t.paginationLabel||m.lang.table.pagination,In=s.pagination,X=t.rowsPerPageOptions.length>1;if(ct.push(pe("div",{class:"q-table__separator col"})),X===!0&&ct.push(pe("div",{class:"q-table__control"},[pe("span",{class:"q-table__bottom-item"},[t.rowsPerPageLabel||m.lang.table.recordsPerPage]),pe(y3,{class:"q-table__select inline q-table__bottom-item",color:t.color,modelValue:hn,options:re.value,displayValue:hn===0?m.lang.table.allRows:hn,dark:v.value,borderless:!0,dense:!0,optionsDense:!0,optionsCover:!0,"onUpdate:modelValue":xr})])),In!==void 0)Kt=In(qi.value);else if(Kt=[pe("span",hn!==0?{class:"q-table__bottom-item"}:{},[hn?En(ot.value+1,Math.min(_t.value,xe.value),xe.value):En(1,Ie.value,xe.value)])],hn!==0&&un.value>1){const N={color:t.color,round:!0,dense:!0,flat:!0};t.dense===!0&&(N.size="sm"),un.value>2&&Kt.push(pe(Ci,{key:"pgFirst",...N,icon:Mr.value[0],disable:ft.value,onClick:Fe})),Kt.push(pe(Ci,{key:"pgPrev",...N,icon:Mr.value[1],disable:ft.value,onClick:nt}),pe(Ci,{key:"pgNext",...N,icon:Mr.value[2],disable:sn.value,onClick:yt})),un.value>2&&Kt.push(pe(Ci,{key:"pgLast",...N,icon:Mr.value[3],disable:sn.value,onClick:zt}))}return ct.push(pe("div",{class:"q-table__control"},Kt)),ct}function Jo(){const ct=t.gridHeader===!0?[pe("table",{class:"q-table"},[Ei()])]:t.loading===!0&&s.loading===void 0?Rt():void 0;return pe("div",{class:"q-table__middle"},ct)}function so(){const ct=s.item!==void 0?s.item:Kt=>{const hn=Kt.cols.map(In=>pe("div",{class:"q-table__grid-item-row"},[pe("div",{class:"q-table__grid-item-title"},[In.label]),pe("div",{class:"q-table__grid-item-value"},[In.value])]));if(Be.value===!0){const In=s["body-selection"],X=In!==void 0?In(Kt):[pe(uy,{modelValue:Kt.selected,color:t.color,dark:v.value,dense:t.dense,"onUpdate:modelValue":(N,j)=>{tn([Kt.key],[Kt.row],N,j)}})];hn.unshift(pe("div",{class:"q-table__grid-item-row"},X),pe(m2,{dark:v.value}))}const En={class:["q-table__grid-item-card"+B.value,t.cardClass],style:t.cardStyle};return(t.onRowClick!==void 0||t.onRowDblclick!==void 0)&&(En.class[0]+=" cursor-pointer",t.onRowClick!==void 0&&(En.onClick=In=>{u("RowClick",In,Kt.row,Kt.pageIndex)}),t.onRowDblclick!==void 0&&(En.onDblclick=In=>{u("RowDblclick",In,Kt.row,Kt.pageIndex)})),pe("div",{class:"q-table__grid-item col-xs-12 col-sm-6 col-md-4 col-lg-3"+(Kt.selected===!0?" q-table__grid-item--selected":"")},[pe("div",En,hn)])};return pe("div",{class:["q-table__grid-content row",t.cardContainerClass],style:t.cardContainerStyle},ke.value.map((Kt,hn)=>ct(zn({key:S.value(Kt),row:Kt,pageIndex:hn}))))}return Object.assign(f.proxy,{requestServerInteraction:te,setPagination:Se,firstPage:Fe,prevPage:nt,nextPage:yt,lastPage:zt,isRowSelected:Ge,clearSelection:At,isRowExpanded:ce,setExpanded:fe,sort:gt,resetVirtualScroll:bt,scrollTo:Ht,getCellValue:Bi}),wk(f.proxy,{filteredSortedRows:()=>Me.value,computedRows:()=>ke.value,computedRowsNumber:()=>xe.value}),()=>{const ct=[ji()],Kt={ref:k,class:$.value};return t.grid===!0?ct.push(Jo()):Object.assign(Kt,{class:[Kt.class,t.cardClass],style:t.cardStyle}),ct.push(Mt(),fo()),t.loading===!0&&s.loading!==void 0&&ct.push(s.loading()),pe("div",Kt,ct)}}});function E2(){return Vr(tT)}const G3={class:"flex row justify-center",style:{width:"100%"}},Z3={__name:"SearchPopUp",props:{toggle:Boolean},emits:["update:toggle","update:currentTag"],setup(t,{emit:s}){const u=t,f=E2(),m=cg(),v=f2(u,"toggle",s),w=xt(),o=xt(""),S=se(()=>w.value.filter(D=>D.title.toLowerCase().includes(o.value.toLowerCase()))),k=[{name:"image",label:"Image",field:"image",align:"center"},{name:"title",label:"Title",field:"title",align:"center"},{name:"description",label:"Description",field:"descrition",align:"center"},{name:"favourite",label:"favourite",field:"favourite",align:"center"}],I=()=>{const D=["image","title"];return f.screen.gt.xs&&D.push("description"),f.screen.gt.sm&&D.push("favourite"),D};return Ui(()=>{S.value=m.tags}),Dm(()=>{w.value=m.tags}),(D,B)=>(Yn(),Qi(wm,{modelValue:On(v),"onUpdate:modelValue":B[1]||(B[1]=V=>Vi(v)?v.value=V:null),persistent:"",maximized:!0,"transition-show":"slide-up","transition-hide":"slide-down"},{default:vn(()=>[Nt(Cd,null,{default:vn(()=>[Nt(qy,{class:"bg-white text-black flex justify-center"},{default:vn(()=>[Xl(Nt(Ci,{dense:"",flat:"","font-size":"30px",icon:"expand_more"},null,512),[[tm]])]),_:1}),Nt($3,{rows:On(S),columns:k,"row-key":"name","hide-bottom":"","rows-per-page-options":[20],"visible-columns":I(),style:{height:"80vh"}},{top:vn(()=>[yr("div",G3,[Nt(em,{rounded:"",outlined:"",debounce:"300",modelValue:o.value,"onUpdate:modelValue":B[0]||(B[0]=V=>o.value=V),placeholder:"Search"},{append:vn(()=>[Nt(Hr,{name:"search"})]),_:1},8,["modelValue"])])]),header:vn(V=>[Nt(t3,{props:V},{default:vn(()=>[(Yn(!0),Zr(Ki,null,Su(V.cols,$=>(Yn(),Qi(p2,{key:$.name,props:V,class:"text-primary"},{default:vn(()=>[Cu(Gs($.label),1)]),_:2},1032,["props"]))),128))]),_:2},1032,["props"])]),"body-cell-image":vn(V=>[Nt(s3,{props:V},{default:vn(()=>[yr("div",null,[Nt(o3,{onClick:$=>s("update:currentTag",V.row),src:`/images/${V.row.images[0]}`},null,8,["onClick","src"])])]),_:2},1032,["props"])]),_:1},8,["rows","visible-columns"])]),_:1})]),_:1},8,["modelValue"]))}},H3={class:"text-h6"},W3={class:"text-subtitle2"},X3={__name:"MarkerCard",props:{tag:Object},emits:["update:currentTag","opendBigDailog"],setup(t,{emit:s}){const u=t,f=cg(),m=()=>{s("update:currentTag",u.tag)};return(v,w)=>(Yn(),Qi(Cd,{class:"my-card",style:{width:"250px"}},{default:vn(()=>[Nt(Ci,{class:"fixed-top-left q-mt-md","text-color":"primary",flat:"",icon:"open_in_full",onClick:w[0]||(w[0]=o=>m()),style:{"z-index":"1"}}),t.tag.favourite?xs("",!0):(Yn(),Qi(Ci,{key:0,class:"fixed-top-right q-mt-md","text-color":"primary",flat:"",icon:"star_outline",style:{"z-index":"1"},onClick:w[1]||(w[1]=o=>On(f).favouriteTag(t.tag))})),t.tag.favourite?(Yn(),Qi(Ci,{key:1,class:"fixed-top-right q-mt-md","text-color":"primary",flat:"",icon:"star",style:{"z-index":"1"},onClick:w[2]||(w[2]=o=>On(f).favouriteTag(t.tag))})):xs("",!0),Nt(d2,{images:u.tag.images},null,8,["images"]),Nt($s,null,{default:vn(()=>[yr("div",H3,Gs(u.tag.title),1),yr("div",W3,Gs(u.tag.description),1)]),_:1}),Nt($s,{class:"q-pt-none"}),Nt(m2),Nt($s,null,{default:vn(()=>[yr("p",null,"Datum:"+Gs(u.tag.created),1)]),_:1})]),_:1}))}},K3={__name:"HomeView",setup(t){Qp();const s=cg(),u=gL(),f=xt(s.tags[0]),m=xt(!1),v=xt(!1),w=D=>{f.value=D,m.value=!0},o="pk.eyJ1IjoidG9iaXdhbmtpcm5vYmkiLCJhIjoiY2xlNXBuc2g1MGY4YzNxcWkxcWNtZ3N2ZCJ9.qWMZQd_uuqNnTDb9QcBtiQ",S=xt();let k=0;const I=setInterval(()=>{const D=document.querySelector(".mapboxgl-ctrl-geolocate");D&&(D.click(),clearInterval(I)),k>=8e3&&clearInterval(I),k+=500},500);return Ui(()=>{s.getUserTags()}),(D,B)=>(Yn(),Zr(Ki,null,[Nt(On(Vy),{style:{height:"100vh"},ref_key:"mapboxMap",ref:S,"access-token":On(o),"map-style":"mapbox://styles/tobiwankirnobi/cle5t3xjp001b01o4s7negt5k",center:[0,0],zoom:1},{default:vn(()=>[Nt(On(eB),{trackUserLocation:!0,showAccuracyCircle:!1}),(Yn(!0),Zr(Ki,null,Su(On(s).tags,V=>(Yn(),Qi(On(Uy),{key:V.id,"lng-lat":[V.coords.longitude,V.coords.latitude],popup:{closeButton:!1,maxWidth:"300px"}},{popup:vn(()=>[Nt(X3,{tag:V,"onUpdate:currentTag":B[0]||(B[0]=$=>w($))},null,8,["tag"])]),_:2},1032,["lng-lat"]))),128))]),_:1},8,["access-token"]),Nt(NT,{id:"footer-toolbar",class:"row justify-center q-gutter-md q-my-md fixed-bottom"},{default:vn(()=>[Nt(Ci,{size:"32px",color:"primary",flat:"",square:"",icon:"image",onClick:B[1]||(B[1]=V=>On(u).push({path:"albums"}))}),Nt(Ci,{size:"32px",color:"primary",flat:"",square:"",icon:"add",onClick:B[2]||(B[2]=V=>On(u).push({path:"add"}))}),Nt(Ci,{size:"32px",color:"primary",flat:"",square:"",icon:"search",onClick:B[3]||(B[3]=V=>v.value=!0)})]),_:1}),Nt(e3,{currentTag:f.value,toggle:m.value,"onUpdate:toggle":B[4]||(B[4]=V=>m.value=V)},null,8,["currentTag","toggle"]),Nt(Z3,{toggle:v.value,"onUpdate:toggle":B[5]||(B[5]=V=>v.value=V),"onUpdate:currentTag":B[6]||(B[6]=V=>w(V))},null,8,["toggle"])],64))}},T2=pL({history:kz("/"),routes:[{path:"/",name:"home",component:K3,beforeEnter:(t,s,u)=>{Qp().isAuthenticated?u():u({path:"/login"})}},{path:"/add",name:"Add Tag",component:()=>cu(()=>import("./AddTagView.ecee2478.js"),[])},{path:"/albums",name:"Albums",component:()=>cu(()=>import("./AlbumsView.9bdc4abd.js"),[])},{path:"/login",name:"login",component:()=>cu(()=>import("./LoginRegister.f8bc4462.js"),[]),beforeEnter:(t,s,u)=>{Qp().isAuthenticated?u({path:"/login"}):u()}},{path:"/logout",beforeEnter:(t,s,u)=>{Qp().logout(),u({path:"/login"})}},{path:"/verify/",name:"verify",component:()=>cu(()=>import("./VerifyRegestration.1bdfa013.js"),[])},{path:"/thankyou",name:"newRegistred",component:()=>cu(()=>import("./NewRegistred.520a23c1.js"),["assets/NewRegistred.520a23c1.js","assets/_plugin-vue_export-helper.cdc0426e.js"])},{path:"/:catchAll(.*)*",component:()=>cu(()=>import("./ErrorNotFound.31db2d8c.js"),["assets/ErrorNotFound.31db2d8c.js","assets/_plugin-vue_export-helper.cdc0426e.js"])}]}),Y3={__name:"EssentialLinks",props:{title:{type:String,required:!0},link:{type:String,default:"#"},icon:{type:String,default:""},svg:{type:String,default:null}},setup(t){const s=t,u=()=>{T2.push(s.link)};return(f,m)=>(Yn(),Qi($T,{clickable:"",tag:"a",target:"_blank",onClick:m[0]||(m[0]=v=>u())},{default:vn(()=>[t.icon?(Yn(),Qi(Hp,{key:0,avatar:""},{default:vn(()=>[Nt(Hr,{size:"30px",name:t.icon},null,8,["name"])]),_:1})):xs("",!0),t.svg?(Yn(),Qi(Hp,{key:1,avatar:""},{default:vn(()=>[Nt(Ed,{size:"30px",color:"primary","text-color":"white"},{default:vn(()=>[Cu(Gs(t.title[0]),1)]),_:1})]),_:1})):xs("",!0),Nt(Hp,null,{default:vn(()=>[Nt(jT,null,{default:vn(()=>[Cu(Gs(t.title),1)]),_:1})]),_:1})]),_:1}))}},qw=async()=>{try{return await fetch(window.location.origin,{method:"HEAD"}),!0}catch{return!1}};const Q3=yr("img",{src:"/Logos/Main.svg"},null,-1),J3=yr("p",{class:"river"},"TagIt",-1),eF=yr("img",{src:"/Logos/Main.svg"},null,-1),tF={key:0,class:"bg-white",style:{border:"2px solid primary"}},nF=yr("p",null,"An Update is available",-1),iF={__name:"App",setup(t){const s=E2(),u=xt(!1),f=()=>u.value=!u.value,m=[{title:"Account",icon:"account_circle",link:"/"},{title:"Logout",icon:"logout",link:"/login"}],v=xt(!0),w=xt(!1),o=async()=>{var k;v.value=await qw(),window.addEventListener("online",()=>v.value=!0),window.addEventListener("offline",()=>v.value=!1);const S=await navigator.serviceWorker.getRegistration();S&&((k=S.waiting)==null||k.postMessage({type:"SKIP_WAITING"})),window.location.reload()};return Ui(async()=>{v.value=await qw(),window.addEventListener("online",()=>{v.value=!0,s.notify({color:"green-4",textColor:"white",icon:"wifi",message:"Online"})}),window.addEventListener("offline",()=>{v.value=!1,s.notify({color:"red-4",textColor:"white",icon:"wifi_off",message:"Offline"})});const S=await navigator.serviceWorker.getRegistration();if(!S){console.log("registration failed!");return}S.addEventListener("updatefound",()=>w.value=!0),S.waiting&&(w.value=!0),window.indexedDB||alert("IndexedDB is not available!")}),(S,k)=>{const I=hI("router-view");return Yn(),Qi(uz,{view:"hHh lpr fFf"},{default:vn(()=>[Nt(JP,{elevated:"",class:"bg-primary text-white","height-hint":"98"},{default:vn(()=>[Nt(NT,null,{default:vn(()=>[Nt(Ci,{dense:"",flat:"",round:"",icon:"menu",onClick:f}),Nt(kP,{class:"row justify-center"},{default:vn(()=>[Nt(Ed,null,{default:vn(()=>[Q3]),_:1}),J3,Nt(Ed,null,{default:vn(()=>[eF]),_:1})]),_:1}),Nt(Ed,{"font-size":"40px","text-color":"white",icon:"account_circle"},{default:vn(()=>[Nt(FT,{"transition-show":"jump-down","transition-hide":"jump-up"},{default:vn(()=>[Nt(ST,{style:{"min-width":"100px"}},{default:vn(()=>[(Yn(),Zr(Ki,null,Su(m,D=>Nt(Y3,Fm({key:D.title},D),null,16)),64))]),_:1})]),_:1}),v.value?xs("",!0):(Yn(),Qi(S1,{key:0,floating:"",color:"red",rounded:""})),v.value?(Yn(),Qi(S1,{key:1,floating:"",color:"green",rounded:""})):xs("",!0)]),_:1})]),_:1})]),_:1}),w.value?(Yn(),Zr("div",tF,[nF,Nt(Ci,{class:"bg-primary text-white",onClick:o},{default:vn(()=>[Cu("Restart now")]),_:1})])):xs("",!0),Nt(sz,{modelValue:u.value,"onUpdate:modelValue":k[0]||(k[0]=D=>u.value=D),side:"left",bordered:""},null,8,["modelValue"]),Nt(az,null,{default:vn(()=>[Nt(I)]),_:1})]),_:1})}}},ug=XE(iF);ug.use(Wk());ug.use(T2);ug.use(Zk,{plugins:{Notify:IP},iconSet:eT});ug.mount("#app");export{Wl as $,Hr as A,y3 as B,qy as C,Xl as D,tm as E,Ki as F,Vr as G,Zs as H,rF as I,Ii as J,pe as K,zi as L,Vy as M,$a as N,_v as O,Po as P,Ci as Q,fT as R,Mn as S,Fa as T,AB as U,Vn as V,kT as W,Sv as X,Es as Y,Em as Z,Wt as _,cg as a,Bu as a0,zm as a1,ky as a2,bi as a3,yT as a4,ui as a5,Zm as a6,Uk as a7,pB as a8,mB as a9,no as aa,gB as ab,io as ac,_B as ad,hm as ae,E2 as af,Qp as ag,T2 as ah,Yn as b,Zr as c,yr as d,Su as e,Nt as f,wm as g,Cd as h,$s as i,em as j,Cu as k,On as l,oy as m,Uy as n,Ui as o,aT as p,se as q,xt as r,Vl as s,Un as t,gL as u,Qi as v,vn as w,xs as x,m2 as y,Gs as z};
